{"version":3,"file":"static/js/railmapSHMetro.f8af0ec4.chunk.js","mappings":"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","sources":["svgs/railmap/methods/shmetro-coline.ts","svgs/railmap/main/coline/coline-shmetro.tsx","svgs/railmap/main/main-shmetro.tsx","svgs/railmap/railmap-shmetro.tsx"],"sourcesContent":["import { ColineInfo, InterchangeInfo } from '../../../constants/constants';\nimport { drawLine } from './share';\n\nexport interface ColineLinePath {\n    main: {\n        linePath: string[];\n        colors: InterchangeInfo[];\n    }[];\n    pass: {\n        linePath: string[];\n        colors: InterchangeInfo[];\n    }[];\n}\n\n/**\n * Return all stations from ColineInfo's `from` and `to` with coline color preserved.\n */\nexport const calculateColineStations = (colineInfo: ColineInfo[], branches: string[][]) =>\n    colineInfo\n        .map(coLine => {\n            const involvedBranches = branches.filter(\n                branch => branch.includes(coLine.from) && branch.includes(coLine.to)\n            );\n\n            // the current coLineInfo fall on two separate branches,\n            // which should not be possible in current design.\n            if (involvedBranches.length !== 1) return { linePath: [], colors: coLine.colors };\n\n            const branch = involvedBranches.flat();\n            const a = branch.indexOf(coLine.from);\n            const b = branch.indexOf(coLine.to);\n            const linePath = a < b ? branch.slice(a, b + 1) : branch.slice(b, a + 1);\n            return {\n                linePath: linePath,\n                colors: coLine.colors,\n            };\n        })\n        .filter(branchWithColine => branchWithColine.linePath.length !== 0);\n\n/**\n * Return coline segments with stations in main/pass order.\n */\nexport const calculateColine = (\n    branchWithColine: ReturnType<typeof calculateColineStations>,\n    stnStates: {\n        [stnId: string]: 0 | 1 | -1;\n    }\n) =>\n    branchWithColine\n        .map(branchWithColine => {\n            const linePaths = drawLine(branchWithColine.linePath, stnStates);\n            return {\n                main: [\n                    {\n                        linePath: linePaths.main,\n                        colors: branchWithColine.colors,\n                    },\n                ],\n                pass: [\n                    {\n                        linePath: linePaths.pass,\n                        colors: branchWithColine.colors,\n                    },\n                ],\n            };\n        })\n        // .map(branchWithColine =>\n        //     (\n        //         Object.entries(drawLine(branchWithColine.linePath, stnStates)) as [\n        //             keyof ReturnType<typeof drawLine>,\n        //             string[]\n        //         ][]\n        //     )\n        //         .map(([type, linePath]) => ({ [type]: { linePath: linePath, colors: branchWithColine.colors } }))\n        //         .reduce((acc, cur) => ({ ...acc, ...cur }), { main: [], pass: [] } as ColineLinePath)\n        // )\n        .reduce(\n            (acc, cur) => {\n                acc.main = [...acc.main, ...cur.main];\n                acc.pass = [...acc.pass, ...cur.pass];\n                return acc;\n            },\n            { main: [], pass: [] } as ColineLinePath\n        );\n","import React from 'react';\nimport { drawLine } from '../../methods/share';\nimport { calculateColineStations, calculateColine } from '../../methods/shmetro-coline';\nimport { AtLeastOneOfPartial, Services, InterchangeInfo } from '../../../../constants/constants';\nimport { useAppSelector } from '../../../../redux';\nimport { _linePath, StationGroupProps } from '../main-shmetro';\nimport StationSHMetro from '../station/station-shmetro';\n\ninterface Props {\n    xs: { [stnId: string]: number };\n    servicesPresent: Services[];\n    stnStates: { [stnId: string]: -1 | 0 | 1 };\n}\n\ninterface ColineServicesPath {\n    main: {\n        path: string;\n        colors: InterchangeInfo[];\n    }[];\n    pass: {\n        path: string;\n        colors: InterchangeInfo[];\n    }[];\n    service: Services;\n}\n\ntype ColinePath = AtLeastOneOfPartial<Record<Services, ColineServicesPath>>;\nconst defaultTheme = ['shanghai', 'sh4', '#5F259F', '#fff', '4号线', 'Line 4'] as InterchangeInfo;\n\nexport const ColineSHMetro = (props: Props) => {\n    const { xs, servicesPresent, stnStates } = props;\n\n    const {\n        direction,\n        stn_list,\n        current_stn_idx,\n        branch_spacing,\n        info_panel_type,\n        coline: colineInfo,\n    } = useAppSelector(store => store.param);\n    const { branches, depsStr: deps } = useAppSelector(store => store.helper);\n\n    const yShares = React.useMemo(\n        () => {\n            console.log('computing y shares');\n            return Object.keys(stn_list).reduce((acc, cur) => {\n                if (branches[0].includes(cur)) {\n                    return { ...acc, [cur]: 0 };\n                } else {\n                    const branchOfStn = branches.slice(1).filter(branch => branch.includes(cur))[0];\n                    return { ...acc, [cur]: stn_list[branchOfStn[0]].children.indexOf(branchOfStn[1]) ? -3 : 3 };\n                }\n            }, {} as { [stnId: string]: number });\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [deps]\n    );\n    // filter out all positive yShares to draw the railmap w/ coline and its branches\n    const colineYShares = Object.entries(yShares)\n        .filter(([k, v]) => v <= 0)\n        .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {} as typeof yShares);\n    const colineYs = Object.keys(colineYShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: -colineYShares[cur] * branch_spacing }),\n        {} as typeof yShares\n    );\n\n    // coline color and all stations in the coline segments\n    const colineStns = React.useMemo(\n        () =>\n            calculateColine(\n                calculateColineStations(\n                    colineInfo.filter(co => co.display),\n                    branches\n                ),\n                stnStates\n            ),\n        [JSON.stringify(colineInfo), current_stn_idx, direction, deps]\n    );\n\n    const colinePaths = servicesPresent.reduce(\n        (acc, service) => ({\n            ...acc,\n            [service]: (Object.keys(colineStns) as (keyof ReturnType<typeof drawLine>)[]).reduce(\n                (acc, cur) => ({\n                    ...acc,\n                    [cur]: colineStns[cur]\n                        .map(colineStn => ({\n                            path: _linePath(\n                                colineStn.linePath,\n                                cur,\n                                xs,\n                                colineYs,\n                                direction,\n                                service,\n                                servicesPresent.length,\n                                stn_list,\n                                'diagonal'\n                            ),\n                            colors: colineStn.colors,\n                        }))\n                        .filter(colineStn => colineStn.path !== ''),\n                }),\n                {} as ColineServicesPath\n            ),\n        }),\n        {} as ColinePath\n    );\n\n    // only display coline stations when coline in effect\n    const colineStations = calculateColineStations(\n        colineInfo.filter(co => co.display),\n        branches\n    )\n        .map(co => co.linePath)\n        .flat();\n\n    const LINE_WIDTH = 12;\n    const COLINE_GAP = info_panel_type === 'sh2020' ? 3 : 0;\n    return (\n        <>\n            <g id=\"coline\" transform={`translate(0,${LINE_WIDTH + COLINE_GAP})`}>\n                <CoLine paths={colinePaths} direction={direction} />\n                <ColineStationInMainLine\n                    colineStns={colineStns}\n                    branches={branches}\n                    xs={xs}\n                    ys={colineYs}\n                    stnStates={stnStates}\n                    lineWidth={LINE_WIDTH}\n                    colineGap={COLINE_GAP}\n                />\n                <ColineStationGroup\n                    stnIds={Object.entries(yShares)\n                        .filter(([k, v]) => v < 0)\n                        .reduce((acc, [k, v]) => [...acc, k], [] as string[])\n                        .filter(stnId => !['linestart', 'lineend'].includes(stnId))\n                        .filter(stnId => stn_list[stnId].services.length !== 0)\n                        .filter(stnId => colineStations.includes(stnId))}\n                    xs={xs}\n                    ys={colineYs}\n                    stnStates={stnStates}\n                />\n            </g>\n        </>\n    );\n};\n\nexport default ColineSHMetro;\n\nconst CoLine = (props: { paths: ColinePath; direction: 'l' | 'r' }) => {\n    const { paths, direction } = props;\n\n    return (\n        <>\n            {(Object.keys(paths) as Services[]).map((service, i) => (\n                <g key={`servicePath${i}`} transform={`translate(0,${i * 25})`}>\n                    <g>\n                        {paths[service]?.pass.map((colinePath, j) => (\n                            <React.Fragment key={j}>\n                                <path\n                                    key={j}\n                                    stroke=\"var(--rmg-grey)\"\n                                    strokeWidth={12}\n                                    fill=\"none\"\n                                    d={colinePath.path}\n                                    strokeLinejoin=\"round\"\n                                    filter={service === Services.local ? undefined : `url(#contrast-${service})`}\n                                />\n                            </React.Fragment>\n                        ))}\n\n                        {paths[service]?.main.map((colinePath, j) => (\n                            <React.Fragment key={j}>\n                                {colinePath.colors.length > 1 && (\n                                    <linearGradient\n                                        id={`grad${j}`}\n                                        y1=\"-100%\"\n                                        y2=\"100%\"\n                                        x1=\"0\"\n                                        x2=\"0\"\n                                        // gradientTransform=\"rotate(90)\"\n                                        gradientUnits=\"userSpaceOnUse\"\n                                    >\n                                        {colinePath.colors.map((color, i) => (\n                                            <React.Fragment key={i}>\n                                                {/* more about React.Fragment on https://stackoverflow.com/a/59390967 */}\n                                                <stop // from\n                                                    offset={`${(100 / colinePath.colors.length) * (i + 0)}%`}\n                                                    stopColor={color[2]}\n                                                />\n                                                <stop // to\n                                                    offset={`${(100 / colinePath.colors.length) * (i + 1)}%`}\n                                                    stopColor={color[2]}\n                                                />\n                                            </React.Fragment>\n                                        ))}\n                                    </linearGradient>\n                                )}\n\n                                {direction === 'l' && (\n                                    <marker\n                                        id={`arrow_left_${j}_${colinePath.colors.map(c => c[2]).join('_')}`}\n                                        refY={0.5}\n                                        refX={1}\n                                    >\n                                        <path\n                                            d=\"M1,0L0,1H1z\"\n                                            fill={\n                                                colinePath.colors.length > 1\n                                                    ? `url(#grad${j})`\n                                                    : colinePath.colors[0][2]\n                                            }\n                                        />\n                                    </marker>\n                                )}\n                                {direction === 'r' && (\n                                    <marker\n                                        id={`arrow_right_${j}_${colinePath.colors.map(c => c[2]).join('_')}`}\n                                        refY={0.5}\n                                    >\n                                        <path\n                                            d=\"M0,0L1,1H-1z\"\n                                            fill={\n                                                colinePath.colors.length > 1\n                                                    ? `url(#grad${j})`\n                                                    : colinePath.colors[0][2]\n                                            }\n                                        />\n                                    </marker>\n                                )}\n\n                                <path\n                                    key={j}\n                                    // stroke={colinePath.colors.length > 1 ? `url(#grad${j})` : colinePath.colors[0][2]}\n                                    stroke={(colinePath.colors.at(-1) ?? defaultTheme)[2]}\n                                    strokeWidth={12}\n                                    fill=\"none\"\n                                    d={colinePath.path}\n                                    markerStart={\n                                        direction === 'l'\n                                            ? `url(#arrow_left_${j}_${colinePath.colors.map(c => c[2]).join('_')})`\n                                            : undefined\n                                    }\n                                    markerEnd={\n                                        direction === 'r'\n                                            ? `url(#arrow_right_${j}_${colinePath.colors.map(c => c[2]).join('_')})`\n                                            : undefined\n                                    }\n                                    strokeLinejoin=\"round\"\n                                    filter={service === Services.local ? undefined : `url(#contrast-${service})`}\n                                />\n                            </React.Fragment>\n                        ))}\n                    </g>\n                </g>\n            ))}\n        </>\n    );\n};\n\ninterface ColineStationInMainLineProps {\n    colineStns: ReturnType<typeof calculateColine>;\n    branches: string[][];\n    xs: { [stnId: string]: number };\n    ys: { [stnId: string]: number };\n    stnStates: { [stnId: string]: -1 | 0 | 1 };\n    lineWidth: number;\n    colineGap: number;\n}\n\n/**\n * A small rect overlay on the main branch where coline is present.\n */\nconst ColineStationInMainLine = (props: ColineStationInMainLineProps) => {\n    const { colineStns, branches, xs, ys, stnStates, lineWidth: LINE_WIDTH, colineGap: COLINE_GAP } = props;\n    const { line_name, theme, info_panel_type } = useAppSelector(store => store.param);\n\n    // data to draw the station elements.\n    const colineStations = [...colineStns.main, ...colineStns.pass]\n        // Merge main and pass station together to minimize the code duplication\n        // and its state can obtained by stnStates.\n        .map(stns =>\n            stns.linePath.map(stnId => ({\n                curStn: stnId,\n                x: xs[stnId],\n                y: ys[stnId],\n                color: stns.colors.at(-1) ?? [...theme, ...line_name],\n            }))\n        )\n        .flat()\n        .reduce(\n            // remove current station as it appears in both main and pass\n            (acc, cur) => (acc.find(x => x.curStn === cur.curStn) ? acc : acc.concat(cur)),\n            [] as {\n                curStn: string;\n                x: number;\n                y: number;\n                color: InterchangeInfo;\n            }[]\n        )\n        // only take the coline stations in the first branch(general main line)\n        // as coline stations in lower branches will be taken care by ColineStationGroup\n        .filter(stn => branches[0].includes(stn.curStn));\n    console.log(colineStations);\n\n    return (\n        <g id=\"stations_in_mainline\">\n            {colineStations.map(colineStation => {\n                const { curStn, x, y, color } = colineStation;\n                const height = (stnStates[curStn] === -1 ? 0 : LINE_WIDTH) + COLINE_GAP + LINE_WIDTH;\n                const dy = (stnStates[curStn] === -1 ? 0 : -LINE_WIDTH) - COLINE_GAP - LINE_WIDTH / 2;\n                return (\n                    <g key={curStn} transform={`translate(${x},${y})`}>\n                        {info_panel_type === 'sh2020' ? (\n                            <rect\n                                stroke=\"none\"\n                                height={height}\n                                width={12}\n                                x={-6}\n                                y={dy}\n                                fill={stnStates[curStn] === -1 ? 'var(--rmg-grey)' : color[2]}\n                            />\n                        ) : (\n                            <use\n                                xlinkHref=\"#int2_sh\"\n                                stroke=\"var(--rmg-theme-colour)\"\n                                transform={`translate(0,${-LINE_WIDTH})`}\n                            />\n                        )}\n                    </g>\n                );\n            })}\n        </g>\n    );\n};\n\n/**\n * Complete station component for stations in lower branches.\n */\nconst ColineStationGroup = (props: StationGroupProps) => {\n    const { xs, ys, stnStates, stnIds } = props;\n    const { branches, depsStr: deps } = useAppSelector(store => store.helper);\n    const { line_name, theme, coline } = useAppSelector(store => store.param);\n\n    // get colors of stations in coline branches, they use different colors than var(--rmg-theme-colour)\n    const colines = React.useMemo(() => calculateColineStations(coline, branches), [JSON.stringify(coline), deps]);\n    const colors = stnIds.reduce(\n        (acc, stnId) => ({\n            ...acc,\n            [stnId]: colines\n                .filter(coline => coline.linePath.includes(stnId))\n                .map(coline => coline.colors)\n                .flat()\n                // TODO-coline: support multiple colines\n                .at(0) ?? [...theme, ...line_name],\n        }),\n        {} as { [stnId: string]: InterchangeInfo }\n    );\n\n    return (\n        <g id=\"stations_in_coline\">\n            {stnIds.map(stnId => (\n                <g key={stnId} transform={`translate(${xs[stnId]},${ys[stnId]})`}>\n                    <StationSHMetro stnId={stnId} stnState={stnStates[stnId]} color={colors[stnId][2]} />\n                </g>\n            ))}\n        </g>\n    );\n};\n","import React from 'react';\nimport { adjacencyList, getXShareMTR, criticalPathMethod, drawLine, getStnState } from '../methods/share';\nimport StationSHMetro from './station/station-shmetro';\nimport ColineSHMetro from './coline/coline-shmetro';\nimport { AtLeastOneOfPartial, Services, StationDict } from '../../../constants/constants';\nimport { useAppSelector } from '../../../redux';\n\ninterface servicesPath {\n    main: string[];\n    pass: string[];\n    service: Services;\n}\n\ntype Paths = AtLeastOneOfPartial<Record<Services, servicesPath>>;\n\nconst MainSHMetro = () => {\n    const { routes, branches, depsStr: deps } = useAppSelector(store => store.helper);\n    const param = useAppSelector(store => store.param);\n    const { stn_list, branch_spacing, coline, direction } = useAppSelector(store => store.param);\n\n    const adjMat = adjacencyList(\n        param.stn_list,\n        () => 0,\n        () => 0\n    );\n\n    const criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    const realCP = criticalPathMethod(criticalPath.nodes[1], criticalPath.nodes.slice(-2)[0], adjMat);\n\n    const xShares = React.useMemo(\n        () => {\n            console.log('computing x shares');\n            return Object.keys(param.stn_list).reduce(\n                (acc, cur) => ({ ...acc, [cur]: getXShareMTR(cur, adjMat, branches) }),\n                {} as { [stnId: string]: number }\n            );\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [branches.toString(), JSON.stringify(adjMat)]\n    );\n    const lineXs: [number, number] = [\n        (param.svgWidth.railmap * param.padding) / 100,\n        param.svgWidth.railmap * (1 - param.padding / 100),\n    ];\n    const xs = Object.keys(xShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: lineXs[0] + (xShares[cur] / realCP.len) * (lineXs[1] - lineXs[0]) }),\n        {} as typeof xShares\n    );\n\n    // const yShares = React.useMemo(\n    //     () => {\n    //         console.log('computing y shares');\n    //         return Object.keys(param.stn_list).reduce(\n    //             (acc, cur) => ({ ...acc, [cur]: branches[0].includes(cur) ? 0 : 3 }),\n    //             {} as { [stnId: string]: number }\n    //         );\n    //     },\n    //     // eslint-disable-next-line react-hooks/exhaustive-deps\n    //     [deps]\n    // );\n    const yShares = React.useMemo(\n        () => {\n            console.log('computing y shares');\n            return Object.keys(stn_list).reduce((acc, cur) => {\n                if (branches[0].includes(cur)) {\n                    return { ...acc, [cur]: 0 };\n                } else {\n                    const branchOfStn = branches.slice(1).filter(branch => branch.includes(cur))[0];\n                    return { ...acc, [cur]: stn_list[branchOfStn[0]].children.indexOf(branchOfStn[1]) ? -3 : 3 };\n                }\n            }, {} as { [stnId: string]: number });\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [deps]\n    );\n\n    // filter out all negative yShares to draw the traditional railmap w/o coline and its branches\n    const lineYShares = Object.entries(yShares)\n        .filter(([k, v]) => v >= 0)\n        .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {} as typeof yShares);\n    const lineYs = Object.keys(lineYShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: -lineYShares[cur] * branch_spacing }),\n        {} as typeof yShares\n    );\n\n    const stnStates = React.useMemo(\n        () => getStnState(param.current_stn_idx, routes, param.direction),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [param.current_stn_idx, param.direction, routes.toString()]\n    );\n\n    const servicesAll = Object.values(Services);\n    const servicesPresent = Object.values(param.stn_list)\n        .map(stationInfo => stationInfo.services)\n        .flat() // all services in all stations\n        .reduce(\n            (acc, cur) => {\n                acc[servicesAll.indexOf(cur)] = true;\n                return acc;\n            },\n            [false, false, false] as [boolean, boolean, boolean]\n        ) // set the flag in order\n        .map((bool, i) => [servicesAll[i], bool] as [Services, boolean]) // zip\n        .filter(s => s[1]) // get the existing service\n        .map(s => s[0]); // maintain the services' order\n\n    const linePaths = branches\n        .map(branch => drawLine(branch, stnStates))\n        .reduce(\n            (acc, cur) => {\n                acc.main.push(cur.main);\n                acc.pass.push(cur.pass);\n                return acc;\n            },\n            { main: [], pass: [] } as { main: string[][]; pass: string[][] }\n        );\n\n    const paths = servicesPresent.reduce(\n        (acc, service) => ({\n            ...acc,\n            [service]: (Object.keys(linePaths) as (keyof ReturnType<typeof drawLine>)[]).reduce(\n                (acc, cur) => ({\n                    ...acc,\n                    [cur]: linePaths[cur]\n                        .map(stns =>\n                            _linePath(\n                                stns,\n                                cur,\n                                xs,\n                                lineYs,\n                                direction,\n                                service,\n                                servicesPresent.length,\n                                stn_list\n                                // info_panel_type === 'sh2020' ? 'rightangle' : 'diagonal'\n                            )\n                        )\n                        .filter(path => path !== ''),\n                }),\n                {} as servicesPath\n            ),\n        }),\n        {} as Paths\n    );\n\n    return (\n        <g id=\"main\" transform={`translate(0,${param.svg_height * (coline?.length > 0 ? 0.5 : 0.7 + 0.1)})`}>\n            <Line paths={paths} direction={param.direction} />\n            <StationGroup\n                stnIds={Object.keys(lineYShares)\n                    .filter(stnId => !['linestart', 'lineend'].includes(stnId))\n                    .filter(stnId => stn_list[stnId].services.length !== 0)}\n                xs={xs}\n                ys={lineYs}\n                stnStates={stnStates}\n            />\n            {coline?.length > 0 && <ColineSHMetro xs={xs} servicesPresent={servicesPresent} stnStates={stnStates} />}\n            <ServicesElements servicesLevel={servicesPresent} lineXs={lineXs} />\n        </g>\n    );\n};\n\nexport default MainSHMetro;\n\nconst Line = (props: { paths: Paths; direction: 'l' | 'r' }) => {\n    const { theme } = useAppSelector(store => store.param);\n    const { paths, direction } = props;\n\n    return (\n        <>\n            {(Object.keys(paths) as Services[]).map((service, i) => (\n                <g\n                    key={`servicePath${i}`}\n                    transform={`translate(0,${i * 25})`}\n                    // the following line is a special case for pujiang line\n                    // where its pass line color should be white with outline\n                    // surrounding it, see #161 for details.\n                    filter={theme[2] === '#999999' ? 'url(#pujiang_outline_railmap)' : undefined}\n                >\n                    <g>\n                        {paths[service]?.pass.map((path, j) => (\n                            <path\n                                key={j}\n                                stroke=\"var(--rmg-grey)\"\n                                strokeWidth={12}\n                                fill=\"none\"\n                                d={path}\n                                markerStart={props.direction === 'l' ? 'url(#arrow_gray)' : undefined}\n                                markerEnd={props.direction === 'r' ? 'url(#arrow_gray)' : undefined}\n                                strokeLinejoin=\"round\"\n                            />\n                        ))}\n                    </g>\n                    <g>\n                        {paths[service]?.main.map((path, j) => (\n                            <path\n                                key={j}\n                                stroke=\"var(--rmg-theme-colour)\"\n                                strokeWidth={12}\n                                fill=\"none\"\n                                d={path}\n                                markerStart={direction === 'l' ? 'url(#arrow_theme_left)' : undefined}\n                                markerEnd={direction === 'r' ? 'url(#arrow_theme_right)' : undefined}\n                                strokeLinejoin=\"round\"\n                                filter={service === Services.local ? undefined : `url(#contrast-${service})`}\n                            />\n                        ))}\n                    </g>\n                </g>\n            ))}\n        </>\n    );\n};\n\nexport const _linePath = (\n    stnIds: string[],\n    type: 'main' | 'pass',\n    xs: { [stnId: string]: number },\n    ys: { [stnId: string]: number },\n    direction: 'l' | 'r',\n    services: Services,\n    servicesMax: number,\n    stn_list: StationDict, // only used to determine startFromTerminal or endAtTerminal\n    bend: 'rightangle' | 'diagonal' = 'rightangle'\n) => {\n    var [prevY, prevX] = [] as number[];\n    var path: { [key: string]: number[] } = {};\n\n    const servicesDelta = {\n        local: 0,\n        express: 20,\n        direct: 40,\n    }[services]; // TODO: enum Services could be a better idea?\n    const servicesPassDelta = servicesMax > 1 ? 50 : 0;\n\n    // extra short line on either end\n    let e1 = 30;\n    // check if path starts from or ends at the terminal\n    // and change e1 to 0 if it matches\n    if (stnIds.length > 0) {\n        let startFromTerminal = false,\n            endAtTerminal = false;\n        if (stn_list[stnIds.at(-1) || 0].children.some(stnId => ['linestart', 'lineend'].includes(stnId))) {\n            endAtTerminal = true;\n        } else if (stn_list[stnIds.at(0) || 0].parents.some(stnId => ['linestart', 'lineend'].includes(stnId))) {\n            startFromTerminal = true;\n        }\n        e1 = startFromTerminal || endAtTerminal ? e1 : 0;\n    }\n\n    // diagonal use e2 to make soft line\n    const e2 = 30;\n\n    stnIds.forEach(stnId => {\n        var x = xs[stnId];\n        var y = ys[stnId];\n        if (!prevY && prevY !== 0) {\n            [prevX, prevY] = [x, y];\n            path['start'] = [x, y];\n            return;\n        }\n        if (y === 0) {\n            // merge back to main line\n            if (y !== prevY) {\n                path['bifurcate'] = [prevX, prevY];\n            }\n        } else {\n            // on the branch line\n            if (y !== prevY) {\n                path['bifurcate'] = [x, y];\n            }\n        }\n        path['end'] = [x, y];\n        [prevX, prevY] = [x, y];\n    });\n\n    // generate path\n    if (!path.hasOwnProperty('start')) {\n        // no line generated\n        // keys in path: none\n        return '';\n    } else if (!path.hasOwnProperty('end')) {\n        // little line (only beyond terminal station)\n        // keys in path: start\n        let [x, y] = path['start'];\n        if (type === 'main') {\n            // current at terminal(end) station, draw the litte main line\n            if (direction === 'l') {\n                return `M ${x - e1 - servicesDelta},${y} H ${x}`;\n            } else {\n                return `M ${x},${y} H ${x + e1 + servicesDelta}`;\n            }\n        } else {\n            // type === 'pass'\n            // current at terminal(start) station, draw the litte pass line\n            if (direction === 'l') {\n                return `M ${x},${y} L ${x + e1 + servicesPassDelta},${y}`;\n            } else {\n                return `M ${x - e1 - servicesPassDelta},${y} L ${x},${y}`;\n            }\n        }\n    } else if (!path.hasOwnProperty('bifurcate')) {\n        // general main line\n        // keys in path: start, end\n        let [x, y] = path['start'],\n            h = path['end'][0];\n        if (type === 'main') {\n            if (direction === 'l') {\n                return `M ${x - e1 - servicesDelta},${y} H ${h}`;\n            } else {\n                return `M ${x},${y} H ${h + e1 + servicesDelta}`;\n            }\n        } else {\n            // type === 'pass'\n            if (direction === 'l') {\n                return `M ${x - e1},${y} H ${h + e1 + servicesPassDelta}`;\n            } else {\n                return `M ${x - e1 - servicesPassDelta},${y} H ${h + e1}`;\n            }\n        }\n    } else {\n        // main line bifurcate here to become the branch line\n        // and path return here are only branch line\n        // keys in path: start, bifurcate, end\n        // TODO: make diagonal available to `sh`\n\n        let [x, y] = path['start'];\n        let xb = path['bifurcate'][0];\n        let [xm, ym] = path['end'];\n        if (type === 'main') {\n            if (direction === 'l') {\n                if (ym > y) {\n                    console.log(path);\n                    // main line, left direction, center to upper\n                    if (bend === 'rightangle') return `M ${x - e1},${y} H ${xm} V ${ym}`;\n                    // center to upper/rightangle, lower to center/diagonal\n                    else return `M ${x},${y} H ${x + e2} L ${xb - e2},${ym} H ${xm}`;\n                } else {\n                    // wrong marker\n                    // main line, left direction, upper to center\n                    if (bend === 'rightangle') return `M ${x},${y} V ${ym} H ${xm}`;\n                    // upper to center/rightangle, center to lower/diagonal\n                    else return `M ${x - e1},${y} H ${xb + e2} L ${xm - e2},${ym} H ${xm}`;\n                }\n            } else {\n                if (ym > y) {\n                    // wrong marker\n                    // main line, right direction, upper to center\n                    if (bend === 'rightangle') return `M ${x},${y} H ${xm} V ${ym}`;\n                    // upper to center/rightangle, center to lower/diagonal\n                    else return `M ${x},${y} H ${x + e2} L ${xb - e2},${ym} H ${xm + e1}`;\n                } else {\n                    // main line, right direction, center to upper\n                    if (bend === 'rightangle') return `M ${x},${y} V ${ym} H ${xm + e1}`;\n                    // center to upper/rightangle, lower to center/diagonal\n                    else return `M ${x},${y} H ${xb + e2} L ${xm - e2},${ym} H ${xm}`;\n                }\n            }\n        } else {\n            // type === 'pass'\n            if (direction === 'l') {\n                if (ym > y) {\n                    // pass line, left direction, center to upper\n                    if (bend === 'rightangle') return `M ${x - e1},${y} H ${xm} V ${ym}`;\n                    // center to upper/rightangle, lower to center/diagonal\n                    else return `M ${x},${y} H ${x + e2} L ${xb - e2},${ym} H ${xm + e1}`;\n                } else {\n                    // pass line, left direction, upper to center\n                    if (bend === 'rightangle') return `M ${x},${y} V ${ym} H ${xm + e1}`;\n                    // upper to center/rightangle, center to lower/diagonal\n                    else return `M ${x - e1},${y} H ${xb + e2} L ${xm - e2},${ym} H ${xm}`;\n                }\n            } else {\n                if (ym > y) {\n                    // pass line, right direction, upper to center\n                    if (bend === 'rightangle') return `M ${x - e1},${y} H ${xm} V ${ym}`;\n                    // upper to center/rightangle, center to lower/diagonal\n                    return `M ${x},${y} H ${x + e2} L ${xb - e2},${ym} H ${xm + e1}`;\n                } else {\n                    // pass line, right direction, center to upper\n                    if (bend === 'rightangle') return `M ${x},${y} V ${ym} H ${xm + e1}`;\n                    // center to upper/rightangle, lower to center/diagonal\n                    return `M ${x - e1},${y} H ${xb + e2} L ${xm - e2},${ym} H ${xm}`;\n                }\n            }\n        }\n    }\n};\n\nexport interface StationGroupProps {\n    stnIds: string[];\n    xs: { [stnId: string]: number };\n    ys: { [stnId: string]: number };\n    stnStates: { [stnId: string]: -1 | 0 | 1 };\n}\n\nconst StationGroup = (props: StationGroupProps) => {\n    const { xs, ys, stnStates, stnIds } = props;\n\n    return (\n        <g>\n            {stnIds.map(stnId => (\n                <g key={stnId} transform={`translate(${xs[stnId]},${ys[stnId]})`}>\n                    <StationSHMetro stnId={stnId} stnState={stnStates[stnId]} />\n                </g>\n            ))}\n        </g>\n    );\n};\n\nconst ServicesElements = (props: { servicesLevel: Services[]; lineXs: number[] }) => {\n    const { svg_height, direction, svgWidth } = useAppSelector(store => store.param);\n    const dy = -svg_height * (0.5 + 0.1);\n\n    if (props.servicesLevel.length === 1) return <></>;\n\n    const servicesLevel = props.servicesLevel.map(\n        service =>\n            ({\n                local: '普通车',\n                express: '大站车',\n                direct: '直达车',\n            }[service])\n    );\n\n    // let dx = props.direction === 'r' ? 5 : param.svgWidth.railmap - 55;\n    const labelX = direction === 'r' ? props.lineXs[0] - 42 : props.lineXs[1] + 42;\n\n    let dx_hint = props.servicesLevel.length === 2 ? 350 : 500;\n\n    return (\n        <g>\n            {servicesLevel.map((service, i) => (\n                <g key={service} transform={`translate(${labelX},${i * 25})`}>\n                    <rect x={-27.5} height={10} width={55} fill={'white'} stroke={'black'} y={-5}></rect>\n                    <text className=\"rmg-name__zh\" fontSize={9} y={3} textAnchor=\"middle\">{`${service}运行线`}</text>\n                </g>\n            ))}\n            <g transform={`translate(${direction === 'r' ? 30 : svgWidth.railmap - dx_hint},${dy})`}>\n                <text className=\"rmg-name__zh\">图例：</text>\n                {servicesLevel.map((serviceLevel, i) => (\n                    <g key={`serviceLevel${i}`} transform={`translate(${i * 150 + 50},0)`}>\n                        <line\n                            x1=\"0\"\n                            x2=\"35\"\n                            y1=\"-5\"\n                            y2=\"-5\"\n                            stroke=\"var(--rmg-theme-colour)\"\n                            strokeWidth=\"12\"\n                            filter={i === 2 ? 'url(#contrast-direct)' : i === 1 ? 'url(#contrast-express)' : ''}\n                        />\n                        <use x=\"17.5\" y=\"-5\" xlinkHref=\"#stn_sh\" fill=\"var(--rmg-theme-colour)\" />\n                        <text x=\"40\" className=\"rmg-name__zh\">{`${serviceLevel}停靠站`}</text>\n                    </g>\n                ))}\n            </g>\n        </g>\n    );\n};\n\nexport const DirectionElements = () => {\n    const { direction, svgWidth, svg_height, loop } = useAppSelector(store => store.param);\n\n    return React.useMemo(\n        () => (\n            <g\n                transform={`translate(${direction === 'l' ? 50 : svgWidth.railmap - 150},${\n                    loop ? svg_height - 30 : 50\n                })`}\n            >\n                <text className=\"rmg-name__zh\">列车前进方向</text>\n                <path\n                    d=\"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z\"\n                    fill=\"var(--rmg-theme-colour)\"\n                    transform={`translate(${direction === 'l' ? -30 : 125},-5)rotate(${\n                        direction === 'l' ? 0 : 180\n                    })scale(0.15)`}\n                />\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [direction, svgWidth.railmap, svg_height]\n    );\n};\n","import * as React from 'react';\nimport MainSHMetro, { DirectionElements } from './main/main-shmetro';\nimport LoopSHMetro from './main/loop/loop-shmetro';\nimport { useAppSelector } from '../../redux';\n\nconst RailMapSHMetro = React.memo(() => {\n    const { loop } = useAppSelector(store => store.param);\n    return (\n        <>\n            <DefsSHMetro />\n\n            {loop ? <LoopSHMetro bank_angle={true} /> : <MainSHMetro />}\n\n            <DirectionElements />\n        </>\n    );\n});\n\nexport default RailMapSHMetro;\n\nconst DefsSHMetro = React.memo(() => (\n    <defs>\n        <circle id=\"stn_sh\" fill=\"var(--rmg-white)\" strokeWidth={0} r={5} />\n        <path id=\"int2_sh\" fill=\"var(--rmg-white)\" strokeWidth={2} d=\"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z\" />\n        <path\n            id=\"direct_sh\"\n            fill=\"var(--rmg-white)\"\n            strokeWidth={2}\n            d=\"M -5,0 a 5,5 0 1 1 10,0 V50 a 5,5 0 1 1 -10,0Z\"\n        />\n        <rect id=\"stn_sh_2020\" stroke=\"none\" height={24} width={12} x={-6} y={-18} />\n        <rect id=\"stn_sh_2020_express\" stroke=\"none\" height={49} width={12} x={-6} y={-18} />\n        <rect id=\"stn_sh_2020_direct\" stroke=\"none\" height={74} width={12} x={-6} y={-18} />\n\n        <rect id=\"intbox_number\" height={22} width={20} y={-11} />\n\n        <g id=\"airport\" transform=\"scale(0.5)\">\n            <circle cx=\"0\" cy=\"29.33899\" r=\"29.33899\" fill=\"var(--rmg-grey)\" />\n            <path\n                id=\"airport\"\n                d=\"M28.9769,6.60134c1.711.013,3.111,2.53205,3.111,4.241v10.337s17.106,15.435,17.358,15.666a1.145,1.145,0,0,1,.488,1.152v2.833c0,.651-.451.61-.695.467-.334-.119-17.151-8.863-17.151-8.863-.004,1.458-.797,9.006-1.326,13.304,0,0,4.61,2.457,4.699,2.521.334.268.352.359.352.852v2.001c0,.477-.352.428-.51.324-.183-.062-5.693-1.921-5.693-1.921a2.56018,2.56018,0,0,0-.633-.127,2.31654,2.31654,0,0,0-.666.127s-5.477,1.859-5.672,1.921c-.185.104-.523.153-.523-.324v-2.001c0-.493.029-.584.367-.852.086-.064,4.678-2.521,4.678-2.521-.524-4.298-1.307-11.846-1.325-13.304,0,0-16.822,8.744-17.148,8.863-.217.143-.69.184-.69-.467v-2.833a1.16206,1.16206,0,0,1,.473-1.152c.276-.231,17.365-15.666,17.365-15.666v-10.337c0-1.709,1.403-4.228,3.14105-4.241\"\n                transform=\"translate(-28.9697,0.14347)\"\n                fill=\"var(--rmg-white)\"\n            />\n        </g>\n        <g id=\"disney\" transform=\"scale(0.5)\">\n            <circle cx=\"0\" cy=\"29.33899\" r=\"29.33899\" fill=\"var(--rmg-grey)\" />\n            <path\n                fill=\"var(--rmg-white)\"\n                d=\"M45.6152,7.85015a9.80248,9.80248,0,0,0-9.79907,9.801,9.70059,9.70059,0,0,0,.342,2.582c.002.026.002.055.002.093a.31815.31815,0,0,1-.31494.318.67741.67741,0,0,1-.12806-.02,15.71521,15.71521,0,0,0-13.498,0,.61.61,0,0,1-.122.02.31841.31841,0,0,1-.322-.318v-.067a9.62553,9.62553,0,0,0,.35608-2.608,9.803,9.803,0,1,0-9.797,9.8,10.10364,10.10364,0,0,0,2.308-.271h.05493a.31113.31113,0,0,1,.31409.318.32433.32433,0,0,1-.019.12,15.72588,15.72588,0,1,0,29.703,7.216,15.83676,15.83676,0,0,0-1.746-7.23.18417.18417,0,0,1-.0271-.106.31612.31612,0,0,1,.32007-.318h.057a10.15953,10.15953,0,0,0,2.316.271,9.80051,9.80051,0,0,0,0-19.601\"\n                transform=\"translate(-28.9697 0.13398)\"\n            />\n        </g>\n        {/* Special thanks to Wikimedia Commons, see https://commons.wikimedia.org/wiki/File:China_Railways.svg */}\n        <g id=\"railway\">\n            <circle cx=\"0\" cy=\"29.33899\" r=\"29.33899\" fill=\"var(--rmg-grey)\" transform=\"translate(0,-2)scale(0.5)\" />\n            <path\n                fill=\"var(--rmg-white)\"\n                d=\"M169,273.5c0-19,14.7-34.8,33.7-36.3c18.9-1.5,38.1-2.2,57.4-2.2c19.3,0,38.4,0.8,57.3,2.2  c19,1.5,33.7,17.3,33.7,36.3v47.3l-51.3,14.7c-11.2,3.2-18.9,13.4-18.9,25v147.8c0,17.4,12.2,32.3,29.3,35.7l110.6,22.1  c4.9,1,8.4,5.2,8.4,10.2V599H91v-22.7c0-5,3.5-9.2,8.4-10.2L209.9,544c17-3.4,29.3-18.3,29.3-35.7V360.5c0-11.6-7.7-21.8-18.9-25  L169,320.8V273.5z M309.4,31.7c0.2-1.2,0.3-2.4,0.3-3.6c0-14-11.1-25.4-24.9-26C276.6,1.4,268.3,1,260,1c-8.3,0-16.6,0.4-24.7,1.1  c-13.9,0.6-24.9,12-24.9,26c0,1.2,0.1,2.5,0.3,3.6C90.6,54.8,0,160.3,0,287c0,97.2,53.4,182,132.4,226.6l36.8-48.1  C104.3,432.4,59.8,364.9,59.8,287c0-110.6,89.6-200.2,200.2-200.2S460.2,176.4,460.2,287c0,77.9-44.5,145.4-109.4,178.5  c15,19.6,25.6,33.5,36.8,48.1C466.6,469,520,384.2,520,287C520,160.3,429.4,54.8,309.4,31.7z\"\n                transform=\"translate(-10,0)scale(0.04)\"\n            />\n        </g>\n\n        {/* An extension of the line/path. Remember to minus the stroke-width.  */}\n        <marker id=\"arrow_gray\" viewBox=\"-1.5 0 3 1.5\" refY={0.5}>\n            <path d=\"M0,0L1,1H-1z\" fill=\"var(--rmg-grey)\" />\n        </marker>\n        <marker id=\"arrow_theme_left\" refX={1} refY={0.5}>\n            <path d=\"M1,0L0,1H1z\" fill=\"var(--rmg-theme-colour)\" />\n        </marker>\n        <marker id=\"arrow_theme_right\" refY={0.5}>\n            <path d=\"M0,0L1,1H-1z\" fill=\"var(--rmg-theme-colour)\" />\n        </marker>\n\n        {/* Contrast filters for lines. */}\n        <filter id=\"contrast-direct\" filterUnits=\"userSpaceOnUse\">\n            <feComponentTransfer>\n                <feFuncR type=\"linear\" slope={0.5} intercept={0.25} />\n                <feFuncG type=\"linear\" slope={0.5} intercept={0.25} />\n                <feFuncB type=\"linear\" slope={0.5} intercept={0.25} />\n            </feComponentTransfer>\n        </filter>\n        <filter id=\"contrast-express\" filterUnits=\"userSpaceOnUse\">\n            <feComponentTransfer>\n                <feFuncR type=\"linear\" slope={0.75} intercept={0.125} />\n                <feFuncG type=\"linear\" slope={0.75} intercept={0.125} />\n                <feFuncB type=\"linear\" slope={0.75} intercept={0.125} />\n            </feComponentTransfer>\n        </filter>\n\n        <filter\n            id=\"pujiang_outline_railmap\"\n            colorInterpolationFilters=\"sRGB\"\n            // TODO: remove the absolute value while make the filter works correctly\n            filterUnits=\"userSpaceOnUse\"\n            x=\"0\"\n            y=\"-1000\"\n            width=\"5000\"\n            height=\"2000\"\n        >\n            {/* Replace pass gray color with white.\n                https://stackoverflow.com/questions/41639049/replace-one-color-using-svg-filters */}\n            <feComponentTransfer in=\"SourceGraphic\">\n                <feFuncR\n                    type=\"discrete\"\n                    tableValues=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\"\n                />\n                <feFuncG\n                    type=\"discrete\"\n                    tableValues=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\"\n                />\n                <feFuncB\n                    type=\"discrete\"\n                    tableValues=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\"\n                />\n            </feComponentTransfer>\n            <feColorMatrix\n                type=\"matrix\"\n                values=\"1 0 0 0 0\n                                                 0 1 0 0 0\n                                                 0 0 1 0 0\n                                                 1 1 1 1 -3\"\n                result=\"selectedColor1\"\n            />\n\n            {/* Draw an outline line around the pass line.\n                https://stackoverflow.com/questions/49693471/svg-border-outline-for-group-of-elements\n                Also see #181 why we do not simply outline the pass line element. */}\n            <feMorphology operator=\"erode\" in=\"selectedColor1\" radius=\"0\" result=\"e1\" />\n            <feMorphology operator=\"erode\" in=\"selectedColor1\" radius=\"1\" result=\"e2\" />\n            <feComposite in=\"e1\" in2=\"e2\" operator=\"xor\" result=\"uncoloredOutline\" />\n            {/* As the pass line is colored in white, we need to recolor the outline with black. */}\n            <feFlood floodColor=\"rgb(0,0,0)\" />\n            <feComposite operator=\"in\" in2=\"uncoloredOutline\" result=\"outline\" />\n            {/* Put the outline on the white not gray pass line. */}\n            <feComposite in=\"outline\" in2=\"selectedColor1\" operator=\"over\" result=\"result\" />\n            {/* Put the white pass line with outline on the original line. */}\n            <feComposite in=\"result\" in2=\"SourceGraphic\" operator=\"over\" />\n        </filter>\n    </defs>\n));\n"],"names":["calculateColineStations","colineInfo","branches","map","coLine","involvedBranches","filter","branch","includes","from","to","length","linePath","colors","flat","a","indexOf","b","slice","branchWithColine","calculateColine","stnStates","linePaths","drawLine","main","pass","reduce","acc","cur","defaultTheme","props","xs","servicesPresent","useAppSelector","store","param","direction","stn_list","current_stn_idx","branch_spacing","info_panel_type","coline","helper","deps","depsStr","yShares","React","console","log","Object","keys","branchOfStn","children","colineYShares","entries","k","v","colineYs","colineStns","co","display","JSON","stringify","colinePaths","service","colineStn","path","_linePath","colineStations","COLINE_GAP","id","transform","CoLine","paths","ColineStationInMainLine","ys","lineWidth","colineGap","ColineStationGroup","stnIds","stnId","services","i","colinePath","j","stroke","strokeWidth","fill","d","strokeLinejoin","Services","undefined","y1","y2","x1","x2","gradientUnits","color","offset","stopColor","c","join","refY","refX","at","markerStart","markerEnd","LINE_WIDTH","line_name","theme","stns","curStn","x","y","find","concat","stn","colineStation","height","dy","width","xlinkHref","colines","stnState","routes","adjMat","adjacencyList","criticalPath","criticalPathMethod","realCP","nodes","xShares","getXShareMTR","toString","lineXs","svgWidth","railmap","padding","len","lineYShares","lineYs","getStnState","servicesAll","values","stationInfo","bool","s","push","svg_height","Line","StationGroup","ServicesElements","servicesLevel","type","servicesMax","bend","prevY","prevX","servicesDelta","local","express","direct","servicesPassDelta","e1","startFromTerminal","endAtTerminal","some","parents","e2","forEach","hasOwnProperty","xb","xm","ym","h","labelX","dx_hint","className","fontSize","textAnchor","serviceLevel","DirectionElements","loop","DefsSHMetro","bank_angle","r","cx","cy","viewBox","filterUnits","slope","intercept","colorInterpolationFilters","in","tableValues","result","operator","radius","in2","floodColor"],"sourceRoot":""}