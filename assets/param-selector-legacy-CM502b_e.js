System.register(["./index-legacy-CC1CGO29.js","./chakra-legacy-CKMkCx0v.js","./react-legacy-wexXEtdT.js"],(function(e,t){"use strict";var n,i,s,a,r,o,l,c,d,h,g,u,p,f,_,m,y,b,v,j,x,w,O,A,C,D,R,M,S,N,P,T,k,W,E;return{setters:[e=>{n=e.j,i=e.ah,s=e.aT,a=e.aU,r=e.ag,o=e.e,l=e.aa,c=e.aV,d=e.aR,h=e.aW,g=e.r,u=e.h,p=e.aL,f=e.aX,_=e.aY,m=e.l},e=>{y=e.u,b=e.j,v=e.c,j=e.h,x=e.aC,w=e.aj,O=e.M,A=e.ak,C=e.J,D=e.K,R=e.L,M=e.O,S=e.t,N=e.B,P=e.s,T=e.a2,k=e.N},e=>{W=e.a,E=e.u}],execute:function(){e({P:function(e){const{paramRegistry:t,downloading:n,selectedParam:i,onParamSelect:s,onParamRemove:a,onParamUpdate:r}=e,{t:o}=E(),[l,c]=W.useState();return b.jsxs(N,{sx:X,children:[b.jsxs(j,{children:[n&&b.jsx(f,{variant:"ghost",primaryText:o("Downloading")+"...",secondaryText:n,isDisabled:!0}),t.slice().sort(((e,t)=>(t.lastModified??0)-(e.lastModified??0))).map((e=>b.jsxs(P,{size:"sm",isAttached:!0,colorScheme:i===e.id?"primary":void 0,variant:i===e.id?"solid":"ghost",children:[b.jsx(f,{primaryText:e.name??o("Project")+" "+e.id,secondaryText:o("Last modified")+": "+L(e.lastModified).map((e=>o(e))).join(" "),"aria-pressed":i===e.id,onClick:()=>s(e.id)}),r&&b.jsx(T,{"aria-label":o("Edit project info"),title:o("Edit project info"),icon:b.jsx(_,{}),onClick:()=>c(e)}),a&&b.jsx(T,{"aria-label":o("Remove project"),title:o("Remove project"),icon:b.jsx(m,{}),onClick:()=>a(e.id)})]},e.id)))]}),t.length>=10&&b.jsx(k,{as:"em",fontSize:"xs",children:o("You have reached the maximum number of projects.")}),b.jsx(H,{config:l,onClose:()=>c(void 0),onUpdate:e=>{r?.(e),c(void 0)}})]})},R:I});var t=function(e){var t=e.children,n=e.noWrap,i=y("RmgOutput",{noWrap:n});return b.jsx(v.output,{sx:i,children:t})};function I(e){var o=e.fields,l=e.noLabel,c=e.minW;return b.jsx(j,{wrap:"wrap",children:o.map((function(e,o){if(e.hidden)return b.jsx(W.Fragment,{},o);var d=e.minW||c,h="full"===d;return b.jsx(n,{className:h?"mw-full":"",label:e.label,flex:h?void 0:1,minW:h?void 0:d,noLabel:l,oneLine:e.oneLine,helper:e.helper,errorMessage:e.errorMessage,children:function(e){switch(e.type){case"input":return b.jsx(r,{placeholder:e.placeholder,defaultValue:e.value,type:e.variant,validator:e.validator,onDebouncedChange:e.onChange,delay:e.debouncedDelay,optionList:e.optionList,isDisabled:e.isDisabled});case"output":return b.jsx(t,{noWrap:e.noWrap,children:e.value});case"textarea":return b.jsx(a,{placeholder:e.placeholder,defaultValue:e.value,onDebouncedChange:e.onChange,isDisabled:e.isDisabled});case"slider":return b.jsx(s,{defaultValue:e.value,min:e.min,max:e.max,step:e.step,onThrottledChange:e.onChange,leftIcon:e.leftIcon,rightIcon:e.rightIcon,isDisabled:e.isDisabled});case"select":return b.jsx(i,{defaultValue:e.value,onChange:function(t){var n,i=t.target.value;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,"number"==typeof e.value?Number(i):i.toString())},options:e.options,disabledOptions:e.disabledOptions,isInvalid:e.isInvalid,isDisabled:e.isDisabled});case"switch":return b.jsx(x,{isChecked:e.isChecked,isDisabled:e.isDisabled,onChange:function(t){var n,i=t.target.checked;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,i)}});case"custom":return e.component;default:return b.jsx("div",{})}}(e)},o)}))})}e("a",((e,t,n)=>{const i=new Blob([n],{type:t});z(e,i)}));const z=e("d",((e,t)=>{const n=window.URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)})),L=(e("r",(e=>new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsText(e)})))),e("i",(()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))),e=>{if(e){const t=(new Date).getTime()-e;return t<6e4?["Just now"]:t<12e4?["1","minute ago"]:t<36e5?[Math.floor(t/1e3/60).toString(),"minutes ago"]:t<72e5?["1","hour ago"]:t<864e5?[Math.floor(t/1e3/60/60).toString(),"hours ago"]:t<1728e5?["1","day ago"]:[Math.floor(t/1e3/60/60/24).toString(),"days ago"]}return["Unknown"]}),F=(e("w",(e=>new Promise((t=>{setTimeout(t,e)})))),e("u",(e=>{"line_name"in e||(e.line_name=["路線名","Name of Line"]),delete e.fontZH,delete e.fontEN,delete e.weightZH,delete e.weightEN;for(const[t,n]of Object.entries(e.stn_list))"branch"in n||(e.stn_list[t].branch={},2===n.children.length&&(e.stn_list[t].branch.right=["through",n.children[1]]),2===n.parents.length&&(e.stn_list[t].branch.left=["through",n.parents[1]]),0===Object.keys(e.stn_list[t].branch).length&&delete e.stn_list[t].branch);e.psd_num="psd_num"in e?e.psd_num.toString():"1","line_num"in e||(e.line_num="1"),3===e.theme.length&&e.theme.push("#fff");for(const[t,n]of Object.entries(e.stn_list))"num"in n||(e.stn_list[t].num="00"),"interchange"in n&&n.interchange.map((e=>e.forEach((e=>{5===e.length&&e.splice(3,0,"#fff")}))));for(const[t,n]of Object.entries(e.stn_list))"osi22_end_p"===n.change_type&&(e.stn_list[t].change_type="osi22_pr"),"osi22_end_u"===n.change_type&&(e.stn_list[t].change_type="osi22_ur");for(const[t,n]of Object.entries(e.stn_list))"interchange"in n||(e.stn_list[t].interchange=[[]]);e.info_panel_type="info_panel_type"in e?(e=>{switch(e){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return e}})(e.info_panel_type):"gz28","direction_gz_x"in e||(e.direction_gz_x=50),"direction_gz_y"in e||(e.direction_gz_y=70);for(const[t,n]of Object.entries(e.stn_list))"transfer"in n||(e.stn_list[t].transfer={tick_direc:"none"===n.change_type||"int2"===n.change_type?"r":n.change_type?.split("_")[1].split("").slice().reverse()[0],paid_area:-1===n.change_type?.indexOf("osi")||"p"===n.change_type?.split("_")[1][0],osi_names:-1!==n.change_type?.indexOf("osi")?[n.interchange[1][0]]:[],info:2===n.interchange.length?[n.interchange[0],n.interchange[1].slice(1)]:n.interchange}),delete e.stn_list[t].change_type,delete e.stn_list[t].interchange;for(const[t,n]of Object.entries(e.stn_list))"services"in n||(e.stn_list[t].services=["local"]),"facility"in n?""===n.facility&&(e.stn_list[t].facility=void 0):e.stn_list[t].facility=n.usage||void 0,delete e.stn_list[t].usage;"customiseMTRDest"in e||(e.customiseMTRDest={isLegacy:e.dest_legacy||!1,terminal:!1}),delete e.dest_legacy,"svgWidth"in e||(e.svgWidth={destination:e.svg_dest_width,runin:e.svg_dest_width,railmap:e.svg_width,indoor:e.svg_width}),"indoor"in e.svgWidth||(e.svgWidth.indoor=e.svgWidth.railmap),delete e.svg_width,delete e.svg_dest_width,e.notesGZMTR=e.notesGZMTR?.map((e=>4===e.length?e.concat([!1]):e)),delete e.char_form,delete e.show_outer,delete e.strip_pc,delete e.txt_bg_gap,"namePosMTR"in e||(e.namePosMTR={isStagger:!0,isFlip:e.txt_flip}),delete e.txt_flip,Object.keys(e.stn_list).forEach((t=>{"secondaryName"in e.stn_list[t]&&!1===e.stn_list[t].secondaryName&&delete e.stn_list[t].secondaryName,"type"in e.stn_list[t].transfer&&delete e.stn_list[t].transfer.type})),e.style=void 0!==e.style&&Object.values(o).includes(e.style)?e.style:o.MTR,e.coline=e.coline??[],e.loop=e.loop??!1,e.loop_info=void 0===e.loop_info?{bank:!0,left_and_right_factor:0,bottom_factor:1}:{...e.loop_info,bottom_factor:Math.max(e.loop_info.bottom_factor,1)};for(const[t,n]of Object.entries(e.stn_list))"loop_pivot"in n||(e.stn_list[t].loop_pivot=!1);return Array.isArray(e.coline)&&(e.coline=e.coline.reduce(((e,t)=>({...e,[l(4)]:t})),{})),!1===e.platform_num&&(e.platform_num=""),Object.values(e.stn_list).forEach((t=>{const n=t;n.one_line=n.one_line??!1,n.int_padding=n.int_padding??(e.loop?250:355)})),void 0===e.branchSpacingPct&&(e.style===o.SHMetro?e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*300):e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*200),delete e.branch_spacing),F(e),$(e),U(e),G(e),e})),e=>{for(const[t,n]of Object.entries(e.stn_list)){const i=n.transfer.info;i&&(e.stn_list[t].transfer.groups=i.map(((e,t)=>e.length?{name:n.transfer.osi_names[t-1],lines:e.map((e=>{const t=e;return{theme:t.slice(0,4),name:t.slice(4,6)}}))}:{lines:[]}))),delete e.stn_list[t].transfer.info,delete e.stn_list[t].transfer.osi_names}}),$=e=>{for(const[t,n]of Object.entries(e.stn_list)){const{name:i,secondaryName:s,localisedName:a,localisedSecondaryName:r}=n;!a&&i&&(e.stn_list[t].localisedName={zh:i[0],en:i[1]},delete e.stn_list[t].name),!r&&s&&(e.stn_list[t].localisedSecondaryName={zh:s[0],en:s[1]},delete e.stn_list[t].secondaryName)}},U=e=>{const{svgWidth:t}=e;c.Platform in t||(e.svgWidth.platform=1200);for(const[n,i]of Object.entries(e.stn_list)){const{character_spacing:t}=i;void 0===t&&(e.stn_list[n].character_spacing=75)}},Y=e=>4===e.length&&e.every((e=>"string"==typeof e))&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(u).includes(e[3]),B=(e,t,n)=>{const i=t.split(".");let s=e;for(let a=0;a<i.length-1;a++)s=s[i[a]];s[i[i.length-1]]=n},J=(e("f",(async e=>{const t=(new Date).getTime(),n=(e=>{const t=[],n=(e,i)=>{if(Array.isArray(e)&&Y(e))t.push({path:i||"",value:e});else for(const s in e){const a=e[s],r=i?`${i}.${s}`:s;Array.isArray(a)?Y(a)?t.push({path:r,value:a}):a.forEach(((e,t)=>n(e,`${r}.${t}`))):a&&"object"==typeof a&&n(a,r)}};return n(e),t})(e);d.info("Found all themes pending for update",n);const i=JSON.parse(JSON.stringify(e));let s,a=!1;const r=new Promise(((e,t)=>{s=setTimeout((()=>{a=!0,t("Executing time exceeds 5000ms")}),5e3),(async()=>{for(const{path:e,value:t}of n){if(a)throw new Error("Update aborted");const n=await h(t);B(i,e,n)}})().then(e).catch(t)}));try{return await r,d.info(`Themes update completed, elapsed time ${((new Date).getTime()-t)/1e3} sec`),i}catch(o){return d.warn(`Error occurs when updating themes, elapsed time ${((new Date).getTime()-t)/1e3} sec`,o),i}finally{clearTimeout(s)}})),{notesGZMTR:e=>!e?.length,"stn_list.*.branch.left":e=>!e?.length,"stn_list.*.branch.right":e=>!e?.length,"stn_list.*.branch":e=>!e||0===Object.keys(e).length,"stn_list.*.facility":e=>!e,"stn_list.*.transfer.groups.*.lines":e=>!e?.length}),G=e("s",(e=>{const t=structuredClone(e);return Object.entries(J).forEach((([e,n])=>{Object.entries(((e,t)=>{const n={},i=(e,t,s)=>{let a=e;for(let n=0;n<s.length-1;n++){if("*"===s[n])return void Object.keys(a).forEach((e=>i(a,[...t,...s.slice(0,n)],[e,...s.slice(n+1)])));if(a=a?.[s[n]],void 0===a)return}const r=a?.[s[s.length-1]];void 0!==r&&(n[[...t,...s].join(".")]=a?.[s[s.length-1]])};return i(e,[],t.split(".")),n})(t,e)).forEach((([e,i])=>{d.debug("Sanitising",e,i),n(i)&&B(t,e,void 0)}))})),t.version=g.getAppVersion(),t})),V=(e("c",(()=>{const e=(()=>{const e=`${g.getAppName()}__${p.PARAM_CONFIG_BY_ID}`,t=Object.entries(g.storage.getAll()).filter((([t])=>t.startsWith(e))).map((([t,n])=>{const i=t.slice(e.length);if(!n)return{id:i};try{return{...JSON.parse(n),id:i}}catch{return{id:i}}}));return d.info("loadParamRegistry(), Found param config in localStorage",t.map((e=>e.id))),t})(),t=`${g.getAppName()}__${p.PARAM_BY_ID}`,n=Object.keys(g.storage.getAll()).filter((e=>e.startsWith(t))).map((n=>{const i=n.slice(t.length);return e.find((e=>e.id===i))??{id:i}}));return d.info("getParamRegistry(), Actual param found in localStorage",n.map((e=>e.id))),e.filter((e=>n.every((t=>t.id!==e.id)))).forEach((e=>g.storage.remove(p.PARAM_CONFIG_BY_ID+e.id))),n})),e("g",(e=>{const t=g.storage.get(p.PARAM_CONFIG_BY_ID+e);return t?JSON.parse(t):t}))),Z=(e("e",(e=>{const t=g.storage.get(p.PARAM_BY_ID+e);return{param:t?JSON.parse(t):t,config:V(e)}})),e("b",((e,t)=>{const n=l();return g.storage.set(p.PARAM_BY_ID+n,e),g.storage.set(p.PARAM_CONFIG_BY_ID+n,JSON.stringify({name:t,lastModified:Date.now()})),n})));function H(e){const{config:t,onClose:n,onUpdate:i}=e,{t:s}=E(),[a,r]=W.useState(t?.name??"");W.useEffect((()=>{t&&r(t.name??"")}),[t]);const o=[{type:"input",label:s("Project name"),value:a,onChange:r,debouncedDelay:0}];return b.jsxs(w,{isOpen:!!t,onClose:n,isCentered:!0,children:[b.jsx(O,{}),b.jsxs(A,{children:[b.jsx(C,{children:s("Edit project info")}),b.jsx(D,{}),b.jsx(R,{children:b.jsx(I,{fields:o})}),b.jsx(M,{children:b.jsx(S,{colorScheme:"primary",onClick:()=>{t&&(t.name??"")!==a&&i({...t,name:a})},children:s("Confirm")})})]})]})}e("h",(async e=>{const t=e.split("/").at(-1);try{const n=await fetch(e);if(n.ok){const e=await n.text();return Z(e,t)}return d.warn("Failed to download param"),null}catch(n){return d.warn("Failed to download param.",n),null}}));const X={flex:"2 1 0%",overflow:"hidden",minW:{base:"unset",md:240},w:{base:"100%",md:"unset"},mr:{base:0,md:2},mb:{base:2,md:0},"& > div":{flexDirection:"column",h:200,overflowX:"hidden",overflowY:"auto",borderRadius:"md",borderWidth:2,"& >.chakra-button":{alignItems:"center"},"& .chakra-button__group":{"& button:not(:first-of-type)":{h:"100%"}}}}}}}));
