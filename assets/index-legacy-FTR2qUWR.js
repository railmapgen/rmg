System.register(["./chakra-legacy-CKMkCx0v.js","./react-legacy-wexXEtdT.js","./index-legacy-BPFmzidd.js","./share-legacy-DJmAN5v5.js","./svg-wrapper-legacy-CiB8PbTd.js","./param-selector-legacy-CSlYO1g1.js"],(function(e,t){"use strict";var n,r,a,s,o,i,l,c,h,d,m,u,f,x,g;return{setters:[e=>{n=e.j},e=>{r=e.a},e=>{a=e.h,s=e.P,o=e.b0,i=e.u,l=e.m,c=e.S,h=e.aV},e=>{d=e.a,m=e.c,u=e.b,f=e.d},e=>{x=e.S},e=>{g=e.i}],execute:function(){function t(e){const{num:t,inStrip:r,showAsPlatformDoor:s,...o}=e;return n.jsxs("g",{textAnchor:"middle",fill:r?a.black:"var(--rmg-theme-fg)",...o,children:[n.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:r?"#fff":"var(--rmg-theme-colour)"}),n.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),s?n.jsxs(n.Fragment,{children:[n.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),n.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):n.jsxs(n.Fragment,{children:[n.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),n.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]})}const p=e=>{const t=(e=>{switch(e){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(e.variant),a=r.useMemo((()=>{switch(e.variant){case"gz1":return n.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return n.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return n.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return n.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return n.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return n.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return n.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return n.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return n.jsx(n.Fragment,{})}}),[e.variant]);return n.jsxs("g",{transform:`translate(0,${"gz4"===e.variant?-15:0})`,style:{"--strip-height":`${t}px`},children:[n.jsx("rect",{id:"strip_gz"}),e.variant===s.gz1&&n.jsx("rect",{className:"gz1-gap"}),n.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:e.isShowLight&&a}),!1!==e.isShowPSD&&n.jsx(j,{...e})]})},j=r.memo((function(e){const r=["gz28","gz2otis","gz6","gzgf"].includes(e.variant),a=(e=>{switch(e){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(e.variant),o=(e=>{switch(e){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(e.variant),i=[s.gz1,s.gz3,s.gz4,s.gz5,s.gz1421,s.gz7w,s.gz11].includes(e.variant);return n.jsx(t,{num:e.isShowPSD,inStrip:r,showAsPlatformDoor:e.variant===s.gz11,style:{"--psd-dy":a,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":i?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":o}})}),((e,t)=>e.variant===t.variant&&e.isShowPSD===t.isShowPSD));var y=1.3,v=38.3,S=42,z=function(e,t){var n=[e,t].map((function(e){return e.match(/^(\w+).+$/)}));if(n[0]&&n[1]&&n[0][1]===n[1][1])return n[0][1]},_=function(e){var t=e.match(/^(\d+)\D+$/);return null==t?void 0:t[1]},w=function(){return w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},w.apply(this,arguments)},N=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function b(e){var t=e.customWidth,r=N(e,["customWidth"]),a=(null!=t?t:45)-45;return n.jsx("rect",w({x:-22.5-a/2,height:24,width:null!=t?t:45,rx:4.5},r,{"data-testid":"intBox"}))}var O=function(){return O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},O.apply(this,arguments)},k=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},$=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o};function B(e){var t=e.zhName,s=e.enName,o=e.foregroundColour,i=e.backgroundColour,l=e.zhClassName,c=e.enClassName,h=e.passed,d=e.children,m=k(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),u=function(e,t){var n=_(e);if(n)return{isDigit:!0,spanningPart:n};var r=z(e,t);return r?{isDigit:!1,spanningPart:r}:{isDigit:!1,spanningPart:""}}(t,s),f=u.isDigit,x=u.spanningPart,g=r.useRef(null),p=$(r.useState({x:0,height:0,width:0}),2),j=p[0],y=p[1];r.useEffect((function(){g.current&&y(g.current.getBBox())}),[t,s]);var v=S/Math.max(S,j.width),w=(-j.x-j.width/2)*v,N=j.height*(1-v)/2;return n.jsxs("g",O({textAnchor:"middle",fill:h?a.white:o},m,{children:[n.jsx(b,{fill:h?"#aaa":i}),n.jsx("g",{ref:g,transform:"translate(".concat(w,",").concat(N,")scale(").concat(v,")"),children:n.jsxs("text",{className:l,fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",children:[x,n.jsx("tspan",{className:l,fontSize:10,x:0,dy:-4,textAnchor:"start",dominantBaseline:"central",children:t.slice(x.length).trim()}),n.jsx("tspan",{className:c,fontSize:6.5,letterSpacing:-.1,x:0,dy:10,textAnchor:"start",dominantBaseline:"middle",children:f?s:s.slice(x.length).trim()})]})}),d]}))}var P=function(){return P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},P.apply(this,arguments)},C=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},M=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o};function R(e){var t,s=e.zhName,o=e.enName,i=e.foregroundColour,l=e.backgroundColour,c=e.zhClassName,h=e.enClassName,d=e.passed,m=e.children,u=C(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),f=null!==(t=_(s))&&void 0!==t?t:"",x=r.useRef(null),g=r.useRef(null),p=M(r.useState({width:0}),2),j=p[0],y=p[1],v=M(r.useState({width:0}),2),z=v[0],w=v[1];r.useEffect((function(){x.current&&y(x.current.getBBox()),g.current&&w(g.current.getBBox())}),[s,o]);var N=S/Math.max(S,j.width),O=S/Math.max(S,z.width),k={nameZh:{y:7.3+13.5*(1-N)*N/2},nameEn:{y:19.5-9*(1-O)*O/2}};return n.jsxs("g",P({textAnchor:"middle",fill:d?a.white:i},u,{children:[n.jsx(b,{fill:d?"#aaa":l}),n.jsxs("text",{ref:x,className:c,fontSize:12,transform:"translate(0,".concat(k.nameZh.y,")scale(").concat(N,")"),dominantBaseline:"central",children:[n.jsx("tspan",{fontSize:16,dy:.7,dominantBaseline:"central",children:f}),n.jsx("tspan",{dy:-.7,dominantBaseline:"central",children:s.slice(f.length)})]}),n.jsx("text",{ref:g,className:h,fontSize:8,transform:"translate(0,".concat(k.nameEn.y,")scale(").concat(O,")"),dominantBaseline:"middle",children:o}),m]}))}var A=function(){return A=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},A.apply(this,arguments)},E=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},I=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o};function W(e){var t=e.zhName,s=e.enName,o=e.foregroundColour,i=e.backgroundColour,l=e.zhClassName,c=e.enClassName,h=e.passed,d=e.children,m=E(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),u=r.useRef(null),f=I(r.useState({width:0}),2),x=f[0],g=f[1];r.useEffect((function(){u.current&&g(u.current.getBBox())}),[t,s]);var p=Math.max(45,x.width+4);return n.jsxs("g",A({textAnchor:"middle",fill:h?a.white:o},m,{children:[n.jsx(b,{customWidth:p,fill:h?"#aaa":i}),n.jsxs("g",{ref:u,children:[n.jsx("text",{className:l,fontSize:8.5,y:8,dominantBaseline:"central",children:t}),n.jsx("text",{className:c,fontSize:5.5,y:18,dominantBaseline:"middle",children:s})]}),d]}))}var D=function(){return D=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},D.apply(this,arguments)},H=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},F=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o};function U(e){var t=e.zhName,s=e.enName,o=e.foregroundColour,i=e.backgroundColour,l=e.zhClassName,c=e.enClassName,h=e.passed,d=e.children,m=H(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),u=r.useRef(null),f=r.useRef(null),x=F(r.useState({width:0}),2),g=x[0],p=x[1],j=F(r.useState({width:0}),2),y=j[0],v=j[1];r.useEffect((function(){u.current&&p(u.current.getBBox()),f.current&&v(f.current.getBBox())}),[t,s]);var z=S/Math.max(S,g.width),_=S/Math.max(S,y.width),w={nameZh:{y:7.3+13.5*(1-z)*z/2},nameEn:{y:19.5-9*(1-_)*_/2}};return n.jsxs("g",D({textAnchor:"middle",fill:h?a.white:o},m,{children:[n.jsx(b,{fill:h?"#aaa":i}),n.jsx("text",{ref:u,className:l,fontSize:12,transform:"translate(0,".concat(w.nameZh.y,")scale(").concat(z,")"),dominantBaseline:"central",children:t}),n.jsx("text",{ref:f,className:c,fontSize:8,transform:"translate(0,".concat(w.nameEn.y,")scale(").concat(_,")"),dominantBaseline:"middle",children:s}),d]}))}var L=function(){return L=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},L.apply(this,arguments)};const T=r.memo((function(e){var t=e.zhName,r=e.enName,a=e.spanDigits;switch(J(t,r)){case 1:return a?n.jsx(B,L({},e)):n.jsx(R,L({},e));case 2:return n.jsx(B,L({},e));default:return t.length>=5?n.jsx(W,L({},e)):n.jsx(U,L({},e))}}));var J=function(e,t){return void 0!==_(e)?1:void 0!==z(e,t)?2:3},V=function(){return V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},V.apply(this,arguments)},Y=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Z=5.625;const G=r.memo((function(e){var t=e.stroke,r=e.filled,a=e.bolder,s=Y(e,["stroke","filled","bolder"]),o="M0,9.25 V-9.25 H-".concat(13.5," l-").concat(5,",").concat(Z," v").concat(7.25," l").concat(5,",").concat(Z," H").concat(13.5," l").concat(5,",-").concat(Z," v-").concat(7.25," l-").concat(5,",-").concat(Z," H0");return n.jsx("path",V({d:o,fill:r?t:"#fff",strokeWidth:a?1.7:y,stroke:t},s))}));var X=function(){return X=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},X.apply(this,arguments)},q=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};const K=r.memo((function(e){var t=e.stroke,r=e.filled,a=e.bolder,s=q(e,["stroke","filled","bolder"]);return n.jsx("path",X({d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:r?t:"#fff",strokeWidth:a?1.7:y,stroke:t},s))}));var Q=r.createContext({updateId:0,update:function(){}}),ee=function(){return ee=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ee.apply(this,arguments)},te=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},ne=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o},re=r.forwardRef((function(e,t){var a=e.Icon,s=e.lineNum,o=e.stnNum,i=e.strokeColour,l=e.passed,c=e.size,h=e.textClassName,d=e.bolderBorder,m=e.alwaysShowColouredBorder,u=e.useSameScale,f=e.children,x=te(e,["Icon","lineNum","stnNum","strokeColour","passed","size","textClassName","bolderBorder","alwaysShowColouredBorder","useSameScale","children"]),g=r.useContext(Q).updateId,p=r.useRef(null),j=r.useRef(null),y=ne(r.useState({width:0}),2),v=y[0],S=y[1],z=ne(r.useState({width:0}),2),_=z[0],w=z[1];r.useEffect((function(){p.current&&S(p.current.getBBox()),j.current&&w(j.current.getBBox())}),[s,o,g]);var N=s&&s.length>2;r.useEffect((function(){u&&N&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")}),[u,N]);var b=17/Math.max(17,v.width),O=u&&2===(null==s?void 0:s.length)?b:17/Math.max(17,_.width),k="sm"===c?"0.7":"lg"===c?"1.6":1;return n.jsxs("g",ee({ref:t},x,{children:[n.jsxs("g",{transform:"scale(".concat(k,")"),children:[n.jsx(a,{stroke:l&&!m?"#aaa":i,filled:!s&&!o,bolder:d}),(s||o)&&n.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:l?"#aaa":"#000",children:[n.jsx("g",{transform:"translate(-9.25,0)scale(".concat(b,")"),children:n.jsx("text",{ref:p,className:h,dominantBaseline:"central",x:.5,children:s})}),n.jsx("g",{transform:"translate(9.25,0)scale(".concat(O,")"),children:n.jsx("text",{ref:j,className:h,dominantBaseline:"central",children:o})})]})]}),f]}))})),ae=function(){return ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ae.apply(this,arguments)},se=r.forwardRef((function(e,t){return n.jsx(re,ae({Icon:G},e,{ref:t}))})),oe=function(){return oe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},oe.apply(this,arguments)},ie=r.forwardRef((function(e,t){return n.jsx(re,oe({Icon:K},e,{ref:t}))})),le=function(){return le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},le.apply(this,arguments)},ce=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function he(e){var t=e.position,r=ce(e,["position"]),a="right"===t?"rotate(180)":"rotate(0)";return n.jsx("circle",le({cx:-15.32,cy:0,r:9.575,stroke:"#aaa",strokeWidth:2.275,fill:"white",strokeDasharray:"2.7 2.5",transform:a},r))}var de=function(){return de=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},de.apply(this,arguments)},me=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},ue=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o},fe=function(e,t){return Array.from(Array(e).keys()).map((function(n){return(n-(e-1)/2)*t}))},xe=function(e){return"fmetro"===e?G:K},ge=9.1,pe=2.8600000000000003;r.forwardRef((function(e,t){var a=e.stations,s=e.textClassName,o=e.columns,i=void 0===o?2:o,l=e.topHeavy,c=e.anchorAt,h=e.osiPosition,d=e.children,m=me(e,["stations","textClassName","columns","topHeavy","anchorAt","osiPosition","children"]),u=r.useMemo((function(){return function(e,t,n){if(e<=0)return[];if(1===e)return[[0,0]];for(var r=t>e?e:t,a=v,s=fe(r,a),o=Math.ceil(e/r),i=fe(o,19.8),l=e%r,c=[],h=0;h<o;h++)if(0===l||h!==(n?o-1:0))for(var d=0;d<r;d++)c.push([s[d],i[h]]);else{var m=fe(l,a);for(d=0;d<l;d++)c.push([m[d],i[h]])}return c}(a.length,i,l)}),[a.length,i,l]),f=ue(r.useMemo((function(){if(void 0===c)return[0,0];if(c<0||c>=u.length)return console.warn("<InterchangeStation2024/>, anchor index ".concat(c," is out of bound")),[0,0];var e=ue(u[c],2);return[-e[0],-e[1]]}),[u,c]),2),x=f[0],g=f[1],p=r.useRef(null),j=r.useRef([]);r.useEffect((function(){j.current=j.current.slice(0,a.length)}),[a.length]);var y=2===a.length&&1===i&&!!h;return r.useImperativeHandle(t,(function(){return{target:p.current,children:j.current,getCoordinates:function(){return u},getCorrectedBBox:function(){var e,t,n=null!==(t=null===(e=p.current)||void 0===e?void 0:e.getBBox())&&void 0!==t?t:{x:0,y:0,width:0,height:0};return n.y-=4.55,n.height+=ge,y?(n.x-="left"===h?1.4300000000000002:4.55,n.width+=5.98):(n.x-=4.55,n.width+=ge),n},getTranslate:function(){return[x,g]}}}),[u,x,g,p.current,j.current,h]),n.jsxs("g",de({ref:p,transform:"translate(".concat(x,",").concat(g,")")},m,{children:[a.map((function(e,t){var r=e.style,a=xe(r);return n.jsx(a,{stroke:"#aaa",filled:!0,strokeWidth:ge,transform:"translate(".concat(u[t][0],",").concat(u[t][1],")")},t)})),y&&n.jsx(he,{position:h,r:13.206896551724137,strokeWidth:pe,strokeDasharray:void 0}),a.map((function(e,t){var r=e.style,a=xe(r);return n.jsx(a,{stroke:"white",filled:!0,strokeWidth:3.3800000000000003,transform:"translate(".concat(u[t][0],",").concat(u[t][1],")")},t)})),y&&n.jsx(he,{position:h}),a.length&&n.jsx("rect",{fill:"white",x:-12,y:u[0][1],width:24,height:2*-u[0][1]}),a.map((function(e,t){var r=e.style,a=me(e,["style"]),o="fmetro"===r?se:ie;return n.jsx(o,de({ref:function(e){return j.current[t]=e},transform:"translate(".concat(u[t][0],",").concat(u[t][1],")"),textClassName:s},a),t)})),d]}))}));var je=function(){return je=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},je.apply(this,arguments)},ye=10*Math.PI/180,ve=9*Math.sin(ye),Se=9*Math.cos(ye),ze="M0,".concat(9," A").concat(9,",").concat(9," 0 0,0 ").concat(ve,",-").concat(Se);function _e(e){return n.jsxs("g",je({},e,{children:[n.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),n.jsx("path",{d:ze,stroke:"red",strokeWidth:3,fill:"none"}),n.jsx("path",{d:ze,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),n.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]}))}var we=function(){return we=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},we.apply(this,arguments)},Ne=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},be=r.forwardRef((function(e,t){var r=e.clockwise,a=e.anchorAt,s=void 0===a?"text":a,o=Ne(e,["clockwise","anchorAt"]),i="circle"===s?29:0;return n.jsx("g",we({ref:t},o,{children:n.jsxs("g",{transform:"translate(".concat(i,",0)"),children:[n.jsx(_e,{transform:"translate(-30,0)scale(".concat(r?-1:1,",1)")}),n.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),n.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})}))}));const Oe=r.memo((function(e){const{stnName:t,onUpdate:a,onEnNameUpdate:s}=e,{zh:o="",en:i=""}=t,l=r.useRef(null);return r.useEffect((()=>{if(l.current){a?.(l.current.getBBox());const e=l.current.querySelector("g");e&&s?.(e.getBBox())}}),[JSON.stringify(t),l.current]),n.jsxs("g",{ref:l,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:18,children:o}),n.jsx("g",{fontSize:10.5,children:i.split("\\").map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:16+11*t,children:e},t)))})]})}),((e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName)));function ke(e){const{stnName:t,onUpdate:a,passed:s,...o}=e,{zh:i="",en:l=""}=t,c=r.useRef(null),[h,d]=r.useState({x:0,width:0});return r.useEffect((()=>{if(c.current){const e=c.current.getBBox();d(e),a?.(e)}}),[JSON.stringify(t)]),i||l?n.jsxs("g",{fill:s?"#aaa":"#000",...o,children:[n.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[n.jsx("text",{textAnchor:"end",x:h.x-3,className:"rmg-name__zh",children:"("}),n.jsx("text",{textAnchor:"start",x:h.width+h.x+3,className:"rmg-name__zh",children:")"})]}),n.jsxs("g",{ref:c,textAnchor:"middle",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:13,children:i}),n.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:l})]})]}):n.jsx(n.Fragment,{})}function $e(e){const{passed:t,...r}=e;return n.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...r,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),n.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function Be(e){const{passed:t,temporary:r,...a}=e;return n.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...a,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),n.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),r&&n.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function Pe(e){const{primaryName:t,secondaryName:a,stationState:s,flipped:i,express:l,underConstruction:c}=e,[h,d]=r.useState({width:0}),[m,u]=r.useState({width:0}),[f,x]=r.useState({x:0,width:-20}),g=t.en?.split("\\")?.length??1,p={x:0,y:i?17.5:-20-14*g*Math.cos(-45)},j={x:(h.width+f.width/2+10)*(i?-1:1),y:2+5*(g-1)},y={x:(h.width+f.width+20+35)*(i?-1:1),y:2+5*(g-1)},v={x:(m.width+5+20)*(i?-1:1),y:h.y+h.height-14};return n.jsxs("g",{textAnchor:i?"end":"start",fill:(e=>{switch(e){case o.PASSED:return"#aaa";case o.CURRENT:return"#f00";case o.FUTURE:return"#000"}})(s),transform:`translate(${p.x},${p.y})rotate(-45)`,children:[n.jsx(Oe,{stnName:t,onUpdate:d,onEnNameUpdate:u}),a&&n.jsx(ke,{stnName:a,onUpdate:x,passed:s===o.PASSED,transform:`translate(${j.x},${j.y})`}),l&&n.jsx($e,{passed:s===o.PASSED,transform:`translate(${y.x},${y.y})`}),c&&n.jsx(Be,{passed:s===o.PASSED,temporary:"temp"===c,transform:`translate(${v.x},${v.y})`})]})}function Ce(e){const{stnId:t,stnState:a,stnY:s}=e,{theme:c,line_name:h,line_num:d,spanLineNum:m,stn_list:u,loop:f,loop_info:{midpoint_station:x,clockwise:g}}=i((e=>e.param)),p=u[t],j=x===t,[y,v]=r.useState({height:0}),S=r.useRef(null);r.useEffect((()=>{S.current&&v(S.current.getBBox())}),[S.current,s,p.localisedName,p.localisedSecondaryName,p.services]);const z=2===p.parents.length||2===p.children.length,_=s>0||1===p.parents.indexOf(p.branch?.left?.[1]||"")||1===p.children.indexOf(p.branch?.right?.[1]||"")?180:0,w=p.localisedName.en?.split("\\")?.length??1,N=z?180===_?16+12*(w-1)*Math.cos(-45):-9:180===_?-6:(25+15*(w-1))*Math.cos(-45),b=s>0?y.height+23:-y.height-23;return n.jsxs(n.Fragment,{children:[n.jsx(Me,{intInfos:z?[{theme:[c[0],c[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:h},...p.transfer.groups[0].lines??[]]:p.transfer.groups[0].lines??[],stnState:f?o.FUTURE:a,tickRotation:_,spanDigits:m}),n.jsx(ie,{lineNum:d,stnNum:p.num,strokeColour:c[2],textClassName:"rmg-name__zh",passed:-1===a,alwaysShowColouredBorder:f,bolderBorder:!0,useSameScale:!0}),n.jsx("g",{ref:S,transform:`translate(${-N},0)`,children:n.jsx(Pe,{primaryName:p.localisedName,secondaryName:p.localisedSecondaryName,stationState:a,flipped:180===_,express:p.services.includes(l.express),underConstruction:p.underConstruction})}),j&&n.jsx(be,{transform:`translate(0,${b})`,clockwise:g,anchorAt:s>0?"text":"circle"})]})}const Me=e=>n.jsxs(n.Fragment,{children:[n.jsx(Re,{strokeWidth:4,...e}),n.jsx(Ae,{transform:`translate(0,${180===e.tickRotation?-47:23})`,...e})]}),Re=e=>{const{intInfos:t,stnState:r,tickRotation:a,spanDigits:s,...o}=e;return n.jsx("g",{...o,children:t.map(((e,s)=>n.jsx("use",{xlinkHref:"#inttick",stroke:-1===r?"#aaa":e.theme?.[2],transform:`translate(${-2*(t.length-1)+4*s},0)rotate(${180===a?180:0})`},s)))})},Ae=e=>{const{intInfos:t,tickRotation:r,stnState:s,spanDigits:o,...i}=e;return n.jsx("g",{...i,children:t.map(((e,t)=>n.jsx("g",{transform:`translate(0,${28*t*(180===r?-1:1)})`,children:n.jsx(T,{zhName:e.name[0],enName:e.name[1],foregroundColour:e.theme?.[3]??a.white,backgroundColour:e.theme?.[2]??"#aaaaaa",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",passed:-1===s,spanDigits:o})},t)))})};function Ee(e){const{xs:t,ys:r,stnStates:a}=e,{stn_list:s,loop:o}=i((e=>e.param)),{branches:l}=i((e=>e.helper)),c=o?l[0].slice(1,-1):Object.keys(s);return n.jsx("g",{id:"stn_icons",children:c.filter((e=>!["linestart","lineend"].includes(e))).map((e=>n.jsx("g",{style:{transform:`translate(${t[e]}px,${r[e]}px)`},children:n.jsx(Ce,{stnId:e,stnState:a[e],stnY:r[e]})},e)))})}const Ie=(e,t)=>2===e[t].parents.length||2===e[t].children.length?.25:0,We=(e,t,n)=>{const r=m("linestart","lineend",t);if(r.nodes.includes(e))return m(r.nodes[1],e,t).len;{const a=n.filter((t=>t.includes(e)))[0];let s=e;for(;!r.nodes.includes(s);)s=a[a.indexOf(s)-1];let o=e;for(;!r.nodes.includes(o);)o=a[a.indexOf(o)+1];const i="linestart"===s,l="lineend"===o;if(a.toString()===n[0].toString()){const n=[];return i||l?i?(n[0]=0,n[1]=m(r.nodes[1],o,t).len,n[2]=m(a[1],e,t).len,n[3]=m(e,o,t).len):(n[0]=m(r.nodes[1],s,t).len,n[1]=m(s,r.nodes.slice(-2)[0],t).len,n[2]=m(s,e,t).len,n[3]=m(e,a.slice(-2)[0],t).len):(n[0]=m(r.nodes[1],s,t).len,n[1]=m(s,o,t).len,n[2]=m(s,e,t).len,n[3]=m(e,o,t).len),n[0]+n[2]*n[1]/(n[2]+n[3])}if(i||l)return i?m(r.nodes[1],o,t).len-m(e,o,t).len:m(r.nodes[1],s,t).len+m(s,e,t).len;{const n=[];return n[0]=m(r.nodes[1],s,t).len,n[1]=m(s,o,t).len,n[2]=m(s,e,t).len,n[3]=m(e,o,t).len,n[0]+n[2]*n[1]/(n[2]+n[3])}}},De=()=>{const{branches:e,routes:t,depsStr:a}=i((e=>e.helper)),{svgWidth:s,svg_height:o,y_pc:l,padding:x,branchSpacingPct:g,direction:p,line_name:j,spanLineNum:y,current_stn_idx:v,stn_list:S}=i((e=>e.param)),z=d(S,Ie,Ie),_=r.useMemo((()=>(console.log("computing x shares"),Object.keys(S).reduce(((t,n)=>({...t,[n]:We(n,z,e)})),{}))),[e.toString(),JSON.stringify(z)]),w=m("linestart","lineend",z),N=m(w.nodes[1],w.nodes.slice(-2)[0],z),b=p===c.right?[s[h.RailMap]*x/100+65,s[h.RailMap]*(1-x/100)-20]:[s[h.RailMap]*x/100,s[h.RailMap]*(1-x/100)-65],O=Object.keys(_).reduce(((e,t)=>({...e,[t]:b[0]+_[t]/N.len*(b[1]-b[0])})),{}),k=r.useMemo((()=>(console.log("computing y shares"),Object.keys(S).reduce(((t,n)=>{if(e[0].includes(n))return{...t,[n]:0};{const r=e.slice(1).filter((e=>e.includes(n)))[0];return{...t,[n]:S[r[0]].children.indexOf(r[1])?-2:2}}}),{}))),[a]),$=Object.keys(k).reduce(((e,t)=>({...e,[t]:-k[t]*g*o/200})),{}),B=r.useMemo((()=>u(v,t,p)),[v,p,t.toString()]),P=e.map((e=>f(e,B))).reduce(((e,t)=>(e.main.push(t.main),e.pass.push(t.pass),e)),{main:[],pass:[]}),C=Object.keys(P).reduce(((e,t)=>({...e,[t]:P[t].map((e=>Fe(e,O,$)))})),{});return n.jsxs("g",{id:"main",style:{"--y-percentage":l,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[n.jsx(He,{paths:C}),n.jsx(Ee,{xs:O,ys:$,stnStates:B}),n.jsx("g",{id:"line_name",style:{"--translate-x":p===c.right?b[0]-65+"px":`${b[1]+65}px`},children:n.jsx(T,{zhName:j[0],enName:j[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:y})})]})},He=r.memo((function(e){return n.jsxs("g",{fill:"none",strokeWidth:4,children:[n.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:e.paths.pass.map(((e,t)=>n.jsx("path",{d:e},t)))}),n.jsx("g",{stroke:"var(--rmg-theme-colour)",children:e.paths.main.map(((e,t)=>n.jsx("path",{d:e},t)))})]})}),((e,t)=>JSON.stringify(e.paths)===JSON.stringify(t.paths))),Fe=(e,t,n)=>{let r;const a=[];return e.forEach((e=>{const s=t[e],o=n[e];if(!r&&0!==r)return r=o,void a.push(`M ${s},${o}`);0===o?(o<r&&a.push("H "+(s-40),"a 40,40 0 0,0 40,-40",`V ${o}`),o>r&&a.push("H "+(s-40),"a 40,40 0 0,1 40,40",`V ${o}`)):(o<r&&a.push(`V ${o+40}`,"a 40,40 0 0,1 40,-40",`H ${s}`),o>r&&a.push("V "+(o-40),"a 40,40 0 0,0 40,40",`H ${s}`)),a.push(`H ${s}`),r=o})),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")};function Ue(e){return n.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black",...e})}function Le(e){const{destIds:t,textAnchor:a,...s}=e,o=i((e=>e.param.direction)),l=i((e=>e.param.stn_list)),h=t.map((e=>l[e].localisedName.zh?.length??0)),d=Math.min(...h),m=d>1&&h[0]!==h[1]?Math.abs(h[0]-h[1])/(d-1):0;return n.jsxs("g",{textAnchor:a,...s,children:[t.map(((e,t)=>{const s=h[t]>h[1-t],i=!g()&&"end"===a&&!s;return n.jsxs(r.Fragment,{children:[n.jsx("text",{className:"rmg-name__zh",fontSize:25,x:o===c.left?0:-75,y:42*t-21,letterSpacing:s?"0em":`${m}em`,dx:i?`${m}em`:"0em",children:l[e].localisedName.zh}),n.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:o===c.left?0:-75,y:42*t-1,children:"Towards "+l[e].localisedName.en?.replace("\\"," ")})]},e)})),n.jsx("text",{className:"rmg-name__zh",fontSize:28,x:o===c.left?25*(Math.max(...h)+1):0,y:5,children:"方向"})]})}const Te=(e,t,n)=>{const r=Math.min(...Object.values(e)),a=Math.max(...Object.values(e)),s=Math.min(...Object.values(t)),o=Math.max(...Object.values(t))-s,i=o/2;return`M${a},${s} H${r} h-${n/2} a${i},${i} 0 0,0 0,${o} H${a} h${n/2} a${i},${i} 0 0,0 0,-${o}Z`};function Je({currentStationX:e,currentStationY:t,stationGap:r,loopClockwise:a}){const s=t>0?a?-1:1:a?1:-1,o=(r/3-6)*s,i=e+o+6*s,l=(t-12)*-s;return n.jsx("g",{transform:`scale(1,${-s})`,children:n.jsx("path",{d:`M${i},${l} h${o}`,strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function Ve({clockwise:e,...t}){return n.jsx("g",{...t,children:n.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:16,children:e?"内环":"外环"}),n.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:e?"Inner Circle":"Outer Circle"})]})})}const Ye=2/3,Ze=2-Ye,Ge=25*Math.PI/180,Xe=Math.asin(Math.sin(35*Math.PI/180)/2);function qe({cxLeft:e,cxRight:t,yGap:r,clockwise:a}){const s=r/2,o=s*(a?Ye:Ze),i=a?Ge:Xe,l=o*Math.cos(i),c=a?1:-1,h=a?1:0,d=o*Math.sin(i)*c,m=2*d,u={rotate:a?"-4deg":"2deg"};return n.jsxs(n.Fragment,{children:[n.jsxs("g",{transform:`translate(${e},0)`,children:[n.jsx("path",{d:`M${-l},${d} a${o},${o} 0 0,${h} 0,${-m}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:u}),n.jsx(Ve,{transform:`translate(${a?0:-2*s},0)`,clockwise:a})]}),n.jsxs("g",{transform:`translate(${t},0)`,children:[n.jsx("path",{d:`M${l},${-d} a${o},${o} 0 0,${h} 0,${m}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:u}),n.jsx(Ve,{transform:`translate(${a?0:2*s},0)`,clockwise:a})]})]})}function Ke(){const{branches:e}=i((e=>e.helper)),{svgWidth:t,svg_height:a,y_pc:s,padding:l,branchSpacingPct:c,current_stn_idx:d,loop_info:{midpoint_station:m,clockwise:u}}=i((e=>e.param)),f=e[0].slice(1,-1),x=Math.ceil(f.length/2),g=r.useMemo((()=>(console.log("computing x shares"),f.reduce(((e,t,n,r)=>{let a;return n<x?a=x-n-1:(a=n-x,1&r.length&&(a+=.5)),{...e,[t]:a}}),{}))),[f.toString()]),p=c*a*2/100,j=((e,t,n,r)=>{const a=e-(e*(1-2*t/100)*(n-1)/n-r);return[a/2,e-a/2]})(t[h.RailMap],l,x,p),y=(j[1]-j[0])/(x-1),v=Object.keys(g).reduce(((e,t)=>({...e,[t]:j[0]+g[t]*y})),{}),S=r.useMemo((()=>(console.log("computing y shares"),f.reduce(((e,t,n)=>({...e,[t]:n<x?1:-1})),{}))),[f.toString()]),z=Object.keys(S).reduce(((e,t)=>({...e,[t]:-S[t]*p/2})),{}),_=((e,t,n,r)=>{const a=e.indexOf(n),s=e.indexOf(r??n);let i;return i=s<0?e:t?a<=s?[...e.slice(0,a+1),...e.slice(s)]:e.slice(s,a+1):a<s?e.slice(a,s+1):[...e.slice(a),...e.slice(0,s+1)],e.reduce(((e,t,n)=>a===n?{...e,[t]:o.CURRENT}:i.includes(t)?{...e,[t]:o.FUTURE}:{...e,[t]:o.PASSED}),{})})(f,u??!1,d,m);return n.jsxs("g",{id:"main",style:{"--y-percentage":s,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[n.jsx("path",{d:Te(v,z,y),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),n.jsx(Ee,{xs:v,ys:z,stnStates:_}),n.jsx(Je,{currentStationX:v[d],currentStationY:z[d],stationGap:y,loopClockwise:u}),n.jsx(qe,{cxLeft:j[0]-y/2,cxRight:j[1]+y/2,yGap:p,clockwise:u})]})}const Qe=h.RailMap,et=()=>{const{canvasScale:e}=i((e=>e.app)),{svgWidth:t,svg_height:r,direction:a,psd_num:o,info_panel_type:l,notesGZMTR:h,current_stn_idx:d,stn_list:m,theme:u,loop:f}=i((e=>e.param)),g=t[Qe],j=m[d];return n.jsxs(x,{type:Qe,svgWidth:g,svgHeight:r,canvasScale:e,theme:u,children:[n.jsx(tt,{}),n.jsx(p,{variant:l,isShowLight:l===s.gz2otis,isShowPSD:l===s.gz2otis&&o}),!f&&(a===c.left&&j.parents.includes("linestart")||a===c.right&&j.children.includes("lineend"))?n.jsx(at,{}):n.jsxs(n.Fragment,{children:[f?n.jsx(Ke,{}):n.jsx(De,{}),!f&&n.jsx(nt,{}),h?.map(((e,t)=>n.jsx(st,{note:e},t)))]}),l===s.gz2otis&&n.jsx("line",{x2:g,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},tt=r.memo((function(){return n.jsxs("defs",{children:[n.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),n.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:n.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})})),nt=()=>{const{routes:e}=i((e=>e.helper)),{direction:t,direction_gz_x:a,direction_gz_y:s,current_stn_idx:o}=i((e=>e.param)),l=r.useMemo((()=>[...new Set(e.reduce(((e,n)=>n.includes(o)?e.concat(n.filter((e=>!["linestart","lineend"].includes(e))).slice(t===c.left?0:-1)[0]):e),[]).filter((e=>e!==o)))]),[o,t,e.toString()]),h={textAnchor:t===c.left?"start":"end",transform:`translate(${t===c.left?65:-65},-5)`,destIds:l};return n.jsxs("g",{id:"direction_gz",style:{"--x-percentage":a,"--y-percentage":s},children:[n.jsx(Ue,{transform:`scale(0.35)rotate(${t===c.left?0:180})`}),2!==l.length?n.jsx(rt,{...h}):n.jsx(Le,{...h})]})},rt=e=>{const{destIds:t,...r}=e,a=i((e=>e.param.stn_list));return n.jsxs("g",{...r,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map((e=>a[e].localisedName.zh)).join("/")+"方向"}),n.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map((e=>a[e].localisedName.en?.replace("\\"," "))).join("/")})]})},at=r.memo((function(){return n.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),n.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),n.jsxs("g",{strokeWidth:8,stroke:"#000",children:[n.jsx("path",{d:"M -160,68 h -160"}),n.jsx("path",{d:"M 160,68 h 160"})]})]})})),st=r.memo((function(e){const t=r.useRef(null),[a,s]=r.useState({width:0,height:0,y:0});return r.useEffect((()=>{t.current&&s(t.current.getBBox())}),[e.note[0],e.note[1]]),n.jsxs("g",{className:"note-box",style:{"--x-percentage":e.note[2],"--y-percentage":e.note[3]},children:[e.note[4]&&n.jsx("rect",{height:a.height+4,width:a.width+4,x:-2,y:a.y-2,fill:"none",stroke:"black",strokeWidth:.5}),n.jsxs("g",{ref:t,children:[n.jsx("g",{fontSize:16,letterSpacing:1.2,children:e.note[0].split("\n").map(((e,t)=>n.jsx("text",{className:"rmg-name__zh",y:18*t,children:e},t)))}),n.jsx("g",{fontSize:10,letterSpacing:.33,transform:`translate(0,${18*e.note[0].split("\n").length})`,children:e.note[1].split("\n").map(((t,r)=>n.jsx("text",{className:"rmg-name__en",y:11*r,textLength:r<(e.note[1].match(/\n/g)?.length||0)?a.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:t},r)))})]})]})}),((e,t)=>e.note.toString()===t.note.toString())),ot=r.memo((function(e){const{stnName:t,bold:a,sparse:s,onUpdate:o}=e,i=r.useRef(null),l=s?(e=>{switch(e){case 2:return.2;case 3:return.1;default:return 0}})(t.zh?.length):0;return r.useEffect((()=>{if(i.current&&o){const e=i.current.getBBox();o({...e,x:e.x+92*l/2,width:e.width-92*l})}}),[i.current,JSON.stringify(t),a,s]),n.jsxs("g",{ref:i,fontWeight:a?"bold":"normal",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:92,x:l/2+"em",letterSpacing:l+"em",children:t.zh}),n.jsx("g",{fontSize:40,children:t.en?.split("\\")?.map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:72+42*t,children:e},t)))})]})}),((e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName))),it=e=>{const{secondaryName:t,transform:a}=e,s=r.useRef(null),[o,i]=r.useState({x:0,width:0});return r.useEffect((()=>{s.current&&i(s.current.getBBox())}),[t.toString()]),n.jsxs("g",{transform:a,children:[n.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[n.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),n.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),n.jsxs("g",{ref:s,textAnchor:"middle",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),n.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},lt=r.forwardRef((function({stationInfo:e,...t},s){const{localisedName:o,transfer:{groups:[{lines:i}]}}=e,[l,c]=r.useState({width:0}),h=r.useRef(null);return r.useEffect((()=>{h.current&&c(h.current.getBBox())}),[h.current,JSON.stringify(o)]),n.jsxs("g",{ref:s,...t,children:[n.jsxs("g",{ref:h,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:20,children:o.zh}),o.en?.split("\\")?.map(((e,t)=>n.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*t,children:e},t)))]}),n.jsx("g",{transform:`translate(${l.width+2},7)`,children:i?.length&&n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M0,0 H8",stroke:i[0].theme?.[2]??"#aaa",strokeWidth:3.5}),n.jsx(T,{zhName:i[0].name[0],enName:i[0].name[1],backgroundColour:i[0].theme?.[2]??"#aaa",foregroundColour:i[0].theme?.[3]??a.white,zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:!0,transform:"translate(27,-8.5)scale(0.75)"})]})})]})}));function ct({viaStations:e,stationList:t}){const a=r.useRef([]),[s,o]=r.useState([]);r.useEffect((()=>{a.current=[]}),[e,t]),r.useEffect((()=>{o(a.current.map((e=>e?.getBBox()?.height??0)))}),[a.current]);const i=r.useCallback((e=>s.slice(0,e).reduce(((e,t)=>e+t+4),0)),[s]);return n.jsx(n.Fragment,{children:e.map(((e,r)=>n.jsx(lt,{ref:e=>a.current[r]=e,stationInfo:t[e],transform:`translate(0,${i(r)})`},e)))})}function ht({nameBBox:e}){const{svg_height:t,svgWidth:r,direction:a,current_stn_idx:s,stn_list:o,loop_info:{midpoint_station:l,clockwise:d}}=i((e=>e.param)),{branches:m}=i((e=>e.helper)),u=r[h.RunIn],f=m[0].slice(1,-1),{nextStation:x,viaStations:g}=((e,t,n,r,a)=>{const s=a?e.toReversed():e,o=s.indexOf(n),i=[...s,...s].slice(o+1),l=i[0],c=i.slice(1).reduce(((e,n)=>t[n].transfer.groups[0].lines?.length?[...e,n]:e),[]);return{nextStation:l,viaStations:r?[...c.slice(0,2),r]:c.slice(0,3)}})(f,o,s,l,d),{localisedName:{en:p=""},localisedSecondaryName:j}=o[s],{localisedName:{zh:y="",en:v=""}}=o[x],S=v.split("\\").length,z=(u-e.width)/2,_={x:80},w={x:154.8},N={dy:75+25*(S-1)},b={x:a===c.left?(115+50*(.5+y.length)+z)/2-20:((u+e.width)/2+(.82*u-60))/2+30,y:.5*t-18*(p.split("\\").length-2)-(j?29:0),rotate:a===c.left?0:180};return n.jsxs(n.Fragment,{children:[n.jsxs("g",{transform:`translate(0,${t/2+5-N.dy})`,children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${_.x},0)`,children:[n.jsxs("g",{fontWeight:"bold",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:44,children:"下站"}),n.jsx("text",{className:"rmg-name__en",fontSize:25,dy:40,children:"Next"})]}),n.jsxs("g",{transform:`translate(0,${N.dy})`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),n.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),n.jsxs("g",{textAnchor:"start",transform:`translate(${w.x},0)`,children:[n.jsxs("g",{fontWeight:"bold",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:44,children:y}),n.jsx("g",{fontSize:25,children:v.split("\\").map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:40+25*t,children:e},t)))})]}),n.jsx("g",{transform:`translate(0,${N.dy})`,children:n.jsx(ct,{viaStations:g,stationList:o})})]})]}),n.jsx(Ue,{transform:`translate(${b.x},${b.y})scale(0.4)rotate(${b.rotate})`})]})}function dt({secName:e,...t}){const{zh:a,en:s}=e,o=r.useRef(null),[i,l]=r.useState({x:0,width:0});return r.useEffect((()=>{o.current&&l(o.current.getBBox())}),[a,s]),n.jsxs("g",{...t,children:[n.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[n.jsx("text",{textAnchor:"end",x:i.x-3,className:"rmg-name__zh",children:"("}),n.jsx("text",{textAnchor:"start",x:i.width+i.x+3,className:"rmg-name__zh",children:")"})]}),n.jsxs("g",{ref:o,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:18,children:a}),n.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:s})]})]})}function mt({nextId:e,nameBBox:t,ignoreNumWidth:a}){const{svgWidth:s,svg_height:o,direction:l}=i((e=>e.param)),d=i((t=>t.param.stn_list[e])),{localisedName:m,localisedSecondaryName:u}=d,{zh:f="",en:x=""}=m,g=s[h.RunIn],[p,j]=r.useState({width:0}),y=r.useRef(null);r.useEffect((()=>{y.current&&j(y.current.getBBox())}),[f,x]);const v=f.length,S=(g-t.width)/2,z={x:l===c.left?80:g-45-p.width-35*(v<=2?2:1.5)},_={x:l===c.left?80+35*(v<=2?2:1.5):g-45-p.width},w={x:l===c.left?(115+35*((v<=2?1:.5)+v)+S)/2-20:(g-45-p.width-(v<=2?105:87.5)+S+t.width+(a?0:80.9))/2+20,y:o/2-30,rotate:l===c.left?0:180};return n.jsxs(n.Fragment,{children:[n.jsxs("g",{transform:`translate(0,${o/2-40})`,children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${z.x},0)`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),n.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),n.jsxs("g",{textAnchor:"start",ref:y,transform:`translate(${_.x},0)`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:35,children:f}),n.jsx("g",{fontSize:17,children:x.split("\\").map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:30+17*t,children:e},t)))})]}),u&&n.jsx("g",{textAnchor:"middle",transform:`translate(${_.x},0)`,children:n.jsx(dt,{secName:u,transform:`translate(${p.width/2},${30+17*x.split("\\").length+5})`})})]}),n.jsx(Ue,{transform:`translate(${w.x},${w.y})scale(0.25)rotate(${w.rotate})`})]})}const ut=()=>{const{svg_height:e,svgWidth:t,theme:a,direction:o,info_panel_type:l,line_num:d,current_stn_idx:m,stn_list:u}=i((e=>e.param)),f=u[m],{localisedName:x,localisedSecondaryName:g}=f,[p,j]=r.useState({width:0}),y=x.en?.split("\\")?.length??1,v=f[o===c.left?"parents":"children"],S=[s.gz7w,s.gz11].includes(l),z={name:`translate(${(o===c.left?1:-1)*t[h.RunIn]/4},45)`,next:`translate(${(o===c.left?1:-1)*t[h.RunIn]/10},45)`},_=(t[h.RunIn]+p.width)/2+55,w={x:t.runin/2,y:.5*e-50-18*(y-1)-(g?29:0)},N={x:0,y:70+36*y},b={x:_,y:.5*e-30-18*(y-1)-(g?29:0)},O={x:o===c.left?_:(t[h.RunIn]-p.width)/2-55,y:.5*e-18*(y-2)-(g?29:0)};return n.jsxs("g",{children:[n.jsxs("g",{transform:l===s.gz2otis?z.name:"",children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${w.x},${w.y})`,children:[n.jsx(ot,{stnName:x,bold:l===s.gz11,sparse:l===s.gz11,onUpdate:j}),g&&n.jsx(it,{secondaryName:g,transform:`translate(${N.x},${N.y})`})]}),n.jsx(ie,{lineNum:d,stnNum:f.num,strokeColour:a[2],textClassName:"rmg-name__zh",transform:S?`translate(${O.x},${O.y})`:`translate(${b.x},${b.y})`,size:"lg"})]}),l===s.gz11?n.jsx(ht,{nameBBox:p}):n.jsx("g",{transform:l===s.gz2otis?z.next:"",children:!v||v.includes("linestart")||v.includes("lineend")?n.jsx(n.Fragment,{}):1===v.length?n.jsx(mt,{nextId:v[0],nameBBox:p,ignoreNumWidth:S}):n.jsx(ft,{nextIds:v,nameBBox:p,ignoreNumWidth:S})})]})},ft=e=>{const{nextIds:t,nameBBox:a,ignoreNumWidth:s}=e,{routes:o}=i((e=>e.helper)),{svgWidth:l,svg_height:d,direction:m,stn_list:u}=i((e=>e.param)),f=l[h.RunIn],x=t.map((e=>u[e].localisedName)),[g,p]=r.useState({width:0}),j=r.useRef([]);r.useEffect((()=>{p((e=>({...e,width:0}))),j.current.forEach((e=>{const t=e?.getBBox();p((e=>t?e.width>t.width?e:t:e))}))}),[x.toString()]);const y=e.nextIds.map((e=>o.reduce(((t,n)=>n.includes(e)?t.concat(n.filter((e=>!["linestart","lineend"].includes(e))).slice(m===c.left?0:-1)[0]):t),[]))),v=Math.max(...x.map((e=>e.zh?.length??0))),S=(f-a.width)/2,z={x:m===c.left?72:f-45-g.width-41},_={x:m===c.left?113:f-45-g.width},w={x:m===c.left?(99+27*(1+v)+S)/2-20:(f-45-g.width-41-27+S+e.nameBBox.width+(s?0:80.9))/2+20,y:d/2-30,rotate:m===c.left?0:180};return n.jsxs(n.Fragment,{children:[n.jsx("g",{transform:`translate(0,${d/2-70})`,children:x.map(((e,t)=>n.jsxs(r.Fragment,{children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${z.x},${110*t})`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:27,children:"下站"}),n.jsx("text",{className:"rmg-name__en",fontSize:13,y:22,children:"Next"})]}),n.jsxs("g",{ref:e=>j.current[t]=e,textAnchor:"start",transform:`translate(${_.x},${110*t})`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:27,children:e.zh}),e.en?.split("\\")?.map(((e,t)=>n.jsx("text",{className:"rmg-name__en",fontSize:13,y:22+13*t,children:e},t))),n.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:y[t].map((e=>u[e].localisedName.zh)).join("/")+"方向"}),n.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+y[t].map((e=>u[e].localisedName.en)).join("/").replace("\\"," ")})]})]},t)))}),n.jsx(Ue,{transform:`translate(${w.x},${w.y})scale(0.25)rotate(${w.rotate})`})]})};function xt(e){const{num:t,...r}=e;return n.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...r,children:[n.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),n.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),n.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),n.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function gt(e){const{canvasType:t}=e,{svgWidth:r,svg_height:a}=i((e=>e.param));return n.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[n.jsx("line",{y2:a,transform:`translate(${r[t]/2},0)`}),n.jsx("line",{x2:r[t],transform:"translate(0,90)"})]})}function pt({coachNumber:e,...t}){return n.jsxs("g",{...t,children:[n.jsx("path",{d:"M-30,-30 a30,30 0 0,0 0,60 h60 a30,30, 0 0,0 0,-60Z",fill:"whitesmoke",stroke:"lightgrey"}),n.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),n.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),n.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:n.jsx("text",{className:"rmg-name__zh",fontSize:36,children:e})})]})}const jt=h.RunIn;function yt(){const{canvasScale:e}=i((e=>e.app)),{svgWidth:t,svg_height:r,direction:a,info_panel_type:o,platform_num:l,psd_num:h,coachNum:d,theme:m}=i((e=>e.param)),u=t[jt],f=[s.gz7w,s.gz11].includes(o),g=f?r-78:r/2-30,j={platform:`translate(${a===c.left?50:-50},45)`};return n.jsxs(x,{type:jt,svgWidth:u,svgHeight:r,canvasScale:e,theme:m,children:[n.jsx(p,{variant:o,isShowLight:o!==s.gz2otis,isShowPSD:o!==s.gz2otis&&h}),n.jsx("g",{transform:o===s.gz2otis?j.platform:"",children:n.jsx(xt,{num:l,style:{"--translate-x":(a===c.left||o===s.gz11?u-100:100)+"px","--translate-y":g+"px","--scale":f?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),f&&n.jsx(pt,{coachNumber:d,transform:`translate(${.82*u},${.58*r})`}),n.jsx(ut,{}),o===s.gz2otis&&n.jsx(gt,{canvasType:jt})]})}e("default",{runin:n.jsx(yt,{}),railmap:n.jsx(et,{})})}}}));
