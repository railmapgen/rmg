const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CeiwU7vO.js","assets/chakra-CXrhlirJ.js","assets/react-Caefwd5V.js","assets/index--KTv9PqL.js","assets/index-BTdBVow0.css","assets/svg-wrapper-DO1Iqw6o.js","assets/share-BS6mU4tJ.js","assets/mtr-Bo5mGen5.js","assets/index-DIDlAF78.js","assets/param-selector-DlvT_aAj.js","assets/index-DYn9aNpo.js","assets/index-DDhymJfQ.js","assets/station-ag-grid-Dn4mej34.js","assets/ag-grid-react-A6BSx5P9.js","assets/ag-grid-community-TcQKCcyM.js"])))=>i.map(i=>d[i]);
import{j as v,ap as wn,h as Te,B as ke,al as Se,a2 as Be,ao as Re,N as lt,aq as Ot,t as de,D as Ne,aj as Ke,M as Xe,ak as Je,U as ut,V as ft,J as Qe,K as et,L as tt,O as nt,ab as rn,ar as kn,as as Cn,at as jn,au as Ft,av as An,aw as En,ax as gt,ay as On,az as zn,R as Ve,aA as sn,a as Rn,aB as Pn}from"./chakra-CXrhlirJ.js";import{a as X,u as ce,o as an,c as at,g as Tn,s as In}from"./react-Caefwd5V.js";import{_ as Le,u as Q,r as le,E as xe,R as pt,a as on,s as Bn,b as ln,c as Nn,D as ye,d as ue,e as J,f as Ae,M as Mn,F as xt,g as Me,h as ct,i as Ie,j as wt,o as zt,k as Dn,l as Rt,S as dt,m as Ut,B as ht,n as Pt,p as Tt,q as Ln,t as Fn,v as Un,w as kt,x as Ct,y as Wn,z as Wt,A as Zn,C as Hn,G as cn,H as dn,I as Gn,J as Vn,P as bt,K as Yn,L as Zt,N as $n,O as qn,Q as Kn,T as Xn,U as Jn,V as Qn,W as er,X as Ht,Y as tr,Z as nr,$ as rr,a0 as _t,a1 as sr,a2 as ir,a3 as ar,a4 as or,a5 as lr,a6 as cr,a7 as dr,a8 as hr,a9 as Fe,aa as qe,ab as Ue,ac as De,ad as hn,ae as ur,af as jt,ag as fr,ah as At,ai as pr,aj as mr,ak as gr,al as br,am as un,an as _r,ao as vr,ap as yr,aq as Sr,ar as Gt,as as xr,at as wr,au as kr,av as Cr,aw as Et,ax as jr,ay as Ar,az as Er,aA as Or,aB as zr,aC as Rr,aD as Pr,aE as Tr,aF as Ir,aG as Br,aH as Ye,aI as fn,aJ as Nr,aK as Mr,aL as Dr,aM as Lr,aN as ze}from"./index--KTv9PqL.js";import{R as _e,w as Fr,i as Ur,d as Vt,a as pn,s as Wr,g as Zr,b as vt,r as Hr,c as yt,P as Gr,e as Vr,u as Yr,f as $r,h as qr}from"./param-selector-DlvT_aAj.js";var Kr=function(a){var c=a.text,n=a.delimiter;return v.jsx("span",{children:c.split(n||"\\").map(function(i,s){return s?[v.jsx(wn,{children:"⏎"},s),i]:i})})};const It={mtr:{components:()=>Le(()=>import("./index-CeiwU7vO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),fonts:()=>Le(()=>import("./index-CeiwU7vO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(a=>a.mtrFonts)},gzmtr:{components:()=>Le(()=>import("./index-DIDlAF78.js"),__vite__mapDeps([8,1,2,3,4,6,5,9]))},shmetro:{components:()=>Le(()=>import("./index-DYn9aNpo.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,9]))},shsubrwy:{components:()=>Le(()=>import("./index-DDhymJfQ.js"),__vite__mapDeps([11,1,2,3,4,5]))}};function Xr(a){const[c,n]=X.useState({});return X.useEffect(()=>(It[a].components().then(i=>{n(i.default)}).catch(i=>{console.error("Failed to load canvas for style ".concat(a),i),n({})}),()=>{n({})}),[a]),c}const Jr={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}},Qr=async(a,c)=>{var i,s,e,t;const n=(e=await((s=(i=It[a]).fonts)==null?void 0:s.call(i)))!=null?e:[];await Promise.all(n.map(r=>le.loadFont(r))),c.aborted||(t=document.querySelector("#css_share"))==null||t.setAttribute("href","/rmg/styles/share_".concat(a,".css"))};function es(){const{canvasToShow:a,canvasScale:c}=Q(r=>r.app),{svg_height:n,style:i}=Q(r=>r.param),s=Xr(i);X.useEffect(()=>{const r=new AbortController;return Qr(i,r.signal).then(),le.event(xe.STYLE_CHANGE,{style:i}),()=>{r.abort()}},[i]);const e=Object.keys(s).filter(r=>a.includes(r)),t=n*c;return v.jsx(Te,{minH:t,sx:Jr,children:Object.keys(s).length===0?v.jsx(pt,{isIndeterminate:!0}):e.map(r=>v.jsx(on,{sx:{minWidth:750,height:t},children:s[r]},r+i))})}const Yt=a=>c=>{c(Bn(a)),c(ln(a.stn_list))},ge=(a,c)=>(n,i)=>{const{stn_list:s}=i().param,e={...s,[a]:c};n(we(e))},we=a=>c=>{c(Nn(a)),c(ln(a))},ts=(a=!1)=>(c,n)=>{const{stn_list:i}=n().param,s=Object.keys(i).reduce((e,t)=>({...e,[t]:(r=>{var d,u,y,g;switch(r){case"linestart":return{...i.lineend,parents:[],children:a?i.lineend.parents:i.lineend.parents.toReversed(),branch:{right:(d=i.lineend.branch)==null?void 0:d.left}};case"lineend":return{...i.linestart,parents:a?i.linestart.children:i.linestart.children.toReversed(),children:[],branch:{left:(u=i.linestart.branch)==null?void 0:u.right}};default:{const f=i[r].children.map(b=>b==="linestart"?"lineend":b==="lineend"?"linestart":b),l=i[r].parents.map(b=>b==="linestart"?"lineend":b==="lineend"?"linestart":b);return{...i[r],parents:a?f:f.reverse(),children:a?l:l.reverse(),branch:{left:(y=i[r].branch)==null?void 0:y.right,right:(g=i[r].branch)==null?void 0:g.left}}}}})(t)}),{});c(we(s))},$t=(a,c,n)=>(i,s)=>{const e=s().param.stn_list[a];i(ge(a,{...e,localisedName:{...e.localisedName,[c]:n}}))},ns=(a,c)=>(n,i)=>{const{localisedSecondaryName:s,...e}=i().param.stn_list[a];n(c?ge(a,{...e,localisedSecondaryName:{}}):ge(a,e))},qt=(a,c,n)=>(i,s)=>{const e=s().param.stn_list[a];i(ge(a,{...e,localisedSecondaryName:{...e.localisedSecondaryName,[c]:n}}))},rs=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,num:c}))},Kt=(a,c,n)=>(i,s)=>{var r,d;const e=s().param.stn_list[a],t=e.transfer.groups.map(u=>({...u}));if(t.length>c)t[c]={...t[c],lines:((r=t[c].lines)!=null?r:[]).concat(n)};else{for(let u=t.length;u<c;u++)t[u]={lines:[]};t[c]={lines:[n]}}i(ge(a,{...e,transfer:{...e.transfer,groups:[t[0],...(d=t.slice(1))!=null?d:[]]}}))},ss=(a,c,n)=>(i,s)=>{var t,r;const e=s().param.stn_list[a];if(e.transfer.groups.length>c&&(((t=e.transfer.groups[c].lines)==null?void 0:t.length)||0)>n){const d=e.transfer.groups.map((u,y)=>{var g;return y===c?{...u,lines:(g=u.lines)==null?void 0:g.filter((f,l)=>l!==n)}:u});i(ge(a,{...e,transfer:{...e.transfer,groups:[d[0],...(r=d.slice(1))!=null?r:[]]}}))}},is=(a,c,n,i)=>(s,e)=>{var r,d;const t=e().param.stn_list[a];if(t.transfer.groups.length>c&&(((r=t.transfer.groups[c].lines)==null?void 0:r.length)||0)>n){const u=t.transfer.groups.map((y,g)=>{var f;return g===c?{...y,lines:(f=y.lines)==null?void 0:f.map((l,b)=>b===n?i:l)}:y});s(ge(a,{...t,transfer:{...t.transfer,groups:[u[0],...(d=u.slice(1))!=null?d:[]]}}))}},Xt=(a,c,n)=>(i,s)=>{var r;const e=s().param.stn_list[a],t=e.transfer.groups.map(d=>({...d}));t.length>c&&(t[c]={...t[c],name:n},i(ge(a,{...e,transfer:{...e.transfer,groups:[t[0],...(r=t.slice(1))!=null?r:[]]}})))},as=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,transfer:{...s.transfer,tick_direc:c}}))},os=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,transfer:{...s.transfer,paid_area:c}}))},ls=(a,c,n)=>(i,s)=>{var t,r;const e=s().param.stn_list[a];i(ge(a,{...e,branch:{...e.branch,[c]:(r=(t=e.branch)==null?void 0:t[c])==null?void 0:r.with(0,n)}}))},cs=(a,c,n)=>(i,s)=>{var r,d,u;const e=s().helper.branches,t={stnId:a,direction:c,first:n};if(c===ye.left){const y=(r=e.slice(1).find(g=>g.slice(-1)[0]===a))==null?void 0:r[0];if(y){const g=e[0][e[0].indexOf(y)+1];i(Jt([t,{stnId:y,direction:ye.right,first:g}]))}}else{const y=(u=(d=e.slice(1).find(g=>g[0]===a))==null?void 0:d.slice(-1))==null?void 0:u[0];if(y){const g=e[0][e[0].indexOf(y)-1];i(Jt([t,{stnId:y,direction:ye.left,first:g}]))}}},Jt=a=>(c,n)=>{var s,e,t,r;const{stn_list:i}=n().param;c(we({...i,[a[0].stnId]:{...i[a[0].stnId],branch:{...i[a[0].stnId].branch,[a[0].direction]:(e=(s=i[a[0].stnId].branch)==null?void 0:s[a[0].direction])==null?void 0:e.with(1,a[0].first)}},[a[1].stnId]:{...i[a[1].stnId],branch:{...i[a[1].stnId].branch,[a[1].direction]:(r=(t=i[a[1].stnId].branch)==null?void 0:t[a[1].direction])==null?void 0:r.with(1,a[1].first)}}}))},ds=(a,c)=>(n,i)=>{var e,t,r;const s=i().helper.branches;if(c===ye.left){const d=(e=s.slice(1).find(u=>u.slice(-1)[0]===a))==null?void 0:e[0];d&&n(Qt(a,d))}else{const d=(r=(t=s.slice(1).find(u=>u[0]===a))==null?void 0:t.slice(-1))==null?void 0:r[0];d&&n(Qt(d,a))}},Qt=(a,c)=>(n,i)=>{const{stn_list:s}=i().param;n(we({...s,[a]:{...s[a],parents:s[a].parents.slice().reverse()},[c]:{...s[c],children:s[c].children.slice().reverse()}}))},hs=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,facility:c||void 0}))},us=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,services:c}))},fs=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,underConstruction:c}))},ps=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,loop_pivot:c}))},ms=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,one_line:c}))},gs=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,int_padding:c}))},bs=a=>(c,n)=>{const s=n().param.stn_list[a].int_padding,e=structuredClone(n().param.stn_list);Object.values(e).forEach(t=>{t.int_padding=s}),c(we(e))},_s=(a,c)=>(n,i)=>{const s=i().param.stn_list[a];n(ge(a,{...s,character_spacing:c}))},vs=a=>(c,n)=>{const s=n().param.stn_list[a].character_spacing,e=structuredClone(n().param.stn_list);Object.values(e).forEach(t=>{t.character_spacing=s}),c(we(e))},ys=(a,c,n=2,i="asc")=>(s,e)=>{var u;const t=e().param.stn_list,d=(u=e().helper.branches[a])==null?void 0:u.slice(1,-1);if(d){const y=d.reduce((g,f,l)=>({...g,[f]:{...t[f],num:(c+l*(i==="desc"?-1:1)).toString().padStart(n,"0")}}),t);s(we(y))}};function Ss(){var d,u,y,g;const{t:a}=ce(),c=ue(),n=Q(f=>f.app.selectedStation);console.log("InfoSection:: Rendering for",n);const i=Q(f=>f.param.style),{num:s,localisedName:e,localisedSecondaryName:t}=Q(f=>f.param.stn_list[n]),r=[{type:"input",label:a("StationSidePanel.info.num"),value:s,placeholder:"01",onChange:f=>c(rs(n,f)),hidden:![J.GZMTR].includes(i)},{type:"input",label:a("Chinese name"),value:(d=e.zh)!=null?d:"",onChange:f=>c($t(n,"zh",f))},{type:"input",label:a("English name"),value:(u=e.en)!=null?u:"",onChange:f=>c($t(n,"en",f))},{type:"custom",label:a("Secondary names"),component:v.jsx(Ae,{selections:[{label:a("Yes"),value:!0},{label:a("No"),value:!1}],defaultValue:!!t,onChange:f=>c(ns(n,f))}),hidden:![J.GZMTR].includes(i)},{type:"input",label:a("StationSidePanel.info.zhSecondary"),value:(y=t==null?void 0:t.zh)!=null?y:"",placeholder:"1号航站楼",onChange:f=>c(qt(n,"zh",f)),hidden:!t||![J.GZMTR].includes(i)},{type:"input",label:a("StationSidePanel.info.enSecondary"),value:(g=t==null?void 0:t.en)!=null?g:"",placeholder:"Terminal 1",onChange:f=>c(qt(n,"en",f)),hidden:!t||![J.GZMTR].includes(i)}];return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("StationSidePanel.info.title")}),v.jsx(_e,{fields:r,minW:130})]})}class xs{static hexToRgb(c){return[parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5,7),16)]}static fade(c,n){return"rgba(".concat([...this.hexToRgb(c),n].join(","),")")}static euclideanDistance(c,n){return this.hexToRgb(c).reduce((i,s,e)=>i+Math.pow(s-this.hexToRgb(n)[e],2),0)}}function Bt(a){var s;const{theme:c,onClick:n}=a,{t:i}=ce();return v.jsx(Be,{size:"xs","aria-label":i("Colour"),mt:"0.45px",color:c==null?void 0:c[3],bg:c==null?void 0:c[2],_hover:{bg:xs.fade((s=c==null?void 0:c[2])!=null?s:"#aaaaaa",.7)},icon:v.jsx(Mn,{}),onClick:n})}function ws(a){const{interchangeList:c,onAdd:n,onDelete:i,onUpdate:s}=a,{t:e}=ce(),t=ue(),[r,d]=X.useState(),{paletteAppClipOutput:u}=Q(m=>m.app),{style:y,theme:g,stn_list:f}=Q(m=>m.param);X.useEffect(()=>{r!==void 0&&u&&(s==null||s(r,{...c[r],theme:u}),d(void 0))},[u==null?void 0:u.toString()]);const l=Object.values(f).reduce((m,_)=>{const[x,C]=m;return[[...new Set(x.concat(_.transfer.groups.map(j=>{var A,N;return(N=(A=j.lines)==null?void 0:A.map(z=>z.name[0]))!=null?N:[]}).flat()))],[...new Set(C.concat(_.transfer.groups.map(j=>{var A,N;return(N=(A=j.lines)==null?void 0:A.map(z=>z.name[1]))!=null?N:[]}).flat()))]]},[[],[]]),b=Object.fromEntries(Object.entries(xt).filter(([m])=>!["railway"].includes(m)).map(([m,_])=>[m,e(_)])),p=c.map((m,_)=>[{type:"input",label:e("Chinese name"),value:m.name[0],onChange:x=>s==null?void 0:s(_,{...m,name:[x,m.name[1]]}),optionList:l[0]},{type:"input",label:e("English name"),value:m.name[1],onChange:x=>s==null?void 0:s(_,{...m,name:[m.name[0],x]}),optionList:l[1]},{type:"select",label:e("Line icon"),value:m.facility,options:b,onChange:x=>s==null?void 0:s(_,{...m,facility:x}),hidden:![J.MTR].includes(y)}]);return v.jsxs(Me,{direction:"column",children:[c.length===0&&v.jsxs(Re,{spacing:.5,"data-testid":"interchange-card-stack",children:[v.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("StationSidePanel.interchange.noInterchanges")}),v.jsx(Be,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n({theme:[g[0],"","#aaaaaa",ct.white],name:["",""]}),icon:v.jsx(Ie,{})})]}),c.map((m,_)=>v.jsxs(Re,{spacing:.5,"data-testid":"interchange-card-stack-".concat(_),children:[v.jsx(wt,{label:e("Colour"),minW:"40px",noLabel:_!==0,children:v.jsx(Bt,{theme:m.theme,onClick:()=>{var x;d(_),t(zt((x=m.theme)!=null?x:[g[0],"","#aaaaaa",ct.white]))}})}),v.jsx(_e,{fields:p[_],noLabel:_!==0}),n&&_===p.length-1?v.jsx(Be,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(c.slice(-1)[0]),icon:v.jsx(Dn,{})}):v.jsx(ke,{minW:8}),i&&v.jsx(Be,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.remove"),onClick:()=>i==null?void 0:i(_),icon:v.jsx(Rt,{})})]},_))]})}function ks(){const{t:a}=ce(),c=ue(),n=Q(g=>g.app.selectedStation),{theme:i,style:s}=Q(g=>g.param),{transfer:e}=Q(g=>g.param.stn_list[n]),t=g=>{var f,l,b,p;return[{type:"input",label:a("Station Chinese name"),value:(l=(f=e.groups[g].name)==null?void 0:f[0])!=null?l:"",hidden:![J.MTR].includes(s),onChange:m=>{var _,x;return c(Xt(n,g,[m,(x=(_=e.groups[g].name)==null?void 0:_[1])!=null?x:""]))}},{type:"input",label:a("Station English name"),value:(p=(b=e.groups[g].name)==null?void 0:b[1])!=null?p:"",hidden:![J.MTR].includes(s),onChange:m=>{var _,x;return c(Xt(n,g,[(x=(_=e.groups[g].name)==null?void 0:_[0])!=null?x:"",m]))}},{type:"switch",label:a("Paid area"),isChecked:e.paid_area,onChange:m=>c(os(n,m)),hidden:![J.MTR].includes(s)||g===0,oneLine:!0}]},r=g=>f=>{c(Kt(n,g,f))},d=g=>f=>{c(ss(n,g,f))},u=g=>(f,l)=>{c(is(n,g,f,l))},y=()=>{c(Kt(n,e.groups.length,{theme:[i[0],"","#AAAAAA",ct.white],name:["",""]}))};return v.jsxs(Ot,{align:"flex-start",p:1,children:[v.jsxs(Te,{w:"100%",children:[v.jsx(Se,{as:"h5",size:"sm",mr:"auto",children:a("StationSidePanel.interchange.title")}),s===J.MTR&&v.jsx(Ae,{selections:[{label:a("Text on the left"),value:dt.left},{label:a("Text on the right"),value:dt.right}],defaultValue:e.tick_direc,onChange:g=>c(as(n,g))})]}),e.groups.map((g,f)=>{var l;return v.jsxs(X.Fragment,{children:[v.jsx(Se,{as:"h6",size:"xs",children:a(f===0?"StationSidePanel.interchange.within":f===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),f!==0&&v.jsx(_e,{fields:t(f)}),v.jsx(ws,{interchangeList:(l=g.lines)!=null?l:[],onAdd:r(f),onDelete:d(f),onUpdate:u(f)})]},f)}),e.groups.length<3&&v.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:v.jsx(Ie,{}),onClick:y,children:a("StationSidePanel.interchange.addGroup")})]})}function Cs(){const{t:a}=ce(),c=ue(),n=Q(m=>m.app.selectedStation),{style:i,loop:s}=Q(m=>m.param),{services:e,facility:t,loop_pivot:r,one_line:d,int_padding:u,character_spacing:y,underConstruction:g}=Q(m=>m.param.stn_list[n]),f=Object.values(Ut).map(m=>({label:a("StationSidePanel.more."+m),value:m,disabled:m===Ut.local&&i!==J.SHMetro})),l=Object.fromEntries(Object.entries(xt).filter(([m])=>!["railway"].includes(m)).map(([m,_])=>[m,a(_)])),b=Object.fromEntries(Object.entries(xt).filter(([m])=>!["np360"].includes(m)).map(([m,_])=>[m,a(_)])),p=[{type:"custom",label:a("StationSidePanel.more.service"),component:v.jsx(Ae,{selections:f,defaultValue:e,onChange:m=>c(us(n,m)),multiSelect:!0}),hidden:![J.GZMTR,J.SHMetro].includes(i)},{type:"select",label:a("StationSidePanel.more.facility"),value:t||"",options:{"":a("None"),...i===J.MTR?l:b},onChange:m=>c(hs(n,m)),hidden:![J.MTR,J.SHMetro].includes(i)},{type:"switch",label:a("StationSidePanel.more.pivot"),isChecked:r,onChange:m=>c(ps(n,m)),hidden:![J.SHMetro].includes(i)||!s,minW:"full",oneLine:!0},{type:"switch",label:a("StationSidePanel.more.oneLine"),isChecked:d,onChange:m=>c(ms(n,m)),hidden:![J.SHMetro].includes(i),minW:"full",oneLine:!0},{type:"input",label:a("StationSidePanel.more.intPadding"),value:u.toString(),validator:m=>Number.isInteger(m),onChange:m=>c(gs(n,Number(m))),hidden:![J.SHMetro].includes(i)},{type:"custom",label:a("StationSidePanel.more.intPaddingApplyGlobal"),component:v.jsx(Ae,{selections:[{label:a("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>c(bs(n))}),oneLine:!0,hidden:![J.SHMetro].includes(i)},{type:"input",label:a("StationSidePanel.more.characterSpacing"),value:y.toString(),validator:m=>Number.isInteger(m),onChange:m=>c(_s(n,Number(m))),hidden:![J.SHSuburbanRailway].includes(i)},{type:"custom",label:a("StationSidePanel.more.intPaddingApplyGlobal"),component:v.jsx(Ae,{selections:[{label:a("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>c(vs(n))}),oneLine:!0,hidden:![J.SHSuburbanRailway].includes(i)},{type:"custom",label:a("Under construction"),component:v.jsx(Ae,{selections:[{label:a("No"),value:!1},{label:a("Temporary"),value:"temp"},{label:a("Yes"),value:!0}],defaultValue:g!=null?g:!1,onChange:m=>c(fs(n,m))}),hidden:![J.GZMTR].includes(i)}];return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("StationSidePanel.more.title")}),v.jsx(_e,{fields:p})]})}function js(){const{t:a}=ce(),c=ue(),n=Q(g=>g.app.selectedStation),i=Q(g=>g.param.stn_list),{parents:s,children:e,branch:t}=i[n],r={[ht.through]:a("StationSidePanel.branch.through"),[ht.nonThrough]:a("StationSidePanel.branch.nonThrough")},d=g=>(g===ye.left?s:e).reduce((f,l)=>({...f,[l]:i[l].localisedName.zh+"/"+i[l].localisedName.en}),{}),u={upper:a("StationSidePanel.branch.upper"),lower:a("StationSidePanel.branch.lower")},y=g=>{const f=t==null?void 0:t[g];return f?[{type:"select",label:a("StationSidePanel.branch.type"),options:r,value:f[0],onChange:l=>c(ls(n,g,l))},{type:"select",label:a("StationSidePanel.branch.firstStation"),options:d(g),value:f[1],onChange:l=>c(cs(n,g,l))},{type:"select",label:a("StationSidePanel.branch.position"),options:u,value:(g===ye.left?s:e)[0]===f[1]?"upper":"lower",onChange:()=>c(ds(n,g))}]:[]};return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("Branches")}),v.jsx(Se,{as:"h6",size:"xs",children:a("Branch on the left")}),v.jsx(Me,{direction:"column",children:s.length===2?v.jsx(_e,{fields:y(ye.left)}):v.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:a("No branches found")})}),v.jsx(Se,{as:"h6",size:"xs",children:a("Branch on the right")}),v.jsx(Me,{direction:"column",children:e.length===2?v.jsx(_e,{fields:y(ye.right)}):v.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:a("No branches found")})})]})}function As(){return v.jsxs(Pt,{children:[v.jsx(Ss,{}),v.jsx(Ne,{}),v.jsx(ks,{}),v.jsx(Ne,{}),v.jsx(js,{}),v.jsx(Ne,{}),v.jsx(Cs,{})]})}function Es(){const{t:a}=ce(),c=ue(),{style:n,svgWidth:i,svg_height:s,y_pc:e,branchSpacingPct:t,padding:r,direction_gz_x:d,direction_gz_y:u,loop:y}=Q(f=>f.param),g=[...Tt[n].map(f=>({type:"input",label:a("StyleSidePanel.layout.".concat(f,"Width")),value:i[f].toString(),onChange:l=>c(Ln({width:Number(l),canvas:f}))})),{type:"input",label:a("StyleSidePanel.layout.canvasHeight"),value:s.toString(),onChange:f=>c(Fn(Number(f)))},{type:"slider",label:a("StyleSidePanel.layout.verticalPosition"),value:e,min:0,max:100,onChange:f=>c(Un(f)),leftIcon:v.jsx(kt,{}),rightIcon:v.jsx(Ct,{}),hidden:![J.MTR,J.GZMTR].includes(n)},{type:"slider",label:a(y?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:t,min:0,max:y?50:100,onChange:f=>c(Wn(f)),leftIcon:v.jsx(Wt,{}),rightIcon:v.jsx(Ie,{})},{type:"slider",label:a("StyleSidePanel.layout.padding"),value:r,min:0,max:50,onChange:f=>c(Zn(f)),leftIcon:v.jsx(Wt,{}),rightIcon:v.jsx(Ie,{})},{type:"slider",label:a("StyleSidePanel.layout.directionGzX"),value:d,min:0,max:100,onChange:f=>c(Hn(f)),leftIcon:v.jsx(cn,{}),rightIcon:v.jsx(dn,{}),hidden:![J.GZMTR].includes(n)},{type:"slider",label:a("StyleSidePanel.layout.directionGzY"),value:u,min:0,max:100,onChange:f=>c(Gn(f)),leftIcon:v.jsx(kt,{}),rightIcon:v.jsx(Ct,{}),hidden:![J.GZMTR].includes(n)}];return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("StyleSidePanel.layout.title")}),v.jsx(_e,{fields:g,minW:130})]})}function Os(){var k;const{t:a}=ce(),c=ue(),{paletteAppClipOutput:n}=Q(O=>O.app),{style:i,theme:s,line_name:e,line_num:t,spanLineNum:r,direction:d,platform_num:u,psd_num:y,coachNum:g,namePosMTR:f,customiseMTRDest:l,info_panel_type:b,stn_list:p,loop:m}=Q(O=>O.param),_=Math.max(...Object.values(p).map(O=>O.services.length)),[x,C]=X.useState(!1);X.useEffect(()=>{x&&n&&(c(Vn(n)),C(!1))},[n==null?void 0:n.toString()]);const j=[{label:a("StyleSidePanel.design.left"),value:dt.left},{label:a("StyleSidePanel.design.right"),value:dt.right}],A=Object.values(bt).reduce((O,h)=>({...O,[h]:a("StyleSidePanel.design."+h)}),{}),N=Object.values(Yn).reduce((O,h)=>({...O,[h]:a("StyleSidePanel.design."+h)}),{}),z=[{type:"custom",label:a("Colour"),component:v.jsx(Bt,{theme:s,onClick:()=>{C(!0),c(zt(s))}}),minW:"40px"},{type:"input",label:a("StyleSidePanel.design.zhLineName"),value:e[0],onChange:O=>c(Zt([O,e[1]])),minW:130},{type:"input",label:a("StyleSidePanel.design.enLineName"),value:e[1],onChange:O=>c(Zt([e[0],O])),minW:130},{type:"input",label:a("StyleSidePanel.design.lineNum"),value:t,onChange:O=>c($n(O)),hidden:![J.GZMTR].includes(i)},{type:"custom",label:a("Span digits over rows"),component:v.jsx(Ae,{selections:[{label:a("Yes"),value:!0},{label:a("No"),value:!1}],defaultValue:r!=null?r:!1,onChange:O=>c(qn(O))}),hidden:![J.GZMTR].includes(i)},{type:"input",label:a("StyleSidePanel.design.platformNum"),value:u||"",onChange:O=>c(Kn(O))},{type:"input",label:a("StyleSidePanel.design.psdNum"),value:y,onChange:O=>c(Xn(O)),hidden:![J.GZMTR].includes(i)},{type:"input",label:a("Coach number"),value:g,onChange:O=>c(Jn(O)),hidden:![J.GZMTR].includes(i)},{type:"select",label:a("StyleSidePanel.design.panelType"),value:b,options:i===J.GZMTR?A:N,disabledOptions:[bt.gz11,bt.gz1822],onChange:O=>c(Qn(O)),hidden:![J.GZMTR,J.SHMetro].includes(i)},{type:"custom",label:a("StyleSidePanel.design.direction"),component:v.jsx(Ae,{selections:j,defaultValue:d,onChange:O=>c(er(O))}),minW:"full",oneLine:!0}],M=[{label:a("StyleSidePanel.design.upwards"),value:!0},{label:a("StyleSidePanel.design.downward"),value:!1}],R=[{type:"custom",label:a("StyleSidePanel.design.firstStationNameDisplay"),component:v.jsx(Re,{spacing:.5,children:v.jsx(Ae,{selections:M,defaultValue:(k=f.isFlip)!=null?k:!0,onChange:O=>c(Ht(O))})}),minW:"full",oneLine:!0,hidden:![J.SHMetro].includes(i)||_>1||m}],L=[{label:a("StyleSidePanel.design.alternatively"),value:!0},{label:a("StyleSidePanel.design.onOneSide"),value:!1}],V=[{type:"custom",label:a("StyleSidePanel.design.nameDisplay"),component:v.jsxs(Re,{spacing:.5,children:[v.jsx(Be,{size:"xs",variant:"ghost","aria-label":a("StyleSidePanel.design.flip"),title:a("StyleSidePanel.design.flip"),icon:v.jsx(tr,{}),onClick:()=>c(Ht())}),v.jsx(Ae,{selections:L,defaultValue:f.isStagger,onChange:O=>c(nr(O))})]}),minW:"full",oneLine:!0,hidden:![J.MTR].includes(i)},{type:"switch",label:a("StyleSidePanel.design.legacyDestination"),isChecked:l.isLegacy,onChange:O=>c(rr(O)),hidden:![J.MTR].includes(i),minW:"full",oneLine:!0},{type:"switch",label:a("StyleSidePanel.design.overrideTerminal"),isChecked:l.terminal!==!1,onChange:O=>c(_t(O?["",""]:!1)),hidden:![J.MTR].includes(i),minW:"full",oneLine:!0},{type:"input",label:a("StyleSidePanel.design.terminalZhName"),value:l.terminal?l.terminal[0]:"",placeholder:"機場及博覽館",onChange:O=>c(_t([O,l.terminal?l.terminal[1]:""])),hidden:![J.MTR].includes(i)||l.terminal===!1},{type:"input",label:a("StyleSidePanel.design.terminalEnName"),value:l.terminal?l.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:O=>c(_t([l.terminal?l.terminal[0]:"",O])),hidden:![J.MTR].includes(i)||l.terminal===!1}];return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("StyleSidePanel.design.title")}),v.jsx(_e,{fields:[...z,...V,...R],minW:130})]})}function zs(){const{t:a}=ce(),c=ue(),{branches:n}=Q(b=>b.helper),{loop:i,loop_info:s,style:e}=Q(b=>b.param),{bank:t,left_and_right_factor:r,bottom_factor:d,clockwise:u}=s,y=n.flat().filter((b=>p=>(b[p]=(b[p]||0)+1)===2)({})).filter(b=>!["linestart","lineend"].includes(b)),g=Math.abs(n[0].indexOf(y[0])-n[0].indexOf(y[1])),f=n.length>=2?(0,Math.min)(n[0].length-2-g,g):Math.floor((n[0].length-2-d*2)/2),l=[{type:"switch",label:a("StyleSidePanel.loop.isLoop"),isChecked:i,onChange:b=>c(sr(b)),minW:"full",oneLine:!0},{type:"switch",label:a("StyleSidePanel.loop.isBank"),isChecked:t,onChange:b=>c(ir(b)),minW:"full",oneLine:!0,hidden:!i||e!==J.SHMetro},{type:"slider",label:a("StyleSidePanel.loop.leftRightFactor"),value:r,min:0,max:f,onChange:b=>c(ar(Math.floor(b))),hidden:!i||e!==J.SHMetro},{type:"slider",label:a("StyleSidePanel.loop.bottomFactor"),value:d,min:0,max:Math.floor((n[0].length-2-r*2)/2),onChange:b=>c(or(Math.floor(b))),hidden:!i||i&&n.length>2||e!==J.SHMetro},{type:"custom",label:a("Loop direction"),component:v.jsx(Ae,{selections:[{label:a("Anticlockwise"),value:!1},{label:a("Clockwise"),value:!0}],defaultValue:u!=null?u:!1,onChange:b=>c(lr(b))}),hidden:!i||![J.GZMTR].includes(e),oneLine:!0}];return v.jsxs(ke,{p:1,children:[v.jsxs(Se,{as:"h5",size:"sm",children:[a("StyleSidePanel.loop.title")," ",e===J.GZMTR?"(Beta)":""]}),v.jsx(_e,{fields:l})]})}function Rs(a){const{note:c,onUpdate:n,onDelete:i}=a,{t:s}=ce(),e=[{type:"textarea",label:s("StyleSidePanel.note.zhNote"),value:c[0],onChange:r=>n==null?void 0:n([r,c[1],c[2],c[3],c[4]])},{type:"textarea",label:s("StyleSidePanel.note.enNote"),value:c[1],onChange:r=>n==null?void 0:n([c[0],r,c[2],c[3],c[4]])},{type:"switch",label:s("StyleSidePanel.note.border"),isChecked:c[4],onChange:r=>n==null?void 0:n([c[0],c[1],c[2],c[3],r]),oneLine:!0}],t=[{type:"slider",label:s("StyleSidePanel.note.positionX"),value:c[2],min:0,max:100,onChange:r=>n==null?void 0:n([c[0],c[1],r,c[3],c[4]]),leftIcon:v.jsx(cn,{}),rightIcon:v.jsx(dn,{})},{type:"slider",label:s("StyleSidePanel.note.positionY"),value:c[3],min:0,max:100,onChange:r=>n==null?void 0:n([c[0],c[1],c[2],r,c[4]]),leftIcon:v.jsx(kt,{}),rightIcon:v.jsx(Ct,{})}];return v.jsxs(Me,{direction:"column",children:[v.jsx(_e,{fields:e,minW:"full"}),v.jsxs(Re,{spacing:.5,sx:{"&>div":{flex:1}},children:[v.jsx(_e,{fields:t}),v.jsx(Be,{size:"sm",variant:"ghost","aria-label":s("StyleSidePanel.note.remove"),onClick:()=>i==null?void 0:i(),icon:v.jsx(Rt,{})})]})]})}function Ps(){const{t:a}=ce(),c=ue(),n=Q(i=>i.param.notesGZMTR);return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("StyleSidePanel.note.title")}),v.jsxs(Ot,{spacing:.5,children:[n==null?void 0:n.map((i,s)=>v.jsx(Rs,{note:i,onUpdate:e=>c(cr({index:s,note:e})),onDelete:()=>c(dr(s))},s)),v.jsx(de,{size:"xs",variant:"ghost",leftIcon:v.jsx(Ie,{}),alignSelf:"flex-end",onClick:()=>c(hr()),children:a("StyleSidePanel.note.add")})]})]})}function Ts(){const{style:a}=Q(c=>c.param);return v.jsxs(Pt,{children:[v.jsx(Es,{}),v.jsx(Ne,{}),v.jsx(Os,{}),[J.GZMTR,J.SHMetro].includes(a)&&v.jsxs(v.Fragment,{children:[v.jsx(Ne,{}),v.jsx(zs,{})]}),a===J.GZMTR&&v.jsxs(v.Fragment,{children:[v.jsx(Ne,{}),v.jsx(Ps,{})]})]})}const Nt=(a,c)=>{if(["linestart","lineend"].includes(a)||c[a].parents.length>1||c[a].children.length>1)return 0;const n=c[a].parents[0];return n?c[n].children.length===1?Nt(n,c):c[n].children.indexOf(a)===0?1:-1:0},Is=a=>(c,n)=>{const{stn_list:i,current_stn_idx:s}=n().param;if(a===s)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:e,children:t}=i[a];return Object.keys(i).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):e.length===2&&t.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(i).some(d=>![a,"linestart","lineend"].includes(d)&&Nt(d,i)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Bs=a=>(c,n)=>{var r,d;const i=n().param.stn_list,{parents:s,children:e}=i[a];let t=JSON.parse(JSON.stringify(i));s.length===2||e.length===2?(s.forEach(u=>{t[u].children=e}),e.forEach(u=>{t[u].parents=s}),s.length===1&&(t[s[0]].branch={...t[s[0]].branch,right:(r=t[a].branch)==null?void 0:r.right}),e.length===1&&(t[e[0]].branch={...t[e[0]].branch,left:(d=t[a].branch)==null?void 0:d.left})):i[s[0]].children.length===2&&i[e[0]].parents.length===2?t={...i,[s[0]]:{...i[s[0]],children:i[s[0]].children.filter(u=>u!==a),branch:{...i[s[0]].branch,right:void 0}},[e[0]]:{...i[e[0]],parents:i[e[0]].parents.filter(u=>u!==a),branch:{...i[e[0]].branch,left:void 0}}}:(s.forEach(u=>{var g,f,l,b;const y=t[u].children.indexOf(a);e.length?t[u].children[y]=e[0]:t[u].children.splice(y,1),((f=(g=t[u].branch)==null?void 0:g.right)==null?void 0:f[1])===a&&(t[u].branch={...t[u].branch,right:(b=(l=t[u].branch)==null?void 0:l.right)==null?void 0:b.with(1,e[0])})}),e.forEach(u=>{var g,f,l,b;const y=t[u].parents.indexOf(a);s.length?t[u].parents[y]=s[0]:t[u].parents.splice(y,1),((f=(g=t[u].branch)==null?void 0:g.left)==null?void 0:f[1])===a&&(t[u].branch={...t[u].branch,left:(b=(l=t[u].branch)==null?void 0:l.left)==null?void 0:b.with(1,s[0])})})),delete t[a],c(we(t))};function Ns(...a){return a.reduce((c,n)=>c.map(i=>n.map(s=>i.concat([s]))).reduce((i,s)=>i.concat(s),[]),[[]])}const We=(a,c)=>!!c[a[0]].children.indexOf(a[1]),mn=(a,c)=>[a[0][1],a[0][a[0].length-2],...a[0].filter(n=>a.slice(1).filter(i=>We(i,c)).map(i=>i.filter(s=>!["linestart","lineend"].includes(s))).map(i=>[i[0],i[i.length-1]]).flat().includes(n))],Ms=(a,c)=>a.slice(1).filter(n=>We(n,c)).map(n=>n.filter(i=>!["linestart","lineend"].includes(i))).map(n=>[n[0],n[n.length-1]]),Ds=a=>(c,n)=>{const i=n().helper.branches;if(a===0){const s=n().param.stn_list,e=mn(i,s);return Ns(e,e).filter(t=>t[0]!==t[1])}else{const s=i[a];if(s){const e=s.filter(t=>!["linestart","lineend"].includes(t));return[[e[0],e.slice(-1)[0]]]}else return[]}},Ni=(a,c)=>(n,i)=>{const s=i().param.coline,e=i().helper.branches[c];for(const[t,r]of Object.entries(s))if(r.from===a&&e.includes(r.to)){const d=e.indexOf(a),u=e.indexOf(r.to);if(u>d)return[u-d+1,t]}else if(r.to===a&&e.includes(r.to)){const d=e.indexOf(a),u=e.indexOf(r.from);if(u>d)return[u-d+1,t]}return[0,void 0]},gn=(a,c)=>(n,i)=>{const s=i().param.stn_list,e=i().helper.branches;if(a===c)throw new Error("addColine():: failed for same stnId");const t=mn(e,s).filter(d=>[a,c].includes(d)),r=Ms(e,s).filter(d=>[a,c].every(u=>d.includes(u)));if(t.length===2&&r.length>0)throw new Error("addColine():: main check failed for ".concat(a,", ").concat(c));if(t.length!==2&&r.length!==1)throw new Error("addColine():: branch check failed for ".concat(a,", ").concat(c))},Ls=a=>(c,n)=>{const i=n().param.coline,e=n().helper.branches[a];return e?Object.entries(i).reduce((t,r)=>e.includes(r[1].from)&&e.includes(r[1].to)?{...t,[r[0]]:r[1]}:{...t},{}):{}},Fs=a=>(c,n)=>{const i=n().param.coline;if(Object.keys(i).length===0)return;const s=Object.entries(i).reduce((e,t)=>t[1].from!==a&&t[1].to!==a?{...e,[t[0]]:t[1]}:{...e},{});c(Fe(s))},Us=(a,c,n,i=!0)=>(s,e)=>{const t=e().param.coline;s(gn(a,c)),s(Fe({...t,[qe(4)]:{from:a,to:c,colors:n,display:i}}))},Ws=(a,c,n,i=!0)=>(s,e)=>{const t=e().param.coline;if(a in t){s(gn(c,n));const r={...t,[a]:{...t[a],from:c,to:n,display:i}};s(Fe(r))}},Zs=(a,c)=>(n,i)=>{const s=i().param.coline;if(a in s&&s[a].colors.length>c){const e=s[a].colors.filter((t,r)=>r!==c);if(e.length===0){const{[a]:t,...r}=s;n(Fe(r))}else{const t={...s,[a]:{...s[a],colors:e}};n(Fe(t))}}},Hs=(a,c,n)=>(i,s)=>{const e=s().param.coline;if(a in e&&e[a].colors.length>c){const t={...e,[a]:{...e[a],colors:e[a].colors.map((r,d)=>d===c?[0,1,2,3,4,5].map(u=>n[u]===void 0?r[u]:n[u]):r)}};i(Fe(t))}};function Gs(a){const{isOpen:c,onClose:n}=a,{t:i}=ce(),s=ue(),e=Q(u=>u.app.selectedStation),[t,r]=X.useState(!1);X.useEffect(()=>{c||r(!1)},[c]);const d=()=>{const u=s(Is(e));u?(n(),s(Ue(De.CLOSE)),s(hn("linestart")),s(Fs(e)),s(Bs(e))):r(!0),le.event(xe.REMOVE_STATION,{success:u})};return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[t&&v.jsxs(ut,{status:"error",variant:"solid",size:"xs",children:[v.jsx(ft,{}),i("Unable to remove this station.")]}),v.jsxs(ke,{position:"relative",children:[v.jsx(Qe,{children:i("Remove station")}),v.jsx(et,{})]}),v.jsx(tt,{children:i("Are you sure to remove station? You cannot undo this action.")}),v.jsxs(nt,{children:[v.jsx(de,{onClick:n,children:i("Cancel")}),v.jsx(de,{colorScheme:"primary",onClick:d,ml:3,children:i("Confirm")})]})]})]})}function Vs(){const{t:a}=ce(),c=ue(),{selectedStation:n}=Q(r=>r.app),{loop:i,style:s}=Q(r=>r.param),[e,t]=X.useState(!1);return v.jsxs(ur,{children:[v.jsxs(Re,{children:[v.jsx(de,{size:"sm",variant:"outline",onClick:()=>c(jt(n)),children:a("StationSidePanel.footer.current")}),s===J.GZMTR&&i&&v.jsx(de,{size:"sm",variant:"outline",onClick:()=>c(fr(n)),children:a("Set as midpoint")}),v.jsx(de,{size:"sm",variant:"outline",onClick:()=>t(!0),children:a("StationSidePanel.footer.remove")})]}),v.jsx(Gs,{isOpen:e,onClose:()=>t(!1)})]})}function Ys(a){const{colineInfo:c,routeOptions:n,onUpdateRoute:i,onUpdateColourInfo:s,onDelete:e}=a,{t}=ce(),r=ue(),{paletteAppClipOutput:d}=Q(l=>l.app),[u,y]=X.useState(!1);X.useEffect(()=>{u&&d&&(s==null||s([...d,c.colors[0][4],c.colors[0][5]]),y(!1))},[d==null?void 0:d.toString()]);const g=[{type:"select",label:"Route",value:[c.from,c.to].join(","),options:n,onChange:l=>i==null?void 0:i(l)}],f=[{type:"custom",label:t("Colour"),component:v.jsx(Bt,{theme:[c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3]],onClick:()=>{y(!0),r(zt(c.colors[0].slice(0,4)))}})},{type:"input",label:t("Chinese name"),value:c.colors[0][4],minW:120,onChange:l=>s==null?void 0:s([c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3],l,c.colors[0][5]])},{type:"input",label:t("English name"),value:c.colors[0][5],minW:120,onChange:l=>s==null?void 0:s([c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3],c.colors[0][4],l])}];return v.jsxs(Me,{direction:"column",children:[v.jsx(_e,{fields:g,minW:"full"}),v.jsxs(Re,{spacing:.5,children:[v.jsx(_e,{fields:f}),v.jsx(Be,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>e==null?void 0:e(0),icon:v.jsx(Rt,{})})]})]})}function $s(){const{t:a}=ce(),c=ue(),n=Q(f=>f.app.selectedBranch),{theme:i,stn_list:s}=Q(f=>f.param),e=c(Ls(n)),t=c(Ds(n)),r=f=>f.map(l=>s[l].localisedName.zh+"/"+s[l].localisedName.en).join(" ~ "),d=t.reduce((f,l)=>({...f,[l.join(",")]:r(l)}),{}),u=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(n," with default combination"),t[0]),c(Us(t[0][0],t[0][1],[[i[0],"","#AAAAAA",ct.white,"",""]]))},y=f=>l=>{const[b,p]=l.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(f,", from=").concat(b,", to=").concat(p));try{c(Ws(f,b,p))}catch(m){c(At({status:"error",message:"Unable to draw this share track."}))}},g=(f,l)=>{c(Zs(f,l))};return v.jsxs(Ot,{align:"flex-start",p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("BranchSidePanel.coline.title")}),Object.entries(e).map(([f,l])=>v.jsx(Ys,{colineInfo:l,routeOptions:d,onUpdateRoute:y(f),onUpdateColourInfo:b=>c(Hs(f,0,b)),onDelete:b=>g(f,b)},f)),(n===0||Object.keys(e).length===0)&&v.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:v.jsx(Ie,{}),onClick:u,children:a("BranchSidePanel.coline.add")})]})}function qs(a){const{isOpen:c,onClose:n}=a,{t:i}=ce(),s=ue(),e=Q(j=>j.app.selectedBranch),{style:t,stn_list:r}=Q(j=>j.param),d=Q(j=>j.helper.branches),[u,y]=X.useState(e),[g,f]=X.useState("1"),[l,b]=X.useState("2"),[p,m]=X.useState("asc");X.useEffect(()=>{y(e)},[e]);const _=[{type:"select",label:i("AutoNumModal.where"),value:u,options:{...d.reduce((j,A,N)=>({...j,[N]:N===0?i("AutoNumModal.main"):t!==J.SHMetro||!We(A,r)?i("AutoNumModal.branch")+" "+N:i("AutoNumModal.external")+" "+N}),{})},onChange:j=>y(j)},{type:"input",label:i("AutoNumModal.from"),value:g,validator:j=>!isNaN(Number(j)),onChange:f,debouncedDelay:0},{type:"input",label:i("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:l,onChange:b,debouncedDelay:0},{type:"select",label:i("AutoNumModal.sort"),value:p,options:{asc:i("AutoNumModal.asc"),desc:i("AutoNumModal.desc")},onChange:j=>m(j)}],x=()=>{s(ys(u,Number(g),Number(l),p)),n(),le.event(xe.AUTO_NUMBERING,{})},C=!g||!l||isNaN(Number(g))||isNaN(Number(l));return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[v.jsx(Qe,{children:i("AutoNumModal.title")}),v.jsx(et,{}),v.jsx(tt,{children:v.jsx(_e,{fields:_})}),v.jsx(nt,{children:v.jsx(de,{colorScheme:"primary",isDisabled:C,onClick:x,children:i("Confirm")})})]})]})}const Mt=a=>(c,n)=>{const s=n().helper.branches[a];return s.includes("linestart")||s.includes("lineend")?1:2},bn=a=>(c,n)=>{const{branches:i}=n().helper,s=i[0],e=i[a];return s.slice(s.indexOf(e[0])+1,s.indexOf(e.slice(-1)[0]))},Ks=(a,c)=>n=>n(Mt(c))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(bn(c)).includes(a)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Xs=(a,c)=>(n,i)=>{var d,u;if(!n(Ks(a,c)))return!1;const{branches:e}=i().helper,t=i().param.stn_list,r=e[c];if(r[0]==="linestart"){const y={...t,[r[1]]:{...t[r[1]],parents:[a]},[a]:{...t[a],children:t.linestart.children.map(g=>g===r[1]?g:t[a].children[0]),branch:{right:(d=t.linestart.branch)==null?void 0:d.right}},linestart:{...t.linestart,children:t.linestart.children.filter(g=>g!==r[1]),branch:{}}};return n(we(y)),!0}else{const y=r.slice(-2)[0],g={...t,[y]:{...t[y],children:[a]},[a]:{...t[a],parents:t.lineend.parents.map(f=>f===y?f:t[a].parents[0]),branch:{left:(u=t.lineend.branch)==null?void 0:u.left}},lineend:{...t.lineend,parents:t.lineend.parents.filter(f=>f!==y),branch:{}}};return n(we(g)),!0}},_n=a=>(c,n)=>{const{branches:i}=n().helper,s=n().param.stn_list,e=i[0],t=i[a];if(c(Mt(a))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const d=e.indexOf(t[0]),u=e.slice(0,d),y=e.indexOf(t.slice(-1)[0]),g=e.slice(y+1),f=u.every(b=>s[b].children.length<=1&&s[b].parents.length<=1),l=g.every(b=>s[b].children.length<=1&&s[b].parents.length<=1);return f?l?[ye.left,ye.right]:[ye.left]:l?[ye.right]:[]},Js=(a,c)=>(n,i)=>{var u,y;if(!n(_n(c)).includes(a))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:e}=i().helper,t=i().param.stn_list,r=e[0],d=e[c];if(a===ye.left){const g=d[0],f={...t,[d[1]]:{...t[d[1]],parents:["linestart"]},[g]:{...t[g],children:t[g].children.filter(l=>l!==d[1]),branch:{}},linestart:{...t.linestart,children:t[g].children.map(l=>l===d[1]?l:r[1]),branch:{right:(u=t[g].branch)==null?void 0:u.right}}};return n(we(f)),!0}else{const g=d.slice(-1)[0],f=d.slice(-2)[0],l={...t,[f]:{...t[f],children:["lineend"]},[g]:{...t[g],parents:t[g].parents.filter(b=>b!==f),branch:{}},lineend:{...t.lineend,parents:t[g].parents.map(b=>b===f?b:r.slice(-2)[0]),branch:{left:(y=t[g].branch)==null?void 0:y.left}}};return n(we(l)),!0}};function en(a){const{direction:c}=a,{t:n}=ce(),i=ue(),{branches:s}=Q(z=>z.helper),e=Q(z=>z.app.selectedBranch),{style:t,stn_list:r}=Q(z=>z.param),[d,u]=X.useState(!1),[y,g]=X.useState(""),f=s[e].filter(z=>!["linestart","lineend"].includes(z)),l=c===ye.left?f[0]:f.slice(-1)[0],b=r[l],p=i(bn(e)),m=i(Mt(e)),_=i(_n(e)),x=m===1&&!s[0].includes(l),C=_.includes(c),j=p.reduce((z,M)=>{var R,L;return{...z,[M]:((R=r[M])==null?void 0:R.localisedName.zh)+"/"+((L=r[M])==null?void 0:L.localisedName.en)}},{"":n("Please select...")}),A=()=>{const z=i(Xs(y,e));z?u(!1):i(At({status:"error",message:n("Unable to connect to main line.")})),le.event(xe.CONNECT_BRANCH,{style:t,success:z})},N=()=>{const z=i(Js(c,e));z||i(At({status:"error",message:n("Unable to disconnect from main line.")})),le.event(xe.DISCONNECT_BRANCH,{style:t,success:z})};return v.jsxs(Me,{direction:"column",children:[v.jsxs(Te,{alignItems:"center",children:[v.jsx(wt,{label:n("Station name"),flex:1,children:v.jsx(pr,{defaultValue:b.localisedName.zh+"/"+b.localisedName.en,isDisabled:!0})}),d?v.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>u(!1),children:n("Cancel")}):x?v.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>u(!0),children:n("Connect to main line")}):v.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:N,isDisabled:!C,children:n("Disconnect from main line")})]}),d&&v.jsxs(Te,{alignItems:"center",children:[v.jsx(wt,{label:n("Target station"),flex:1,children:v.jsx(mr,{defaultValue:y,options:j,disabledOptions:[""],onChange:({target:{value:z}})=>g(z)})}),v.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!y,children:n("Confirm")})]})]})}function Qs(){const{t:a}=ce(),c=ue(),n=Q(r=>r.param.style),i=Q(r=>r.app.selectedBranch),[s,e]=X.useState(!1),t=()=>{c(ts(n===J.SHMetro)),le.event(xe.REVERSE_STATIONS,{style:n})};return v.jsxs(ke,{p:1,children:[v.jsx(Se,{as:"h5",size:"sm",children:a("BranchSidePanel.action.title")}),v.jsxs(Te,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[i!==0&&n!==J.SHMetro&&v.jsxs(v.Fragment,{children:[v.jsx(Se,{as:"h6",size:"xs",children:a("Branch left end")}),v.jsx(en,{direction:ye.left}),v.jsx(Se,{as:"h6",size:"xs",children:a("Branch right end")}),v.jsx(en,{direction:ye.right})]}),n===J.GZMTR&&v.jsx(de,{size:"sm",variant:"outline",leftIcon:v.jsx(gr,{}),alignSelf:"flex-end",onClick:()=>e(!0),children:a("BranchSidePanel.action.autoNum")}),v.jsx(de,{size:"sm",variant:"outline",leftIcon:v.jsx(br,{}),alignSelf:"flex-end",onClick:t,children:n===J.SHMetro?a("BranchSidePanel.action.flip"):a("BranchSidePanel.action.reverse")})]}),v.jsx(qs,{isOpen:s,onClose:()=>e(!1)})]})}function ei(){const a=Q(s=>s.app.selectedBranch),{style:c,stn_list:n}=Q(s=>s.param),i=Q(s=>s.helper.branches);return v.jsxs(Pt,{children:[c===J.SHMetro&&(a===0||We(i[a],n))&&v.jsxs(v.Fragment,{children:[v.jsx($s,{}),v.jsx(Ne,{})]}),v.jsx(Qs,{})]})}const ti="rmg-palette-bridge--",ni={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function ri(a){const{isOpen:c,onClose:n,defaultTheme:i,onSelect:s}=a,[e]=X.useState(qe()),[t,r]=X.useState(!1),d="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:le.getAppName(),parentId:e}),u=X.useRef();return X.useEffect(()=>{const y=new BroadcastChannel(ti+e);return u.current=y,y.onmessage=g=>{const{event:f,data:l}=g.data;console.log("[rmg] Received event from Palette app clip:",f),f==="CLOSE"?n():f==="SELECT"?s(l):f==="LOADED"&&r(!0)},()=>{y.close()}},[]),X.useEffect(()=>{var y;i&&((y=u.current)==null||y.postMessage({event:"OPEN",data:i}))},[t,i==null?void 0:i.toString()]),v.jsxs(un,{size:"md",isOpen:c,onClose:n,sx:ni,children:[v.jsx(rn,{onClick:n}),v.jsx("iframe",{src:d,loading:"eager"})]})}const si=410;function ii(){var d,u;const{t:a}=ce(),c=an(),{sidePanelMode:n,selectedStation:i,paletteAppClipInput:s}=Q(y=>y.app),e=Q(y=>{var g;return(g=y.param.stn_list[i])==null?void 0:g.localisedName}),t={STATION:{header:v.jsx(Kr,{text:(e==null?void 0:e.zh)+"/"+(e==null?void 0:e.en)||""}),body:v.jsx(As,{}),footer:v.jsx(Vs,{})},STYLE:{header:a("StyleSidePanel.header"),body:v.jsx(Ts,{})},BRANCH:{header:a("BranchSidePanel.header"),body:v.jsx(ei,{})},CLOSE:{header:"Close"}},r=()=>{c(Ue(De.CLOSE))};return v.jsxs(_r,{isOpen:n!==De.CLOSE,width:si,header:"Dummy header",children:[v.jsx(vr,{onClose:r,children:t[n].header}),(d=t[n])==null?void 0:d.body,(u=t[n])==null?void 0:u.footer,v.jsx(ri,{isOpen:!!s,onClose:()=>c(yr()),defaultTheme:s,onSelect:y=>c(Sr(y))})]})}function ot(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var St={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var tn;function ai(){return tn||(tn=1,function(a,c){(function(n){a.exports=n()})(function(){return function n(i,s,e){function t(u,y){if(!s[u]){if(!i[u]){var g=typeof ot=="function"&&ot;if(!y&&g)return g(u,!0);if(r)return r(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var l=s[u]={exports:{}};i[u][0].call(l.exports,function(b){var p=i[u][1][b];return t(p||b)},l,l.exports,n,i,s,e)}return s[u].exports}for(var r=typeof ot=="function"&&ot,d=0;d<e.length;d++)t(e[d]);return t}({1:[function(n,i,s){var e=n("./utils"),t=n("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(d){for(var u,y,g,f,l,b,p,m=[],_=0,x=d.length,C=x,j=e.getTypeOf(d)!=="string";_<d.length;)C=x-_,g=j?(u=d[_++],y=_<x?d[_++]:0,_<x?d[_++]:0):(u=d.charCodeAt(_++),y=_<x?d.charCodeAt(_++):0,_<x?d.charCodeAt(_++):0),f=u>>2,l=(3&u)<<4|y>>4,b=1<C?(15&y)<<2|g>>6:64,p=2<C?63&g:64,m.push(r.charAt(f)+r.charAt(l)+r.charAt(b)+r.charAt(p));return m.join("")},s.decode=function(d){var u,y,g,f,l,b,p=0,m=0,_="data:";if(d.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===r.charAt(64)&&C--,d.charAt(d.length-2)===r.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=t.uint8array?new Uint8Array(0|C):new Array(0|C);p<d.length;)u=r.indexOf(d.charAt(p++))<<2|(f=r.indexOf(d.charAt(p++)))>>4,y=(15&f)<<4|(l=r.indexOf(d.charAt(p++)))>>2,g=(3&l)<<6|(b=r.indexOf(d.charAt(p++))),x[m++]=u,l!==64&&(x[m++]=y),b!==64&&(x[m++]=g);return x}},{"./support":30,"./utils":32}],2:[function(n,i,s){var e=n("./external"),t=n("./stream/DataWorker"),r=n("./stream/Crc32Probe"),d=n("./stream/DataLengthProbe");function u(y,g,f,l,b){this.compressedSize=y,this.uncompressedSize=g,this.crc32=f,this.compression=l,this.compressedContent=b}u.prototype={getContentWorker:function(){var y=new t(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),g=this;return y.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),y},getCompressedWorker:function(){return new t(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(y,g,f){return y.pipe(new r).pipe(new d("uncompressedSize")).pipe(g.compressWorker(f)).pipe(new d("compressedSize")).withStreamInfo("compression",g)},i.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,i,s){var e=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,i,s){var e=n("./utils"),t=function(){for(var r,d=[],u=0;u<256;u++){r=u;for(var y=0;y<8;y++)r=1&r?3988292384^r>>>1:r>>>1;d[u]=r}return d}();i.exports=function(r,d){return r!==void 0&&r.length?e.getTypeOf(r)!=="string"?function(u,y,g,f){var l=t,b=f+g;u^=-1;for(var p=f;p<b;p++)u=u>>>8^l[255&(u^y[p])];return-1^u}(0|d,r,r.length,0):function(u,y,g,f){var l=t,b=f+g;u^=-1;for(var p=f;p<b;p++)u=u>>>8^l[255&(u^y.charCodeAt(p))];return-1^u}(0|d,r,r.length,0):0}},{"./utils":32}],5:[function(n,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,i,s){var e=null;e=typeof Promise<"u"?Promise:n("lie"),i.exports={Promise:e}},{lie:37}],7:[function(n,i,s){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",t=n("pako"),r=n("./utils"),d=n("./stream/GenericWorker"),u=e?"uint8array":"array";function y(g,f){d.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=f,this.meta={}}s.magic="\b\0",r.inherits(y,d),y.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(u,g.data),!1)},y.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},y.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},y.prototype._createPako=function(){this._pako=new t[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(f){g.push({data:f,meta:g.meta})}},s.compressWorker=function(g){return new y("Deflate",g)},s.uncompressWorker=function(){return new y("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,i,s){function e(l,b){var p,m="";for(p=0;p<b;p++)m+=String.fromCharCode(255&l),l>>>=8;return m}function t(l,b,p,m,_,x){var C,j,A=l.file,N=l.compression,z=x!==u.utf8encode,M=r.transformTo("string",x(A.name)),R=r.transformTo("string",u.utf8encode(A.name)),L=A.comment,V=r.transformTo("string",x(L)),k=r.transformTo("string",u.utf8encode(L)),O=R.length!==A.name.length,h=k.length!==L.length,D="",ne="",Z="",se=A.dir,H=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};b&&!p||(re.crc32=l.crc32,re.compressedSize=l.compressedSize,re.uncompressedSize=l.uncompressedSize);var I=0;b&&(I|=8),z||!O&&!h||(I|=2048);var T=0,te=0;se&&(T|=16),_==="UNIX"?(te=798,T|=function($,fe){var ve=$;return $||(ve=fe?16893:33204),(65535&ve)<<16}(A.unixPermissions,se)):(te=20,T|=function($){return 63&($||0)}(A.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,j=H.getUTCFullYear()-1980,j<<=4,j|=H.getUTCMonth()+1,j<<=5,j|=H.getUTCDate(),O&&(ne=e(1,1)+e(y(M),4)+R,D+="up"+e(ne.length,2)+ne),h&&(Z=e(1,1)+e(y(V),4)+k,D+="uc"+e(Z.length,2)+Z);var q="";return q+="\n\0",q+=e(I,2),q+=N.magic,q+=e(C,2),q+=e(j,2),q+=e(re.crc32,4),q+=e(re.compressedSize,4),q+=e(re.uncompressedSize,4),q+=e(M.length,2),q+=e(D.length,2),{fileRecord:g.LOCAL_FILE_HEADER+q+M+D,dirRecord:g.CENTRAL_FILE_HEADER+e(te,2)+q+e(V.length,2)+"\0\0\0\0"+e(T,4)+e(m,4)+M+D+V}}var r=n("../utils"),d=n("../stream/GenericWorker"),u=n("../utf8"),y=n("../crc32"),g=n("../signature");function f(l,b,p,m){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=p,this.encodeFileName=m,this.streamFiles=l,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(f,d),f.prototype.push=function(l){var b=l.meta.percent||0,p=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(l):(this.bytesWritten+=l.data.length,d.prototype.push.call(this,{data:l.data,meta:{currentFile:this.currentFile,percent:p?(b+100*(p-m-1))/p:100}}))},f.prototype.openedSource=function(l){this.currentSourceOffset=this.bytesWritten,this.currentFile=l.file.name;var b=this.streamFiles&&!l.file.dir;if(b){var p=t(l,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(l){this.accumulate=!1;var b=this.streamFiles&&!l.file.dir,p=t(l,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),b)this.push({data:function(m){return g.DATA_DESCRIPTOR+e(m.crc32,4)+e(m.compressedSize,4)+e(m.uncompressedSize,4)}(l),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var l=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var p=this.bytesWritten-l,m=function(_,x,C,j,A){var N=r.transformTo("string",A(j));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+e(_,2)+e(_,2)+e(x,4)+e(C,4)+e(N.length,2)+N}(this.dirRecords.length,p,l,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(l){this._sources.push(l);var b=this;return l.on("data",function(p){b.processChunk(p)}),l.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),l.on("error",function(p){b.error(p)}),this},f.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(l){var b=this._sources;if(!d.prototype.error.call(this,l))return!1;for(var p=0;p<b.length;p++)try{b[p].error(l)}catch(m){}return!0},f.prototype.lock=function(){d.prototype.lock.call(this);for(var l=this._sources,b=0;b<l.length;b++)l[b].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,i,s){var e=n("../compressions"),t=n("./ZipFileWorker");s.generateWorker=function(r,d,u){var y=new t(d.streamFiles,u,d.platform,d.encodeFileName),g=0;try{r.forEach(function(f,l){g++;var b=function(x,C){var j=x||C,A=e[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(l.options.compression,d.compression),p=l.options.compressionOptions||d.compressionOptions||{},m=l.dir,_=l.date;l._compressWorker(b,p).withStreamInfo("file",{name:f,dir:m,date:_,comment:l.comment||"",unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions}).pipe(y)}),y.entriesCount=g}catch(f){y.error(f)}return y}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,i,s){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new e;for(var r in this)typeof this[r]!="function"&&(t[r]=this[r]);return t}}(e.prototype=n("./object")).loadAsync=n("./load"),e.support=n("./support"),e.defaults=n("./defaults"),e.version="3.10.1",e.loadAsync=function(t,r){return new e().loadAsync(t,r)},e.external=n("./external"),i.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,i,s){var e=n("./utils"),t=n("./external"),r=n("./utf8"),d=n("./zipEntries"),u=n("./stream/Crc32Probe"),y=n("./nodejsUtils");function g(f){return new t.Promise(function(l,b){var p=f.decompressed.getContentWorker().pipe(new u);p.on("error",function(m){b(m)}).on("end",function(){p.streamInfo.crc32!==f.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):l()}).resume()})}i.exports=function(f,l){var b=this;return l=e.extend(l||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),y.isNode&&y.isStream(f)?t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",f,!0,l.optimizedBinaryString,l.base64).then(function(p){var m=new d(l);return m.load(p),m}).then(function(p){var m=[t.Promise.resolve(p)],_=p.files;if(l.checkCRC32)for(var x=0;x<_.length;x++)m.push(g(_[x]));return t.Promise.all(m)}).then(function(p){for(var m=p.shift(),_=m.files,x=0;x<_.length;x++){var C=_[x],j=C.fileNameStr,A=e.resolve(C.fileNameStr);b.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:l.createFolders}),C.dir||(b.file(A).unsafeOriginalName=j)}return m.zipComment.length&&(b.comment=m.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,i,s){var e=n("../utils"),t=n("../stream/GenericWorker");function r(d,u){t.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(u)}e.inherits(r,t),r.prototype._bindStream=function(d){var u=this;(this._stream=d).pause(),d.on("data",function(y){u.push({data:y,meta:{percent:0}})}).on("error",function(y){u.isPaused?this.generatedError=y:u.error(y)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},r.prototype.pause=function(){return!!t.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,i,s){var e=n("readable-stream").Readable;function t(r,d,u){e.call(this,d),this._helper=r;var y=this;r.on("data",function(g,f){y.push(g)||y._helper.pause(),u&&u(f)}).on("error",function(g){y.emit("error",g)}).on("end",function(){y.push(null)})}n("../utils").inherits(t,e),t.prototype._read=function(){this._helper.resume()},i.exports=t},{"../utils":32,"readable-stream":16}],14:[function(n,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}},{}],15:[function(n,i,s){function e(A,N,z){var M,R=r.getTypeOf(N),L=r.extend(z||{},y);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(A=_(A)),L.createFolders&&(M=m(A))&&x.call(this,M,!0);var V=R==="string"&&L.binary===!1&&L.base64===!1;z&&z.binary!==void 0||(L.binary=!V),(N instanceof g&&N.uncompressedSize===0||L.dir||!N||N.length===0)&&(L.base64=!1,L.binary=!0,N="",L.compression="STORE",R="string");var k=null;k=N instanceof g||N instanceof d?N:b.isNode&&b.isStream(N)?new p(A,N):r.prepareContent(A,N,L.binary,L.optimizedBinaryString,L.base64);var O=new f(A,k,L);this.files[A]=O}var t=n("./utf8"),r=n("./utils"),d=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),y=n("./defaults"),g=n("./compressedObject"),f=n("./zipObject"),l=n("./generate"),b=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),m=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var N=A.lastIndexOf("/");return 0<N?A.substring(0,N):""},_=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,N){return N=N!==void 0?N:y.createFolders,A=_(A),this.files[A]||e.call(this,A,null,{dir:!0,createFolders:N}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var N,z,M;for(N in this.files)M=this.files[N],(z=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&A(z,M)},filter:function(A){var N=[];return this.forEach(function(z,M){A(z,M)&&N.push(M)}),N},file:function(A,N,z){if(arguments.length!==1)return A=this.root+A,e.call(this,A,N,z),this;if(C(A)){var M=A;return this.filter(function(L,V){return!V.dir&&M.test(L)})}var R=this.files[this.root+A];return R&&!R.dir?R:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(R,L){return L.dir&&A.test(R)});var N=this.root+A,z=x.call(this,N),M=this.clone();return M.root=z.name,M},remove:function(A){A=this.root+A;var N=this.files[A];if(N||(A.slice(-1)!=="/"&&(A+="/"),N=this.files[A]),N&&!N.dir)delete this.files[A];else for(var z=this.filter(function(R,L){return L.name.slice(0,A.length)===A}),M=0;M<z.length;M++)delete this.files[z[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var N,z={};try{if((z=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:t.utf8encode})).type=z.type.toLowerCase(),z.compression=z.compression.toUpperCase(),z.type==="binarystring"&&(z.type="string"),!z.type)throw new Error("No output type specified.");r.checkSupport(z.type),z.platform!=="darwin"&&z.platform!=="freebsd"&&z.platform!=="linux"&&z.platform!=="sunos"||(z.platform="UNIX"),z.platform==="win32"&&(z.platform="DOS");var M=z.comment||this.comment||"";N=l.generateWorker(this,z,M)}catch(R){(N=new d("error")).error(R)}return new u(N,z.type||"string",z.mimeType)},generateAsync:function(A,N){return this.generateInternalStream(A).accumulate(N)},generateNodeStream:function(A,N){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(N)}};i.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,i,s){i.exports=n("stream")},{stream:void 0}],17:[function(n,i,s){var e=n("./DataReader");function t(r){e.call(this,r);for(var d=0;d<this.data.length;d++)r[d]=255&r[d]}n("../utils").inherits(t,e),t.prototype.byteAt=function(r){return this.data[this.zero+r]},t.prototype.lastIndexOfSignature=function(r){for(var d=r.charCodeAt(0),u=r.charCodeAt(1),y=r.charCodeAt(2),g=r.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===d&&this.data[f+1]===u&&this.data[f+2]===y&&this.data[f+3]===g)return f-this.zero;return-1},t.prototype.readAndCheckSignature=function(r){var d=r.charCodeAt(0),u=r.charCodeAt(1),y=r.charCodeAt(2),g=r.charCodeAt(3),f=this.readData(4);return d===f[0]&&u===f[1]&&y===f[2]&&g===f[3]},t.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=t},{"../utils":32,"./DataReader":18}],18:[function(n,i,s){var e=n("../utils");function t(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}t.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var d,u=0;for(this.checkOffset(r),d=this.index+r-1;d>=this.index;d--)u=(u<<8)+this.byteAt(d);return this.index+=r,u},readString:function(r){return e.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},i.exports=t},{"../utils":32}],19:[function(n,i,s){var e=n("./Uint8ArrayReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=t},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,i,s){var e=n("./DataReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},t.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},t.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},t.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=t},{"../utils":32,"./DataReader":18}],21:[function(n,i,s){var e=n("./ArrayReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=t},{"../utils":32,"./ArrayReader":17}],22:[function(n,i,s){var e=n("../utils"),t=n("../support"),r=n("./ArrayReader"),d=n("./StringReader"),u=n("./NodeBufferReader"),y=n("./Uint8ArrayReader");i.exports=function(g){var f=e.getTypeOf(g);return e.checkSupport(f),f!=="string"||t.uint8array?f==="nodebuffer"?new u(g):t.uint8array?new y(e.transformTo("uint8array",g)):new r(e.transformTo("array",g)):new d(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,i,s){var e=n("./GenericWorker"),t=n("../utils");function r(d){e.call(this,"ConvertWorker to "+d),this.destType=d}t.inherits(r,e),r.prototype.processChunk=function(d){this.push({data:t.transformTo(this.destType,d.data),meta:d.meta})},i.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(n,i,s){var e=n("./GenericWorker"),t=n("../crc32");function r(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(r,e),r.prototype.processChunk=function(d){this.streamInfo.crc32=t(d.data,this.streamInfo.crc32||0),this.push(d)},i.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,i,s){var e=n("../utils"),t=n("./GenericWorker");function r(d){t.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}e.inherits(r,t),r.prototype.processChunk=function(d){if(d){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+d.data.length}t.prototype.processChunk.call(this,d)},i.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(n,i,s){var e=n("../utils"),t=n("./GenericWorker");function r(d){t.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(y){u.dataIsReady=!0,u.data=y,u.max=y&&y.length||0,u.type=e.getTypeOf(y),u.isPaused||u._tickAndRepeat()},function(y){u.error(y)})}e.inherits(r,t),r.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,u);break;case"uint8array":d=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":d=this.data.slice(this.index,u)}return this.index=u,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(n,i,s){function e(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}e.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,r){return this._listeners[t].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,r){if(this._listeners[t])for(var d=0;d<this._listeners[t].length;d++)this._listeners[t][d].call(this,r)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var r=this;return t.on("data",function(d){r.processChunk(d)}),t.on("end",function(){r.end()}),t.on("error",function(d){r.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,r){return this.extraStreamInfo[t]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},i.exports=e},{}],29:[function(n,i,s){var e=n("../utils"),t=n("./ConvertWorker"),r=n("./GenericWorker"),d=n("../base64"),u=n("../support"),y=n("../external"),g=null;if(u.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch(b){}function f(b,p){return new y.Promise(function(m,_){var x=[],C=b._internalType,j=b._outputType,A=b._mimeType;b.on("data",function(N,z){x.push(N),p&&p(z)}).on("error",function(N){x=[],_(N)}).on("end",function(){try{var N=function(z,M,R){switch(z){case"blob":return e.newBlob(e.transformTo("arraybuffer",M),R);case"base64":return d.encode(M);default:return e.transformTo(z,M)}}(j,function(z,M){var R,L=0,V=null,k=0;for(R=0;R<M.length;R++)k+=M[R].length;switch(z){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(V=new Uint8Array(k),R=0;R<M.length;R++)V.set(M[R],L),L+=M[R].length;return V;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+z+"'")}}(C,x),A);m(N)}catch(z){_(z)}x=[]}).resume()})}function l(b,p,m){var _=p;switch(p){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=p,this._mimeType=m,e.checkSupport(_),this._worker=b.pipe(new t(_)),b.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}l.prototype={accumulate:function(b){return f(this,b)},on:function(b,p){var m=this;return b==="data"?this._worker.on(b,function(_){p.call(m,_.data,_.meta)}):this._worker.on(b,function(){e.delay(p,arguments,m)}),this},resume:function(){return e.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(e.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},b)}},i.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var e=new ArrayBuffer(0);try{s.blob=new Blob([e],{type:"application/zip"}).size===0}catch(r){try{var t=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);t.append(e),s.blob=t.getBlob("application/zip").size===0}catch(d){s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch(r){s.nodestream=!1}},{"readable-stream":16}],31:[function(n,i,s){for(var e=n("./utils"),t=n("./support"),r=n("./nodejsUtils"),d=n("./stream/GenericWorker"),u=new Array(256),y=0;y<256;y++)u[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;u[254]=u[254]=1;function g(){d.call(this,"utf-8 decode"),this.leftOver=null}function f(){d.call(this,"utf-8 encode")}s.utf8encode=function(l){return t.nodebuffer?r.newBufferFrom(l,"utf-8"):function(b){var p,m,_,x,C,j=b.length,A=0;for(x=0;x<j;x++)(64512&(m=b.charCodeAt(x)))==55296&&x+1<j&&(64512&(_=b.charCodeAt(x+1)))==56320&&(m=65536+(m-55296<<10)+(_-56320),x++),A+=m<128?1:m<2048?2:m<65536?3:4;for(p=t.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(m=b.charCodeAt(x)))==55296&&x+1<j&&(64512&(_=b.charCodeAt(x+1)))==56320&&(m=65536+(m-55296<<10)+(_-56320),x++),m<128?p[C++]=m:(m<2048?p[C++]=192|m>>>6:(m<65536?p[C++]=224|m>>>12:(p[C++]=240|m>>>18,p[C++]=128|m>>>12&63),p[C++]=128|m>>>6&63),p[C++]=128|63&m);return p}(l)},s.utf8decode=function(l){return t.nodebuffer?e.transformTo("nodebuffer",l).toString("utf-8"):function(b){var p,m,_,x,C=b.length,j=new Array(2*C);for(p=m=0;p<C;)if((_=b[p++])<128)j[m++]=_;else if(4<(x=u[_]))j[m++]=65533,p+=x-1;else{for(_&=x===2?31:x===3?15:7;1<x&&p<C;)_=_<<6|63&b[p++],x--;1<x?j[m++]=65533:_<65536?j[m++]=_:(_-=65536,j[m++]=55296|_>>10&1023,j[m++]=56320|1023&_)}return j.length!==m&&(j.subarray?j=j.subarray(0,m):j.length=m),e.applyFromCharCode(j)}(l=e.transformTo(t.uint8array?"uint8array":"array",l))},e.inherits(g,d),g.prototype.processChunk=function(l){var b=e.transformTo(t.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(t.uint8array){var p=b;(b=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),b.set(p,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var m=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+u[x[j]]>C?j:C}(b),_=b;m!==b.length&&(t.uint8array?(_=b.subarray(0,m),this.leftOver=b.subarray(m,b.length)):(_=b.slice(0,m),this.leftOver=b.slice(m,b.length))),this.push({data:s.utf8decode(_),meta:l.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=g,e.inherits(f,d),f.prototype.processChunk=function(l){this.push({data:s.utf8encode(l.data),meta:l.meta})},s.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,i,s){var e=n("./support"),t=n("./base64"),r=n("./nodejsUtils"),d=n("./external");function u(p){return p}function y(p,m){for(var _=0;_<p.length;++_)m[_]=255&p.charCodeAt(_);return m}n("setimmediate"),s.newBlob=function(p,m){s.checkSupport("blob");try{return new Blob([p],{type:m})}catch(x){try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(p),_.getBlob(m)}catch(C){throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(p,m,_){var x=[],C=0,j=p.length;if(j<=_)return String.fromCharCode.apply(null,p);for(;C<j;)m==="array"||m==="nodebuffer"?x.push(String.fromCharCode.apply(null,p.slice(C,Math.min(C+_,j)))):x.push(String.fromCharCode.apply(null,p.subarray(C,Math.min(C+_,j)))),C+=_;return x.join("")},stringifyByChar:function(p){for(var m="",_=0;_<p.length;_++)m+=String.fromCharCode(p[_]);return m},applyCanBeUsed:{uint8array:function(){try{return e.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(p){return!1}}(),nodebuffer:function(){try{return e.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch(p){return!1}}()}};function f(p){var m=65536,_=s.getTypeOf(p),x=!0;if(_==="uint8array"?x=g.applyCanBeUsed.uint8array:_==="nodebuffer"&&(x=g.applyCanBeUsed.nodebuffer),x)for(;1<m;)try{return g.stringifyByChunk(p,_,m)}catch(C){m=Math.floor(m/2)}return g.stringifyByChar(p)}function l(p,m){for(var _=0;_<p.length;_++)m[_]=p[_];return m}s.applyFromCharCode=f;var b={};b.string={string:u,array:function(p){return y(p,new Array(p.length))},arraybuffer:function(p){return b.string.uint8array(p).buffer},uint8array:function(p){return y(p,new Uint8Array(p.length))},nodebuffer:function(p){return y(p,r.allocBuffer(p.length))}},b.array={string:f,array:u,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return r.newBufferFrom(p)}},b.arraybuffer={string:function(p){return f(new Uint8Array(p))},array:function(p){return l(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:u,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return r.newBufferFrom(new Uint8Array(p))}},b.uint8array={string:f,array:function(p){return l(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:u,nodebuffer:function(p){return r.newBufferFrom(p)}},b.nodebuffer={string:f,array:function(p){return l(p,new Array(p.length))},arraybuffer:function(p){return b.nodebuffer.uint8array(p).buffer},uint8array:function(p){return l(p,new Uint8Array(p.length))},nodebuffer:u},s.transformTo=function(p,m){if(m=m||"",!p)return m;s.checkSupport(p);var _=s.getTypeOf(m);return b[_][p](m)},s.resolve=function(p){for(var m=p.split("/"),_=[],x=0;x<m.length;x++){var C=m[x];C==="."||C===""&&x!==0&&x!==m.length-1||(C===".."?_.pop():_.push(C))}return _.join("/")},s.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":e.nodebuffer&&r.isBuffer(p)?"nodebuffer":e.uint8array&&p instanceof Uint8Array?"uint8array":e.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(p){if(!e[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(p){var m,_,x="";for(_=0;_<(p||"").length;_++)x+="\\x"+((m=p.charCodeAt(_))<16?"0":"")+m.toString(16).toUpperCase();return x},s.delay=function(p,m,_){setImmediate(function(){p.apply(_||null,m||[])})},s.inherits=function(p,m){function _(){}_.prototype=m.prototype,p.prototype=new _},s.extend=function(){var p,m,_={};for(p=0;p<arguments.length;p++)for(m in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],m)&&_[m]===void 0&&(_[m]=arguments[p][m]);return _},s.prepareContent=function(p,m,_,x,C){return d.Promise.resolve(m).then(function(j){return e.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new d.Promise(function(A,N){var z=new FileReader;z.onload=function(M){A(M.target.result)},z.onerror=function(M){N(M.target.error)},z.readAsArrayBuffer(j)}):j}).then(function(j){var A=s.getTypeOf(j);return A?(A==="arraybuffer"?j=s.transformTo("uint8array",j):A==="string"&&(C?j=t.decode(j):_&&x!==!0&&(j=function(N){return y(N,e.uint8array?new Uint8Array(N.length):new Array(N.length))}(j))),j):d.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,i,s){var e=n("./reader/readerFor"),t=n("./utils"),r=n("./signature"),d=n("./zipEntry"),u=n("./support");function y(g){this.files=[],this.loadOptions=g}y.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+t.pretty(f)+", expected "+t.pretty(g)+")")}},isSignature:function(g,f){var l=this.reader.index;this.reader.setIndex(g);var b=this.reader.readString(4)===f;return this.reader.setIndex(l),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",l=t.transformTo(f,g);this.zipComment=this.loadOptions.decodeFileName(l)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,f,l,b=this.zip64EndOfCentralSize-44;0<b;)g=this.reader.readInt(2),f=this.reader.readInt(4),l=this.reader.readData(f),this.zip64ExtensibleData[g]={id:g,length:f,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,f;for(g=0;g<this.files.length;g++)f=this.files[g],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(g=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var f=g;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var l=this.centralDirOffset+this.centralDirSize;this.zip64&&(l+=20,l+=12+this.zip64EndOfCentralSize);var b=f-l;if(0<b)this.isSignature(f,r.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(g){this.reader=e(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=y},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,i,s){var e=n("./reader/readerFor"),t=n("./utils"),r=n("./compressedObject"),d=n("./crc32"),u=n("./utf8"),y=n("./compressions"),g=n("./support");function f(l,b){this.options=l,this.loadOptions=b}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(l){var b,p;if(l.skip(22),this.fileNameLength=l.readInt(2),p=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(m){for(var _ in y)if(Object.prototype.hasOwnProperty.call(y,_)&&y[_].magic===m)return y[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+t.pretty(this.compressionMethod)+" unknown (inner file : "+t.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,b,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var b=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(b),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),l==0&&(this.dosPermissions=63&this.externalFileAttributes),l==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var l=e(this.extraFields[1].value);this.uncompressedSize===t.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===t.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===t.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===t.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4))}},readExtraFields:function(l){var b,p,m,_=l.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});l.index+4<_;)b=l.readInt(2),p=l.readInt(2),m=l.readData(p),this.extraFields[b]={id:b,length:p,value:m};l.setIndex(_)},handleUTF8:function(){var l=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var p=t.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var _=t.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var b=e(l.value);return b.readInt(1)!==1||d(this.fileName)!==b.readInt(4)?null:u.utf8decode(b.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var b=e(l.value);return b.readInt(1)!==1||d(this.fileComment)!==b.readInt(4)?null:u.utf8decode(b.readData(l.length-5))}return null}},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,i,s){function e(b,p,m){this.name=b,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=p,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var t=n("./stream/StreamHelper"),r=n("./stream/DataWorker"),d=n("./utf8"),u=n("./compressedObject"),y=n("./stream/GenericWorker");e.prototype={internalStream:function(b){var p=null,m="string";try{if(!b)throw new Error("No output type specified.");var _=(m=b.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),p=this._decompressWorker();var x=!this._dataBinary;x&&!_&&(p=p.pipe(new d.Utf8EncodeWorker)),!x&&_&&(p=p.pipe(new d.Utf8DecodeWorker))}catch(C){(p=new y("error")).error(C)}return new t(p,m,"")},async:function(b,p){return this.internalStream(b).accumulate(p)},nodeStream:function(b,p){return this.internalStream(b||"nodebuffer").toNodejsStream(p)},_compressWorker:function(b,p){if(this._data instanceof u&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new d.Utf8EncodeWorker)),u.createWorkerFrom(m,b,p)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof y?this._data:new r(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<g.length;l++)e.prototype[g[l]]=f;i.exports=e},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,i,s){(function(e){var t,r,d=e.MutationObserver||e.WebKitMutationObserver;if(d){var u=0,y=new d(b),g=e.document.createTextNode("");y.observe(g,{characterData:!0}),t=function(){g.data=u=++u%2}}else if(e.setImmediate||e.MessageChannel===void 0)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var p=e.document.createElement("script");p.onreadystatechange=function(){b(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},e.document.documentElement.appendChild(p)}:function(){setTimeout(b,0)};else{var f=new e.MessageChannel;f.port1.onmessage=b,t=function(){f.port2.postMessage(0)}}var l=[];function b(){var p,m;r=!0;for(var _=l.length;_;){for(m=l,l=[],p=-1;++p<_;)m[p]();_=l.length}r=!1}i.exports=function(p){l.push(p)!==1||r||t()}}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,i,s){var e=n("immediate");function t(){}var r={},d=["REJECTED"],u=["FULFILLED"],y=["PENDING"];function g(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=y,this.queue=[],this.outcome=void 0,_!==t&&p(this,_)}function f(_,x,C){this.promise=_,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function l(_,x,C){e(function(){var j;try{j=x(C)}catch(A){return r.reject(_,A)}j===_?r.reject(_,new TypeError("Cannot resolve promise with itself")):r.resolve(_,j)})}function b(_){var x=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof x=="function")return function(){x.apply(_,arguments)}}function p(_,x){var C=!1;function j(z){C||(C=!0,r.reject(_,z))}function A(z){C||(C=!0,r.resolve(_,z))}var N=m(function(){x(A,j)});N.status==="error"&&j(N.value)}function m(_,x){var C={};try{C.value=_(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(i.exports=g).prototype.finally=function(_){if(typeof _!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(_()).then(function(){return C})},function(C){return x.resolve(_()).then(function(){throw C})})},g.prototype.catch=function(_){return this.then(null,_)},g.prototype.then=function(_,x){if(typeof _!="function"&&this.state===u||typeof x!="function"&&this.state===d)return this;var C=new this.constructor(t);return this.state!==y?l(C,this.state===u?_:x,this.outcome):this.queue.push(new f(C,_,x)),C},f.prototype.callFulfilled=function(_){r.resolve(this.promise,_)},f.prototype.otherCallFulfilled=function(_){l(this.promise,this.onFulfilled,_)},f.prototype.callRejected=function(_){r.reject(this.promise,_)},f.prototype.otherCallRejected=function(_){l(this.promise,this.onRejected,_)},r.resolve=function(_,x){var C=m(b,x);if(C.status==="error")return r.reject(_,C.value);var j=C.value;if(j)p(_,j);else{_.state=u,_.outcome=x;for(var A=-1,N=_.queue.length;++A<N;)_.queue[A].callFulfilled(x)}return _},r.reject=function(_,x){_.state=d,_.outcome=x;for(var C=-1,j=_.queue.length;++C<j;)_.queue[C].callRejected(x);return _},g.resolve=function(_){return _ instanceof this?_:r.resolve(new this(t),_)},g.reject=function(_){var x=new this(t);return r.reject(x,_)},g.all=function(_){var x=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=_.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),N=0,z=-1,M=new this(t);++z<C;)R(_[z],z);return M;function R(L,V){x.resolve(L).then(function(k){A[V]=k,++N!==C||j||(j=!0,r.resolve(M,A))},function(k){j||(j=!0,r.reject(M,k))})}},g.race=function(_){var x=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=_.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,N=new this(t);++A<C;)z=_[A],x.resolve(z).then(function(M){j||(j=!0,r.resolve(N,M))},function(M){j||(j=!0,r.reject(N,M))});var z;return N}},{immediate:36}],38:[function(n,i,s){var e={};(0,n("./lib/utils/common").assign)(e,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),i.exports=e},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,i,s){var e=n("./zlib/deflate"),t=n("./utils/common"),r=n("./utils/strings"),d=n("./zlib/messages"),u=n("./zlib/zstream"),y=Object.prototype.toString,g=0,f=-1,l=0,b=8;function p(_){if(!(this instanceof p))return new p(_);this.options=t.assign({level:f,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},_||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=e.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==g)throw new Error(d[C]);if(x.header&&e.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?r.string2buf(x.dictionary):y.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=e.deflateSetDictionary(this.strm,j))!==g)throw new Error(d[C]);this._dict_set=!0}}function m(_,x){var C=new p(x);if(C.push(_,!0),C.err)throw C.msg||d[C.err];return C.result}p.prototype.push=function(_,x){var C,j,A=this.strm,N=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof _=="string"?A.input=r.string2buf(_):y.call(_)==="[object ArrayBuffer]"?A.input=new Uint8Array(_):A.input=_,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new t.Buf8(N),A.next_out=0,A.avail_out=N),(C=e.deflate(A,j))!==1&&C!==g)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(t.shrinkBuf(A.output,A.next_out))):this.onData(t.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=e.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===g):j!==2||(this.onEnd(g),!(A.avail_out=0))},p.prototype.onData=function(_){this.chunks.push(_)},p.prototype.onEnd=function(_){_===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},s.Deflate=p,s.deflate=m,s.deflateRaw=function(_,x){return(x=x||{}).raw=!0,m(_,x)},s.gzip=function(_,x){return(x=x||{}).gzip=!0,m(_,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,i,s){var e=n("./zlib/inflate"),t=n("./utils/common"),r=n("./utils/strings"),d=n("./zlib/constants"),u=n("./zlib/messages"),y=n("./zlib/zstream"),g=n("./zlib/gzheader"),f=Object.prototype.toString;function l(p){if(!(this instanceof l))return new l(p);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},p||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||p&&p.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var _=e.inflateInit2(this.strm,m.windowBits);if(_!==d.Z_OK)throw new Error(u[_]);this.header=new g,e.inflateGetHeader(this.strm,this.header)}function b(p,m){var _=new l(m);if(_.push(p,!0),_.err)throw _.msg||u[_.err];return _.result}l.prototype.push=function(p,m){var _,x,C,j,A,N,z=this.strm,M=this.options.chunkSize,R=this.options.dictionary,L=!1;if(this.ended)return!1;x=m===~~m?m:m===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof p=="string"?z.input=r.binstring2buf(p):f.call(p)==="[object ArrayBuffer]"?z.input=new Uint8Array(p):z.input=p,z.next_in=0,z.avail_in=z.input.length;do{if(z.avail_out===0&&(z.output=new t.Buf8(M),z.next_out=0,z.avail_out=M),(_=e.inflate(z,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&R&&(N=typeof R=="string"?r.string2buf(R):f.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,_=e.inflateSetDictionary(this.strm,N)),_===d.Z_BUF_ERROR&&L===!0&&(_=d.Z_OK,L=!1),_!==d.Z_STREAM_END&&_!==d.Z_OK)return this.onEnd(_),!(this.ended=!0);z.next_out&&(z.avail_out!==0&&_!==d.Z_STREAM_END&&(z.avail_in!==0||x!==d.Z_FINISH&&x!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=r.utf8border(z.output,z.next_out),j=z.next_out-C,A=r.buf2string(z.output,C),z.next_out=j,z.avail_out=M-j,j&&t.arraySet(z.output,z.output,C,j,0),this.onData(A)):this.onData(t.shrinkBuf(z.output,z.next_out)))),z.avail_in===0&&z.avail_out===0&&(L=!0)}while((0<z.avail_in||z.avail_out===0)&&_!==d.Z_STREAM_END);return _===d.Z_STREAM_END&&(x=d.Z_FINISH),x===d.Z_FINISH?(_=e.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===d.Z_OK):x!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(z.avail_out=0))},l.prototype.onData=function(p){this.chunks.push(p)},l.prototype.onEnd=function(p){p===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},s.Inflate=l,s.inflate=b,s.inflateRaw=function(p,m){return(m=m||{}).raw=!0,b(p,m)},s.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,i,s){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(d){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var y=u.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(var g in y)y.hasOwnProperty(g)&&(d[g]=y[g])}}return d},s.shrinkBuf=function(d,u){return d.length===u?d:d.subarray?d.subarray(0,u):(d.length=u,d)};var t={arraySet:function(d,u,y,g,f){if(u.subarray&&d.subarray)d.set(u.subarray(y,y+g),f);else for(var l=0;l<g;l++)d[f+l]=u[y+l]},flattenChunks:function(d){var u,y,g,f,l,b;for(u=g=0,y=d.length;u<y;u++)g+=d[u].length;for(b=new Uint8Array(g),u=f=0,y=d.length;u<y;u++)l=d[u],b.set(l,f),f+=l.length;return b}},r={arraySet:function(d,u,y,g,f){for(var l=0;l<g;l++)d[f+l]=u[y+l]},flattenChunks:function(d){return[].concat.apply([],d)}};s.setTyped=function(d){d?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,t)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,r))},s.setTyped(e)},{}],42:[function(n,i,s){var e=n("./common"),t=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(g){t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(g){r=!1}for(var d=new e.Buf8(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function y(g,f){if(f<65537&&(g.subarray&&r||!g.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(g,f));for(var l="",b=0;b<f;b++)l+=String.fromCharCode(g[b]);return l}d[254]=d[254]=1,s.string2buf=function(g){var f,l,b,p,m,_=g.length,x=0;for(p=0;p<_;p++)(64512&(l=g.charCodeAt(p)))==55296&&p+1<_&&(64512&(b=g.charCodeAt(p+1)))==56320&&(l=65536+(l-55296<<10)+(b-56320),p++),x+=l<128?1:l<2048?2:l<65536?3:4;for(f=new e.Buf8(x),p=m=0;m<x;p++)(64512&(l=g.charCodeAt(p)))==55296&&p+1<_&&(64512&(b=g.charCodeAt(p+1)))==56320&&(l=65536+(l-55296<<10)+(b-56320),p++),l<128?f[m++]=l:(l<2048?f[m++]=192|l>>>6:(l<65536?f[m++]=224|l>>>12:(f[m++]=240|l>>>18,f[m++]=128|l>>>12&63),f[m++]=128|l>>>6&63),f[m++]=128|63&l);return f},s.buf2binstring=function(g){return y(g,g.length)},s.binstring2buf=function(g){for(var f=new e.Buf8(g.length),l=0,b=f.length;l<b;l++)f[l]=g.charCodeAt(l);return f},s.buf2string=function(g,f){var l,b,p,m,_=f||g.length,x=new Array(2*_);for(l=b=0;l<_;)if((p=g[l++])<128)x[b++]=p;else if(4<(m=d[p]))x[b++]=65533,l+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&l<_;)p=p<<6|63&g[l++],m--;1<m?x[b++]=65533:p<65536?x[b++]=p:(p-=65536,x[b++]=55296|p>>10&1023,x[b++]=56320|1023&p)}return y(x,b)},s.utf8border=function(g,f){var l;for((f=f||g.length)>g.length&&(f=g.length),l=f-1;0<=l&&(192&g[l])==128;)l--;return l<0||l===0?f:l+d[g[l]]>f?l:f}},{"./common":41}],43:[function(n,i,s){i.exports=function(e,t,r,d){for(var u=65535&e|0,y=e>>>16&65535|0,g=0;r!==0;){for(r-=g=2e3<r?2e3:r;y=y+(u=u+t[d++]|0)|0,--g;);u%=65521,y%=65521}return u|y<<16|0}},{}],44:[function(n,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,i,s){var e=function(){for(var t,r=[],d=0;d<256;d++){t=d;for(var u=0;u<8;u++)t=1&t?3988292384^t>>>1:t>>>1;r[d]=t}return r}();i.exports=function(t,r,d,u){var y=e,g=u+d;t^=-1;for(var f=u;f<g;f++)t=t>>>8^y[255&(t^r[f])];return-1^t}},{}],46:[function(n,i,s){var e,t=n("../utils/common"),r=n("./trees"),d=n("./adler32"),u=n("./crc32"),y=n("./messages"),g=0,f=4,l=0,b=-2,p=-1,m=4,_=2,x=8,C=9,j=286,A=30,N=19,z=2*j+1,M=15,R=3,L=258,V=L+R+1,k=42,O=113,h=1,D=2,ne=3,Z=4;function se(o,F){return o.msg=y[F],F}function H(o){return(o<<1)-(4<o?9:0)}function re(o){for(var F=o.length;0<=--F;)o[F]=0}function I(o){var F=o.state,B=F.pending;B>o.avail_out&&(B=o.avail_out),B!==0&&(t.arraySet(o.output,F.pending_buf,F.pending_out,B,o.next_out),o.next_out+=B,F.pending_out+=B,o.total_out+=B,o.avail_out-=B,F.pending-=B,F.pending===0&&(F.pending_out=0))}function T(o,F){r._tr_flush_block(o,0<=o.block_start?o.block_start:-1,o.strstart-o.block_start,F),o.block_start=o.strstart,I(o.strm)}function te(o,F){o.pending_buf[o.pending++]=F}function q(o,F){o.pending_buf[o.pending++]=F>>>8&255,o.pending_buf[o.pending++]=255&F}function $(o,F){var B,w,S=o.max_chain_length,E=o.strstart,U=o.prev_length,W=o.nice_match,P=o.strstart>o.w_size-V?o.strstart-(o.w_size-V):0,G=o.window,K=o.w_mask,Y=o.prev,ee=o.strstart+L,he=G[E+U-1],ae=G[E+U];o.prev_length>=o.good_match&&(S>>=2),W>o.lookahead&&(W=o.lookahead);do if(G[(B=F)+U]===ae&&G[B+U-1]===he&&G[B]===G[E]&&G[++B]===G[E+1]){E+=2,B++;do;while(G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&E<ee);if(w=L-(ee-E),E=ee-L,U<w){if(o.match_start=F,W<=(U=w))break;he=G[E+U-1],ae=G[E+U]}}while((F=Y[F&K])>P&&--S!=0);return U<=o.lookahead?U:o.lookahead}function fe(o){var F,B,w,S,E,U,W,P,G,K,Y=o.w_size;do{if(S=o.window_size-o.lookahead-o.strstart,o.strstart>=Y+(Y-V)){for(t.arraySet(o.window,o.window,Y,Y,0),o.match_start-=Y,o.strstart-=Y,o.block_start-=Y,F=B=o.hash_size;w=o.head[--F],o.head[F]=Y<=w?w-Y:0,--B;);for(F=B=Y;w=o.prev[--F],o.prev[F]=Y<=w?w-Y:0,--B;);S+=Y}if(o.strm.avail_in===0)break;if(U=o.strm,W=o.window,P=o.strstart+o.lookahead,G=S,K=void 0,K=U.avail_in,G<K&&(K=G),B=K===0?0:(U.avail_in-=K,t.arraySet(W,U.input,U.next_in,K,P),U.state.wrap===1?U.adler=d(U.adler,W,K,P):U.state.wrap===2&&(U.adler=u(U.adler,W,K,P)),U.next_in+=K,U.total_in+=K,K),o.lookahead+=B,o.lookahead+o.insert>=R)for(E=o.strstart-o.insert,o.ins_h=o.window[E],o.ins_h=(o.ins_h<<o.hash_shift^o.window[E+1])&o.hash_mask;o.insert&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[E+R-1])&o.hash_mask,o.prev[E&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=E,E++,o.insert--,!(o.lookahead+o.insert<R)););}while(o.lookahead<V&&o.strm.avail_in!==0)}function ve(o,F){for(var B,w;;){if(o.lookahead<V){if(fe(o),o.lookahead<V&&F===g)return h;if(o.lookahead===0)break}if(B=0,o.lookahead>=R&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+R-1])&o.hash_mask,B=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),B!==0&&o.strstart-B<=o.w_size-V&&(o.match_length=$(o,B)),o.match_length>=R)if(w=r._tr_tally(o,o.strstart-o.match_start,o.match_length-R),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=R){for(o.match_length--;o.strstart++,o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+R-1])&o.hash_mask,B=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart,--o.match_length!=0;);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+1])&o.hash_mask;else w=r._tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(w&&(T(o,!1),o.strm.avail_out===0))return h}return o.insert=o.strstart<R-1?o.strstart:R-1,F===f?(T(o,!0),o.strm.avail_out===0?ne:Z):o.last_lit&&(T(o,!1),o.strm.avail_out===0)?h:D}function ie(o,F){for(var B,w,S;;){if(o.lookahead<V){if(fe(o),o.lookahead<V&&F===g)return h;if(o.lookahead===0)break}if(B=0,o.lookahead>=R&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+R-1])&o.hash_mask,B=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=R-1,B!==0&&o.prev_length<o.max_lazy_match&&o.strstart-B<=o.w_size-V&&(o.match_length=$(o,B),o.match_length<=5&&(o.strategy===1||o.match_length===R&&4096<o.strstart-o.match_start)&&(o.match_length=R-1)),o.prev_length>=R&&o.match_length<=o.prev_length){for(S=o.strstart+o.lookahead-R,w=r._tr_tally(o,o.strstart-1-o.prev_match,o.prev_length-R),o.lookahead-=o.prev_length-1,o.prev_length-=2;++o.strstart<=S&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+R-1])&o.hash_mask,B=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),--o.prev_length!=0;);if(o.match_available=0,o.match_length=R-1,o.strstart++,w&&(T(o,!1),o.strm.avail_out===0))return h}else if(o.match_available){if((w=r._tr_tally(o,0,o.window[o.strstart-1]))&&T(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return h}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(w=r._tr_tally(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<R-1?o.strstart:R-1,F===f?(T(o,!0),o.strm.avail_out===0?ne:Z):o.last_lit&&(T(o,!1),o.strm.avail_out===0)?h:D}function oe(o,F,B,w,S){this.good_length=o,this.max_lazy=F,this.nice_length=B,this.max_chain=w,this.func=S}function be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*z),this.dyn_dtree=new t.Buf16(2*(2*A+1)),this.bl_tree=new t.Buf16(2*(2*N+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(M+1),this.heap=new t.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(o){var F;return o&&o.state?(o.total_in=o.total_out=0,o.data_type=_,(F=o.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?k:O,o.adler=F.wrap===2?0:1,F.last_flush=g,r._tr_init(F),l):se(o,b)}function Ee(o){var F=pe(o);return F===l&&function(B){B.window_size=2*B.w_size,re(B.head),B.max_lazy_match=e[B.level].max_lazy,B.good_match=e[B.level].good_length,B.nice_match=e[B.level].nice_length,B.max_chain_length=e[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=R-1,B.match_available=0,B.ins_h=0}(o.state),F}function je(o,F,B,w,S,E){if(!o)return b;var U=1;if(F===p&&(F=6),w<0?(U=0,w=-w):15<w&&(U=2,w-=16),S<1||C<S||B!==x||w<8||15<w||F<0||9<F||E<0||m<E)return se(o,b);w===8&&(w=9);var W=new be;return(o.state=W).strm=o,W.wrap=U,W.gzhead=null,W.w_bits=w,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+R-1)/R),W.window=new t.Buf8(2*W.w_size),W.head=new t.Buf16(W.hash_size),W.prev=new t.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new t.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=F,W.strategy=E,W.method=B,Ee(o)}e=[new oe(0,0,0,0,function(o,F){var B=65535;for(B>o.pending_buf_size-5&&(B=o.pending_buf_size-5);;){if(o.lookahead<=1){if(fe(o),o.lookahead===0&&F===g)return h;if(o.lookahead===0)break}o.strstart+=o.lookahead,o.lookahead=0;var w=o.block_start+B;if((o.strstart===0||o.strstart>=w)&&(o.lookahead=o.strstart-w,o.strstart=w,T(o,!1),o.strm.avail_out===0)||o.strstart-o.block_start>=o.w_size-V&&(T(o,!1),o.strm.avail_out===0))return h}return o.insert=0,F===f?(T(o,!0),o.strm.avail_out===0?ne:Z):(o.strstart>o.block_start&&(T(o,!1),o.strm.avail_out),h)}),new oe(4,4,8,4,ve),new oe(4,5,16,8,ve),new oe(4,6,32,32,ve),new oe(4,4,16,16,ie),new oe(8,16,32,32,ie),new oe(8,16,128,128,ie),new oe(8,32,128,256,ie),new oe(32,128,258,1024,ie),new oe(32,258,258,4096,ie)],s.deflateInit=function(o,F){return je(o,F,x,15,8,0)},s.deflateInit2=je,s.deflateReset=Ee,s.deflateResetKeep=pe,s.deflateSetHeader=function(o,F){return o&&o.state?o.state.wrap!==2?b:(o.state.gzhead=F,l):b},s.deflate=function(o,F){var B,w,S,E;if(!o||!o.state||5<F||F<0)return o?se(o,b):b;if(w=o.state,!o.output||!o.input&&o.avail_in!==0||w.status===666&&F!==f)return se(o,o.avail_out===0?-5:b);if(w.strm=o,B=w.last_flush,w.last_flush=F,w.status===k)if(w.wrap===2)o.adler=0,te(w,31),te(w,139),te(w,8),w.gzhead?(te(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),te(w,255&w.gzhead.time),te(w,w.gzhead.time>>8&255),te(w,w.gzhead.time>>16&255),te(w,w.gzhead.time>>24&255),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(te(w,255&w.gzhead.extra.length),te(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(o.adler=u(o.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(te(w,0),te(w,0),te(w,0),te(w,0),te(w,0),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,3),w.status=O);else{var U=x+(w.w_bits-8<<4)<<8;U|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(U|=32),U+=31-U%31,w.status=O,q(w,U),w.strstart!==0&&(q(w,o.adler>>>16),q(w,65535&o.adler)),o.adler=1}if(w.status===69)if(w.gzhead.extra){for(S=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),I(o),S=w.pending,w.pending!==w.pending_buf_size));)te(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),I(o),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),I(o),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&I(o),w.pending+2<=w.pending_buf_size&&(te(w,255&o.adler),te(w,o.adler>>8&255),o.adler=0,w.status=O)):w.status=O),w.pending!==0){if(I(o),o.avail_out===0)return w.last_flush=-1,l}else if(o.avail_in===0&&H(F)<=H(B)&&F!==f)return se(o,-5);if(w.status===666&&o.avail_in!==0)return se(o,-5);if(o.avail_in!==0||w.lookahead!==0||F!==g&&w.status!==666){var W=w.strategy===2?function(P,G){for(var K;;){if(P.lookahead===0&&(fe(P),P.lookahead===0)){if(G===g)return h;break}if(P.match_length=0,K=r._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,K&&(T(P,!1),P.strm.avail_out===0))return h}return P.insert=0,G===f?(T(P,!0),P.strm.avail_out===0?ne:Z):P.last_lit&&(T(P,!1),P.strm.avail_out===0)?h:D}(w,F):w.strategy===3?function(P,G){for(var K,Y,ee,he,ae=P.window;;){if(P.lookahead<=L){if(fe(P),P.lookahead<=L&&G===g)return h;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=R&&0<P.strstart&&(Y=ae[ee=P.strstart-1])===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]){he=P.strstart+L;do;while(Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&ee<he);P.match_length=L-(he-ee),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=R?(K=r._tr_tally(P,1,P.match_length-R),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(K=r._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),K&&(T(P,!1),P.strm.avail_out===0))return h}return P.insert=0,G===f?(T(P,!0),P.strm.avail_out===0?ne:Z):P.last_lit&&(T(P,!1),P.strm.avail_out===0)?h:D}(w,F):e[w.level].func(w,F);if(W!==ne&&W!==Z||(w.status=666),W===h||W===ne)return o.avail_out===0&&(w.last_flush=-1),l;if(W===D&&(F===1?r._tr_align(w):F!==5&&(r._tr_stored_block(w,0,0,!1),F===3&&(re(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),I(o),o.avail_out===0))return w.last_flush=-1,l}return F!==f?l:w.wrap<=0?1:(w.wrap===2?(te(w,255&o.adler),te(w,o.adler>>8&255),te(w,o.adler>>16&255),te(w,o.adler>>24&255),te(w,255&o.total_in),te(w,o.total_in>>8&255),te(w,o.total_in>>16&255),te(w,o.total_in>>24&255)):(q(w,o.adler>>>16),q(w,65535&o.adler)),I(o),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?l:1)},s.deflateEnd=function(o){var F;return o&&o.state?(F=o.state.status)!==k&&F!==69&&F!==73&&F!==91&&F!==103&&F!==O&&F!==666?se(o,b):(o.state=null,F===O?se(o,-3):l):b},s.deflateSetDictionary=function(o,F){var B,w,S,E,U,W,P,G,K=F.length;if(!o||!o.state||(E=(B=o.state).wrap)===2||E===1&&B.status!==k||B.lookahead)return b;for(E===1&&(o.adler=d(o.adler,F,K,0)),B.wrap=0,K>=B.w_size&&(E===0&&(re(B.head),B.strstart=0,B.block_start=0,B.insert=0),G=new t.Buf8(B.w_size),t.arraySet(G,F,K-B.w_size,B.w_size,0),F=G,K=B.w_size),U=o.avail_in,W=o.next_in,P=o.input,o.avail_in=K,o.next_in=0,o.input=F,fe(B);B.lookahead>=R;){for(w=B.strstart,S=B.lookahead-(R-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[w+R-1])&B.hash_mask,B.prev[w&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=w,w++,--S;);B.strstart=w,B.lookahead=R-1,fe(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=R-1,B.match_available=0,o.next_in=W,o.input=P,o.avail_in=U,B.wrap=E,l},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,i,s){i.exports=function(e,t){var r,d,u,y,g,f,l,b,p,m,_,x,C,j,A,N,z,M,R,L,V,k,O,h,D;r=e.state,d=e.next_in,h=e.input,u=d+(e.avail_in-5),y=e.next_out,D=e.output,g=y-(t-e.avail_out),f=y+(e.avail_out-257),l=r.dmax,b=r.wsize,p=r.whave,m=r.wnext,_=r.window,x=r.hold,C=r.bits,j=r.lencode,A=r.distcode,N=(1<<r.lenbits)-1,z=(1<<r.distbits)-1;e:do{C<15&&(x+=h[d++]<<C,C+=8,x+=h[d++]<<C,C+=8),M=j[x&N];t:for(;;){if(x>>>=R=M>>>24,C-=R,(R=M>>>16&255)===0)D[y++]=65535&M;else{if(!(16&R)){if(!(64&R)){M=j[(65535&M)+(x&(1<<R)-1)];continue t}if(32&R){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}L=65535&M,(R&=15)&&(C<R&&(x+=h[d++]<<C,C+=8),L+=x&(1<<R)-1,x>>>=R,C-=R),C<15&&(x+=h[d++]<<C,C+=8,x+=h[d++]<<C,C+=8),M=A[x&z];n:for(;;){if(x>>>=R=M>>>24,C-=R,!(16&(R=M>>>16&255))){if(!(64&R)){M=A[(65535&M)+(x&(1<<R)-1)];continue n}e.msg="invalid distance code",r.mode=30;break e}if(V=65535&M,C<(R&=15)&&(x+=h[d++]<<C,(C+=8)<R&&(x+=h[d++]<<C,C+=8)),l<(V+=x&(1<<R)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=R,C-=R,(R=y-g)<V){if(p<(R=V-R)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(O=_,(k=0)===m){if(k+=b-R,R<L){for(L-=R;D[y++]=_[k++],--R;);k=y-V,O=D}}else if(m<R){if(k+=b+m-R,(R-=m)<L){for(L-=R;D[y++]=_[k++],--R;);if(k=0,m<L){for(L-=R=m;D[y++]=_[k++],--R;);k=y-V,O=D}}}else if(k+=m-R,R<L){for(L-=R;D[y++]=_[k++],--R;);k=y-V,O=D}for(;2<L;)D[y++]=O[k++],D[y++]=O[k++],D[y++]=O[k++],L-=3;L&&(D[y++]=O[k++],1<L&&(D[y++]=O[k++]))}else{for(k=y-V;D[y++]=D[k++],D[y++]=D[k++],D[y++]=D[k++],2<(L-=3););L&&(D[y++]=D[k++],1<L&&(D[y++]=D[k++]))}break}}break}}while(d<u&&y<f);d-=L=C>>3,x&=(1<<(C-=L<<3))-1,e.next_in=d,e.next_out=y,e.avail_in=d<u?u-d+5:5-(d-u),e.avail_out=y<f?f-y+257:257-(y-f),r.hold=x,r.bits=C}},{}],49:[function(n,i,s){var e=n("../utils/common"),t=n("./adler32"),r=n("./crc32"),d=n("./inffast"),u=n("./inftrees"),y=1,g=2,f=0,l=-2,b=1,p=852,m=592;function _(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(k){var O;return k&&k.state?(O=k.state,k.total_in=k.total_out=O.total=0,k.msg="",O.wrap&&(k.adler=1&O.wrap),O.mode=b,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new e.Buf32(p),O.distcode=O.distdyn=new e.Buf32(m),O.sane=1,O.back=-1,f):l}function j(k){var O;return k&&k.state?((O=k.state).wsize=0,O.whave=0,O.wnext=0,C(k)):l}function A(k,O){var h,D;return k&&k.state?(D=k.state,O<0?(h=0,O=-O):(h=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?l:(D.window!==null&&D.wbits!==O&&(D.window=null),D.wrap=h,D.wbits=O,j(k))):l}function N(k,O){var h,D;return k?(D=new x,(k.state=D).window=null,(h=A(k,O))!==f&&(k.state=null),h):l}var z,M,R=!0;function L(k){if(R){var O;for(z=new e.Buf32(512),M=new e.Buf32(32),O=0;O<144;)k.lens[O++]=8;for(;O<256;)k.lens[O++]=9;for(;O<280;)k.lens[O++]=7;for(;O<288;)k.lens[O++]=8;for(u(y,k.lens,0,288,z,0,k.work,{bits:9}),O=0;O<32;)k.lens[O++]=5;u(g,k.lens,0,32,M,0,k.work,{bits:5}),R=!1}k.lencode=z,k.lenbits=9,k.distcode=M,k.distbits=5}function V(k,O,h,D){var ne,Z=k.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new e.Buf8(Z.wsize)),D>=Z.wsize?(e.arraySet(Z.window,O,h-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(D<(ne=Z.wsize-Z.wnext)&&(ne=D),e.arraySet(Z.window,O,h-D,ne,Z.wnext),(D-=ne)?(e.arraySet(Z.window,O,h-D,D,0),Z.wnext=D,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}s.inflateReset=j,s.inflateReset2=A,s.inflateResetKeep=C,s.inflateInit=function(k){return N(k,15)},s.inflateInit2=N,s.inflate=function(k,O){var h,D,ne,Z,se,H,re,I,T,te,q,$,fe,ve,ie,oe,be,pe,Ee,je,o,F,B,w,S=0,E=new e.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return l;(h=k.state).mode===12&&(h.mode=13),se=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,D=k.input,H=k.avail_in,I=h.hold,T=h.bits,te=H,q=re,F=f;e:for(;;)switch(h.mode){case b:if(h.wrap===0){h.mode=13;break}for(;T<16;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(2&h.wrap&&I===35615){E[h.check=0]=255&I,E[1]=I>>>8&255,h.check=r(h.check,E,2,0),T=I=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&I)<<8)+(I>>8))%31){k.msg="incorrect header check",h.mode=30;break}if((15&I)!=8){k.msg="unknown compression method",h.mode=30;break}if(T-=4,o=8+(15&(I>>>=4)),h.wbits===0)h.wbits=o;else if(o>h.wbits){k.msg="invalid window size",h.mode=30;break}h.dmax=1<<o,k.adler=h.check=1,h.mode=512&I?10:12,T=I=0;break;case 2:for(;T<16;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(h.flags=I,(255&h.flags)!=8){k.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){k.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=I>>8&1),512&h.flags&&(E[0]=255&I,E[1]=I>>>8&255,h.check=r(h.check,E,2,0)),T=I=0,h.mode=3;case 3:for(;T<32;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}h.head&&(h.head.time=I),512&h.flags&&(E[0]=255&I,E[1]=I>>>8&255,E[2]=I>>>16&255,E[3]=I>>>24&255,h.check=r(h.check,E,4,0)),T=I=0,h.mode=4;case 4:for(;T<16;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}h.head&&(h.head.xflags=255&I,h.head.os=I>>8),512&h.flags&&(E[0]=255&I,E[1]=I>>>8&255,h.check=r(h.check,E,2,0)),T=I=0,h.mode=5;case 5:if(1024&h.flags){for(;T<16;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}h.length=I,h.head&&(h.head.extra_len=I),512&h.flags&&(E[0]=255&I,E[1]=I>>>8&255,h.check=r(h.check,E,2,0)),T=I=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(H<($=h.length)&&($=H),$&&(h.head&&(o=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),e.arraySet(h.head.extra,D,Z,$,o)),512&h.flags&&(h.check=r(h.check,D,$,Z)),H-=$,Z+=$,h.length-=$),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(H===0)break e;for($=0;o=D[Z+$++],h.head&&o&&h.length<65536&&(h.head.name+=String.fromCharCode(o)),o&&$<H;);if(512&h.flags&&(h.check=r(h.check,D,$,Z)),H-=$,Z+=$,o)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(H===0)break e;for($=0;o=D[Z+$++],h.head&&o&&h.length<65536&&(h.head.comment+=String.fromCharCode(o)),o&&$<H;);if(512&h.flags&&(h.check=r(h.check,D,$,Z)),H-=$,Z+=$,o)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;T<16;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(I!==(65535&h.check)){k.msg="header crc mismatch",h.mode=30;break}T=I=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),k.adler=h.check=0,h.mode=12;break;case 10:for(;T<32;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}k.adler=h.check=_(I),T=I=0,h.mode=11;case 11:if(h.havedict===0)return k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=H,h.hold=I,h.bits=T,2;k.adler=h.check=1,h.mode=12;case 12:if(O===5||O===6)break e;case 13:if(h.last){I>>>=7&T,T-=7&T,h.mode=27;break}for(;T<3;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}switch(h.last=1&I,T-=1,3&(I>>>=1)){case 0:h.mode=14;break;case 1:if(L(h),h.mode=20,O!==6)break;I>>>=2,T-=2;break e;case 2:h.mode=17;break;case 3:k.msg="invalid block type",h.mode=30}I>>>=2,T-=2;break;case 14:for(I>>>=7&T,T-=7&T;T<32;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if((65535&I)!=(I>>>16^65535)){k.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&I,T=I=0,h.mode=15,O===6)break e;case 15:h.mode=16;case 16:if($=h.length){if(H<$&&($=H),re<$&&($=re),$===0)break e;e.arraySet(ne,D,Z,$,se),H-=$,Z+=$,re-=$,se+=$,h.length-=$;break}h.mode=12;break;case 17:for(;T<14;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(h.nlen=257+(31&I),I>>>=5,T-=5,h.ndist=1+(31&I),I>>>=5,T-=5,h.ncode=4+(15&I),I>>>=4,T-=4,286<h.nlen||30<h.ndist){k.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;T<3;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}h.lens[U[h.have++]]=7&I,I>>>=3,T-=3}for(;h.have<19;)h.lens[U[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,B={bits:h.lenbits},F=u(0,h.lens,0,19,h.lencode,0,h.work,B),h.lenbits=B.bits,F){k.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;oe=(S=h.lencode[I&(1<<h.lenbits)-1])>>>16&255,be=65535&S,!((ie=S>>>24)<=T);){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(be<16)I>>>=ie,T-=ie,h.lens[h.have++]=be;else{if(be===16){for(w=ie+2;T<w;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(I>>>=ie,T-=ie,h.have===0){k.msg="invalid bit length repeat",h.mode=30;break}o=h.lens[h.have-1],$=3+(3&I),I>>>=2,T-=2}else if(be===17){for(w=ie+3;T<w;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}T-=ie,o=0,$=3+(7&(I>>>=ie)),I>>>=3,T-=3}else{for(w=ie+7;T<w;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}T-=ie,o=0,$=11+(127&(I>>>=ie)),I>>>=7,T-=7}if(h.have+$>h.nlen+h.ndist){k.msg="invalid bit length repeat",h.mode=30;break}for(;$--;)h.lens[h.have++]=o}}if(h.mode===30)break;if(h.lens[256]===0){k.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,B={bits:h.lenbits},F=u(y,h.lens,0,h.nlen,h.lencode,0,h.work,B),h.lenbits=B.bits,F){k.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,B={bits:h.distbits},F=u(g,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,B),h.distbits=B.bits,F){k.msg="invalid distances set",h.mode=30;break}if(h.mode=20,O===6)break e;case 20:h.mode=21;case 21:if(6<=H&&258<=re){k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=H,h.hold=I,h.bits=T,d(k,q),se=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,D=k.input,H=k.avail_in,I=h.hold,T=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;oe=(S=h.lencode[I&(1<<h.lenbits)-1])>>>16&255,be=65535&S,!((ie=S>>>24)<=T);){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(oe&&!(240&oe)){for(pe=ie,Ee=oe,je=be;oe=(S=h.lencode[je+((I&(1<<pe+Ee)-1)>>pe)])>>>16&255,be=65535&S,!(pe+(ie=S>>>24)<=T);){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}I>>>=pe,T-=pe,h.back+=pe}if(I>>>=ie,T-=ie,h.back+=ie,h.length=be,oe===0){h.mode=26;break}if(32&oe){h.back=-1,h.mode=12;break}if(64&oe){k.msg="invalid literal/length code",h.mode=30;break}h.extra=15&oe,h.mode=22;case 22:if(h.extra){for(w=h.extra;T<w;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}h.length+=I&(1<<h.extra)-1,I>>>=h.extra,T-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;oe=(S=h.distcode[I&(1<<h.distbits)-1])>>>16&255,be=65535&S,!((ie=S>>>24)<=T);){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(!(240&oe)){for(pe=ie,Ee=oe,je=be;oe=(S=h.distcode[je+((I&(1<<pe+Ee)-1)>>pe)])>>>16&255,be=65535&S,!(pe+(ie=S>>>24)<=T);){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}I>>>=pe,T-=pe,h.back+=pe}if(I>>>=ie,T-=ie,h.back+=ie,64&oe){k.msg="invalid distance code",h.mode=30;break}h.offset=be,h.extra=15&oe,h.mode=24;case 24:if(h.extra){for(w=h.extra;T<w;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}h.offset+=I&(1<<h.extra)-1,I>>>=h.extra,T-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){k.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(re===0)break e;if($=q-re,h.offset>$){if(($=h.offset-$)>h.whave&&h.sane){k.msg="invalid distance too far back",h.mode=30;break}fe=$>h.wnext?($-=h.wnext,h.wsize-$):h.wnext-$,$>h.length&&($=h.length),ve=h.window}else ve=ne,fe=se-h.offset,$=h.length;for(re<$&&($=re),re-=$,h.length-=$;ne[se++]=ve[fe++],--$;);h.length===0&&(h.mode=21);break;case 26:if(re===0)break e;ne[se++]=h.length,re--,h.mode=21;break;case 27:if(h.wrap){for(;T<32;){if(H===0)break e;H--,I|=D[Z++]<<T,T+=8}if(q-=re,k.total_out+=q,h.total+=q,q&&(k.adler=h.check=h.flags?r(h.check,ne,q,se-q):t(h.check,ne,q,se-q)),q=re,(h.flags?I:_(I))!==h.check){k.msg="incorrect data check",h.mode=30;break}T=I=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;T<32;){if(H===0)break e;H--,I+=D[Z++]<<T,T+=8}if(I!==(4294967295&h.total)){k.msg="incorrect length check",h.mode=30;break}T=I=0}h.mode=29;case 29:F=1;break e;case 30:F=-3;break e;case 31:return-4;case 32:default:return l}return k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=H,h.hold=I,h.bits=T,(h.wsize||q!==k.avail_out&&h.mode<30&&(h.mode<27||O!==4))&&V(k,k.output,k.next_out,q-k.avail_out)?(h.mode=31,-4):(te-=k.avail_in,q-=k.avail_out,k.total_in+=te,k.total_out+=q,h.total+=q,h.wrap&&q&&(k.adler=h.check=h.flags?r(h.check,ne,q,k.next_out-q):t(h.check,ne,q,k.next_out-q)),k.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(te==0&&q===0||O===4)&&F===f&&(F=-5),F)},s.inflateEnd=function(k){if(!k||!k.state)return l;var O=k.state;return O.window&&(O.window=null),k.state=null,f},s.inflateGetHeader=function(k,O){var h;return k&&k.state&&2&(h=k.state).wrap?((h.head=O).done=!1,f):l},s.inflateSetDictionary=function(k,O){var h,D=O.length;return k&&k.state?(h=k.state).wrap!==0&&h.mode!==11?l:h.mode===11&&t(1,O,D,0)!==h.check?-3:V(k,O,D,D)?(h.mode=31,-4):(h.havedict=1,f):l},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,i,s){var e=n("../utils/common"),t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(y,g,f,l,b,p,m,_){var x,C,j,A,N,z,M,R,L,V=_.bits,k=0,O=0,h=0,D=0,ne=0,Z=0,se=0,H=0,re=0,I=0,T=null,te=0,q=new e.Buf16(16),$=new e.Buf16(16),fe=null,ve=0;for(k=0;k<=15;k++)q[k]=0;for(O=0;O<l;O++)q[g[f+O]]++;for(ne=V,D=15;1<=D&&q[D]===0;D--);if(D<ne&&(ne=D),D===0)return b[p++]=20971520,b[p++]=20971520,_.bits=1,0;for(h=1;h<D&&q[h]===0;h++);for(ne<h&&(ne=h),k=H=1;k<=15;k++)if(H<<=1,(H-=q[k])<0)return-1;if(0<H&&(y===0||D!==1))return-1;for($[1]=0,k=1;k<15;k++)$[k+1]=$[k]+q[k];for(O=0;O<l;O++)g[f+O]!==0&&(m[$[g[f+O]]++]=O);if(z=y===0?(T=fe=m,19):y===1?(T=t,te-=257,fe=r,ve-=257,256):(T=d,fe=u,-1),k=h,N=p,se=O=I=0,j=-1,A=(re=1<<(Z=ne))-1,y===1&&852<re||y===2&&592<re)return 1;for(;;){for(M=k-se,L=m[O]<z?(R=0,m[O]):m[O]>z?(R=fe[ve+m[O]],T[te+m[O]]):(R=96,0),x=1<<k-se,h=C=1<<Z;b[N+(I>>se)+(C-=x)]=M<<24|R<<16|L|0,C!==0;);for(x=1<<k-1;I&x;)x>>=1;if(x!==0?(I&=x-1,I+=x):I=0,O++,--q[k]==0){if(k===D)break;k=g[f+m[O]]}if(ne<k&&(I&A)!==j){for(se===0&&(se=ne),N+=h,H=1<<(Z=k-se);Z+se<D&&!((H-=q[Z+se])<=0);)Z++,H<<=1;if(re+=1<<Z,y===1&&852<re||y===2&&592<re)return 1;b[j=I&A]=ne<<24|Z<<16|N-p|0}}return I!==0&&(b[N+I]=k-se<<24|64<<16|0),_.bits=ne,0}},{"../utils/common":41}],51:[function(n,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,i,s){var e=n("../utils/common"),t=0,r=1;function d(S){for(var E=S.length;0<=--E;)S[E]=0}var u=0,y=29,g=256,f=g+1+y,l=30,b=19,p=2*f+1,m=15,_=16,x=7,C=256,j=16,A=17,N=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(f+2));d(V);var k=new Array(2*l);d(k);var O=new Array(512);d(O);var h=new Array(256);d(h);var D=new Array(y);d(D);var ne,Z,se,H=new Array(l);function re(S,E,U,W,P){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=P,this.has_stree=S&&S.length}function I(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function T(S){return S<256?O[S]:O[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,U){S.bi_valid>_-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>_-S.bi_valid,S.bi_valid+=U-_):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function $(S,E,U){q(S,U[2*E],U[2*E+1])}function fe(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function ve(S,E,U){var W,P,G=new Array(m+1),K=0;for(W=1;W<=m;W++)G[W]=K=K+U[W-1]<<1;for(P=0;P<=E;P++){var Y=S[2*P+1];Y!==0&&(S[2*P]=fe(G[Y]++,Y))}}function ie(S){var E;for(E=0;E<f;E++)S.dyn_ltree[2*E]=0;for(E=0;E<l;E++)S.dyn_dtree[2*E]=0;for(E=0;E<b;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function oe(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function be(S,E,U,W){var P=2*E,G=2*U;return S[P]<S[G]||S[P]===S[G]&&W[E]<=W[U]}function pe(S,E,U){for(var W=S.heap[U],P=U<<1;P<=S.heap_len&&(P<S.heap_len&&be(E,S.heap[P+1],S.heap[P],S.depth)&&P++,!be(E,W,S.heap[P],S.depth));)S.heap[U]=S.heap[P],U=P,P<<=1;S.heap[U]=W}function Ee(S,E,U){var W,P,G,K,Y=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*Y]<<8|S.pending_buf[S.d_buf+2*Y+1],P=S.pending_buf[S.l_buf+Y],Y++,W===0?$(S,P,E):($(S,(G=h[P])+g+1,E),(K=z[G])!==0&&q(S,P-=D[G],K),$(S,G=T(--W),U),(K=M[G])!==0&&q(S,W-=H[G],K)),Y<S.last_lit;);$(S,C,E)}function je(S,E){var U,W,P,G=E.dyn_tree,K=E.stat_desc.static_tree,Y=E.stat_desc.has_stree,ee=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=p,U=0;U<ee;U++)G[2*U]!==0?(S.heap[++S.heap_len]=he=U,S.depth[U]=0):G[2*U+1]=0;for(;S.heap_len<2;)G[2*(P=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[P]=0,S.opt_len--,Y&&(S.static_len-=K[2*P+1]);for(E.max_code=he,U=S.heap_len>>1;1<=U;U--)pe(S,G,U);for(P=ee;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,G,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,G[2*P]=G[2*U]+G[2*W],S.depth[P]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,G[2*U+1]=G[2*W+1]=P,S.heap[1]=P++,pe(S,G,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,Ce){var Ze,Oe,He,me,st,mt,Pe=Ce.dyn_tree,Dt=Ce.max_code,yn=Ce.stat_desc.static_tree,Sn=Ce.stat_desc.has_stree,xn=Ce.stat_desc.extra_bits,Lt=Ce.stat_desc.extra_base,Ge=Ce.stat_desc.max_length,it=0;for(me=0;me<=m;me++)ae.bl_count[me]=0;for(Pe[2*ae.heap[ae.heap_max]+1]=0,Ze=ae.heap_max+1;Ze<p;Ze++)Ge<(me=Pe[2*Pe[2*(Oe=ae.heap[Ze])+1]+1]+1)&&(me=Ge,it++),Pe[2*Oe+1]=me,Dt<Oe||(ae.bl_count[me]++,st=0,Lt<=Oe&&(st=xn[Oe-Lt]),mt=Pe[2*Oe],ae.opt_len+=mt*(me+st),Sn&&(ae.static_len+=mt*(yn[2*Oe+1]+st)));if(it!==0){do{for(me=Ge-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[Ge]--,it-=2}while(0<it);for(me=Ge;me!==0;me--)for(Oe=ae.bl_count[me];Oe!==0;)Dt<(He=ae.heap[--Ze])||(Pe[2*He+1]!==me&&(ae.opt_len+=(me-Pe[2*He+1])*Pe[2*He],Pe[2*He+1]=me),Oe--)}}(S,E),ve(G,he,S.bl_count)}function o(S,E,U){var W,P,G=-1,K=E[1],Y=0,ee=7,he=4;for(K===0&&(ee=138,he=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)P=K,K=E[2*(W+1)+1],++Y<ee&&P===K||(Y<he?S.bl_tree[2*P]+=Y:P!==0?(P!==G&&S.bl_tree[2*P]++,S.bl_tree[2*j]++):Y<=10?S.bl_tree[2*A]++:S.bl_tree[2*N]++,G=P,he=(Y=0)===K?(ee=138,3):P===K?(ee=6,3):(ee=7,4))}function F(S,E,U){var W,P,G=-1,K=E[1],Y=0,ee=7,he=4;for(K===0&&(ee=138,he=3),W=0;W<=U;W++)if(P=K,K=E[2*(W+1)+1],!(++Y<ee&&P===K)){if(Y<he)for(;$(S,P,S.bl_tree),--Y!=0;);else P!==0?(P!==G&&($(S,P,S.bl_tree),Y--),$(S,j,S.bl_tree),q(S,Y-3,2)):Y<=10?($(S,A,S.bl_tree),q(S,Y-3,3)):($(S,N,S.bl_tree),q(S,Y-11,7));G=P,he=(Y=0)===K?(ee=138,3):P===K?(ee=6,3):(ee=7,4)}}d(H);var B=!1;function w(S,E,U,W){q(S,(u<<1)+(W?1:0),3),function(P,G,K,Y){oe(P),te(P,K),te(P,~K),e.arraySet(P.pending_buf,P.window,G,K,P.pending),P.pending+=K}(S,E,U)}s._tr_init=function(S){B||(function(){var E,U,W,P,G,K=new Array(m+1);for(P=W=0;P<y-1;P++)for(D[P]=W,E=0;E<1<<z[P];E++)h[W++]=P;for(h[W-1]=P,P=G=0;P<16;P++)for(H[P]=G,E=0;E<1<<M[P];E++)O[G++]=P;for(G>>=7;P<l;P++)for(H[P]=G<<7,E=0;E<1<<M[P]-7;E++)O[256+G++]=P;for(U=0;U<=m;U++)K[U]=0;for(E=0;E<=143;)V[2*E+1]=8,E++,K[8]++;for(;E<=255;)V[2*E+1]=9,E++,K[9]++;for(;E<=279;)V[2*E+1]=7,E++,K[7]++;for(;E<=287;)V[2*E+1]=8,E++,K[8]++;for(ve(V,f+1,K),E=0;E<l;E++)k[2*E+1]=5,k[2*E]=fe(E,5);ne=new re(V,z,g+1,f,m),Z=new re(k,M,0,l,m),se=new re(new Array(0),R,0,b,x)}(),B=!0),S.l_desc=new I(S.dyn_ltree,ne),S.d_desc=new I(S.dyn_dtree,Z),S.bl_desc=new I(S.bl_tree,se),S.bi_buf=0,S.bi_valid=0,ie(S)},s._tr_stored_block=w,s._tr_flush_block=function(S,E,U,W){var P,G,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(Y){var ee,he=4093624447;for(ee=0;ee<=31;ee++,he>>>=1)if(1&he&&Y.dyn_ltree[2*ee]!==0)return t;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return r;for(ee=32;ee<g;ee++)if(Y.dyn_ltree[2*ee]!==0)return r;return t}(S)),je(S,S.l_desc),je(S,S.d_desc),K=function(Y){var ee;for(o(Y,Y.dyn_ltree,Y.l_desc.max_code),o(Y,Y.dyn_dtree,Y.d_desc.max_code),je(Y,Y.bl_desc),ee=b-1;3<=ee&&Y.bl_tree[2*L[ee]+1]===0;ee--);return Y.opt_len+=3*(ee+1)+5+5+4,ee}(S),P=S.opt_len+3+7>>>3,(G=S.static_len+3+7>>>3)<=P&&(P=G)):P=G=U+5,U+4<=P&&E!==-1?w(S,E,U,W):S.strategy===4||G===P?(q(S,2+(W?1:0),3),Ee(S,V,k)):(q(S,4+(W?1:0),3),function(Y,ee,he,ae){var Ce;for(q(Y,ee-257,5),q(Y,he-1,5),q(Y,ae-4,4),Ce=0;Ce<ae;Ce++)q(Y,Y.bl_tree[2*L[Ce]+1],3);F(Y,Y.dyn_ltree,ee-1),F(Y,Y.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Ee(S,S.dyn_ltree,S.dyn_dtree)),ie(S),W&&oe(S)},s._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(h[U]+g+1)]++,S.dyn_dtree[2*T(E)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){q(S,2,3),$(S,C,V),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,i,s){(function(e){(function(t,r){if(!t.setImmediate){var d,u,y,g,f=1,l={},b=!1,p=t.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(t);m=m&&m.setTimeout?m:t,d={}.toString.call(t.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(t.postMessage&&!t.importScripts){var j=!0,A=t.onmessage;return t.onmessage=function(){j=!1},t.postMessage("","*"),t.onmessage=A,j}}()?(g="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",C,!1):t.attachEvent("onmessage",C),function(j){t.postMessage(g+j,"*")}):t.MessageChannel?((y=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){y.port2.postMessage(j)}):p&&"onreadystatechange"in p.createElement("script")?(u=p.documentElement,function(j){var A=p.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,u.removeChild(A),A=null},u.appendChild(A)}):function(j){setTimeout(x,0,j)},m.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),N=0;N<A.length;N++)A[N]=arguments[N+1];var z={callback:j,args:A};return l[f]=z,d(f),f++},m.clearImmediate=_}function _(j){delete l[j]}function x(j){if(b)setTimeout(x,0,j);else{var A=l[j];if(A){b=!0;try{(function(N){var z=N.callback,M=N.args;switch(M.length){case 0:z();break;case 1:z(M[0]);break;case 2:z(M[0],M[1]);break;case 3:z(M[0],M[1],M[2]);break;default:z.apply(r,M)}})(A)}finally{_(j),b=!1}}}}function C(j){j.source===t&&typeof j.data=="string"&&j.data.indexOf(g)===0&&x(+j.data.slice(g.length))}})(typeof self>"u"?e===void 0?this:e:self)}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(St)),St.exports}var oi=ai();const li=Tn(oi),ci=async(a,c,n,i,s)=>{var d,u,y,g,f,l;const e=document.querySelector("svg#".concat(a));if(!e)throw new Error("Requested canvas SVG element not found");const t=Number((d=e.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:d[0]),r=e.cloneNode(!0);r.setAttribute("height",(t*(s||100)/100).toString()),r.style.setProperty("all","initial"),["share"].map(b=>{var p;return[...((p=[...document.querySelectorAll("link")].filter(m=>m.id==="css_"+b)[0])==null?void 0:p.sheet).cssRules].map(m=>m.cssText).join(" ")}).forEach(b=>{const p=document.createElement("style");p.textContent=b,r.prepend(p)}),(u=r.querySelector("rect#canvas-border"))==null||u.setAttribute("stroke",i?"black":"none"),(y=r.querySelector("rect#canvas-bg"))==null||y.setAttribute("fill",n?"none":"white");try{const b=(l=await((f=(g=It[c]).fonts)==null?void 0:f.call(g)))!=null?l:[],m=(await Promise.allSettled(b.map(le.getFontCSS))).filter(x=>x.status==="fulfilled").map(x=>x.value),_=document.createElement("style");_.textContent=m.join("\n"),r.prepend(_)}catch(b){console.warn("Failed to fonts. Fonts in the exported PNG will be missing.",b)}return r},di=async(a,c,n)=>{const i=a.viewBox.baseVal.width,s=a.viewBox.baseVal.height,e=document.querySelectorAll("canvas")[0];e.width=Number(i)*window.devicePixelRatio*c,e.height=Number(s)*window.devicePixelRatio*c,a.setAttribute("width",e.width.toString()),a.setAttribute("height",e.height.toString());const t=e.getContext("2d");return t.clearRect(0,0,e.width,e.height),a.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(r=>r.setAttribute("font-size","8.5px")),a.querySelectorAll("text, tspan").forEach(r=>{const d=window.getComputedStyle(r);r.setAttribute("font-family",d.fontFamily),r.setAttribute("fill",d.fill),r.setAttribute("dominant-baseline",d.dominantBaseline),r.setAttribute("text-anchor",d.textAnchor||"")}),new Promise((r,d)=>{const u=new Image;u.onload=()=>{setTimeout(()=>{t.drawImage(u,0,0,e.width,e.height),e.toBlob(y=>{y?r(y):d("Canvas blob is null")},"image/png")},n?2e3:0)},u.onerror=d,u.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a.outerHTML)))})};function hi(a){const{isOpen:c,onClose:n}=a,{t:i}=ce(),s=ue(),[e,t]=X.useState(""),[r,d]=X.useState(!1),[u,y]=X.useState(!1),[g,f]=X.useState(100),[l,b]=X.useState("png"),p=Q(R=>R.app.canvasToShow),{style:m,stn_list:_,current_stn_idx:x,line_name:C}=Q(R=>R.param);X.useEffect(()=>{e!==""&&!p.includes(e)&&t("")},[p]);const j=Tt[m].reduce((R,L)=>p.includes(L)?{...R,[L]:i("CanvasType."+L)}:{...R},{"":i("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((R,L)=>({...R,[L]:"".concat(L,"%")}),{}),N={png:i("DownloadModal.png"),svg:i("DownloadModal.svg")},z=[{type:"select",label:i("DownloadModal.canvas"),value:e,options:j,disabledOptions:[""],onChange:R=>t(R),minW:"full"},{type:"switch",label:i("DownloadModal.transparent"),isChecked:r,onChange:d,oneLine:!0,minW:"full"},{type:"switch",label:i("DownloadModal.showBorder"),isChecked:u,onChange:y,oneLine:!0,minW:"full"},{type:"select",label:i("DownloadModal.scale"),value:g,options:A,onChange:R=>f(R)},{type:"select",label:i("DownloadModal.format"),value:l,options:N,onChange:R=>b(R)}],M=async R=>{s(Gt(0));const L=R==="current"?[x]:Object.keys(_).filter(k=>!["linestart","lineend"].includes(k)),V=new li;for(const k in L){s(Gt((Number(k)+1)/L.length*100));const O=L[k];s(jt(O)),await Fr(500);const h=await ci(e,m,r,u,g);document.body.appendChild(h);const D="rmg.".concat(O,".").concat(_[O].localisedName.en).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(l==="png"){const ne=Ur()&&k==="0",Z=await di(h,g/100,ne);L.length>1?V.file("".concat(D,".png"),Z):Vt("".concat(D,".png"),Z)}else if(l==="svg"){h.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h.outerHTML)));L.length>1?V.file("".concat(D,".svg"),ne.split("base64,")[1],{base64:!0}):pn(D+".svg","image/svg+xml",h.outerHTML)}document.body.removeChild(h)}if(L.length>1){const k=await V.generateAsync({type:"blob"}),O="rmg.".concat(C[0],".").concat(C[1],".zip").replaceAll(" ","_");Vt(O,k)}le.event(xe.DOWNLOAD_IMAGES,{canvasToDownload:e,style:m,option:R,format:l}),s(jt(x)),s(xr()),n()};return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[v.jsx(Qe,{children:i("DownloadModal.title")}),v.jsx(et,{}),v.jsx(tt,{children:v.jsx(_e,{fields:z})}),v.jsx(nt,{children:v.jsxs(Re,{children:[v.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("current"),isDisabled:!e,children:i("DownloadModal.downloadOne")}),m!==J.GZMTR&&v.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("all"),isDisabled:!e,children:i("DownloadModal.downloadAll")})]})})]})]})}function ui(){const{t:a}=ce(),[c,n]=X.useState(!1),{paramConfig:i}=Q(t=>t.app),s=Q(t=>t.param),e=()=>{const t=Wr(s);pn("RMG_".concat(i==null?void 0:i.id,".json"),"application/json",JSON.stringify(t)),le.event(xe.DOWNLOAD_PARAM,{style:s.style})};return v.jsxs(kn,{children:[v.jsx(Cn,{as:de,variant:"ghost",size:"sm",rightIcon:v.jsx(wr,{}),children:a("DownloadActions.downloads")}),v.jsxs(jn,{children:[v.jsx(Ft,{onClick:e,children:a("DownloadActions.configFile")}),v.jsx(Ft,{onClick:()=>n(!0),children:a("DownloadActions.images")})]}),v.jsx(hi,{isOpen:c,onClose:()=>n(!1)})]})}function rt(){const[a,c]=In();return[a,i=>{c(i);const e=Object.keys(i).length===0?"/":"/?"+new URLSearchParams(i);le.updateAppMetadata({hash:e})}]}function fi(){const{t:a}=ce(),c=an(),[,n]=rt(),i=()=>{c(Ue(De.CLOSE)),c(Et(void 0)),n({})};return v.jsxs(Re,{ml:"auto",w:"fit-content",children:[v.jsx(de,{variant:"ghost",size:"sm",leftIcon:v.jsx(kr,{}),onClick:i,children:a("All projects")}),v.jsx(ui,{}),v.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:v.jsx(Cr,{}),onClick:()=>c(Ue(De.STYLE)),children:a("HeaderActions.editStyle")})]})}function pi(){const{t:a}=ce(),c=ue(),{canvasToShow:n,canvasScale:i}=Q(u=>u.app),s=Q(u=>u.param.style),e=Object.values(J).reduce((u,y)=>({...u,[y]:a("RmgStyle."+y)}),{}),t=Tt[s].map(u=>({label:a("CanvasType."+u),value:u})),r=u=>{c(Pr(u))},d=[{type:"select",label:a("Style"),value:s,options:e,onChange:u=>r(u)},{type:"custom",label:a("View"),component:v.jsx(jr,{displayValue:a("Select canvas"),selections:t,defaultValue:n,onChange:u=>c(Ar(u))})},{type:"slider",label:a("Canvas scale"),value:i,min:.1,max:2,step:.01,onChange:u=>c(Er(u)),leftIcon:v.jsx(Or,{}),rightIcon:v.jsx(zr,{})}];return v.jsxs(Rr,{children:[v.jsx(_e,{fields:d,minW:160}),v.jsx(fi,{})]})}const $e=(a,c,n,i)=>(s,e)=>{var u,y,g,f,l,b,p,m,_,x,C,j,A,N;const t=e().param.stn_list;let r=qe(6);for(;r in t;)r=qe(6);const d=Tr(r);if(a!=="new"){const z={...t,[c]:{...t[c],children:t[c].children.map(M=>M===n?r:M),branch:{left:(u=t[c].branch)==null?void 0:u.left,right:((g=(y=t[c].branch)==null?void 0:y.right)==null?void 0:g[1])===n?(l=(f=t[c].branch)==null?void 0:f.right)==null?void 0:l.with(1,r):(b=t[c].branch)==null?void 0:b.right}},[n]:{...t[n],parents:t[n].parents.map(M=>M===c?r:M),branch:{left:((m=(p=t[n].branch)==null?void 0:p.left)==null?void 0:m[1])===c?(x=(_=t[n].branch)==null?void 0:_.left)==null?void 0:x.with(1,r):(C=t[n].branch)==null?void 0:C.left,right:(j=t[n].branch)==null?void 0:j.right}},[r]:{...d,parents:[c],children:[n]}};return s(we(z)),r}else{if(!i)return!1;const z={...t,[c]:{...t[c],children:i==="upper"?[r,t[c].children[0]]:[t[c].children[0],r],branch:{left:(A=t[c].branch)==null?void 0:A.left,right:[ht.through,r]}},[n]:{...t[n],parents:i==="upper"?[r,t[n].parents[0]]:[t[n].parents[0],r],branch:{left:[ht.through,r],right:(N=t[n].branch)==null?void 0:N.right}},[r]:{...d,parents:[c],children:[n]}};return s(we(z)),r}},mi=(a,c,n)=>(i,s)=>{const t=s().helper.branches[a];if(t!=null&&t.length)if(c==="before"){const r=t[t.indexOf(n)-1];return i($e(a.toString(),r,n))}else{const r=t[t.indexOf(n)+1];return i($e(a.toString(),n,r))}else return!1},gi=()=>(a,c)=>{const n=c().param.stn_list;return c().helper.branches[0].filter(s=>{const e=n[s].parents.length+n[s].children.length===4,t=Nt(s,n)===0;return!e&&t})},nn=(a,c)=>(n,i)=>{const s=i().param.stn_list,e=i().helper.branches;return!e[0].includes(a)||!e[0].includes(c)?"Branch should end at main line":e[0].indexOf(a)>=e[0].indexOf(c)?"Not in correct ordering":a==="linestart"&&c==="lineend"?"Should not be parallel to main line":a==="linestart"&&e[0].indexOf(c)===1?"Branch should not be open jaw from the first station":c==="lineend"&&e[0].indexOf(a)===e[0].length-2?"Branch should not be open jaw from the last station":s[a].children.length>1||s[c].parents.length>1?"Branch already exist":e.slice(1).some(d=>d.slice(1,-1).includes(a)||d.slice(1,-1).includes(c))?"Cannot branch out from existing branch":e[0].slice(e[0].indexOf(a)+1,e[0].indexOf(c)).every(d=>s[d].parents.length===1&&s[d].children.length===1)?"":"One or more stations between both ends are branching out"};function bi(a){var N,z;const{isOpen:c,onClose:n}=a,{t:i}=ce(),s=ue(),e=Q(M=>M.app.selectedBranch),{style:t,stn_list:r}=Q(M=>M.param),d=Q(M=>M.helper.branches),[u,y]=X.useState(e),[g,f]=X.useState("before"),[l,b]=X.useState(""),[p,m]=X.useState(!1);X.useEffect(()=>{y(e)},[e]),X.useEffect(()=>{c||m(!1)},[c]);const _=(z=(N=d[Number(u)])==null?void 0:N.slice(1,-1))!=null?z:[],x=M=>M.reduce((R,L)=>{var V,k;return{...R,[L]:((V=r[L])==null?void 0:V.localisedName.zh)+"/"+((k=r[L])==null?void 0:k.localisedName.en)}},{"":i("AddStationModal.pleaseSelect")}),C=[{type:"select",label:i("AddStationModal.where"),value:u,options:{...d.reduce((M,R,L)=>({...M,[L]:L===0?i("AddStationModal.main"):t!==J.SHMetro||!We(R,r)?i("AddStationModal.branch")+" "+L:i("AddStationModal.external")+" "+L}),{})},onChange:M=>j(M),minW:"full"},{type:"select",label:i("AddStationModal.preposition"),value:g,options:{before:i("AddStationModal.before"),after:i("AddStationModal.after")},onChange:M=>f(M)},{type:"select",label:i("AddStationModal.pivot"),value:l,options:x(_),disabledOptions:[""],onChange:M=>b(M)}],j=M=>{y(M),b("")},A=()=>{const M=s(mi(u,g,l));M?(n(),s(hn(M)),s(Ue(De.STATION))):(console.log("false here"),m(!0)),le.event(xe.ADD_STATION,{style:t,branchIndex:u,success:M})};return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[p&&v.jsxs(ut,{status:"error",variant:"solid",size:"xs",children:[v.jsx(ft,{}),i("AddStationModal.error")]}),v.jsxs(ke,{position:"relative",children:[v.jsx(Qe,{children:i("AddStationModal.title")}),v.jsx(et,{})]}),v.jsx(tt,{children:v.jsx(_e,{fields:C})}),v.jsx(nt,{children:v.jsx(de,{colorScheme:"primary",onClick:A,isDisabled:!l,children:i("Confirm")})})]})]})}function _i(a){const{isOpen:c,onClose:n}=a,{t:i}=ce(),s=ue(),[e,t]=X.useState("new"),[r,d]=X.useState(""),[u,y]=X.useState(""),[g,f]=X.useState("upper"),[l,b]=X.useState(""),[p,m]=X.useState(""),{style:_,stn_list:x}=Q(V=>V.param);X.useEffect(()=>{c||(t("new"),d(""),y(""))},[c]);const j=(V=>V.reduce((k,O)=>{var h,D;return{...k,[O]:O==="linestart"?"(".concat(i("LEFT END"),")"):O==="lineend"?"(".concat(i("RIGHT END"),")"):((h=x[O])==null?void 0:h.localisedName.zh)+"/"+((D=x[O])==null?void 0:D.localisedName.en)}},{"":i("Please select...")}))(s(gi())),A=[{type:"select",label:i("NewBranchModal.where"),value:e,options:{new:i("NewBranchModal.new"),ext:i("NewBranchModal.ext")},disabledOptions:_===J.SHMetro?[]:["ext"],onChange:V=>N(V),minW:"full"},{type:"select",label:i("NewBranchModal.from"),value:r,options:j,disabledOptions:[""],onChange:V=>z(V),isInvalid:!!l},{type:"select",label:i("NewBranchModal.to"),value:u,options:j,disabledOptions:[""],onChange:V=>M(V),isInvalid:!!p},{type:"select",label:i("NewBranchModal.position"),value:g,options:{upper:i("NewBranchModal.upper"),lower:i("NewBranchModal.lower")},onChange:V=>f(V),minW:"full",hidden:e!=="new"||_===J.SHMetro}],N=V=>{t(V),d(""),y(""),b(""),m("")},z=V=>{d(V),b(""),V&&u&&m(s(nn(V,u)))},M=V=>{y(V),m(""),r&&V&&b(s(nn(r,V)))},R=()=>{let V;e==="ext"?V=s($e("new",r,u,"lower")):_===J.SHMetro?V=s($e("new",r,u,"upper")):V=s($e("new",r,u,g)),V&&(n(),le.event(xe.ADD_BRANCH,{style:_,where:e}))},L=!!(!r||!u||l||p);return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[v.jsx(Qe,{children:i("NewBranchModal.title")}),v.jsx(et,{}),v.jsx(tt,{children:v.jsx(_e,{fields:A})}),v.jsx(nt,{children:v.jsx(de,{colorScheme:"primary",title:L?l||p:i("Confirm"),onClick:R,isDisabled:L,children:i("Confirm")})})]})]})}const vi=X.lazy(()=>Le(()=>import("./station-ag-grid-Dn4mej34.js"),__vite__mapDeps([12,1,2,3,4,13,14,9])));function yi(){const{t:a}=ce(),c=ue(),[n,i]=X.useState(!1),[s,e]=X.useState(!1),t=Q(f=>f.app.selectedBranch),{style:r,stn_list:d,loop:u}=Q(f=>f.param),y=Q(f=>f.helper.branches),g=()=>{c(Ue(De.BRANCH))};return v.jsxs(ke,{flex:1,overflow:"hidden",children:[v.jsxs(An,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:t,onChange:f=>c(Ir(f)),children:[v.jsxs(En,{children:[y.map((f,l)=>l===0?v.jsx(gt,{children:a(u?"Loop line":"GridTabs.main")},l):r!==J.SHMetro||!We(f,d)?v.jsx(gt,{children:a("GridTabs.branch")+" "+l},l):v.jsx(gt,{children:a("GridTabs.external")+" "+l},l)),v.jsx(Be,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>e(!0),icon:v.jsx(Ie,{}),isDisabled:u}),v.jsxs(Re,{marginLeft:"auto",marginRight:1,children:[v.jsx(de,{variant:"outline",size:"xs",leftIcon:v.jsx(Ie,{}),onClick:()=>i(!0),children:a("GridTabs.addStation")}),v.jsx(de,{size:"xs",colorScheme:"primary",onClick:g,children:a("GridTabs.editLine")})]})]}),v.jsx(On,{flex:1,overflowY:"auto",children:y.map((f,l)=>v.jsx(zn,{padding:0,h:"100%",position:"relative",children:v.jsx(on,{suspenseFallback:v.jsx(pt,{isIndeterminate:!0}),children:v.jsx(vi,{branchIndex:l})})},l))})]}),v.jsx(bi,{isOpen:n,onClose:()=>i(!1)}),v.jsx(_i,{isOpen:s,onClose:()=>e(!1)})]})}function Si(){const a=ue(),c=Q(i=>i.app.globalAlerts),n=i=>{le.isStandaloneWindow()?window.open("/".concat(i),"_blank"):le.openApp({appId:i})};return v.jsx(v.Fragment,{children:Object.entries(c).map(([i,{message:s,url:e,linkedApp:t}])=>v.jsxs(ut,{status:i,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[v.jsx(ft,{}),t?v.jsx(Ve,{onClick:()=>n(t),children:s}):e?v.jsx(Ve,{href:e,target:"_blank",children:s}):s,v.jsx(rn,{ml:"auto",onClick:()=>a(Br(i))})]},i))})}const vn=a=>{document.title=a,setTimeout(()=>{le.updateAppMetadata({title:a})},200)};function xi(){const{t:a}=ce(),[c]=rt(),n=c.get("project"),i=Q(t=>t.app.isLoading),[s,e]=X.useState(!1);return X.useEffect(()=>{var t;if(le.isStandaloneWindow()&&!le.storage.get(Ye.DO_NOT_SHOW_RMT_MSG)&&e(!0),n){const r=Zr(n);vn((t=r==null?void 0:r.name)!=null?t:a("Project")+" "+n)}},[]),v.jsxs(fn,{children:[i&&v.jsx(pt,{isIndeterminate:i<0,value:i>=0?i:void 0}),v.jsx(pi,{}),s&&v.jsxs(ut,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[v.jsx(ft,{}),v.jsxs(lt,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[a("Try out")," ",v.jsx(Ve,{href:"/?app=rmg",isExternal:!0,children:a("Rail Map Toolkit")})," ",a("now and enjoy an even better rail map design experience!")," ",v.jsx(Ve,{as:"button",ml:"auto",onClick:()=>e(!1),children:a("Close")})," | ",v.jsx(Ve,{as:"button",onClick:()=>{e(!1),le.storage.set(Ye.DO_NOT_SHOW_RMT_MSG,"true")},children:a("Don't show me again")})]})]}),v.jsx(Si,{}),v.jsxs(Te,{flex:1,overflow:"hidden",position:"relative",children:[v.jsxs(Te,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[v.jsx(ke,{children:v.jsx(es,{})}),v.jsx(yi,{})]}),v.jsx(ii,{})]}),v.jsx("canvas",{style:{display:"none"}})]})}const wi="rmg-templates-bridge--",ki={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Ci(a){const{isOpen:c,onClose:n,onImport:i}=a,[s]=X.useState(qe()),e="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:le.getAppName(),parentId:s});return X.useEffect(()=>{const t=new BroadcastChannel(wi+s);return t.onmessage=r=>{const{event:d,meta:u,data:y}=r.data;console.log("[rmg] Received event from RMG Templates app clip:",d),d==="CLOSE"?n():d==="IMPORT"&&i(y,u.name)},()=>{t.close()}},[]),v.jsx(un,{size:"xl",isOpen:c,onClose:n,sx:ki,children:v.jsx("iframe",{src:e,loading:"eager"})})}const ji={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function Ai(a){const{selectedParam:c,disableNew:n,onError:i}=a,{t:s}=ce(),[,e]=rt(),[t,r]=X.useState(!1),d=X.useRef(null),u=X.useRef(null);X.useEffect(()=>{var b;c&&((b=u.current)==null||b.focus())},[c]);const y=()=>{const b=Lr(J.MTR,le.getLanguage()),p=vt(JSON.stringify(b));e({project:p}),le.event(xe.NEW_PARAM,{})},g=(b,p)=>{const m=vt(JSON.stringify(b),p);e({project:m})},f=async b=>{var m;const p=(m=b.target.files)==null?void 0:m[0];ze.info("handleImportProject(), received file",p);try{if(!p)i(s("OpenActions.unknownError"));else if(p.type!=="application/json")i(s("OpenActions.invalidType"));else{const _=await Hr(p),x=vt(_);e({project:x}),le.event(xe.UPLOAD_PARAM,{})}}catch(_){i(s("OpenActions.unknownError")),ze.error("handleImportProject(), Unknown error occurred while parsing the uploaded file",_)}b.target.value=""},l=()=>{c&&(e({project:c}),le.event(xe.OPEN_PARAM,{}))};return v.jsxs(Te,{sx:ji,children:[v.jsx(de,{leftIcon:v.jsx(Ie,{}),onClick:y,isDisabled:n,children:s("Blank project")}),v.jsx(de,{leftIcon:v.jsx(Nr,{}),onClick:()=>r(!0),isDisabled:n,children:s("Open template")}),v.jsx(de,{leftIcon:v.jsx(Mr,{}),onClick:()=>{var b;return(b=d.current)==null?void 0:b.click()},isDisabled:n,children:s("Import project")}),v.jsx(de,{ref:u,colorScheme:"primary",leftIcon:v.jsx(Dr,{}),onClick:l,isDisabled:c===void 0,children:s("Open selected")}),v.jsx("input",{ref:d,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),v.jsx(Ci,{isOpen:t,onClose:()=>r(!1),onImport:g})]})}const Ei={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Oi(a){const{downloading:c}=a,{t:n}=ce(),[i]=rt(),s=i.get("project"),[e,t]=X.useState([]),[r,d]=X.useState(),u=X.useRef(null),y=sn();X.useEffect(()=>{vn(n("Manage projects"))},[]),X.useEffect(()=>{t(yt())},[c]),Rn({ref:u,handler:()=>d(void 0)});const g=b=>{const{id:p,name:m,lastModified:_}=b;p&&(le.storage.set(Ye.PARAM_CONFIG_BY_ID+p,JSON.stringify({name:m,lastModified:_})),d(void 0),t(yt()),le.event(xe.UPDATE_PARAM_CONFIG,{}))},f=b=>{le.storage.remove(Ye.PARAM_BY_ID+b),le.storage.remove(Ye.PARAM_CONFIG_BY_ID+b),d(void 0),t(yt()),le.event(xe.REMOVE_PARAM,{})},l=b=>{y({description:b,status:"error",duration:1e4,isClosable:!0})};return v.jsxs(fn,{justifyContent:"center",children:[s&&v.jsx(pt,{isIndeterminate:!0}),v.jsx(Pn,{children:v.jsxs(Me,{sx:Ei,children:[v.jsx(Se,{as:"h3",size:"lg",children:n("Saved projects")}),v.jsxs(Te,{ref:u,children:[v.jsx(Gr,{paramRegistry:e,downloading:c,selectedParam:r,onParamSelect:d,onParamRemove:f,onParamUpdate:g}),v.jsx(Ai,{selectedParam:r,disableNew:e.length>=10,onError:l})]})]})})]})}const zi=a=>async c=>{try{const{config:n,param:i}=Vr(a);if(!i)return!1;const s={id:a,...n!=null?n:{}},e=Yr(i);try{const t=await $r(e);c(Et(s)),c(Yt(t))}catch(t){console.warn("Unable to update themes",t),c(Et(s)),c(Yt(e))}return!0}catch(n){return console.warn("Failed to parse param.",n),!1}};function Ri(){const{t:a}=ce(),c=ue(),{paramConfig:n}=Q(f=>f.app),[i,s]=rt(),e=i.get("project"),t=i.get("external"),[r,d]=X.useState(!1),[u,y]=X.useState(),g=sn();return X.useEffect(()=>{if(ze.info("searchParam: project=".concat(e,", external=").concat(t)),e&&t)ze.warn("<AppRouter/>, Both param ID and external URL are provided. External URL will be ignored."),s({project:e});else if(e)g.closeAll(),e===(n==null?void 0:n.id)?(ze.info("<AppRouter/>, Store param ID matches URL param ID. Rendering app view..."),d(!0)):(ze.info("<AppRouter/>, Loading app view for param (ID=".concat(e,")...")),c(zi(e)).then(f=>{f?d(!0):(ze.info("<AppRouter/>, Failed to read param (ID=".concat(e,"). Rendering param selector view...")),g({description:a("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),s({}))}));else if(t){ze.info("<AppRouter/>, External project URl is provided. Downloading project...");const f=decodeURIComponent(t);y(f),qr(f).then(l=>{l?s({project:l}):(ze.info("<AppRouter/>, Failed to download param from ".concat(f,". Rendering param selector view...")),g({description:a("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),s({})),y(void 0)})}else ze.info("<AppRouter/>, No URL param ID or external URL provided. Rendering param selector view..."),d(!1)},[e,t]),r?v.jsx(xi,{}):v.jsx(Oi,{downloading:u})}const Mi=Object.freeze(Object.defineProperty({__proto__:null,default:Ri},Symbol.toStringTag,{value:"Module"}));export{Kr as R,Mi as a,Ni as g,We as i};
