!function(){const e=["num","inStrip","showAsPlatformDoor"],t=["stroke","filled","bolder"],n=["Icon","lineNum","stnNum","strokeColour","passed","size","bolderBorder","alwaysShowColouredBorder","useSameScale","className","classNames","children","textProps"],r=["customWidth"],s=["zhName","enName","foregroundColour","backgroundColour","passed","spanDigits","className","classNames","children","textProps"],a=["zhName","enName","foregroundColour","backgroundColour","passed","spanDigits","className","classNames","children","textProps"],i=["zhName","enName","foregroundColour","backgroundColour","passed","spanDigits","className","classNames","children","textProps"],l=["zhName","enName","foregroundColour","backgroundColour","passed","spanDigits","className","classNames","children","textProps"],o=["stroke","filled","bolder"],c=["position"],d=["stations","classNames","textProps","columns","topHeavy","anchorAt","osiPosition","children"],h=["style"],m=["clockwise","anchorAt"],u=["stnName","onUpdate","passed"],x=["passed"],g=["passed","temporary"],f=["intInfos","stnState","tickRotation","spanDigits"],p=["intInfos","tickRotation","stnState","spanDigits"],j=["destIds","textAnchor"],v=["clockwise"],y=["destIds"],z=["stationInfo"],_=["secName"],N=["num"],S=["coachNumber"];function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){k(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function k(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}System.register(["./chakra-legacy-DVL9H2dO.js","./react-legacy-B8c4_Whb.js","./index-legacy-BI-vPK8I.js","./share-legacy-Bk3dM2gI.js","./svg-wrapper-legacy-QuXLAey0.js","./param-selector-legacy-Bd7OgHMI.js"],function(w,k){"use strict";var B,R,M,A,O,P,C,D,W,E,I,H,T,F,U;return{setters:[e=>{B=e.j},e=>{R=e.a},e=>{M=e.i,A=e.P,O=e.b0,P=e.u,C=e.n,D=e.S,W=e.aW},e=>{E=e.a,I=e.c,H=e.b,T=e.d},e=>{F=e.S},e=>{U=e.i}],execute:function(){function k(t){const{num:n,inStrip:r,showAsPlatformDoor:s}=t,a=b(t,e);return B.jsxs("g",$($({textAnchor:"middle",fill:r?M.black:"var(--rmg-theme-fg)"},a),{},{children:[B.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:r?"#fff":"var(--rmg-theme-colour)"}),B.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:n}),s?B.jsxs(B.Fragment,{children:[B.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),B.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):B.jsxs(B.Fragment,{children:[B.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),B.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]}))}const L=e=>{const t=(e=>{switch(e){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(e.variant),n=R.useMemo(()=>{switch(e.variant){case"gz1":return B.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return B.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return B.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return B.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return B.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return B.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return B.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return B.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return B.jsx(B.Fragment,{})}},[e.variant]);return B.jsxs("g",{transform:`translate(0,${"gz4"===e.variant?-15:0})`,style:{"--strip-height":`${t}px`},children:[B.jsx("rect",{id:"strip_gz"}),e.variant===A.gz1&&B.jsx("rect",{className:"gz1-gap"}),B.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:e.isShowLight&&n}),!1!==e.isShowPSD&&B.jsx(J,$({},e))]})},J=R.memo(function(e){const t=["gz28","gz2otis","gz6","gzgf"].includes(e.variant),n=(e=>{switch(e){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(e.variant),r=(e=>{switch(e){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(e.variant),s=[A.gz1,A.gz3,A.gz4,A.gz5,A.gz1421,A.gz7w,A.gz11].includes(e.variant);return B.jsx(k,{num:e.isShowPSD,inStrip:t,showAsPlatformDoor:e.variant===A.gz11,style:{"--psd-dy":n,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":s?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":r}})},(e,t)=>e.variant===t.variant&&e.isShowPSD===t.isShowPSD);function V(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=V(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Y(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=V(e))&&(r&&(r+=" "),r+=t);return r}const G=1.3,X=38.3,Z=R.memo(function(e){const{stroke:n,filled:r,bolder:s}=e,a=b(e,t);return B.jsx("path",$({d:"M0,9.25 V-9.25 H-13.5 l-5,5.625 v7.25 l5,5.625 H13.5 l5,-5.625 v-7.25 l-5,-5.625 H0",fill:r?n:"#fff",strokeWidth:s?1.7:G,stroke:n},a))}),q=R.createContext({updateId:0,update:()=>{}}),K=["Arial"],Q=R.forwardRef(function(e,t){const{Icon:r,lineNum:s,stnNum:a,strokeColour:i,passed:l,size:o,bolderBorder:c,alwaysShowColouredBorder:d,useSameScale:h,className:m,classNames:u,children:x,textProps:g}=e,f=b(e,n),{updateId:p}=R.useContext(q),j=R.useRef(null),v=R.useRef(null),[y,z]=R.useState({width:0}),[_,N]=R.useState({width:0}),S=()=>{j.current&&z(j.current.getBBox()),v.current&&N(v.current.getBBox())};R.useEffect(()=>{const e=new AbortController;return S(),document.fonts.load("12px "+K.join(", "),(null!=s?s:"")+(null!=a?a:"")).then().finally(()=>{setTimeout(()=>{e.signal.aborted||S()},100)}),()=>{e.abort()}},[s,a,p]);const w=s&&s.length>2,k=a&&a.length>2;R.useEffect(()=>{h&&(w||k)&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[h,w,k]);const M=17/Math.max(17,y.width),A=!h||w||k?17/Math.max(17,_.width):M,O="sm"===o?"0.7":"lg"===o?"1.6":1;return B.jsxs("g",$($({ref:t,className:Y(null==u?void 0:u.wrapper,m)},f),{},{children:[B.jsxs("g",{transform:`scale(${O})`,children:[B.jsx(r,{stroke:l&&!d?"#aaa":i,filled:!s&&!a,bolder:c}),(s||a)&&B.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:l?"#aaa":"#000",children:[B.jsx("g",{transform:`translate(-9.25,0)scale(${M})`,children:B.jsx("text",$($({ref:j,dominantBaseline:"central",x:.5,className:null==u?void 0:u.digits},g),{},{children:s}))}),B.jsx("g",{transform:`translate(9.25,0)scale(${A})`,children:B.jsx("text",$($({ref:v,dominantBaseline:"central",className:null==u?void 0:u.digits},g),{},{children:a}))})]})]}),x]}))}),ee=R.forwardRef(function(e,t){return B.jsx(Q,$($({Icon:Z},e),{},{ref:t}))}),te=42,ne=(e,t)=>{const n=[e,t].map(e=>e.match(/^(\w+).+$/));if(n[0]&&n[1]&&n[0][1]===n[1][1])return n[0][1]},re=e=>{const t=e.match(/^(\d+)\D+$/);return null==t?void 0:t[1]};function se(e){const{customWidth:t}=e,n=b(e,r),s=(null!=t?t:45)-45;return B.jsx("rect",$($({x:-22.5-s/2,height:24,width:null!=t?t:45,rx:4.5},n),{},{"data-testid":"intBox"}))}const ae=R.forwardRef(function(e,t){const{zhName:n,enName:r,foregroundColour:a,backgroundColour:i,passed:l,spanDigits:o,className:c,classNames:d,children:h,textProps:m}=e,u=b(e,s),{isDigit:x,spanningPart:g}=((e,t)=>{const n=re(e);if(n)return{isDigit:!0,spanningPart:n};const r=ne(e,t);return r?{isDigit:!1,spanningPart:r}:{isDigit:!1,spanningPart:""}})(n,r),f=R.useRef(null),[p,j]=R.useState({x:0,height:0,width:0});R.useEffect(()=>{f.current&&j(f.current.getBBox())},[n,r]);const v=te/Math.max(te,p.width),y=(-p.x-p.width/2)*v,z=p.height*(1-v)/2;return B.jsxs("g",$($({ref:t,textAnchor:"middle",fill:l?M.white:a,className:Y(null==d?void 0:d.wrapper,c)},u),{},{children:[B.jsx(se,{fill:l?"#aaa":i}),B.jsxs("g",{ref:f,transform:`translate(${y},${z})scale(${v})`,children:[B.jsx("text",$($({fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",className:null==d?void 0:d.digits},null==m?void 0:m.digits),{},{children:g})),B.jsx("text",$($({fontSize:10,x:0,y:8,textAnchor:"start",dominantBaseline:"central",className:null==d?void 0:d.zh},null==m?void 0:m.zh),{},{children:n.slice(g.length).trim()})),B.jsx("text",$($({fontSize:6.5,letterSpacing:-.1,x:0,y:18,textAnchor:"start",dominantBaseline:"middle",className:null==d?void 0:d.en},null==m?void 0:m.en),{},{children:x?r:r.slice(g.length).trim()}))]}),h]}))}),ie=R.forwardRef(function(e,t){var n;const{zhName:r,enName:s,foregroundColour:i,backgroundColour:l,passed:o,spanDigits:c,className:d,classNames:h,children:m,textProps:u}=e,x=b(e,a),g=null!==(n=re(r))&&void 0!==n?n:"",f=R.useRef(null),p=R.useRef(null),[j,v]=R.useState({x:0,width:0}),[y,z]=R.useState({width:0});R.useEffect(()=>{f.current&&v(f.current.getBBox()),p.current&&z(p.current.getBBox())},[r,s]);const _=te/Math.max(te,j.width),N=te/Math.max(te,y.width),S={x:-(j.x+j.width/2)*_,y:7.3+13.5*(1-_)*_/2*_},w={y:19.5-9*(1-N)*N/2};return B.jsxs("g",$($({ref:t,fill:o?M.white:i,className:Y(null==h?void 0:h.wrapper,d)},x),{},{children:[B.jsx(se,{fill:o?"#aaa":l}),B.jsxs("g",{ref:f,transform:`translate(${S.x},${S.y})scale(${_})`,children:[B.jsx("text",$($({ref:f,fontSize:16,textAnchor:"end",y:.7,dominantBaseline:"central",className:null==h?void 0:h.digits},null==u?void 0:u.digits),{},{children:g})),B.jsx("text",$($({fontSize:12,textAnchor:"start",dominantBaseline:"central",className:null==h?void 0:h.zh},null==u?void 0:u.zh),{},{children:r.slice(g.length)}))]}),B.jsx("text",$($({ref:p,fontSize:8,textAnchor:"middle",transform:`translate(0,${w.y})scale(${N})`,dominantBaseline:"middle",className:null==h?void 0:h.en},null==u?void 0:u.en),{},{children:s})),m]}))}),le=R.forwardRef(function(e,t){const{zhName:n,enName:r,foregroundColour:s,backgroundColour:a,passed:l,spanDigits:o,className:c,classNames:d,children:h,textProps:m}=e,u=b(e,i),x=R.useRef(null),[g,f]=R.useState({width:0});R.useEffect(()=>{x.current&&f(x.current.getBBox())},[n,r]);const p=Math.max(45,g.width+4);return B.jsxs("g",$($({ref:t,textAnchor:"middle",fill:l?M.white:s,className:Y(null==d?void 0:d.wrapper,c)},u),{},{children:[B.jsx(se,{customWidth:p,fill:l?"#aaa":a}),B.jsxs("g",{ref:x,children:[B.jsx("text",$($({fontSize:8.5,y:8,dominantBaseline:"central",className:null==d?void 0:d.zh},null==m?void 0:m.zh),{},{children:n})),B.jsx("text",$($({fontSize:5.5,y:18,dominantBaseline:"middle",className:null==d?void 0:d.en},null==m?void 0:m.en),{},{children:r}))]}),h]}))}),oe=R.forwardRef(function(e,t){const{zhName:n,enName:r,foregroundColour:s,backgroundColour:a,passed:i,spanDigits:o,className:c,classNames:d,children:h,textProps:m}=e,u=b(e,l),x=R.useRef(null),g=R.useRef(null),[f,p]=R.useState({width:0}),[j,v]=R.useState({width:0});R.useEffect(()=>{x.current&&p(x.current.getBBox()),g.current&&v(g.current.getBBox())},[n,r]);const y=te/Math.max(te,f.width),z=te/Math.max(te,j.width),_={y:7.3+13.5*(1-y)*y/2},N={y:19.5-9*(1-z)*z/2};return B.jsxs("g",$($({ref:t,textAnchor:"middle",fill:i?M.white:s,className:Y(null==d?void 0:d.wrapper,c)},u),{},{children:[B.jsx(se,{fill:i?"#aaa":a}),B.jsx("text",$($({ref:x,fontSize:12,transform:`translate(0,${_.y})scale(${y})`,dominantBaseline:"central",className:null==d?void 0:d.zh},null==m?void 0:m.zh),{},{children:n})),B.jsx("text",$($({ref:g,fontSize:8,transform:`translate(0,${N.y})scale(${z})`,dominantBaseline:"middle",className:null==d?void 0:d.en},null==m?void 0:m.en),{},{children:r})),h]}))}),ce=R.memo(R.forwardRef(function(e,t){const{zhName:n,enName:r,spanDigits:s}=e;switch(de(n,r)){case 1:return s?B.jsx(ae,$({ref:t},e)):B.jsx(ie,$({ref:t},e));case 2:return B.jsx(ae,$({ref:t},e));default:return n.length>=5?B.jsx(le,$({ref:t},e)):B.jsx(oe,$({ref:t},e))}})),de=(e,t)=>{if(void 0!==re(e))return 1;return void 0!==ne(e,t)?2:3},he=R.memo(function(e){const{stroke:t,filled:n,bolder:r}=e,s=b(e,o);return B.jsx("path",$({d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:n?t:"#fff",strokeWidth:r?1.7:G,stroke:t},s))}),me=R.forwardRef(function(e,t){return B.jsx(Q,$($({Icon:he},e),{},{ref:t}))});function ue(e){let{position:t}=e,n=b(e,c);const r="right"===t?"rotate(180)":"rotate(0)";return B.jsx("circle",$({cx:-15.32,cy:0,r:9.575,stroke:"#aaa",strokeWidth:2.275,fill:"white",strokeDasharray:"2.7 2.5",transform:r},n))}const xe=(e,t)=>Array.from(Array(e).keys()).map(n=>(n-(e-1)/2)*t),ge=e=>"fmetro"===e?Z:he,fe=9.1,pe=2.8600000000000003;R.forwardRef(function(e,t){let{stations:n,classNames:r,textProps:s,columns:a=2,topHeavy:i,anchorAt:l,osiPosition:o,children:c}=e,m=b(e,d);const u=R.useMemo(()=>((e,t,n)=>{if(e<=0)return[];if(1===e)return[[0,0]];const r=t>e?e:t,s=X,a=xe(r,s),i=Math.ceil(e/r),l=xe(i,19.8),o=e%r,c=[];for(let d=0;d<i;d++)if(0===o||d!==(n?i-1:0))for(let e=0;e<r;e++)c.push([a[e],l[d]]);else{const e=xe(o,s);for(let t=0;t<o;t++)c.push([e[t],l[d]])}return c})(n.length,a,i),[n.length,a,i]),[x,g]=R.useMemo(()=>{if(void 0===l)return[0,0];if(l<0||l>=u.length)return console.warn(`<InterchangeStation2024/>, anchor index ${l} is out of bound`),[0,0];{const[e,t]=u[l];return[-e,-t]}},[u,l]),f=R.useRef(null),p=R.useRef([]);R.useEffect(()=>{p.current=p.current.slice(0,n.length)},[n.length]);const j=2===n.length&&1===a&&!!o;return R.useImperativeHandle(t,()=>({target:f.current,children:p.current,getCoordinates:()=>u,getCorrectedBBox:()=>{var e,t;const n=null!==(e=null===(t=f.current)||void 0===t?void 0:t.getBBox())&&void 0!==e?e:{x:0,y:0,width:0,height:0};return n.y-=4.55,n.height+=fe,j?(n.x-="left"===o?1.4300000000000002:4.55,n.width+=5.98):(n.x-=4.55,n.width+=fe),n},getTranslate:()=>[x,g]}),[u,x,g,f.current,p.current,o]),B.jsxs("g",$($({ref:f,transform:`translate(${x},${g})`},m),{},{children:[n.map(({style:e},t)=>{const n=ge(e);return B.jsx(n,{stroke:"#aaa",filled:!0,strokeWidth:fe,transform:`translate(${u[t][0]},${u[t][1]})`},t)}),j&&B.jsx(ue,{position:o,r:13.206896551724137,strokeWidth:pe,strokeDasharray:void 0}),n.map(({style:e},t)=>{const n=ge(e);return B.jsx(n,{stroke:"white",filled:!0,strokeWidth:3.3800000000000003,transform:`translate(${u[t][0]},${u[t][1]})`},t)}),j&&B.jsx(ue,{position:o}),n.length&&B.jsx("rect",{fill:"white",x:-12,y:u[0][1],width:24,height:2*-u[0][1]}),n.map((e,t)=>{let{style:n}=e,a=b(e,h);const i="fmetro"===n?ee:me;return B.jsx(i,$({ref:e=>p.current[t]=e,transform:`translate(${u[t][0]},${u[t][1]})`,classNames:r,textProps:s},a),t)}),c]}))});const je=10*Math.PI/180,ve=`M0,9 A9,9 0 0,0 ${9*Math.sin(je)},-${9*Math.cos(je)}`;function ye(e){return B.jsxs("g",$($({},e),{},{children:[B.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),B.jsx("path",{d:ve,stroke:"red",strokeWidth:3,fill:"none"}),B.jsx("path",{d:ve,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),B.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]}))}const ze=R.forwardRef(function(e,t){let{clockwise:n,anchorAt:r="text"}=e,s=b(e,m);const a="circle"===r?29:0;return B.jsx("g",$($({ref:t},s),{},{children:B.jsxs("g",{transform:`translate(${a},0)`,children:[B.jsx(ye,{transform:`translate(-30,0)scale(${n?-1:1},1)`}),B.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),B.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})}))}),_e=R.memo(function(e){const{stnName:t,onUpdate:n,onEnNameUpdate:r}=e,{zh:s="",en:a=""}=t,i=R.useRef(null);return R.useEffect(()=>{if(i.current){null==n||n(i.current.getBBox());const e=i.current.querySelector("g");e&&(null==r||r(e.getBBox()))}},[JSON.stringify(t),i.current]),B.jsxs("g",{ref:i,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:18,children:s}),B.jsx("g",{fontSize:10.5,children:a.split("\\").map((e,t)=>B.jsx("text",{className:"rmg-name__en",dy:16+11*t,children:e},t))})]})},(e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName));function Ne(e){const{stnName:t,onUpdate:n,passed:r}=e,s=b(e,u),{zh:a="",en:i=""}=t,l=R.useRef(null),[o,c]=R.useState({x:0,width:0});return R.useEffect(()=>{if(l.current){const e=l.current.getBBox();c(e),null==n||n(e)}},[JSON.stringify(t)]),a||i?B.jsxs("g",$($({fill:r?"#aaa":"#000"},s),{},{children:[B.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[B.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),B.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),B.jsxs("g",{ref:l,textAnchor:"middle",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:13,children:a}),B.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:i})]})]})):B.jsx(B.Fragment,{})}function Se(e){const{passed:t}=e,n=b(e,x);return B.jsxs("g",$($({textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)"},n),{},{children:[B.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),B.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]}))}function we(e){const{passed:t,temporary:n}=e,r=b(e,g);return B.jsxs("g",$($({textAnchor:"middle",fill:t?"#aaa":"black"},r),{},{children:[B.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),B.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),n&&B.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]}))}function $e(e){var t,n;const{primaryName:r,secondaryName:s,stationState:a,flipped:i,express:l,underConstruction:o}=e,[c,d]=R.useState({width:0}),[h,m]=R.useState({width:0}),[u,x]=R.useState({x:0,width:-20}),g=null!==(t=null===(n=r.en)||void 0===n||null===(n=n.split("\\"))||void 0===n?void 0:n.length)&&void 0!==t?t:1,f={x:0,y:i?17.5:-20-14*g*Math.cos(-45)},p={x:(c.width+u.width/2+10)*(i?-1:1),y:2+5*(g-1)},j={x:(c.width+u.width+20+35)*(i?-1:1),y:2+5*(g-1)},v={x:(h.width+5+20)*(i?-1:1),y:c.y+c.height-14};return B.jsxs("g",{textAnchor:i?"end":"start",fill:(e=>{switch(e){case O.PASSED:return"#aaa";case O.CURRENT:return"#f00";case O.FUTURE:return"#000"}})(a),transform:`translate(${f.x},${f.y})rotate(-45)`,children:[B.jsx(_e,{stnName:r,onUpdate:d,onEnNameUpdate:m}),s&&B.jsx(Ne,{stnName:s,onUpdate:x,passed:a===O.PASSED,transform:`translate(${p.x},${p.y})`}),l&&B.jsx(Se,{passed:a===O.PASSED,transform:`translate(${j.x},${j.y})`}),o&&B.jsx(we,{passed:a===O.PASSED,temporary:"temp"===o,transform:`translate(${v.x},${v.y})`})]})}function ke(e){var t,n,r,s,a,i;const{stnId:l,stnState:o,stnY:c}=e,{theme:d,line_name:h,line_num:m,spanLineNum:u,stn_list:x,loop:g,loop_info:{midpoint_station:f,clockwise:p}}=P(e=>e.param),j=x[l],v=f===l,[y,z]=R.useState({height:0}),_=R.useRef(null);R.useEffect(()=>{_.current&&z(_.current.getBBox())},[_.current,c,j.localisedName,j.localisedSecondaryName,j.services]);const N=2===j.parents.length||2===j.children.length,S=c>0||1===j.parents.indexOf((null===(t=j.branch)||void 0===t||null===(t=t.left)||void 0===t?void 0:t[1])||"")||1===j.children.indexOf((null===(n=j.branch)||void 0===n||null===(n=n.right)||void 0===n?void 0:n[1])||"")?180:0,w=null!==(r=null===(s=j.localisedName.en)||void 0===s||null===(s=s.split("\\"))||void 0===s?void 0:s.length)&&void 0!==r?r:1,$=N?180===S?16+12*(w-1)*Math.cos(-45):-9:180===S?-6:(25+15*(w-1))*Math.cos(-45),k=c>0?y.height+23:-y.height-23;return B.jsxs(B.Fragment,{children:[B.jsx(be,{intInfos:N?[{theme:[d[0],d[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:h},...null!==(a=j.transfer.groups[0].lines)&&void 0!==a?a:[]]:null!==(i=j.transfer.groups[0].lines)&&void 0!==i?i:[],stnState:g?O.FUTURE:o,tickRotation:S,spanDigits:u}),B.jsx(me,{lineNum:m,stnNum:j.num,strokeColour:d[2],classNames:{digits:"rmg-name__zh"},passed:-1===o,alwaysShowColouredBorder:g,bolderBorder:!0,useSameScale:!0}),B.jsx("g",{ref:_,transform:`translate(${-$},0)`,children:B.jsx($e,{primaryName:j.localisedName,secondaryName:j.localisedSecondaryName,stationState:o,flipped:180===S,express:j.services.includes(C.express),underConstruction:j.underConstruction})}),v&&B.jsx(ze,{transform:`translate(0,${k})`,clockwise:p,anchorAt:c>0?"text":"circle"})]})}const be=e=>B.jsxs(B.Fragment,{children:[B.jsx(Be,$({strokeWidth:4},e)),B.jsx(Re,$({transform:`translate(0,${180===e.tickRotation?-47:23})`},e))]}),Be=e=>{const{intInfos:t,stnState:n,tickRotation:r,spanDigits:s}=e,a=b(e,f);return B.jsx("g",$($({},a),{},{children:t.map((e,s)=>{var a;return B.jsx("use",{xlinkHref:"#inttick",stroke:-1===n?"#aaa":null===(a=e.theme)||void 0===a?void 0:a[2],transform:`translate(${-2*(t.length-1)+4*s},0)rotate(${180===r?180:0})`},s)})}))},Re=e=>{const{intInfos:t,tickRotation:n,stnState:r,spanDigits:s}=e,a=b(e,p);return B.jsx("g",$($({},a),{},{children:t.map((e,t)=>{var a,i,l,o;return B.jsx("g",{transform:`translate(0,${28*t*(180===n?-1:1)})`,children:B.jsx(ce,{zhName:e.name[0],enName:e.name[1],foregroundColour:null!==(a=null===(i=e.theme)||void 0===i?void 0:i[3])&&void 0!==a?a:M.white,backgroundColour:null!==(l=null===(o=e.theme)||void 0===o?void 0:o[2])&&void 0!==l?l:"#aaaaaa",passed:-1===r,spanDigits:s,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})},t)})}))};function Me(e){const{xs:t,ys:n,stnStates:r}=e,{stn_list:s,loop:a}=P(e=>e.param),{branches:i}=P(e=>e.helper),l=a?i[0].slice(1,-1):Object.keys(s);return B.jsx("g",{id:"stn_icons",children:l.filter(e=>!["linestart","lineend"].includes(e)).map(e=>B.jsx("g",{style:{transform:`translate(${t[e]}px,${n[e]}px)`},children:B.jsx(ke,{stnId:e,stnState:r[e],stnY:n[e]})},e))})}const Ae=(e,t)=>2===e[t].parents.length||2===e[t].children.length?.25:0,Oe=(e,t,n)=>{const r=I("linestart","lineend",t);if(r.nodes.includes(e))return I(r.nodes[1],e,t).len;{const s=n.filter(t=>t.includes(e))[0];let a=e;for(;!r.nodes.includes(a);)a=s[s.indexOf(a)-1];let i=e;for(;!r.nodes.includes(i);)i=s[s.indexOf(i)+1];const l="linestart"===a,o="lineend"===i;if(s.toString()===n[0].toString()){const n=[];return l||o?l?(n[0]=0,n[1]=I(r.nodes[1],i,t).len,n[2]=I(s[1],e,t).len,n[3]=I(e,i,t).len):(n[0]=I(r.nodes[1],a,t).len,n[1]=I(a,r.nodes.slice(-2)[0],t).len,n[2]=I(a,e,t).len,n[3]=I(e,s.slice(-2)[0],t).len):(n[0]=I(r.nodes[1],a,t).len,n[1]=I(a,i,t).len,n[2]=I(a,e,t).len,n[3]=I(e,i,t).len),n[0]+n[2]*n[1]/(n[2]+n[3])}if(l||o)return l?I(r.nodes[1],i,t).len-I(e,i,t).len:I(r.nodes[1],a,t).len+I(a,e,t).len;{const n=[];return n[0]=I(r.nodes[1],a,t).len,n[1]=I(a,i,t).len,n[2]=I(a,e,t).len,n[3]=I(e,i,t).len,n[0]+n[2]*n[1]/(n[2]+n[3])}}},Pe=()=>{const{branches:e,routes:t,depsStr:n}=P(e=>e.helper),[r,s]=R.useState(45),{svgWidth:a,svg_height:i,y_pc:l,padding:o,branchSpacingPct:c,direction:d,line_name:h,spanLineNum:m,current_stn_idx:u,stn_list:x}=P(e=>e.param),g=R.useRef(null);R.useEffect(()=>{const e=setTimeout(()=>{g.current&&s(g.current.getBBox().width)},100);return()=>{clearTimeout(e)}},[g.current,h[0],h[1],m]);const f=E(x,Ae,Ae),p=R.useMemo(()=>(console.log("computing x shares"),Object.keys(x).reduce((t,n)=>$($({},t),{},{[n]:Oe(n,f,e)}),{})),[e.toString(),JSON.stringify(f)]),j=I("linestart","lineend",f),v=I(j.nodes[1],j.nodes.slice(-2)[0],f),y=d===D.right?[a[W.RailMap]*o/100+65,a[W.RailMap]*(1-o/100)-20]:[a[W.RailMap]*o/100,a[W.RailMap]*(1-o/100)-65],z=Object.keys(p).reduce((e,t)=>$($({},e),{},{[t]:y[0]+p[t]/v.len*(y[1]-y[0])}),{}),_=R.useMemo(()=>(console.log("computing y shares"),Object.keys(x).reduce((t,n)=>{if(e[0].includes(n))return $($({},t),{},{[n]:0});{const r=e.slice(1).filter(e=>e.includes(n))[0];return $($({},t),{},{[n]:x[r[0]].children.indexOf(r[1])?-2:2})}},{})),[n]),N=Object.keys(_).reduce((e,t)=>$($({},e),{},{[t]:-_[t]*c*i/200}),{}),S=R.useMemo(()=>H(u,t,d),[u,d,t.toString()]),w=e.map(e=>T(e,S)).reduce((e,t)=>(e.main.push(t.main),e.pass.push(t.pass),e),{main:[],pass:[]}),k=Object.keys(w).reduce((e,t)=>$($({},e),{},{[t]:w[t].map(e=>De(e,z,N))}),{}),b=r+20;return B.jsxs("g",{id:"main",style:{"--y-percentage":l,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[B.jsx(Ce,{paths:k}),B.jsx(Me,{xs:z,ys:N,stnStates:S}),B.jsx("g",{className:"line_name",style:{"--translate-x":d===D.right?y[0]-b+"px":`${y[1]+b}px`},children:B.jsx(ce,{ref:g,zhName:h[0],enName:h[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",spanDigits:m,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})})]})},Ce=R.memo(function(e){return B.jsxs("g",{fill:"none",strokeWidth:4,children:[B.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:e.paths.pass.map((e,t)=>B.jsx("path",{d:e},t))}),B.jsx("g",{stroke:"var(--rmg-theme-colour)",children:e.paths.main.map((e,t)=>B.jsx("path",{d:e},t))})]})},(e,t)=>JSON.stringify(e.paths)===JSON.stringify(t.paths)),De=(e,t,n)=>{let r;const s=[];return e.forEach(e=>{const a=t[e],i=n[e];if(!r&&0!==r)return r=i,void s.push(`M ${a},${i}`);0===i?(i<r&&s.push("H "+(a-40),"a 40,40 0 0,0 40,-40",`V ${i}`),i>r&&s.push("H "+(a-40),"a 40,40 0 0,1 40,40",`V ${i}`)):(i<r&&s.push(`V ${i+40}`,"a 40,40 0 0,1 40,-40",`H ${a}`),i>r&&s.push("V "+(i-40),"a 40,40 0 0,0 40,40",`H ${a}`)),s.push(`H ${a}`),r=i}),s.join(" ").replace(/( H ([\d.]+))+/g," H $2")};function We(e){return B.jsx("path",$({d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black"},e))}function Ee(e){const{destIds:t,textAnchor:n}=e,r=b(e,j),s=P(e=>e.param.direction),a=P(e=>e.param.stn_list),i=t.map(e=>{var t,n;return null!==(t=null===(n=a[e].localisedName.zh)||void 0===n?void 0:n.length)&&void 0!==t?t:0}),l=Math.min(...i),o=l>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(l-1):0;return B.jsxs("g",$($({textAnchor:n},r),{},{children:[t.map((e,t)=>{var r;const l=i[t]>i[1-t],c=!U()&&"end"===n&&!l;return B.jsxs(R.Fragment,{children:[B.jsx("text",{className:"rmg-name__zh",fontSize:25,x:s===D.left?0:-75,y:42*t-21,letterSpacing:l?"0em":`${o}em`,dx:c?`${o}em`:"0em",children:a[e].localisedName.zh}),B.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:s===D.left?0:-75,y:42*t-1,children:"Towards "+(null===(r=a[e].localisedName.en)||void 0===r?void 0:r.replace("\\"," "))})]},e)}),B.jsx("text",{className:"rmg-name__zh",fontSize:28,x:s===D.left?25*(Math.max(...i)+1):0,y:5,children:"方向"})]}))}const Ie=(e,t,n)=>{const r=Math.min(...Object.values(e)),s=Math.max(...Object.values(e)),a=Math.min(...Object.values(t)),i=Math.max(...Object.values(t))-a,l=i/2;return`M${s},${a} H${r} h-${n/2} a${l},${l} 0 0,0 0,${i} H${s} h${n/2} a${l},${l} 0 0,0 0,-${i}Z`};function He({currentStationX:e,currentStationY:t,stationGap:n,loopClockwise:r}){const s=t>0?r?-1:1:r?1:-1,a=(n/3-6)*s,i=e+a+6*s,l=(t-12)*-s;return B.jsx("g",{transform:`scale(1,${-s})`,children:B.jsx("path",{d:`M${i},${l} h${a}`,strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function Te(e){let{clockwise:t}=e,n=b(e,v);return B.jsx("g",$($({},n),{},{children:B.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:16,children:t?"内环":"外环"}),B.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:t?"Inner Circle":"Outer Circle"})]})}))}const Fe=2/3,Ue=2-Fe,Le=25*Math.PI/180,Je=Math.asin(Math.sin(35*Math.PI/180)/2);function Ve({cxLeft:e,cxRight:t,yGap:n,clockwise:r}){const s=n/2,a=s*(r?Fe:Ue),i=r?Le:Je,l=a*Math.cos(i),o=r?1:-1,c=r?1:0,d=a*Math.sin(i)*o,h=2*d,m={rotate:r?"-4deg":"2deg"};return B.jsxs(B.Fragment,{children:[B.jsxs("g",{transform:`translate(${e},0)`,children:[B.jsx("path",{d:`M${-l},${d} a${a},${a} 0 0,${c} 0,${-h}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:m}),B.jsx(Te,{transform:`translate(${r?0:-2*s},0)`,clockwise:r})]}),B.jsxs("g",{transform:`translate(${t},0)`,children:[B.jsx("path",{d:`M${l},${-d} a${a},${a} 0 0,${c} 0,${h}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:m}),B.jsx(Te,{transform:`translate(${r?0:2*s},0)`,clockwise:r})]})]})}function Ye(){const{branches:e}=P(e=>e.helper),{svgWidth:t,svg_height:n,y_pc:r,padding:s,branchSpacingPct:a,current_stn_idx:i,loop_info:{midpoint_station:l,clockwise:o}}=P(e=>e.param),c=e[0].slice(1,-1),d=Math.ceil(c.length/2),h=R.useMemo(()=>(console.log("computing x shares"),c.reduce((e,t,n,r)=>{let s;return n<d?s=d-n-1:(s=n-d,1&r.length&&(s+=.5)),$($({},e),{},{[t]:s})},{})),[c.toString()]),m=a*n*2/100,u=((e,t,n,r)=>{const s=e-(e*(1-2*t/100)*(n-1)/n-r);return[s/2,e-s/2]})(t[W.RailMap],s,d,m),x=(u[1]-u[0])/(d-1),g=Object.keys(h).reduce((e,t)=>$($({},e),{},{[t]:u[0]+h[t]*x}),{}),f=R.useMemo(()=>(console.log("computing y shares"),c.reduce((e,t,n)=>$($({},e),{},{[t]:n<d?1:-1}),{})),[c.toString()]),p=Object.keys(f).reduce((e,t)=>$($({},e),{},{[t]:-f[t]*m/2}),{}),j=((e,t,n,r)=>{const s=e.indexOf(n),a=e.indexOf(null!=r?r:n);let i;return i=a<0?e:t?s<=a?[...e.slice(0,s+1),...e.slice(a)]:e.slice(a,s+1):s<a?e.slice(s,a+1):[...e.slice(s),...e.slice(0,a+1)],e.reduce((e,t,n)=>s===n?$($({},e),{},{[t]:O.CURRENT}):i.includes(t)?$($({},e),{},{[t]:O.FUTURE}):$($({},e),{},{[t]:O.PASSED}),{})})(c,null!=o&&o,i,l);return B.jsxs("g",{id:"main",style:{"--y-percentage":r,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[B.jsx("path",{d:Ie(g,p,x),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),B.jsx(Me,{xs:g,ys:p,stnStates:j}),B.jsx(He,{currentStationX:g[i],currentStationY:p[i],stationGap:x,loopClockwise:o}),B.jsx(Ve,{cxLeft:u[0]-x/2,cxRight:u[1]+x/2,yGap:m,clockwise:o})]})}const Ge=W.RailMap,Xe=()=>{const{canvasScale:e}=P(e=>e.app),{svgWidth:t,svg_height:n,direction:r,psd_num:s,info_panel_type:a,notesGZMTR:i,current_stn_idx:l,stn_list:o,theme:c,loop:d}=P(e=>e.param),h=t[Ge],m=o[l];return B.jsxs(F,{type:Ge,svgWidth:h,svgHeight:n,canvasScale:e,theme:c,children:[B.jsx(Ze,{}),B.jsx(L,{variant:a,isShowLight:a===A.gz2otis,isShowPSD:a===A.gz2otis&&s}),!d&&(r===D.left&&m.parents.includes("linestart")||r===D.right&&m.children.includes("lineend"))?B.jsx(Qe,{}):B.jsxs(B.Fragment,{children:[d?B.jsx(Ye,{}):B.jsx(Pe,{}),!d&&B.jsx(qe,{}),null==i?void 0:i.map((e,t)=>B.jsx(et,{note:e},t))]}),a===A.gz2otis&&B.jsx("line",{x2:h,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},Ze=R.memo(function(){return B.jsxs("defs",{children:[B.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),B.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:B.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),qe=()=>{const{routes:e}=P(e=>e.helper),{direction:t,direction_gz_x:n,direction_gz_y:r,current_stn_idx:s}=P(e=>e.param),a=R.useMemo(()=>[...new Set(e.reduce((e,n)=>n.includes(s)?e.concat(n.filter(e=>!["linestart","lineend"].includes(e)).slice(t===D.left?0:-1)[0]):e,[]).filter(e=>e!==s))],[s,t,e.toString()]),i={textAnchor:t===D.left?"start":"end",transform:`translate(${t===D.left?65:-65},-5)`,destIds:a};return B.jsxs("g",{id:"direction_gz",style:{"--x-percentage":n,"--y-percentage":r},children:[B.jsx(We,{transform:`scale(0.35)rotate(${t===D.left?0:180})`}),2!==a.length?B.jsx(Ke,$({},i)):B.jsx(Ee,$({},i))]})},Ke=e=>{const{destIds:t}=e,n=b(e,y),r=P(e=>e.param.stn_list);return B.jsxs("g",$($({},n),{},{children:[B.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(e=>r[e].localisedName.zh).join("/")+"方向"}),B.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(e=>{var t;return null===(t=r[e].localisedName.en)||void 0===t?void 0:t.replace("\\"," ")}).join("/")})]}))},Qe=R.memo(function(){return B.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),B.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),B.jsxs("g",{strokeWidth:8,stroke:"#000",children:[B.jsx("path",{d:"M -160,68 h -160"}),B.jsx("path",{d:"M 160,68 h 160"})]})]})}),et=R.memo(function(e){const t=R.useRef(null),[n,r]=R.useState({width:0,height:0,y:0});return R.useEffect(()=>{t.current&&r(t.current.getBBox())},[e.note[0],e.note[1]]),B.jsxs("g",{className:"note-box",style:{"--x-percentage":e.note[2],"--y-percentage":e.note[3]},children:[e.note[4]&&B.jsx("rect",{height:n.height+4,width:n.width+4,x:-2,y:n.y-2,fill:"none",stroke:"black",strokeWidth:.5}),B.jsxs("g",{ref:t,children:[B.jsx("g",{fontSize:16,letterSpacing:1.2,children:e.note[0].split("\n").map((e,t)=>B.jsx("text",{className:"rmg-name__zh",y:18*t,children:e},t))}),B.jsx("g",{fontSize:10,letterSpacing:.33,transform:`translate(0,${18*e.note[0].split("\n").length})`,children:e.note[1].split("\n").map((t,r)=>{var s;return B.jsx("text",{className:"rmg-name__en",y:11*r,textLength:r<((null===(s=e.note[1].match(/\n/g))||void 0===s?void 0:s.length)||0)?n.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:t},r)})})]})]})},(e,t)=>e.note.toString()===t.note.toString()),tt=R.memo(function(e){var t,n;const{stnName:r,panelType:s,onUpdate:a}=e,i=R.useRef(null),l=((e,t)=>{switch(t){case 2:return"gz11"===e?.2:.5;case 3:return.1;default:return 0}})(s,null===(t=r.zh)||void 0===t?void 0:t.length);return R.useEffect(()=>{if(i.current&&a){const e=i.current.getBBox();a($($({},e),{},{x:e.x+92*l/2,width:e.width-92*l}))}},[i.current,JSON.stringify(r),s]),B.jsxs("g",{ref:i,fontWeight:"gz11"===s?"bold":"normal",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:92,x:l/2+"em",letterSpacing:l+"em",children:r.zh}),B.jsx("g",{fontSize:40,children:null===(n=r.en)||void 0===n||null===(n=n.split("\\"))||void 0===n?void 0:n.map((e,t)=>B.jsx("text",{className:"rmg-name__en",dy:72+42*t,children:e},t))})]})},(e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName)&&e.panelType===t.panelType),nt=e=>{const{secondaryName:t,transform:n}=e,r=R.useRef(null),[s,a]=R.useState({x:0,width:0});return R.useEffect(()=>{r.current&&a(r.current.getBBox())},[t.toString()]),B.jsxs("g",{transform:n,children:[B.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[B.jsx("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),B.jsx("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),B.jsxs("g",{ref:r,textAnchor:"middle",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),B.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},rt=(e,t,n)=>{const{stn_list:r,current_stn_idx:s,direction:a,loop:i,loop_info:{midpoint_station:l,clockwise:o}}=e;return i?at(t[0].slice(1,-1),r,s,l,o):st(n,r,s,a)},st=(e,t,n,r)=>{const s="l"===r?"parents":"children",a=t[n][s].map(e=>t[e].underConstruction?t[e][s]:e).flat(),i=e.find(e=>e.includes(n)&&e.includes(a[0]));if(i){const e=i.indexOf(n),s=("l"===r?i.slice(0,e).toReversed():i.slice(e+1)).filter(e=>!["linestart","lineend"].includes(e)).reduce((e,n)=>{var r;return null!==(r=t[n].transfer.groups[0].lines)&&void 0!==r&&r.length?[...e,n]:e},[]).slice(0,3);return{nextStations:a,viaStations:s}}return{nextStations:a,viaStations:[]}},at=(e,t,n,r,s)=>{const a=e.filter(e=>!t[e].underConstruction),i=s?a.toReversed():a,l=i.indexOf(n),o=[...i,...i].slice(l+1),c=[o[0]],d=o.slice(1).reduce((e,n)=>{var r;return null!==(r=t[n].transfer.groups[0].lines)&&void 0!==r&&r.length||t[n].loop_pivot?[...e,n]:e},[]);return{nextStations:c,viaStations:r?[...d.slice(0,2),r]:d.slice(0,3)}},it=R.forwardRef(function(e,t){var n;let{stationInfo:r}=e,s=b(e,z);const{localisedName:a,transfer:{groups:[{lines:i}]}}=r,[l,o]=R.useState({width:0}),c=R.useRef(null);return R.useEffect(()=>{c.current&&o(c.current.getBBox())},[c.current,JSON.stringify(a)]),B.jsxs("g",$($({ref:t},s),{},{children:[B.jsxs("g",{ref:c,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:20,children:a.zh}),null===(n=a.en)||void 0===n||null===(n=n.split("\\"))||void 0===n?void 0:n.map((e,t)=>B.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*t,children:e},t))]}),B.jsx("g",{transform:`translate(${l.width+2},7)`,children:(null==i?void 0:i.length)&&B.jsxs(B.Fragment,{children:[B.jsx("g",{transform:`translate(0,-${3.5*(i.length-1)/2})`,children:i.map(({theme:e},t)=>{var n;return B.jsx("path",{d:`M0,${3.5*t} H8`,stroke:null!==(n=null==e?void 0:e[2])&&void 0!==n?n:"#aaa",strokeWidth:3.5},`tick-${t}`)})}),i.map((e,t)=>{var n,r,s,a;return B.jsx(ce,{zhName:e.name[0],enName:e.name[1],backgroundColour:null!==(n=null===(r=e.theme)||void 0===r?void 0:r[2])&&void 0!==n?n:"#aaa",foregroundColour:null!==(s=null===(a=e.theme)||void 0===a?void 0:a[3])&&void 0!==s?s:M.white,spanDigits:!0,transform:`translate(${27+36*t},-8.5)scale(0.75)`,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}},`line-icon-${t}`)})]})})]}))});function lt({viaStations:e,stationList:t}){const n=R.useRef([]),[r,s]=R.useState([]);R.useEffect(()=>{s(n.current.map(e=>{var t,n;return null!==(t=null==e||null===(n=e.getBBox())||void 0===n?void 0:n.height)&&void 0!==t?t:0}))},[e,n.current]);const a=R.useCallback(e=>r.slice(0,e).reduce((e,t)=>e+t+4,0),[r]);return B.jsx(B.Fragment,{children:e.map((e,r)=>B.jsx(it,{ref:e=>n.current[r]=e,stationInfo:t[e],transform:`translate(0,${a(r)})`},e))})}function ot({nameBBox:e}){const t=P(e=>e.param),{svg_height:n,svgWidth:r,direction:s,current_stn_idx:a,stn_list:i}=t,{branches:l,routes:o}=P(e=>e.helper),c=r[W.RunIn],{nextStations:[d],viaStations:h}=rt(t,l,o),{localisedName:{en:m=""},localisedSecondaryName:u}=i[a],{localisedName:{zh:x="",en:g=""}}=i[d],f=g.split("\\").length,p=(c-e.width)/2,j={x:80},v={x:154.8},y={dy:75+25*(f-1)},z={x:s===D.left?(115+50*(.5+x.length)+p)/2-20:((c+e.width)/2+(.82*c-60))/2+30,y:.5*n-18*(m.split("\\").length-2)-(u?29:0),rotate:s===D.left?0:180};return B.jsxs(B.Fragment,{children:[B.jsxs("g",{transform:`translate(0,${n/2+5-y.dy})`,children:[B.jsxs("g",{textAnchor:"middle",transform:`translate(${j.x},0)`,children:[B.jsxs("g",{fontWeight:"bold",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:44,children:"下站"}),B.jsx("text",{className:"rmg-name__en",fontSize:25,dy:40,children:"Next"})]}),B.jsxs("g",{transform:`translate(0,${y.dy})`,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),B.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),B.jsxs("g",{textAnchor:"start",transform:`translate(${v.x},0)`,children:[B.jsxs("g",{fontWeight:"bold",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:44,children:x}),B.jsx("g",{fontSize:25,children:g.split("\\").map((e,t)=>B.jsx("text",{className:"rmg-name__en",dy:40+25*t,children:e},t))})]}),h&&B.jsx("g",{transform:`translate(0,${y.dy})`,children:B.jsx(lt,{viaStations:h,stationList:i})})]})]}),B.jsx(We,{transform:`translate(${z.x},${z.y})scale(0.4)rotate(${z.rotate})`})]})}function ct(e){let{secName:t}=e,n=b(e,_);const{zh:r,en:s}=t,a=R.useRef(null),[i,l]=R.useState({x:0,width:0});return R.useEffect(()=>{a.current&&l(a.current.getBBox())},[r,s]),B.jsxs("g",$($({},n),{},{children:[B.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[B.jsx("text",{textAnchor:"end",x:i.x-3,className:"rmg-name__zh",children:"("}),B.jsx("text",{textAnchor:"start",x:i.width+i.x+3,className:"rmg-name__zh",children:")"})]}),B.jsxs("g",{ref:a,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:18,children:r}),B.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:s})]})]}))}function dt({nextId:e,nameBBox:t,ignoreNumWidth:n}){const{svgWidth:r,svg_height:s,direction:a}=P(e=>e.param),i=P(t=>t.param.stn_list[e]),{localisedName:l,localisedSecondaryName:o}=i,{zh:c="",en:d=""}=l,h=r[W.RunIn],[m,u]=R.useState({width:0}),x=R.useRef(null);R.useEffect(()=>{x.current&&u(x.current.getBBox())},[c,d]);const g=c.length,f=(h-t.width)/2,p={x:a===D.left?80:h-45-m.width-35*(g<=2?2:1.5)},j={x:a===D.left?80+35*(g<=2?2:1.5):h-45-m.width},v={x:a===D.left?(115+35*((g<=2?1:.5)+g)+f)/2-20:(h-45-m.width-(g<=2?105:87.5)+f+t.width+(n?0:80.9))/2+20,y:s/2-30,rotate:a===D.left?0:180};return B.jsxs(B.Fragment,{children:[B.jsxs("g",{transform:`translate(0,${s/2-40})`,children:[B.jsxs("g",{textAnchor:"middle",transform:`translate(${p.x},0)`,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),B.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),B.jsxs("g",{textAnchor:"start",ref:x,transform:`translate(${j.x},0)`,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:35,children:c}),B.jsx("g",{fontSize:17,children:d.split("\\").map((e,t)=>B.jsx("text",{className:"rmg-name__en",dy:30+17*t,children:e},t))})]}),o&&B.jsx("g",{textAnchor:"middle",transform:`translate(${j.x},0)`,children:B.jsx(ct,{secName:o,transform:`translate(${m.width/2},${30+17*d.split("\\").length+5})`})})]}),B.jsx(We,{transform:`translate(${v.x},${v.y})scale(0.25)rotate(${v.rotate})`})]})}const ht=()=>{var e,t;const n=P(e=>e.param),{svg_height:r,svgWidth:s,theme:a,direction:i,info_panel_type:l,line_num:o,current_stn_idx:c,stn_list:d}=n,{branches:h,routes:m}=P(e=>e.helper),u=d[c],{localisedName:x,localisedSecondaryName:g}=u,[f,p]=R.useState({width:0}),j=null!==(e=null===(t=x.en)||void 0===t||null===(t=t.split("\\"))||void 0===t?void 0:t.length)&&void 0!==e?e:1,{nextStations:v}=rt(n,h,m),y=[A.gz7w,A.gz11].includes(l),z={name:`translate(${(i===D.left?1:-1)*s[W.RunIn]/4},45)`,next:`translate(${(i===D.left?1:-1)*s[W.RunIn]/10},45)`},_=(s[W.RunIn]+f.width)/2+55,N={x:s.runin/2,y:.5*r-50-18*(j-1)-(g?29:0)},S={x:0,y:70+36*j},w={x:_,y:.5*r-30-18*(j-1)-(g?29:0)},$={x:i===D.left?_:(s[W.RunIn]-f.width)/2-55,y:.5*r-18*(j-2)-(g?29:0)};return B.jsxs("g",{children:[B.jsxs("g",{transform:l===A.gz2otis?z.name:"",children:[B.jsxs("g",{textAnchor:"middle",transform:`translate(${N.x},${N.y})`,children:[B.jsx(tt,{stnName:x,panelType:l,onUpdate:p}),g&&B.jsx(nt,{secondaryName:g,transform:`translate(${S.x},${S.y})`})]}),B.jsx(me,{lineNum:o,stnNum:u.num,strokeColour:a[2],classNames:{digits:"rmg-font__en"},transform:y?`translate(${$.x},${$.y})`:`translate(${w.x},${w.y})`,size:"lg"})]}),l===A.gz11?B.jsx(ot,{nameBBox:f}):B.jsx("g",{transform:l===A.gz2otis?z.next:"",children:!v||v.includes("linestart")||v.includes("lineend")?B.jsx(B.Fragment,{}):1===v.length?B.jsx(dt,{nextId:v[0],nameBBox:f,ignoreNumWidth:y}):B.jsx(mt,{nextIds:v,nameBBox:f,ignoreNumWidth:y})})]})},mt=e=>{const{nextIds:t,nameBBox:n,ignoreNumWidth:r}=e,{routes:s}=P(e=>e.helper),{svgWidth:a,svg_height:i,direction:l,stn_list:o}=P(e=>e.param),c=a[W.RunIn],d=t.map(e=>o[e].localisedName),[h,m]=R.useState({width:0}),u=R.useRef([]);R.useEffect(()=>{m(e=>$($({},e),{},{width:0})),u.current.forEach(e=>{const t=null==e?void 0:e.getBBox();m(e=>t?e.width>t.width?e:t:e)})},[d.toString()]);const x=e.nextIds.map(e=>s.reduce((t,n)=>n.includes(e)?t.concat(n.filter(e=>!["linestart","lineend"].includes(e)).slice(l===D.left?0:-1)[0]):t,[])),g=Math.max(...d.map(e=>{var t,n;return null!==(t=null===(n=e.zh)||void 0===n?void 0:n.length)&&void 0!==t?t:0})),f=(c-n.width)/2,p={x:l===D.left?72:c-45-h.width-41},j={x:l===D.left?113:c-45-h.width},v={x:l===D.left?(99+27*(1+g)+f)/2-20:(c-45-h.width-41-27+f+e.nameBBox.width+(r?0:80.9))/2+20,y:i/2-30,rotate:l===D.left?0:180};return B.jsxs(B.Fragment,{children:[B.jsx("g",{transform:`translate(0,${i/2-70})`,children:d.map((e,t)=>{var n;return B.jsxs(R.Fragment,{children:[B.jsxs("g",{textAnchor:"middle",transform:`translate(${p.x},${110*t})`,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:27,children:"下站"}),B.jsx("text",{className:"rmg-name__en",fontSize:13,y:22,children:"Next"})]}),B.jsxs("g",{ref:e=>u.current[t]=e,textAnchor:"start",transform:`translate(${j.x},${110*t})`,children:[B.jsx("text",{className:"rmg-name__zh",fontSize:27,children:e.zh}),null===(n=e.en)||void 0===n||null===(n=n.split("\\"))||void 0===n?void 0:n.map((e,t)=>B.jsx("text",{className:"rmg-name__en",fontSize:13,y:22+13*t,children:e},t)),B.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:x[t].map(e=>o[e].localisedName.zh).join("/")+"方向"}),B.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+x[t].map(e=>o[e].localisedName.en).join("/").replace("\\"," ")})]})]},t)})}),B.jsx(We,{transform:`translate(${v.x},${v.y})scale(0.25)rotate(${v.rotate})`})]})};function ut(e){const{num:t}=e,n=b(e,N);return B.jsxs("g",$($({textAnchor:"middle",fill:"var(--rmg-theme-fg)"},n),{},{children:[B.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),B.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),B.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),B.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]}))}function xt(e){const{canvasType:t}=e,{svgWidth:n,svg_height:r}=P(e=>e.param);return B.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[B.jsx("line",{y2:r,transform:`translate(${n[t]/2},0)`}),B.jsx("line",{x2:n[t],transform:"translate(0,90)"})]})}function gt(e){let{coachNumber:t}=e,n=b(e,S);return B.jsxs("g",$($({},n),{},{children:[B.jsx("path",{d:"M-30,-30 a30,30 0 0,0 0,60 h60 a30,30, 0 0,0 0,-60Z",fill:"whitesmoke",stroke:"lightgrey"}),B.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[B.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),B.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),B.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:B.jsx("text",{className:"rmg-name__zh",fontSize:36,children:t})})]}))}const ft=W.RunIn;function pt(){const{canvasScale:e}=P(e=>e.app),{svgWidth:t,svg_height:n,direction:r,info_panel_type:s,platform_num:a,psd_num:i,coachNum:l,theme:o}=P(e=>e.param),c=t[ft],d=[A.gz7w,A.gz11].includes(s),h=d?n-78:n/2-30,m={platform:`translate(${r===D.left?50:-50},45)`};return B.jsxs(F,{type:ft,svgWidth:c,svgHeight:n,canvasScale:e,theme:o,children:[B.jsx(L,{variant:s,isShowLight:s!==A.gz2otis,isShowPSD:s!==A.gz2otis&&i}),B.jsx("g",{transform:s===A.gz2otis?m.platform:"",children:B.jsx(ut,{num:a,style:{"--translate-x":(r===D.left||s===A.gz11?c-100:100)+"px","--translate-y":h+"px","--scale":d?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),d&&B.jsx(gt,{coachNumber:l,transform:`translate(${.82*c},${.58*n})`}),B.jsx(ht,{}),s===A.gz2otis&&B.jsx(xt,{canvasType:ft})]})}w("default",{runin:B.jsx(pt,{}),railmap:B.jsx(Xe,{})})}}})}();
