const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BouiNzCe.js","assets/chakra-Sn37LbgI.js","assets/react-Cf9aS4i4.js","assets/index-BvQFkmSu.js","assets/index-zuiuVkH5.css","assets/svg-wrapper-CPeIYnz1.js","assets/share-D2v7Obx-.js","assets/mtr-OasVSnC4.js","assets/index-28UVlI8l.js","assets/param-selector-B5jlvvlj.js","assets/index-LairM8n-.js","assets/index-MaEGvKDf.js","assets/station-ag-grid-n4KvDt2t.js","assets/ag-grid-react-Comlkquw.js","assets/ag-grid-community-DzCx5pP4.js"])))=>i.map(i=>d[i]);
import{j as v,ap as jn,h as Pe,B as ke,al as ve,a2 as Ne,ao as Ee,N as ct,aq as Ot,t as oe,D as Ie,aj as Ke,M as Xe,ak as Je,U as ft,V as pt,J as Qe,K as et,L as tt,O as nt,ab as sn,ar as An,as as En,at as On,au as Ft,av as Rn,aw as zn,ax as bt,ay as Pn,az as Tn,R as Ve,aA as an,a as Bn,aB as Nn}from"./chakra-Sn37LbgI.js";import{a as J,u as le,m as on,c as at,g as In,s as Mn}from"./react-Cf9aS4i4.js";import{_ as Fe,u as Q,r as de,E as we,R as mt,a as ln,s as Dn,b as cn,c as Ln,D as Se,d as ue,e as X,f as Ae,M as Fn,F as xt,g as De,h as Be,i as dt,j as wt,o as Rt,k as Un,l as zt,S as ht,m as Ut,B as ut,n as Pt,p as Tt,q as Wn,t as Zn,v as kt,w as Ct,x as Hn,y as Wt,z as Gn,A as Vn,C as dn,G as hn,H as $n,I as Yn,J as qn,P as ot,K as Kn,L as Zt,N as Xn,O as Jn,Q as Qn,T as er,U as tr,V as nr,W as rr,X as Ht,Y as sr,Z as ir,$ as ar,a0 as _t,a1 as or,a2 as lr,a3 as un,a4 as Le,a5 as Me,a6 as cr,a7 as dr,a8 as hr,a9 as Ue,aa as qe,ab as fn,ac as ur,ad as jt,ae as pn,af as At,ag as fr,ah as pr,ai as mr,aj as gr,ak as br,al as _r,am as vr,an as yr,ao as Sr,ap as xr,aq as mn,ar as wr,as as kr,at as Cr,au as jr,av as Gt,aw as Ar,ax as Er,ay as Or,az as Rr,aA as Et,aB as zr,aC as Pr,aD as Tr,aE as Br,aF as Nr,aG as Ir,aH as Mr,aI as Dr,aJ as Lr,aK as Fr,aL as $e,aM as gn,aN as Ur,aO as Wr,aP as Zr,aQ as Hr,aR as ze}from"./index-BvQFkmSu.js";import{R as ge,w as Gr,i as Vr,d as Vt,a as bn,s as $r,g as Yr,b as vt,r as qr,c as yt,P as Kr,e as Xr,u as Jr,f as Qr,h as es}from"./param-selector-B5jlvvlj.js";var ts=function(a){var c=a.text,n=a.delimiter;return v.jsx("span",{children:c.split(n||"\\").map(function(s,i){return i?[v.jsx(jn,{children:"⏎"},i),s]:s})})};const Bt={mtr:{components:()=>Fe(()=>import("./index-BouiNzCe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),fonts:()=>Fe(()=>import("./index-BouiNzCe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(a=>a.mtrFonts)},gzmtr:{components:()=>Fe(()=>import("./index-28UVlI8l.js"),__vite__mapDeps([8,1,2,3,4,6,5,9]))},shmetro:{components:()=>Fe(()=>import("./index-LairM8n-.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,9]))},shsubrwy:{components:()=>Fe(()=>import("./index-MaEGvKDf.js"),__vite__mapDeps([11,1,2,3,4,5]))}};function ns(a){const[c,n]=J.useState({});return J.useEffect(()=>(Bt[a].components().then(s=>{n(s.default)}).catch(s=>{console.error("Failed to load canvas for style ".concat(a),s),n({})}),()=>{n({})}),[a]),c}const rs={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}},ss=async(a,c)=>{var s,i,e,t;const n=(e=await((i=(s=Bt[a]).fonts)==null?void 0:i.call(s)))!=null?e:[];await Promise.all(n.map(r=>de.loadFont(r))),c.aborted||(t=document.querySelector("#css_share"))==null||t.setAttribute("href","/rmg/styles/share_".concat(a,".css"))};function is(){const{canvasToShow:a,canvasScale:c}=Q(r=>r.app),{svg_height:n,style:s}=Q(r=>r.param),i=ns(s);J.useEffect(()=>{const r=new AbortController;return ss(s,r.signal).then(),de.event(we.STYLE_CHANGE,{style:s}),()=>{r.abort()}},[s]);const e=Object.keys(i).filter(r=>a.includes(r)),t=n*c;return v.jsx(Pe,{minH:t,sx:rs,children:Object.keys(i).length===0?v.jsx(mt,{isIndeterminate:!0}):e.map(r=>v.jsx(ln,{sx:{minWidth:750,height:t},children:i[r]},r+s))})}const $t=a=>c=>{c(Dn(a)),c(cn(a.stn_list))},be=(a,c)=>(n,s)=>{const{stn_list:i}=s().param,e={...i,[a]:c};n(xe(e))},xe=a=>c=>{c(Ln(a)),c(cn(a))},as=(a=!1)=>(c,n)=>{const{stn_list:s}=n().param,i=Object.keys(s).reduce((e,t)=>({...e,[t]:(r=>{var d,u,b,g;switch(r){case"linestart":return{...s.lineend,parents:[],children:a?s.lineend.parents:s.lineend.parents.toReversed(),branch:{right:(d=s.lineend.branch)==null?void 0:d.left}};case"lineend":return{...s.linestart,parents:a?s.linestart.children:s.linestart.children.toReversed(),children:[],branch:{left:(u=s.linestart.branch)==null?void 0:u.right}};default:{const f=s[r].children.map(_=>_==="linestart"?"lineend":_==="lineend"?"linestart":_),l=s[r].parents.map(_=>_==="linestart"?"lineend":_==="lineend"?"linestart":_);return{...s[r],parents:a?f:f.reverse(),children:a?l:l.reverse(),branch:{left:(b=s[r].branch)==null?void 0:b.right,right:(g=s[r].branch)==null?void 0:g.left}}}}})(t)}),{});c(xe(i))},Yt=a=>(c,n)=>{const{stn_list:s}=n().param,{branches:i}=n().helper,e=i[0][1],t=i[0][2],r=i[0].slice(-2)[0],d=i[0].slice(-3)[0];if(a){const u={...s,linestart:{...s.linestart,children:s.linestart.children.map(b=>b===e?t:b)},[e]:{...s[e],parent:s[e].parents.map(b=>b==="linestart"?r:b),children:s[e].children.map(b=>b===t?"lineend":b)},[t]:{...s[t],parent:s[t].parents.map(b=>b===e?"linestart":b)},[r]:{...s[r],children:s[r].children.map(b=>b==="lineend"?e:b)},lineend:{...s.lineend,parents:s.lineend.parents.map(b=>b===r?e:b)}};c(xe(u))}else{const u={...s,linestart:{...s.linestart,children:s.linestart.children.map(b=>b===e?r:b)},[e]:{...s[e],parent:s[e].parents.map(b=>b==="linestart"?r:b)},[d]:{...s[d],children:s[d].children.map(b=>b===r?"lineend":b)},[r]:{...s[r],parents:s[r].parents.map(b=>b===d?"linestart":b),children:s[r].children.map(b=>b==="lineend"?e:b)},lineend:{...s.lineend,parents:s.lineend.parents.map(b=>b===r?d:b)}};c(xe(u))}},qt=(a,c,n)=>(s,i)=>{const e=i().param.stn_list[a];s(be(a,{...e,localisedName:{...e.localisedName,[c]:n}}))},os=(a,c)=>(n,s)=>{const{localisedSecondaryName:i,...e}=s().param.stn_list[a];n(c?be(a,{...e,localisedSecondaryName:{}}):be(a,e))},Kt=(a,c,n)=>(s,i)=>{const e=i().param.stn_list[a];s(be(a,{...e,localisedSecondaryName:{...e.localisedSecondaryName,[c]:n}}))},ls=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,num:c}))},Xt=(a,c,n)=>(s,i)=>{var r,d;const e=i().param.stn_list[a],t=e.transfer.groups.map(u=>({...u}));if(t.length>c)t[c]={...t[c],lines:((r=t[c].lines)!=null?r:[]).concat(n)};else{for(let u=t.length;u<c;u++)t[u]={lines:[]};t[c]={lines:[n]}}s(be(a,{...e,transfer:{...e.transfer,groups:[t[0],...(d=t.slice(1))!=null?d:[]]}}))},cs=(a,c,n)=>(s,i)=>{var t,r;const e=i().param.stn_list[a];if(e.transfer.groups.length>c&&(((t=e.transfer.groups[c].lines)==null?void 0:t.length)||0)>n){const d=e.transfer.groups.map((u,b)=>{var g;return b===c?{...u,lines:(g=u.lines)==null?void 0:g.filter((f,l)=>l!==n)}:u});s(be(a,{...e,transfer:{...e.transfer,groups:[d[0],...(r=d.slice(1))!=null?r:[]]}}))}},ds=(a,c,n,s)=>(i,e)=>{var r,d;const t=e().param.stn_list[a];if(t.transfer.groups.length>c&&(((r=t.transfer.groups[c].lines)==null?void 0:r.length)||0)>n){const u=t.transfer.groups.map((b,g)=>{var f;return g===c?{...b,lines:(f=b.lines)==null?void 0:f.map((l,_)=>_===n?s:l)}:b});i(be(a,{...t,transfer:{...t.transfer,groups:[u[0],...(d=u.slice(1))!=null?d:[]]}}))}},Jt=(a,c,n)=>(s,i)=>{var r;const e=i().param.stn_list[a],t=e.transfer.groups.map(d=>({...d}));t.length>c&&(t[c]={...t[c],name:n},s(be(a,{...e,transfer:{...e.transfer,groups:[t[0],...(r=t.slice(1))!=null?r:[]]}})))},hs=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,transfer:{...i.transfer,tick_direc:c}}))},us=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,transfer:{...i.transfer,paid_area:c}}))},fs=(a,c,n)=>(s,i)=>{var t,r;const e=i().param.stn_list[a];s(be(a,{...e,branch:{...e.branch,[c]:(r=(t=e.branch)==null?void 0:t[c])==null?void 0:r.with(0,n)}}))},ps=(a,c,n)=>(s,i)=>{var r,d,u;const e=i().helper.branches,t={stnId:a,direction:c,first:n};if(c===Se.left){const b=(r=e.slice(1).find(g=>g.slice(-1)[0]===a))==null?void 0:r[0];if(b){const g=e[0][e[0].indexOf(b)+1];s(Qt([t,{stnId:b,direction:Se.right,first:g}]))}}else{const b=(u=(d=e.slice(1).find(g=>g[0]===a))==null?void 0:d.slice(-1))==null?void 0:u[0];if(b){const g=e[0][e[0].indexOf(b)-1];s(Qt([t,{stnId:b,direction:Se.left,first:g}]))}}},Qt=a=>(c,n)=>{var i,e,t,r;const{stn_list:s}=n().param;c(xe({...s,[a[0].stnId]:{...s[a[0].stnId],branch:{...s[a[0].stnId].branch,[a[0].direction]:(e=(i=s[a[0].stnId].branch)==null?void 0:i[a[0].direction])==null?void 0:e.with(1,a[0].first)}},[a[1].stnId]:{...s[a[1].stnId],branch:{...s[a[1].stnId].branch,[a[1].direction]:(r=(t=s[a[1].stnId].branch)==null?void 0:t[a[1].direction])==null?void 0:r.with(1,a[1].first)}}}))},ms=(a,c)=>(n,s)=>{var e,t,r;const i=s().helper.branches;if(c===Se.left){const d=(e=i.slice(1).find(u=>u.slice(-1)[0]===a))==null?void 0:e[0];d&&n(en(a,d))}else{const d=(r=(t=i.slice(1).find(u=>u[0]===a))==null?void 0:t.slice(-1))==null?void 0:r[0];d&&n(en(d,a))}},en=(a,c)=>(n,s)=>{const{stn_list:i}=s().param;n(xe({...i,[a]:{...i[a],parents:i[a].parents.slice().reverse()},[c]:{...i[c],children:i[c].children.slice().reverse()}}))},gs=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,facility:c||void 0}))},bs=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,services:c}))},_s=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,underConstruction:c}))},vs=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,loop_pivot:c}))},ys=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,one_line:c}))},Ss=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,int_padding:c}))},xs=a=>(c,n)=>{const i=n().param.stn_list[a].int_padding,e=structuredClone(n().param.stn_list);Object.values(e).forEach(t=>{t.int_padding=i}),c(xe(e))},ws=(a,c)=>(n,s)=>{const i=s().param.stn_list[a];n(be(a,{...i,character_spacing:c}))},ks=a=>(c,n)=>{const i=n().param.stn_list[a].character_spacing,e=structuredClone(n().param.stn_list);Object.values(e).forEach(t=>{t.character_spacing=i}),c(xe(e))},Cs=(a,c,n=2,s="asc")=>(i,e)=>{var u;const t=e().param.stn_list,d=(u=e().helper.branches[a])==null?void 0:u.slice(1,-1);if(d){const b=d.reduce((g,f,l)=>({...g,[f]:{...t[f],num:(c+l*(s==="desc"?-1:1)).toString().padStart(n,"0")}}),t);i(xe(b))}};function js(){var d,u,b,g;const{t:a}=le(),c=ue(),n=Q(f=>f.app.selectedStation);console.log("InfoSection:: Rendering for",n);const s=Q(f=>f.param.style),{num:i,localisedName:e,localisedSecondaryName:t}=Q(f=>f.param.stn_list[n]),r=[{type:"input",label:a("StationSidePanel.info.num"),value:i,placeholder:"01",onChange:f=>c(ls(n,f)),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("Chinese name"),value:(d=e.zh)!=null?d:"",onChange:f=>c(qt(n,"zh",f))},{type:"input",label:a("English name"),value:(u=e.en)!=null?u:"",onChange:f=>c(qt(n,"en",f))},{type:"custom",label:a("Secondary names"),component:v.jsx(Ae,{selections:[{label:a("Yes"),value:!0},{label:a("No"),value:!1}],defaultValue:!!t,onChange:f=>c(os(n,f))}),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("StationSidePanel.info.zhSecondary"),value:(b=t==null?void 0:t.zh)!=null?b:"",placeholder:"1号航站楼",onChange:f=>c(Kt(n,"zh",f)),hidden:!t||![X.GZMTR].includes(s)},{type:"input",label:a("StationSidePanel.info.enSecondary"),value:(g=t==null?void 0:t.en)!=null?g:"",placeholder:"Terminal 1",onChange:f=>c(Kt(n,"en",f)),hidden:!t||![X.GZMTR].includes(s)}];return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("StationSidePanel.info.title")}),v.jsx(ge,{fields:r,minW:130})]})}class As{static hexToRgb(c){return[parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5,7),16)]}static fade(c,n){return"rgba(".concat([...this.hexToRgb(c),n].join(","),")")}static euclideanDistance(c,n){return this.hexToRgb(c).reduce((s,i,e)=>s+Math.pow(i-this.hexToRgb(n)[e],2),0)}}function Nt(a){var i;const{theme:c,onClick:n}=a,{t:s}=le();return v.jsx(Ne,{size:"xs","aria-label":s("Colour"),mt:"0.45px",color:c==null?void 0:c[3],bg:c==null?void 0:c[2],_hover:{bg:As.fade((i=c==null?void 0:c[2])!=null?i:"#aaaaaa",.7)},icon:v.jsx(Fn,{}),onClick:n})}function Es(a){const{interchangeList:c,onAdd:n,onDelete:s,onUpdate:i}=a,{t:e}=le(),t=ue(),[r,d]=J.useState(),{paletteAppClipOutput:u}=Q(m=>m.app),{style:b,theme:g,stn_list:f}=Q(m=>m.param);J.useEffect(()=>{r!==void 0&&u&&(i==null||i(r,{...c[r],theme:u}),d(void 0))},[u==null?void 0:u.toString()]);const l=Object.values(f).reduce((m,y)=>{const[x,C]=m;return[[...new Set(x.concat(y.transfer.groups.map(j=>{var A,I;return(I=(A=j.lines)==null?void 0:A.map(R=>R.name[0]))!=null?I:[]}).flat()))],[...new Set(C.concat(y.transfer.groups.map(j=>{var A,I;return(I=(A=j.lines)==null?void 0:A.map(R=>R.name[1]))!=null?I:[]}).flat()))]]},[[],[]]),_=Object.fromEntries(Object.entries(xt).filter(([m])=>!["railway"].includes(m)).map(([m,y])=>[m,e(y)])),p=c.map((m,y)=>[{type:"input",label:e("Chinese name"),value:m.name[0],onChange:x=>i==null?void 0:i(y,{...m,name:[x,m.name[1]]}),optionList:l[0]},{type:"input",label:e("English name"),value:m.name[1],onChange:x=>i==null?void 0:i(y,{...m,name:[m.name[0],x]}),optionList:l[1]},{type:"select",label:e("Line icon"),value:m.facility,options:{"":e("None"),..._},onChange:x=>i==null?void 0:i(y,{...m,facility:x}),hidden:![X.MTR].includes(b)}]);return v.jsxs(De,{direction:"column",children:[c.length===0&&v.jsxs(Ee,{spacing:.5,"data-testid":"interchange-card-stack",children:[v.jsx(ct,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("StationSidePanel.interchange.noInterchanges")}),v.jsx(Ne,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n({theme:[g[0],"","#aaaaaa",dt.white],name:["",""]}),icon:v.jsx(Be,{})})]}),c.map((m,y)=>v.jsxs(Ee,{spacing:.5,"data-testid":"interchange-card-stack-".concat(y),children:[v.jsx(wt,{label:e("Colour"),minW:"40px",noLabel:y!==0,children:v.jsx(Nt,{theme:m.theme,onClick:()=>{var x;d(y),t(Rt((x=m.theme)!=null?x:[g[0],"","#aaaaaa",dt.white]))}})}),v.jsx(ge,{fields:p[y],noLabel:y!==0}),n&&y===p.length-1?v.jsx(Ne,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(c.slice(-1)[0]),icon:v.jsx(Un,{})}):v.jsx(ke,{minW:8}),s&&v.jsx(Ne,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.remove"),onClick:()=>s==null?void 0:s(y),icon:v.jsx(zt,{})})]},y))]})}function Os(){const{t:a}=le(),c=ue(),n=Q(g=>g.app.selectedStation),{theme:s,style:i}=Q(g=>g.param),{transfer:e}=Q(g=>g.param.stn_list[n]),t=g=>{var f,l,_,p;return[{type:"input",label:a("Station Chinese name"),value:(l=(f=e.groups[g].name)==null?void 0:f[0])!=null?l:"",hidden:![X.MTR].includes(i),onChange:m=>{var y,x;return c(Jt(n,g,[m,(x=(y=e.groups[g].name)==null?void 0:y[1])!=null?x:""]))}},{type:"input",label:a("Station English name"),value:(p=(_=e.groups[g].name)==null?void 0:_[1])!=null?p:"",hidden:![X.MTR].includes(i),onChange:m=>{var y,x;return c(Jt(n,g,[(x=(y=e.groups[g].name)==null?void 0:y[0])!=null?x:"",m]))}},{type:"switch",label:a("Paid area"),isChecked:e.paid_area,onChange:m=>c(us(n,m)),hidden:![X.MTR].includes(i)||g===0,oneLine:!0}]},r=g=>f=>{c(Xt(n,g,f))},d=g=>f=>{c(cs(n,g,f))},u=g=>(f,l)=>{c(ds(n,g,f,l))},b=()=>{c(Xt(n,e.groups.length,{theme:[s[0],"","#AAAAAA",dt.white],name:["",""]}))};return v.jsxs(Ot,{align:"flex-start",p:1,children:[v.jsxs(Pe,{w:"100%",children:[v.jsx(ve,{as:"h5",size:"sm",mr:"auto",children:a("StationSidePanel.interchange.title")}),i===X.MTR&&v.jsx(Ae,{selections:[{label:a("Text on the left"),value:ht.left},{label:a("Text on the right"),value:ht.right}],defaultValue:e.tick_direc,onChange:g=>c(hs(n,g))})]}),e.groups.map((g,f)=>{var l;return v.jsxs(J.Fragment,{children:[v.jsx(ve,{as:"h6",size:"xs",children:a(f===0?"StationSidePanel.interchange.within":f===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),f!==0&&v.jsx(ge,{fields:t(f)}),v.jsx(Es,{interchangeList:(l=g.lines)!=null?l:[],onAdd:r(f),onDelete:d(f),onUpdate:u(f)})]},f)}),e.groups.length<3&&v.jsx(oe,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:v.jsx(Be,{}),onClick:b,children:a("StationSidePanel.interchange.addGroup")})]})}function Rs(){const{t:a}=le(),c=ue(),n=Q(m=>m.app.selectedStation),{style:s,loop:i}=Q(m=>m.param),{services:e,facility:t,loop_pivot:r,one_line:d,int_padding:u,character_spacing:b,underConstruction:g}=Q(m=>m.param.stn_list[n]),f=Object.values(Ut).map(m=>({label:a("StationSidePanel.more."+m),value:m,disabled:m===Ut.local&&s!==X.SHMetro})),l=Object.fromEntries(Object.entries(xt).filter(([m])=>!["railway"].includes(m)).map(([m,y])=>[m,a(y)])),_=Object.fromEntries(Object.entries(xt).filter(([m])=>!["np360"].includes(m)).map(([m,y])=>[m,a(y)])),p=[{type:"custom",label:a("StationSidePanel.more.service"),component:v.jsx(Ae,{selections:f,defaultValue:e,onChange:m=>c(bs(n,m)),multiSelect:!0}),hidden:![X.GZMTR,X.SHMetro].includes(s)},{type:"select",label:a("StationSidePanel.more.facility"),value:t||"",options:{"":a("None"),...s===X.MTR?l:_},onChange:m=>c(gs(n,m)),hidden:![X.MTR,X.SHMetro].includes(s)},{type:"switch",label:a("StationSidePanel.more.pivot"),isChecked:r,onChange:m=>c(vs(n,m)),hidden:![X.GZMTR,X.SHMetro].includes(s)||!i,minW:"full",oneLine:!0},{type:"switch",label:a("StationSidePanel.more.oneLine"),isChecked:d,onChange:m=>c(ys(n,m)),hidden:![X.SHMetro].includes(s),minW:"full",oneLine:!0},{type:"input",label:a("StationSidePanel.more.intPadding"),value:u.toString(),validator:m=>Number.isInteger(m),onChange:m=>c(Ss(n,Number(m))),hidden:![X.SHMetro].includes(s)},{type:"custom",label:a("StationSidePanel.more.intPaddingApplyGlobal"),component:v.jsx(Ae,{selections:[{label:a("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>c(xs(n))}),oneLine:!0,hidden:![X.SHMetro].includes(s)},{type:"input",label:a("StationSidePanel.more.characterSpacing"),value:b.toString(),validator:m=>Number.isInteger(m),onChange:m=>c(ws(n,Number(m))),hidden:![X.SHSuburbanRailway].includes(s)},{type:"custom",label:a("StationSidePanel.more.intPaddingApplyGlobal"),component:v.jsx(Ae,{selections:[{label:a("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>c(ks(n))}),oneLine:!0,hidden:![X.SHSuburbanRailway].includes(s)},{type:"custom",label:a("Under construction"),component:v.jsx(Ae,{selections:[{label:a("No"),value:!1},{label:a("Temporary"),value:"temp"},{label:a("Yes"),value:!0}],defaultValue:g!=null?g:!1,onChange:m=>c(_s(n,m))}),hidden:![X.GZMTR].includes(s)}];return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("StationSidePanel.more.title")}),v.jsx(ge,{fields:p})]})}function zs(){const{t:a}=le(),c=ue(),n=Q(g=>g.app.selectedStation),s=Q(g=>g.param.stn_list),{parents:i,children:e,branch:t}=s[n],r={[ut.through]:a("StationSidePanel.branch.through"),[ut.nonThrough]:a("StationSidePanel.branch.nonThrough")},d=g=>(g===Se.left?i:e).reduce((f,l)=>({...f,[l]:s[l].localisedName.zh+"/"+s[l].localisedName.en}),{}),u={upper:a("StationSidePanel.branch.upper"),lower:a("StationSidePanel.branch.lower")},b=g=>{const f=t==null?void 0:t[g];return f?[{type:"select",label:a("StationSidePanel.branch.type"),options:r,value:f[0],onChange:l=>c(fs(n,g,l))},{type:"select",label:a("StationSidePanel.branch.firstStation"),options:d(g),value:f[1],onChange:l=>c(ps(n,g,l))},{type:"select",label:a("StationSidePanel.branch.position"),options:u,value:(g===Se.left?i:e)[0]===f[1]?"upper":"lower",onChange:()=>c(ms(n,g))}]:[]};return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("Branches")}),v.jsx(ve,{as:"h6",size:"xs",children:a("Branch on the left")}),v.jsx(De,{direction:"column",children:i.length===2?v.jsx(ge,{fields:b(Se.left)}):v.jsx(ct,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:a("No branches found")})}),v.jsx(ve,{as:"h6",size:"xs",children:a("Branch on the right")}),v.jsx(De,{direction:"column",children:e.length===2?v.jsx(ge,{fields:b(Se.right)}):v.jsx(ct,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:a("No branches found")})})]})}function Ps(){return v.jsxs(Pt,{children:[v.jsx(js,{}),v.jsx(Ie,{}),v.jsx(Os,{}),v.jsx(Ie,{}),v.jsx(zs,{}),v.jsx(Ie,{}),v.jsx(Rs,{})]})}function Ts(){const{t:a}=le(),c=ue(),{style:n,svgWidth:s,svg_height:i,y_pc:e,branchSpacingPct:t,padding:r,direction_gz_x:d,direction_gz_y:u,loop:b}=Q(f=>f.param),g=[...Tt[n].map(f=>({type:"input",label:a("StyleSidePanel.layout.".concat(f,"Width")),value:s[f].toString(),onChange:l=>c(Wn({width:Number(l),canvas:f}))})),{type:"input",label:a("StyleSidePanel.layout.canvasHeight"),value:i.toString(),onChange:f=>c(Zn(Number(f)))},{type:"slider",label:a("StyleSidePanel.layout.verticalPosition"),value:e,min:0,max:100,onChange:f=>c(Hn(f)),leftIcon:v.jsx(Ct,{}),rightIcon:v.jsx(kt,{}),hidden:![X.MTR,X.GZMTR].includes(n)},{type:"slider",label:b?n===X.GZMTR?a("StyleSidePanel.layout.loopSpacing"):a("StyleSidePanel.layout.branchSpacingLoop"):a("Branch spacing"),value:t,min:0,max:b?50:100,onChange:f=>c(Gn(f)),leftIcon:v.jsx(Wt,{}),rightIcon:v.jsx(Be,{})},{type:"slider",label:a("StyleSidePanel.layout.padding"),value:r,min:0,max:50,onChange:f=>c(Vn(f)),leftIcon:v.jsx(Wt,{}),rightIcon:v.jsx(Be,{})},{type:"slider",label:a("StyleSidePanel.layout.directionGzX"),value:d,min:0,max:100,onChange:f=>c($n(f)),leftIcon:v.jsx(hn,{}),rightIcon:v.jsx(dn,{}),hidden:![X.GZMTR].includes(n)},{type:"slider",label:a("StyleSidePanel.layout.directionGzY"),value:u,min:0,max:100,onChange:f=>c(Yn(f)),leftIcon:v.jsx(Ct,{}),rightIcon:v.jsx(kt,{}),hidden:![X.GZMTR].includes(n)}];return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.layout.title")}),v.jsx(ge,{fields:g,minW:130})]})}function Bs(){var k;const{t:a}=le(),c=ue(),{paletteAppClipOutput:n}=Q(O=>O.app),{style:s,theme:i,line_name:e,line_num:t,spanLineNum:r,direction:d,platform_num:u,psd_num:b,coachNum:g,namePosMTR:f,customiseMTRDest:l,info_panel_type:_,stn_list:p,loop:m}=Q(O=>O.param),y=Math.max(...Object.values(p).map(O=>O.services.length)),[x,C]=J.useState(!1);J.useEffect(()=>{x&&n&&(c(qn(n)),C(!1))},[n==null?void 0:n.toString()]);const j=[{label:a("StyleSidePanel.design.left"),value:ht.left},{label:a("StyleSidePanel.design.right"),value:ht.right}],A=Object.values(ot).reduce((O,h)=>({...O,[h]:a("StyleSidePanel.design."+h)}),{}),I=Object.values(Kn).reduce((O,h)=>({...O,[h]:a("StyleSidePanel.design."+h)}),{}),R=[{type:"custom",label:a("Colour"),component:v.jsx(Nt,{theme:i,onClick:()=>{C(!0),c(Rt(i))}}),minW:"40px"},{type:"input",label:a("StyleSidePanel.design.zhLineName"),value:e[0],onChange:O=>c(Zt([O,e[1]])),minW:130},{type:"input",label:a("StyleSidePanel.design.enLineName"),value:e[1],onChange:O=>c(Zt([e[0],O])),minW:130},{type:"input",label:a("StyleSidePanel.design.lineNum"),value:t,onChange:O=>c(Xn(O)),hidden:![X.GZMTR].includes(s)},{type:"custom",label:a("Span digits over rows"),component:v.jsx(Ae,{selections:[{label:a("Yes"),value:!0},{label:a("No"),value:!1}],defaultValue:r!=null?r:!1,onChange:O=>c(Jn(O))}),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("StyleSidePanel.design.platformNum"),value:u||"",onChange:O=>c(Qn(O))},{type:"input",label:a("StyleSidePanel.design.psdNum"),value:b,onChange:O=>c(er(O)),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("Coach number"),value:g,onChange:O=>c(tr(O)),hidden:![X.GZMTR].includes(s)},{type:"select",label:a("StyleSidePanel.design.panelType"),value:_,options:s===X.GZMTR?A:I,disabledOptions:m?[ot.gz1822]:[ot.gz11,ot.gz1822],onChange:O=>c(nr(O)),hidden:![X.GZMTR,X.SHMetro].includes(s)},{type:"custom",label:a("StyleSidePanel.design.direction"),component:v.jsx(Ae,{selections:j,defaultValue:d,onChange:O=>c(rr(O))}),minW:"full",oneLine:!0}],M=[{label:a("StyleSidePanel.design.upwards"),value:!0},{label:a("StyleSidePanel.design.downward"),value:!1}],z=[{type:"custom",label:a("StyleSidePanel.design.firstStationNameDisplay"),component:v.jsx(Ee,{spacing:.5,children:v.jsx(Ae,{selections:M,defaultValue:(k=f.isFlip)!=null?k:!0,onChange:O=>c(Ht(O))})}),minW:"full",oneLine:!0,hidden:![X.SHMetro].includes(s)||y>1||m}],L=[{label:a("StyleSidePanel.design.alternatively"),value:!0},{label:a("StyleSidePanel.design.onOneSide"),value:!1}],V=[{type:"custom",label:a("StyleSidePanel.design.nameDisplay"),component:v.jsxs(Ee,{spacing:.5,children:[v.jsx(Ne,{size:"xs",variant:"ghost","aria-label":a("StyleSidePanel.design.flip"),title:a("StyleSidePanel.design.flip"),icon:v.jsx(sr,{}),onClick:()=>c(Ht())}),v.jsx(Ae,{selections:L,defaultValue:f.isStagger,onChange:O=>c(ir(O))})]}),minW:"full",oneLine:!0,hidden:![X.MTR].includes(s)},{type:"switch",label:a("StyleSidePanel.design.legacyDestination"),isChecked:l.isLegacy,onChange:O=>c(ar(O)),hidden:![X.MTR].includes(s),minW:"full",oneLine:!0},{type:"switch",label:a("StyleSidePanel.design.overrideTerminal"),isChecked:l.terminal!==!1,onChange:O=>c(_t(O?["",""]:!1)),hidden:![X.MTR].includes(s),minW:"full",oneLine:!0},{type:"input",label:a("StyleSidePanel.design.terminalZhName"),value:l.terminal?l.terminal[0]:"",placeholder:"機場及博覽館",onChange:O=>c(_t([O,l.terminal?l.terminal[1]:""])),hidden:![X.MTR].includes(s)||l.terminal===!1},{type:"input",label:a("StyleSidePanel.design.terminalEnName"),value:l.terminal?l.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:O=>c(_t([l.terminal?l.terminal[0]:"",O])),hidden:![X.MTR].includes(s)||l.terminal===!1}];return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.design.title")}),v.jsx(ge,{fields:[...R,...V,...z],minW:130})]})}function Ns(){const{t:a}=le(),c=ue(),{loop:n}=Q(e=>e.param),s=[{type:"switch",label:a("StyleSidePanel.loop.isLoop"),isChecked:n,onChange:e=>c(or(e)),minW:"full",oneLine:!0}],i=()=>{c(un(0)),c(Le(Me.BRANCH))};return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("Loop line")}),v.jsx(ge,{fields:s}),n&&v.jsx(Pe,{p:1,children:v.jsx(oe,{size:"sm",variant:"outline",leftIcon:v.jsx(lr,{}),onClick:i,flex:1,children:a("More settings")})})]})}function Is(a){const{note:c,onUpdate:n,onDelete:s}=a,{t:i}=le(),e=[{type:"textarea",label:i("StyleSidePanel.note.zhNote"),value:c[0],onChange:r=>n==null?void 0:n([r,c[1],c[2],c[3],c[4]])},{type:"textarea",label:i("StyleSidePanel.note.enNote"),value:c[1],onChange:r=>n==null?void 0:n([c[0],r,c[2],c[3],c[4]])},{type:"switch",label:i("StyleSidePanel.note.border"),isChecked:c[4],onChange:r=>n==null?void 0:n([c[0],c[1],c[2],c[3],r]),oneLine:!0}],t=[{type:"slider",label:i("StyleSidePanel.note.positionX"),value:c[2],min:0,max:100,onChange:r=>n==null?void 0:n([c[0],c[1],r,c[3],c[4]]),leftIcon:v.jsx(hn,{}),rightIcon:v.jsx(dn,{})},{type:"slider",label:i("StyleSidePanel.note.positionY"),value:c[3],min:0,max:100,onChange:r=>n==null?void 0:n([c[0],c[1],c[2],r,c[4]]),leftIcon:v.jsx(Ct,{}),rightIcon:v.jsx(kt,{})}];return v.jsxs(De,{direction:"column",children:[v.jsx(ge,{fields:e,minW:"full"}),v.jsxs(Ee,{spacing:.5,sx:{"&>div":{flex:1}},children:[v.jsx(ge,{fields:t}),v.jsx(Ne,{size:"sm",variant:"ghost","aria-label":i("StyleSidePanel.note.remove"),onClick:()=>s==null?void 0:s(),icon:v.jsx(zt,{})})]})]})}function Ms(){const{t:a}=le(),c=ue(),n=Q(s=>s.param.notesGZMTR);return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.note.title")}),v.jsxs(Ot,{spacing:.5,children:[n==null?void 0:n.map((s,i)=>v.jsx(Is,{note:s,onUpdate:e=>c(dr({index:i,note:e})),onDelete:()=>c(cr(i))},i)),v.jsx(oe,{size:"xs",variant:"ghost",leftIcon:v.jsx(Be,{}),alignSelf:"flex-end",onClick:()=>c(hr()),children:a("StyleSidePanel.note.add")})]})]})}function Ds(){const{style:a}=Q(c=>c.param);return v.jsxs(Pt,{children:[v.jsx(Ts,{}),v.jsx(Ie,{}),v.jsx(Bs,{}),[X.GZMTR,X.SHMetro].includes(a)&&v.jsxs(v.Fragment,{children:[v.jsx(Ie,{}),v.jsx(Ns,{})]}),a===X.GZMTR&&v.jsxs(v.Fragment,{children:[v.jsx(Ie,{}),v.jsx(Ms,{})]})]})}const It=(a,c)=>{if(["linestart","lineend"].includes(a)||c[a].parents.length>1||c[a].children.length>1)return 0;const n=c[a].parents[0];return n?c[n].children.length===1?It(n,c):c[n].children.indexOf(a)===0?1:-1:0},Ls=a=>(c,n)=>{const{stn_list:s,current_stn_idx:i}=n().param;if(a===i)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:e,children:t}=s[a];return Object.keys(s).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):e.length===2&&t.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(s).some(d=>![a,"linestart","lineend"].includes(d)&&It(d,s)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Fs=a=>(c,n)=>{var r,d;const s=n().param.stn_list,{parents:i,children:e}=s[a];let t=JSON.parse(JSON.stringify(s));i.length===2||e.length===2?(i.forEach(u=>{t[u].children=t[u].children.map(b=>b===a?e:b).flat()}),e.forEach(u=>{t[u].parents=t[u].parents.map(b=>b===a?i:b).flat()}),i.length===1&&(t[i[0]].branch={...t[i[0]].branch,right:(r=t[a].branch)==null?void 0:r.right}),e.length===1&&(t[e[0]].branch={...t[e[0]].branch,left:(d=t[a].branch)==null?void 0:d.left})):s[i[0]].children.length===2&&s[e[0]].parents.length===2?t={...s,[i[0]]:{...s[i[0]],children:s[i[0]].children.filter(u=>u!==a),branch:{...s[i[0]].branch,right:void 0}},[e[0]]:{...s[e[0]],parents:s[e[0]].parents.filter(u=>u!==a),branch:{...s[e[0]].branch,left:void 0}}}:(i.forEach(u=>{var g,f,l,_;const b=t[u].children.indexOf(a);e.length?t[u].children[b]=e[0]:t[u].children.splice(b,1),((f=(g=t[u].branch)==null?void 0:g.right)==null?void 0:f[1])===a&&(t[u].branch={...t[u].branch,right:(_=(l=t[u].branch)==null?void 0:l.right)==null?void 0:_.with(1,e[0])})}),e.forEach(u=>{var g,f,l,_;const b=t[u].parents.indexOf(a);i.length?t[u].parents[b]=i[0]:t[u].parents.splice(b,1),((f=(g=t[u].branch)==null?void 0:g.left)==null?void 0:f[1])===a&&(t[u].branch={...t[u].branch,left:(_=(l=t[u].branch)==null?void 0:l.left)==null?void 0:_.with(1,i[0])})})),delete t[a],c(xe(t))};function Us(...a){return a.reduce((c,n)=>c.map(s=>n.map(i=>s.concat([i]))).reduce((s,i)=>s.concat(i),[]),[[]])}const We=(a,c)=>!!c[a[0]].children.indexOf(a[1]),_n=(a,c)=>[a[0][1],a[0][a[0].length-2],...a[0].filter(n=>a.slice(1).filter(s=>We(s,c)).map(s=>s.filter(i=>!["linestart","lineend"].includes(i))).map(s=>[s[0],s[s.length-1]]).flat().includes(n))],Ws=(a,c)=>a.slice(1).filter(n=>We(n,c)).map(n=>n.filter(s=>!["linestart","lineend"].includes(s))).map(n=>[n[0],n[n.length-1]]),Zs=a=>(c,n)=>{const s=n().helper.branches;if(a===0){const i=n().param.stn_list,e=_n(s,i);return Us(e,e).filter(t=>t[0]!==t[1])}else{const i=s[a];if(i){const e=i.filter(t=>!["linestart","lineend"].includes(t));return[[e[0],e.slice(-1)[0]]]}else return[]}},Wi=(a,c)=>(n,s)=>{const i=s().param.coline,e=s().helper.branches[c];for(const[t,r]of Object.entries(i))if(r.from===a&&e.includes(r.to)){const d=e.indexOf(a),u=e.indexOf(r.to);if(u>d)return[u-d+1,t]}else if(r.to===a&&e.includes(r.to)){const d=e.indexOf(a),u=e.indexOf(r.from);if(u>d)return[u-d+1,t]}return[0,void 0]},vn=(a,c)=>(n,s)=>{const i=s().param.stn_list,e=s().helper.branches;if(a===c)throw new Error("addColine():: failed for same stnId");const t=_n(e,i).filter(d=>[a,c].includes(d)),r=Ws(e,i).filter(d=>[a,c].every(u=>d.includes(u)));if(t.length===2&&r.length>0)throw new Error("addColine():: main check failed for ".concat(a,", ").concat(c));if(t.length!==2&&r.length!==1)throw new Error("addColine():: branch check failed for ".concat(a,", ").concat(c))},Hs=a=>(c,n)=>{const s=n().param.coline,e=n().helper.branches[a];return e?Object.entries(s).reduce((t,r)=>e.includes(r[1].from)&&e.includes(r[1].to)?{...t,[r[0]]:r[1]}:{...t},{}):{}},Gs=a=>(c,n)=>{const s=n().param.coline;if(Object.keys(s).length===0)return;const i=Object.entries(s).reduce((e,t)=>t[1].from!==a&&t[1].to!==a?{...e,[t[0]]:t[1]}:{...e},{});c(Ue(i))},Vs=(a,c,n,s=!0)=>(i,e)=>{const t=e().param.coline;i(vn(a,c)),i(Ue({...t,[qe(4)]:{from:a,to:c,colors:n,display:s}}))},$s=(a,c,n,s=!0)=>(i,e)=>{const t=e().param.coline;if(a in t){i(vn(c,n));const r={...t,[a]:{...t[a],from:c,to:n,display:s}};i(Ue(r))}},Ys=(a,c)=>(n,s)=>{const i=s().param.coline;if(a in i&&i[a].colors.length>c){const e=i[a].colors.filter((t,r)=>r!==c);if(e.length===0){const{[a]:t,...r}=i;n(Ue(r))}else{const t={...i,[a]:{...i[a],colors:e}};n(Ue(t))}}},qs=(a,c,n)=>(s,i)=>{const e=i().param.coline;if(a in e&&e[a].colors.length>c){const t={...e,[a]:{...e[a],colors:e[a].colors.map((r,d)=>d===c?[0,1,2,3,4,5].map(u=>n[u]===void 0?r[u]:n[u]):r)}};s(Ue(t))}};function Ks(a){const{isOpen:c,onClose:n}=a,{t:s}=le(),i=ue(),e=Q(u=>u.app.selectedStation),[t,r]=J.useState(!1);J.useEffect(()=>{c||r(!1)},[c]);const d=()=>{const u=i(Ls(e));u?(n(),i(Le(Me.CLOSE)),i(fn("linestart")),i(Gs(e)),i(Fs(e))):r(!0),de.event(we.REMOVE_STATION,{success:u})};return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[t&&v.jsxs(ft,{status:"error",variant:"solid",size:"xs",children:[v.jsx(pt,{}),s("Unable to remove this station.")]}),v.jsxs(ke,{position:"relative",children:[v.jsx(Qe,{children:s("Remove station")}),v.jsx(et,{})]}),v.jsx(tt,{children:s("Are you sure to remove station? You cannot undo this action.")}),v.jsxs(nt,{children:[v.jsx(oe,{onClick:n,children:s("Cancel")}),v.jsx(oe,{colorScheme:"primary",onClick:d,ml:3,children:s("Confirm")})]})]})]})}function Xs(){const{t:a}=le(),c=ue(),{selectedStation:n}=Q(r=>r.app),{loop:s,style:i}=Q(r=>r.param),[e,t]=J.useState(!1);return v.jsxs(ur,{children:[v.jsxs(Ee,{children:[v.jsx(oe,{size:"sm",variant:"outline",onClick:()=>c(jt(n)),children:a("StationSidePanel.footer.current")}),i===X.GZMTR&&s&&v.jsx(oe,{size:"sm",variant:"outline",onClick:()=>c(pn(n)),children:a("Set as midpoint")}),v.jsx(oe,{size:"sm",variant:"outline",onClick:()=>t(!0),children:a("StationSidePanel.footer.remove")})]}),v.jsx(Ks,{isOpen:e,onClose:()=>t(!1)})]})}function Js(a){const{colineInfo:c,routeOptions:n,onUpdateRoute:s,onUpdateColourInfo:i,onDelete:e}=a,{t}=le(),r=ue(),{paletteAppClipOutput:d}=Q(l=>l.app),[u,b]=J.useState(!1);J.useEffect(()=>{u&&d&&(i==null||i([...d,c.colors[0][4],c.colors[0][5]]),b(!1))},[d==null?void 0:d.toString()]);const g=[{type:"select",label:"Route",value:[c.from,c.to].join(","),options:n,onChange:l=>s==null?void 0:s(l)}],f=[{type:"custom",label:t("Colour"),component:v.jsx(Nt,{theme:[c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3]],onClick:()=>{b(!0),r(Rt(c.colors[0].slice(0,4)))}})},{type:"input",label:t("Chinese name"),value:c.colors[0][4],minW:120,onChange:l=>i==null?void 0:i([c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3],l,c.colors[0][5]])},{type:"input",label:t("English name"),value:c.colors[0][5],minW:120,onChange:l=>i==null?void 0:i([c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3],c.colors[0][4],l])}];return v.jsxs(De,{direction:"column",children:[v.jsx(ge,{fields:g,minW:"full"}),v.jsxs(Ee,{spacing:.5,children:[v.jsx(ge,{fields:f}),v.jsx(Ne,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>e==null?void 0:e(0),icon:v.jsx(zt,{})})]})]})}function Qs(){const{t:a}=le(),c=ue(),n=Q(f=>f.app.selectedBranch),{theme:s,stn_list:i}=Q(f=>f.param),e=c(Hs(n)),t=c(Zs(n)),r=f=>f.map(l=>i[l].localisedName.zh+"/"+i[l].localisedName.en).join(" ~ "),d=t.reduce((f,l)=>({...f,[l.join(",")]:r(l)}),{}),u=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(n," with default combination"),t[0]),c(Vs(t[0][0],t[0][1],[[s[0],"","#AAAAAA",dt.white,"",""]]))},b=f=>l=>{const[_,p]=l.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(f,", from=").concat(_,", to=").concat(p));try{c($s(f,_,p))}catch(m){c(At({status:"error",message:"Unable to draw this share track."}))}},g=(f,l)=>{c(Ys(f,l))};return v.jsxs(Ot,{align:"flex-start",p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("BranchSidePanel.coline.title")}),Object.entries(e).map(([f,l])=>v.jsx(Js,{colineInfo:l,routeOptions:d,onUpdateRoute:b(f),onUpdateColourInfo:_=>c(qs(f,0,_)),onDelete:_=>g(f,_)},f)),(n===0||Object.keys(e).length===0)&&v.jsx(oe,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:v.jsx(Be,{}),onClick:u,children:a("BranchSidePanel.coline.add")})]})}function ei(a){const{isOpen:c,onClose:n}=a,{t:s}=le(),i=ue(),e=Q(j=>j.app.selectedBranch),{style:t,stn_list:r}=Q(j=>j.param),d=Q(j=>j.helper.branches),[u,b]=J.useState(e),[g,f]=J.useState("1"),[l,_]=J.useState("2"),[p,m]=J.useState("asc");J.useEffect(()=>{b(e)},[e]);const y=[{type:"select",label:s("AutoNumModal.where"),value:u,options:{...d.reduce((j,A,I)=>({...j,[I]:I===0?s("AutoNumModal.main"):t!==X.SHMetro||!We(A,r)?s("AutoNumModal.branch")+" "+I:s("AutoNumModal.external")+" "+I}),{})},onChange:j=>b(j)},{type:"input",label:s("AutoNumModal.from"),value:g,validator:j=>!isNaN(Number(j)),onChange:f,debouncedDelay:0},{type:"input",label:s("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:l,onChange:_,debouncedDelay:0},{type:"select",label:s("AutoNumModal.sort"),value:p,options:{asc:s("AutoNumModal.asc"),desc:s("AutoNumModal.desc")},onChange:j=>m(j)}],x=()=>{i(Cs(u,Number(g),Number(l),p)),n(),de.event(we.AUTO_NUMBERING,{})},C=!g||!l||isNaN(Number(g))||isNaN(Number(l));return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[v.jsx(Qe,{children:s("AutoNumModal.title")}),v.jsx(et,{}),v.jsx(tt,{children:v.jsx(ge,{fields:y})}),v.jsx(nt,{children:v.jsx(oe,{colorScheme:"primary",isDisabled:C,onClick:x,children:s("Confirm")})})]})]})}const Mt=a=>(c,n)=>{const i=n().helper.branches[a];return i.includes("linestart")||i.includes("lineend")?1:2},yn=a=>(c,n)=>{const{branches:s}=n().helper,i=s[0],e=s[a];return i.slice(i.indexOf(e[0])+1,i.indexOf(e.slice(-1)[0]))},ti=(a,c)=>n=>n(Mt(c))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(yn(c)).includes(a)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),ni=(a,c)=>(n,s)=>{var d,u;if(!n(ti(a,c)))return!1;const{branches:e}=s().helper,t=s().param.stn_list,r=e[c];if(r[0]==="linestart"){const b={...t,[r[1]]:{...t[r[1]],parents:[a]},[a]:{...t[a],children:t.linestart.children.map(g=>g===r[1]?g:t[a].children[0]),branch:{right:(d=t.linestart.branch)==null?void 0:d.right}},linestart:{...t.linestart,children:t.linestart.children.filter(g=>g!==r[1]),branch:{}}};return n(xe(b)),!0}else{const b=r.slice(-2)[0],g={...t,[b]:{...t[b],children:[a]},[a]:{...t[a],parents:t.lineend.parents.map(f=>f===b?f:t[a].parents[0]),branch:{left:(u=t.lineend.branch)==null?void 0:u.left}},lineend:{...t.lineend,parents:t.lineend.parents.filter(f=>f!==b),branch:{}}};return n(xe(g)),!0}},Sn=a=>(c,n)=>{const{branches:s}=n().helper,i=n().param.stn_list,e=s[0],t=s[a];if(c(Mt(a))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const d=e.indexOf(t[0]),u=e.slice(0,d),b=e.indexOf(t.slice(-1)[0]),g=e.slice(b+1),f=u.every(_=>i[_].children.length<=1&&i[_].parents.length<=1),l=g.every(_=>i[_].children.length<=1&&i[_].parents.length<=1);return f?l?[Se.left,Se.right]:[Se.left]:l?[Se.right]:[]},ri=(a,c)=>(n,s)=>{var u,b;if(!n(Sn(c)).includes(a))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:e}=s().helper,t=s().param.stn_list,r=e[0],d=e[c];if(a===Se.left){const g=d[0],f={...t,[d[1]]:{...t[d[1]],parents:["linestart"]},[g]:{...t[g],children:t[g].children.filter(l=>l!==d[1]),branch:{}},linestart:{...t.linestart,children:t[g].children.map(l=>l===d[1]?l:r[1]),branch:{right:(u=t[g].branch)==null?void 0:u.right}}};return n(xe(f)),!0}else{const g=d.slice(-1)[0],f=d.slice(-2)[0],l={...t,[f]:{...t[f],children:["lineend"]},[g]:{...t[g],parents:t[g].parents.filter(_=>_!==f),branch:{}},lineend:{...t.lineend,parents:t[g].parents.map(_=>_===f?_:r.slice(-2)[0]),branch:{left:(b=t[g].branch)==null?void 0:b.left}}};return n(xe(l)),!0}};function tn(a){const{direction:c}=a,{t:n}=le(),s=ue(),{branches:i}=Q(R=>R.helper),e=Q(R=>R.app.selectedBranch),{style:t,stn_list:r}=Q(R=>R.param),[d,u]=J.useState(!1),[b,g]=J.useState(""),f=i[e].filter(R=>!["linestart","lineend"].includes(R)),l=c===Se.left?f[0]:f.slice(-1)[0],_=r[l],p=s(yn(e)),m=s(Mt(e)),y=s(Sn(e)),x=m===1&&!i[0].includes(l),C=y.includes(c),j=p.reduce((R,M)=>{var z,L;return{...R,[M]:((z=r[M])==null?void 0:z.localisedName.zh)+"/"+((L=r[M])==null?void 0:L.localisedName.en)}},{"":n("Please select...")}),A=()=>{const R=s(ni(b,e));R?u(!1):s(At({status:"error",message:n("Unable to connect to main line.")})),de.event(we.CONNECT_BRANCH,{style:t,success:R})},I=()=>{const R=s(ri(c,e));R||s(At({status:"error",message:n("Unable to disconnect from main line.")})),de.event(we.DISCONNECT_BRANCH,{style:t,success:R})};return v.jsxs(De,{direction:"column",children:[v.jsxs(Pe,{alignItems:"center",children:[v.jsx(wt,{label:n("Station name"),flex:1,children:v.jsx(fr,{defaultValue:_.localisedName.zh+"/"+_.localisedName.en,isDisabled:!0})}),d?v.jsx(oe,{mx:1,size:"sm",variant:"outline",onClick:()=>u(!1),children:n("Cancel")}):x?v.jsx(oe,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>u(!0),children:n("Connect to main line")}):v.jsx(oe,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:I,isDisabled:!C,children:n("Disconnect from main line")})]}),d&&v.jsxs(Pe,{alignItems:"center",children:[v.jsx(wt,{label:n("Target station"),flex:1,children:v.jsx(pr,{defaultValue:b,options:j,disabledOptions:[""],onChange:({target:{value:R}})=>g(R)})}),v.jsx(oe,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!b,children:n("Confirm")})]})]})}function si(){const{t:a}=le(),c=ue(),{style:n,loop:s}=Q(d=>d.param),i=Q(d=>d.app.selectedBranch),[e,t]=J.useState(!1),r=()=>{c(as(n===X.SHMetro)),de.event(we.REVERSE_STATIONS,{style:n})};return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("BranchSidePanel.action.title")}),v.jsxs(Pe,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type), &:not(button)":{marginTop:2}}},children:[i!==0&&n!==X.SHMetro&&v.jsxs(v.Fragment,{children:[v.jsx(ve,{as:"h6",size:"xs",children:a("Branch left end")}),v.jsx(tn,{direction:Se.left}),v.jsx(ve,{as:"h6",size:"xs",children:a("Branch right end")}),v.jsx(tn,{direction:Se.right})]}),n===X.GZMTR&&v.jsx(oe,{size:"sm",variant:"outline",leftIcon:v.jsx(mr,{}),alignSelf:"flex-end",onClick:()=>t(!0),children:a("BranchSidePanel.action.autoNum")}),v.jsx(oe,{size:"sm",variant:"outline",leftIcon:v.jsx(gr,{}),alignSelf:"flex-end",onClick:r,children:n===X.SHMetro?a("BranchSidePanel.action.flip"):a("BranchSidePanel.action.reverse")}),s&&n===X.GZMTR&&v.jsxs(Ee,{children:[v.jsx(oe,{size:"sm",variant:"outline",leftIcon:v.jsx(br,{}),onClick:()=>c(Yt(!1)),flex:1,children:a("Rotate anticlockwise")}),v.jsx(oe,{size:"sm",variant:"outline",leftIcon:v.jsx(_r,{}),onClick:()=>c(Yt(!0)),flex:1,children:a("Rotate clockwise")})]})]}),v.jsx(ei,{isOpen:e,onClose:()=>t(!1)})]})}function ii(){const{t:a}=le(),c=ue(),{branches:n}=Q(_=>_.helper),{loop_info:s,style:i,stn_list:e}=Q(_=>_.param),{bank:t,left_and_right_factor:r,bottom_factor:d,clockwise:u}=s,b=n.flat().filter((_=>p=>(_[p]=(_[p]||0)+1)===2)({})).filter(_=>!["linestart","lineend"].includes(_)),g=Math.abs(n[0].indexOf(b[0])-n[0].indexOf(b[1])),f=n.length>=2?(0,Math.min)(n[0].length-2-g,g):Math.floor((n[0].length-2-d*2)/2),l=[{type:"switch",label:a("StyleSidePanel.loop.isBank"),isChecked:t,onChange:_=>c(vr(_)),minW:"full",oneLine:!0,hidden:i!==X.SHMetro},{type:"slider",label:a("StyleSidePanel.loop.leftRightFactor"),value:r,min:0,max:f,onChange:_=>c(yr(Math.floor(_))),hidden:i!==X.SHMetro},{type:"slider",label:a("StyleSidePanel.loop.bottomFactor"),value:d,min:0,max:Math.floor((n[0].length-2-r*2)/2),onChange:_=>c(Sr(Math.floor(_))),hidden:n.length>2||i!==X.SHMetro},{type:"custom",label:a("Loop direction"),component:v.jsx(Ae,{selections:[{label:a("Anticlockwise"),value:!1},{label:a("Clockwise"),value:!0}],defaultValue:u!=null?u:!1,onChange:_=>c(xr(_))}),hidden:![X.GZMTR].includes(i)},{type:"select",label:a("Midpoint station"),options:n[0].slice(1,-1).reduce((_,p)=>{const{zh:m,en:y}=e[p].localisedName;return{..._,[p]:"".concat(m,"/").concat(y)}},{}),value:s.midpoint_station,onChange:_=>c(pn(_)),hidden:![X.GZMTR].includes(i)}];return v.jsxs(ke,{p:1,children:[v.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.loop.title")}),v.jsx(ge,{fields:l})]})}function ai(){const a=Q(e=>e.app.selectedBranch),{style:c,stn_list:n,loop:s}=Q(e=>e.param),i=Q(e=>e.helper.branches);return v.jsxs(Pt,{children:[c===X.SHMetro&&(a===0||We(i[a],n))&&v.jsxs(v.Fragment,{children:[v.jsx(Qs,{}),v.jsx(Ie,{})]}),s&&v.jsxs(v.Fragment,{children:[v.jsx(ii,{}),v.jsx(Ie,{})]}),v.jsx(si,{})]})}const oi="rmg-palette-bridge--",li={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function ci(a){const{isOpen:c,onClose:n,defaultTheme:s,onSelect:i}=a,[e]=J.useState(qe()),[t,r]=J.useState(!1),d="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:de.getAppName(),parentId:e}),u=J.useRef();return J.useEffect(()=>{const b=new BroadcastChannel(oi+e);return u.current=b,b.onmessage=g=>{const{event:f,data:l}=g.data;console.log("[rmg] Received event from Palette app clip:",f),f==="CLOSE"?n():f==="SELECT"?i(l):f==="LOADED"&&r(!0)},()=>{b.close()}},[]),J.useEffect(()=>{var b;s&&((b=u.current)==null||b.postMessage({event:"OPEN",data:s}))},[t,s==null?void 0:s.toString()]),v.jsxs(mn,{size:"md",isOpen:c,onClose:n,sx:li,children:[v.jsx(sn,{onClick:n}),v.jsx("iframe",{src:d,loading:"eager"})]})}const di=410;function hi(){var d,u;const{t:a}=le(),c=on(),{sidePanelMode:n,selectedStation:s,paletteAppClipInput:i}=Q(b=>b.app),e=Q(b=>{var g;return(g=b.param.stn_list[s])==null?void 0:g.localisedName}),t={STATION:{header:v.jsx(ts,{text:(e==null?void 0:e.zh)+"/"+(e==null?void 0:e.en)||""}),body:v.jsx(Ps,{}),footer:v.jsx(Xs,{})},STYLE:{header:a("StyleSidePanel.header"),body:v.jsx(Ds,{})},BRANCH:{header:a("BranchSidePanel.header"),body:v.jsx(ai,{})},CLOSE:{header:"Close"}},r=()=>{c(Le(Me.CLOSE))};return v.jsxs(wr,{isOpen:n!==Me.CLOSE,width:di,header:"Dummy header",children:[v.jsx(kr,{onClose:r,children:t[n].header}),(d=t[n])==null?void 0:d.body,(u=t[n])==null?void 0:u.footer,v.jsx(ci,{isOpen:!!i,onClose:()=>c(jr()),defaultTheme:i,onSelect:b=>c(Cr(b))})]})}function lt(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var St={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var nn;function ui(){return nn||(nn=1,function(a,c){(function(n){a.exports=n()})(function(){return function n(s,i,e){function t(u,b){if(!i[u]){if(!s[u]){var g=typeof lt=="function"&&lt;if(!b&&g)return g(u,!0);if(r)return r(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var l=i[u]={exports:{}};s[u][0].call(l.exports,function(_){var p=s[u][1][_];return t(p||_)},l,l.exports,n,s,i,e)}return i[u].exports}for(var r=typeof lt=="function"&&lt,d=0;d<e.length;d++)t(e[d]);return t}({1:[function(n,s,i){var e=n("./utils"),t=n("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(d){for(var u,b,g,f,l,_,p,m=[],y=0,x=d.length,C=x,j=e.getTypeOf(d)!=="string";y<d.length;)C=x-y,g=j?(u=d[y++],b=y<x?d[y++]:0,y<x?d[y++]:0):(u=d.charCodeAt(y++),b=y<x?d.charCodeAt(y++):0,y<x?d.charCodeAt(y++):0),f=u>>2,l=(3&u)<<4|b>>4,_=1<C?(15&b)<<2|g>>6:64,p=2<C?63&g:64,m.push(r.charAt(f)+r.charAt(l)+r.charAt(_)+r.charAt(p));return m.join("")},i.decode=function(d){var u,b,g,f,l,_,p=0,m=0,y="data:";if(d.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===r.charAt(64)&&C--,d.charAt(d.length-2)===r.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=t.uint8array?new Uint8Array(0|C):new Array(0|C);p<d.length;)u=r.indexOf(d.charAt(p++))<<2|(f=r.indexOf(d.charAt(p++)))>>4,b=(15&f)<<4|(l=r.indexOf(d.charAt(p++)))>>2,g=(3&l)<<6|(_=r.indexOf(d.charAt(p++))),x[m++]=u,l!==64&&(x[m++]=b),_!==64&&(x[m++]=g);return x}},{"./support":30,"./utils":32}],2:[function(n,s,i){var e=n("./external"),t=n("./stream/DataWorker"),r=n("./stream/Crc32Probe"),d=n("./stream/DataLengthProbe");function u(b,g,f,l,_){this.compressedSize=b,this.uncompressedSize=g,this.crc32=f,this.compression=l,this.compressedContent=_}u.prototype={getContentWorker:function(){var b=new t(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),g=this;return b.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new t(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(b,g,f){return b.pipe(new r).pipe(new d("uncompressedSize")).pipe(g.compressWorker(f)).pipe(new d("compressedSize")).withStreamInfo("compression",g)},s.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,s,i){var e=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,s,i){var e=n("./utils"),t=function(){for(var r,d=[],u=0;u<256;u++){r=u;for(var b=0;b<8;b++)r=1&r?3988292384^r>>>1:r>>>1;d[u]=r}return d}();s.exports=function(r,d){return r!==void 0&&r.length?e.getTypeOf(r)!=="string"?function(u,b,g,f){var l=t,_=f+g;u^=-1;for(var p=f;p<_;p++)u=u>>>8^l[255&(u^b[p])];return-1^u}(0|d,r,r.length,0):function(u,b,g,f){var l=t,_=f+g;u^=-1;for(var p=f;p<_;p++)u=u>>>8^l[255&(u^b.charCodeAt(p))];return-1^u}(0|d,r,r.length,0):0}},{"./utils":32}],5:[function(n,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,s,i){var e=null;e=typeof Promise<"u"?Promise:n("lie"),s.exports={Promise:e}},{lie:37}],7:[function(n,s,i){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",t=n("pako"),r=n("./utils"),d=n("./stream/GenericWorker"),u=e?"uint8array":"array";function b(g,f){d.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=f,this.meta={}}i.magic="\b\0",r.inherits(b,d),b.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(u,g.data),!1)},b.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new t[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(f){g.push({data:f,meta:g.meta})}},i.compressWorker=function(g){return new b("Deflate",g)},i.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,s,i){function e(l,_){var p,m="";for(p=0;p<_;p++)m+=String.fromCharCode(255&l),l>>>=8;return m}function t(l,_,p,m,y,x){var C,j,A=l.file,I=l.compression,R=x!==u.utf8encode,M=r.transformTo("string",x(A.name)),z=r.transformTo("string",u.utf8encode(A.name)),L=A.comment,V=r.transformTo("string",x(L)),k=r.transformTo("string",u.utf8encode(L)),O=z.length!==A.name.length,h=k.length!==L.length,D="",ne="",Z="",se=A.dir,H=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};_&&!p||(re.crc32=l.crc32,re.compressedSize=l.compressedSize,re.uncompressedSize=l.uncompressedSize);var B=0;_&&(B|=8),R||!O&&!h||(B|=2048);var T=0,te=0;se&&(T|=16),y==="UNIX"?(te=798,T|=function(Y,fe){var ye=Y;return Y||(ye=fe?16893:33204),(65535&ye)<<16}(A.unixPermissions,se)):(te=20,T|=function(Y){return 63&(Y||0)}(A.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,j=H.getUTCFullYear()-1980,j<<=4,j|=H.getUTCMonth()+1,j<<=5,j|=H.getUTCDate(),O&&(ne=e(1,1)+e(b(M),4)+z,D+="up"+e(ne.length,2)+ne),h&&(Z=e(1,1)+e(b(V),4)+k,D+="uc"+e(Z.length,2)+Z);var q="";return q+="\n\0",q+=e(B,2),q+=I.magic,q+=e(C,2),q+=e(j,2),q+=e(re.crc32,4),q+=e(re.compressedSize,4),q+=e(re.uncompressedSize,4),q+=e(M.length,2),q+=e(D.length,2),{fileRecord:g.LOCAL_FILE_HEADER+q+M+D,dirRecord:g.CENTRAL_FILE_HEADER+e(te,2)+q+e(V.length,2)+"\0\0\0\0"+e(T,4)+e(m,4)+M+D+V}}var r=n("../utils"),d=n("../stream/GenericWorker"),u=n("../utf8"),b=n("../crc32"),g=n("../signature");function f(l,_,p,m){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=p,this.encodeFileName=m,this.streamFiles=l,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(f,d),f.prototype.push=function(l){var _=l.meta.percent||0,p=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(l):(this.bytesWritten+=l.data.length,d.prototype.push.call(this,{data:l.data,meta:{currentFile:this.currentFile,percent:p?(_+100*(p-m-1))/p:100}}))},f.prototype.openedSource=function(l){this.currentSourceOffset=this.bytesWritten,this.currentFile=l.file.name;var _=this.streamFiles&&!l.file.dir;if(_){var p=t(l,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(l){this.accumulate=!1;var _=this.streamFiles&&!l.file.dir,p=t(l,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),_)this.push({data:function(m){return g.DATA_DESCRIPTOR+e(m.crc32,4)+e(m.compressedSize,4)+e(m.uncompressedSize,4)}(l),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var l=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var p=this.bytesWritten-l,m=function(y,x,C,j,A){var I=r.transformTo("string",A(j));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+e(y,2)+e(y,2)+e(x,4)+e(C,4)+e(I.length,2)+I}(this.dirRecords.length,p,l,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(l){this._sources.push(l);var _=this;return l.on("data",function(p){_.processChunk(p)}),l.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),l.on("error",function(p){_.error(p)}),this},f.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(l){var _=this._sources;if(!d.prototype.error.call(this,l))return!1;for(var p=0;p<_.length;p++)try{_[p].error(l)}catch(m){}return!0},f.prototype.lock=function(){d.prototype.lock.call(this);for(var l=this._sources,_=0;_<l.length;_++)l[_].lock()},s.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,s,i){var e=n("../compressions"),t=n("./ZipFileWorker");i.generateWorker=function(r,d,u){var b=new t(d.streamFiles,u,d.platform,d.encodeFileName),g=0;try{r.forEach(function(f,l){g++;var _=function(x,C){var j=x||C,A=e[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(l.options.compression,d.compression),p=l.options.compressionOptions||d.compressionOptions||{},m=l.dir,y=l.date;l._compressWorker(_,p).withStreamInfo("file",{name:f,dir:m,date:y,comment:l.comment||"",unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions}).pipe(b)}),b.entriesCount=g}catch(f){b.error(f)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,s,i){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new e;for(var r in this)typeof this[r]!="function"&&(t[r]=this[r]);return t}}(e.prototype=n("./object")).loadAsync=n("./load"),e.support=n("./support"),e.defaults=n("./defaults"),e.version="3.10.1",e.loadAsync=function(t,r){return new e().loadAsync(t,r)},e.external=n("./external"),s.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,s,i){var e=n("./utils"),t=n("./external"),r=n("./utf8"),d=n("./zipEntries"),u=n("./stream/Crc32Probe"),b=n("./nodejsUtils");function g(f){return new t.Promise(function(l,_){var p=f.decompressed.getContentWorker().pipe(new u);p.on("error",function(m){_(m)}).on("end",function(){p.streamInfo.crc32!==f.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):l()}).resume()})}s.exports=function(f,l){var _=this;return l=e.extend(l||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),b.isNode&&b.isStream(f)?t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",f,!0,l.optimizedBinaryString,l.base64).then(function(p){var m=new d(l);return m.load(p),m}).then(function(p){var m=[t.Promise.resolve(p)],y=p.files;if(l.checkCRC32)for(var x=0;x<y.length;x++)m.push(g(y[x]));return t.Promise.all(m)}).then(function(p){for(var m=p.shift(),y=m.files,x=0;x<y.length;x++){var C=y[x],j=C.fileNameStr,A=e.resolve(C.fileNameStr);_.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:l.createFolders}),C.dir||(_.file(A).unsafeOriginalName=j)}return m.zipComment.length&&(_.comment=m.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,s,i){var e=n("../utils"),t=n("../stream/GenericWorker");function r(d,u){t.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(u)}e.inherits(r,t),r.prototype._bindStream=function(d){var u=this;(this._stream=d).pause(),d.on("data",function(b){u.push({data:b,meta:{percent:0}})}).on("error",function(b){u.isPaused?this.generatedError=b:u.error(b)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},r.prototype.pause=function(){return!!t.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,s,i){var e=n("readable-stream").Readable;function t(r,d,u){e.call(this,d),this._helper=r;var b=this;r.on("data",function(g,f){b.push(g)||b._helper.pause(),u&&u(f)}).on("error",function(g){b.emit("error",g)}).on("end",function(){b.push(null)})}n("../utils").inherits(t,e),t.prototype._read=function(){this._helper.resume()},s.exports=t},{"../utils":32,"readable-stream":16}],14:[function(n,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}},{}],15:[function(n,s,i){function e(A,I,R){var M,z=r.getTypeOf(I),L=r.extend(R||{},b);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(A=y(A)),L.createFolders&&(M=m(A))&&x.call(this,M,!0);var V=z==="string"&&L.binary===!1&&L.base64===!1;R&&R.binary!==void 0||(L.binary=!V),(I instanceof g&&I.uncompressedSize===0||L.dir||!I||I.length===0)&&(L.base64=!1,L.binary=!0,I="",L.compression="STORE",z="string");var k=null;k=I instanceof g||I instanceof d?I:_.isNode&&_.isStream(I)?new p(A,I):r.prepareContent(A,I,L.binary,L.optimizedBinaryString,L.base64);var O=new f(A,k,L);this.files[A]=O}var t=n("./utf8"),r=n("./utils"),d=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),b=n("./defaults"),g=n("./compressedObject"),f=n("./zipObject"),l=n("./generate"),_=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),m=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var I=A.lastIndexOf("/");return 0<I?A.substring(0,I):""},y=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,I){return I=I!==void 0?I:b.createFolders,A=y(A),this.files[A]||e.call(this,A,null,{dir:!0,createFolders:I}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var I,R,M;for(I in this.files)M=this.files[I],(R=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&A(R,M)},filter:function(A){var I=[];return this.forEach(function(R,M){A(R,M)&&I.push(M)}),I},file:function(A,I,R){if(arguments.length!==1)return A=this.root+A,e.call(this,A,I,R),this;if(C(A)){var M=A;return this.filter(function(L,V){return!V.dir&&M.test(L)})}var z=this.files[this.root+A];return z&&!z.dir?z:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(z,L){return L.dir&&A.test(z)});var I=this.root+A,R=x.call(this,I),M=this.clone();return M.root=R.name,M},remove:function(A){A=this.root+A;var I=this.files[A];if(I||(A.slice(-1)!=="/"&&(A+="/"),I=this.files[A]),I&&!I.dir)delete this.files[A];else for(var R=this.filter(function(z,L){return L.name.slice(0,A.length)===A}),M=0;M<R.length;M++)delete this.files[R[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var I,R={};try{if((R=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:t.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");r.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var M=R.comment||this.comment||"";I=l.generateWorker(this,R,M)}catch(z){(I=new d("error")).error(z)}return new u(I,R.type||"string",R.mimeType)},generateAsync:function(A,I){return this.generateInternalStream(A).accumulate(I)},generateNodeStream:function(A,I){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(I)}};s.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,s,i){s.exports=n("stream")},{stream:void 0}],17:[function(n,s,i){var e=n("./DataReader");function t(r){e.call(this,r);for(var d=0;d<this.data.length;d++)r[d]=255&r[d]}n("../utils").inherits(t,e),t.prototype.byteAt=function(r){return this.data[this.zero+r]},t.prototype.lastIndexOfSignature=function(r){for(var d=r.charCodeAt(0),u=r.charCodeAt(1),b=r.charCodeAt(2),g=r.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===d&&this.data[f+1]===u&&this.data[f+2]===b&&this.data[f+3]===g)return f-this.zero;return-1},t.prototype.readAndCheckSignature=function(r){var d=r.charCodeAt(0),u=r.charCodeAt(1),b=r.charCodeAt(2),g=r.charCodeAt(3),f=this.readData(4);return d===f[0]&&u===f[1]&&b===f[2]&&g===f[3]},t.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},s.exports=t},{"../utils":32,"./DataReader":18}],18:[function(n,s,i){var e=n("../utils");function t(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}t.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var d,u=0;for(this.checkOffset(r),d=this.index+r-1;d>=this.index;d--)u=(u<<8)+this.byteAt(d);return this.index+=r,u},readString:function(r){return e.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},s.exports=t},{"../utils":32}],19:[function(n,s,i){var e=n("./Uint8ArrayReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},s.exports=t},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,s,i){var e=n("./DataReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},t.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},t.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},t.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},s.exports=t},{"../utils":32,"./DataReader":18}],21:[function(n,s,i){var e=n("./ArrayReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},s.exports=t},{"../utils":32,"./ArrayReader":17}],22:[function(n,s,i){var e=n("../utils"),t=n("../support"),r=n("./ArrayReader"),d=n("./StringReader"),u=n("./NodeBufferReader"),b=n("./Uint8ArrayReader");s.exports=function(g){var f=e.getTypeOf(g);return e.checkSupport(f),f!=="string"||t.uint8array?f==="nodebuffer"?new u(g):t.uint8array?new b(e.transformTo("uint8array",g)):new r(e.transformTo("array",g)):new d(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,s,i){var e=n("./GenericWorker"),t=n("../utils");function r(d){e.call(this,"ConvertWorker to "+d),this.destType=d}t.inherits(r,e),r.prototype.processChunk=function(d){this.push({data:t.transformTo(this.destType,d.data),meta:d.meta})},s.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(n,s,i){var e=n("./GenericWorker"),t=n("../crc32");function r(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(r,e),r.prototype.processChunk=function(d){this.streamInfo.crc32=t(d.data,this.streamInfo.crc32||0),this.push(d)},s.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,s,i){var e=n("../utils"),t=n("./GenericWorker");function r(d){t.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}e.inherits(r,t),r.prototype.processChunk=function(d){if(d){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+d.data.length}t.prototype.processChunk.call(this,d)},s.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(n,s,i){var e=n("../utils"),t=n("./GenericWorker");function r(d){t.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(b){u.dataIsReady=!0,u.data=b,u.max=b&&b.length||0,u.type=e.getTypeOf(b),u.isPaused||u._tickAndRepeat()},function(b){u.error(b)})}e.inherits(r,t),r.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,u);break;case"uint8array":d=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":d=this.data.slice(this.index,u)}return this.index=u,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(n,s,i){function e(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}e.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,r){return this._listeners[t].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,r){if(this._listeners[t])for(var d=0;d<this._listeners[t].length;d++)this._listeners[t][d].call(this,r)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var r=this;return t.on("data",function(d){r.processChunk(d)}),t.on("end",function(){r.end()}),t.on("error",function(d){r.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,r){return this.extraStreamInfo[t]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},s.exports=e},{}],29:[function(n,s,i){var e=n("../utils"),t=n("./ConvertWorker"),r=n("./GenericWorker"),d=n("../base64"),u=n("../support"),b=n("../external"),g=null;if(u.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch(_){}function f(_,p){return new b.Promise(function(m,y){var x=[],C=_._internalType,j=_._outputType,A=_._mimeType;_.on("data",function(I,R){x.push(I),p&&p(R)}).on("error",function(I){x=[],y(I)}).on("end",function(){try{var I=function(R,M,z){switch(R){case"blob":return e.newBlob(e.transformTo("arraybuffer",M),z);case"base64":return d.encode(M);default:return e.transformTo(R,M)}}(j,function(R,M){var z,L=0,V=null,k=0;for(z=0;z<M.length;z++)k+=M[z].length;switch(R){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(V=new Uint8Array(k),z=0;z<M.length;z++)V.set(M[z],L),L+=M[z].length;return V;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+R+"'")}}(C,x),A);m(I)}catch(R){y(R)}x=[]}).resume()})}function l(_,p,m){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=m,e.checkSupport(y),this._worker=_.pipe(new t(y)),_.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}l.prototype={accumulate:function(_){return f(this,_)},on:function(_,p){var m=this;return _==="data"?this._worker.on(_,function(y){p.call(m,y.data,y.meta)}):this._worker.on(_,function(){e.delay(p,arguments,m)}),this},resume:function(){return e.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(e.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},_)}},s.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var e=new ArrayBuffer(0);try{i.blob=new Blob([e],{type:"application/zip"}).size===0}catch(r){try{var t=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);t.append(e),i.blob=t.getBlob("application/zip").size===0}catch(d){i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch(r){i.nodestream=!1}},{"readable-stream":16}],31:[function(n,s,i){for(var e=n("./utils"),t=n("./support"),r=n("./nodejsUtils"),d=n("./stream/GenericWorker"),u=new Array(256),b=0;b<256;b++)u[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;u[254]=u[254]=1;function g(){d.call(this,"utf-8 decode"),this.leftOver=null}function f(){d.call(this,"utf-8 encode")}i.utf8encode=function(l){return t.nodebuffer?r.newBufferFrom(l,"utf-8"):function(_){var p,m,y,x,C,j=_.length,A=0;for(x=0;x<j;x++)(64512&(m=_.charCodeAt(x)))==55296&&x+1<j&&(64512&(y=_.charCodeAt(x+1)))==56320&&(m=65536+(m-55296<<10)+(y-56320),x++),A+=m<128?1:m<2048?2:m<65536?3:4;for(p=t.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(m=_.charCodeAt(x)))==55296&&x+1<j&&(64512&(y=_.charCodeAt(x+1)))==56320&&(m=65536+(m-55296<<10)+(y-56320),x++),m<128?p[C++]=m:(m<2048?p[C++]=192|m>>>6:(m<65536?p[C++]=224|m>>>12:(p[C++]=240|m>>>18,p[C++]=128|m>>>12&63),p[C++]=128|m>>>6&63),p[C++]=128|63&m);return p}(l)},i.utf8decode=function(l){return t.nodebuffer?e.transformTo("nodebuffer",l).toString("utf-8"):function(_){var p,m,y,x,C=_.length,j=new Array(2*C);for(p=m=0;p<C;)if((y=_[p++])<128)j[m++]=y;else if(4<(x=u[y]))j[m++]=65533,p+=x-1;else{for(y&=x===2?31:x===3?15:7;1<x&&p<C;)y=y<<6|63&_[p++],x--;1<x?j[m++]=65533:y<65536?j[m++]=y:(y-=65536,j[m++]=55296|y>>10&1023,j[m++]=56320|1023&y)}return j.length!==m&&(j.subarray?j=j.subarray(0,m):j.length=m),e.applyFromCharCode(j)}(l=e.transformTo(t.uint8array?"uint8array":"array",l))},e.inherits(g,d),g.prototype.processChunk=function(l){var _=e.transformTo(t.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(t.uint8array){var p=_;(_=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),_.set(p,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var m=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+u[x[j]]>C?j:C}(_),y=_;m!==_.length&&(t.uint8array?(y=_.subarray(0,m),this.leftOver=_.subarray(m,_.length)):(y=_.slice(0,m),this.leftOver=_.slice(m,_.length))),this.push({data:i.utf8decode(y),meta:l.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,e.inherits(f,d),f.prototype.processChunk=function(l){this.push({data:i.utf8encode(l.data),meta:l.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,s,i){var e=n("./support"),t=n("./base64"),r=n("./nodejsUtils"),d=n("./external");function u(p){return p}function b(p,m){for(var y=0;y<p.length;++y)m[y]=255&p.charCodeAt(y);return m}n("setimmediate"),i.newBlob=function(p,m){i.checkSupport("blob");try{return new Blob([p],{type:m})}catch(x){try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(m)}catch(C){throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(p,m,y){var x=[],C=0,j=p.length;if(j<=y)return String.fromCharCode.apply(null,p);for(;C<j;)m==="array"||m==="nodebuffer"?x.push(String.fromCharCode.apply(null,p.slice(C,Math.min(C+y,j)))):x.push(String.fromCharCode.apply(null,p.subarray(C,Math.min(C+y,j)))),C+=y;return x.join("")},stringifyByChar:function(p){for(var m="",y=0;y<p.length;y++)m+=String.fromCharCode(p[y]);return m},applyCanBeUsed:{uint8array:function(){try{return e.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(p){return!1}}(),nodebuffer:function(){try{return e.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch(p){return!1}}()}};function f(p){var m=65536,y=i.getTypeOf(p),x=!0;if(y==="uint8array"?x=g.applyCanBeUsed.uint8array:y==="nodebuffer"&&(x=g.applyCanBeUsed.nodebuffer),x)for(;1<m;)try{return g.stringifyByChunk(p,y,m)}catch(C){m=Math.floor(m/2)}return g.stringifyByChar(p)}function l(p,m){for(var y=0;y<p.length;y++)m[y]=p[y];return m}i.applyFromCharCode=f;var _={};_.string={string:u,array:function(p){return b(p,new Array(p.length))},arraybuffer:function(p){return _.string.uint8array(p).buffer},uint8array:function(p){return b(p,new Uint8Array(p.length))},nodebuffer:function(p){return b(p,r.allocBuffer(p.length))}},_.array={string:f,array:u,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return r.newBufferFrom(p)}},_.arraybuffer={string:function(p){return f(new Uint8Array(p))},array:function(p){return l(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:u,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return r.newBufferFrom(new Uint8Array(p))}},_.uint8array={string:f,array:function(p){return l(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:u,nodebuffer:function(p){return r.newBufferFrom(p)}},_.nodebuffer={string:f,array:function(p){return l(p,new Array(p.length))},arraybuffer:function(p){return _.nodebuffer.uint8array(p).buffer},uint8array:function(p){return l(p,new Uint8Array(p.length))},nodebuffer:u},i.transformTo=function(p,m){if(m=m||"",!p)return m;i.checkSupport(p);var y=i.getTypeOf(m);return _[y][p](m)},i.resolve=function(p){for(var m=p.split("/"),y=[],x=0;x<m.length;x++){var C=m[x];C==="."||C===""&&x!==0&&x!==m.length-1||(C===".."?y.pop():y.push(C))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":e.nodebuffer&&r.isBuffer(p)?"nodebuffer":e.uint8array&&p instanceof Uint8Array?"uint8array":e.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!e[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var m,y,x="";for(y=0;y<(p||"").length;y++)x+="\\x"+((m=p.charCodeAt(y))<16?"0":"")+m.toString(16).toUpperCase();return x},i.delay=function(p,m,y){setImmediate(function(){p.apply(y||null,m||[])})},i.inherits=function(p,m){function y(){}y.prototype=m.prototype,p.prototype=new y},i.extend=function(){var p,m,y={};for(p=0;p<arguments.length;p++)for(m in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],m)&&y[m]===void 0&&(y[m]=arguments[p][m]);return y},i.prepareContent=function(p,m,y,x,C){return d.Promise.resolve(m).then(function(j){return e.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new d.Promise(function(A,I){var R=new FileReader;R.onload=function(M){A(M.target.result)},R.onerror=function(M){I(M.target.error)},R.readAsArrayBuffer(j)}):j}).then(function(j){var A=i.getTypeOf(j);return A?(A==="arraybuffer"?j=i.transformTo("uint8array",j):A==="string"&&(C?j=t.decode(j):y&&x!==!0&&(j=function(I){return b(I,e.uint8array?new Uint8Array(I.length):new Array(I.length))}(j))),j):d.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,s,i){var e=n("./reader/readerFor"),t=n("./utils"),r=n("./signature"),d=n("./zipEntry"),u=n("./support");function b(g){this.files=[],this.loadOptions=g}b.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+t.pretty(f)+", expected "+t.pretty(g)+")")}},isSignature:function(g,f){var l=this.reader.index;this.reader.setIndex(g);var _=this.reader.readString(4)===f;return this.reader.setIndex(l),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",l=t.transformTo(f,g);this.zipComment=this.loadOptions.decodeFileName(l)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,f,l,_=this.zip64EndOfCentralSize-44;0<_;)g=this.reader.readInt(2),f=this.reader.readInt(4),l=this.reader.readData(f),this.zip64ExtensibleData[g]={id:g,length:f,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,f;for(g=0;g<this.files.length;g++)f=this.files[g],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(g=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var f=g;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var l=this.centralDirOffset+this.centralDirSize;this.zip64&&(l+=20,l+=12+this.zip64EndOfCentralSize);var _=f-l;if(0<_)this.isSignature(f,r.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(g){this.reader=e(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,s,i){var e=n("./reader/readerFor"),t=n("./utils"),r=n("./compressedObject"),d=n("./crc32"),u=n("./utf8"),b=n("./compressions"),g=n("./support");function f(l,_){this.options=l,this.loadOptions=_}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(l){var _,p;if(l.skip(22),this.fileNameLength=l.readInt(2),p=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=function(m){for(var y in b)if(Object.prototype.hasOwnProperty.call(b,y)&&b[y].magic===m)return b[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+t.pretty(this.compressionMethod)+" unknown (inner file : "+t.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,_,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var _=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(_),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),l==0&&(this.dosPermissions=63&this.externalFileAttributes),l==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var l=e(this.extraFields[1].value);this.uncompressedSize===t.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===t.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===t.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===t.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4))}},readExtraFields:function(l){var _,p,m,y=l.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});l.index+4<y;)_=l.readInt(2),p=l.readInt(2),m=l.readData(p),this.extraFields[_]={id:_,length:p,value:m};l.setIndex(y)},handleUTF8:function(){var l=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var p=t.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var y=t.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var _=e(l.value);return _.readInt(1)!==1||d(this.fileName)!==_.readInt(4)?null:u.utf8decode(_.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var _=e(l.value);return _.readInt(1)!==1||d(this.fileComment)!==_.readInt(4)?null:u.utf8decode(_.readData(l.length-5))}return null}},s.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,s,i){function e(_,p,m){this.name=_,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=p,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var t=n("./stream/StreamHelper"),r=n("./stream/DataWorker"),d=n("./utf8"),u=n("./compressedObject"),b=n("./stream/GenericWorker");e.prototype={internalStream:function(_){var p=null,m="string";try{if(!_)throw new Error("No output type specified.");var y=(m=_.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),p=this._decompressWorker();var x=!this._dataBinary;x&&!y&&(p=p.pipe(new d.Utf8EncodeWorker)),!x&&y&&(p=p.pipe(new d.Utf8DecodeWorker))}catch(C){(p=new b("error")).error(C)}return new t(p,m,"")},async:function(_,p){return this.internalStream(_).accumulate(p)},nodeStream:function(_,p){return this.internalStream(_||"nodebuffer").toNodejsStream(p)},_compressWorker:function(_,p){if(this._data instanceof u&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new d.Utf8EncodeWorker)),u.createWorkerFrom(m,_,p)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof b?this._data:new r(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<g.length;l++)e.prototype[g[l]]=f;s.exports=e},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,s,i){(function(e){var t,r,d=e.MutationObserver||e.WebKitMutationObserver;if(d){var u=0,b=new d(_),g=e.document.createTextNode("");b.observe(g,{characterData:!0}),t=function(){g.data=u=++u%2}}else if(e.setImmediate||e.MessageChannel===void 0)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var p=e.document.createElement("script");p.onreadystatechange=function(){_(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},e.document.documentElement.appendChild(p)}:function(){setTimeout(_,0)};else{var f=new e.MessageChannel;f.port1.onmessage=_,t=function(){f.port2.postMessage(0)}}var l=[];function _(){var p,m;r=!0;for(var y=l.length;y;){for(m=l,l=[],p=-1;++p<y;)m[p]();y=l.length}r=!1}s.exports=function(p){l.push(p)!==1||r||t()}}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,s,i){var e=n("immediate");function t(){}var r={},d=["REJECTED"],u=["FULFILLED"],b=["PENDING"];function g(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,y!==t&&p(this,y)}function f(y,x,C){this.promise=y,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function l(y,x,C){e(function(){var j;try{j=x(C)}catch(A){return r.reject(y,A)}j===y?r.reject(y,new TypeError("Cannot resolve promise with itself")):r.resolve(y,j)})}function _(y){var x=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof x=="function")return function(){x.apply(y,arguments)}}function p(y,x){var C=!1;function j(R){C||(C=!0,r.reject(y,R))}function A(R){C||(C=!0,r.resolve(y,R))}var I=m(function(){x(A,j)});I.status==="error"&&j(I.value)}function m(y,x){var C={};try{C.value=y(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(s.exports=g).prototype.finally=function(y){if(typeof y!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(y()).then(function(){return C})},function(C){return x.resolve(y()).then(function(){throw C})})},g.prototype.catch=function(y){return this.then(null,y)},g.prototype.then=function(y,x){if(typeof y!="function"&&this.state===u||typeof x!="function"&&this.state===d)return this;var C=new this.constructor(t);return this.state!==b?l(C,this.state===u?y:x,this.outcome):this.queue.push(new f(C,y,x)),C},f.prototype.callFulfilled=function(y){r.resolve(this.promise,y)},f.prototype.otherCallFulfilled=function(y){l(this.promise,this.onFulfilled,y)},f.prototype.callRejected=function(y){r.reject(this.promise,y)},f.prototype.otherCallRejected=function(y){l(this.promise,this.onRejected,y)},r.resolve=function(y,x){var C=m(_,x);if(C.status==="error")return r.reject(y,C.value);var j=C.value;if(j)p(y,j);else{y.state=u,y.outcome=x;for(var A=-1,I=y.queue.length;++A<I;)y.queue[A].callFulfilled(x)}return y},r.reject=function(y,x){y.state=d,y.outcome=x;for(var C=-1,j=y.queue.length;++C<j;)y.queue[C].callRejected(x);return y},g.resolve=function(y){return y instanceof this?y:r.resolve(new this(t),y)},g.reject=function(y){var x=new this(t);return r.reject(x,y)},g.all=function(y){var x=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=y.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),I=0,R=-1,M=new this(t);++R<C;)z(y[R],R);return M;function z(L,V){x.resolve(L).then(function(k){A[V]=k,++I!==C||j||(j=!0,r.resolve(M,A))},function(k){j||(j=!0,r.reject(M,k))})}},g.race=function(y){var x=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=y.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,I=new this(t);++A<C;)R=y[A],x.resolve(R).then(function(M){j||(j=!0,r.resolve(I,M))},function(M){j||(j=!0,r.reject(I,M))});var R;return I}},{immediate:36}],38:[function(n,s,i){var e={};(0,n("./lib/utils/common").assign)(e,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),s.exports=e},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,s,i){var e=n("./zlib/deflate"),t=n("./utils/common"),r=n("./utils/strings"),d=n("./zlib/messages"),u=n("./zlib/zstream"),b=Object.prototype.toString,g=0,f=-1,l=0,_=8;function p(y){if(!(this instanceof p))return new p(y);this.options=t.assign({level:f,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},y||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=e.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==g)throw new Error(d[C]);if(x.header&&e.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?r.string2buf(x.dictionary):b.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=e.deflateSetDictionary(this.strm,j))!==g)throw new Error(d[C]);this._dict_set=!0}}function m(y,x){var C=new p(x);if(C.push(y,!0),C.err)throw C.msg||d[C.err];return C.result}p.prototype.push=function(y,x){var C,j,A=this.strm,I=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof y=="string"?A.input=r.string2buf(y):b.call(y)==="[object ArrayBuffer]"?A.input=new Uint8Array(y):A.input=y,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new t.Buf8(I),A.next_out=0,A.avail_out=I),(C=e.deflate(A,j))!==1&&C!==g)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(t.shrinkBuf(A.output,A.next_out))):this.onData(t.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=e.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===g):j!==2||(this.onEnd(g),!(A.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=m,i.deflateRaw=function(y,x){return(x=x||{}).raw=!0,m(y,x)},i.gzip=function(y,x){return(x=x||{}).gzip=!0,m(y,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,s,i){var e=n("./zlib/inflate"),t=n("./utils/common"),r=n("./utils/strings"),d=n("./zlib/constants"),u=n("./zlib/messages"),b=n("./zlib/zstream"),g=n("./zlib/gzheader"),f=Object.prototype.toString;function l(p){if(!(this instanceof l))return new l(p);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},p||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||p&&p.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var y=e.inflateInit2(this.strm,m.windowBits);if(y!==d.Z_OK)throw new Error(u[y]);this.header=new g,e.inflateGetHeader(this.strm,this.header)}function _(p,m){var y=new l(m);if(y.push(p,!0),y.err)throw y.msg||u[y.err];return y.result}l.prototype.push=function(p,m){var y,x,C,j,A,I,R=this.strm,M=this.options.chunkSize,z=this.options.dictionary,L=!1;if(this.ended)return!1;x=m===~~m?m:m===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof p=="string"?R.input=r.binstring2buf(p):f.call(p)==="[object ArrayBuffer]"?R.input=new Uint8Array(p):R.input=p,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new t.Buf8(M),R.next_out=0,R.avail_out=M),(y=e.inflate(R,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&z&&(I=typeof z=="string"?r.string2buf(z):f.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,y=e.inflateSetDictionary(this.strm,I)),y===d.Z_BUF_ERROR&&L===!0&&(y=d.Z_OK,L=!1),y!==d.Z_STREAM_END&&y!==d.Z_OK)return this.onEnd(y),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&y!==d.Z_STREAM_END&&(R.avail_in!==0||x!==d.Z_FINISH&&x!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=r.utf8border(R.output,R.next_out),j=R.next_out-C,A=r.buf2string(R.output,C),R.next_out=j,R.avail_out=M-j,j&&t.arraySet(R.output,R.output,C,j,0),this.onData(A)):this.onData(t.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(L=!0)}while((0<R.avail_in||R.avail_out===0)&&y!==d.Z_STREAM_END);return y===d.Z_STREAM_END&&(x=d.Z_FINISH),x===d.Z_FINISH?(y=e.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===d.Z_OK):x!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(R.avail_out=0))},l.prototype.onData=function(p){this.chunks.push(p)},l.prototype.onEnd=function(p){p===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=l,i.inflate=_,i.inflateRaw=function(p,m){return(m=m||{}).raw=!0,_(p,m)},i.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,s,i){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(d){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var b=u.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var g in b)b.hasOwnProperty(g)&&(d[g]=b[g])}}return d},i.shrinkBuf=function(d,u){return d.length===u?d:d.subarray?d.subarray(0,u):(d.length=u,d)};var t={arraySet:function(d,u,b,g,f){if(u.subarray&&d.subarray)d.set(u.subarray(b,b+g),f);else for(var l=0;l<g;l++)d[f+l]=u[b+l]},flattenChunks:function(d){var u,b,g,f,l,_;for(u=g=0,b=d.length;u<b;u++)g+=d[u].length;for(_=new Uint8Array(g),u=f=0,b=d.length;u<b;u++)l=d[u],_.set(l,f),f+=l.length;return _}},r={arraySet:function(d,u,b,g,f){for(var l=0;l<g;l++)d[f+l]=u[b+l]},flattenChunks:function(d){return[].concat.apply([],d)}};i.setTyped=function(d){d?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,t)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(e)},{}],42:[function(n,s,i){var e=n("./common"),t=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(g){t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(g){r=!1}for(var d=new e.Buf8(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function b(g,f){if(f<65537&&(g.subarray&&r||!g.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(g,f));for(var l="",_=0;_<f;_++)l+=String.fromCharCode(g[_]);return l}d[254]=d[254]=1,i.string2buf=function(g){var f,l,_,p,m,y=g.length,x=0;for(p=0;p<y;p++)(64512&(l=g.charCodeAt(p)))==55296&&p+1<y&&(64512&(_=g.charCodeAt(p+1)))==56320&&(l=65536+(l-55296<<10)+(_-56320),p++),x+=l<128?1:l<2048?2:l<65536?3:4;for(f=new e.Buf8(x),p=m=0;m<x;p++)(64512&(l=g.charCodeAt(p)))==55296&&p+1<y&&(64512&(_=g.charCodeAt(p+1)))==56320&&(l=65536+(l-55296<<10)+(_-56320),p++),l<128?f[m++]=l:(l<2048?f[m++]=192|l>>>6:(l<65536?f[m++]=224|l>>>12:(f[m++]=240|l>>>18,f[m++]=128|l>>>12&63),f[m++]=128|l>>>6&63),f[m++]=128|63&l);return f},i.buf2binstring=function(g){return b(g,g.length)},i.binstring2buf=function(g){for(var f=new e.Buf8(g.length),l=0,_=f.length;l<_;l++)f[l]=g.charCodeAt(l);return f},i.buf2string=function(g,f){var l,_,p,m,y=f||g.length,x=new Array(2*y);for(l=_=0;l<y;)if((p=g[l++])<128)x[_++]=p;else if(4<(m=d[p]))x[_++]=65533,l+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&l<y;)p=p<<6|63&g[l++],m--;1<m?x[_++]=65533:p<65536?x[_++]=p:(p-=65536,x[_++]=55296|p>>10&1023,x[_++]=56320|1023&p)}return b(x,_)},i.utf8border=function(g,f){var l;for((f=f||g.length)>g.length&&(f=g.length),l=f-1;0<=l&&(192&g[l])==128;)l--;return l<0||l===0?f:l+d[g[l]]>f?l:f}},{"./common":41}],43:[function(n,s,i){s.exports=function(e,t,r,d){for(var u=65535&e|0,b=e>>>16&65535|0,g=0;r!==0;){for(r-=g=2e3<r?2e3:r;b=b+(u=u+t[d++]|0)|0,--g;);u%=65521,b%=65521}return u|b<<16|0}},{}],44:[function(n,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,s,i){var e=function(){for(var t,r=[],d=0;d<256;d++){t=d;for(var u=0;u<8;u++)t=1&t?3988292384^t>>>1:t>>>1;r[d]=t}return r}();s.exports=function(t,r,d,u){var b=e,g=u+d;t^=-1;for(var f=u;f<g;f++)t=t>>>8^b[255&(t^r[f])];return-1^t}},{}],46:[function(n,s,i){var e,t=n("../utils/common"),r=n("./trees"),d=n("./adler32"),u=n("./crc32"),b=n("./messages"),g=0,f=4,l=0,_=-2,p=-1,m=4,y=2,x=8,C=9,j=286,A=30,I=19,R=2*j+1,M=15,z=3,L=258,V=L+z+1,k=42,O=113,h=1,D=2,ne=3,Z=4;function se(o,F){return o.msg=b[F],F}function H(o){return(o<<1)-(4<o?9:0)}function re(o){for(var F=o.length;0<=--F;)o[F]=0}function B(o){var F=o.state,N=F.pending;N>o.avail_out&&(N=o.avail_out),N!==0&&(t.arraySet(o.output,F.pending_buf,F.pending_out,N,o.next_out),o.next_out+=N,F.pending_out+=N,o.total_out+=N,o.avail_out-=N,F.pending-=N,F.pending===0&&(F.pending_out=0))}function T(o,F){r._tr_flush_block(o,0<=o.block_start?o.block_start:-1,o.strstart-o.block_start,F),o.block_start=o.strstart,B(o.strm)}function te(o,F){o.pending_buf[o.pending++]=F}function q(o,F){o.pending_buf[o.pending++]=F>>>8&255,o.pending_buf[o.pending++]=255&F}function Y(o,F){var N,w,S=o.max_chain_length,E=o.strstart,U=o.prev_length,W=o.nice_match,P=o.strstart>o.w_size-V?o.strstart-(o.w_size-V):0,G=o.window,K=o.w_mask,$=o.prev,ee=o.strstart+L,he=G[E+U-1],ae=G[E+U];o.prev_length>=o.good_match&&(S>>=2),W>o.lookahead&&(W=o.lookahead);do if(G[(N=F)+U]===ae&&G[N+U-1]===he&&G[N]===G[E]&&G[++N]===G[E+1]){E+=2,N++;do;while(G[++E]===G[++N]&&G[++E]===G[++N]&&G[++E]===G[++N]&&G[++E]===G[++N]&&G[++E]===G[++N]&&G[++E]===G[++N]&&G[++E]===G[++N]&&G[++E]===G[++N]&&E<ee);if(w=L-(ee-E),E=ee-L,U<w){if(o.match_start=F,W<=(U=w))break;he=G[E+U-1],ae=G[E+U]}}while((F=$[F&K])>P&&--S!=0);return U<=o.lookahead?U:o.lookahead}function fe(o){var F,N,w,S,E,U,W,P,G,K,$=o.w_size;do{if(S=o.window_size-o.lookahead-o.strstart,o.strstart>=$+($-V)){for(t.arraySet(o.window,o.window,$,$,0),o.match_start-=$,o.strstart-=$,o.block_start-=$,F=N=o.hash_size;w=o.head[--F],o.head[F]=$<=w?w-$:0,--N;);for(F=N=$;w=o.prev[--F],o.prev[F]=$<=w?w-$:0,--N;);S+=$}if(o.strm.avail_in===0)break;if(U=o.strm,W=o.window,P=o.strstart+o.lookahead,G=S,K=void 0,K=U.avail_in,G<K&&(K=G),N=K===0?0:(U.avail_in-=K,t.arraySet(W,U.input,U.next_in,K,P),U.state.wrap===1?U.adler=d(U.adler,W,K,P):U.state.wrap===2&&(U.adler=u(U.adler,W,K,P)),U.next_in+=K,U.total_in+=K,K),o.lookahead+=N,o.lookahead+o.insert>=z)for(E=o.strstart-o.insert,o.ins_h=o.window[E],o.ins_h=(o.ins_h<<o.hash_shift^o.window[E+1])&o.hash_mask;o.insert&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[E+z-1])&o.hash_mask,o.prev[E&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=E,E++,o.insert--,!(o.lookahead+o.insert<z)););}while(o.lookahead<V&&o.strm.avail_in!==0)}function ye(o,F){for(var N,w;;){if(o.lookahead<V){if(fe(o),o.lookahead<V&&F===g)return h;if(o.lookahead===0)break}if(N=0,o.lookahead>=z&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+z-1])&o.hash_mask,N=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),N!==0&&o.strstart-N<=o.w_size-V&&(o.match_length=Y(o,N)),o.match_length>=z)if(w=r._tr_tally(o,o.strstart-o.match_start,o.match_length-z),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=z){for(o.match_length--;o.strstart++,o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+z-1])&o.hash_mask,N=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart,--o.match_length!=0;);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+1])&o.hash_mask;else w=r._tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(w&&(T(o,!1),o.strm.avail_out===0))return h}return o.insert=o.strstart<z-1?o.strstart:z-1,F===f?(T(o,!0),o.strm.avail_out===0?ne:Z):o.last_lit&&(T(o,!1),o.strm.avail_out===0)?h:D}function ie(o,F){for(var N,w,S;;){if(o.lookahead<V){if(fe(o),o.lookahead<V&&F===g)return h;if(o.lookahead===0)break}if(N=0,o.lookahead>=z&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+z-1])&o.hash_mask,N=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=z-1,N!==0&&o.prev_length<o.max_lazy_match&&o.strstart-N<=o.w_size-V&&(o.match_length=Y(o,N),o.match_length<=5&&(o.strategy===1||o.match_length===z&&4096<o.strstart-o.match_start)&&(o.match_length=z-1)),o.prev_length>=z&&o.match_length<=o.prev_length){for(S=o.strstart+o.lookahead-z,w=r._tr_tally(o,o.strstart-1-o.prev_match,o.prev_length-z),o.lookahead-=o.prev_length-1,o.prev_length-=2;++o.strstart<=S&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+z-1])&o.hash_mask,N=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),--o.prev_length!=0;);if(o.match_available=0,o.match_length=z-1,o.strstart++,w&&(T(o,!1),o.strm.avail_out===0))return h}else if(o.match_available){if((w=r._tr_tally(o,0,o.window[o.strstart-1]))&&T(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return h}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(w=r._tr_tally(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<z-1?o.strstart:z-1,F===f?(T(o,!0),o.strm.avail_out===0?ne:Z):o.last_lit&&(T(o,!1),o.strm.avail_out===0)?h:D}function ce(o,F,N,w,S){this.good_length=o,this.max_lazy=F,this.nice_length=N,this.max_chain=w,this.func=S}function _e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*R),this.dyn_dtree=new t.Buf16(2*(2*A+1)),this.bl_tree=new t.Buf16(2*(2*I+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(M+1),this.heap=new t.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(o){var F;return o&&o.state?(o.total_in=o.total_out=0,o.data_type=y,(F=o.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?k:O,o.adler=F.wrap===2?0:1,F.last_flush=g,r._tr_init(F),l):se(o,_)}function Oe(o){var F=pe(o);return F===l&&function(N){N.window_size=2*N.w_size,re(N.head),N.max_lazy_match=e[N.level].max_lazy,N.good_match=e[N.level].good_length,N.nice_match=e[N.level].nice_length,N.max_chain_length=e[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=z-1,N.match_available=0,N.ins_h=0}(o.state),F}function je(o,F,N,w,S,E){if(!o)return _;var U=1;if(F===p&&(F=6),w<0?(U=0,w=-w):15<w&&(U=2,w-=16),S<1||C<S||N!==x||w<8||15<w||F<0||9<F||E<0||m<E)return se(o,_);w===8&&(w=9);var W=new _e;return(o.state=W).strm=o,W.wrap=U,W.gzhead=null,W.w_bits=w,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+z-1)/z),W.window=new t.Buf8(2*W.w_size),W.head=new t.Buf16(W.hash_size),W.prev=new t.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new t.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=F,W.strategy=E,W.method=N,Oe(o)}e=[new ce(0,0,0,0,function(o,F){var N=65535;for(N>o.pending_buf_size-5&&(N=o.pending_buf_size-5);;){if(o.lookahead<=1){if(fe(o),o.lookahead===0&&F===g)return h;if(o.lookahead===0)break}o.strstart+=o.lookahead,o.lookahead=0;var w=o.block_start+N;if((o.strstart===0||o.strstart>=w)&&(o.lookahead=o.strstart-w,o.strstart=w,T(o,!1),o.strm.avail_out===0)||o.strstart-o.block_start>=o.w_size-V&&(T(o,!1),o.strm.avail_out===0))return h}return o.insert=0,F===f?(T(o,!0),o.strm.avail_out===0?ne:Z):(o.strstart>o.block_start&&(T(o,!1),o.strm.avail_out),h)}),new ce(4,4,8,4,ye),new ce(4,5,16,8,ye),new ce(4,6,32,32,ye),new ce(4,4,16,16,ie),new ce(8,16,32,32,ie),new ce(8,16,128,128,ie),new ce(8,32,128,256,ie),new ce(32,128,258,1024,ie),new ce(32,258,258,4096,ie)],i.deflateInit=function(o,F){return je(o,F,x,15,8,0)},i.deflateInit2=je,i.deflateReset=Oe,i.deflateResetKeep=pe,i.deflateSetHeader=function(o,F){return o&&o.state?o.state.wrap!==2?_:(o.state.gzhead=F,l):_},i.deflate=function(o,F){var N,w,S,E;if(!o||!o.state||5<F||F<0)return o?se(o,_):_;if(w=o.state,!o.output||!o.input&&o.avail_in!==0||w.status===666&&F!==f)return se(o,o.avail_out===0?-5:_);if(w.strm=o,N=w.last_flush,w.last_flush=F,w.status===k)if(w.wrap===2)o.adler=0,te(w,31),te(w,139),te(w,8),w.gzhead?(te(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),te(w,255&w.gzhead.time),te(w,w.gzhead.time>>8&255),te(w,w.gzhead.time>>16&255),te(w,w.gzhead.time>>24&255),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(te(w,255&w.gzhead.extra.length),te(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(o.adler=u(o.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(te(w,0),te(w,0),te(w,0),te(w,0),te(w,0),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,3),w.status=O);else{var U=x+(w.w_bits-8<<4)<<8;U|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(U|=32),U+=31-U%31,w.status=O,q(w,U),w.strstart!==0&&(q(w,o.adler>>>16),q(w,65535&o.adler)),o.adler=1}if(w.status===69)if(w.gzhead.extra){for(S=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),B(o),S=w.pending,w.pending!==w.pending_buf_size));)te(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),B(o),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),B(o),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(o.adler=u(o.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&B(o),w.pending+2<=w.pending_buf_size&&(te(w,255&o.adler),te(w,o.adler>>8&255),o.adler=0,w.status=O)):w.status=O),w.pending!==0){if(B(o),o.avail_out===0)return w.last_flush=-1,l}else if(o.avail_in===0&&H(F)<=H(N)&&F!==f)return se(o,-5);if(w.status===666&&o.avail_in!==0)return se(o,-5);if(o.avail_in!==0||w.lookahead!==0||F!==g&&w.status!==666){var W=w.strategy===2?function(P,G){for(var K;;){if(P.lookahead===0&&(fe(P),P.lookahead===0)){if(G===g)return h;break}if(P.match_length=0,K=r._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,K&&(T(P,!1),P.strm.avail_out===0))return h}return P.insert=0,G===f?(T(P,!0),P.strm.avail_out===0?ne:Z):P.last_lit&&(T(P,!1),P.strm.avail_out===0)?h:D}(w,F):w.strategy===3?function(P,G){for(var K,$,ee,he,ae=P.window;;){if(P.lookahead<=L){if(fe(P),P.lookahead<=L&&G===g)return h;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=z&&0<P.strstart&&($=ae[ee=P.strstart-1])===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]){he=P.strstart+L;do;while($===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&ee<he);P.match_length=L-(he-ee),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=z?(K=r._tr_tally(P,1,P.match_length-z),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(K=r._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),K&&(T(P,!1),P.strm.avail_out===0))return h}return P.insert=0,G===f?(T(P,!0),P.strm.avail_out===0?ne:Z):P.last_lit&&(T(P,!1),P.strm.avail_out===0)?h:D}(w,F):e[w.level].func(w,F);if(W!==ne&&W!==Z||(w.status=666),W===h||W===ne)return o.avail_out===0&&(w.last_flush=-1),l;if(W===D&&(F===1?r._tr_align(w):F!==5&&(r._tr_stored_block(w,0,0,!1),F===3&&(re(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),B(o),o.avail_out===0))return w.last_flush=-1,l}return F!==f?l:w.wrap<=0?1:(w.wrap===2?(te(w,255&o.adler),te(w,o.adler>>8&255),te(w,o.adler>>16&255),te(w,o.adler>>24&255),te(w,255&o.total_in),te(w,o.total_in>>8&255),te(w,o.total_in>>16&255),te(w,o.total_in>>24&255)):(q(w,o.adler>>>16),q(w,65535&o.adler)),B(o),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?l:1)},i.deflateEnd=function(o){var F;return o&&o.state?(F=o.state.status)!==k&&F!==69&&F!==73&&F!==91&&F!==103&&F!==O&&F!==666?se(o,_):(o.state=null,F===O?se(o,-3):l):_},i.deflateSetDictionary=function(o,F){var N,w,S,E,U,W,P,G,K=F.length;if(!o||!o.state||(E=(N=o.state).wrap)===2||E===1&&N.status!==k||N.lookahead)return _;for(E===1&&(o.adler=d(o.adler,F,K,0)),N.wrap=0,K>=N.w_size&&(E===0&&(re(N.head),N.strstart=0,N.block_start=0,N.insert=0),G=new t.Buf8(N.w_size),t.arraySet(G,F,K-N.w_size,N.w_size,0),F=G,K=N.w_size),U=o.avail_in,W=o.next_in,P=o.input,o.avail_in=K,o.next_in=0,o.input=F,fe(N);N.lookahead>=z;){for(w=N.strstart,S=N.lookahead-(z-1);N.ins_h=(N.ins_h<<N.hash_shift^N.window[w+z-1])&N.hash_mask,N.prev[w&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=w,w++,--S;);N.strstart=w,N.lookahead=z-1,fe(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=z-1,N.match_available=0,o.next_in=W,o.input=P,o.avail_in=U,N.wrap=E,l},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,s,i){s.exports=function(e,t){var r,d,u,b,g,f,l,_,p,m,y,x,C,j,A,I,R,M,z,L,V,k,O,h,D;r=e.state,d=e.next_in,h=e.input,u=d+(e.avail_in-5),b=e.next_out,D=e.output,g=b-(t-e.avail_out),f=b+(e.avail_out-257),l=r.dmax,_=r.wsize,p=r.whave,m=r.wnext,y=r.window,x=r.hold,C=r.bits,j=r.lencode,A=r.distcode,I=(1<<r.lenbits)-1,R=(1<<r.distbits)-1;e:do{C<15&&(x+=h[d++]<<C,C+=8,x+=h[d++]<<C,C+=8),M=j[x&I];t:for(;;){if(x>>>=z=M>>>24,C-=z,(z=M>>>16&255)===0)D[b++]=65535&M;else{if(!(16&z)){if((64&z)==0){M=j[(65535&M)+(x&(1<<z)-1)];continue t}if(32&z){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}L=65535&M,(z&=15)&&(C<z&&(x+=h[d++]<<C,C+=8),L+=x&(1<<z)-1,x>>>=z,C-=z),C<15&&(x+=h[d++]<<C,C+=8,x+=h[d++]<<C,C+=8),M=A[x&R];n:for(;;){if(x>>>=z=M>>>24,C-=z,!(16&(z=M>>>16&255))){if((64&z)==0){M=A[(65535&M)+(x&(1<<z)-1)];continue n}e.msg="invalid distance code",r.mode=30;break e}if(V=65535&M,C<(z&=15)&&(x+=h[d++]<<C,(C+=8)<z&&(x+=h[d++]<<C,C+=8)),l<(V+=x&(1<<z)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=z,C-=z,(z=b-g)<V){if(p<(z=V-z)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(O=y,(k=0)===m){if(k+=_-z,z<L){for(L-=z;D[b++]=y[k++],--z;);k=b-V,O=D}}else if(m<z){if(k+=_+m-z,(z-=m)<L){for(L-=z;D[b++]=y[k++],--z;);if(k=0,m<L){for(L-=z=m;D[b++]=y[k++],--z;);k=b-V,O=D}}}else if(k+=m-z,z<L){for(L-=z;D[b++]=y[k++],--z;);k=b-V,O=D}for(;2<L;)D[b++]=O[k++],D[b++]=O[k++],D[b++]=O[k++],L-=3;L&&(D[b++]=O[k++],1<L&&(D[b++]=O[k++]))}else{for(k=b-V;D[b++]=D[k++],D[b++]=D[k++],D[b++]=D[k++],2<(L-=3););L&&(D[b++]=D[k++],1<L&&(D[b++]=D[k++]))}break}}break}}while(d<u&&b<f);d-=L=C>>3,x&=(1<<(C-=L<<3))-1,e.next_in=d,e.next_out=b,e.avail_in=d<u?u-d+5:5-(d-u),e.avail_out=b<f?f-b+257:257-(b-f),r.hold=x,r.bits=C}},{}],49:[function(n,s,i){var e=n("../utils/common"),t=n("./adler32"),r=n("./crc32"),d=n("./inffast"),u=n("./inftrees"),b=1,g=2,f=0,l=-2,_=1,p=852,m=592;function y(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(k){var O;return k&&k.state?(O=k.state,k.total_in=k.total_out=O.total=0,k.msg="",O.wrap&&(k.adler=1&O.wrap),O.mode=_,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new e.Buf32(p),O.distcode=O.distdyn=new e.Buf32(m),O.sane=1,O.back=-1,f):l}function j(k){var O;return k&&k.state?((O=k.state).wsize=0,O.whave=0,O.wnext=0,C(k)):l}function A(k,O){var h,D;return k&&k.state?(D=k.state,O<0?(h=0,O=-O):(h=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?l:(D.window!==null&&D.wbits!==O&&(D.window=null),D.wrap=h,D.wbits=O,j(k))):l}function I(k,O){var h,D;return k?(D=new x,(k.state=D).window=null,(h=A(k,O))!==f&&(k.state=null),h):l}var R,M,z=!0;function L(k){if(z){var O;for(R=new e.Buf32(512),M=new e.Buf32(32),O=0;O<144;)k.lens[O++]=8;for(;O<256;)k.lens[O++]=9;for(;O<280;)k.lens[O++]=7;for(;O<288;)k.lens[O++]=8;for(u(b,k.lens,0,288,R,0,k.work,{bits:9}),O=0;O<32;)k.lens[O++]=5;u(g,k.lens,0,32,M,0,k.work,{bits:5}),z=!1}k.lencode=R,k.lenbits=9,k.distcode=M,k.distbits=5}function V(k,O,h,D){var ne,Z=k.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new e.Buf8(Z.wsize)),D>=Z.wsize?(e.arraySet(Z.window,O,h-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(D<(ne=Z.wsize-Z.wnext)&&(ne=D),e.arraySet(Z.window,O,h-D,ne,Z.wnext),(D-=ne)?(e.arraySet(Z.window,O,h-D,D,0),Z.wnext=D,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}i.inflateReset=j,i.inflateReset2=A,i.inflateResetKeep=C,i.inflateInit=function(k){return I(k,15)},i.inflateInit2=I,i.inflate=function(k,O){var h,D,ne,Z,se,H,re,B,T,te,q,Y,fe,ye,ie,ce,_e,pe,Oe,je,o,F,N,w,S=0,E=new e.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return l;(h=k.state).mode===12&&(h.mode=13),se=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,D=k.input,H=k.avail_in,B=h.hold,T=h.bits,te=H,q=re,F=f;e:for(;;)switch(h.mode){case _:if(h.wrap===0){h.mode=13;break}for(;T<16;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(2&h.wrap&&B===35615){E[h.check=0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0),T=B=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&B)<<8)+(B>>8))%31){k.msg="incorrect header check",h.mode=30;break}if((15&B)!=8){k.msg="unknown compression method",h.mode=30;break}if(T-=4,o=8+(15&(B>>>=4)),h.wbits===0)h.wbits=o;else if(o>h.wbits){k.msg="invalid window size",h.mode=30;break}h.dmax=1<<o,k.adler=h.check=1,h.mode=512&B?10:12,T=B=0;break;case 2:for(;T<16;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(h.flags=B,(255&h.flags)!=8){k.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){k.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=B>>8&1),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0)),T=B=0,h.mode=3;case 3:for(;T<32;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}h.head&&(h.head.time=B),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,E[2]=B>>>16&255,E[3]=B>>>24&255,h.check=r(h.check,E,4,0)),T=B=0,h.mode=4;case 4:for(;T<16;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}h.head&&(h.head.xflags=255&B,h.head.os=B>>8),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0)),T=B=0,h.mode=5;case 5:if(1024&h.flags){for(;T<16;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}h.length=B,h.head&&(h.head.extra_len=B),512&h.flags&&(E[0]=255&B,E[1]=B>>>8&255,h.check=r(h.check,E,2,0)),T=B=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(H<(Y=h.length)&&(Y=H),Y&&(h.head&&(o=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),e.arraySet(h.head.extra,D,Z,Y,o)),512&h.flags&&(h.check=r(h.check,D,Y,Z)),H-=Y,Z+=Y,h.length-=Y),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(H===0)break e;for(Y=0;o=D[Z+Y++],h.head&&o&&h.length<65536&&(h.head.name+=String.fromCharCode(o)),o&&Y<H;);if(512&h.flags&&(h.check=r(h.check,D,Y,Z)),H-=Y,Z+=Y,o)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(H===0)break e;for(Y=0;o=D[Z+Y++],h.head&&o&&h.length<65536&&(h.head.comment+=String.fromCharCode(o)),o&&Y<H;);if(512&h.flags&&(h.check=r(h.check,D,Y,Z)),H-=Y,Z+=Y,o)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;T<16;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(B!==(65535&h.check)){k.msg="header crc mismatch",h.mode=30;break}T=B=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),k.adler=h.check=0,h.mode=12;break;case 10:for(;T<32;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}k.adler=h.check=y(B),T=B=0,h.mode=11;case 11:if(h.havedict===0)return k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=H,h.hold=B,h.bits=T,2;k.adler=h.check=1,h.mode=12;case 12:if(O===5||O===6)break e;case 13:if(h.last){B>>>=7&T,T-=7&T,h.mode=27;break}for(;T<3;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}switch(h.last=1&B,T-=1,3&(B>>>=1)){case 0:h.mode=14;break;case 1:if(L(h),h.mode=20,O!==6)break;B>>>=2,T-=2;break e;case 2:h.mode=17;break;case 3:k.msg="invalid block type",h.mode=30}B>>>=2,T-=2;break;case 14:for(B>>>=7&T,T-=7&T;T<32;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if((65535&B)!=(B>>>16^65535)){k.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&B,T=B=0,h.mode=15,O===6)break e;case 15:h.mode=16;case 16:if(Y=h.length){if(H<Y&&(Y=H),re<Y&&(Y=re),Y===0)break e;e.arraySet(ne,D,Z,Y,se),H-=Y,Z+=Y,re-=Y,se+=Y,h.length-=Y;break}h.mode=12;break;case 17:for(;T<14;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(h.nlen=257+(31&B),B>>>=5,T-=5,h.ndist=1+(31&B),B>>>=5,T-=5,h.ncode=4+(15&B),B>>>=4,T-=4,286<h.nlen||30<h.ndist){k.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;T<3;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}h.lens[U[h.have++]]=7&B,B>>>=3,T-=3}for(;h.have<19;)h.lens[U[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,N={bits:h.lenbits},F=u(0,h.lens,0,19,h.lencode,0,h.work,N),h.lenbits=N.bits,F){k.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;ce=(S=h.lencode[B&(1<<h.lenbits)-1])>>>16&255,_e=65535&S,!((ie=S>>>24)<=T);){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(_e<16)B>>>=ie,T-=ie,h.lens[h.have++]=_e;else{if(_e===16){for(w=ie+2;T<w;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(B>>>=ie,T-=ie,h.have===0){k.msg="invalid bit length repeat",h.mode=30;break}o=h.lens[h.have-1],Y=3+(3&B),B>>>=2,T-=2}else if(_e===17){for(w=ie+3;T<w;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}T-=ie,o=0,Y=3+(7&(B>>>=ie)),B>>>=3,T-=3}else{for(w=ie+7;T<w;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}T-=ie,o=0,Y=11+(127&(B>>>=ie)),B>>>=7,T-=7}if(h.have+Y>h.nlen+h.ndist){k.msg="invalid bit length repeat",h.mode=30;break}for(;Y--;)h.lens[h.have++]=o}}if(h.mode===30)break;if(h.lens[256]===0){k.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,N={bits:h.lenbits},F=u(b,h.lens,0,h.nlen,h.lencode,0,h.work,N),h.lenbits=N.bits,F){k.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,N={bits:h.distbits},F=u(g,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,N),h.distbits=N.bits,F){k.msg="invalid distances set",h.mode=30;break}if(h.mode=20,O===6)break e;case 20:h.mode=21;case 21:if(6<=H&&258<=re){k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=H,h.hold=B,h.bits=T,d(k,q),se=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,D=k.input,H=k.avail_in,B=h.hold,T=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;ce=(S=h.lencode[B&(1<<h.lenbits)-1])>>>16&255,_e=65535&S,!((ie=S>>>24)<=T);){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(ce&&(240&ce)==0){for(pe=ie,Oe=ce,je=_e;ce=(S=h.lencode[je+((B&(1<<pe+Oe)-1)>>pe)])>>>16&255,_e=65535&S,!(pe+(ie=S>>>24)<=T);){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}B>>>=pe,T-=pe,h.back+=pe}if(B>>>=ie,T-=ie,h.back+=ie,h.length=_e,ce===0){h.mode=26;break}if(32&ce){h.back=-1,h.mode=12;break}if(64&ce){k.msg="invalid literal/length code",h.mode=30;break}h.extra=15&ce,h.mode=22;case 22:if(h.extra){for(w=h.extra;T<w;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}h.length+=B&(1<<h.extra)-1,B>>>=h.extra,T-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;ce=(S=h.distcode[B&(1<<h.distbits)-1])>>>16&255,_e=65535&S,!((ie=S>>>24)<=T);){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if((240&ce)==0){for(pe=ie,Oe=ce,je=_e;ce=(S=h.distcode[je+((B&(1<<pe+Oe)-1)>>pe)])>>>16&255,_e=65535&S,!(pe+(ie=S>>>24)<=T);){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}B>>>=pe,T-=pe,h.back+=pe}if(B>>>=ie,T-=ie,h.back+=ie,64&ce){k.msg="invalid distance code",h.mode=30;break}h.offset=_e,h.extra=15&ce,h.mode=24;case 24:if(h.extra){for(w=h.extra;T<w;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}h.offset+=B&(1<<h.extra)-1,B>>>=h.extra,T-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){k.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(re===0)break e;if(Y=q-re,h.offset>Y){if((Y=h.offset-Y)>h.whave&&h.sane){k.msg="invalid distance too far back",h.mode=30;break}fe=Y>h.wnext?(Y-=h.wnext,h.wsize-Y):h.wnext-Y,Y>h.length&&(Y=h.length),ye=h.window}else ye=ne,fe=se-h.offset,Y=h.length;for(re<Y&&(Y=re),re-=Y,h.length-=Y;ne[se++]=ye[fe++],--Y;);h.length===0&&(h.mode=21);break;case 26:if(re===0)break e;ne[se++]=h.length,re--,h.mode=21;break;case 27:if(h.wrap){for(;T<32;){if(H===0)break e;H--,B|=D[Z++]<<T,T+=8}if(q-=re,k.total_out+=q,h.total+=q,q&&(k.adler=h.check=h.flags?r(h.check,ne,q,se-q):t(h.check,ne,q,se-q)),q=re,(h.flags?B:y(B))!==h.check){k.msg="incorrect data check",h.mode=30;break}T=B=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;T<32;){if(H===0)break e;H--,B+=D[Z++]<<T,T+=8}if(B!==(4294967295&h.total)){k.msg="incorrect length check",h.mode=30;break}T=B=0}h.mode=29;case 29:F=1;break e;case 30:F=-3;break e;case 31:return-4;case 32:default:return l}return k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=H,h.hold=B,h.bits=T,(h.wsize||q!==k.avail_out&&h.mode<30&&(h.mode<27||O!==4))&&V(k,k.output,k.next_out,q-k.avail_out)?(h.mode=31,-4):(te-=k.avail_in,q-=k.avail_out,k.total_in+=te,k.total_out+=q,h.total+=q,h.wrap&&q&&(k.adler=h.check=h.flags?r(h.check,ne,q,k.next_out-q):t(h.check,ne,q,k.next_out-q)),k.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(te==0&&q===0||O===4)&&F===f&&(F=-5),F)},i.inflateEnd=function(k){if(!k||!k.state)return l;var O=k.state;return O.window&&(O.window=null),k.state=null,f},i.inflateGetHeader=function(k,O){var h;return k&&k.state?(2&(h=k.state).wrap)==0?l:((h.head=O).done=!1,f):l},i.inflateSetDictionary=function(k,O){var h,D=O.length;return k&&k.state?(h=k.state).wrap!==0&&h.mode!==11?l:h.mode===11&&t(1,O,D,0)!==h.check?-3:V(k,O,D,D)?(h.mode=31,-4):(h.havedict=1,f):l},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,s,i){var e=n("../utils/common"),t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(b,g,f,l,_,p,m,y){var x,C,j,A,I,R,M,z,L,V=y.bits,k=0,O=0,h=0,D=0,ne=0,Z=0,se=0,H=0,re=0,B=0,T=null,te=0,q=new e.Buf16(16),Y=new e.Buf16(16),fe=null,ye=0;for(k=0;k<=15;k++)q[k]=0;for(O=0;O<l;O++)q[g[f+O]]++;for(ne=V,D=15;1<=D&&q[D]===0;D--);if(D<ne&&(ne=D),D===0)return _[p++]=20971520,_[p++]=20971520,y.bits=1,0;for(h=1;h<D&&q[h]===0;h++);for(ne<h&&(ne=h),k=H=1;k<=15;k++)if(H<<=1,(H-=q[k])<0)return-1;if(0<H&&(b===0||D!==1))return-1;for(Y[1]=0,k=1;k<15;k++)Y[k+1]=Y[k]+q[k];for(O=0;O<l;O++)g[f+O]!==0&&(m[Y[g[f+O]]++]=O);if(R=b===0?(T=fe=m,19):b===1?(T=t,te-=257,fe=r,ye-=257,256):(T=d,fe=u,-1),k=h,I=p,se=O=B=0,j=-1,A=(re=1<<(Z=ne))-1,b===1&&852<re||b===2&&592<re)return 1;for(;;){for(M=k-se,L=m[O]<R?(z=0,m[O]):m[O]>R?(z=fe[ye+m[O]],T[te+m[O]]):(z=96,0),x=1<<k-se,h=C=1<<Z;_[I+(B>>se)+(C-=x)]=M<<24|z<<16|L|0,C!==0;);for(x=1<<k-1;B&x;)x>>=1;if(x!==0?(B&=x-1,B+=x):B=0,O++,--q[k]==0){if(k===D)break;k=g[f+m[O]]}if(ne<k&&(B&A)!==j){for(se===0&&(se=ne),I+=h,H=1<<(Z=k-se);Z+se<D&&!((H-=q[Z+se])<=0);)Z++,H<<=1;if(re+=1<<Z,b===1&&852<re||b===2&&592<re)return 1;_[j=B&A]=ne<<24|Z<<16|I-p|0}}return B!==0&&(_[I+B]=k-se<<24|64<<16|0),y.bits=ne,0}},{"../utils/common":41}],51:[function(n,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,s,i){var e=n("../utils/common"),t=0,r=1;function d(S){for(var E=S.length;0<=--E;)S[E]=0}var u=0,b=29,g=256,f=g+1+b,l=30,_=19,p=2*f+1,m=15,y=16,x=7,C=256,j=16,A=17,I=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(f+2));d(V);var k=new Array(2*l);d(k);var O=new Array(512);d(O);var h=new Array(256);d(h);var D=new Array(b);d(D);var ne,Z,se,H=new Array(l);function re(S,E,U,W,P){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=P,this.has_stree=S&&S.length}function B(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function T(S){return S<256?O[S]:O[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,U){S.bi_valid>y-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>y-S.bi_valid,S.bi_valid+=U-y):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function Y(S,E,U){q(S,U[2*E],U[2*E+1])}function fe(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function ye(S,E,U){var W,P,G=new Array(m+1),K=0;for(W=1;W<=m;W++)G[W]=K=K+U[W-1]<<1;for(P=0;P<=E;P++){var $=S[2*P+1];$!==0&&(S[2*P]=fe(G[$]++,$))}}function ie(S){var E;for(E=0;E<f;E++)S.dyn_ltree[2*E]=0;for(E=0;E<l;E++)S.dyn_dtree[2*E]=0;for(E=0;E<_;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function ce(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function _e(S,E,U,W){var P=2*E,G=2*U;return S[P]<S[G]||S[P]===S[G]&&W[E]<=W[U]}function pe(S,E,U){for(var W=S.heap[U],P=U<<1;P<=S.heap_len&&(P<S.heap_len&&_e(E,S.heap[P+1],S.heap[P],S.depth)&&P++,!_e(E,W,S.heap[P],S.depth));)S.heap[U]=S.heap[P],U=P,P<<=1;S.heap[U]=W}function Oe(S,E,U){var W,P,G,K,$=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*$]<<8|S.pending_buf[S.d_buf+2*$+1],P=S.pending_buf[S.l_buf+$],$++,W===0?Y(S,P,E):(Y(S,(G=h[P])+g+1,E),(K=R[G])!==0&&q(S,P-=D[G],K),Y(S,G=T(--W),U),(K=M[G])!==0&&q(S,W-=H[G],K)),$<S.last_lit;);Y(S,C,E)}function je(S,E){var U,W,P,G=E.dyn_tree,K=E.stat_desc.static_tree,$=E.stat_desc.has_stree,ee=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=p,U=0;U<ee;U++)G[2*U]!==0?(S.heap[++S.heap_len]=he=U,S.depth[U]=0):G[2*U+1]=0;for(;S.heap_len<2;)G[2*(P=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[P]=0,S.opt_len--,$&&(S.static_len-=K[2*P+1]);for(E.max_code=he,U=S.heap_len>>1;1<=U;U--)pe(S,G,U);for(P=ee;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,G,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,G[2*P]=G[2*U]+G[2*W],S.depth[P]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,G[2*U+1]=G[2*W+1]=P,S.heap[1]=P++,pe(S,G,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,Ce){var Ze,Re,He,me,st,gt,Te=Ce.dyn_tree,Dt=Ce.max_code,wn=Ce.stat_desc.static_tree,kn=Ce.stat_desc.has_stree,Cn=Ce.stat_desc.extra_bits,Lt=Ce.stat_desc.extra_base,Ge=Ce.stat_desc.max_length,it=0;for(me=0;me<=m;me++)ae.bl_count[me]=0;for(Te[2*ae.heap[ae.heap_max]+1]=0,Ze=ae.heap_max+1;Ze<p;Ze++)Ge<(me=Te[2*Te[2*(Re=ae.heap[Ze])+1]+1]+1)&&(me=Ge,it++),Te[2*Re+1]=me,Dt<Re||(ae.bl_count[me]++,st=0,Lt<=Re&&(st=Cn[Re-Lt]),gt=Te[2*Re],ae.opt_len+=gt*(me+st),kn&&(ae.static_len+=gt*(wn[2*Re+1]+st)));if(it!==0){do{for(me=Ge-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[Ge]--,it-=2}while(0<it);for(me=Ge;me!==0;me--)for(Re=ae.bl_count[me];Re!==0;)Dt<(He=ae.heap[--Ze])||(Te[2*He+1]!==me&&(ae.opt_len+=(me-Te[2*He+1])*Te[2*He],Te[2*He+1]=me),Re--)}}(S,E),ye(G,he,S.bl_count)}function o(S,E,U){var W,P,G=-1,K=E[1],$=0,ee=7,he=4;for(K===0&&(ee=138,he=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)P=K,K=E[2*(W+1)+1],++$<ee&&P===K||($<he?S.bl_tree[2*P]+=$:P!==0?(P!==G&&S.bl_tree[2*P]++,S.bl_tree[2*j]++):$<=10?S.bl_tree[2*A]++:S.bl_tree[2*I]++,G=P,he=($=0)===K?(ee=138,3):P===K?(ee=6,3):(ee=7,4))}function F(S,E,U){var W,P,G=-1,K=E[1],$=0,ee=7,he=4;for(K===0&&(ee=138,he=3),W=0;W<=U;W++)if(P=K,K=E[2*(W+1)+1],!(++$<ee&&P===K)){if($<he)for(;Y(S,P,S.bl_tree),--$!=0;);else P!==0?(P!==G&&(Y(S,P,S.bl_tree),$--),Y(S,j,S.bl_tree),q(S,$-3,2)):$<=10?(Y(S,A,S.bl_tree),q(S,$-3,3)):(Y(S,I,S.bl_tree),q(S,$-11,7));G=P,he=($=0)===K?(ee=138,3):P===K?(ee=6,3):(ee=7,4)}}d(H);var N=!1;function w(S,E,U,W){q(S,(u<<1)+(W?1:0),3),function(P,G,K,$){ce(P),te(P,K),te(P,~K),e.arraySet(P.pending_buf,P.window,G,K,P.pending),P.pending+=K}(S,E,U)}i._tr_init=function(S){N||(function(){var E,U,W,P,G,K=new Array(m+1);for(P=W=0;P<b-1;P++)for(D[P]=W,E=0;E<1<<R[P];E++)h[W++]=P;for(h[W-1]=P,P=G=0;P<16;P++)for(H[P]=G,E=0;E<1<<M[P];E++)O[G++]=P;for(G>>=7;P<l;P++)for(H[P]=G<<7,E=0;E<1<<M[P]-7;E++)O[256+G++]=P;for(U=0;U<=m;U++)K[U]=0;for(E=0;E<=143;)V[2*E+1]=8,E++,K[8]++;for(;E<=255;)V[2*E+1]=9,E++,K[9]++;for(;E<=279;)V[2*E+1]=7,E++,K[7]++;for(;E<=287;)V[2*E+1]=8,E++,K[8]++;for(ye(V,f+1,K),E=0;E<l;E++)k[2*E+1]=5,k[2*E]=fe(E,5);ne=new re(V,R,g+1,f,m),Z=new re(k,M,0,l,m),se=new re(new Array(0),z,0,_,x)}(),N=!0),S.l_desc=new B(S.dyn_ltree,ne),S.d_desc=new B(S.dyn_dtree,Z),S.bl_desc=new B(S.bl_tree,se),S.bi_buf=0,S.bi_valid=0,ie(S)},i._tr_stored_block=w,i._tr_flush_block=function(S,E,U,W){var P,G,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function($){var ee,he=4093624447;for(ee=0;ee<=31;ee++,he>>>=1)if(1&he&&$.dyn_ltree[2*ee]!==0)return t;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return r;for(ee=32;ee<g;ee++)if($.dyn_ltree[2*ee]!==0)return r;return t}(S)),je(S,S.l_desc),je(S,S.d_desc),K=function($){var ee;for(o($,$.dyn_ltree,$.l_desc.max_code),o($,$.dyn_dtree,$.d_desc.max_code),je($,$.bl_desc),ee=_-1;3<=ee&&$.bl_tree[2*L[ee]+1]===0;ee--);return $.opt_len+=3*(ee+1)+5+5+4,ee}(S),P=S.opt_len+3+7>>>3,(G=S.static_len+3+7>>>3)<=P&&(P=G)):P=G=U+5,U+4<=P&&E!==-1?w(S,E,U,W):S.strategy===4||G===P?(q(S,2+(W?1:0),3),Oe(S,V,k)):(q(S,4+(W?1:0),3),function($,ee,he,ae){var Ce;for(q($,ee-257,5),q($,he-1,5),q($,ae-4,4),Ce=0;Ce<ae;Ce++)q($,$.bl_tree[2*L[Ce]+1],3);F($,$.dyn_ltree,ee-1),F($,$.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Oe(S,S.dyn_ltree,S.dyn_dtree)),ie(S),W&&ce(S)},i._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(h[U]+g+1)]++,S.dyn_dtree[2*T(E)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){q(S,2,3),Y(S,C,V),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,s,i){(function(e){(function(t,r){if(!t.setImmediate){var d,u,b,g,f=1,l={},_=!1,p=t.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(t);m=m&&m.setTimeout?m:t,d={}.toString.call(t.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(t.postMessage&&!t.importScripts){var j=!0,A=t.onmessage;return t.onmessage=function(){j=!1},t.postMessage("","*"),t.onmessage=A,j}}()?(g="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",C,!1):t.attachEvent("onmessage",C),function(j){t.postMessage(g+j,"*")}):t.MessageChannel?((b=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){b.port2.postMessage(j)}):p&&"onreadystatechange"in p.createElement("script")?(u=p.documentElement,function(j){var A=p.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,u.removeChild(A),A=null},u.appendChild(A)}):function(j){setTimeout(x,0,j)},m.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),I=0;I<A.length;I++)A[I]=arguments[I+1];var R={callback:j,args:A};return l[f]=R,d(f),f++},m.clearImmediate=y}function y(j){delete l[j]}function x(j){if(_)setTimeout(x,0,j);else{var A=l[j];if(A){_=!0;try{(function(I){var R=I.callback,M=I.args;switch(M.length){case 0:R();break;case 1:R(M[0]);break;case 2:R(M[0],M[1]);break;case 3:R(M[0],M[1],M[2]);break;default:R.apply(r,M)}})(A)}finally{y(j),_=!1}}}}function C(j){j.source===t&&typeof j.data=="string"&&j.data.indexOf(g)===0&&x(+j.data.slice(g.length))}})(typeof self>"u"?e===void 0?this:e:self)}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(St)),St.exports}var fi=ui();const pi=In(fi),mi=async(a,c,n,s,i)=>{var d,u,b,g,f,l;const e=document.querySelector("svg#".concat(a));if(!e)throw new Error("Requested canvas SVG element not found");const t=Number((d=e.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:d[0]),r=e.cloneNode(!0);r.setAttribute("height",(t*(i||100)/100).toString()),r.style.setProperty("all","initial"),["share"].map(_=>{var p;return[...((p=[...document.querySelectorAll("link")].filter(m=>m.id==="css_"+_)[0])==null?void 0:p.sheet).cssRules].map(m=>m.cssText).join(" ")}).forEach(_=>{const p=document.createElement("style");p.textContent=_,r.prepend(p)}),(u=r.querySelector("rect#canvas-border"))==null||u.setAttribute("stroke",s?"black":"none"),(b=r.querySelector("rect#canvas-bg"))==null||b.setAttribute("fill",n?"none":"white");try{const _=(l=await((f=(g=Bt[c]).fonts)==null?void 0:f.call(g)))!=null?l:[],m=(await Promise.allSettled(_.map(de.getFontCSS))).filter(x=>x.status==="fulfilled").map(x=>x.value),y=document.createElement("style");y.textContent=m.join("\n"),r.prepend(y)}catch(_){console.warn("Failed to fonts. Fonts in the exported PNG will be missing.",_)}return r},gi=async(a,c,n)=>{const s=a.viewBox.baseVal.width,i=a.viewBox.baseVal.height,e=document.querySelectorAll("canvas")[0];e.width=Number(s)*window.devicePixelRatio*c,e.height=Number(i)*window.devicePixelRatio*c,a.setAttribute("width",e.width.toString()),a.setAttribute("height",e.height.toString());const t=e.getContext("2d");return t.clearRect(0,0,e.width,e.height),a.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(r=>r.setAttribute("font-size","8.5px")),a.querySelectorAll("text, tspan").forEach(r=>{const d=window.getComputedStyle(r);r.setAttribute("font-family",d.fontFamily),r.setAttribute("fill",d.fill),r.setAttribute("dominant-baseline",d.dominantBaseline),r.setAttribute("text-anchor",d.textAnchor||"")}),new Promise((r,d)=>{const u=new Image;u.onload=()=>{setTimeout(()=>{t.drawImage(u,0,0,e.width,e.height),e.toBlob(b=>{b?r(b):d("Canvas blob is null")},"image/png")},n?2e3:0)},u.onerror=d,u.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a.outerHTML)))})};function bi(a){const{isOpen:c,onClose:n}=a,{t:s}=le(),i=ue(),[e,t]=J.useState(""),[r,d]=J.useState(!1),[u,b]=J.useState(!1),[g,f]=J.useState(100),[l,_]=J.useState("png"),p=Q(z=>z.app.canvasToShow),{style:m,stn_list:y,current_stn_idx:x,line_name:C}=Q(z=>z.param);J.useEffect(()=>{e!==""&&!p.includes(e)&&t("")},[p]);const j=Tt[m].reduce((z,L)=>p.includes(L)?{...z,[L]:s("CanvasType."+L)}:{...z},{"":s("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((z,L)=>({...z,[L]:"".concat(L,"%")}),{}),I={png:s("DownloadModal.png"),svg:s("DownloadModal.svg")},R=[{type:"select",label:s("DownloadModal.canvas"),value:e,options:j,disabledOptions:[""],onChange:z=>t(z),minW:"full"},{type:"switch",label:s("DownloadModal.transparent"),isChecked:r,onChange:d,oneLine:!0,minW:"full"},{type:"switch",label:s("DownloadModal.showBorder"),isChecked:u,onChange:b,oneLine:!0,minW:"full"},{type:"select",label:s("DownloadModal.scale"),value:g,options:A,onChange:z=>f(z)},{type:"select",label:s("DownloadModal.format"),value:l,options:I,onChange:z=>_(z)}],M=async z=>{i(Gt(0));const L=z==="current"?[x]:Object.keys(y).filter(k=>!["linestart","lineend"].includes(k)),V=new pi;for(const k in L){i(Gt((Number(k)+1)/L.length*100));const O=L[k];i(jt(O)),await Gr(500);const h=await mi(e,m,r,u,g);document.body.appendChild(h);const D="rmg.".concat(O,".").concat(y[O].localisedName.en).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(l==="png"){const ne=Vr()&&k==="0",Z=await gi(h,g/100,ne);L.length>1?V.file("".concat(D,".png"),Z):Vt("".concat(D,".png"),Z)}else if(l==="svg"){h.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h.outerHTML)));L.length>1?V.file("".concat(D,".svg"),ne.split("base64,")[1],{base64:!0}):bn(D+".svg","image/svg+xml",h.outerHTML)}document.body.removeChild(h)}if(L.length>1){const k=await V.generateAsync({type:"blob"}),O="rmg.".concat(C[0],".").concat(C[1],".zip").replaceAll(" ","_");Vt(O,k)}de.event(we.DOWNLOAD_IMAGES,{canvasToDownload:e,style:m,option:z,format:l}),i(jt(x)),i(Ar()),n()};return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[v.jsx(Qe,{children:s("DownloadModal.title")}),v.jsx(et,{}),v.jsx(tt,{children:v.jsx(ge,{fields:R})}),v.jsx(nt,{children:v.jsxs(Ee,{children:[v.jsx(oe,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("current"),isDisabled:!e,children:s("DownloadModal.downloadOne")}),m!==X.GZMTR&&v.jsx(oe,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("all"),isDisabled:!e,children:s("DownloadModal.downloadAll")})]})})]})]})}function _i(){const{t:a}=le(),[c,n]=J.useState(!1),{paramConfig:s}=Q(t=>t.app),i=Q(t=>t.param),e=()=>{const t=$r(i);bn("RMG_".concat(s==null?void 0:s.id,".json"),"application/json",JSON.stringify(t)),de.event(we.DOWNLOAD_PARAM,{style:i.style})};return v.jsxs(An,{children:[v.jsx(En,{as:oe,variant:"ghost",size:"sm",rightIcon:v.jsx(Er,{}),children:a("DownloadActions.downloads")}),v.jsxs(On,{children:[v.jsx(Ft,{onClick:e,children:a("DownloadActions.configFile")}),v.jsx(Ft,{onClick:()=>n(!0),children:a("DownloadActions.images")})]}),v.jsx(bi,{isOpen:c,onClose:()=>n(!1)})]})}function rt(){const[a,c]=Mn();return[a,s=>{c(s);const e=Object.keys(s).length===0?"/":"/?"+new URLSearchParams(s);de.updateAppMetadata({hash:e})}]}function vi(){const{t:a}=le(),c=on(),[,n]=rt(),s=()=>{c(Le(Me.CLOSE)),c(Et(void 0)),n({})};return v.jsxs(Ee,{ml:"auto",w:"fit-content",children:[v.jsx(oe,{variant:"ghost",size:"sm",leftIcon:v.jsx(Or,{}),onClick:s,children:a("All projects")}),v.jsx(_i,{}),v.jsx(oe,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:v.jsx(Rr,{}),onClick:()=>c(Le(Me.STYLE)),children:a("HeaderActions.editStyle")})]})}function yi(){const{t:a}=le(),c=ue(),{canvasToShow:n,canvasScale:s}=Q(u=>u.app),i=Q(u=>u.param.style),e=Object.values(X).reduce((u,b)=>({...u,[b]:a("RmgStyle."+b)}),{}),t=Tt[i].map(u=>({label:a("CanvasType."+u),value:u})),r=u=>{c(Mr(u))},d=[{type:"select",label:a("Style"),value:i,options:e,onChange:u=>r(u)},{type:"custom",label:a("View"),component:v.jsx(zr,{displayValue:a("Select canvas"),selections:t,defaultValue:n,onChange:u=>c(Pr(u))})},{type:"slider",label:a("Canvas scale"),value:s,min:.1,max:2,step:.01,onChange:u=>c(Nr(u)),leftIcon:v.jsx(Br,{}),rightIcon:v.jsx(Tr,{})}];return v.jsxs(Ir,{children:[v.jsx(ge,{fields:d,minW:160}),v.jsx(vi,{})]})}const Ye=(a,c,n,s)=>(i,e)=>{var u,b,g,f,l,_,p,m,y,x,C,j,A,I;const t=e().param.stn_list;let r=qe(6);for(;r in t;)r=qe(6);const d=Dr(r);if(a!=="new"){const R={...t,[c]:{...t[c],children:t[c].children.map(M=>M===n?r:M),branch:{left:(u=t[c].branch)==null?void 0:u.left,right:((g=(b=t[c].branch)==null?void 0:b.right)==null?void 0:g[1])===n?(l=(f=t[c].branch)==null?void 0:f.right)==null?void 0:l.with(1,r):(_=t[c].branch)==null?void 0:_.right}},[n]:{...t[n],parents:t[n].parents.map(M=>M===c?r:M),branch:{left:((m=(p=t[n].branch)==null?void 0:p.left)==null?void 0:m[1])===c?(x=(y=t[n].branch)==null?void 0:y.left)==null?void 0:x.with(1,r):(C=t[n].branch)==null?void 0:C.left,right:(j=t[n].branch)==null?void 0:j.right}},[r]:{...d,parents:[c],children:[n]}};return i(xe(R)),r}else{if(!s)return!1;const R={...t,[c]:{...t[c],children:s==="upper"?[r,t[c].children[0]]:[t[c].children[0],r],branch:{left:(A=t[c].branch)==null?void 0:A.left,right:[ut.through,r]}},[n]:{...t[n],parents:s==="upper"?[r,t[n].parents[0]]:[t[n].parents[0],r],branch:{left:[ut.through,r],right:(I=t[n].branch)==null?void 0:I.right}},[r]:{...d,parents:[c],children:[n]}};return i(xe(R)),r}},Si=(a,c,n)=>(s,i)=>{const t=i().helper.branches[a];if(t!=null&&t.length)if(c==="before"){const r=t[t.indexOf(n)-1];return s(Ye(a.toString(),r,n))}else{const r=t[t.indexOf(n)+1];return s(Ye(a.toString(),n,r))}else return!1},xi=()=>(a,c)=>{const n=c().param.stn_list;return c().helper.branches[0].filter(i=>{const e=n[i].parents.length+n[i].children.length===4,t=It(i,n)===0;return!e&&t})},rn=(a,c)=>(n,s)=>{const i=s().param.stn_list,e=s().helper.branches;return!e[0].includes(a)||!e[0].includes(c)?"Branch should end at main line":e[0].indexOf(a)>=e[0].indexOf(c)?"Not in correct ordering":a==="linestart"&&c==="lineend"?"Should not be parallel to main line":a==="linestart"&&e[0].indexOf(c)===1?"Branch should not be open jaw from the first station":c==="lineend"&&e[0].indexOf(a)===e[0].length-2?"Branch should not be open jaw from the last station":i[a].children.length>1||i[c].parents.length>1?"Branch already exist":e.slice(1).some(d=>d.slice(1,-1).includes(a)||d.slice(1,-1).includes(c))?"Cannot branch out from existing branch":e[0].slice(e[0].indexOf(a)+1,e[0].indexOf(c)).every(d=>i[d].parents.length===1&&i[d].children.length===1)?"":"One or more stations between both ends are branching out"};function wi(a){var I,R;const{isOpen:c,onClose:n}=a,{t:s}=le(),i=ue(),e=Q(M=>M.app.selectedBranch),{style:t,stn_list:r}=Q(M=>M.param),d=Q(M=>M.helper.branches),[u,b]=J.useState(e),[g,f]=J.useState("before"),[l,_]=J.useState(""),[p,m]=J.useState(!1);J.useEffect(()=>{b(e)},[e]),J.useEffect(()=>{c||m(!1)},[c]);const y=(R=(I=d[Number(u)])==null?void 0:I.slice(1,-1))!=null?R:[],x=M=>M.reduce((z,L)=>{var V,k;return{...z,[L]:((V=r[L])==null?void 0:V.localisedName.zh)+"/"+((k=r[L])==null?void 0:k.localisedName.en)}},{"":s("AddStationModal.pleaseSelect")}),C=[{type:"select",label:s("AddStationModal.where"),value:u,options:{...d.reduce((M,z,L)=>({...M,[L]:L===0?s("AddStationModal.main"):t!==X.SHMetro||!We(z,r)?s("AddStationModal.branch")+" "+L:s("AddStationModal.external")+" "+L}),{})},onChange:M=>j(M),minW:"full"},{type:"select",label:s("AddStationModal.preposition"),value:g,options:{before:s("AddStationModal.before"),after:s("AddStationModal.after")},onChange:M=>f(M)},{type:"select",label:s("AddStationModal.pivot"),value:l,options:x(y),disabledOptions:[""],onChange:M=>_(M)}],j=M=>{b(M),_("")},A=()=>{const M=i(Si(u,g,l));M?(n(),i(fn(M)),i(Le(Me.STATION))):(console.log("false here"),m(!0)),de.event(we.ADD_STATION,{style:t,branchIndex:u,success:M})};return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[p&&v.jsxs(ft,{status:"error",variant:"solid",size:"xs",children:[v.jsx(pt,{}),s("AddStationModal.error")]}),v.jsxs(ke,{position:"relative",children:[v.jsx(Qe,{children:s("AddStationModal.title")}),v.jsx(et,{})]}),v.jsx(tt,{children:v.jsx(ge,{fields:C})}),v.jsx(nt,{children:v.jsx(oe,{colorScheme:"primary",onClick:A,isDisabled:!l,children:s("Confirm")})})]})]})}function ki(a){const{isOpen:c,onClose:n}=a,{t:s}=le(),i=ue(),[e,t]=J.useState("new"),[r,d]=J.useState(""),[u,b]=J.useState(""),[g,f]=J.useState("upper"),[l,_]=J.useState(""),[p,m]=J.useState(""),{style:y,stn_list:x}=Q(V=>V.param);J.useEffect(()=>{c||(t("new"),d(""),b(""))},[c]);const j=(V=>V.reduce((k,O)=>{var h,D;return{...k,[O]:O==="linestart"?"(".concat(s("LEFT END"),")"):O==="lineend"?"(".concat(s("RIGHT END"),")"):((h=x[O])==null?void 0:h.localisedName.zh)+"/"+((D=x[O])==null?void 0:D.localisedName.en)}},{"":s("Please select...")}))(i(xi())),A=[{type:"select",label:s("NewBranchModal.where"),value:e,options:{new:s("NewBranchModal.new"),ext:s("NewBranchModal.ext")},disabledOptions:y===X.SHMetro?[]:["ext"],onChange:V=>I(V),minW:"full"},{type:"select",label:s("NewBranchModal.from"),value:r,options:j,disabledOptions:[""],onChange:V=>R(V),isInvalid:!!l},{type:"select",label:s("NewBranchModal.to"),value:u,options:j,disabledOptions:[""],onChange:V=>M(V),isInvalid:!!p},{type:"select",label:s("NewBranchModal.position"),value:g,options:{upper:s("NewBranchModal.upper"),lower:s("NewBranchModal.lower")},onChange:V=>f(V),minW:"full",hidden:e!=="new"||y===X.SHMetro}],I=V=>{t(V),d(""),b(""),_(""),m("")},R=V=>{d(V),_(""),V&&u&&m(i(rn(V,u)))},M=V=>{b(V),m(""),r&&V&&_(i(rn(r,V)))},z=()=>{let V;e==="ext"?V=i(Ye("new",r,u,"lower")):y===X.SHMetro?V=i(Ye("new",r,u,"upper")):V=i(Ye("new",r,u,g)),V&&(n(),de.event(we.ADD_BRANCH,{style:y,where:e}))},L=!!(!r||!u||l||p);return v.jsxs(Ke,{isOpen:c,onClose:n,children:[v.jsx(Xe,{}),v.jsxs(Je,{children:[v.jsx(Qe,{children:s("NewBranchModal.title")}),v.jsx(et,{}),v.jsx(tt,{children:v.jsx(ge,{fields:A})}),v.jsx(nt,{children:v.jsx(oe,{colorScheme:"primary",title:L?l||p:s("Confirm"),onClick:z,isDisabled:L,children:s("Confirm")})})]})]})}const Ci=J.lazy(()=>Fe(()=>import("./station-ag-grid-n4KvDt2t.js"),__vite__mapDeps([12,1,2,3,4,13,14,9])));function ji(){const{t:a}=le(),c=ue(),[n,s]=J.useState(!1),[i,e]=J.useState(!1),t=Q(f=>f.app.selectedBranch),{style:r,stn_list:d,loop:u}=Q(f=>f.param),b=Q(f=>f.helper.branches),g=()=>{c(Le(Me.BRANCH))};return v.jsxs(ke,{flex:1,overflow:"hidden",children:[v.jsxs(Rn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:t,onChange:f=>c(un(f)),children:[v.jsxs(zn,{children:[b.map((f,l)=>l===0?v.jsx(bt,{children:a(u?"Loop line":"GridTabs.main")},l):r!==X.SHMetro||!We(f,d)?v.jsxs(bt,{children:[a("GridTabs.branch")+" "+l,u&&v.jsx(Lr,{style:{marginLeft:5},title:a("Branches are not supported in the loop line.")})]},l):v.jsx(bt,{children:a("GridTabs.external")+" "+l},l)),v.jsx(Ne,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>e(!0),icon:v.jsx(Be,{}),isDisabled:u}),v.jsxs(Ee,{marginLeft:"auto",marginRight:1,children:[v.jsx(oe,{variant:"outline",size:"xs",leftIcon:v.jsx(Be,{}),onClick:()=>s(!0),children:a("GridTabs.addStation")}),v.jsx(oe,{size:"xs",colorScheme:"primary",onClick:g,children:a("GridTabs.editLine")})]})]}),v.jsx(Pn,{flex:1,overflowY:"auto",children:b.map((f,l)=>v.jsx(Tn,{padding:0,h:"100%",position:"relative",children:v.jsx(ln,{suspenseFallback:v.jsx(mt,{isIndeterminate:!0}),children:v.jsx(Ci,{branchIndex:l})})},l))})]}),v.jsx(wi,{isOpen:n,onClose:()=>s(!1)}),v.jsx(ki,{isOpen:i,onClose:()=>e(!1)})]})}function Ai(){const a=ue(),c=Q(s=>s.app.globalAlerts),n=s=>{de.isStandaloneWindow()?window.open("/".concat(s),"_blank"):de.openApp({appId:s})};return v.jsx(v.Fragment,{children:Object.entries(c).map(([s,{message:i,url:e,linkedApp:t}])=>v.jsxs(ft,{status:s,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[v.jsx(pt,{}),t?v.jsx(Ve,{onClick:()=>n(t),children:i}):e?v.jsx(Ve,{href:e,target:"_blank",children:i}):i,v.jsx(sn,{ml:"auto",onClick:()=>a(Fr(s))})]},s))})}const xn=a=>{document.title=a,setTimeout(()=>{de.updateAppMetadata({title:a})},200)};function Ei(){const{t:a}=le(),[c]=rt(),n=c.get("project"),s=Q(t=>t.app.isLoading),[i,e]=J.useState(!1);return J.useEffect(()=>{var t;if(de.isStandaloneWindow()&&!de.storage.get($e.DO_NOT_SHOW_RMT_MSG)&&e(!0),n){const r=Yr(n);xn((t=r==null?void 0:r.name)!=null?t:a("Project")+" "+n)}},[]),v.jsxs(gn,{children:[s&&v.jsx(mt,{isIndeterminate:s<0,value:s>=0?s:void 0}),v.jsx(yi,{}),i&&v.jsxs(ft,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[v.jsx(pt,{}),v.jsxs(ct,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[a("Try out")," ",v.jsx(Ve,{href:"/?app=rmg",isExternal:!0,children:a("Rail Map Toolkit")})," ",a("now and enjoy an even better rail map design experience!")," ",v.jsx(Ve,{as:"button",ml:"auto",onClick:()=>e(!1),children:a("Close")})," | ",v.jsx(Ve,{as:"button",onClick:()=>{e(!1),de.storage.set($e.DO_NOT_SHOW_RMT_MSG,"true")},children:a("Don't show me again")})]})]}),v.jsx(Ai,{}),v.jsxs(Pe,{flex:1,overflow:"hidden",position:"relative",children:[v.jsxs(Pe,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[v.jsx(ke,{children:v.jsx(is,{})}),v.jsx(ji,{})]}),v.jsx(hi,{})]}),v.jsx("canvas",{style:{display:"none"}})]})}const Oi="rmg-templates-bridge--",Ri={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function zi(a){const{isOpen:c,onClose:n,onImport:s}=a,[i]=J.useState(qe()),e="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:de.getAppName(),parentId:i});return J.useEffect(()=>{const t=new BroadcastChannel(Oi+i);return t.onmessage=r=>{const{event:d,meta:u,data:b}=r.data;console.log("[rmg] Received event from RMG Templates app clip:",d),d==="CLOSE"?n():d==="IMPORT"&&s(b,u.name)},()=>{t.close()}},[]),v.jsx(mn,{size:"xl",isOpen:c,onClose:n,sx:Ri,children:v.jsx("iframe",{src:e,loading:"eager"})})}const Pi={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function Ti(a){const{selectedParam:c,disableNew:n,onError:s}=a,{t:i}=le(),[,e]=rt(),[t,r]=J.useState(!1),d=J.useRef(null),u=J.useRef(null);J.useEffect(()=>{var _;c&&((_=u.current)==null||_.focus())},[c]);const b=()=>{const _=Hr(X.MTR,de.getLanguage()),p=vt(JSON.stringify(_));e({project:p}),de.event(we.NEW_PARAM,{})},g=(_,p)=>{const m=vt(JSON.stringify(_),p);e({project:m})},f=async _=>{var m;const p=(m=_.target.files)==null?void 0:m[0];ze.info("handleImportProject(), received file",p);try{if(!p)s(i("OpenActions.unknownError"));else if(p.type!=="application/json")s(i("OpenActions.invalidType"));else{const y=await qr(p),x=vt(y);e({project:x}),de.event(we.UPLOAD_PARAM,{})}}catch(y){s(i("OpenActions.unknownError")),ze.error("handleImportProject(), Unknown error occurred while parsing the uploaded file",y)}_.target.value=""},l=()=>{c&&(e({project:c}),de.event(we.OPEN_PARAM,{}))};return v.jsxs(Pe,{sx:Pi,children:[v.jsx(oe,{leftIcon:v.jsx(Be,{}),onClick:b,isDisabled:n,children:i("Blank project")}),v.jsx(oe,{leftIcon:v.jsx(Ur,{}),onClick:()=>r(!0),isDisabled:n,children:i("Open template")}),v.jsx(oe,{leftIcon:v.jsx(Wr,{}),onClick:()=>{var _;return(_=d.current)==null?void 0:_.click()},isDisabled:n,children:i("Import project")}),v.jsx(oe,{ref:u,colorScheme:"primary",leftIcon:v.jsx(Zr,{}),onClick:l,isDisabled:c===void 0,children:i("Open selected")}),v.jsx("input",{ref:d,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),v.jsx(zi,{isOpen:t,onClose:()=>r(!1),onImport:g})]})}const Bi={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Ni(a){const{downloading:c}=a,{t:n}=le(),[s]=rt(),i=s.get("project"),[e,t]=J.useState([]),[r,d]=J.useState(),u=J.useRef(null),b=an();J.useEffect(()=>{xn(n("Manage projects"))},[]),J.useEffect(()=>{t(yt())},[c]),Bn({ref:u,handler:()=>d(void 0)});const g=_=>{const{id:p,name:m,lastModified:y}=_;p&&(de.storage.set($e.PARAM_CONFIG_BY_ID+p,JSON.stringify({name:m,lastModified:y})),d(void 0),t(yt()),de.event(we.UPDATE_PARAM_CONFIG,{}))},f=_=>{de.storage.remove($e.PARAM_BY_ID+_),de.storage.remove($e.PARAM_CONFIG_BY_ID+_),d(void 0),t(yt()),de.event(we.REMOVE_PARAM,{})},l=_=>{b({description:_,status:"error",duration:1e4,isClosable:!0})};return v.jsxs(gn,{justifyContent:"center",children:[i&&v.jsx(mt,{isIndeterminate:!0}),v.jsx(Nn,{children:v.jsxs(De,{sx:Bi,children:[v.jsx(ve,{as:"h3",size:"lg",children:n("Saved projects")}),v.jsxs(Pe,{ref:u,children:[v.jsx(Kr,{paramRegistry:e,downloading:c,selectedParam:r,onParamSelect:d,onParamRemove:f,onParamUpdate:g}),v.jsx(Ti,{selectedParam:r,disableNew:e.length>=10,onError:l})]})]})})]})}const Ii=a=>async c=>{try{const{config:n,param:s}=Xr(a);if(!s)return!1;const i={id:a,...n!=null?n:{}},e=Jr(s);try{const t=await Qr(e);c(Et(i)),c($t(t))}catch(t){console.warn("Unable to update themes",t),c(Et(i)),c($t(e))}return!0}catch(n){return console.warn("Failed to parse param.",n),!1}};function Mi(){const{t:a}=le(),c=ue(),{paramConfig:n}=Q(f=>f.app),[s,i]=rt(),e=s.get("project"),t=s.get("external"),[r,d]=J.useState(!1),[u,b]=J.useState(),g=an();return J.useEffect(()=>{if(ze.info("searchParam: project=".concat(e,", external=").concat(t)),e&&t)ze.warn("<AppRouter/>, Both param ID and external URL are provided. External URL will be ignored."),i({project:e});else if(e)g.closeAll(),e===(n==null?void 0:n.id)?(ze.info("<AppRouter/>, Store param ID matches URL param ID. Rendering app view..."),d(!0)):(ze.info("<AppRouter/>, Loading app view for param (ID=".concat(e,")...")),c(Ii(e)).then(f=>{f?d(!0):(ze.info("<AppRouter/>, Failed to read param (ID=".concat(e,"). Rendering param selector view...")),g({description:a("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),i({}))}));else if(t){ze.info("<AppRouter/>, External project URl is provided. Downloading project...");const f=decodeURIComponent(t);b(f),es(f).then(l=>{l?i({project:l}):(ze.info("<AppRouter/>, Failed to download param from ".concat(f,". Rendering param selector view...")),g({description:a("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),i({})),b(void 0)})}else ze.info("<AppRouter/>, No URL param ID or external URL provided. Rendering param selector view..."),d(!1)},[e,t]),r?v.jsx(Ei,{}):v.jsx(Ni,{downloading:u})}const Zi=Object.freeze(Object.defineProperty({__proto__:null,default:Mi},Symbol.toStringTag,{value:"Module"}));export{ts as R,Zi as a,Wi as g,We as i};
