import{ag as v,u as I,j as o,B as z,h as D,ao as b}from"./chakra-jT2-teuD.js";import{d as E,u as h,e as p,a$ as w,i as F,a8 as C,a7 as H,ae as L,b0 as P}from"./index-HyGScCuj.js";import{u as B,a as n}from"./react-BNX4K-US.js";import{g as O,R as W}from"./app-router-rOJHvELN.js";import{A as Z}from"./ag-grid-react-CzfEcuxL.js";import{M as $,z as _,D as q}from"./ag-grid-community-BXPI1aQR.js";import"./param-selector-Co1Y1OOn.js";var J=function(i){var r=i.children,t=v().colorMode,d=I("RmgAgGrid");return o.jsx(z,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:d,children:r})};function K(i){const{lineNumber:r,stationNumber:t,lineColour:d}=i,l={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:d,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return o.jsxs(D,{sx:l,children:[o.jsx("span",{children:r}),o.jsx("span",{children:t})]})}$.registerModules([_]);q({theme:"legacy"});const Q={mode:"singleRow",checkboxes:!1,enableClickSelection:!0};function se(i){const{branchIndex:r}=i,{t,i18n:d}=B(),l=E(),g=h(e=>e.app.sidePanelMode),{style:c,theme:f,stn_list:R,line_num:S,coline:N}=h(e=>e.param),x=h(e=>e.helper.branches),[y,M]=n.useState([]);n.useEffect(()=>{const e=x[r].reduce((a,s)=>["linestart","lineend"].includes(s)?a:[...a,{...R[s],id:s,rowSpan:l(O(s,r))}],[]);M(e)},[x,r,R]);const G=n.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:e})=>o.jsx(K,{lineNumber:S,stationNumber:e,lineColour:f[2]}),pinned:"left",minWidth:110,hide:![p.GZMTR].includes(c)},{headerName:t("Chinese name"),field:"localisedName",valueFormatter:({value:e,data:a})=>e.zh+(c===p.GZMTR&&a?.localisedSecondaryName?.zh?` (${a.localisedSecondaryName.zh})`:"")},{headerName:t("English name"),cellRenderer:({data:e})=>o.jsx(W,{text:e.localisedName.en+(c===p.GZMTR&&e.localisedSecondaryName?.en?` (${e.localisedSecondaryName.en})`:"")}),minWidth:300},{headerName:t("StationAgGrid.interchange"),cellRenderer:({data:e})=>o.jsx(b,{children:e.transfer.groups.map(a=>a.lines??[]).flat().map((a,s)=>o.jsx(w,{name:a.name,bg:a.theme?.[2]??"#aaaaaa",fg:a.theme?.[3]??F.white,showShortName:!0},s))})},{headerName:t("StationAgGrid.coline"),rowSpan:({data:e})=>e?.rowSpan[0]??0,cellClassRules:{"rmg-ag-grid--spanned-cell":({data:e})=>!!e&&e.rowSpan[0]>0},cellRenderer:({data:e})=>o.jsx(b,{children:N[e.rowSpan[1]]?.colors?.map((a,s)=>o.jsx(w,{name:[a[4],a[5]],bg:a[2],fg:a[3],showShortName:!0},s))}),hide:![p.SHMetro].includes(c)}],[c,f.toString(),d.language,S]),u=n.useRef(null),m=n.useRef(!1);n.useEffect(()=>{m.current&&u.current&&u.current.api.getSelectedRows().length===1&&g!==C.STATION&&u.current.api.deselectAll()},[m.current,g]);const[j]=n.useState({resizable:!0}),A=n.useCallback(()=>{m.current=!0},[m.current]),T=n.useCallback(({api:e})=>{const a=e.getSelectedRows()?.map(s=>s.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",a),a?.length&&(l(H(C.STATION)),l(L(a[0])),l(P(void 0)))},[]),k=n.useCallback(({data:e})=>e.id,[]);return o.jsx(J,{children:o.jsx(Z,{ref:u,rowData:y,defaultColDef:j,columnDefs:G,getRowId:k,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:Q,onSelectionChanged:T,onGridReady:A,debug:!1})})}export{se as default};
