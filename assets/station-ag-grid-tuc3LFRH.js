import{ag as E,u as F,j as s,B as H,h as L,ao as N}from"./chakra-CXrhlirJ.js";import{d as P,u as f,e as g,aT as y,h as B,aa as G,a9 as W,ab as Z,aU as O}from"./index-BNw4ulhB.js";import{u as _,a as o}from"./react-Caefwd5V.js";import{g as $,R as U}from"./app-router-DLtIdJ6V.js";import{A as q}from"./ag-grid-react-BBLzGE2-.js";import"./param-selector-Dz1wbauC.js";import"./ag-grid-community-B8OIBZSq.js";var J=function(d){var l=d.children,t=E().colorMode,c=F("RmgAgGrid");return s.jsx(H,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:c,children:l})};function K(d){const{lineNumber:l,stationNumber:t,lineColour:c}=d,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:c,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return s.jsxs(L,{sx:i,children:[s.jsx("span",{children:l}),s.jsx("span",{children:t})]})}function se(d){const{branchIndex:l}=d,{t,i18n:c}=_(),i=P(),x=f(e=>e.app.sidePanelMode),{style:u,theme:S,stn_list:R,line_num:j,coline:M}=f(e=>e.param),b=f(e=>e.helper.branches),[A,T]=o.useState([]);o.useEffect(()=>{const e=b[l].reduce((n,a)=>["linestart","lineend"].includes(a)?n:[...n,{...R[a],id:a,rowSpan:i($(a,l))}],[]);T(e)},[b,l,R]);const v=o.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:e})=>s.jsx(K,{lineNumber:j,stationNumber:e,lineColour:S[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(u)},{headerName:t("Chinese name"),field:"localisedName",valueFormatter:({value:e,data:n})=>{var a;return e.zh+(u===g.GZMTR&&((a=n==null?void 0:n.localisedSecondaryName)!=null&&a.zh)?" (".concat(n.localisedSecondaryName.zh,")"):"")}},{headerName:t("English name"),field:"localisedName",cellRenderer:({value:e,data:n})=>{var a;return s.jsx(U,{text:e.en+(u===g.GZMTR&&((a=n.localisedSecondaryName)!=null&&a.en)?" (".concat(n.localisedSecondaryName.en,")"):"")})},minWidth:300},{headerName:t("StationAgGrid.interchange"),field:"transfer",cellRenderer:({value:e})=>s.jsx(N,{children:e.groups.map(n=>{var a;return(a=n.lines)!=null?a:[]}).flat().map((n,a)=>{var r,h,w,C;return s.jsx(y,{name:n.name,bg:(h=(r=n.theme)==null?void 0:r[2])!=null?h:"#aaaaaa",fg:(C=(w=n.theme)==null?void 0:w[3])!=null?C:B.white,showShortName:!0},a)})})},{headerName:t("StationAgGrid.coline"),field:"rowSpan",rowSpan:({data:e})=>{var n;return(n=e==null?void 0:e.rowSpan[0])!=null?n:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({value:e})=>e[0]>0},cellRenderer:({value:e})=>{var n,a;return s.jsx(N,{children:(a=(n=M[e[1]])==null?void 0:n.colors)==null?void 0:a.map((r,h)=>s.jsx(y,{name:[r[4],r[5]],bg:r[2],fg:r[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(u)}],[u,S.toString(),c.language]),m=o.useRef(null),p=o.useRef(!1);o.useEffect(()=>{p.current&&m.current&&m.current.api.getSelectedRows().length===1&&x!==G.STATION&&m.current.api.deselectAll()},[p.current,x]);const[k]=o.useState({resizable:!0}),I=o.useCallback(()=>{p.current=!0},[p.current]),z=o.useCallback(({api:e})=>{var a;const n=(a=e.getSelectedRows())==null?void 0:a.map(r=>r.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",n),n!=null&&n.length&&(i(W(G.STATION)),i(Z(n[0])),i(O(void 0)))},[]),D=o.useCallback(({data:e})=>e.id,[]);return s.jsx(J,{children:s.jsx(q,{ref:m,rowData:A,defaultColDef:k,columnDefs:v,getRowId:D,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:"single",onSelectionChanged:z,onGridReady:I,debug:!1})})}export{se as default};
