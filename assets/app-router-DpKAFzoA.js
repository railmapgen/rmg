const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CZrCHn5c.js","assets/chakra-CXrhlirJ.js","assets/react-Caefwd5V.js","assets/index-Bea1NmFS.js","assets/index-BTdBVow0.css","assets/svg-wrapper-DO1Iqw6o.js","assets/share-C3JEGT6P.js","assets/mtr-awLTpeHY.js","assets/index-DEAVBoIt.js","assets/param-selector-BwTPSW50.js","assets/index-CeHEa3PO.js","assets/index-De2JTxIG.js","assets/station-ag-grid-CZaipof9.js","assets/ag-grid-react-A6BSx5P9.js","assets/ag-grid-community-TcQKCcyM.js"])))=>i.map(i=>d[i]);
import{j as y,ap as xn,h as Te,B as ke,al as Se,a2 as Be,ao as ze,N as lt,aq as Et,t as de,D as Ne,aj as Ke,M as Xe,ak as Je,U as ut,V as ft,J as Qe,K as et,L as tt,O as nt,ab as nn,ar as wn,as as kn,at as Cn,au as Lt,av as jn,aw as An,ax as gt,ay as En,az as On,R as Ve,aA as rn,a as zn,aB as Rn}from"./chakra-CXrhlirJ.js";import{a as X,u as ce,o as sn,c as at,g as Pn,s as Tn}from"./react-Caefwd5V.js";import{_ as Le,u as J,r as le,E as xe,R as pt,a as an,s as In,b as on,c as Bn,D as ve,d as ue,e as Q,f as Pe,M as Nn,F as St,g as Me,h as ct,i as Ie,j as xt,o as Ot,k as Mn,l as zt,S as dt,m as Ft,B as ht,n as Rt,p as Pt,q as Dn,t as Ln,v as Fn,w as wt,x as kt,y as Un,z as Ut,A as Wn,C as Zn,G as ln,H as cn,I as Hn,J as Gn,P as Vn,K as Yn,L as Wt,N as $n,O as qn,Q as Kn,T as Xn,U as Jn,V as Qn,W as Zt,X as er,Y as tr,Z as nr,$ as bt,a0 as rr,a1 as sr,a2 as ir,a3 as ar,a4 as or,a5 as lr,a6 as cr,a7 as Fe,a8 as qe,a9 as Ue,aa as De,ab as dn,ac as dr,ad as Ct,ae as jt,af as hr,ag as ur,ah as fr,ai as pr,aj as hn,ak as mr,al as gr,am as br,an as _r,ao as Ht,ap as yr,aq as vr,ar as Sr,as as xr,at as At,au as wr,av as kr,aw as Cr,ax as jr,ay as Ar,az as Er,aA as Or,aB as zr,aC as Rr,aD as Pr,aE as Ye,aF as un,aG as Tr,aH as Ir,aI as Br,aJ as Nr,aK as Oe}from"./index-Bea1NmFS.js";import{R as be,w as Mr,i as Dr,d as Gt,a as fn,s as Lr,g as Fr,b as _t,r as Ur,c as yt,P as Wr,e as Zr,u as Hr,f as Gr,h as Vr}from"./param-selector-BwTPSW50.js";var Yr=function(o){var d=o.text,n=o.delimiter;return y.jsx("span",{children:d.split(n||"\\").map(function(i,s){return s?[y.jsx(xn,{children:"⏎"},s),i]:i})})};const Tt={mtr:{components:()=>Le(()=>import("./index-CZrCHn5c.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),fonts:()=>Le(()=>import("./index-CZrCHn5c.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(o=>o.mtrFonts)},gzmtr:{components:()=>Le(()=>import("./index-DEAVBoIt.js"),__vite__mapDeps([8,1,2,3,4,6,5,9]))},shmetro:{components:()=>Le(()=>import("./index-CeHEa3PO.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,9]))},shsubrwy:{components:()=>Le(()=>import("./index-De2JTxIG.js"),__vite__mapDeps([11,1,2,3,4,5]))}};function $r(o){const[d,n]=X.useState({});return X.useEffect(()=>(Tt[o].components().then(i=>{n(i.default)}).catch(i=>{console.error("Failed to load canvas for style ".concat(o),i),n({})}),()=>{n({})}),[o]),d}const qr={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}},Kr=async(o,d)=>{var i,s,e,t;const n=(e=await((s=(i=Tt[o]).fonts)==null?void 0:s.call(i)))!=null?e:[];await Promise.all(n.map(r=>le.loadFont(r))),d.aborted||(t=document.querySelector("#css_share"))==null||t.setAttribute("href","/rmg/styles/share_".concat(o,".css"))};function Xr(){const{canvasToShow:o,canvasScale:d}=J(r=>r.app),{svg_height:n,style:i}=J(r=>r.param),s=$r(i);X.useEffect(()=>{const r=new AbortController;return Kr(i,r.signal).then(),le.event(xe.STYLE_CHANGE,{style:i}),()=>{r.abort()}},[i]);const e=Object.keys(s).filter(r=>o.includes(r)),t=n*d;return y.jsx(Te,{minH:t,sx:qr,children:Object.keys(s).length===0?y.jsx(pt,{isIndeterminate:!0}):e.map(r=>y.jsx(an,{sx:{minWidth:750,height:t},children:s[r]},r+i))})}const Vt=o=>d=>{d(In(o)),d(on(o.stn_list))},_e=(o,d)=>(n,i)=>{const{stn_list:s}=i().param,e={...s,[o]:d};n(we(e))},we=o=>d=>{d(Bn(o)),d(on(o))},Jr=(o=!1)=>(d,n)=>{const{stn_list:i}=n().param,s=Object.keys(i).reduce((e,t)=>({...e,[t]:(r=>{var c,p,v,m;switch(r){case"linestart":return{...i.lineend,parents:[],children:o?i.lineend.parents:i.lineend.parents.toReversed(),branch:{right:(c=i.lineend.branch)==null?void 0:c.left}};case"lineend":return{...i.linestart,parents:o?i.linestart.children:i.linestart.children.toReversed(),children:[],branch:{left:(p=i.linestart.branch)==null?void 0:p.right}};default:{const h=i[r].children.map(b=>b==="linestart"?"lineend":b==="lineend"?"linestart":b),l=i[r].parents.map(b=>b==="linestart"?"lineend":b==="lineend"?"linestart":b);return{...i[r],parents:o?h:h.reverse(),children:o?l:l.reverse(),branch:{left:(v=i[r].branch)==null?void 0:v.right,right:(m=i[r].branch)==null?void 0:m.left}}}}})(t)}),{});d(we(s))},Yt=(o,d,n)=>(i,s)=>{const e=s().param.stn_list[o];i(_e(o,{...e,localisedName:{...e.localisedName,[d]:n}}))},Qr=(o,d)=>(n,i)=>{const{localisedSecondaryName:s,...e}=i().param.stn_list[o];n(d?_e(o,{...e,localisedSecondaryName:{}}):_e(o,e))},$t=(o,d,n)=>(i,s)=>{const e=s().param.stn_list[o];i(_e(o,{...e,localisedSecondaryName:{...e.localisedSecondaryName,[d]:n}}))},es=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,num:d}))},qt=(o,d,n)=>(i,s)=>{var r,c;const e=s().param.stn_list[o],t=e.transfer.groups.map(p=>({...p}));if(t.length>d)t[d]={...t[d],lines:((r=t[d].lines)!=null?r:[]).concat(n)};else{for(let p=t.length;p<d;p++)t[p]={lines:[]};t[d]={lines:[n]}}i(_e(o,{...e,transfer:{...e.transfer,groups:[t[0],...(c=t.slice(1))!=null?c:[]]}}))},ts=(o,d,n)=>(i,s)=>{var t,r;const e=s().param.stn_list[o];if(e.transfer.groups.length>d&&(((t=e.transfer.groups[d].lines)==null?void 0:t.length)||0)>n){const c=e.transfer.groups.map((p,v)=>{var m;return v===d?{...p,lines:(m=p.lines)==null?void 0:m.filter((h,l)=>l!==n)}:p});i(_e(o,{...e,transfer:{...e.transfer,groups:[c[0],...(r=c.slice(1))!=null?r:[]]}}))}},ns=(o,d,n,i)=>(s,e)=>{var r,c;const t=e().param.stn_list[o];if(t.transfer.groups.length>d&&(((r=t.transfer.groups[d].lines)==null?void 0:r.length)||0)>n){const p=t.transfer.groups.map((v,m)=>{var h;return m===d?{...v,lines:(h=v.lines)==null?void 0:h.map((l,b)=>b===n?i:l)}:v});s(_e(o,{...t,transfer:{...t.transfer,groups:[p[0],...(c=p.slice(1))!=null?c:[]]}}))}},Kt=(o,d,n)=>(i,s)=>{var r;const e=s().param.stn_list[o],t=e.transfer.groups.map(c=>({...c}));t.length>d&&(t[d]={...t[d],name:n},i(_e(o,{...e,transfer:{...e.transfer,groups:[t[0],...(r=t.slice(1))!=null?r:[]]}})))},rs=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,transfer:{...s.transfer,tick_direc:d}}))},ss=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,transfer:{...s.transfer,paid_area:d}}))},is=(o,d,n)=>(i,s)=>{var t,r;const e=s().param.stn_list[o];i(_e(o,{...e,branch:{...e.branch,[d]:(r=(t=e.branch)==null?void 0:t[d])==null?void 0:r.with(0,n)}}))},as=(o,d,n)=>(i,s)=>{var r,c,p;const e=s().helper.branches,t={stnId:o,direction:d,first:n};if(d===ve.left){const v=(r=e.slice(1).find(m=>m.slice(-1)[0]===o))==null?void 0:r[0];if(v){const m=e[0][e[0].indexOf(v)+1];i(Xt([t,{stnId:v,direction:ve.right,first:m}]))}}else{const v=(p=(c=e.slice(1).find(m=>m[0]===o))==null?void 0:c.slice(-1))==null?void 0:p[0];if(v){const m=e[0][e[0].indexOf(v)-1];i(Xt([t,{stnId:v,direction:ve.left,first:m}]))}}},Xt=o=>(d,n)=>{var s,e,t,r;const{stn_list:i}=n().param;d(we({...i,[o[0].stnId]:{...i[o[0].stnId],branch:{...i[o[0].stnId].branch,[o[0].direction]:(e=(s=i[o[0].stnId].branch)==null?void 0:s[o[0].direction])==null?void 0:e.with(1,o[0].first)}},[o[1].stnId]:{...i[o[1].stnId],branch:{...i[o[1].stnId].branch,[o[1].direction]:(r=(t=i[o[1].stnId].branch)==null?void 0:t[o[1].direction])==null?void 0:r.with(1,o[1].first)}}}))},os=(o,d)=>(n,i)=>{var e,t,r;const s=i().helper.branches;if(d===ve.left){const c=(e=s.slice(1).find(p=>p.slice(-1)[0]===o))==null?void 0:e[0];c&&n(Jt(o,c))}else{const c=(r=(t=s.slice(1).find(p=>p[0]===o))==null?void 0:t.slice(-1))==null?void 0:r[0];c&&n(Jt(c,o))}},Jt=(o,d)=>(n,i)=>{const{stn_list:s}=i().param;n(we({...s,[o]:{...s[o],parents:s[o].parents.slice().reverse()},[d]:{...s[d],children:s[d].children.slice().reverse()}}))},ls=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,facility:d||void 0}))},cs=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,services:d}))},ds=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,loop_pivot:d}))},hs=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,one_line:d}))},us=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,int_padding:d}))},fs=o=>(d,n)=>{const s=n().param.stn_list[o].int_padding,e=structuredClone(n().param.stn_list);Object.values(e).forEach(t=>{t.int_padding=s}),d(we(e))},ps=(o,d)=>(n,i)=>{const s=i().param.stn_list[o];n(_e(o,{...s,character_spacing:d}))},ms=o=>(d,n)=>{const s=n().param.stn_list[o].character_spacing,e=structuredClone(n().param.stn_list);Object.values(e).forEach(t=>{t.character_spacing=s}),d(we(e))},gs=(o,d,n=2,i="asc")=>(s,e)=>{var p;const t=e().param.stn_list,c=(p=e().helper.branches[o])==null?void 0:p.slice(1,-1);if(c){const v=c.reduce((m,h,l)=>({...m,[h]:{...t[h],num:(d+l*(i==="desc"?-1:1)).toString().padStart(n,"0")}}),t);s(we(v))}};function bs(){var c,p,v,m;const{t:o}=ce(),d=ue(),n=J(h=>h.app.selectedStation);console.log("InfoSection:: Rendering for",n);const i=J(h=>h.param.style),{num:s,localisedName:e,localisedSecondaryName:t}=J(h=>h.param.stn_list[n]),r=[{type:"input",label:o("StationSidePanel.info.num"),value:s,placeholder:"01",onChange:h=>d(es(n,h)),hidden:![Q.GZMTR].includes(i)},{type:"input",label:o("Chinese name"),value:(c=e.zh)!=null?c:"",onChange:h=>d(Yt(n,"zh",h))},{type:"input",label:o("English name"),value:(p=e.en)!=null?p:"",onChange:h=>d(Yt(n,"en",h))},{type:"custom",label:o("Secondary names"),component:y.jsx(Pe,{selections:[{label:o("Yes"),value:!0},{label:o("No"),value:!1}],defaultValue:!!t,onChange:h=>d(Qr(n,h))}),hidden:![Q.GZMTR].includes(i)},{type:"input",label:o("StationSidePanel.info.zhSecondary"),value:(v=t==null?void 0:t.zh)!=null?v:"",placeholder:"1号航站楼",onChange:h=>d($t(n,"zh",h)),hidden:!t||![Q.GZMTR].includes(i)},{type:"input",label:o("StationSidePanel.info.enSecondary"),value:(m=t==null?void 0:t.en)!=null?m:"",placeholder:"Terminal 1",onChange:h=>d($t(n,"en",h)),hidden:!t||![Q.GZMTR].includes(i)}];return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("StationSidePanel.info.title")}),y.jsx(be,{fields:r,minW:130})]})}class _s{static hexToRgb(d){return[parseInt(d.slice(1,3),16),parseInt(d.slice(3,5),16),parseInt(d.slice(5,7),16)]}static fade(d,n){return"rgba(".concat([...this.hexToRgb(d),n].join(","),")")}static euclideanDistance(d,n){return this.hexToRgb(d).reduce((i,s,e)=>i+Math.pow(s-this.hexToRgb(n)[e],2),0)}}function It(o){var s;const{theme:d,onClick:n}=o,{t:i}=ce();return y.jsx(Be,{size:"xs","aria-label":i("Colour"),mt:"0.45px",color:d==null?void 0:d[3],bg:d==null?void 0:d[2],_hover:{bg:_s.fade((s=d==null?void 0:d[2])!=null?s:"#aaaaaa",.7)},icon:y.jsx(Nn,{}),onClick:n})}function ys(o){const{interchangeList:d,onAdd:n,onDelete:i,onUpdate:s}=o,{t:e}=ce(),t=ue(),[r,c]=X.useState(),{paletteAppClipOutput:p}=J(_=>_.app),{style:v,theme:m,stn_list:h}=J(_=>_.param);X.useEffect(()=>{r!==void 0&&p&&(s==null||s(r,{...d[r],theme:p}),c(void 0))},[p==null?void 0:p.toString()]);const l=Object.values(h).reduce((_,g)=>{const[x,C]=_;return[[...new Set(x.concat(g.transfer.groups.map(j=>{var A,N;return(N=(A=j.lines)==null?void 0:A.map(O=>O.name[0]))!=null?N:[]}).flat()))],[...new Set(C.concat(g.transfer.groups.map(j=>{var A,N;return(N=(A=j.lines)==null?void 0:A.map(O=>O.name[1]))!=null?N:[]}).flat()))]]},[[],[]]),b=Object.fromEntries(Object.entries(St).filter(([_])=>!["railway"].includes(_)).map(([_,g])=>[_,e(g)])),u=d.map((_,g)=>[{type:"input",label:e("Chinese name"),value:_.name[0],onChange:x=>s==null?void 0:s(g,{..._,name:[x,_.name[1]]}),optionList:l[0]},{type:"input",label:e("English name"),value:_.name[1],onChange:x=>s==null?void 0:s(g,{..._,name:[_.name[0],x]}),optionList:l[1]},{type:"select",label:e("Line icon"),value:_.facility,options:b,onChange:x=>s==null?void 0:s(g,{..._,facility:x}),hidden:![Q.MTR].includes(v)}]);return y.jsxs(Me,{direction:"column",children:[d.length===0&&y.jsxs(ze,{spacing:.5,"data-testid":"interchange-card-stack",children:[y.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("StationSidePanel.interchange.noInterchanges")}),y.jsx(Be,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n({theme:[m[0],"","#aaaaaa",ct.white],name:["",""]}),icon:y.jsx(Ie,{})})]}),d.map((_,g)=>y.jsxs(ze,{spacing:.5,"data-testid":"interchange-card-stack-".concat(g),children:[y.jsx(xt,{label:e("Colour"),minW:"40px",noLabel:g!==0,children:y.jsx(It,{theme:_.theme,onClick:()=>{var x;c(g),t(Ot((x=_.theme)!=null?x:[m[0],"","#aaaaaa",ct.white]))}})}),y.jsx(be,{fields:u[g],noLabel:g!==0}),n&&g===u.length-1?y.jsx(Be,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(d.slice(-1)[0]),icon:y.jsx(Mn,{})}):y.jsx(ke,{minW:8}),i&&y.jsx(Be,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.remove"),onClick:()=>i==null?void 0:i(g),icon:y.jsx(zt,{})})]},g))]})}function vs(){const{t:o}=ce(),d=ue(),n=J(m=>m.app.selectedStation),{theme:i,style:s}=J(m=>m.param),{transfer:e}=J(m=>m.param.stn_list[n]),t=m=>{var h,l,b,u;return[{type:"input",label:o("Station Chinese name"),value:(l=(h=e.groups[m].name)==null?void 0:h[0])!=null?l:"",hidden:![Q.MTR].includes(s),onChange:_=>{var g,x;return d(Kt(n,m,[_,(x=(g=e.groups[m].name)==null?void 0:g[1])!=null?x:""]))}},{type:"input",label:o("Station English name"),value:(u=(b=e.groups[m].name)==null?void 0:b[1])!=null?u:"",hidden:![Q.MTR].includes(s),onChange:_=>{var g,x;return d(Kt(n,m,[(x=(g=e.groups[m].name)==null?void 0:g[0])!=null?x:"",_]))}},{type:"switch",label:o("Paid area"),isChecked:e.paid_area,onChange:_=>d(ss(n,_)),hidden:![Q.MTR].includes(s)||m===0,oneLine:!0}]},r=m=>h=>{d(qt(n,m,h))},c=m=>h=>{d(ts(n,m,h))},p=m=>(h,l)=>{d(ns(n,m,h,l))},v=()=>{d(qt(n,e.groups.length,{theme:[i[0],"","#AAAAAA",ct.white],name:["",""]}))};return y.jsxs(Et,{align:"flex-start",p:1,children:[y.jsxs(Te,{w:"100%",children:[y.jsx(Se,{as:"h5",size:"sm",mr:"auto",children:o("StationSidePanel.interchange.title")}),s===Q.MTR&&y.jsx(Pe,{selections:[{label:o("Text on the left"),value:dt.left},{label:o("Text on the right"),value:dt.right}],defaultValue:e.tick_direc,onChange:m=>d(rs(n,m))})]}),e.groups.map((m,h)=>{var l;return y.jsxs(X.Fragment,{children:[y.jsx(Se,{as:"h6",size:"xs",children:o(h===0?"StationSidePanel.interchange.within":h===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),h!==0&&y.jsx(be,{fields:t(h)}),y.jsx(ys,{interchangeList:(l=m.lines)!=null?l:[],onAdd:r(h),onDelete:c(h),onUpdate:p(h)})]},h)}),e.groups.length<3&&y.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:y.jsx(Ie,{}),onClick:v,children:o("StationSidePanel.interchange.addGroup")})]})}function Ss(){const{t:o}=ce(),d=ue(),n=J(u=>u.app.selectedStation),{style:i,loop:s}=J(u=>u.param),{services:e,facility:t,loop_pivot:r,one_line:c,int_padding:p,character_spacing:v}=J(u=>u.param.stn_list[n]),m=Object.values(Ft).map(u=>({label:o("StationSidePanel.more."+u),value:u,disabled:u===Ft.local&&i!==Q.SHMetro})),h=Object.fromEntries(Object.entries(St).filter(([u])=>!["railway"].includes(u)).map(([u,_])=>[u,o(_)])),l=Object.fromEntries(Object.entries(St).filter(([u])=>!["np360"].includes(u)).map(([u,_])=>[u,o(_)])),b=[{type:"custom",label:o("StationSidePanel.more.service"),component:y.jsx(Pe,{selections:m,defaultValue:e,onChange:u=>d(cs(n,u)),multiSelect:!0}),hidden:![Q.GZMTR,Q.SHMetro].includes(i)},{type:"select",label:o("StationSidePanel.more.facility"),value:t||"",options:{"":o("None"),...i===Q.MTR?h:l},onChange:u=>d(ls(n,u)),hidden:![Q.MTR,Q.SHMetro].includes(i)},{type:"switch",label:o("StationSidePanel.more.pivot"),isChecked:r,onChange:u=>d(ds(n,u)),hidden:![Q.SHMetro].includes(i)||!s,minW:"full",oneLine:!0},{type:"switch",label:o("StationSidePanel.more.oneLine"),isChecked:c,onChange:u=>d(hs(n,u)),hidden:![Q.SHMetro].includes(i),minW:"full",oneLine:!0},{type:"input",label:o("StationSidePanel.more.intPadding"),value:p.toString(),validator:u=>Number.isInteger(u),onChange:u=>d(us(n,Number(u))),hidden:![Q.SHMetro].includes(i)},{type:"custom",label:o("StationSidePanel.more.intPaddingApplyGlobal"),component:y.jsx(Pe,{selections:[{label:o("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>d(fs(n))}),oneLine:!0,hidden:![Q.SHMetro].includes(i)},{type:"input",label:o("StationSidePanel.more.characterSpacing"),value:v.toString(),validator:u=>Number.isInteger(u),onChange:u=>d(ps(n,Number(u))),hidden:![Q.SHSuburbanRailway].includes(i)},{type:"custom",label:o("StationSidePanel.more.intPaddingApplyGlobal"),component:y.jsx(Pe,{selections:[{label:o("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>d(ms(n))}),oneLine:!0,hidden:![Q.SHSuburbanRailway].includes(i)}];return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("StationSidePanel.more.title")}),y.jsx(be,{fields:b})]})}function xs(){const{t:o}=ce(),d=ue(),n=J(m=>m.app.selectedStation),i=J(m=>m.param.stn_list),{parents:s,children:e,branch:t}=i[n],r={[ht.through]:o("StationSidePanel.branch.through"),[ht.nonThrough]:o("StationSidePanel.branch.nonThrough")},c=m=>(m===ve.left?s:e).reduce((h,l)=>({...h,[l]:i[l].localisedName.zh+"/"+i[l].localisedName.en}),{}),p={upper:o("StationSidePanel.branch.upper"),lower:o("StationSidePanel.branch.lower")},v=m=>{const h=t==null?void 0:t[m];return h?[{type:"select",label:o("StationSidePanel.branch.type"),options:r,value:h[0],onChange:l=>d(is(n,m,l))},{type:"select",label:o("StationSidePanel.branch.firstStation"),options:c(m),value:h[1],onChange:l=>d(as(n,m,l))},{type:"select",label:o("StationSidePanel.branch.position"),options:p,value:(m===ve.left?s:e)[0]===h[1]?"upper":"lower",onChange:()=>d(os(n,m))}]:[]};return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("Branches")}),y.jsx(Se,{as:"h6",size:"xs",children:o("Branch on the left")}),y.jsx(Me,{direction:"column",children:s.length===2?y.jsx(be,{fields:v(ve.left)}):y.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:o("No branches found")})}),y.jsx(Se,{as:"h6",size:"xs",children:o("Branch on the right")}),y.jsx(Me,{direction:"column",children:e.length===2?y.jsx(be,{fields:v(ve.right)}):y.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:o("No branches found")})})]})}function ws(){return y.jsxs(Rt,{children:[y.jsx(bs,{}),y.jsx(Ne,{}),y.jsx(vs,{}),y.jsx(Ne,{}),y.jsx(xs,{}),y.jsx(Ne,{}),y.jsx(Ss,{})]})}function ks(){const{t:o}=ce(),d=ue(),{style:n,svgWidth:i,svg_height:s,y_pc:e,branchSpacingPct:t,padding:r,direction_gz_x:c,direction_gz_y:p,loop:v}=J(h=>h.param),m=[...Pt[n].map(h=>({type:"input",label:o("StyleSidePanel.layout.".concat(h,"Width")),value:i[h].toString(),onChange:l=>d(Dn({width:Number(l),canvas:h}))})),{type:"input",label:o("StyleSidePanel.layout.canvasHeight"),value:s.toString(),onChange:h=>d(Ln(Number(h)))},{type:"slider",label:o("StyleSidePanel.layout.verticalPosition"),value:e,min:0,max:100,onChange:h=>d(Fn(h)),leftIcon:y.jsx(wt,{}),rightIcon:y.jsx(kt,{}),hidden:![Q.MTR,Q.GZMTR].includes(n)},{type:"slider",label:o(v?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:t,min:0,max:v?50:100,onChange:h=>d(Un(h)),leftIcon:y.jsx(Ut,{}),rightIcon:y.jsx(Ie,{})},{type:"slider",label:o("StyleSidePanel.layout.padding"),value:r,min:0,max:50,onChange:h=>d(Wn(h)),leftIcon:y.jsx(Ut,{}),rightIcon:y.jsx(Ie,{})},{type:"slider",label:o("StyleSidePanel.layout.directionGzX"),value:c,min:0,max:100,onChange:h=>d(Zn(h)),leftIcon:y.jsx(ln,{}),rightIcon:y.jsx(cn,{}),hidden:![Q.GZMTR].includes(n)},{type:"slider",label:o("StyleSidePanel.layout.directionGzY"),value:p,min:0,max:100,onChange:h=>d(Hn(h)),leftIcon:y.jsx(wt,{}),rightIcon:y.jsx(kt,{}),hidden:![Q.GZMTR].includes(n)}];return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("StyleSidePanel.layout.title")}),y.jsx(be,{fields:m,minW:130})]})}function Cs(){var G;const{t:o}=ce(),d=ue(),{paletteAppClipOutput:n}=J(w=>w.app),{style:i,theme:s,line_name:e,line_num:t,spanLineNum:r,direction:c,platform_num:p,psd_num:v,namePosMTR:m,customiseMTRDest:h,info_panel_type:l,stn_list:b,loop:u}=J(w=>w.param),_=Math.max(...Object.values(b).map(w=>w.services.length)),[g,x]=X.useState(!1);X.useEffect(()=>{g&&n&&(d(Gn(n)),x(!1))},[n==null?void 0:n.toString()]);const C=[{label:o("StyleSidePanel.design.left"),value:dt.left},{label:o("StyleSidePanel.design.right"),value:dt.right}],j=Object.values(Vn).reduce((w,T)=>({...w,[T]:o("StyleSidePanel.design."+T)}),{}),A=Object.values(Yn).reduce((w,T)=>({...w,[T]:o("StyleSidePanel.design."+T)}),{}),N=[{type:"custom",label:o("Colour"),component:y.jsx(It,{theme:s,onClick:()=>{x(!0),d(Ot(s))}}),minW:"40px"},{type:"input",label:o("StyleSidePanel.design.zhLineName"),value:e[0],onChange:w=>d(Wt([w,e[1]])),minW:130},{type:"input",label:o("StyleSidePanel.design.enLineName"),value:e[1],onChange:w=>d(Wt([e[0],w])),minW:130},{type:"input",label:o("StyleSidePanel.design.lineNum"),value:t,onChange:w=>d($n(w)),hidden:![Q.GZMTR].includes(i)},{type:"custom",label:o("Span digits over rows"),component:y.jsx(Pe,{selections:[{label:o("Yes"),value:!0},{label:o("No"),value:!1}],defaultValue:r!=null?r:!1,onChange:w=>d(qn(w))}),hidden:![Q.GZMTR].includes(i)},{type:"input",label:o("StyleSidePanel.design.platformNum"),value:p||"",onChange:w=>d(Kn(w))},{type:"input",label:o("StyleSidePanel.design.psdNum"),value:v,onChange:w=>d(Xn(w)),hidden:![Q.GZMTR].includes(i)},{type:"select",label:o("StyleSidePanel.design.panelType"),value:l,options:i===Q.GZMTR?j:A,onChange:w=>d(Jn(w)),hidden:![Q.GZMTR,Q.SHMetro].includes(i)},{type:"custom",label:o("StyleSidePanel.design.direction"),component:y.jsx(Pe,{selections:C,defaultValue:c,onChange:w=>d(Qn(w))}),minW:"full",oneLine:!0}],O=[{label:o("StyleSidePanel.design.upwards"),value:!0},{label:o("StyleSidePanel.design.downward"),value:!1}],M=[{type:"custom",label:o("StyleSidePanel.design.firstStationNameDisplay"),component:y.jsx(ze,{spacing:.5,children:y.jsx(Pe,{selections:O,defaultValue:(G=m.isFlip)!=null?G:!0,onChange:w=>d(Zt(w))})}),minW:"full",oneLine:!0,hidden:![Q.SHMetro].includes(i)||_>1||u}],z=[{label:o("StyleSidePanel.design.alternatively"),value:!0},{label:o("StyleSidePanel.design.onOneSide"),value:!1}],L=[{type:"custom",label:o("StyleSidePanel.design.nameDisplay"),component:y.jsxs(ze,{spacing:.5,children:[y.jsx(Be,{size:"xs",variant:"ghost","aria-label":o("StyleSidePanel.design.flip"),title:o("StyleSidePanel.design.flip"),icon:y.jsx(er,{}),onClick:()=>d(Zt())}),y.jsx(Pe,{selections:z,defaultValue:m.isStagger,onChange:w=>d(tr(w))})]}),minW:"full",oneLine:!0,hidden:![Q.MTR].includes(i)},{type:"switch",label:o("StyleSidePanel.design.legacyDestination"),isChecked:h.isLegacy,onChange:w=>d(nr(w)),hidden:![Q.MTR].includes(i),minW:"full",oneLine:!0},{type:"switch",label:o("StyleSidePanel.design.overrideTerminal"),isChecked:h.terminal!==!1,onChange:w=>d(bt(w?["",""]:!1)),hidden:![Q.MTR].includes(i),minW:"full",oneLine:!0},{type:"input",label:o("StyleSidePanel.design.terminalZhName"),value:h.terminal?h.terminal[0]:"",placeholder:"機場及博覽館",onChange:w=>d(bt([w,h.terminal?h.terminal[1]:""])),hidden:![Q.MTR].includes(i)||h.terminal===!1},{type:"input",label:o("StyleSidePanel.design.terminalEnName"),value:h.terminal?h.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:w=>d(bt([h.terminal?h.terminal[0]:"",w])),hidden:![Q.MTR].includes(i)||h.terminal===!1}];return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("StyleSidePanel.design.title")}),y.jsx(be,{fields:[...N,...L,...M],minW:130})]})}function js(){const{t:o}=ce(),d=ue(),{branches:n}=J(h=>h.helper),{loop:i,loop_info:s}=J(h=>h.param),{bank:e,left_and_right_factor:t,bottom_factor:r}=s,c=n.flat().filter((h=>l=>(h[l]=(h[l]||0)+1)===2)({})).filter(h=>!["linestart","lineend"].includes(h)),p=Math.abs(n[0].indexOf(c[0])-n[0].indexOf(c[1])),v=n.length>=2?(0,Math.min)(n[0].length-2-p,p):Math.floor((n[0].length-2-r*2)/2),m=[{type:"switch",label:o("StyleSidePanel.loop.isLoop"),isChecked:i,onChange:h=>d(rr(h)),minW:"full",oneLine:!0},{type:"switch",label:o("StyleSidePanel.loop.isBank"),isChecked:e,onChange:h=>d(sr(h)),minW:"full",oneLine:!0,hidden:!i},{type:"slider",label:o("StyleSidePanel.loop.leftRightFactor"),value:t,min:0,max:v,onChange:h=>d(ir(Math.floor(h))),hidden:!i},{type:"slider",label:o("StyleSidePanel.loop.bottomFactor"),value:r,min:0,max:Math.floor((n[0].length-2-t*2)/2),onChange:h=>d(ar(Math.floor(h))),hidden:!i||i&&n.length>2}];return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("StyleSidePanel.loop.title")}),y.jsx(be,{fields:m})]})}function As(o){const{note:d,onUpdate:n,onDelete:i}=o,{t:s}=ce(),e=[{type:"textarea",label:s("StyleSidePanel.note.zhNote"),value:d[0],onChange:r=>n==null?void 0:n([r,d[1],d[2],d[3],d[4]])},{type:"textarea",label:s("StyleSidePanel.note.enNote"),value:d[1],onChange:r=>n==null?void 0:n([d[0],r,d[2],d[3],d[4]])},{type:"switch",label:s("StyleSidePanel.note.border"),isChecked:d[4],onChange:r=>n==null?void 0:n([d[0],d[1],d[2],d[3],r]),oneLine:!0}],t=[{type:"slider",label:s("StyleSidePanel.note.positionX"),value:d[2],min:0,max:100,onChange:r=>n==null?void 0:n([d[0],d[1],r,d[3],d[4]]),leftIcon:y.jsx(ln,{}),rightIcon:y.jsx(cn,{})},{type:"slider",label:s("StyleSidePanel.note.positionY"),value:d[3],min:0,max:100,onChange:r=>n==null?void 0:n([d[0],d[1],d[2],r,d[4]]),leftIcon:y.jsx(wt,{}),rightIcon:y.jsx(kt,{})}];return y.jsxs(Me,{direction:"column",children:[y.jsx(be,{fields:e,minW:"full"}),y.jsxs(ze,{spacing:.5,sx:{"&>div":{flex:1}},children:[y.jsx(be,{fields:t}),y.jsx(Be,{size:"sm",variant:"ghost","aria-label":s("StyleSidePanel.note.remove"),onClick:()=>i==null?void 0:i(),icon:y.jsx(zt,{})})]})]})}function Es(){const{t:o}=ce(),d=ue(),n=J(i=>i.param.notesGZMTR);return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("StyleSidePanel.note.title")}),y.jsxs(Et,{spacing:.5,children:[n==null?void 0:n.map((i,s)=>y.jsx(As,{note:i,onUpdate:e=>d(or({index:s,note:e})),onDelete:()=>d(lr(s))},s)),y.jsx(de,{size:"xs",variant:"ghost",leftIcon:y.jsx(Ie,{}),alignSelf:"flex-end",onClick:()=>d(cr()),children:o("StyleSidePanel.note.add")})]})]})}function Os(){const{style:o}=J(d=>d.param);return y.jsxs(Rt,{children:[y.jsx(ks,{}),y.jsx(Ne,{}),y.jsx(Cs,{}),o===Q.GZMTR&&y.jsxs(y.Fragment,{children:[y.jsx(Ne,{}),y.jsx(Es,{})]}),o===Q.SHMetro&&y.jsxs(y.Fragment,{children:[y.jsx(Ne,{}),y.jsx(js,{})]})]})}const Bt=(o,d)=>{if(["linestart","lineend"].includes(o)||d[o].parents.length>1||d[o].children.length>1)return 0;const n=d[o].parents[0];return n?d[n].children.length===1?Bt(n,d):d[n].children.indexOf(o)===0?1:-1:0},zs=o=>(d,n)=>{const{stn_list:i,current_stn_idx:s}=n().param;if(o===s)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:e,children:t}=i[o];return Object.keys(i).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):e.length===2&&t.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(i).some(c=>![o,"linestart","lineend"].includes(c)&&Bt(c,i)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Rs=o=>(d,n)=>{var r,c;const i=n().param.stn_list,{parents:s,children:e}=i[o];let t=JSON.parse(JSON.stringify(i));s.length===2||e.length===2?(s.forEach(p=>{t[p].children=e}),e.forEach(p=>{t[p].parents=s}),s.length===1&&(t[s[0]].branch={...t[s[0]].branch,right:(r=t[o].branch)==null?void 0:r.right}),e.length===1&&(t[e[0]].branch={...t[e[0]].branch,left:(c=t[o].branch)==null?void 0:c.left})):i[s[0]].children.length===2&&i[e[0]].parents.length===2?t={...i,[s[0]]:{...i[s[0]],children:i[s[0]].children.filter(p=>p!==o),branch:{...i[s[0]].branch,right:void 0}},[e[0]]:{...i[e[0]],parents:i[e[0]].parents.filter(p=>p!==o),branch:{...i[e[0]].branch,left:void 0}}}:(s.forEach(p=>{var m,h,l,b;const v=t[p].children.indexOf(o);e.length?t[p].children[v]=e[0]:t[p].children.splice(v,1),((h=(m=t[p].branch)==null?void 0:m.right)==null?void 0:h[1])===o&&(t[p].branch={...t[p].branch,right:(b=(l=t[p].branch)==null?void 0:l.right)==null?void 0:b.with(1,e[0])})}),e.forEach(p=>{var m,h,l,b;const v=t[p].parents.indexOf(o);s.length?t[p].parents[v]=s[0]:t[p].parents.splice(v,1),((h=(m=t[p].branch)==null?void 0:m.left)==null?void 0:h[1])===o&&(t[p].branch={...t[p].branch,left:(b=(l=t[p].branch)==null?void 0:l.left)==null?void 0:b.with(1,s[0])})})),delete t[o],d(we(t))};function Ps(...o){return o.reduce((d,n)=>d.map(i=>n.map(s=>i.concat([s]))).reduce((i,s)=>i.concat(s),[]),[[]])}const We=(o,d)=>!!d[o[0]].children.indexOf(o[1]),pn=(o,d)=>[o[0][1],o[0][o[0].length-2],...o[0].filter(n=>o.slice(1).filter(i=>We(i,d)).map(i=>i.filter(s=>!["linestart","lineend"].includes(s))).map(i=>[i[0],i[i.length-1]]).flat().includes(n))],Ts=(o,d)=>o.slice(1).filter(n=>We(n,d)).map(n=>n.filter(i=>!["linestart","lineend"].includes(i))).map(n=>[n[0],n[n.length-1]]),Is=o=>(d,n)=>{const i=n().helper.branches;if(o===0){const s=n().param.stn_list,e=pn(i,s);return Ps(e,e).filter(t=>t[0]!==t[1])}else{const s=i[o];if(s){const e=s.filter(t=>!["linestart","lineend"].includes(t));return[[e[0],e.slice(-1)[0]]]}else return[]}},Pi=(o,d)=>(n,i)=>{const s=i().param.coline,e=i().helper.branches[d];for(const[t,r]of Object.entries(s))if(r.from===o&&e.includes(r.to)){const c=e.indexOf(o),p=e.indexOf(r.to);if(p>c)return[p-c+1,t]}else if(r.to===o&&e.includes(r.to)){const c=e.indexOf(o),p=e.indexOf(r.from);if(p>c)return[p-c+1,t]}return[0,void 0]},mn=(o,d)=>(n,i)=>{const s=i().param.stn_list,e=i().helper.branches;if(o===d)throw new Error("addColine():: failed for same stnId");const t=pn(e,s).filter(c=>[o,d].includes(c)),r=Ts(e,s).filter(c=>[o,d].every(p=>c.includes(p)));if(t.length===2&&r.length>0)throw new Error("addColine():: main check failed for ".concat(o,", ").concat(d));if(t.length!==2&&r.length!==1)throw new Error("addColine():: branch check failed for ".concat(o,", ").concat(d))},Bs=o=>(d,n)=>{const i=n().param.coline,e=n().helper.branches[o];return e?Object.entries(i).reduce((t,r)=>e.includes(r[1].from)&&e.includes(r[1].to)?{...t,[r[0]]:r[1]}:{...t},{}):{}},Ns=o=>(d,n)=>{const i=n().param.coline;if(Object.keys(i).length===0)return;const s=Object.entries(i).reduce((e,t)=>t[1].from!==o&&t[1].to!==o?{...e,[t[0]]:t[1]}:{...e},{});d(Fe(s))},Ms=(o,d,n,i=!0)=>(s,e)=>{const t=e().param.coline;s(mn(o,d)),s(Fe({...t,[qe(4)]:{from:o,to:d,colors:n,display:i}}))},Ds=(o,d,n,i=!0)=>(s,e)=>{const t=e().param.coline;if(o in t){s(mn(d,n));const r={...t,[o]:{...t[o],from:d,to:n,display:i}};s(Fe(r))}},Ls=(o,d)=>(n,i)=>{const s=i().param.coline;if(o in s&&s[o].colors.length>d){const e=s[o].colors.filter((t,r)=>r!==d);if(e.length===0){const{[o]:t,...r}=s;n(Fe(r))}else{const t={...s,[o]:{...s[o],colors:e}};n(Fe(t))}}},Fs=(o,d,n)=>(i,s)=>{const e=s().param.coline;if(o in e&&e[o].colors.length>d){const t={...e,[o]:{...e[o],colors:e[o].colors.map((r,c)=>c===d?[0,1,2,3,4,5].map(p=>n[p]===void 0?r[p]:n[p]):r)}};i(Fe(t))}};function Us(o){const{isOpen:d,onClose:n}=o,{t:i}=ce(),s=ue(),e=J(p=>p.app.selectedStation),[t,r]=X.useState(!1);X.useEffect(()=>{d||r(!1)},[d]);const c=()=>{const p=s(zs(e));p?(n(),s(Ue(De.CLOSE)),s(dn("linestart")),s(Ns(e)),s(Rs(e))):r(!0),le.event(xe.REMOVE_STATION,{success:p})};return y.jsxs(Ke,{isOpen:d,onClose:n,children:[y.jsx(Xe,{}),y.jsxs(Je,{children:[t&&y.jsxs(ut,{status:"error",variant:"solid",size:"xs",children:[y.jsx(ft,{}),i("Unable to remove this station.")]}),y.jsxs(ke,{position:"relative",children:[y.jsx(Qe,{children:i("Remove station")}),y.jsx(et,{})]}),y.jsx(tt,{children:i("Are you sure to remove station? You cannot undo this action.")}),y.jsxs(nt,{children:[y.jsx(de,{onClick:n,children:i("Cancel")}),y.jsx(de,{colorScheme:"primary",onClick:c,ml:3,children:i("Confirm")})]})]})]})}function Ws(){const{t:o}=ce(),d=ue(),n=J(e=>e.app.selectedStation),[i,s]=X.useState(!1);return y.jsxs(dr,{children:[y.jsxs(ze,{children:[y.jsx(de,{size:"sm",variant:"outline",onClick:()=>d(Ct(n)),children:o("StationSidePanel.footer.current")}),y.jsx(de,{size:"sm",variant:"outline",onClick:()=>s(!0),children:o("StationSidePanel.footer.remove")})]}),y.jsx(Us,{isOpen:i,onClose:()=>s(!1)})]})}function Zs(o){const{colineInfo:d,routeOptions:n,onUpdateRoute:i,onUpdateColourInfo:s,onDelete:e}=o,{t}=ce(),r=ue(),{paletteAppClipOutput:c}=J(l=>l.app),[p,v]=X.useState(!1);X.useEffect(()=>{p&&c&&(s==null||s([...c,d.colors[0][4],d.colors[0][5]]),v(!1))},[c==null?void 0:c.toString()]);const m=[{type:"select",label:"Route",value:[d.from,d.to].join(","),options:n,onChange:l=>i==null?void 0:i(l)}],h=[{type:"custom",label:t("Colour"),component:y.jsx(It,{theme:[d.colors[0][0],d.colors[0][1],d.colors[0][2],d.colors[0][3]],onClick:()=>{v(!0),r(Ot(d.colors[0].slice(0,4)))}})},{type:"input",label:t("Chinese name"),value:d.colors[0][4],minW:120,onChange:l=>s==null?void 0:s([d.colors[0][0],d.colors[0][1],d.colors[0][2],d.colors[0][3],l,d.colors[0][5]])},{type:"input",label:t("English name"),value:d.colors[0][5],minW:120,onChange:l=>s==null?void 0:s([d.colors[0][0],d.colors[0][1],d.colors[0][2],d.colors[0][3],d.colors[0][4],l])}];return y.jsxs(Me,{direction:"column",children:[y.jsx(be,{fields:m,minW:"full"}),y.jsxs(ze,{spacing:.5,children:[y.jsx(be,{fields:h}),y.jsx(Be,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>e==null?void 0:e(0),icon:y.jsx(zt,{})})]})]})}function Hs(){const{t:o}=ce(),d=ue(),n=J(h=>h.app.selectedBranch),{theme:i,stn_list:s}=J(h=>h.param),e=d(Bs(n)),t=d(Is(n)),r=h=>h.map(l=>s[l].localisedName.zh+"/"+s[l].localisedName.en).join(" ~ "),c=t.reduce((h,l)=>({...h,[l.join(",")]:r(l)}),{}),p=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(n," with default combination"),t[0]),d(Ms(t[0][0],t[0][1],[[i[0],"","#AAAAAA",ct.white,"",""]]))},v=h=>l=>{const[b,u]=l.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(h,", from=").concat(b,", to=").concat(u));try{d(Ds(h,b,u))}catch(_){d(jt({status:"error",message:"Unable to draw this share track."}))}},m=(h,l)=>{d(Ls(h,l))};return y.jsxs(Et,{align:"flex-start",p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("BranchSidePanel.coline.title")}),Object.entries(e).map(([h,l])=>y.jsx(Zs,{colineInfo:l,routeOptions:c,onUpdateRoute:v(h),onUpdateColourInfo:b=>d(Fs(h,0,b)),onDelete:b=>m(h,b)},h)),(n===0||Object.keys(e).length===0)&&y.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:y.jsx(Ie,{}),onClick:p,children:o("BranchSidePanel.coline.add")})]})}function Gs(o){const{isOpen:d,onClose:n}=o,{t:i}=ce(),s=ue(),e=J(j=>j.app.selectedBranch),{style:t,stn_list:r}=J(j=>j.param),c=J(j=>j.helper.branches),[p,v]=X.useState(e),[m,h]=X.useState("1"),[l,b]=X.useState("2"),[u,_]=X.useState("asc");X.useEffect(()=>{v(e)},[e]);const g=[{type:"select",label:i("AutoNumModal.where"),value:p,options:{...c.reduce((j,A,N)=>({...j,[N]:N===0?i("AutoNumModal.main"):t!==Q.SHMetro||!We(A,r)?i("AutoNumModal.branch")+" "+N:i("AutoNumModal.external")+" "+N}),{})},onChange:j=>v(j)},{type:"input",label:i("AutoNumModal.from"),value:m,validator:j=>!isNaN(Number(j)),onChange:h,debouncedDelay:0},{type:"input",label:i("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:l,onChange:b,debouncedDelay:0},{type:"select",label:i("AutoNumModal.sort"),value:u,options:{asc:i("AutoNumModal.asc"),desc:i("AutoNumModal.desc")},onChange:j=>_(j)}],x=()=>{s(gs(p,Number(m),Number(l),u)),n(),le.event(xe.AUTO_NUMBERING,{})},C=!m||!l||isNaN(Number(m))||isNaN(Number(l));return y.jsxs(Ke,{isOpen:d,onClose:n,children:[y.jsx(Xe,{}),y.jsxs(Je,{children:[y.jsx(Qe,{children:i("AutoNumModal.title")}),y.jsx(et,{}),y.jsx(tt,{children:y.jsx(be,{fields:g})}),y.jsx(nt,{children:y.jsx(de,{colorScheme:"primary",isDisabled:C,onClick:x,children:i("Confirm")})})]})]})}const Nt=o=>(d,n)=>{const s=n().helper.branches[o];return s.includes("linestart")||s.includes("lineend")?1:2},gn=o=>(d,n)=>{const{branches:i}=n().helper,s=i[0],e=i[o];return s.slice(s.indexOf(e[0])+1,s.indexOf(e.slice(-1)[0]))},Vs=(o,d)=>n=>n(Nt(d))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(gn(d)).includes(o)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Ys=(o,d)=>(n,i)=>{var c,p;if(!n(Vs(o,d)))return!1;const{branches:e}=i().helper,t=i().param.stn_list,r=e[d];if(r[0]==="linestart"){const v={...t,[r[1]]:{...t[r[1]],parents:[o]},[o]:{...t[o],children:t.linestart.children.map(m=>m===r[1]?m:t[o].children[0]),branch:{right:(c=t.linestart.branch)==null?void 0:c.right}},linestart:{...t.linestart,children:t.linestart.children.filter(m=>m!==r[1]),branch:{}}};return n(we(v)),!0}else{const v=r.slice(-2)[0],m={...t,[v]:{...t[v],children:[o]},[o]:{...t[o],parents:t.lineend.parents.map(h=>h===v?h:t[o].parents[0]),branch:{left:(p=t.lineend.branch)==null?void 0:p.left}},lineend:{...t.lineend,parents:t.lineend.parents.filter(h=>h!==v),branch:{}}};return n(we(m)),!0}},bn=o=>(d,n)=>{const{branches:i}=n().helper,s=n().param.stn_list,e=i[0],t=i[o];if(d(Nt(o))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const c=e.indexOf(t[0]),p=e.slice(0,c),v=e.indexOf(t.slice(-1)[0]),m=e.slice(v+1),h=p.every(b=>s[b].children.length<=1&&s[b].parents.length<=1),l=m.every(b=>s[b].children.length<=1&&s[b].parents.length<=1);return h?l?[ve.left,ve.right]:[ve.left]:l?[ve.right]:[]},$s=(o,d)=>(n,i)=>{var p,v;if(!n(bn(d)).includes(o))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:e}=i().helper,t=i().param.stn_list,r=e[0],c=e[d];if(o===ve.left){const m=c[0],h={...t,[c[1]]:{...t[c[1]],parents:["linestart"]},[m]:{...t[m],children:t[m].children.filter(l=>l!==c[1]),branch:{}},linestart:{...t.linestart,children:t[m].children.map(l=>l===c[1]?l:r[1]),branch:{right:(p=t[m].branch)==null?void 0:p.right}}};return n(we(h)),!0}else{const m=c.slice(-1)[0],h=c.slice(-2)[0],l={...t,[h]:{...t[h],children:["lineend"]},[m]:{...t[m],parents:t[m].parents.filter(b=>b!==h),branch:{}},lineend:{...t.lineend,parents:t[m].parents.map(b=>b===h?b:r.slice(-2)[0]),branch:{left:(v=t[m].branch)==null?void 0:v.left}}};return n(we(l)),!0}};function Qt(o){const{direction:d}=o,{t:n}=ce(),i=ue(),{branches:s}=J(O=>O.helper),e=J(O=>O.app.selectedBranch),{style:t,stn_list:r}=J(O=>O.param),[c,p]=X.useState(!1),[v,m]=X.useState(""),h=s[e].filter(O=>!["linestart","lineend"].includes(O)),l=d===ve.left?h[0]:h.slice(-1)[0],b=r[l],u=i(gn(e)),_=i(Nt(e)),g=i(bn(e)),x=_===1&&!s[0].includes(l),C=g.includes(d),j=u.reduce((O,M)=>{var z,L;return{...O,[M]:((z=r[M])==null?void 0:z.localisedName.zh)+"/"+((L=r[M])==null?void 0:L.localisedName.en)}},{"":n("Please select...")}),A=()=>{const O=i(Ys(v,e));O?p(!1):i(jt({status:"error",message:n("Unable to connect to main line.")})),le.event(xe.CONNECT_BRANCH,{style:t,success:O})},N=()=>{const O=i($s(d,e));O||i(jt({status:"error",message:n("Unable to disconnect from main line.")})),le.event(xe.DISCONNECT_BRANCH,{style:t,success:O})};return y.jsxs(Me,{direction:"column",children:[y.jsxs(Te,{alignItems:"center",children:[y.jsx(xt,{label:n("Station name"),flex:1,children:y.jsx(hr,{defaultValue:b.localisedName.zh+"/"+b.localisedName.en,isDisabled:!0})}),c?y.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>p(!1),children:n("Cancel")}):x?y.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>p(!0),children:n("Connect to main line")}):y.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:N,isDisabled:!C,children:n("Disconnect from main line")})]}),c&&y.jsxs(Te,{alignItems:"center",children:[y.jsx(xt,{label:n("Target station"),flex:1,children:y.jsx(ur,{defaultValue:v,options:j,disabledOptions:[""],onChange:({target:{value:O}})=>m(O)})}),y.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!v,children:n("Confirm")})]})]})}function qs(){const{t:o}=ce(),d=ue(),n=J(r=>r.param.style),i=J(r=>r.app.selectedBranch),[s,e]=X.useState(!1),t=()=>{d(Jr(n===Q.SHMetro)),le.event(xe.REVERSE_STATIONS,{style:n})};return y.jsxs(ke,{p:1,children:[y.jsx(Se,{as:"h5",size:"sm",children:o("BranchSidePanel.action.title")}),y.jsxs(Te,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[i!==0&&n!==Q.SHMetro&&y.jsxs(y.Fragment,{children:[y.jsx(Se,{as:"h6",size:"xs",children:o("Branch left end")}),y.jsx(Qt,{direction:ve.left}),y.jsx(Se,{as:"h6",size:"xs",children:o("Branch right end")}),y.jsx(Qt,{direction:ve.right})]}),n===Q.GZMTR&&y.jsx(de,{size:"sm",variant:"outline",leftIcon:y.jsx(fr,{}),alignSelf:"flex-end",onClick:()=>e(!0),children:o("BranchSidePanel.action.autoNum")}),y.jsx(de,{size:"sm",variant:"outline",leftIcon:y.jsx(pr,{}),alignSelf:"flex-end",onClick:t,children:n===Q.SHMetro?o("BranchSidePanel.action.flip"):o("BranchSidePanel.action.reverse")})]}),y.jsx(Gs,{isOpen:s,onClose:()=>e(!1)})]})}function Ks(){const o=J(s=>s.app.selectedBranch),{style:d,stn_list:n}=J(s=>s.param),i=J(s=>s.helper.branches);return y.jsxs(Rt,{children:[d===Q.SHMetro&&(o===0||We(i[o],n))&&y.jsxs(y.Fragment,{children:[y.jsx(Hs,{}),y.jsx(Ne,{})]}),y.jsx(qs,{})]})}const Xs="rmg-palette-bridge--",Js={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function Qs(o){const{isOpen:d,onClose:n,defaultTheme:i,onSelect:s}=o,[e]=X.useState(qe()),[t,r]=X.useState(!1),c="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:le.getAppName(),parentId:e}),p=X.useRef();return X.useEffect(()=>{const v=new BroadcastChannel(Xs+e);return p.current=v,v.onmessage=m=>{const{event:h,data:l}=m.data;console.log("[rmg] Received event from Palette app clip:",h),h==="CLOSE"?n():h==="SELECT"?s(l):h==="LOADED"&&r(!0)},()=>{v.close()}},[]),X.useEffect(()=>{var v;i&&((v=p.current)==null||v.postMessage({event:"OPEN",data:i}))},[t,i==null?void 0:i.toString()]),y.jsxs(hn,{size:"md",isOpen:d,onClose:n,sx:Js,children:[y.jsx(nn,{onClick:n}),y.jsx("iframe",{src:c,loading:"eager"})]})}const ei=410;function ti(){var c,p;const{t:o}=ce(),d=sn(),{sidePanelMode:n,selectedStation:i,paletteAppClipInput:s}=J(v=>v.app),e=J(v=>{var m;return(m=v.param.stn_list[i])==null?void 0:m.localisedName}),t={STATION:{header:y.jsx(Yr,{text:(e==null?void 0:e.zh)+"/"+(e==null?void 0:e.en)||""}),body:y.jsx(ws,{}),footer:y.jsx(Ws,{})},STYLE:{header:o("StyleSidePanel.header"),body:y.jsx(Os,{})},BRANCH:{header:o("BranchSidePanel.header"),body:y.jsx(Ks,{})},CLOSE:{header:"Close"}},r=()=>{d(Ue(De.CLOSE))};return y.jsxs(mr,{isOpen:n!==De.CLOSE,width:ei,header:"Dummy header",children:[y.jsx(gr,{onClose:r,children:t[n].header}),(c=t[n])==null?void 0:c.body,(p=t[n])==null?void 0:p.footer,y.jsx(Qs,{isOpen:!!s,onClose:()=>d(br()),defaultTheme:s,onSelect:v=>d(_r(v))})]})}function ot(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var en;function ni(){return en||(en=1,function(o,d){(function(n){o.exports=n()})(function(){return function n(i,s,e){function t(p,v){if(!s[p]){if(!i[p]){var m=typeof ot=="function"&&ot;if(!v&&m)return m(p,!0);if(r)return r(p,!0);var h=new Error("Cannot find module '"+p+"'");throw h.code="MODULE_NOT_FOUND",h}var l=s[p]={exports:{}};i[p][0].call(l.exports,function(b){var u=i[p][1][b];return t(u||b)},l,l.exports,n,i,s,e)}return s[p].exports}for(var r=typeof ot=="function"&&ot,c=0;c<e.length;c++)t(e[c]);return t}({1:[function(n,i,s){var e=n("./utils"),t=n("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(c){for(var p,v,m,h,l,b,u,_=[],g=0,x=c.length,C=x,j=e.getTypeOf(c)!=="string";g<c.length;)C=x-g,m=j?(p=c[g++],v=g<x?c[g++]:0,g<x?c[g++]:0):(p=c.charCodeAt(g++),v=g<x?c.charCodeAt(g++):0,g<x?c.charCodeAt(g++):0),h=p>>2,l=(3&p)<<4|v>>4,b=1<C?(15&v)<<2|m>>6:64,u=2<C?63&m:64,_.push(r.charAt(h)+r.charAt(l)+r.charAt(b)+r.charAt(u));return _.join("")},s.decode=function(c){var p,v,m,h,l,b,u=0,_=0,g="data:";if(c.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===r.charAt(64)&&C--,c.charAt(c.length-2)===r.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=t.uint8array?new Uint8Array(0|C):new Array(0|C);u<c.length;)p=r.indexOf(c.charAt(u++))<<2|(h=r.indexOf(c.charAt(u++)))>>4,v=(15&h)<<4|(l=r.indexOf(c.charAt(u++)))>>2,m=(3&l)<<6|(b=r.indexOf(c.charAt(u++))),x[_++]=p,l!==64&&(x[_++]=v),b!==64&&(x[_++]=m);return x}},{"./support":30,"./utils":32}],2:[function(n,i,s){var e=n("./external"),t=n("./stream/DataWorker"),r=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function p(v,m,h,l,b){this.compressedSize=v,this.uncompressedSize=m,this.crc32=h,this.compression=l,this.compressedContent=b}p.prototype={getContentWorker:function(){var v=new t(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),m=this;return v.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new t(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(v,m,h){return v.pipe(new r).pipe(new c("uncompressedSize")).pipe(m.compressWorker(h)).pipe(new c("compressedSize")).withStreamInfo("compression",m)},i.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,i,s){var e=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,i,s){var e=n("./utils"),t=function(){for(var r,c=[],p=0;p<256;p++){r=p;for(var v=0;v<8;v++)r=1&r?3988292384^r>>>1:r>>>1;c[p]=r}return c}();i.exports=function(r,c){return r!==void 0&&r.length?e.getTypeOf(r)!=="string"?function(p,v,m,h){var l=t,b=h+m;p^=-1;for(var u=h;u<b;u++)p=p>>>8^l[255&(p^v[u])];return-1^p}(0|c,r,r.length,0):function(p,v,m,h){var l=t,b=h+m;p^=-1;for(var u=h;u<b;u++)p=p>>>8^l[255&(p^v.charCodeAt(u))];return-1^p}(0|c,r,r.length,0):0}},{"./utils":32}],5:[function(n,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,i,s){var e=null;e=typeof Promise<"u"?Promise:n("lie"),i.exports={Promise:e}},{lie:37}],7:[function(n,i,s){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",t=n("pako"),r=n("./utils"),c=n("./stream/GenericWorker"),p=e?"uint8array":"array";function v(m,h){c.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=h,this.meta={}}s.magic="\b\0",r.inherits(v,c),v.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(p,m.data),!1)},v.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new t[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(h){m.push({data:h,meta:m.meta})}},s.compressWorker=function(m){return new v("Deflate",m)},s.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,i,s){function e(l,b){var u,_="";for(u=0;u<b;u++)_+=String.fromCharCode(255&l),l>>>=8;return _}function t(l,b,u,_,g,x){var C,j,A=l.file,N=l.compression,O=x!==p.utf8encode,M=r.transformTo("string",x(A.name)),z=r.transformTo("string",p.utf8encode(A.name)),L=A.comment,G=r.transformTo("string",x(L)),w=r.transformTo("string",p.utf8encode(L)),T=z.length!==A.name.length,f=w.length!==L.length,D="",ne="",Z="",se=A.dir,H=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};b&&!u||(re.crc32=l.crc32,re.compressedSize=l.compressedSize,re.uncompressedSize=l.uncompressedSize);var I=0;b&&(I|=8),O||!T&&!f||(I|=2048);var P=0,te=0;se&&(P|=16),g==="UNIX"?(te=798,P|=function($,fe){var ye=$;return $||(ye=fe?16893:33204),(65535&ye)<<16}(A.unixPermissions,se)):(te=20,P|=function($){return 63&($||0)}(A.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,j=H.getUTCFullYear()-1980,j<<=4,j|=H.getUTCMonth()+1,j<<=5,j|=H.getUTCDate(),T&&(ne=e(1,1)+e(v(M),4)+z,D+="up"+e(ne.length,2)+ne),f&&(Z=e(1,1)+e(v(G),4)+w,D+="uc"+e(Z.length,2)+Z);var q="";return q+="\n\0",q+=e(I,2),q+=N.magic,q+=e(C,2),q+=e(j,2),q+=e(re.crc32,4),q+=e(re.compressedSize,4),q+=e(re.uncompressedSize,4),q+=e(M.length,2),q+=e(D.length,2),{fileRecord:m.LOCAL_FILE_HEADER+q+M+D,dirRecord:m.CENTRAL_FILE_HEADER+e(te,2)+q+e(G.length,2)+"\0\0\0\0"+e(P,4)+e(_,4)+M+D+G}}var r=n("../utils"),c=n("../stream/GenericWorker"),p=n("../utf8"),v=n("../crc32"),m=n("../signature");function h(l,b,u,_){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=u,this.encodeFileName=_,this.streamFiles=l,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(h,c),h.prototype.push=function(l){var b=l.meta.percent||0,u=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(l):(this.bytesWritten+=l.data.length,c.prototype.push.call(this,{data:l.data,meta:{currentFile:this.currentFile,percent:u?(b+100*(u-_-1))/u:100}}))},h.prototype.openedSource=function(l){this.currentSourceOffset=this.bytesWritten,this.currentFile=l.file.name;var b=this.streamFiles&&!l.file.dir;if(b){var u=t(l,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:u.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(l){this.accumulate=!1;var b=this.streamFiles&&!l.file.dir,u=t(l,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(u.dirRecord),b)this.push({data:function(_){return m.DATA_DESCRIPTOR+e(_.crc32,4)+e(_.compressedSize,4)+e(_.uncompressedSize,4)}(l),meta:{percent:100}});else for(this.push({data:u.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var l=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var u=this.bytesWritten-l,_=function(g,x,C,j,A){var N=r.transformTo("string",A(j));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+e(g,2)+e(g,2)+e(x,4)+e(C,4)+e(N.length,2)+N}(this.dirRecords.length,u,l,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(l){this._sources.push(l);var b=this;return l.on("data",function(u){b.processChunk(u)}),l.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),l.on("error",function(u){b.error(u)}),this},h.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(l){var b=this._sources;if(!c.prototype.error.call(this,l))return!1;for(var u=0;u<b.length;u++)try{b[u].error(l)}catch(_){}return!0},h.prototype.lock=function(){c.prototype.lock.call(this);for(var l=this._sources,b=0;b<l.length;b++)l[b].lock()},i.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,i,s){var e=n("../compressions"),t=n("./ZipFileWorker");s.generateWorker=function(r,c,p){var v=new t(c.streamFiles,p,c.platform,c.encodeFileName),m=0;try{r.forEach(function(h,l){m++;var b=function(x,C){var j=x||C,A=e[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(l.options.compression,c.compression),u=l.options.compressionOptions||c.compressionOptions||{},_=l.dir,g=l.date;l._compressWorker(b,u).withStreamInfo("file",{name:h,dir:_,date:g,comment:l.comment||"",unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions}).pipe(v)}),v.entriesCount=m}catch(h){v.error(h)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,i,s){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new e;for(var r in this)typeof this[r]!="function"&&(t[r]=this[r]);return t}}(e.prototype=n("./object")).loadAsync=n("./load"),e.support=n("./support"),e.defaults=n("./defaults"),e.version="3.10.1",e.loadAsync=function(t,r){return new e().loadAsync(t,r)},e.external=n("./external"),i.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,i,s){var e=n("./utils"),t=n("./external"),r=n("./utf8"),c=n("./zipEntries"),p=n("./stream/Crc32Probe"),v=n("./nodejsUtils");function m(h){return new t.Promise(function(l,b){var u=h.decompressed.getContentWorker().pipe(new p);u.on("error",function(_){b(_)}).on("end",function(){u.streamInfo.crc32!==h.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):l()}).resume()})}i.exports=function(h,l){var b=this;return l=e.extend(l||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),v.isNode&&v.isStream(h)?t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",h,!0,l.optimizedBinaryString,l.base64).then(function(u){var _=new c(l);return _.load(u),_}).then(function(u){var _=[t.Promise.resolve(u)],g=u.files;if(l.checkCRC32)for(var x=0;x<g.length;x++)_.push(m(g[x]));return t.Promise.all(_)}).then(function(u){for(var _=u.shift(),g=_.files,x=0;x<g.length;x++){var C=g[x],j=C.fileNameStr,A=e.resolve(C.fileNameStr);b.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:l.createFolders}),C.dir||(b.file(A).unsafeOriginalName=j)}return _.zipComment.length&&(b.comment=_.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,i,s){var e=n("../utils"),t=n("../stream/GenericWorker");function r(c,p){t.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(p)}e.inherits(r,t),r.prototype._bindStream=function(c){var p=this;(this._stream=c).pause(),c.on("data",function(v){p.push({data:v,meta:{percent:0}})}).on("error",function(v){p.isPaused?this.generatedError=v:p.error(v)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},r.prototype.pause=function(){return!!t.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,i,s){var e=n("readable-stream").Readable;function t(r,c,p){e.call(this,c),this._helper=r;var v=this;r.on("data",function(m,h){v.push(m)||v._helper.pause(),p&&p(h)}).on("error",function(m){v.emit("error",m)}).on("end",function(){v.push(null)})}n("../utils").inherits(t,e),t.prototype._read=function(){this._helper.resume()},i.exports=t},{"../utils":32,"readable-stream":16}],14:[function(n,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}},{}],15:[function(n,i,s){function e(A,N,O){var M,z=r.getTypeOf(N),L=r.extend(O||{},v);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(A=g(A)),L.createFolders&&(M=_(A))&&x.call(this,M,!0);var G=z==="string"&&L.binary===!1&&L.base64===!1;O&&O.binary!==void 0||(L.binary=!G),(N instanceof m&&N.uncompressedSize===0||L.dir||!N||N.length===0)&&(L.base64=!1,L.binary=!0,N="",L.compression="STORE",z="string");var w=null;w=N instanceof m||N instanceof c?N:b.isNode&&b.isStream(N)?new u(A,N):r.prepareContent(A,N,L.binary,L.optimizedBinaryString,L.base64);var T=new h(A,w,L);this.files[A]=T}var t=n("./utf8"),r=n("./utils"),c=n("./stream/GenericWorker"),p=n("./stream/StreamHelper"),v=n("./defaults"),m=n("./compressedObject"),h=n("./zipObject"),l=n("./generate"),b=n("./nodejsUtils"),u=n("./nodejs/NodejsStreamInputAdapter"),_=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var N=A.lastIndexOf("/");return 0<N?A.substring(0,N):""},g=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,N){return N=N!==void 0?N:v.createFolders,A=g(A),this.files[A]||e.call(this,A,null,{dir:!0,createFolders:N}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var N,O,M;for(N in this.files)M=this.files[N],(O=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&A(O,M)},filter:function(A){var N=[];return this.forEach(function(O,M){A(O,M)&&N.push(M)}),N},file:function(A,N,O){if(arguments.length!==1)return A=this.root+A,e.call(this,A,N,O),this;if(C(A)){var M=A;return this.filter(function(L,G){return!G.dir&&M.test(L)})}var z=this.files[this.root+A];return z&&!z.dir?z:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(z,L){return L.dir&&A.test(z)});var N=this.root+A,O=x.call(this,N),M=this.clone();return M.root=O.name,M},remove:function(A){A=this.root+A;var N=this.files[A];if(N||(A.slice(-1)!=="/"&&(A+="/"),N=this.files[A]),N&&!N.dir)delete this.files[A];else for(var O=this.filter(function(z,L){return L.name.slice(0,A.length)===A}),M=0;M<O.length;M++)delete this.files[O[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var N,O={};try{if((O=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:t.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");r.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var M=O.comment||this.comment||"";N=l.generateWorker(this,O,M)}catch(z){(N=new c("error")).error(z)}return new p(N,O.type||"string",O.mimeType)},generateAsync:function(A,N){return this.generateInternalStream(A).accumulate(N)},generateNodeStream:function(A,N){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(N)}};i.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,i,s){i.exports=n("stream")},{stream:void 0}],17:[function(n,i,s){var e=n("./DataReader");function t(r){e.call(this,r);for(var c=0;c<this.data.length;c++)r[c]=255&r[c]}n("../utils").inherits(t,e),t.prototype.byteAt=function(r){return this.data[this.zero+r]},t.prototype.lastIndexOfSignature=function(r){for(var c=r.charCodeAt(0),p=r.charCodeAt(1),v=r.charCodeAt(2),m=r.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===c&&this.data[h+1]===p&&this.data[h+2]===v&&this.data[h+3]===m)return h-this.zero;return-1},t.prototype.readAndCheckSignature=function(r){var c=r.charCodeAt(0),p=r.charCodeAt(1),v=r.charCodeAt(2),m=r.charCodeAt(3),h=this.readData(4);return c===h[0]&&p===h[1]&&v===h[2]&&m===h[3]},t.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},i.exports=t},{"../utils":32,"./DataReader":18}],18:[function(n,i,s){var e=n("../utils");function t(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}t.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var c,p=0;for(this.checkOffset(r),c=this.index+r-1;c>=this.index;c--)p=(p<<8)+this.byteAt(c);return this.index+=r,p},readString:function(r){return e.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},i.exports=t},{"../utils":32}],19:[function(n,i,s){var e=n("./Uint8ArrayReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.readData=function(r){this.checkOffset(r);var c=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},i.exports=t},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,i,s){var e=n("./DataReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},t.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},t.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},t.prototype.readData=function(r){this.checkOffset(r);var c=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},i.exports=t},{"../utils":32,"./DataReader":18}],21:[function(n,i,s){var e=n("./ArrayReader");function t(r){e.call(this,r)}n("../utils").inherits(t,e),t.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},i.exports=t},{"../utils":32,"./ArrayReader":17}],22:[function(n,i,s){var e=n("../utils"),t=n("../support"),r=n("./ArrayReader"),c=n("./StringReader"),p=n("./NodeBufferReader"),v=n("./Uint8ArrayReader");i.exports=function(m){var h=e.getTypeOf(m);return e.checkSupport(h),h!=="string"||t.uint8array?h==="nodebuffer"?new p(m):t.uint8array?new v(e.transformTo("uint8array",m)):new r(e.transformTo("array",m)):new c(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,i,s){var e=n("./GenericWorker"),t=n("../utils");function r(c){e.call(this,"ConvertWorker to "+c),this.destType=c}t.inherits(r,e),r.prototype.processChunk=function(c){this.push({data:t.transformTo(this.destType,c.data),meta:c.meta})},i.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(n,i,s){var e=n("./GenericWorker"),t=n("../crc32");function r(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(r,e),r.prototype.processChunk=function(c){this.streamInfo.crc32=t(c.data,this.streamInfo.crc32||0),this.push(c)},i.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,i,s){var e=n("../utils"),t=n("./GenericWorker");function r(c){t.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}e.inherits(r,t),r.prototype.processChunk=function(c){if(c){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+c.data.length}t.prototype.processChunk.call(this,c)},i.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(n,i,s){var e=n("../utils"),t=n("./GenericWorker");function r(c){t.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(v){p.dataIsReady=!0,p.data=v,p.max=v&&v.length||0,p.type=e.getTypeOf(v),p.isPaused||p._tickAndRepeat()},function(v){p.error(v)})}e.inherits(r,t),r.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,p);break;case"uint8array":c=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":c=this.data.slice(this.index,p)}return this.index=p,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(n,i,s){function e(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}e.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,r){return this._listeners[t].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,r){if(this._listeners[t])for(var c=0;c<this._listeners[t].length;c++)this._listeners[t][c].call(this,r)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var r=this;return t.on("data",function(c){r.processChunk(c)}),t.on("end",function(){r.end()}),t.on("error",function(c){r.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,r){return this.extraStreamInfo[t]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},i.exports=e},{}],29:[function(n,i,s){var e=n("../utils"),t=n("./ConvertWorker"),r=n("./GenericWorker"),c=n("../base64"),p=n("../support"),v=n("../external"),m=null;if(p.nodestream)try{m=n("../nodejs/NodejsStreamOutputAdapter")}catch(b){}function h(b,u){return new v.Promise(function(_,g){var x=[],C=b._internalType,j=b._outputType,A=b._mimeType;b.on("data",function(N,O){x.push(N),u&&u(O)}).on("error",function(N){x=[],g(N)}).on("end",function(){try{var N=function(O,M,z){switch(O){case"blob":return e.newBlob(e.transformTo("arraybuffer",M),z);case"base64":return c.encode(M);default:return e.transformTo(O,M)}}(j,function(O,M){var z,L=0,G=null,w=0;for(z=0;z<M.length;z++)w+=M[z].length;switch(O){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(G=new Uint8Array(w),z=0;z<M.length;z++)G.set(M[z],L),L+=M[z].length;return G;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+O+"'")}}(C,x),A);_(N)}catch(O){g(O)}x=[]}).resume()})}function l(b,u,_){var g=u;switch(u){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=u,this._mimeType=_,e.checkSupport(g),this._worker=b.pipe(new t(g)),b.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}l.prototype={accumulate:function(b){return h(this,b)},on:function(b,u){var _=this;return b==="data"?this._worker.on(b,function(g){u.call(_,g.data,g.meta)}):this._worker.on(b,function(){e.delay(u,arguments,_)}),this},resume:function(){return e.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(e.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},b)}},i.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var e=new ArrayBuffer(0);try{s.blob=new Blob([e],{type:"application/zip"}).size===0}catch(r){try{var t=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);t.append(e),s.blob=t.getBlob("application/zip").size===0}catch(c){s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch(r){s.nodestream=!1}},{"readable-stream":16}],31:[function(n,i,s){for(var e=n("./utils"),t=n("./support"),r=n("./nodejsUtils"),c=n("./stream/GenericWorker"),p=new Array(256),v=0;v<256;v++)p[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;p[254]=p[254]=1;function m(){c.call(this,"utf-8 decode"),this.leftOver=null}function h(){c.call(this,"utf-8 encode")}s.utf8encode=function(l){return t.nodebuffer?r.newBufferFrom(l,"utf-8"):function(b){var u,_,g,x,C,j=b.length,A=0;for(x=0;x<j;x++)(64512&(_=b.charCodeAt(x)))==55296&&x+1<j&&(64512&(g=b.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(g-56320),x++),A+=_<128?1:_<2048?2:_<65536?3:4;for(u=t.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(_=b.charCodeAt(x)))==55296&&x+1<j&&(64512&(g=b.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(g-56320),x++),_<128?u[C++]=_:(_<2048?u[C++]=192|_>>>6:(_<65536?u[C++]=224|_>>>12:(u[C++]=240|_>>>18,u[C++]=128|_>>>12&63),u[C++]=128|_>>>6&63),u[C++]=128|63&_);return u}(l)},s.utf8decode=function(l){return t.nodebuffer?e.transformTo("nodebuffer",l).toString("utf-8"):function(b){var u,_,g,x,C=b.length,j=new Array(2*C);for(u=_=0;u<C;)if((g=b[u++])<128)j[_++]=g;else if(4<(x=p[g]))j[_++]=65533,u+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&u<C;)g=g<<6|63&b[u++],x--;1<x?j[_++]=65533:g<65536?j[_++]=g:(g-=65536,j[_++]=55296|g>>10&1023,j[_++]=56320|1023&g)}return j.length!==_&&(j.subarray?j=j.subarray(0,_):j.length=_),e.applyFromCharCode(j)}(l=e.transformTo(t.uint8array?"uint8array":"array",l))},e.inherits(m,c),m.prototype.processChunk=function(l){var b=e.transformTo(t.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(t.uint8array){var u=b;(b=new Uint8Array(u.length+this.leftOver.length)).set(this.leftOver,0),b.set(u,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var _=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+p[x[j]]>C?j:C}(b),g=b;_!==b.length&&(t.uint8array?(g=b.subarray(0,_),this.leftOver=b.subarray(_,b.length)):(g=b.slice(0,_),this.leftOver=b.slice(_,b.length))),this.push({data:s.utf8decode(g),meta:l.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=m,e.inherits(h,c),h.prototype.processChunk=function(l){this.push({data:s.utf8encode(l.data),meta:l.meta})},s.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,i,s){var e=n("./support"),t=n("./base64"),r=n("./nodejsUtils"),c=n("./external");function p(u){return u}function v(u,_){for(var g=0;g<u.length;++g)_[g]=255&u.charCodeAt(g);return _}n("setimmediate"),s.newBlob=function(u,_){s.checkSupport("blob");try{return new Blob([u],{type:_})}catch(x){try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(u),g.getBlob(_)}catch(C){throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(u,_,g){var x=[],C=0,j=u.length;if(j<=g)return String.fromCharCode.apply(null,u);for(;C<j;)_==="array"||_==="nodebuffer"?x.push(String.fromCharCode.apply(null,u.slice(C,Math.min(C+g,j)))):x.push(String.fromCharCode.apply(null,u.subarray(C,Math.min(C+g,j)))),C+=g;return x.join("")},stringifyByChar:function(u){for(var _="",g=0;g<u.length;g++)_+=String.fromCharCode(u[g]);return _},applyCanBeUsed:{uint8array:function(){try{return e.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(u){return!1}}(),nodebuffer:function(){try{return e.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch(u){return!1}}()}};function h(u){var _=65536,g=s.getTypeOf(u),x=!0;if(g==="uint8array"?x=m.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=m.applyCanBeUsed.nodebuffer),x)for(;1<_;)try{return m.stringifyByChunk(u,g,_)}catch(C){_=Math.floor(_/2)}return m.stringifyByChar(u)}function l(u,_){for(var g=0;g<u.length;g++)_[g]=u[g];return _}s.applyFromCharCode=h;var b={};b.string={string:p,array:function(u){return v(u,new Array(u.length))},arraybuffer:function(u){return b.string.uint8array(u).buffer},uint8array:function(u){return v(u,new Uint8Array(u.length))},nodebuffer:function(u){return v(u,r.allocBuffer(u.length))}},b.array={string:h,array:p,arraybuffer:function(u){return new Uint8Array(u).buffer},uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return r.newBufferFrom(u)}},b.arraybuffer={string:function(u){return h(new Uint8Array(u))},array:function(u){return l(new Uint8Array(u),new Array(u.byteLength))},arraybuffer:p,uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return r.newBufferFrom(new Uint8Array(u))}},b.uint8array={string:h,array:function(u){return l(u,new Array(u.length))},arraybuffer:function(u){return u.buffer},uint8array:p,nodebuffer:function(u){return r.newBufferFrom(u)}},b.nodebuffer={string:h,array:function(u){return l(u,new Array(u.length))},arraybuffer:function(u){return b.nodebuffer.uint8array(u).buffer},uint8array:function(u){return l(u,new Uint8Array(u.length))},nodebuffer:p},s.transformTo=function(u,_){if(_=_||"",!u)return _;s.checkSupport(u);var g=s.getTypeOf(_);return b[g][u](_)},s.resolve=function(u){for(var _=u.split("/"),g=[],x=0;x<_.length;x++){var C=_[x];C==="."||C===""&&x!==0&&x!==_.length-1||(C===".."?g.pop():g.push(C))}return g.join("/")},s.getTypeOf=function(u){return typeof u=="string"?"string":Object.prototype.toString.call(u)==="[object Array]"?"array":e.nodebuffer&&r.isBuffer(u)?"nodebuffer":e.uint8array&&u instanceof Uint8Array?"uint8array":e.arraybuffer&&u instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(u){if(!e[u.toLowerCase()])throw new Error(u+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(u){var _,g,x="";for(g=0;g<(u||"").length;g++)x+="\\x"+((_=u.charCodeAt(g))<16?"0":"")+_.toString(16).toUpperCase();return x},s.delay=function(u,_,g){setImmediate(function(){u.apply(g||null,_||[])})},s.inherits=function(u,_){function g(){}g.prototype=_.prototype,u.prototype=new g},s.extend=function(){var u,_,g={};for(u=0;u<arguments.length;u++)for(_ in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],_)&&g[_]===void 0&&(g[_]=arguments[u][_]);return g},s.prepareContent=function(u,_,g,x,C){return c.Promise.resolve(_).then(function(j){return e.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new c.Promise(function(A,N){var O=new FileReader;O.onload=function(M){A(M.target.result)},O.onerror=function(M){N(M.target.error)},O.readAsArrayBuffer(j)}):j}).then(function(j){var A=s.getTypeOf(j);return A?(A==="arraybuffer"?j=s.transformTo("uint8array",j):A==="string"&&(C?j=t.decode(j):g&&x!==!0&&(j=function(N){return v(N,e.uint8array?new Uint8Array(N.length):new Array(N.length))}(j))),j):c.Promise.reject(new Error("Can't read the data of '"+u+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,i,s){var e=n("./reader/readerFor"),t=n("./utils"),r=n("./signature"),c=n("./zipEntry"),p=n("./support");function v(m){this.files=[],this.loadOptions=m}v.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+t.pretty(h)+", expected "+t.pretty(m)+")")}},isSignature:function(m,h){var l=this.reader.index;this.reader.setIndex(m);var b=this.reader.readString(4)===h;return this.reader.setIndex(l),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),h=p.uint8array?"uint8array":"array",l=t.transformTo(h,m);this.zipComment=this.loadOptions.decodeFileName(l)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,h,l,b=this.zip64EndOfCentralSize-44;0<b;)m=this.reader.readInt(2),h=this.reader.readInt(4),l=this.reader.readData(h),this.zip64ExtensibleData[m]={id:m,length:h,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,h;for(m=0;m<this.files.length;m++)h=this.files[m],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(m=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var h=m;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var l=this.centralDirOffset+this.centralDirSize;this.zip64&&(l+=20,l+=12+this.zip64EndOfCentralSize);var b=h-l;if(0<b)this.isSignature(h,r.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(m){this.reader=e(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,i,s){var e=n("./reader/readerFor"),t=n("./utils"),r=n("./compressedObject"),c=n("./crc32"),p=n("./utf8"),v=n("./compressions"),m=n("./support");function h(l,b){this.options=l,this.loadOptions=b}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(l){var b,u;if(l.skip(22),this.fileNameLength=l.readInt(2),u=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(_){for(var g in v)if(Object.prototype.hasOwnProperty.call(v,g)&&v[g].magic===_)return v[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+t.pretty(this.compressionMethod)+" unknown (inner file : "+t.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,b,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var b=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(b),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),l==0&&(this.dosPermissions=63&this.externalFileAttributes),l==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var l=e(this.extraFields[1].value);this.uncompressedSize===t.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===t.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===t.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===t.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4))}},readExtraFields:function(l){var b,u,_,g=l.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});l.index+4<g;)b=l.readInt(2),u=l.readInt(2),_=l.readData(u),this.extraFields[b]={id:b,length:u,value:_};l.setIndex(g)},handleUTF8:function(){var l=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var u=t.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var g=t.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var b=e(l.value);return b.readInt(1)!==1||c(this.fileName)!==b.readInt(4)?null:p.utf8decode(b.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var b=e(l.value);return b.readInt(1)!==1||c(this.fileComment)!==b.readInt(4)?null:p.utf8decode(b.readData(l.length-5))}return null}},i.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,i,s){function e(b,u,_){this.name=b,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=u,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var t=n("./stream/StreamHelper"),r=n("./stream/DataWorker"),c=n("./utf8"),p=n("./compressedObject"),v=n("./stream/GenericWorker");e.prototype={internalStream:function(b){var u=null,_="string";try{if(!b)throw new Error("No output type specified.");var g=(_=b.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),u=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(u=u.pipe(new c.Utf8EncodeWorker)),!x&&g&&(u=u.pipe(new c.Utf8DecodeWorker))}catch(C){(u=new v("error")).error(C)}return new t(u,_,"")},async:function(b,u){return this.internalStream(b).accumulate(u)},nodeStream:function(b,u){return this.internalStream(b||"nodebuffer").toNodejsStream(u)},_compressWorker:function(b,u){if(this._data instanceof p&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new c.Utf8EncodeWorker)),p.createWorkerFrom(_,b,u)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof v?this._data:new r(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<m.length;l++)e.prototype[m[l]]=h;i.exports=e},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,i,s){(function(e){var t,r,c=e.MutationObserver||e.WebKitMutationObserver;if(c){var p=0,v=new c(b),m=e.document.createTextNode("");v.observe(m,{characterData:!0}),t=function(){m.data=p=++p%2}}else if(e.setImmediate||e.MessageChannel===void 0)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var u=e.document.createElement("script");u.onreadystatechange=function(){b(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},e.document.documentElement.appendChild(u)}:function(){setTimeout(b,0)};else{var h=new e.MessageChannel;h.port1.onmessage=b,t=function(){h.port2.postMessage(0)}}var l=[];function b(){var u,_;r=!0;for(var g=l.length;g;){for(_=l,l=[],u=-1;++u<g;)_[u]();g=l.length}r=!1}i.exports=function(u){l.push(u)!==1||r||t()}}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,i,s){var e=n("immediate");function t(){}var r={},c=["REJECTED"],p=["FULFILLED"],v=["PENDING"];function m(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,g!==t&&u(this,g)}function h(g,x,C){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function l(g,x,C){e(function(){var j;try{j=x(C)}catch(A){return r.reject(g,A)}j===g?r.reject(g,new TypeError("Cannot resolve promise with itself")):r.resolve(g,j)})}function b(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function u(g,x){var C=!1;function j(O){C||(C=!0,r.reject(g,O))}function A(O){C||(C=!0,r.resolve(g,O))}var N=_(function(){x(A,j)});N.status==="error"&&j(N.value)}function _(g,x){var C={};try{C.value=g(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(i.exports=m).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(g()).then(function(){return C})},function(C){return x.resolve(g()).then(function(){throw C})})},m.prototype.catch=function(g){return this.then(null,g)},m.prototype.then=function(g,x){if(typeof g!="function"&&this.state===p||typeof x!="function"&&this.state===c)return this;var C=new this.constructor(t);return this.state!==v?l(C,this.state===p?g:x,this.outcome):this.queue.push(new h(C,g,x)),C},h.prototype.callFulfilled=function(g){r.resolve(this.promise,g)},h.prototype.otherCallFulfilled=function(g){l(this.promise,this.onFulfilled,g)},h.prototype.callRejected=function(g){r.reject(this.promise,g)},h.prototype.otherCallRejected=function(g){l(this.promise,this.onRejected,g)},r.resolve=function(g,x){var C=_(b,x);if(C.status==="error")return r.reject(g,C.value);var j=C.value;if(j)u(g,j);else{g.state=p,g.outcome=x;for(var A=-1,N=g.queue.length;++A<N;)g.queue[A].callFulfilled(x)}return g},r.reject=function(g,x){g.state=c,g.outcome=x;for(var C=-1,j=g.queue.length;++C<j;)g.queue[C].callRejected(x);return g},m.resolve=function(g){return g instanceof this?g:r.resolve(new this(t),g)},m.reject=function(g){var x=new this(t);return r.reject(x,g)},m.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=g.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),N=0,O=-1,M=new this(t);++O<C;)z(g[O],O);return M;function z(L,G){x.resolve(L).then(function(w){A[G]=w,++N!==C||j||(j=!0,r.resolve(M,A))},function(w){j||(j=!0,r.reject(M,w))})}},m.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=g.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,N=new this(t);++A<C;)O=g[A],x.resolve(O).then(function(M){j||(j=!0,r.resolve(N,M))},function(M){j||(j=!0,r.reject(N,M))});var O;return N}},{immediate:36}],38:[function(n,i,s){var e={};(0,n("./lib/utils/common").assign)(e,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),i.exports=e},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,i,s){var e=n("./zlib/deflate"),t=n("./utils/common"),r=n("./utils/strings"),c=n("./zlib/messages"),p=n("./zlib/zstream"),v=Object.prototype.toString,m=0,h=-1,l=0,b=8;function u(g){if(!(this instanceof u))return new u(g);this.options=t.assign({level:h,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=e.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==m)throw new Error(c[C]);if(x.header&&e.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?r.string2buf(x.dictionary):v.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=e.deflateSetDictionary(this.strm,j))!==m)throw new Error(c[C]);this._dict_set=!0}}function _(g,x){var C=new u(x);if(C.push(g,!0),C.err)throw C.msg||c[C.err];return C.result}u.prototype.push=function(g,x){var C,j,A=this.strm,N=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof g=="string"?A.input=r.string2buf(g):v.call(g)==="[object ArrayBuffer]"?A.input=new Uint8Array(g):A.input=g,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new t.Buf8(N),A.next_out=0,A.avail_out=N),(C=e.deflate(A,j))!==1&&C!==m)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(t.shrinkBuf(A.output,A.next_out))):this.onData(t.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=e.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===m):j!==2||(this.onEnd(m),!(A.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Deflate=u,s.deflate=_,s.deflateRaw=function(g,x){return(x=x||{}).raw=!0,_(g,x)},s.gzip=function(g,x){return(x=x||{}).gzip=!0,_(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,i,s){var e=n("./zlib/inflate"),t=n("./utils/common"),r=n("./utils/strings"),c=n("./zlib/constants"),p=n("./zlib/messages"),v=n("./zlib/zstream"),m=n("./zlib/gzheader"),h=Object.prototype.toString;function l(u){if(!(this instanceof l))return new l(u);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},u||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||u&&u.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&!(15&_.windowBits)&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var g=e.inflateInit2(this.strm,_.windowBits);if(g!==c.Z_OK)throw new Error(p[g]);this.header=new m,e.inflateGetHeader(this.strm,this.header)}function b(u,_){var g=new l(_);if(g.push(u,!0),g.err)throw g.msg||p[g.err];return g.result}l.prototype.push=function(u,_){var g,x,C,j,A,N,O=this.strm,M=this.options.chunkSize,z=this.options.dictionary,L=!1;if(this.ended)return!1;x=_===~~_?_:_===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof u=="string"?O.input=r.binstring2buf(u):h.call(u)==="[object ArrayBuffer]"?O.input=new Uint8Array(u):O.input=u,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new t.Buf8(M),O.next_out=0,O.avail_out=M),(g=e.inflate(O,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&z&&(N=typeof z=="string"?r.string2buf(z):h.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,g=e.inflateSetDictionary(this.strm,N)),g===c.Z_BUF_ERROR&&L===!0&&(g=c.Z_OK,L=!1),g!==c.Z_STREAM_END&&g!==c.Z_OK)return this.onEnd(g),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&g!==c.Z_STREAM_END&&(O.avail_in!==0||x!==c.Z_FINISH&&x!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=r.utf8border(O.output,O.next_out),j=O.next_out-C,A=r.buf2string(O.output,C),O.next_out=j,O.avail_out=M-j,j&&t.arraySet(O.output,O.output,C,j,0),this.onData(A)):this.onData(t.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(L=!0)}while((0<O.avail_in||O.avail_out===0)&&g!==c.Z_STREAM_END);return g===c.Z_STREAM_END&&(x=c.Z_FINISH),x===c.Z_FINISH?(g=e.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===c.Z_OK):x!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(O.avail_out=0))},l.prototype.onData=function(u){this.chunks.push(u)},l.prototype.onEnd=function(u){u===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},s.Inflate=l,s.inflate=b,s.inflateRaw=function(u,_){return(_=_||{}).raw=!0,b(u,_)},s.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,i,s){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(c){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var v=p.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var m in v)v.hasOwnProperty(m)&&(c[m]=v[m])}}return c},s.shrinkBuf=function(c,p){return c.length===p?c:c.subarray?c.subarray(0,p):(c.length=p,c)};var t={arraySet:function(c,p,v,m,h){if(p.subarray&&c.subarray)c.set(p.subarray(v,v+m),h);else for(var l=0;l<m;l++)c[h+l]=p[v+l]},flattenChunks:function(c){var p,v,m,h,l,b;for(p=m=0,v=c.length;p<v;p++)m+=c[p].length;for(b=new Uint8Array(m),p=h=0,v=c.length;p<v;p++)l=c[p],b.set(l,h),h+=l.length;return b}},r={arraySet:function(c,p,v,m,h){for(var l=0;l<m;l++)c[h+l]=p[v+l]},flattenChunks:function(c){return[].concat.apply([],c)}};s.setTyped=function(c){c?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,t)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,r))},s.setTyped(e)},{}],42:[function(n,i,s){var e=n("./common"),t=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(m){t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(m){r=!1}for(var c=new e.Buf8(256),p=0;p<256;p++)c[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function v(m,h){if(h<65537&&(m.subarray&&r||!m.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(m,h));for(var l="",b=0;b<h;b++)l+=String.fromCharCode(m[b]);return l}c[254]=c[254]=1,s.string2buf=function(m){var h,l,b,u,_,g=m.length,x=0;for(u=0;u<g;u++)(64512&(l=m.charCodeAt(u)))==55296&&u+1<g&&(64512&(b=m.charCodeAt(u+1)))==56320&&(l=65536+(l-55296<<10)+(b-56320),u++),x+=l<128?1:l<2048?2:l<65536?3:4;for(h=new e.Buf8(x),u=_=0;_<x;u++)(64512&(l=m.charCodeAt(u)))==55296&&u+1<g&&(64512&(b=m.charCodeAt(u+1)))==56320&&(l=65536+(l-55296<<10)+(b-56320),u++),l<128?h[_++]=l:(l<2048?h[_++]=192|l>>>6:(l<65536?h[_++]=224|l>>>12:(h[_++]=240|l>>>18,h[_++]=128|l>>>12&63),h[_++]=128|l>>>6&63),h[_++]=128|63&l);return h},s.buf2binstring=function(m){return v(m,m.length)},s.binstring2buf=function(m){for(var h=new e.Buf8(m.length),l=0,b=h.length;l<b;l++)h[l]=m.charCodeAt(l);return h},s.buf2string=function(m,h){var l,b,u,_,g=h||m.length,x=new Array(2*g);for(l=b=0;l<g;)if((u=m[l++])<128)x[b++]=u;else if(4<(_=c[u]))x[b++]=65533,l+=_-1;else{for(u&=_===2?31:_===3?15:7;1<_&&l<g;)u=u<<6|63&m[l++],_--;1<_?x[b++]=65533:u<65536?x[b++]=u:(u-=65536,x[b++]=55296|u>>10&1023,x[b++]=56320|1023&u)}return v(x,b)},s.utf8border=function(m,h){var l;for((h=h||m.length)>m.length&&(h=m.length),l=h-1;0<=l&&(192&m[l])==128;)l--;return l<0||l===0?h:l+c[m[l]]>h?l:h}},{"./common":41}],43:[function(n,i,s){i.exports=function(e,t,r,c){for(var p=65535&e|0,v=e>>>16&65535|0,m=0;r!==0;){for(r-=m=2e3<r?2e3:r;v=v+(p=p+t[c++]|0)|0,--m;);p%=65521,v%=65521}return p|v<<16|0}},{}],44:[function(n,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,i,s){var e=function(){for(var t,r=[],c=0;c<256;c++){t=c;for(var p=0;p<8;p++)t=1&t?3988292384^t>>>1:t>>>1;r[c]=t}return r}();i.exports=function(t,r,c,p){var v=e,m=p+c;t^=-1;for(var h=p;h<m;h++)t=t>>>8^v[255&(t^r[h])];return-1^t}},{}],46:[function(n,i,s){var e,t=n("../utils/common"),r=n("./trees"),c=n("./adler32"),p=n("./crc32"),v=n("./messages"),m=0,h=4,l=0,b=-2,u=-1,_=4,g=2,x=8,C=9,j=286,A=30,N=19,O=2*j+1,M=15,z=3,L=258,G=L+z+1,w=42,T=113,f=1,D=2,ne=3,Z=4;function se(a,F){return a.msg=v[F],F}function H(a){return(a<<1)-(4<a?9:0)}function re(a){for(var F=a.length;0<=--F;)a[F]=0}function I(a){var F=a.state,B=F.pending;B>a.avail_out&&(B=a.avail_out),B!==0&&(t.arraySet(a.output,F.pending_buf,F.pending_out,B,a.next_out),a.next_out+=B,F.pending_out+=B,a.total_out+=B,a.avail_out-=B,F.pending-=B,F.pending===0&&(F.pending_out=0))}function P(a,F){r._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,F),a.block_start=a.strstart,I(a.strm)}function te(a,F){a.pending_buf[a.pending++]=F}function q(a,F){a.pending_buf[a.pending++]=F>>>8&255,a.pending_buf[a.pending++]=255&F}function $(a,F){var B,k,S=a.max_chain_length,E=a.strstart,U=a.prev_length,W=a.nice_match,R=a.strstart>a.w_size-G?a.strstart-(a.w_size-G):0,V=a.window,K=a.w_mask,Y=a.prev,ee=a.strstart+L,he=V[E+U-1],ae=V[E+U];a.prev_length>=a.good_match&&(S>>=2),W>a.lookahead&&(W=a.lookahead);do if(V[(B=F)+U]===ae&&V[B+U-1]===he&&V[B]===V[E]&&V[++B]===V[E+1]){E+=2,B++;do;while(V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&E<ee);if(k=L-(ee-E),E=ee-L,U<k){if(a.match_start=F,W<=(U=k))break;he=V[E+U-1],ae=V[E+U]}}while((F=Y[F&K])>R&&--S!=0);return U<=a.lookahead?U:a.lookahead}function fe(a){var F,B,k,S,E,U,W,R,V,K,Y=a.w_size;do{if(S=a.window_size-a.lookahead-a.strstart,a.strstart>=Y+(Y-G)){for(t.arraySet(a.window,a.window,Y,Y,0),a.match_start-=Y,a.strstart-=Y,a.block_start-=Y,F=B=a.hash_size;k=a.head[--F],a.head[F]=Y<=k?k-Y:0,--B;);for(F=B=Y;k=a.prev[--F],a.prev[F]=Y<=k?k-Y:0,--B;);S+=Y}if(a.strm.avail_in===0)break;if(U=a.strm,W=a.window,R=a.strstart+a.lookahead,V=S,K=void 0,K=U.avail_in,V<K&&(K=V),B=K===0?0:(U.avail_in-=K,t.arraySet(W,U.input,U.next_in,K,R),U.state.wrap===1?U.adler=c(U.adler,W,K,R):U.state.wrap===2&&(U.adler=p(U.adler,W,K,R)),U.next_in+=K,U.total_in+=K,K),a.lookahead+=B,a.lookahead+a.insert>=z)for(E=a.strstart-a.insert,a.ins_h=a.window[E],a.ins_h=(a.ins_h<<a.hash_shift^a.window[E+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[E+z-1])&a.hash_mask,a.prev[E&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=E,E++,a.insert--,!(a.lookahead+a.insert<z)););}while(a.lookahead<G&&a.strm.avail_in!==0)}function ye(a,F){for(var B,k;;){if(a.lookahead<G){if(fe(a),a.lookahead<G&&F===m)return f;if(a.lookahead===0)break}if(B=0,a.lookahead>=z&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),B!==0&&a.strstart-B<=a.w_size-G&&(a.match_length=$(a,B)),a.match_length>=z)if(k=r._tr_tally(a,a.strstart-a.match_start,a.match_length-z),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=z){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else k=r._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(k&&(P(a,!1),a.strm.avail_out===0))return f}return a.insert=a.strstart<z-1?a.strstart:z-1,F===h?(P(a,!0),a.strm.avail_out===0?ne:Z):a.last_lit&&(P(a,!1),a.strm.avail_out===0)?f:D}function ie(a,F){for(var B,k,S;;){if(a.lookahead<G){if(fe(a),a.lookahead<G&&F===m)return f;if(a.lookahead===0)break}if(B=0,a.lookahead>=z&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=z-1,B!==0&&a.prev_length<a.max_lazy_match&&a.strstart-B<=a.w_size-G&&(a.match_length=$(a,B),a.match_length<=5&&(a.strategy===1||a.match_length===z&&4096<a.strstart-a.match_start)&&(a.match_length=z-1)),a.prev_length>=z&&a.match_length<=a.prev_length){for(S=a.strstart+a.lookahead-z,k=r._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-z),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=S&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=z-1,a.strstart++,k&&(P(a,!1),a.strm.avail_out===0))return f}else if(a.match_available){if((k=r._tr_tally(a,0,a.window[a.strstart-1]))&&P(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return f}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(k=r._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<z-1?a.strstart:z-1,F===h?(P(a,!0),a.strm.avail_out===0?ne:Z):a.last_lit&&(P(a,!1),a.strm.avail_out===0)?f:D}function oe(a,F,B,k,S){this.good_length=a,this.max_lazy=F,this.nice_length=B,this.max_chain=k,this.func=S}function ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*O),this.dyn_dtree=new t.Buf16(2*(2*A+1)),this.bl_tree=new t.Buf16(2*(2*N+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(M+1),this.heap=new t.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(a){var F;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=g,(F=a.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?w:T,a.adler=F.wrap===2?0:1,F.last_flush=m,r._tr_init(F),l):se(a,b)}function Ae(a){var F=pe(a);return F===l&&function(B){B.window_size=2*B.w_size,re(B.head),B.max_lazy_match=e[B.level].max_lazy,B.good_match=e[B.level].good_length,B.nice_match=e[B.level].nice_length,B.max_chain_length=e[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=z-1,B.match_available=0,B.ins_h=0}(a.state),F}function je(a,F,B,k,S,E){if(!a)return b;var U=1;if(F===u&&(F=6),k<0?(U=0,k=-k):15<k&&(U=2,k-=16),S<1||C<S||B!==x||k<8||15<k||F<0||9<F||E<0||_<E)return se(a,b);k===8&&(k=9);var W=new ge;return(a.state=W).strm=a,W.wrap=U,W.gzhead=null,W.w_bits=k,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+z-1)/z),W.window=new t.Buf8(2*W.w_size),W.head=new t.Buf16(W.hash_size),W.prev=new t.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new t.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=F,W.strategy=E,W.method=B,Ae(a)}e=[new oe(0,0,0,0,function(a,F){var B=65535;for(B>a.pending_buf_size-5&&(B=a.pending_buf_size-5);;){if(a.lookahead<=1){if(fe(a),a.lookahead===0&&F===m)return f;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var k=a.block_start+B;if((a.strstart===0||a.strstart>=k)&&(a.lookahead=a.strstart-k,a.strstart=k,P(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-G&&(P(a,!1),a.strm.avail_out===0))return f}return a.insert=0,F===h?(P(a,!0),a.strm.avail_out===0?ne:Z):(a.strstart>a.block_start&&(P(a,!1),a.strm.avail_out),f)}),new oe(4,4,8,4,ye),new oe(4,5,16,8,ye),new oe(4,6,32,32,ye),new oe(4,4,16,16,ie),new oe(8,16,32,32,ie),new oe(8,16,128,128,ie),new oe(8,32,128,256,ie),new oe(32,128,258,1024,ie),new oe(32,258,258,4096,ie)],s.deflateInit=function(a,F){return je(a,F,x,15,8,0)},s.deflateInit2=je,s.deflateReset=Ae,s.deflateResetKeep=pe,s.deflateSetHeader=function(a,F){return a&&a.state?a.state.wrap!==2?b:(a.state.gzhead=F,l):b},s.deflate=function(a,F){var B,k,S,E;if(!a||!a.state||5<F||F<0)return a?se(a,b):b;if(k=a.state,!a.output||!a.input&&a.avail_in!==0||k.status===666&&F!==h)return se(a,a.avail_out===0?-5:b);if(k.strm=a,B=k.last_flush,k.last_flush=F,k.status===w)if(k.wrap===2)a.adler=0,te(k,31),te(k,139),te(k,8),k.gzhead?(te(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),te(k,255&k.gzhead.time),te(k,k.gzhead.time>>8&255),te(k,k.gzhead.time>>16&255),te(k,k.gzhead.time>>24&255),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(te(k,255&k.gzhead.extra.length),te(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(a.adler=p(a.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(te(k,0),te(k,0),te(k,0),te(k,0),te(k,0),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,3),k.status=T);else{var U=x+(k.w_bits-8<<4)<<8;U|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(U|=32),U+=31-U%31,k.status=T,q(k,U),k.strstart!==0&&(q(k,a.adler>>>16),q(k,65535&a.adler)),a.adler=1}if(k.status===69)if(k.gzhead.extra){for(S=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>S&&(a.adler=p(a.adler,k.pending_buf,k.pending-S,S)),I(a),S=k.pending,k.pending!==k.pending_buf_size));)te(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>S&&(a.adler=p(a.adler,k.pending_buf,k.pending-S,S)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){S=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>S&&(a.adler=p(a.adler,k.pending_buf,k.pending-S,S)),I(a),S=k.pending,k.pending===k.pending_buf_size)){E=1;break}E=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,te(k,E)}while(E!==0);k.gzhead.hcrc&&k.pending>S&&(a.adler=p(a.adler,k.pending_buf,k.pending-S,S)),E===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){S=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>S&&(a.adler=p(a.adler,k.pending_buf,k.pending-S,S)),I(a),S=k.pending,k.pending===k.pending_buf_size)){E=1;break}E=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,te(k,E)}while(E!==0);k.gzhead.hcrc&&k.pending>S&&(a.adler=p(a.adler,k.pending_buf,k.pending-S,S)),E===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&I(a),k.pending+2<=k.pending_buf_size&&(te(k,255&a.adler),te(k,a.adler>>8&255),a.adler=0,k.status=T)):k.status=T),k.pending!==0){if(I(a),a.avail_out===0)return k.last_flush=-1,l}else if(a.avail_in===0&&H(F)<=H(B)&&F!==h)return se(a,-5);if(k.status===666&&a.avail_in!==0)return se(a,-5);if(a.avail_in!==0||k.lookahead!==0||F!==m&&k.status!==666){var W=k.strategy===2?function(R,V){for(var K;;){if(R.lookahead===0&&(fe(R),R.lookahead===0)){if(V===m)return f;break}if(R.match_length=0,K=r._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,K&&(P(R,!1),R.strm.avail_out===0))return f}return R.insert=0,V===h?(P(R,!0),R.strm.avail_out===0?ne:Z):R.last_lit&&(P(R,!1),R.strm.avail_out===0)?f:D}(k,F):k.strategy===3?function(R,V){for(var K,Y,ee,he,ae=R.window;;){if(R.lookahead<=L){if(fe(R),R.lookahead<=L&&V===m)return f;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=z&&0<R.strstart&&(Y=ae[ee=R.strstart-1])===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]){he=R.strstart+L;do;while(Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&Y===ae[++ee]&&ee<he);R.match_length=L-(he-ee),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=z?(K=r._tr_tally(R,1,R.match_length-z),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(K=r._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),K&&(P(R,!1),R.strm.avail_out===0))return f}return R.insert=0,V===h?(P(R,!0),R.strm.avail_out===0?ne:Z):R.last_lit&&(P(R,!1),R.strm.avail_out===0)?f:D}(k,F):e[k.level].func(k,F);if(W!==ne&&W!==Z||(k.status=666),W===f||W===ne)return a.avail_out===0&&(k.last_flush=-1),l;if(W===D&&(F===1?r._tr_align(k):F!==5&&(r._tr_stored_block(k,0,0,!1),F===3&&(re(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),I(a),a.avail_out===0))return k.last_flush=-1,l}return F!==h?l:k.wrap<=0?1:(k.wrap===2?(te(k,255&a.adler),te(k,a.adler>>8&255),te(k,a.adler>>16&255),te(k,a.adler>>24&255),te(k,255&a.total_in),te(k,a.total_in>>8&255),te(k,a.total_in>>16&255),te(k,a.total_in>>24&255)):(q(k,a.adler>>>16),q(k,65535&a.adler)),I(a),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?l:1)},s.deflateEnd=function(a){var F;return a&&a.state?(F=a.state.status)!==w&&F!==69&&F!==73&&F!==91&&F!==103&&F!==T&&F!==666?se(a,b):(a.state=null,F===T?se(a,-3):l):b},s.deflateSetDictionary=function(a,F){var B,k,S,E,U,W,R,V,K=F.length;if(!a||!a.state||(E=(B=a.state).wrap)===2||E===1&&B.status!==w||B.lookahead)return b;for(E===1&&(a.adler=c(a.adler,F,K,0)),B.wrap=0,K>=B.w_size&&(E===0&&(re(B.head),B.strstart=0,B.block_start=0,B.insert=0),V=new t.Buf8(B.w_size),t.arraySet(V,F,K-B.w_size,B.w_size,0),F=V,K=B.w_size),U=a.avail_in,W=a.next_in,R=a.input,a.avail_in=K,a.next_in=0,a.input=F,fe(B);B.lookahead>=z;){for(k=B.strstart,S=B.lookahead-(z-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[k+z-1])&B.hash_mask,B.prev[k&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=k,k++,--S;);B.strstart=k,B.lookahead=z-1,fe(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=z-1,B.match_available=0,a.next_in=W,a.input=R,a.avail_in=U,B.wrap=E,l},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,i,s){i.exports=function(e,t){var r,c,p,v,m,h,l,b,u,_,g,x,C,j,A,N,O,M,z,L,G,w,T,f,D;r=e.state,c=e.next_in,f=e.input,p=c+(e.avail_in-5),v=e.next_out,D=e.output,m=v-(t-e.avail_out),h=v+(e.avail_out-257),l=r.dmax,b=r.wsize,u=r.whave,_=r.wnext,g=r.window,x=r.hold,C=r.bits,j=r.lencode,A=r.distcode,N=(1<<r.lenbits)-1,O=(1<<r.distbits)-1;e:do{C<15&&(x+=f[c++]<<C,C+=8,x+=f[c++]<<C,C+=8),M=j[x&N];t:for(;;){if(x>>>=z=M>>>24,C-=z,(z=M>>>16&255)===0)D[v++]=65535&M;else{if(!(16&z)){if(!(64&z)){M=j[(65535&M)+(x&(1<<z)-1)];continue t}if(32&z){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}L=65535&M,(z&=15)&&(C<z&&(x+=f[c++]<<C,C+=8),L+=x&(1<<z)-1,x>>>=z,C-=z),C<15&&(x+=f[c++]<<C,C+=8,x+=f[c++]<<C,C+=8),M=A[x&O];n:for(;;){if(x>>>=z=M>>>24,C-=z,!(16&(z=M>>>16&255))){if(!(64&z)){M=A[(65535&M)+(x&(1<<z)-1)];continue n}e.msg="invalid distance code",r.mode=30;break e}if(G=65535&M,C<(z&=15)&&(x+=f[c++]<<C,(C+=8)<z&&(x+=f[c++]<<C,C+=8)),l<(G+=x&(1<<z)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=z,C-=z,(z=v-m)<G){if(u<(z=G-z)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(T=g,(w=0)===_){if(w+=b-z,z<L){for(L-=z;D[v++]=g[w++],--z;);w=v-G,T=D}}else if(_<z){if(w+=b+_-z,(z-=_)<L){for(L-=z;D[v++]=g[w++],--z;);if(w=0,_<L){for(L-=z=_;D[v++]=g[w++],--z;);w=v-G,T=D}}}else if(w+=_-z,z<L){for(L-=z;D[v++]=g[w++],--z;);w=v-G,T=D}for(;2<L;)D[v++]=T[w++],D[v++]=T[w++],D[v++]=T[w++],L-=3;L&&(D[v++]=T[w++],1<L&&(D[v++]=T[w++]))}else{for(w=v-G;D[v++]=D[w++],D[v++]=D[w++],D[v++]=D[w++],2<(L-=3););L&&(D[v++]=D[w++],1<L&&(D[v++]=D[w++]))}break}}break}}while(c<p&&v<h);c-=L=C>>3,x&=(1<<(C-=L<<3))-1,e.next_in=c,e.next_out=v,e.avail_in=c<p?p-c+5:5-(c-p),e.avail_out=v<h?h-v+257:257-(v-h),r.hold=x,r.bits=C}},{}],49:[function(n,i,s){var e=n("../utils/common"),t=n("./adler32"),r=n("./crc32"),c=n("./inffast"),p=n("./inftrees"),v=1,m=2,h=0,l=-2,b=1,u=852,_=592;function g(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(w){var T;return w&&w.state?(T=w.state,w.total_in=w.total_out=T.total=0,w.msg="",T.wrap&&(w.adler=1&T.wrap),T.mode=b,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new e.Buf32(u),T.distcode=T.distdyn=new e.Buf32(_),T.sane=1,T.back=-1,h):l}function j(w){var T;return w&&w.state?((T=w.state).wsize=0,T.whave=0,T.wnext=0,C(w)):l}function A(w,T){var f,D;return w&&w.state?(D=w.state,T<0?(f=0,T=-T):(f=1+(T>>4),T<48&&(T&=15)),T&&(T<8||15<T)?l:(D.window!==null&&D.wbits!==T&&(D.window=null),D.wrap=f,D.wbits=T,j(w))):l}function N(w,T){var f,D;return w?(D=new x,(w.state=D).window=null,(f=A(w,T))!==h&&(w.state=null),f):l}var O,M,z=!0;function L(w){if(z){var T;for(O=new e.Buf32(512),M=new e.Buf32(32),T=0;T<144;)w.lens[T++]=8;for(;T<256;)w.lens[T++]=9;for(;T<280;)w.lens[T++]=7;for(;T<288;)w.lens[T++]=8;for(p(v,w.lens,0,288,O,0,w.work,{bits:9}),T=0;T<32;)w.lens[T++]=5;p(m,w.lens,0,32,M,0,w.work,{bits:5}),z=!1}w.lencode=O,w.lenbits=9,w.distcode=M,w.distbits=5}function G(w,T,f,D){var ne,Z=w.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new e.Buf8(Z.wsize)),D>=Z.wsize?(e.arraySet(Z.window,T,f-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(D<(ne=Z.wsize-Z.wnext)&&(ne=D),e.arraySet(Z.window,T,f-D,ne,Z.wnext),(D-=ne)?(e.arraySet(Z.window,T,f-D,D,0),Z.wnext=D,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}s.inflateReset=j,s.inflateReset2=A,s.inflateResetKeep=C,s.inflateInit=function(w){return N(w,15)},s.inflateInit2=N,s.inflate=function(w,T){var f,D,ne,Z,se,H,re,I,P,te,q,$,fe,ye,ie,oe,ge,pe,Ae,je,a,F,B,k,S=0,E=new e.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return l;(f=w.state).mode===12&&(f.mode=13),se=w.next_out,ne=w.output,re=w.avail_out,Z=w.next_in,D=w.input,H=w.avail_in,I=f.hold,P=f.bits,te=H,q=re,F=h;e:for(;;)switch(f.mode){case b:if(f.wrap===0){f.mode=13;break}for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(2&f.wrap&&I===35615){E[f.check=0]=255&I,E[1]=I>>>8&255,f.check=r(f.check,E,2,0),P=I=0,f.mode=2;break}if(f.flags=0,f.head&&(f.head.done=!1),!(1&f.wrap)||(((255&I)<<8)+(I>>8))%31){w.msg="incorrect header check",f.mode=30;break}if((15&I)!=8){w.msg="unknown compression method",f.mode=30;break}if(P-=4,a=8+(15&(I>>>=4)),f.wbits===0)f.wbits=a;else if(a>f.wbits){w.msg="invalid window size",f.mode=30;break}f.dmax=1<<a,w.adler=f.check=1,f.mode=512&I?10:12,P=I=0;break;case 2:for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(f.flags=I,(255&f.flags)!=8){w.msg="unknown compression method",f.mode=30;break}if(57344&f.flags){w.msg="unknown header flags set",f.mode=30;break}f.head&&(f.head.text=I>>8&1),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,f.check=r(f.check,E,2,0)),P=I=0,f.mode=3;case 3:for(;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}f.head&&(f.head.time=I),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,E[2]=I>>>16&255,E[3]=I>>>24&255,f.check=r(f.check,E,4,0)),P=I=0,f.mode=4;case 4:for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}f.head&&(f.head.xflags=255&I,f.head.os=I>>8),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,f.check=r(f.check,E,2,0)),P=I=0,f.mode=5;case 5:if(1024&f.flags){for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}f.length=I,f.head&&(f.head.extra_len=I),512&f.flags&&(E[0]=255&I,E[1]=I>>>8&255,f.check=r(f.check,E,2,0)),P=I=0}else f.head&&(f.head.extra=null);f.mode=6;case 6:if(1024&f.flags&&(H<($=f.length)&&($=H),$&&(f.head&&(a=f.head.extra_len-f.length,f.head.extra||(f.head.extra=new Array(f.head.extra_len)),e.arraySet(f.head.extra,D,Z,$,a)),512&f.flags&&(f.check=r(f.check,D,$,Z)),H-=$,Z+=$,f.length-=$),f.length))break e;f.length=0,f.mode=7;case 7:if(2048&f.flags){if(H===0)break e;for($=0;a=D[Z+$++],f.head&&a&&f.length<65536&&(f.head.name+=String.fromCharCode(a)),a&&$<H;);if(512&f.flags&&(f.check=r(f.check,D,$,Z)),H-=$,Z+=$,a)break e}else f.head&&(f.head.name=null);f.length=0,f.mode=8;case 8:if(4096&f.flags){if(H===0)break e;for($=0;a=D[Z+$++],f.head&&a&&f.length<65536&&(f.head.comment+=String.fromCharCode(a)),a&&$<H;);if(512&f.flags&&(f.check=r(f.check,D,$,Z)),H-=$,Z+=$,a)break e}else f.head&&(f.head.comment=null);f.mode=9;case 9:if(512&f.flags){for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(I!==(65535&f.check)){w.msg="header crc mismatch",f.mode=30;break}P=I=0}f.head&&(f.head.hcrc=f.flags>>9&1,f.head.done=!0),w.adler=f.check=0,f.mode=12;break;case 10:for(;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}w.adler=f.check=g(I),P=I=0,f.mode=11;case 11:if(f.havedict===0)return w.next_out=se,w.avail_out=re,w.next_in=Z,w.avail_in=H,f.hold=I,f.bits=P,2;w.adler=f.check=1,f.mode=12;case 12:if(T===5||T===6)break e;case 13:if(f.last){I>>>=7&P,P-=7&P,f.mode=27;break}for(;P<3;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}switch(f.last=1&I,P-=1,3&(I>>>=1)){case 0:f.mode=14;break;case 1:if(L(f),f.mode=20,T!==6)break;I>>>=2,P-=2;break e;case 2:f.mode=17;break;case 3:w.msg="invalid block type",f.mode=30}I>>>=2,P-=2;break;case 14:for(I>>>=7&P,P-=7&P;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if((65535&I)!=(I>>>16^65535)){w.msg="invalid stored block lengths",f.mode=30;break}if(f.length=65535&I,P=I=0,f.mode=15,T===6)break e;case 15:f.mode=16;case 16:if($=f.length){if(H<$&&($=H),re<$&&($=re),$===0)break e;e.arraySet(ne,D,Z,$,se),H-=$,Z+=$,re-=$,se+=$,f.length-=$;break}f.mode=12;break;case 17:for(;P<14;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(f.nlen=257+(31&I),I>>>=5,P-=5,f.ndist=1+(31&I),I>>>=5,P-=5,f.ncode=4+(15&I),I>>>=4,P-=4,286<f.nlen||30<f.ndist){w.msg="too many length or distance symbols",f.mode=30;break}f.have=0,f.mode=18;case 18:for(;f.have<f.ncode;){for(;P<3;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}f.lens[U[f.have++]]=7&I,I>>>=3,P-=3}for(;f.have<19;)f.lens[U[f.have++]]=0;if(f.lencode=f.lendyn,f.lenbits=7,B={bits:f.lenbits},F=p(0,f.lens,0,19,f.lencode,0,f.work,B),f.lenbits=B.bits,F){w.msg="invalid code lengths set",f.mode=30;break}f.have=0,f.mode=19;case 19:for(;f.have<f.nlen+f.ndist;){for(;oe=(S=f.lencode[I&(1<<f.lenbits)-1])>>>16&255,ge=65535&S,!((ie=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(ge<16)I>>>=ie,P-=ie,f.lens[f.have++]=ge;else{if(ge===16){for(k=ie+2;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(I>>>=ie,P-=ie,f.have===0){w.msg="invalid bit length repeat",f.mode=30;break}a=f.lens[f.have-1],$=3+(3&I),I>>>=2,P-=2}else if(ge===17){for(k=ie+3;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}P-=ie,a=0,$=3+(7&(I>>>=ie)),I>>>=3,P-=3}else{for(k=ie+7;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}P-=ie,a=0,$=11+(127&(I>>>=ie)),I>>>=7,P-=7}if(f.have+$>f.nlen+f.ndist){w.msg="invalid bit length repeat",f.mode=30;break}for(;$--;)f.lens[f.have++]=a}}if(f.mode===30)break;if(f.lens[256]===0){w.msg="invalid code -- missing end-of-block",f.mode=30;break}if(f.lenbits=9,B={bits:f.lenbits},F=p(v,f.lens,0,f.nlen,f.lencode,0,f.work,B),f.lenbits=B.bits,F){w.msg="invalid literal/lengths set",f.mode=30;break}if(f.distbits=6,f.distcode=f.distdyn,B={bits:f.distbits},F=p(m,f.lens,f.nlen,f.ndist,f.distcode,0,f.work,B),f.distbits=B.bits,F){w.msg="invalid distances set",f.mode=30;break}if(f.mode=20,T===6)break e;case 20:f.mode=21;case 21:if(6<=H&&258<=re){w.next_out=se,w.avail_out=re,w.next_in=Z,w.avail_in=H,f.hold=I,f.bits=P,c(w,q),se=w.next_out,ne=w.output,re=w.avail_out,Z=w.next_in,D=w.input,H=w.avail_in,I=f.hold,P=f.bits,f.mode===12&&(f.back=-1);break}for(f.back=0;oe=(S=f.lencode[I&(1<<f.lenbits)-1])>>>16&255,ge=65535&S,!((ie=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(oe&&!(240&oe)){for(pe=ie,Ae=oe,je=ge;oe=(S=f.lencode[je+((I&(1<<pe+Ae)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(ie=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}I>>>=pe,P-=pe,f.back+=pe}if(I>>>=ie,P-=ie,f.back+=ie,f.length=ge,oe===0){f.mode=26;break}if(32&oe){f.back=-1,f.mode=12;break}if(64&oe){w.msg="invalid literal/length code",f.mode=30;break}f.extra=15&oe,f.mode=22;case 22:if(f.extra){for(k=f.extra;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}f.length+=I&(1<<f.extra)-1,I>>>=f.extra,P-=f.extra,f.back+=f.extra}f.was=f.length,f.mode=23;case 23:for(;oe=(S=f.distcode[I&(1<<f.distbits)-1])>>>16&255,ge=65535&S,!((ie=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(!(240&oe)){for(pe=ie,Ae=oe,je=ge;oe=(S=f.distcode[je+((I&(1<<pe+Ae)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(ie=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}I>>>=pe,P-=pe,f.back+=pe}if(I>>>=ie,P-=ie,f.back+=ie,64&oe){w.msg="invalid distance code",f.mode=30;break}f.offset=ge,f.extra=15&oe,f.mode=24;case 24:if(f.extra){for(k=f.extra;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}f.offset+=I&(1<<f.extra)-1,I>>>=f.extra,P-=f.extra,f.back+=f.extra}if(f.offset>f.dmax){w.msg="invalid distance too far back",f.mode=30;break}f.mode=25;case 25:if(re===0)break e;if($=q-re,f.offset>$){if(($=f.offset-$)>f.whave&&f.sane){w.msg="invalid distance too far back",f.mode=30;break}fe=$>f.wnext?($-=f.wnext,f.wsize-$):f.wnext-$,$>f.length&&($=f.length),ye=f.window}else ye=ne,fe=se-f.offset,$=f.length;for(re<$&&($=re),re-=$,f.length-=$;ne[se++]=ye[fe++],--$;);f.length===0&&(f.mode=21);break;case 26:if(re===0)break e;ne[se++]=f.length,re--,f.mode=21;break;case 27:if(f.wrap){for(;P<32;){if(H===0)break e;H--,I|=D[Z++]<<P,P+=8}if(q-=re,w.total_out+=q,f.total+=q,q&&(w.adler=f.check=f.flags?r(f.check,ne,q,se-q):t(f.check,ne,q,se-q)),q=re,(f.flags?I:g(I))!==f.check){w.msg="incorrect data check",f.mode=30;break}P=I=0}f.mode=28;case 28:if(f.wrap&&f.flags){for(;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(I!==(4294967295&f.total)){w.msg="incorrect length check",f.mode=30;break}P=I=0}f.mode=29;case 29:F=1;break e;case 30:F=-3;break e;case 31:return-4;case 32:default:return l}return w.next_out=se,w.avail_out=re,w.next_in=Z,w.avail_in=H,f.hold=I,f.bits=P,(f.wsize||q!==w.avail_out&&f.mode<30&&(f.mode<27||T!==4))&&G(w,w.output,w.next_out,q-w.avail_out)?(f.mode=31,-4):(te-=w.avail_in,q-=w.avail_out,w.total_in+=te,w.total_out+=q,f.total+=q,f.wrap&&q&&(w.adler=f.check=f.flags?r(f.check,ne,q,w.next_out-q):t(f.check,ne,q,w.next_out-q)),w.data_type=f.bits+(f.last?64:0)+(f.mode===12?128:0)+(f.mode===20||f.mode===15?256:0),(te==0&&q===0||T===4)&&F===h&&(F=-5),F)},s.inflateEnd=function(w){if(!w||!w.state)return l;var T=w.state;return T.window&&(T.window=null),w.state=null,h},s.inflateGetHeader=function(w,T){var f;return w&&w.state&&2&(f=w.state).wrap?((f.head=T).done=!1,h):l},s.inflateSetDictionary=function(w,T){var f,D=T.length;return w&&w.state?(f=w.state).wrap!==0&&f.mode!==11?l:f.mode===11&&t(1,T,D,0)!==f.check?-3:G(w,T,D,D)?(f.mode=31,-4):(f.havedict=1,h):l},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,i,s){var e=n("../utils/common"),t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(v,m,h,l,b,u,_,g){var x,C,j,A,N,O,M,z,L,G=g.bits,w=0,T=0,f=0,D=0,ne=0,Z=0,se=0,H=0,re=0,I=0,P=null,te=0,q=new e.Buf16(16),$=new e.Buf16(16),fe=null,ye=0;for(w=0;w<=15;w++)q[w]=0;for(T=0;T<l;T++)q[m[h+T]]++;for(ne=G,D=15;1<=D&&q[D]===0;D--);if(D<ne&&(ne=D),D===0)return b[u++]=20971520,b[u++]=20971520,g.bits=1,0;for(f=1;f<D&&q[f]===0;f++);for(ne<f&&(ne=f),w=H=1;w<=15;w++)if(H<<=1,(H-=q[w])<0)return-1;if(0<H&&(v===0||D!==1))return-1;for($[1]=0,w=1;w<15;w++)$[w+1]=$[w]+q[w];for(T=0;T<l;T++)m[h+T]!==0&&(_[$[m[h+T]]++]=T);if(O=v===0?(P=fe=_,19):v===1?(P=t,te-=257,fe=r,ye-=257,256):(P=c,fe=p,-1),w=f,N=u,se=T=I=0,j=-1,A=(re=1<<(Z=ne))-1,v===1&&852<re||v===2&&592<re)return 1;for(;;){for(M=w-se,L=_[T]<O?(z=0,_[T]):_[T]>O?(z=fe[ye+_[T]],P[te+_[T]]):(z=96,0),x=1<<w-se,f=C=1<<Z;b[N+(I>>se)+(C-=x)]=M<<24|z<<16|L|0,C!==0;);for(x=1<<w-1;I&x;)x>>=1;if(x!==0?(I&=x-1,I+=x):I=0,T++,--q[w]==0){if(w===D)break;w=m[h+_[T]]}if(ne<w&&(I&A)!==j){for(se===0&&(se=ne),N+=f,H=1<<(Z=w-se);Z+se<D&&!((H-=q[Z+se])<=0);)Z++,H<<=1;if(re+=1<<Z,v===1&&852<re||v===2&&592<re)return 1;b[j=I&A]=ne<<24|Z<<16|N-u|0}}return I!==0&&(b[N+I]=w-se<<24|64<<16|0),g.bits=ne,0}},{"../utils/common":41}],51:[function(n,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,i,s){var e=n("../utils/common"),t=0,r=1;function c(S){for(var E=S.length;0<=--E;)S[E]=0}var p=0,v=29,m=256,h=m+1+v,l=30,b=19,u=2*h+1,_=15,g=16,x=7,C=256,j=16,A=17,N=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(h+2));c(G);var w=new Array(2*l);c(w);var T=new Array(512);c(T);var f=new Array(256);c(f);var D=new Array(v);c(D);var ne,Z,se,H=new Array(l);function re(S,E,U,W,R){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=R,this.has_stree=S&&S.length}function I(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function P(S){return S<256?T[S]:T[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,U){S.bi_valid>g-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>g-S.bi_valid,S.bi_valid+=U-g):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function $(S,E,U){q(S,U[2*E],U[2*E+1])}function fe(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function ye(S,E,U){var W,R,V=new Array(_+1),K=0;for(W=1;W<=_;W++)V[W]=K=K+U[W-1]<<1;for(R=0;R<=E;R++){var Y=S[2*R+1];Y!==0&&(S[2*R]=fe(V[Y]++,Y))}}function ie(S){var E;for(E=0;E<h;E++)S.dyn_ltree[2*E]=0;for(E=0;E<l;E++)S.dyn_dtree[2*E]=0;for(E=0;E<b;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function oe(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ge(S,E,U,W){var R=2*E,V=2*U;return S[R]<S[V]||S[R]===S[V]&&W[E]<=W[U]}function pe(S,E,U){for(var W=S.heap[U],R=U<<1;R<=S.heap_len&&(R<S.heap_len&&ge(E,S.heap[R+1],S.heap[R],S.depth)&&R++,!ge(E,W,S.heap[R],S.depth));)S.heap[U]=S.heap[R],U=R,R<<=1;S.heap[U]=W}function Ae(S,E,U){var W,R,V,K,Y=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*Y]<<8|S.pending_buf[S.d_buf+2*Y+1],R=S.pending_buf[S.l_buf+Y],Y++,W===0?$(S,R,E):($(S,(V=f[R])+m+1,E),(K=O[V])!==0&&q(S,R-=D[V],K),$(S,V=P(--W),U),(K=M[V])!==0&&q(S,W-=H[V],K)),Y<S.last_lit;);$(S,C,E)}function je(S,E){var U,W,R,V=E.dyn_tree,K=E.stat_desc.static_tree,Y=E.stat_desc.has_stree,ee=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=u,U=0;U<ee;U++)V[2*U]!==0?(S.heap[++S.heap_len]=he=U,S.depth[U]=0):V[2*U+1]=0;for(;S.heap_len<2;)V[2*(R=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[R]=0,S.opt_len--,Y&&(S.static_len-=K[2*R+1]);for(E.max_code=he,U=S.heap_len>>1;1<=U;U--)pe(S,V,U);for(R=ee;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,V,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,V[2*R]=V[2*U]+V[2*W],S.depth[R]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,V[2*U+1]=V[2*W+1]=R,S.heap[1]=R++,pe(S,V,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,Ce){var Ze,Ee,He,me,st,mt,Re=Ce.dyn_tree,Mt=Ce.max_code,yn=Ce.stat_desc.static_tree,vn=Ce.stat_desc.has_stree,Sn=Ce.stat_desc.extra_bits,Dt=Ce.stat_desc.extra_base,Ge=Ce.stat_desc.max_length,it=0;for(me=0;me<=_;me++)ae.bl_count[me]=0;for(Re[2*ae.heap[ae.heap_max]+1]=0,Ze=ae.heap_max+1;Ze<u;Ze++)Ge<(me=Re[2*Re[2*(Ee=ae.heap[Ze])+1]+1]+1)&&(me=Ge,it++),Re[2*Ee+1]=me,Mt<Ee||(ae.bl_count[me]++,st=0,Dt<=Ee&&(st=Sn[Ee-Dt]),mt=Re[2*Ee],ae.opt_len+=mt*(me+st),vn&&(ae.static_len+=mt*(yn[2*Ee+1]+st)));if(it!==0){do{for(me=Ge-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[Ge]--,it-=2}while(0<it);for(me=Ge;me!==0;me--)for(Ee=ae.bl_count[me];Ee!==0;)Mt<(He=ae.heap[--Ze])||(Re[2*He+1]!==me&&(ae.opt_len+=(me-Re[2*He+1])*Re[2*He],Re[2*He+1]=me),Ee--)}}(S,E),ye(V,he,S.bl_count)}function a(S,E,U){var W,R,V=-1,K=E[1],Y=0,ee=7,he=4;for(K===0&&(ee=138,he=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)R=K,K=E[2*(W+1)+1],++Y<ee&&R===K||(Y<he?S.bl_tree[2*R]+=Y:R!==0?(R!==V&&S.bl_tree[2*R]++,S.bl_tree[2*j]++):Y<=10?S.bl_tree[2*A]++:S.bl_tree[2*N]++,V=R,he=(Y=0)===K?(ee=138,3):R===K?(ee=6,3):(ee=7,4))}function F(S,E,U){var W,R,V=-1,K=E[1],Y=0,ee=7,he=4;for(K===0&&(ee=138,he=3),W=0;W<=U;W++)if(R=K,K=E[2*(W+1)+1],!(++Y<ee&&R===K)){if(Y<he)for(;$(S,R,S.bl_tree),--Y!=0;);else R!==0?(R!==V&&($(S,R,S.bl_tree),Y--),$(S,j,S.bl_tree),q(S,Y-3,2)):Y<=10?($(S,A,S.bl_tree),q(S,Y-3,3)):($(S,N,S.bl_tree),q(S,Y-11,7));V=R,he=(Y=0)===K?(ee=138,3):R===K?(ee=6,3):(ee=7,4)}}c(H);var B=!1;function k(S,E,U,W){q(S,(p<<1)+(W?1:0),3),function(R,V,K,Y){oe(R),te(R,K),te(R,~K),e.arraySet(R.pending_buf,R.window,V,K,R.pending),R.pending+=K}(S,E,U)}s._tr_init=function(S){B||(function(){var E,U,W,R,V,K=new Array(_+1);for(R=W=0;R<v-1;R++)for(D[R]=W,E=0;E<1<<O[R];E++)f[W++]=R;for(f[W-1]=R,R=V=0;R<16;R++)for(H[R]=V,E=0;E<1<<M[R];E++)T[V++]=R;for(V>>=7;R<l;R++)for(H[R]=V<<7,E=0;E<1<<M[R]-7;E++)T[256+V++]=R;for(U=0;U<=_;U++)K[U]=0;for(E=0;E<=143;)G[2*E+1]=8,E++,K[8]++;for(;E<=255;)G[2*E+1]=9,E++,K[9]++;for(;E<=279;)G[2*E+1]=7,E++,K[7]++;for(;E<=287;)G[2*E+1]=8,E++,K[8]++;for(ye(G,h+1,K),E=0;E<l;E++)w[2*E+1]=5,w[2*E]=fe(E,5);ne=new re(G,O,m+1,h,_),Z=new re(w,M,0,l,_),se=new re(new Array(0),z,0,b,x)}(),B=!0),S.l_desc=new I(S.dyn_ltree,ne),S.d_desc=new I(S.dyn_dtree,Z),S.bl_desc=new I(S.bl_tree,se),S.bi_buf=0,S.bi_valid=0,ie(S)},s._tr_stored_block=k,s._tr_flush_block=function(S,E,U,W){var R,V,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(Y){var ee,he=4093624447;for(ee=0;ee<=31;ee++,he>>>=1)if(1&he&&Y.dyn_ltree[2*ee]!==0)return t;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return r;for(ee=32;ee<m;ee++)if(Y.dyn_ltree[2*ee]!==0)return r;return t}(S)),je(S,S.l_desc),je(S,S.d_desc),K=function(Y){var ee;for(a(Y,Y.dyn_ltree,Y.l_desc.max_code),a(Y,Y.dyn_dtree,Y.d_desc.max_code),je(Y,Y.bl_desc),ee=b-1;3<=ee&&Y.bl_tree[2*L[ee]+1]===0;ee--);return Y.opt_len+=3*(ee+1)+5+5+4,ee}(S),R=S.opt_len+3+7>>>3,(V=S.static_len+3+7>>>3)<=R&&(R=V)):R=V=U+5,U+4<=R&&E!==-1?k(S,E,U,W):S.strategy===4||V===R?(q(S,2+(W?1:0),3),Ae(S,G,w)):(q(S,4+(W?1:0),3),function(Y,ee,he,ae){var Ce;for(q(Y,ee-257,5),q(Y,he-1,5),q(Y,ae-4,4),Ce=0;Ce<ae;Ce++)q(Y,Y.bl_tree[2*L[Ce]+1],3);F(Y,Y.dyn_ltree,ee-1),F(Y,Y.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Ae(S,S.dyn_ltree,S.dyn_dtree)),ie(S),W&&oe(S)},s._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(f[U]+m+1)]++,S.dyn_dtree[2*P(E)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){q(S,2,3),$(S,C,G),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,i,s){(function(e){(function(t,r){if(!t.setImmediate){var c,p,v,m,h=1,l={},b=!1,u=t.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(t);_=_&&_.setTimeout?_:t,c={}.toString.call(t.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(t.postMessage&&!t.importScripts){var j=!0,A=t.onmessage;return t.onmessage=function(){j=!1},t.postMessage("","*"),t.onmessage=A,j}}()?(m="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",C,!1):t.attachEvent("onmessage",C),function(j){t.postMessage(m+j,"*")}):t.MessageChannel?((v=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){v.port2.postMessage(j)}):u&&"onreadystatechange"in u.createElement("script")?(p=u.documentElement,function(j){var A=u.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,p.removeChild(A),A=null},p.appendChild(A)}):function(j){setTimeout(x,0,j)},_.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),N=0;N<A.length;N++)A[N]=arguments[N+1];var O={callback:j,args:A};return l[h]=O,c(h),h++},_.clearImmediate=g}function g(j){delete l[j]}function x(j){if(b)setTimeout(x,0,j);else{var A=l[j];if(A){b=!0;try{(function(N){var O=N.callback,M=N.args;switch(M.length){case 0:O();break;case 1:O(M[0]);break;case 2:O(M[0],M[1]);break;case 3:O(M[0],M[1],M[2]);break;default:O.apply(r,M)}})(A)}finally{g(j),b=!1}}}}function C(j){j.source===t&&typeof j.data=="string"&&j.data.indexOf(m)===0&&x(+j.data.slice(m.length))}})(typeof self>"u"?e===void 0?this:e:self)}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(vt)),vt.exports}var ri=ni();const si=Pn(ri),ii=async(o,d,n,i,s)=>{var c,p,v,m,h,l;const e=document.querySelector("svg#".concat(o));if(!e)throw new Error("Requested canvas SVG element not found");const t=Number((c=e.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:c[0]),r=e.cloneNode(!0);r.setAttribute("height",(t*(s||100)/100).toString()),r.style.setProperty("all","initial"),["share"].map(b=>{var u;return[...((u=[...document.querySelectorAll("link")].filter(_=>_.id==="css_"+b)[0])==null?void 0:u.sheet).cssRules].map(_=>_.cssText).join(" ")}).forEach(b=>{const u=document.createElement("style");u.textContent=b,r.prepend(u)}),(p=r.querySelector("rect#canvas-border"))==null||p.setAttribute("stroke",i?"black":"none"),(v=r.querySelector("rect#canvas-bg"))==null||v.setAttribute("fill",n?"none":"white");try{const b=(l=await((h=(m=Tt[d]).fonts)==null?void 0:h.call(m)))!=null?l:[],_=(await Promise.allSettled(b.map(le.getFontCSS))).filter(x=>x.status==="fulfilled").map(x=>x.value),g=document.createElement("style");g.textContent=_.join("\n"),r.prepend(g)}catch(b){console.warn("Failed to fonts. Fonts in the exported PNG will be missing.",b)}return r},ai=async(o,d,n)=>{const i=o.viewBox.baseVal.width,s=o.viewBox.baseVal.height,e=document.querySelectorAll("canvas")[0];e.width=Number(i)*window.devicePixelRatio*d,e.height=Number(s)*window.devicePixelRatio*d,o.setAttribute("width",e.width.toString()),o.setAttribute("height",e.height.toString());const t=e.getContext("2d");return t.clearRect(0,0,e.width,e.height),o.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(r=>r.setAttribute("font-size","8.5px")),o.querySelectorAll("text, tspan").forEach(r=>{const c=window.getComputedStyle(r);r.setAttribute("font-family",c.fontFamily),r.setAttribute("fill",c.fill),r.setAttribute("dominant-baseline",c.dominantBaseline),r.setAttribute("text-anchor",c.textAnchor||"")}),new Promise((r,c)=>{const p=new Image;p.onload=()=>{setTimeout(()=>{t.drawImage(p,0,0,e.width,e.height),e.toBlob(v=>{v?r(v):c("Canvas blob is null")},"image/png")},n?2e3:0)},p.onerror=c,p.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(o.outerHTML)))})};function oi(o){const{isOpen:d,onClose:n}=o,{t:i}=ce(),s=ue(),[e,t]=X.useState(""),[r,c]=X.useState(!1),[p,v]=X.useState(!1),[m,h]=X.useState(100),[l,b]=X.useState("png"),u=J(z=>z.app.canvasToShow),{style:_,stn_list:g,current_stn_idx:x,line_name:C}=J(z=>z.param);X.useEffect(()=>{e!==""&&!u.includes(e)&&t("")},[u]);const j=Pt[_].reduce((z,L)=>u.includes(L)?{...z,[L]:i("CanvasType."+L)}:{...z},{"":i("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((z,L)=>({...z,[L]:"".concat(L,"%")}),{}),N={png:i("DownloadModal.png"),svg:i("DownloadModal.svg")},O=[{type:"select",label:i("DownloadModal.canvas"),value:e,options:j,disabledOptions:[""],onChange:z=>t(z),minW:"full"},{type:"switch",label:i("DownloadModal.transparent"),isChecked:r,onChange:c,oneLine:!0,minW:"full"},{type:"switch",label:i("DownloadModal.showBorder"),isChecked:p,onChange:v,oneLine:!0,minW:"full"},{type:"select",label:i("DownloadModal.scale"),value:m,options:A,onChange:z=>h(z)},{type:"select",label:i("DownloadModal.format"),value:l,options:N,onChange:z=>b(z)}],M=async z=>{s(Ht(0));const L=z==="current"?[x]:Object.keys(g).filter(w=>!["linestart","lineend"].includes(w)),G=new si;for(const w in L){s(Ht((Number(w)+1)/L.length*100));const T=L[w];s(Ct(T)),await Mr(500);const f=await ii(e,_,r,p,m);document.body.appendChild(f);const D="rmg.".concat(T,".").concat(g[T].localisedName.en).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(l==="png"){const ne=Dr()&&w==="0",Z=await ai(f,m/100,ne);L.length>1?G.file("".concat(D,".png"),Z):Gt("".concat(D,".png"),Z)}else if(l==="svg"){f.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(f.outerHTML)));L.length>1?G.file("".concat(D,".svg"),ne.split("base64,")[1],{base64:!0}):fn(D+".svg","image/svg+xml",f.outerHTML)}document.body.removeChild(f)}if(L.length>1){const w=await G.generateAsync({type:"blob"}),T="rmg.".concat(C[0],".").concat(C[1],".zip").replaceAll(" ","_");Gt(T,w)}le.event(xe.DOWNLOAD_IMAGES,{canvasToDownload:e,style:_,option:z,format:l}),s(Ct(x)),s(yr()),n()};return y.jsxs(Ke,{isOpen:d,onClose:n,children:[y.jsx(Xe,{}),y.jsxs(Je,{children:[y.jsx(Qe,{children:i("DownloadModal.title")}),y.jsx(et,{}),y.jsx(tt,{children:y.jsx(be,{fields:O})}),y.jsx(nt,{children:y.jsxs(ze,{children:[y.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("current"),isDisabled:!e,children:i("DownloadModal.downloadOne")}),_!==Q.GZMTR&&y.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("all"),isDisabled:!e,children:i("DownloadModal.downloadAll")})]})})]})]})}function li(){const{t:o}=ce(),[d,n]=X.useState(!1),{paramConfig:i}=J(t=>t.app),s=J(t=>t.param),e=()=>{const t=Lr(s);fn("RMG_".concat(i==null?void 0:i.id,".json"),"application/json",JSON.stringify(t)),le.event(xe.DOWNLOAD_PARAM,{style:s.style})};return y.jsxs(wn,{children:[y.jsx(kn,{as:de,variant:"ghost",size:"sm",rightIcon:y.jsx(vr,{}),children:o("DownloadActions.downloads")}),y.jsxs(Cn,{children:[y.jsx(Lt,{onClick:e,children:o("DownloadActions.configFile")}),y.jsx(Lt,{onClick:()=>n(!0),children:o("DownloadActions.images")})]}),y.jsx(oi,{isOpen:d,onClose:()=>n(!1)})]})}function rt(){const[o,d]=Tn();return[o,i=>{d(i);const e=Object.keys(i).length===0?"/":"/?"+new URLSearchParams(i);le.updateAppMetadata({hash:e})}]}function ci(){const{t:o}=ce(),d=sn(),[,n]=rt(),i=()=>{d(Ue(De.CLOSE)),d(At(void 0)),n({})};return y.jsxs(ze,{ml:"auto",w:"fit-content",children:[y.jsx(de,{variant:"ghost",size:"sm",leftIcon:y.jsx(Sr,{}),onClick:i,children:o("All projects")}),y.jsx(li,{}),y.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:y.jsx(xr,{}),onClick:()=>d(Ue(De.STYLE)),children:o("HeaderActions.editStyle")})]})}function di(){const{t:o}=ce(),d=ue(),{canvasToShow:n,canvasScale:i}=J(p=>p.app),s=J(p=>p.param.style),e=Object.values(Q).reduce((p,v)=>({...p,[v]:o("RmgStyle."+v)}),{}),t=Pt[s].map(p=>({label:o("CanvasType."+p),value:p})),r=p=>{d(Or(p))},c=[{type:"select",label:o("Style"),value:s,options:e,onChange:p=>r(p)},{type:"custom",label:o("View"),component:y.jsx(wr,{displayValue:o("Select canvas"),selections:t,defaultValue:n,onChange:p=>d(kr(p))})},{type:"slider",label:o("Canvas scale"),value:i,min:.1,max:2,step:.01,onChange:p=>d(Cr(p)),leftIcon:y.jsx(jr,{}),rightIcon:y.jsx(Ar,{})}];return y.jsxs(Er,{children:[y.jsx(be,{fields:c,minW:160}),y.jsx(ci,{})]})}const $e=(o,d,n,i)=>(s,e)=>{var p,v,m,h,l,b,u,_,g,x,C,j,A,N;const t=e().param.stn_list;let r=qe(6);for(;r in t;)r=qe(6);const c=zr(r);if(o!=="new"){const O={...t,[d]:{...t[d],children:t[d].children.map(M=>M===n?r:M),branch:{left:(p=t[d].branch)==null?void 0:p.left,right:((m=(v=t[d].branch)==null?void 0:v.right)==null?void 0:m[1])===n?(l=(h=t[d].branch)==null?void 0:h.right)==null?void 0:l.with(1,r):(b=t[d].branch)==null?void 0:b.right}},[n]:{...t[n],parents:t[n].parents.map(M=>M===d?r:M),branch:{left:((_=(u=t[n].branch)==null?void 0:u.left)==null?void 0:_[1])===d?(x=(g=t[n].branch)==null?void 0:g.left)==null?void 0:x.with(1,r):(C=t[n].branch)==null?void 0:C.left,right:(j=t[n].branch)==null?void 0:j.right}},[r]:{...c,parents:[d],children:[n]}};return s(we(O)),r}else{if(!i)return!1;const O={...t,[d]:{...t[d],children:i==="upper"?[r,t[d].children[0]]:[t[d].children[0],r],branch:{left:(A=t[d].branch)==null?void 0:A.left,right:[ht.through,r]}},[n]:{...t[n],parents:i==="upper"?[r,t[n].parents[0]]:[t[n].parents[0],r],branch:{left:[ht.through,r],right:(N=t[n].branch)==null?void 0:N.right}},[r]:{...c,parents:[d],children:[n]}};return s(we(O)),r}},hi=(o,d,n)=>(i,s)=>{const t=s().helper.branches[o];if(t!=null&&t.length)if(d==="before"){const r=t[t.indexOf(n)-1];return i($e(o.toString(),r,n))}else{const r=t[t.indexOf(n)+1];return i($e(o.toString(),n,r))}else return!1},ui=()=>(o,d)=>{const n=d().param.stn_list;return d().helper.branches[0].filter(s=>{const e=n[s].parents.length+n[s].children.length===4,t=Bt(s,n)===0;return!e&&t})},tn=(o,d)=>(n,i)=>{const s=i().param.stn_list,e=i().helper.branches;return!e[0].includes(o)||!e[0].includes(d)?"Branch should end at main line":e[0].indexOf(o)>=e[0].indexOf(d)?"Not in correct ordering":o==="linestart"&&d==="lineend"?"Should not be parallel to main line":o==="linestart"&&e[0].indexOf(d)===1?"Branch should not be open jaw from the first station":d==="lineend"&&e[0].indexOf(o)===e[0].length-2?"Branch should not be open jaw from the last station":s[o].children.length>1||s[d].parents.length>1?"Branch already exist":e.slice(1).some(c=>c.slice(1,-1).includes(o)||c.slice(1,-1).includes(d))?"Cannot branch out from existing branch":e[0].slice(e[0].indexOf(o)+1,e[0].indexOf(d)).every(c=>s[c].parents.length===1&&s[c].children.length===1)?"":"One or more stations between both ends are branching out"};function fi(o){var N,O;const{isOpen:d,onClose:n}=o,{t:i}=ce(),s=ue(),e=J(M=>M.app.selectedBranch),{style:t,stn_list:r}=J(M=>M.param),c=J(M=>M.helper.branches),[p,v]=X.useState(e),[m,h]=X.useState("before"),[l,b]=X.useState(""),[u,_]=X.useState(!1);X.useEffect(()=>{v(e)},[e]),X.useEffect(()=>{d||_(!1)},[d]);const g=(O=(N=c[Number(p)])==null?void 0:N.slice(1,-1))!=null?O:[],x=M=>M.reduce((z,L)=>{var G,w;return{...z,[L]:((G=r[L])==null?void 0:G.localisedName.zh)+"/"+((w=r[L])==null?void 0:w.localisedName.en)}},{"":i("AddStationModal.pleaseSelect")}),C=[{type:"select",label:i("AddStationModal.where"),value:p,options:{...c.reduce((M,z,L)=>({...M,[L]:L===0?i("AddStationModal.main"):t!==Q.SHMetro||!We(z,r)?i("AddStationModal.branch")+" "+L:i("AddStationModal.external")+" "+L}),{})},onChange:M=>j(M),minW:"full"},{type:"select",label:i("AddStationModal.preposition"),value:m,options:{before:i("AddStationModal.before"),after:i("AddStationModal.after")},onChange:M=>h(M)},{type:"select",label:i("AddStationModal.pivot"),value:l,options:x(g),disabledOptions:[""],onChange:M=>b(M)}],j=M=>{v(M),b("")},A=()=>{const M=s(hi(p,m,l));M?(n(),s(dn(M)),s(Ue(De.STATION))):(console.log("false here"),_(!0)),le.event(xe.ADD_STATION,{style:t,branchIndex:p,success:M})};return y.jsxs(Ke,{isOpen:d,onClose:n,children:[y.jsx(Xe,{}),y.jsxs(Je,{children:[u&&y.jsxs(ut,{status:"error",variant:"solid",size:"xs",children:[y.jsx(ft,{}),i("AddStationModal.error")]}),y.jsxs(ke,{position:"relative",children:[y.jsx(Qe,{children:i("AddStationModal.title")}),y.jsx(et,{})]}),y.jsx(tt,{children:y.jsx(be,{fields:C})}),y.jsx(nt,{children:y.jsx(de,{colorScheme:"primary",onClick:A,isDisabled:!l,children:i("Confirm")})})]})]})}function pi(o){const{isOpen:d,onClose:n}=o,{t:i}=ce(),s=ue(),[e,t]=X.useState("new"),[r,c]=X.useState(""),[p,v]=X.useState(""),[m,h]=X.useState("upper"),[l,b]=X.useState(""),[u,_]=X.useState(""),{style:g,stn_list:x}=J(G=>G.param);X.useEffect(()=>{d||(t("new"),c(""),v(""))},[d]);const j=(G=>G.reduce((w,T)=>{var f,D;return{...w,[T]:T==="linestart"?"(".concat(i("LEFT END"),")"):T==="lineend"?"(".concat(i("RIGHT END"),")"):((f=x[T])==null?void 0:f.localisedName.zh)+"/"+((D=x[T])==null?void 0:D.localisedName.en)}},{"":i("Please select...")}))(s(ui())),A=[{type:"select",label:i("NewBranchModal.where"),value:e,options:{new:i("NewBranchModal.new"),ext:i("NewBranchModal.ext")},disabledOptions:g===Q.SHMetro?[]:["ext"],onChange:G=>N(G),minW:"full"},{type:"select",label:i("NewBranchModal.from"),value:r,options:j,disabledOptions:[""],onChange:G=>O(G),isInvalid:!!l},{type:"select",label:i("NewBranchModal.to"),value:p,options:j,disabledOptions:[""],onChange:G=>M(G),isInvalid:!!u},{type:"select",label:i("NewBranchModal.position"),value:m,options:{upper:i("NewBranchModal.upper"),lower:i("NewBranchModal.lower")},onChange:G=>h(G),minW:"full",hidden:e!=="new"||g===Q.SHMetro}],N=G=>{t(G),c(""),v(""),b(""),_("")},O=G=>{c(G),b(""),G&&p&&_(s(tn(G,p)))},M=G=>{v(G),_(""),r&&G&&b(s(tn(r,G)))},z=()=>{let G;e==="ext"?G=s($e("new",r,p,"lower")):g===Q.SHMetro?G=s($e("new",r,p,"upper")):G=s($e("new",r,p,m)),G&&(n(),le.event(xe.ADD_BRANCH,{style:g,where:e}))},L=!!(!r||!p||l||u);return y.jsxs(Ke,{isOpen:d,onClose:n,children:[y.jsx(Xe,{}),y.jsxs(Je,{children:[y.jsx(Qe,{children:i("NewBranchModal.title")}),y.jsx(et,{}),y.jsx(tt,{children:y.jsx(be,{fields:A})}),y.jsx(nt,{children:y.jsx(de,{colorScheme:"primary",title:L?l||u:i("Confirm"),onClick:z,isDisabled:L,children:i("Confirm")})})]})]})}const mi=X.lazy(()=>Le(()=>import("./station-ag-grid-CZaipof9.js"),__vite__mapDeps([12,1,2,3,4,13,14,9])));function gi(){const{t:o}=ce(),d=ue(),[n,i]=X.useState(!1),[s,e]=X.useState(!1),t=J(m=>m.app.selectedBranch),{style:r,stn_list:c}=J(m=>m.param),p=J(m=>m.helper.branches),v=()=>{d(Ue(De.BRANCH))};return y.jsxs(ke,{flex:1,overflow:"hidden",children:[y.jsxs(jn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:t,onChange:m=>d(Rr(m)),children:[y.jsxs(An,{children:[p.map((m,h)=>h===0?y.jsx(gt,{children:o("GridTabs.main")},h):r!==Q.SHMetro||!We(m,c)?y.jsx(gt,{children:o("GridTabs.branch")+" "+h},h):y.jsx(gt,{children:o("GridTabs.external")+" "+h},h)),y.jsx(Be,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>e(!0),icon:y.jsx(Ie,{})}),y.jsxs(ze,{marginLeft:"auto",marginRight:1,children:[y.jsx(de,{variant:"outline",size:"xs",leftIcon:y.jsx(Ie,{}),onClick:()=>i(!0),children:o("GridTabs.addStation")}),y.jsx(de,{size:"xs",colorScheme:"primary",onClick:v,children:o("GridTabs.editLine")})]})]}),y.jsx(En,{flex:1,overflowY:"auto",children:p.map((m,h)=>y.jsx(On,{padding:0,h:"100%",position:"relative",children:y.jsx(an,{suspenseFallback:y.jsx(pt,{isIndeterminate:!0}),children:y.jsx(mi,{branchIndex:h})})},h))})]}),y.jsx(fi,{isOpen:n,onClose:()=>i(!1)}),y.jsx(pi,{isOpen:s,onClose:()=>e(!1)})]})}function bi(){const o=ue(),d=J(i=>i.app.globalAlerts),n=i=>{le.isStandaloneWindow()?window.open("/".concat(i),"_blank"):le.openApp({appId:i})};return y.jsx(y.Fragment,{children:Object.entries(d).map(([i,{message:s,url:e,linkedApp:t}])=>y.jsxs(ut,{status:i,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[y.jsx(ft,{}),t?y.jsx(Ve,{onClick:()=>n(t),children:s}):e?y.jsx(Ve,{href:e,target:"_blank",children:s}):s,y.jsx(nn,{ml:"auto",onClick:()=>o(Pr(i))})]},i))})}const _n=o=>{document.title=o,setTimeout(()=>{le.updateAppMetadata({title:o})},200)};function _i(){const{t:o}=ce(),[d]=rt(),n=d.get("project"),i=J(t=>t.app.isLoading),[s,e]=X.useState(!1);return X.useEffect(()=>{var t;if(le.isStandaloneWindow()&&!le.storage.get(Ye.DO_NOT_SHOW_RMT_MSG)&&e(!0),n){const r=Fr(n);_n((t=r==null?void 0:r.name)!=null?t:o("Project")+" "+n)}},[]),y.jsxs(un,{children:[i&&y.jsx(pt,{isIndeterminate:i<0,value:i>=0?i:void 0}),y.jsx(di,{}),s&&y.jsxs(ut,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[y.jsx(ft,{}),y.jsxs(lt,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[o("Try out")," ",y.jsx(Ve,{href:"/?app=rmg",isExternal:!0,children:o("Rail Map Toolkit")})," ",o("now and enjoy an even better rail map design experience!")," ",y.jsx(Ve,{as:"button",ml:"auto",onClick:()=>e(!1),children:o("Close")})," | ",y.jsx(Ve,{as:"button",onClick:()=>{e(!1),le.storage.set(Ye.DO_NOT_SHOW_RMT_MSG,"true")},children:o("Don't show me again")})]})]}),y.jsx(bi,{}),y.jsxs(Te,{flex:1,overflow:"hidden",position:"relative",children:[y.jsxs(Te,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[y.jsx(ke,{children:y.jsx(Xr,{})}),y.jsx(gi,{})]}),y.jsx(ti,{})]}),y.jsx("canvas",{style:{display:"none"}})]})}const yi="rmg-templates-bridge--",vi={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Si(o){const{isOpen:d,onClose:n,onImport:i}=o,[s]=X.useState(qe()),e="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:le.getAppName(),parentId:s});return X.useEffect(()=>{const t=new BroadcastChannel(yi+s);return t.onmessage=r=>{const{event:c,meta:p,data:v}=r.data;console.log("[rmg] Received event from RMG Templates app clip:",c),c==="CLOSE"?n():c==="IMPORT"&&i(v,p.name)},()=>{t.close()}},[]),y.jsx(hn,{size:"xl",isOpen:d,onClose:n,sx:vi,children:y.jsx("iframe",{src:e,loading:"eager"})})}const xi={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function wi(o){const{selectedParam:d,disableNew:n,onError:i}=o,{t:s}=ce(),[,e]=rt(),[t,r]=X.useState(!1),c=X.useRef(null),p=X.useRef(null);X.useEffect(()=>{var b;d&&((b=p.current)==null||b.focus())},[d]);const v=()=>{const b=Nr(Q.MTR,le.getLanguage()),u=_t(JSON.stringify(b));e({project:u}),le.event(xe.NEW_PARAM,{})},m=(b,u)=>{const _=_t(JSON.stringify(b),u);e({project:_})},h=async b=>{var _;const u=(_=b.target.files)==null?void 0:_[0];Oe.info("handleImportProject(), received file",u);try{if(!u)i(s("OpenActions.unknownError"));else if(u.type!=="application/json")i(s("OpenActions.invalidType"));else{const g=await Ur(u),x=_t(g);e({project:x}),le.event(xe.UPLOAD_PARAM,{})}}catch(g){i(s("OpenActions.unknownError")),Oe.error("handleImportProject(), Unknown error occurred while parsing the uploaded file",g)}b.target.value=""},l=()=>{d&&(e({project:d}),le.event(xe.OPEN_PARAM,{}))};return y.jsxs(Te,{sx:xi,children:[y.jsx(de,{leftIcon:y.jsx(Ie,{}),onClick:v,isDisabled:n,children:s("Blank project")}),y.jsx(de,{leftIcon:y.jsx(Tr,{}),onClick:()=>r(!0),isDisabled:n,children:s("Open template")}),y.jsx(de,{leftIcon:y.jsx(Ir,{}),onClick:()=>{var b;return(b=c.current)==null?void 0:b.click()},isDisabled:n,children:s("Import project")}),y.jsx(de,{ref:p,colorScheme:"primary",leftIcon:y.jsx(Br,{}),onClick:l,isDisabled:d===void 0,children:s("Open selected")}),y.jsx("input",{ref:c,type:"file",accept:".json",hidden:!0,onChange:h,"data-testid":"file-upload"}),y.jsx(Si,{isOpen:t,onClose:()=>r(!1),onImport:m})]})}const ki={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Ci(o){const{downloading:d}=o,{t:n}=ce(),[i]=rt(),s=i.get("project"),[e,t]=X.useState([]),[r,c]=X.useState(),p=X.useRef(null),v=rn();X.useEffect(()=>{_n(n("Manage projects"))},[]),X.useEffect(()=>{t(yt())},[d]),zn({ref:p,handler:()=>c(void 0)});const m=b=>{const{id:u,name:_,lastModified:g}=b;u&&(le.storage.set(Ye.PARAM_CONFIG_BY_ID+u,JSON.stringify({name:_,lastModified:g})),c(void 0),t(yt()),le.event(xe.UPDATE_PARAM_CONFIG,{}))},h=b=>{le.storage.remove(Ye.PARAM_BY_ID+b),le.storage.remove(Ye.PARAM_CONFIG_BY_ID+b),c(void 0),t(yt()),le.event(xe.REMOVE_PARAM,{})},l=b=>{v({description:b,status:"error",duration:1e4,isClosable:!0})};return y.jsxs(un,{justifyContent:"center",children:[s&&y.jsx(pt,{isIndeterminate:!0}),y.jsx(Rn,{children:y.jsxs(Me,{sx:ki,children:[y.jsx(Se,{as:"h3",size:"lg",children:n("Saved projects")}),y.jsxs(Te,{ref:p,children:[y.jsx(Wr,{paramRegistry:e,downloading:d,selectedParam:r,onParamSelect:c,onParamRemove:h,onParamUpdate:m}),y.jsx(wi,{selectedParam:r,disableNew:e.length>=10,onError:l})]})]})})]})}const ji=o=>async d=>{try{const{config:n,param:i}=Zr(o);if(!i)return!1;const s={id:o,...n!=null?n:{}},e=Hr(i);try{const t=await Gr(e);d(At(s)),d(Vt(t))}catch(t){console.warn("Unable to update themes",t),d(At(s)),d(Vt(e))}return!0}catch(n){return console.warn("Failed to parse param.",n),!1}};function Ai(){const{t:o}=ce(),d=ue(),{paramConfig:n}=J(h=>h.app),[i,s]=rt(),e=i.get("project"),t=i.get("external"),[r,c]=X.useState(!1),[p,v]=X.useState(),m=rn();return X.useEffect(()=>{if(Oe.info("searchParam: project=".concat(e,", external=").concat(t)),e&&t)Oe.warn("<AppRouter/>, Both param ID and external URL are provided. External URL will be ignored."),s({project:e});else if(e)m.closeAll(),e===(n==null?void 0:n.id)?(Oe.info("<AppRouter/>, Store param ID matches URL param ID. Rendering app view..."),c(!0)):(Oe.info("<AppRouter/>, Loading app view for param (ID=".concat(e,")...")),d(ji(e)).then(h=>{h?c(!0):(Oe.info("<AppRouter/>, Failed to read param (ID=".concat(e,"). Rendering param selector view...")),m({description:o("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),s({}))}));else if(t){Oe.info("<AppRouter/>, External project URl is provided. Downloading project...");const h=decodeURIComponent(t);v(h),Vr(h).then(l=>{l?s({project:l}):(Oe.info("<AppRouter/>, Failed to download param from ".concat(h,". Rendering param selector view...")),m({description:o("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),s({})),v(void 0)})}else Oe.info("<AppRouter/>, No URL param ID or external URL provided. Rendering param selector view..."),c(!1)},[e,t]),r?y.jsx(_i,{}):y.jsx(Ci,{downloading:p})}const Ti=Object.freeze(Object.defineProperty({__proto__:null,default:Ai},Symbol.toStringTag,{value:"Module"}));export{Yr as R,Ti as a,Pi as g,We as i};
