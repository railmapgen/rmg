System.register(["./chakra-legacy-Ck1twAYB.js","./react-legacy-jWjm0Xez.js","./index-legacy-DPpMr62r.js","./share-legacy-CZ6I5h72.js","./svg-wrapper-legacy-CDYZ4kzN.js","./param-selector-legacy-o_vLIyyt.js"],(function(e,t){"use strict";var n,s,r,a,i,l,c,o,d,h,m,x,g,f,u;return{setters:[e=>{n=e.j},e=>{s=e.a},e=>{r=e.i,a=e.P,i=e.b0,l=e.u,c=e.n,o=e.S,d=e.aW},e=>{h=e.a,m=e.c,x=e.b,g=e.d},e=>{f=e.S},e=>{u=e.i}],execute:function(){function t(e){const{num:t,inStrip:s,showAsPlatformDoor:a,...i}=e;return n.jsxs("g",{textAnchor:"middle",fill:s?r.black:"var(--rmg-theme-fg)",...i,children:[n.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:s?"#fff":"var(--rmg-theme-colour)"}),n.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),a?n.jsxs(n.Fragment,{children:[n.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),n.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):n.jsxs(n.Fragment,{children:[n.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),n.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]})}const j=e=>{const t=(e=>{switch(e){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(e.variant),r=s.useMemo((()=>{switch(e.variant){case"gz1":return n.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return n.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return n.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return n.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return n.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return n.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return n.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return n.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return n.jsx(n.Fragment,{})}}),[e.variant]);return n.jsxs("g",{transform:`translate(0,${"gz4"===e.variant?-15:0})`,style:{"--strip-height":`${t}px`},children:[n.jsx("rect",{id:"strip_gz"}),e.variant===a.gz1&&n.jsx("rect",{className:"gz1-gap"}),n.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:e.isShowLight&&r}),!1!==e.isShowPSD&&n.jsx(p,{...e})]})},p=s.memo((function(e){const s=["gz28","gz2otis","gz6","gzgf"].includes(e.variant),r=(e=>{switch(e){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(e.variant),i=(e=>{switch(e){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(e.variant),l=[a.gz1,a.gz3,a.gz4,a.gz5,a.gz1421,a.gz7w,a.gz11].includes(e.variant);return n.jsx(t,{num:e.isShowPSD,inStrip:s,showAsPlatformDoor:e.variant===a.gz11,style:{"--psd-dy":r,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":l?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":i}})}),((e,t)=>e.variant===t.variant&&e.isShowPSD===t.isShowPSD));function z(e){var t,n,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=z(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function _(){for(var e,t,n=0,s="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=z(e))&&(s&&(s+=" "),s+=t);return s}const y=1.3,S=38.3,N=s.memo((function(e){const{stroke:t,filled:s,bolder:r,...a}=e;return n.jsx("path",{d:"M0,9.25 V-9.25 H-13.5 l-5,5.625 v7.25 l5,5.625 H13.5 l5,-5.625 v-7.25 l-5,-5.625 H0",fill:s?t:"#fff",strokeWidth:r?1.7:y,stroke:t,...a})})),w=s.createContext({updateId:0,update:()=>{}}),$=["Arial"],k=s.forwardRef((function(e,t){const{Icon:r,lineNum:a,stnNum:i,strokeColour:l,passed:c,size:o,bolderBorder:d,alwaysShowColouredBorder:h,useSameScale:m,className:x,classNames:g,children:f,textProps:u,...j}=e,{updateId:p}=s.useContext(w),z=s.useRef(null),y=s.useRef(null),[S,N]=s.useState({width:0}),[k,v]=s.useState({width:0}),B=()=>{z.current&&N(z.current.getBBox()),y.current&&v(y.current.getBBox())};s.useEffect((()=>{const e=new AbortController;return B(),document.fonts.load("12px "+$.join(", "),(a??"")+(i??"")).then().finally((()=>{setTimeout((()=>{e.signal.aborted||B()}),100)})),()=>{e.abort()}}),[a,i,p]);const b=a&&a.length>2,M=i&&i.length>2;s.useEffect((()=>{m&&(b||M)&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")}),[m,b,M]);const R=17/Math.max(17,S.width),A=!m||b||M?17/Math.max(17,k.width):R,W="sm"===o?"0.7":"lg"===o?"1.6":1;return n.jsxs("g",{ref:t,className:_(g?.wrapper,x),...j,children:[n.jsxs("g",{transform:`scale(${W})`,children:[n.jsx(r,{stroke:c&&!h?"#aaa":l,filled:!a&&!i,bolder:d}),(a||i)&&n.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:c?"#aaa":"#000",children:[n.jsx("g",{transform:`translate(-9.25,0)scale(${R})`,children:n.jsx("text",{ref:z,dominantBaseline:"central",x:.5,className:g?.digits,...u,children:a})}),n.jsx("g",{transform:`translate(9.25,0)scale(${A})`,children:n.jsx("text",{ref:y,dominantBaseline:"central",className:g?.digits,...u,children:i})})]})]}),f]})})),v=s.forwardRef((function(e,t){return n.jsx(k,{Icon:N,...e,ref:t})})),B=42,b=(e,t)=>{const n=[e,t].map((e=>e.match(/^(\w+).+$/)));if(n[0]&&n[1]&&n[0][1]===n[1][1])return n[0][1]},M=e=>{const t=e.match(/^(\d+)\D+$/);return t?.[1]};function R(e){const{customWidth:t,...s}=e,r=(t??45)-45;return n.jsx("rect",{x:-22.5-r/2,height:24,width:t??45,rx:4.5,...s,"data-testid":"intBox"})}const A=s.forwardRef((function(e,t){const{zhName:a,enName:i,foregroundColour:l,backgroundColour:c,passed:o,spanDigits:d,className:h,classNames:m,children:x,textProps:g,...f}=e,{isDigit:u,spanningPart:j}=((e,t)=>{const n=M(e);if(n)return{isDigit:!0,spanningPart:n};const s=b(e,t);return s?{isDigit:!1,spanningPart:s}:{isDigit:!1,spanningPart:""}})(a,i),p=s.useRef(null),[z,y]=s.useState({x:0,height:0,width:0});s.useEffect((()=>{p.current&&y(p.current.getBBox())}),[a,i]);const S=B/Math.max(B,z.width),N=(-z.x-z.width/2)*S,w=z.height*(1-S)/2;return n.jsxs("g",{ref:t,textAnchor:"middle",fill:o?r.white:l,className:_(m?.wrapper,h),...f,children:[n.jsx(R,{fill:o?"#aaa":c}),n.jsxs("g",{ref:p,transform:`translate(${N},${w})scale(${S})`,children:[n.jsx("text",{fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",className:m?.digits,...g?.digits,children:j}),n.jsx("text",{fontSize:10,x:0,y:8,textAnchor:"start",dominantBaseline:"central",className:m?.zh,...g?.zh,children:a.slice(j.length).trim()}),n.jsx("text",{fontSize:6.5,letterSpacing:-.1,x:0,y:18,textAnchor:"start",dominantBaseline:"middle",className:m?.en,...g?.en,children:u?i:i.slice(j.length).trim()})]}),x]})})),W=s.forwardRef((function(e,t){const{zhName:a,enName:i,foregroundColour:l,backgroundColour:c,passed:o,spanDigits:d,className:h,classNames:m,children:x,textProps:g,...f}=e,u=M(a)??"",j=s.useRef(null),p=s.useRef(null),[z,y]=s.useState({x:0,width:0}),[S,N]=s.useState({width:0});s.useEffect((()=>{j.current&&y(j.current.getBBox()),p.current&&N(p.current.getBBox())}),[a,i]);const w=B/Math.max(B,z.width),$=B/Math.max(B,S.width),k={x:-(z.x+z.width/2)*w,y:7.3+13.5*(1-w)*w/2*w},v={y:19.5-9*(1-$)*$/2};return n.jsxs("g",{ref:t,fill:o?r.white:l,className:_(m?.wrapper,h),...f,children:[n.jsx(R,{fill:o?"#aaa":c}),n.jsxs("g",{ref:j,transform:`translate(${k.x},${k.y})scale(${w})`,children:[n.jsx("text",{ref:j,fontSize:16,textAnchor:"end",y:.7,dominantBaseline:"central",className:m?.digits,...g?.digits,children:u}),n.jsx("text",{fontSize:12,textAnchor:"start",dominantBaseline:"central",className:m?.zh,...g?.zh,children:a.slice(u.length)})]}),n.jsx("text",{ref:p,fontSize:8,textAnchor:"middle",transform:`translate(0,${v.y})scale(${$})`,dominantBaseline:"middle",className:m?.en,...g?.en,children:i}),x]})})),C=s.forwardRef((function(e,t){const{zhName:a,enName:i,foregroundColour:l,backgroundColour:c,passed:o,spanDigits:d,className:h,classNames:m,children:x,textProps:g,...f}=e,u=s.useRef(null),[j,p]=s.useState({width:0});s.useEffect((()=>{u.current&&p(u.current.getBBox())}),[a,i]);const z=Math.max(45,j.width+4);return n.jsxs("g",{ref:t,textAnchor:"middle",fill:o?r.white:l,className:_(m?.wrapper,h),...f,children:[n.jsx(R,{customWidth:z,fill:o?"#aaa":c}),n.jsxs("g",{ref:u,children:[n.jsx("text",{fontSize:8.5,y:8,dominantBaseline:"central",className:m?.zh,...g?.zh,children:a}),n.jsx("text",{fontSize:5.5,y:18,dominantBaseline:"middle",className:m?.en,...g?.en,children:i})]}),x]})})),E=s.forwardRef((function(e,t){const{zhName:a,enName:i,foregroundColour:l,backgroundColour:c,passed:o,spanDigits:d,className:h,classNames:m,children:x,textProps:g,...f}=e,u=s.useRef(null),j=s.useRef(null),[p,z]=s.useState({width:0}),[y,S]=s.useState({width:0});s.useEffect((()=>{u.current&&z(u.current.getBBox()),j.current&&S(j.current.getBBox())}),[a,i]);const N=B/Math.max(B,p.width),w=B/Math.max(B,y.width),$={y:7.3+13.5*(1-N)*N/2},k={y:19.5-9*(1-w)*w/2};return n.jsxs("g",{ref:t,textAnchor:"middle",fill:o?r.white:l,className:_(m?.wrapper,h),...f,children:[n.jsx(R,{fill:o?"#aaa":c}),n.jsx("text",{ref:u,fontSize:12,transform:`translate(0,${$.y})scale(${N})`,dominantBaseline:"central",className:m?.zh,...g?.zh,children:a}),n.jsx("text",{ref:j,fontSize:8,transform:`translate(0,${k.y})scale(${w})`,dominantBaseline:"middle",className:m?.en,...g?.en,children:i}),x]})})),D=s.memo(s.forwardRef((function(e,t){const{zhName:s,enName:r,spanDigits:a}=e;switch(I(s,r)){case 1:return a?n.jsx(A,{ref:t,...e}):n.jsx(W,{ref:t,...e});case 2:return n.jsx(A,{ref:t,...e});default:return s.length>=5?n.jsx(C,{ref:t,...e}):n.jsx(E,{ref:t,...e})}}))),I=(e,t)=>void 0!==M(e)?1:void 0!==b(e,t)?2:3,O=s.memo((function(e){const{stroke:t,filled:s,bolder:r,...a}=e;return n.jsx("path",{d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:s?t:"#fff",strokeWidth:r?1.7:y,stroke:t,...a})})),P=s.forwardRef((function(e,t){return n.jsx(k,{Icon:O,...e,ref:t})}));function H({position:e,...t}){const s="right"===e?"rotate(180)":"rotate(0)";return n.jsx("circle",{cx:-15.32,cy:0,r:9.575,stroke:"#aaa",strokeWidth:2.275,fill:"white",strokeDasharray:"2.7 2.5",transform:s,...t})}const F=(e,t)=>Array.from(Array(e).keys()).map((n=>(n-(e-1)/2)*t)),T=e=>"fmetro"===e?N:O,U=9.1,L=2.8600000000000003;s.forwardRef((function({stations:e,classNames:t,columns:r=2,topHeavy:a,anchorAt:i,osiPosition:l,children:c,...o},d){const h=s.useMemo((()=>((e,t,n)=>{if(e<=0)return[];if(1===e)return[[0,0]];const s=t>e?e:t,r=S,a=F(s,r),i=Math.ceil(e/s),l=F(i,19.8),c=e%s,o=[];for(let d=0;d<i;d++)if(0===c||d!==(n?i-1:0))for(let e=0;e<s;e++)o.push([a[e],l[d]]);else{const e=F(c,r);for(let t=0;t<c;t++)o.push([e[t],l[d]])}return o})(e.length,r,a)),[e.length,r,a]),[m,x]=s.useMemo((()=>{if(void 0===i)return[0,0];if(i<0||i>=h.length)return console.warn(`<InterchangeStation2024/>, anchor index ${i} is out of bound`),[0,0];{const[e,t]=h[i];return[-e,-t]}}),[h,i]),g=s.useRef(null),f=s.useRef([]);s.useEffect((()=>{f.current=f.current.slice(0,e.length)}),[e.length]);const u=2===e.length&&1===r&&!!l;return s.useImperativeHandle(d,(()=>({target:g.current,children:f.current,getCoordinates:()=>h,getCorrectedBBox:()=>{const e=g.current?.getBBox()??{x:0,y:0,width:0,height:0};return e.y-=4.55,e.height+=U,u?(e.x-="left"===l?1.4300000000000002:4.55,e.width+=5.98):(e.x-=4.55,e.width+=U),e},getTranslate:()=>[m,x]})),[h,m,x,g.current,f.current,l]),n.jsxs("g",{ref:g,transform:`translate(${m},${x})`,...o,children:[e.map((({style:e},t)=>{const s=T(e);return n.jsx(s,{stroke:"#aaa",filled:!0,strokeWidth:U,transform:`translate(${h[t][0]},${h[t][1]})`},t)})),u&&n.jsx(H,{position:l,r:13.206896551724137,strokeWidth:L,strokeDasharray:void 0}),e.map((({style:e},t)=>{const s=T(e);return n.jsx(s,{stroke:"white",filled:!0,strokeWidth:3.3800000000000003,transform:`translate(${h[t][0]},${h[t][1]})`},t)})),u&&n.jsx(H,{position:l}),e.length&&n.jsx("rect",{fill:"white",x:-12,y:h[0][1],width:24,height:2*-h[0][1]}),e.map((({style:e,...s},r)=>{const a="fmetro"===e?v:P;return n.jsx(a,{ref:e=>f.current[r]=e,transform:`translate(${h[r][0]},${h[r][1]})`,classNames:t,...s},r)})),c]})}));const J=10*Math.PI/180,V=`M0,9 A9,9 0 0,0 ${9*Math.sin(J)},-${9*Math.cos(J)}`;function Y(e){return n.jsxs("g",{...e,children:[n.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),n.jsx("path",{d:V,stroke:"red",strokeWidth:3,fill:"none"}),n.jsx("path",{d:V,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),n.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]})}const G=s.forwardRef((function({clockwise:e,anchorAt:t="text",...s},r){const a="circle"===t?29:0;return n.jsx("g",{ref:r,...s,children:n.jsxs("g",{transform:`translate(${a},0)`,children:[n.jsx(Y,{transform:`translate(-30,0)scale(${e?-1:1},1)`}),n.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),n.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})})})),X=s.memo((function(e){const{stnName:t,onUpdate:r,onEnNameUpdate:a}=e,{zh:i="",en:l=""}=t,c=s.useRef(null);return s.useEffect((()=>{if(c.current){r?.(c.current.getBBox());const e=c.current.querySelector("g");e&&a?.(e.getBBox())}}),[JSON.stringify(t),c.current]),n.jsxs("g",{ref:c,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:18,children:i}),n.jsx("g",{fontSize:10.5,children:l.split("\\").map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:16+11*t,children:e},t)))})]})}),((e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName)));function Z(e){const{stnName:t,onUpdate:r,passed:a,...i}=e,{zh:l="",en:c=""}=t,o=s.useRef(null),[d,h]=s.useState({x:0,width:0});return s.useEffect((()=>{if(o.current){const e=o.current.getBBox();h(e),r?.(e)}}),[JSON.stringify(t)]),l||c?n.jsxs("g",{fill:a?"#aaa":"#000",...i,children:[n.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[n.jsx("text",{textAnchor:"end",x:d.x-3,className:"rmg-name__zh",children:"("}),n.jsx("text",{textAnchor:"start",x:d.width+d.x+3,className:"rmg-name__zh",children:")"})]}),n.jsxs("g",{ref:o,textAnchor:"middle",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:13,children:l}),n.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:c})]})]}):n.jsx(n.Fragment,{})}function q(e){const{passed:t,...s}=e;return n.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...s,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),n.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function K(e){const{passed:t,temporary:s,...r}=e;return n.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...r,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),n.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),s&&n.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function Q(e){const{primaryName:t,secondaryName:r,stationState:a,flipped:l,express:c,underConstruction:o}=e,[d,h]=s.useState({width:0}),[m,x]=s.useState({width:0}),[g,f]=s.useState({x:0,width:-20}),u=t.en?.split("\\")?.length??1,j={x:0,y:l?17.5:-20-14*u*Math.cos(-45)},p={x:(d.width+g.width/2+10)*(l?-1:1),y:2+5*(u-1)},z={x:(d.width+g.width+20+35)*(l?-1:1),y:2+5*(u-1)},_={x:(m.width+5+20)*(l?-1:1),y:d.y+d.height-14};return n.jsxs("g",{textAnchor:l?"end":"start",fill:(e=>{switch(e){case i.PASSED:return"#aaa";case i.CURRENT:return"#f00";case i.FUTURE:return"#000"}})(a),transform:`translate(${j.x},${j.y})rotate(-45)`,children:[n.jsx(X,{stnName:t,onUpdate:h,onEnNameUpdate:x}),r&&n.jsx(Z,{stnName:r,onUpdate:f,passed:a===i.PASSED,transform:`translate(${p.x},${p.y})`}),c&&n.jsx(q,{passed:a===i.PASSED,transform:`translate(${z.x},${z.y})`}),o&&n.jsx(K,{passed:a===i.PASSED,temporary:"temp"===o,transform:`translate(${_.x},${_.y})`})]})}function ee(e){const{stnId:t,stnState:r,stnY:a}=e,{theme:o,line_name:d,line_num:h,spanLineNum:m,stn_list:x,loop:g,loop_info:{midpoint_station:f,clockwise:u}}=l((e=>e.param)),j=x[t],p=f===t,[z,_]=s.useState({height:0}),y=s.useRef(null);s.useEffect((()=>{y.current&&_(y.current.getBBox())}),[y.current,a,j.localisedName,j.localisedSecondaryName,j.services]);const S=2===j.parents.length||2===j.children.length,N=a>0||1===j.parents.indexOf(j.branch?.left?.[1]||"")||1===j.children.indexOf(j.branch?.right?.[1]||"")?180:0,w=j.localisedName.en?.split("\\")?.length??1,$=S?180===N?16+12*(w-1)*Math.cos(-45):-9:180===N?-6:(25+15*(w-1))*Math.cos(-45),k=a>0?z.height+23:-z.height-23;return n.jsxs(n.Fragment,{children:[n.jsx(te,{intInfos:S?[{theme:[o[0],o[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:d},...j.transfer.groups[0].lines??[]]:j.transfer.groups[0].lines??[],stnState:g?i.FUTURE:r,tickRotation:N,spanDigits:m}),n.jsx(P,{lineNum:h,stnNum:j.num,strokeColour:o[2],classNames:{digits:"rmg-name__zh"},passed:-1===r,alwaysShowColouredBorder:g,bolderBorder:!0,useSameScale:!0}),n.jsx("g",{ref:y,transform:`translate(${-$},0)`,children:n.jsx(Q,{primaryName:j.localisedName,secondaryName:j.localisedSecondaryName,stationState:r,flipped:180===N,express:j.services.includes(c.express),underConstruction:j.underConstruction})}),p&&n.jsx(G,{transform:`translate(0,${k})`,clockwise:u,anchorAt:a>0?"text":"circle"})]})}const te=e=>n.jsxs(n.Fragment,{children:[n.jsx(ne,{strokeWidth:4,...e}),n.jsx(se,{transform:`translate(0,${180===e.tickRotation?-47:23})`,...e})]}),ne=e=>{const{intInfos:t,stnState:s,tickRotation:r,spanDigits:a,...i}=e;return n.jsx("g",{...i,children:t.map(((e,a)=>n.jsx("use",{xlinkHref:"#inttick",stroke:-1===s?"#aaa":e.theme?.[2],transform:`translate(${-2*(t.length-1)+4*a},0)rotate(${180===r?180:0})`},a)))})},se=e=>{const{intInfos:t,tickRotation:s,stnState:a,spanDigits:i,...l}=e;return n.jsx("g",{...l,children:t.map(((e,t)=>n.jsx("g",{transform:`translate(0,${28*t*(180===s?-1:1)})`,children:n.jsx(D,{zhName:e.name[0],enName:e.name[1],foregroundColour:e.theme?.[3]??r.white,backgroundColour:e.theme?.[2]??"#aaaaaa",passed:-1===a,spanDigits:i,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})},t)))})};function re(e){const{xs:t,ys:s,stnStates:r}=e,{stn_list:a,loop:i}=l((e=>e.param)),{branches:c}=l((e=>e.helper)),o=i?c[0].slice(1,-1):Object.keys(a);return n.jsx("g",{id:"stn_icons",children:o.filter((e=>!["linestart","lineend"].includes(e))).map((e=>n.jsx("g",{style:{transform:`translate(${t[e]}px,${s[e]}px)`},children:n.jsx(ee,{stnId:e,stnState:r[e],stnY:s[e]})},e)))})}const ae=(e,t)=>2===e[t].parents.length||2===e[t].children.length?.25:0,ie=(e,t,n)=>{const s=m("linestart","lineend",t);if(s.nodes.includes(e))return m(s.nodes[1],e,t).len;{const r=n.filter((t=>t.includes(e)))[0];let a=e;for(;!s.nodes.includes(a);)a=r[r.indexOf(a)-1];let i=e;for(;!s.nodes.includes(i);)i=r[r.indexOf(i)+1];const l="linestart"===a,c="lineend"===i;if(r.toString()===n[0].toString()){const n=[];return l||c?l?(n[0]=0,n[1]=m(s.nodes[1],i,t).len,n[2]=m(r[1],e,t).len,n[3]=m(e,i,t).len):(n[0]=m(s.nodes[1],a,t).len,n[1]=m(a,s.nodes.slice(-2)[0],t).len,n[2]=m(a,e,t).len,n[3]=m(e,r.slice(-2)[0],t).len):(n[0]=m(s.nodes[1],a,t).len,n[1]=m(a,i,t).len,n[2]=m(a,e,t).len,n[3]=m(e,i,t).len),n[0]+n[2]*n[1]/(n[2]+n[3])}if(l||c)return l?m(s.nodes[1],i,t).len-m(e,i,t).len:m(s.nodes[1],a,t).len+m(a,e,t).len;{const n=[];return n[0]=m(s.nodes[1],a,t).len,n[1]=m(a,i,t).len,n[2]=m(a,e,t).len,n[3]=m(e,i,t).len,n[0]+n[2]*n[1]/(n[2]+n[3])}}},le=()=>{const{branches:e,routes:t,depsStr:r}=l((e=>e.helper)),[a,i]=s.useState(45),{svgWidth:c,svg_height:f,y_pc:u,padding:j,branchSpacingPct:p,direction:z,line_name:_,spanLineNum:y,current_stn_idx:S,stn_list:N}=l((e=>e.param)),w=s.useRef(null);s.useEffect((()=>{const e=setTimeout((()=>{w.current&&i(w.current.getBBox().width)}),100);return()=>{clearTimeout(e)}}),[w.current,_[0],_[1],y]);const $=h(N,ae,ae),k=s.useMemo((()=>(console.log("computing x shares"),Object.keys(N).reduce(((t,n)=>({...t,[n]:ie(n,$,e)})),{}))),[e.toString(),JSON.stringify($)]),v=m("linestart","lineend",$),B=m(v.nodes[1],v.nodes.slice(-2)[0],$),b=z===o.right?[c[d.RailMap]*j/100+65,c[d.RailMap]*(1-j/100)-20]:[c[d.RailMap]*j/100,c[d.RailMap]*(1-j/100)-65],M=Object.keys(k).reduce(((e,t)=>({...e,[t]:b[0]+k[t]/B.len*(b[1]-b[0])})),{}),R=s.useMemo((()=>(console.log("computing y shares"),Object.keys(N).reduce(((t,n)=>{if(e[0].includes(n))return{...t,[n]:0};{const s=e.slice(1).filter((e=>e.includes(n)))[0];return{...t,[n]:N[s[0]].children.indexOf(s[1])?-2:2}}}),{}))),[r]),A=Object.keys(R).reduce(((e,t)=>({...e,[t]:-R[t]*p*f/200})),{}),W=s.useMemo((()=>x(S,t,z)),[S,z,t.toString()]),C=e.map((e=>g(e,W))).reduce(((e,t)=>(e.main.push(t.main),e.pass.push(t.pass),e)),{main:[],pass:[]}),E=Object.keys(C).reduce(((e,t)=>({...e,[t]:C[t].map((e=>oe(e,M,A)))})),{}),I=a+20;return n.jsxs("g",{id:"main",style:{"--y-percentage":u,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[n.jsx(ce,{paths:E}),n.jsx(re,{xs:M,ys:A,stnStates:W}),n.jsx("g",{className:"line_name",style:{"--translate-x":z===o.right?b[0]-I+"px":`${b[1]+I}px`},children:n.jsx(D,{ref:w,zhName:_[0],enName:_[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",spanDigits:y,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})})]})},ce=s.memo((function(e){return n.jsxs("g",{fill:"none",strokeWidth:4,children:[n.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:e.paths.pass.map(((e,t)=>n.jsx("path",{d:e},t)))}),n.jsx("g",{stroke:"var(--rmg-theme-colour)",children:e.paths.main.map(((e,t)=>n.jsx("path",{d:e},t)))})]})}),((e,t)=>JSON.stringify(e.paths)===JSON.stringify(t.paths))),oe=(e,t,n)=>{let s;const r=[];return e.forEach((e=>{const a=t[e],i=n[e];if(!s&&0!==s)return s=i,void r.push(`M ${a},${i}`);0===i?(i<s&&r.push("H "+(a-40),"a 40,40 0 0,0 40,-40",`V ${i}`),i>s&&r.push("H "+(a-40),"a 40,40 0 0,1 40,40",`V ${i}`)):(i<s&&r.push(`V ${i+40}`,"a 40,40 0 0,1 40,-40",`H ${a}`),i>s&&r.push("V "+(i-40),"a 40,40 0 0,0 40,40",`H ${a}`)),r.push(`H ${a}`),s=i})),r.join(" ").replace(/( H ([\d.]+))+/g," H $2")};function de(e){return n.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black",...e})}function he(e){const{destIds:t,textAnchor:r,...a}=e,i=l((e=>e.param.direction)),c=l((e=>e.param.stn_list)),d=t.map((e=>c[e].localisedName.zh?.length??0)),h=Math.min(...d),m=h>1&&d[0]!==d[1]?Math.abs(d[0]-d[1])/(h-1):0;return n.jsxs("g",{textAnchor:r,...a,children:[t.map(((e,t)=>{const a=d[t]>d[1-t],l=!u()&&"end"===r&&!a;return n.jsxs(s.Fragment,{children:[n.jsx("text",{className:"rmg-name__zh",fontSize:25,x:i===o.left?0:-75,y:42*t-21,letterSpacing:a?"0em":`${m}em`,dx:l?`${m}em`:"0em",children:c[e].localisedName.zh}),n.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:i===o.left?0:-75,y:42*t-1,children:"Towards "+c[e].localisedName.en?.replace("\\"," ")})]},e)})),n.jsx("text",{className:"rmg-name__zh",fontSize:28,x:i===o.left?25*(Math.max(...d)+1):0,y:5,children:"方向"})]})}const me=(e,t,n)=>{const s=Math.min(...Object.values(e)),r=Math.max(...Object.values(e)),a=Math.min(...Object.values(t)),i=Math.max(...Object.values(t))-a,l=i/2;return`M${r},${a} H${s} h-${n/2} a${l},${l} 0 0,0 0,${i} H${r} h${n/2} a${l},${l} 0 0,0 0,-${i}Z`};function xe({currentStationX:e,currentStationY:t,stationGap:s,loopClockwise:r}){const a=t>0?r?-1:1:r?1:-1,i=(s/3-6)*a,l=e+i+6*a,c=(t-12)*-a;return n.jsx("g",{transform:`scale(1,${-a})`,children:n.jsx("path",{d:`M${l},${c} h${i}`,strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function ge({clockwise:e,...t}){return n.jsx("g",{...t,children:n.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:16,children:e?"内环":"外环"}),n.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:e?"Inner Circle":"Outer Circle"})]})})}const fe=2/3,ue=2-fe,je=25*Math.PI/180,pe=Math.asin(Math.sin(35*Math.PI/180)/2);function ze({cxLeft:e,cxRight:t,yGap:s,clockwise:r}){const a=s/2,i=a*(r?fe:ue),l=r?je:pe,c=i*Math.cos(l),o=r?1:-1,d=r?1:0,h=i*Math.sin(l)*o,m=2*h,x={rotate:r?"-4deg":"2deg"};return n.jsxs(n.Fragment,{children:[n.jsxs("g",{transform:`translate(${e},0)`,children:[n.jsx("path",{d:`M${-c},${h} a${i},${i} 0 0,${d} 0,${-m}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:x}),n.jsx(ge,{transform:`translate(${r?0:-2*a},0)`,clockwise:r})]}),n.jsxs("g",{transform:`translate(${t},0)`,children:[n.jsx("path",{d:`M${c},${-h} a${i},${i} 0 0,${d} 0,${m}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:x}),n.jsx(ge,{transform:`translate(${r?0:2*a},0)`,clockwise:r})]})]})}function _e(){const{branches:e}=l((e=>e.helper)),{svgWidth:t,svg_height:r,y_pc:a,padding:c,branchSpacingPct:o,current_stn_idx:h,loop_info:{midpoint_station:m,clockwise:x}}=l((e=>e.param)),g=e[0].slice(1,-1),f=Math.ceil(g.length/2),u=s.useMemo((()=>(console.log("computing x shares"),g.reduce(((e,t,n,s)=>{let r;return n<f?r=f-n-1:(r=n-f,1&s.length&&(r+=.5)),{...e,[t]:r}}),{}))),[g.toString()]),j=o*r*2/100,p=((e,t,n,s)=>{const r=e-(e*(1-2*t/100)*(n-1)/n-s);return[r/2,e-r/2]})(t[d.RailMap],c,f,j),z=(p[1]-p[0])/(f-1),_=Object.keys(u).reduce(((e,t)=>({...e,[t]:p[0]+u[t]*z})),{}),y=s.useMemo((()=>(console.log("computing y shares"),g.reduce(((e,t,n)=>({...e,[t]:n<f?1:-1})),{}))),[g.toString()]),S=Object.keys(y).reduce(((e,t)=>({...e,[t]:-y[t]*j/2})),{}),N=((e,t,n,s)=>{const r=e.indexOf(n),a=e.indexOf(s??n);let l;return l=a<0?e:t?r<=a?[...e.slice(0,r+1),...e.slice(a)]:e.slice(a,r+1):r<a?e.slice(r,a+1):[...e.slice(r),...e.slice(0,a+1)],e.reduce(((e,t,n)=>r===n?{...e,[t]:i.CURRENT}:l.includes(t)?{...e,[t]:i.FUTURE}:{...e,[t]:i.PASSED}),{})})(g,x??!1,h,m);return n.jsxs("g",{id:"main",style:{"--y-percentage":a,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[n.jsx("path",{d:me(_,S,z),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),n.jsx(re,{xs:_,ys:S,stnStates:N}),n.jsx(xe,{currentStationX:_[h],currentStationY:S[h],stationGap:z,loopClockwise:x}),n.jsx(ze,{cxLeft:p[0]-z/2,cxRight:p[1]+z/2,yGap:j,clockwise:x})]})}const ye=d.RailMap,Se=()=>{const{canvasScale:e}=l((e=>e.app)),{svgWidth:t,svg_height:s,direction:r,psd_num:i,info_panel_type:c,notesGZMTR:d,current_stn_idx:h,stn_list:m,theme:x,loop:g}=l((e=>e.param)),u=t[ye],p=m[h];return n.jsxs(f,{type:ye,svgWidth:u,svgHeight:s,canvasScale:e,theme:x,children:[n.jsx(Ne,{}),n.jsx(j,{variant:c,isShowLight:c===a.gz2otis,isShowPSD:c===a.gz2otis&&i}),!g&&(r===o.left&&p.parents.includes("linestart")||r===o.right&&p.children.includes("lineend"))?n.jsx(ke,{}):n.jsxs(n.Fragment,{children:[g?n.jsx(_e,{}):n.jsx(le,{}),!g&&n.jsx(we,{}),d?.map(((e,t)=>n.jsx(ve,{note:e},t)))]}),c===a.gz2otis&&n.jsx("line",{x2:u,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},Ne=s.memo((function(){return n.jsxs("defs",{children:[n.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),n.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:n.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})})),we=()=>{const{routes:e}=l((e=>e.helper)),{direction:t,direction_gz_x:r,direction_gz_y:a,current_stn_idx:i}=l((e=>e.param)),c=s.useMemo((()=>[...new Set(e.reduce(((e,n)=>n.includes(i)?e.concat(n.filter((e=>!["linestart","lineend"].includes(e))).slice(t===o.left?0:-1)[0]):e),[]).filter((e=>e!==i)))]),[i,t,e.toString()]),d={textAnchor:t===o.left?"start":"end",transform:`translate(${t===o.left?65:-65},-5)`,destIds:c};return n.jsxs("g",{id:"direction_gz",style:{"--x-percentage":r,"--y-percentage":a},children:[n.jsx(de,{transform:`scale(0.35)rotate(${t===o.left?0:180})`}),2!==c.length?n.jsx($e,{...d}):n.jsx(he,{...d})]})},$e=e=>{const{destIds:t,...s}=e,r=l((e=>e.param.stn_list));return n.jsxs("g",{...s,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map((e=>r[e].localisedName.zh)).join("/")+"方向"}),n.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map((e=>r[e].localisedName.en?.replace("\\"," "))).join("/")})]})},ke=s.memo((function(){return n.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),n.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),n.jsxs("g",{strokeWidth:8,stroke:"#000",children:[n.jsx("path",{d:"M -160,68 h -160"}),n.jsx("path",{d:"M 160,68 h 160"})]})]})})),ve=s.memo((function(e){const t=s.useRef(null),[r,a]=s.useState({width:0,height:0,y:0});return s.useEffect((()=>{t.current&&a(t.current.getBBox())}),[e.note[0],e.note[1]]),n.jsxs("g",{className:"note-box",style:{"--x-percentage":e.note[2],"--y-percentage":e.note[3]},children:[e.note[4]&&n.jsx("rect",{height:r.height+4,width:r.width+4,x:-2,y:r.y-2,fill:"none",stroke:"black",strokeWidth:.5}),n.jsxs("g",{ref:t,children:[n.jsx("g",{fontSize:16,letterSpacing:1.2,children:e.note[0].split("\n").map(((e,t)=>n.jsx("text",{className:"rmg-name__zh",y:18*t,children:e},t)))}),n.jsx("g",{fontSize:10,letterSpacing:.33,transform:`translate(0,${18*e.note[0].split("\n").length})`,children:e.note[1].split("\n").map(((t,s)=>n.jsx("text",{className:"rmg-name__en",y:11*s,textLength:s<(e.note[1].match(/\n/g)?.length||0)?r.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:t},s)))})]})]})}),((e,t)=>e.note.toString()===t.note.toString())),Be=s.memo((function(e){const{stnName:t,panelType:r,onUpdate:a}=e,i=s.useRef(null),l=((e,t)=>{switch(t){case 2:return"gz11"===e?.2:.5;case 3:return.1;default:return 0}})(r,t.zh?.length);return s.useEffect((()=>{if(i.current&&a){const e=i.current.getBBox();a({...e,x:e.x+92*l/2,width:e.width-92*l})}}),[i.current,JSON.stringify(t),r]),n.jsxs("g",{ref:i,fontWeight:"gz11"===r?"bold":"normal",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:92,x:l/2+"em",letterSpacing:l+"em",children:t.zh}),n.jsx("g",{fontSize:40,children:t.en?.split("\\")?.map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:72+42*t,children:e},t)))})]})}),((e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName)&&e.panelType===t.panelType)),be=e=>{const{secondaryName:t,transform:r}=e,a=s.useRef(null),[i,l]=s.useState({x:0,width:0});return s.useEffect((()=>{a.current&&l(a.current.getBBox())}),[t.toString()]),n.jsxs("g",{transform:r,children:[n.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[n.jsx("text",{textAnchor:"end",x:i.x-3,className:"rmg-name__zh",children:"("}),n.jsx("text",{textAnchor:"start",x:i.width+i.x+3,className:"rmg-name__zh",children:")"})]}),n.jsxs("g",{ref:a,textAnchor:"middle",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),n.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},Me=(e,t,n)=>{const{stn_list:s,current_stn_idx:r,direction:a,loop:i,loop_info:{midpoint_station:l,clockwise:c}}=e;return i?Ae(t[0].slice(1,-1),s,r,l,c):Re(n,s,r,a)},Re=(e,t,n,s)=>{const r="l"===s?"parents":"children",a=t[n][r].map((e=>t[e].underConstruction?t[e][r]:e)).flat(),i=e.find((e=>e.includes(n)&&e.includes(a[0])));if(i){const e=i.indexOf(n),r=("l"===s?i.slice(0,e).toReversed():i.slice(e+1)).filter((e=>!["linestart","lineend"].includes(e))).reduce(((e,n)=>t[n].transfer.groups[0].lines?.length?[...e,n]:e),[]).slice(0,3);return{nextStations:a,viaStations:r}}return{nextStations:a,viaStations:[]}},Ae=(e,t,n,s,r)=>{const a=e.filter((e=>!t[e].underConstruction)),i=r?a.toReversed():a,l=i.indexOf(n),c=[...i,...i].slice(l+1),o=[c[0]],d=c.slice(1).reduce(((e,n)=>t[n].transfer.groups[0].lines?.length||t[n].loop_pivot?[...e,n]:e),[]);return{nextStations:o,viaStations:s?[...d.slice(0,2),s]:d.slice(0,3)}},We=s.forwardRef((function({stationInfo:e,...t},a){const{localisedName:i,transfer:{groups:[{lines:l}]}}=e,[c,o]=s.useState({width:0}),d=s.useRef(null);return s.useEffect((()=>{d.current&&o(d.current.getBBox())}),[d.current,JSON.stringify(i)]),n.jsxs("g",{ref:a,...t,children:[n.jsxs("g",{ref:d,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:20,children:i.zh}),i.en?.split("\\")?.map(((e,t)=>n.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*t,children:e},t)))]}),n.jsx("g",{transform:`translate(${c.width+2},7)`,children:l?.length&&n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M0,0 H8",stroke:l[0].theme?.[2]??"#aaa",strokeWidth:3.5}),n.jsx(D,{zhName:l[0].name[0],enName:l[0].name[1],backgroundColour:l[0].theme?.[2]??"#aaa",foregroundColour:l[0].theme?.[3]??r.white,spanDigits:!0,transform:"translate(27,-8.5)scale(0.75)",classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})]})})]})}));function Ce({viaStations:e,stationList:t}){const r=s.useRef([]),[a,i]=s.useState([]);s.useEffect((()=>{r.current=[]}),[e,t]),s.useEffect((()=>{i(r.current.map((e=>e?.getBBox()?.height??0)))}),[r.current]);const l=s.useCallback((e=>a.slice(0,e).reduce(((e,t)=>e+t+4),0)),[a]);return n.jsx(n.Fragment,{children:e.map(((e,s)=>n.jsx(We,{ref:e=>r.current[s]=e,stationInfo:t[e],transform:`translate(0,${l(s)})`},e)))})}function Ee({nameBBox:e}){const t=l((e=>e.param)),{svg_height:s,svgWidth:r,direction:a,current_stn_idx:i,stn_list:c}=t,{branches:h,routes:m}=l((e=>e.helper)),x=r[d.RunIn],{nextStations:[g],viaStations:f}=Me(t,h,m),{localisedName:{en:u=""},localisedSecondaryName:j}=c[i],{localisedName:{zh:p="",en:z=""}}=c[g],_=z.split("\\").length,y=(x-e.width)/2,S={x:80},N={x:154.8},w={dy:75+25*(_-1)},$={x:a===o.left?(115+50*(.5+p.length)+y)/2-20:((x+e.width)/2+(.82*x-60))/2+30,y:.5*s-18*(u.split("\\").length-2)-(j?29:0),rotate:a===o.left?0:180};return n.jsxs(n.Fragment,{children:[n.jsxs("g",{transform:`translate(0,${s/2+5-w.dy})`,children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${S.x},0)`,children:[n.jsxs("g",{fontWeight:"bold",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:44,children:"下站"}),n.jsx("text",{className:"rmg-name__en",fontSize:25,dy:40,children:"Next"})]}),n.jsxs("g",{transform:`translate(0,${w.dy})`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),n.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),n.jsxs("g",{textAnchor:"start",transform:`translate(${N.x},0)`,children:[n.jsxs("g",{fontWeight:"bold",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:44,children:p}),n.jsx("g",{fontSize:25,children:z.split("\\").map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:40+25*t,children:e},t)))})]}),f&&n.jsx("g",{transform:`translate(0,${w.dy})`,children:n.jsx(Ce,{viaStations:f,stationList:c})})]})]}),n.jsx(de,{transform:`translate(${$.x},${$.y})scale(0.4)rotate(${$.rotate})`})]})}function De({secName:e,...t}){const{zh:r,en:a}=e,i=s.useRef(null),[l,c]=s.useState({x:0,width:0});return s.useEffect((()=>{i.current&&c(i.current.getBBox())}),[r,a]),n.jsxs("g",{...t,children:[n.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[n.jsx("text",{textAnchor:"end",x:l.x-3,className:"rmg-name__zh",children:"("}),n.jsx("text",{textAnchor:"start",x:l.width+l.x+3,className:"rmg-name__zh",children:")"})]}),n.jsxs("g",{ref:i,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:18,children:r}),n.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:a})]})]})}function Ie({nextId:e,nameBBox:t,ignoreNumWidth:r}){const{svgWidth:a,svg_height:i,direction:c}=l((e=>e.param)),h=l((t=>t.param.stn_list[e])),{localisedName:m,localisedSecondaryName:x}=h,{zh:g="",en:f=""}=m,u=a[d.RunIn],[j,p]=s.useState({width:0}),z=s.useRef(null);s.useEffect((()=>{z.current&&p(z.current.getBBox())}),[g,f]);const _=g.length,y=(u-t.width)/2,S={x:c===o.left?80:u-45-j.width-35*(_<=2?2:1.5)},N={x:c===o.left?80+35*(_<=2?2:1.5):u-45-j.width},w={x:c===o.left?(115+35*((_<=2?1:.5)+_)+y)/2-20:(u-45-j.width-(_<=2?105:87.5)+y+t.width+(r?0:80.9))/2+20,y:i/2-30,rotate:c===o.left?0:180};return n.jsxs(n.Fragment,{children:[n.jsxs("g",{transform:`translate(0,${i/2-40})`,children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${S.x},0)`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),n.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),n.jsxs("g",{textAnchor:"start",ref:z,transform:`translate(${N.x},0)`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:35,children:g}),n.jsx("g",{fontSize:17,children:f.split("\\").map(((e,t)=>n.jsx("text",{className:"rmg-name__en",dy:30+17*t,children:e},t)))})]}),x&&n.jsx("g",{textAnchor:"middle",transform:`translate(${N.x},0)`,children:n.jsx(De,{secName:x,transform:`translate(${j.width/2},${30+17*f.split("\\").length+5})`})})]}),n.jsx(de,{transform:`translate(${w.x},${w.y})scale(0.25)rotate(${w.rotate})`})]})}const Oe=()=>{const e=l((e=>e.param)),{svg_height:t,svgWidth:r,theme:i,direction:c,info_panel_type:h,line_num:m,current_stn_idx:x,stn_list:g}=e,{branches:f,routes:u}=l((e=>e.helper)),j=g[x],{localisedName:p,localisedSecondaryName:z}=j,[_,y]=s.useState({width:0}),S=p.en?.split("\\")?.length??1,{nextStations:N}=Me(e,f,u),w=[a.gz7w,a.gz11].includes(h),$={name:`translate(${(c===o.left?1:-1)*r[d.RunIn]/4},45)`,next:`translate(${(c===o.left?1:-1)*r[d.RunIn]/10},45)`},k=(r[d.RunIn]+_.width)/2+55,v={x:r.runin/2,y:.5*t-50-18*(S-1)-(z?29:0)},B={x:0,y:70+36*S},b={x:k,y:.5*t-30-18*(S-1)-(z?29:0)},M={x:c===o.left?k:(r[d.RunIn]-_.width)/2-55,y:.5*t-18*(S-2)-(z?29:0)};return n.jsxs("g",{children:[n.jsxs("g",{transform:h===a.gz2otis?$.name:"",children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${v.x},${v.y})`,children:[n.jsx(Be,{stnName:p,panelType:h,onUpdate:y}),z&&n.jsx(be,{secondaryName:z,transform:`translate(${B.x},${B.y})`})]}),n.jsx(P,{lineNum:m,stnNum:j.num,strokeColour:i[2],classNames:{digits:"rmg-font__en"},transform:w?`translate(${M.x},${M.y})`:`translate(${b.x},${b.y})`,size:"lg"})]}),h===a.gz11?n.jsx(Ee,{nameBBox:_}):n.jsx("g",{transform:h===a.gz2otis?$.next:"",children:!N||N.includes("linestart")||N.includes("lineend")?n.jsx(n.Fragment,{}):1===N.length?n.jsx(Ie,{nextId:N[0],nameBBox:_,ignoreNumWidth:w}):n.jsx(Pe,{nextIds:N,nameBBox:_,ignoreNumWidth:w})})]})},Pe=e=>{const{nextIds:t,nameBBox:r,ignoreNumWidth:a}=e,{routes:i}=l((e=>e.helper)),{svgWidth:c,svg_height:h,direction:m,stn_list:x}=l((e=>e.param)),g=c[d.RunIn],f=t.map((e=>x[e].localisedName)),[u,j]=s.useState({width:0}),p=s.useRef([]);s.useEffect((()=>{j((e=>({...e,width:0}))),p.current.forEach((e=>{const t=e?.getBBox();j((e=>t?e.width>t.width?e:t:e))}))}),[f.toString()]);const z=e.nextIds.map((e=>i.reduce(((t,n)=>n.includes(e)?t.concat(n.filter((e=>!["linestart","lineend"].includes(e))).slice(m===o.left?0:-1)[0]):t),[]))),_=Math.max(...f.map((e=>e.zh?.length??0))),y=(g-r.width)/2,S={x:m===o.left?72:g-45-u.width-41},N={x:m===o.left?113:g-45-u.width},w={x:m===o.left?(99+27*(1+_)+y)/2-20:(g-45-u.width-41-27+y+e.nameBBox.width+(a?0:80.9))/2+20,y:h/2-30,rotate:m===o.left?0:180};return n.jsxs(n.Fragment,{children:[n.jsx("g",{transform:`translate(0,${h/2-70})`,children:f.map(((e,t)=>n.jsxs(s.Fragment,{children:[n.jsxs("g",{textAnchor:"middle",transform:`translate(${S.x},${110*t})`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:27,children:"下站"}),n.jsx("text",{className:"rmg-name__en",fontSize:13,y:22,children:"Next"})]}),n.jsxs("g",{ref:e=>p.current[t]=e,textAnchor:"start",transform:`translate(${N.x},${110*t})`,children:[n.jsx("text",{className:"rmg-name__zh",fontSize:27,children:e.zh}),e.en?.split("\\")?.map(((e,t)=>n.jsx("text",{className:"rmg-name__en",fontSize:13,y:22+13*t,children:e},t))),n.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:z[t].map((e=>x[e].localisedName.zh)).join("/")+"方向"}),n.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+z[t].map((e=>x[e].localisedName.en)).join("/").replace("\\"," ")})]})]},t)))}),n.jsx(de,{transform:`translate(${w.x},${w.y})scale(0.25)rotate(${w.rotate})`})]})};function He(e){const{num:t,...s}=e;return n.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...s,children:[n.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),n.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),n.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),n.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function Fe(e){const{canvasType:t}=e,{svgWidth:s,svg_height:r}=l((e=>e.param));return n.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[n.jsx("line",{y2:r,transform:`translate(${s[t]/2},0)`}),n.jsx("line",{x2:s[t],transform:"translate(0,90)"})]})}function Te({coachNumber:e,...t}){return n.jsxs("g",{...t,children:[n.jsx("path",{d:"M-30,-30 a30,30 0 0,0 0,60 h60 a30,30, 0 0,0 0,-60Z",fill:"whitesmoke",stroke:"lightgrey"}),n.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[n.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),n.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),n.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:n.jsx("text",{className:"rmg-name__zh",fontSize:36,children:e})})]})}const Ue=d.RunIn;function Le(){const{canvasScale:e}=l((e=>e.app)),{svgWidth:t,svg_height:s,direction:r,info_panel_type:i,platform_num:c,psd_num:d,coachNum:h,theme:m}=l((e=>e.param)),x=t[Ue],g=[a.gz7w,a.gz11].includes(i),u=g?s-78:s/2-30,p={platform:`translate(${r===o.left?50:-50},45)`};return n.jsxs(f,{type:Ue,svgWidth:x,svgHeight:s,canvasScale:e,theme:m,children:[n.jsx(j,{variant:i,isShowLight:i!==a.gz2otis,isShowPSD:i!==a.gz2otis&&d}),n.jsx("g",{transform:i===a.gz2otis?p.platform:"",children:n.jsx(He,{num:c,style:{"--translate-x":(r===o.left||i===a.gz11?x-100:100)+"px","--translate-y":u+"px","--scale":g?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),g&&n.jsx(Te,{coachNumber:h,transform:`translate(${.82*x},${.58*s})`}),n.jsx(Oe,{}),i===a.gz2otis&&n.jsx(Fe,{canvasType:Ue})]})}e("default",{runin:n.jsx(Le,{}),railmap:n.jsx(Se,{})})}}}));
