import{ag as E,u as F,j as o,B as H,h as L,ao as y}from"./chakra-CXrhlirJ.js";import{d as P,u as f,e as g,aV as M,h as W,ab as G,aa as B,ac as O,aW as Z}from"./index-BqOgmhc6.js";import{u as _,a}from"./react-Caefwd5V.js";import{g as $,R as V}from"./app-router-Dyjxcbfz.js";import{A as q}from"./ag-grid-react-A6BSx5P9.js";import{M as J,v as K,w as Q}from"./ag-grid-community-TcQKCcyM.js";import"./param-selector-B7mXBf6L.js";var U=function(d){var l=d.children,t=E().colorMode,c=F("RmgAgGrid");return o.jsx(H,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:c,children:l})};function X(d){const{lineNumber:l,stationNumber:t,lineColour:c}=d,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:c,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return o.jsxs(L,{sx:i,children:[o.jsx("span",{children:l}),o.jsx("span",{children:t})]})}J.registerModules([K]);Q({theme:"legacy"});function re(d){const{branchIndex:l}=d,{t,i18n:c}=_(),i=P(),x=f(e=>e.app.sidePanelMode),{style:u,theme:R,stn_list:S,line_num:b,coline:j}=f(e=>e.param),w=f(e=>e.helper.branches),[A,v]=a.useState([]);a.useEffect(()=>{const e=w[l].reduce((n,s)=>["linestart","lineend"].includes(s)?n:[...n,{...S[s],id:s,rowSpan:i($(s,l))}],[]);v(e)},[w,l,S]);const T=a.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:e})=>o.jsx(X,{lineNumber:b,stationNumber:e,lineColour:R[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(u)},{headerName:t("Chinese name"),field:"localisedName",valueFormatter:({value:e,data:n})=>{var s;return e.zh+(u===g.GZMTR&&((s=n==null?void 0:n.localisedSecondaryName)!=null&&s.zh)?" (".concat(n.localisedSecondaryName.zh,")"):"")}},{headerName:t("English name"),field:"localisedName",cellRenderer:({value:e,data:n})=>{var s;return o.jsx(V,{text:e.en+(u===g.GZMTR&&((s=n.localisedSecondaryName)!=null&&s.en)?" (".concat(n.localisedSecondaryName.en,")"):"")})},minWidth:300},{headerName:t("StationAgGrid.interchange"),field:"transfer",cellRenderer:({value:e})=>o.jsx(y,{children:e.groups.map(n=>{var s;return(s=n.lines)!=null?s:[]}).flat().map((n,s)=>{var r,h,C,N;return o.jsx(M,{name:n.name,bg:(h=(r=n.theme)==null?void 0:r[2])!=null?h:"#aaaaaa",fg:(N=(C=n.theme)==null?void 0:C[3])!=null?N:W.white,showShortName:!0},s)})})},{headerName:t("StationAgGrid.coline"),field:"rowSpan",rowSpan:({data:e})=>{var n;return(n=e==null?void 0:e.rowSpan[0])!=null?n:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({value:e})=>e[0]>0},cellRenderer:({value:e})=>{var n,s;return o.jsx(y,{children:(s=(n=j[e[1]])==null?void 0:n.colors)==null?void 0:s.map((r,h)=>o.jsx(M,{name:[r[4],r[5]],bg:r[2],fg:r[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(u)}],[u,R.toString(),c.language,b]),m=a.useRef(null),p=a.useRef(!1);a.useEffect(()=>{p.current&&m.current&&m.current.api.getSelectedRows().length===1&&x!==G.STATION&&m.current.api.deselectAll()},[p.current,x]);const[k]=a.useState({resizable:!0}),I=a.useCallback(()=>{p.current=!0},[p.current]),z=a.useCallback(({api:e})=>{var s;const n=(s=e.getSelectedRows())==null?void 0:s.map(r=>r.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",n),n!=null&&n.length&&(i(B(G.STATION)),i(O(n[0])),i(Z(void 0)))},[]),D=a.useCallback(({data:e})=>e.id,[]);return o.jsx(U,{children:o.jsx(q,{ref:m,rowData:A,defaultColDef:k,columnDefs:T,getRowId:D,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:"single",onSelectionChanged:z,onGridReady:I,debug:!1})})}export{re as default};
