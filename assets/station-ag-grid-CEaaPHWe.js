import{ag as E,u as F,j as s,B as H,h as L,ao as y}from"./chakra-wEho0Aiu.js";import{d as P,u as f,e as g,aZ as M,h as Z,a5 as G,a4 as B,ab as O,a_ as W}from"./index-B6-LLgdY.js";import{u as _,a}from"./react-Caefwd5V.js";import{g as $,R as q}from"./app-router-CnGwhWnE.js";import{A as J}from"./ag-grid-react-A6BSx5P9.js";import{M as K,v as Q,w as U}from"./ag-grid-community-TcQKCcyM.js";import"./param-selector-BE4ZnRJx.js";var V=function(d){var l=d.children,t=E().colorMode,c=F("RmgAgGrid");return s.jsx(H,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:c,children:l})};function X(d){const{lineNumber:l,stationNumber:t,lineColour:c}=d,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:c,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return s.jsxs(L,{sx:i,children:[s.jsx("span",{children:l}),s.jsx("span",{children:t})]})}K.registerModules([Q]);U({theme:"legacy"});const Y={mode:"singleRow",checkboxes:!1,enableClickSelection:!0};function le(d){const{branchIndex:l}=d,{t,i18n:c}=_(),i=P(),S=f(e=>e.app.sidePanelMode),{style:u,theme:x,stn_list:R,line_num:b,coline:j}=f(e=>e.param),w=f(e=>e.helper.branches),[A,v]=a.useState([]);a.useEffect(()=>{const e=w[l].reduce((n,o)=>["linestart","lineend"].includes(o)?n:[...n,{...R[o],id:o,rowSpan:i($(o,l))}],[]);v(e)},[w,l,R]);const T=a.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:e})=>s.jsx(X,{lineNumber:b,stationNumber:e,lineColour:x[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(u)},{headerName:t("Chinese name"),field:"localisedName",valueFormatter:({value:e,data:n})=>{var o;return e.zh+(u===g.GZMTR&&((o=n==null?void 0:n.localisedSecondaryName)!=null&&o.zh)?" (".concat(n.localisedSecondaryName.zh,")"):"")}},{headerName:t("English name"),cellRenderer:({data:e})=>{var n;return s.jsx(q,{text:e.localisedName.en+(u===g.GZMTR&&((n=e.localisedSecondaryName)!=null&&n.en)?" (".concat(e.localisedSecondaryName.en,")"):"")})},minWidth:300},{headerName:t("StationAgGrid.interchange"),cellRenderer:({data:e})=>s.jsx(y,{children:e.transfer.groups.map(n=>{var o;return(o=n.lines)!=null?o:[]}).flat().map((n,o)=>{var r,h,C,N;return s.jsx(M,{name:n.name,bg:(h=(r=n.theme)==null?void 0:r[2])!=null?h:"#aaaaaa",fg:(N=(C=n.theme)==null?void 0:C[3])!=null?N:Z.white,showShortName:!0},o)})})},{headerName:t("StationAgGrid.coline"),rowSpan:({data:e})=>{var n;return(n=e==null?void 0:e.rowSpan[0])!=null?n:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({data:e})=>!!e&&e.rowSpan[0]>0},cellRenderer:({data:e})=>{var n,o;return s.jsx(y,{children:(o=(n=j[e.rowSpan[1]])==null?void 0:n.colors)==null?void 0:o.map((r,h)=>s.jsx(M,{name:[r[4],r[5]],bg:r[2],fg:r[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(u)}],[u,x.toString(),c.language,b]),m=a.useRef(null),p=a.useRef(!1);a.useEffect(()=>{p.current&&m.current&&m.current.api.getSelectedRows().length===1&&S!==G.STATION&&m.current.api.deselectAll()},[p.current,S]);const[k]=a.useState({resizable:!0}),I=a.useCallback(()=>{p.current=!0},[p.current]),z=a.useCallback(({api:e})=>{var o;const n=(o=e.getSelectedRows())==null?void 0:o.map(r=>r.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",n),n!=null&&n.length&&(i(B(G.STATION)),i(O(n[0])),i(W(void 0)))},[]),D=a.useCallback(({data:e})=>e.id,[]);return s.jsx(V,{children:s.jsx(J,{ref:m,rowData:A,defaultColDef:k,columnDefs:T,getRowId:D,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:Y,onSelectionChanged:z,onGridReady:I,debug:!1})})}export{le as default};
