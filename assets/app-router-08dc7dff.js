import{z as J,r as me,l as b,F as Te,a5 as _t,a4 as un,g as oe,j as $,a9 as Ee,H as we,aa as ge,N as Mn,ab as We,ac as Kt,C as Ie,ad as hn,L as mt,ae as Jt,M as Ae,af as mn,h as Nn,k as Fe,m as Be,n as Me,o as Ne,p as Ve,q as He,V as gt,ag as jt,ah as Ft,ai as qe,aj as Bt,ak as pt,y as Ye,x as ot,t as Ot,I as Vn,v as Hn,B as ue,K as De,al as Un,am as Ze,J as Le,an as je,ao as Rt,ap as Wn,aq as vt,ar as lt,as as Mt,at as Ue,u as Nt,au as Tt,av as Pt,aw as Xt,ax as pn,ay as fn,az as Zn,a7 as Ke,aA as Vt,aB as Ht,aC as Gn,aD as $n,aE as Yn,aF as qn,aG as Kn,aH as Jn,aI as Xn,aJ as Qn,aK as ut,P as er,Q as tr,aL as nr,U as rr,W as Qt,aM as sr,aN as ir,aO as ar,aP as or,aQ as lr,aR as cr,aS as dr,aT as ur,aU as _n,aV as Ct,aW as hr,aX as mr,aY as pr,aZ as fr,a_ as _r,a$ as gn,b0 as gr,b1 as vr}from"./vendor-40a796df.js";import{_ as O,u as te,E as be,a as ve,b as yr,R as ee,c as en,d as tn,S as Je,e as br,f as nn,g as Sr,h as rn,r as wr,i as Er,j as zt,F as xe,k as Ar,l as kr,m as Or,n as Rr,o as Tr,p as Pr,B as ft,D as Oe,q as Cr,s as zr,t as xr,v as Ut,w as Ir,x as Dr,y as Lr,z as jr,A as Fr,C as Br,G as Mr,P as vn,H as yn,I as sn,J as Nr,K as Vr,L as Hr,M as Ur,N as Wr,O as Zr,Q as Gr,T as $r,U as St,V as Yr,W as qr,X as Kr,Y as Jr,Z as Xr,$ as Qr,a0 as es,a1 as ts,a2 as Ge,a3 as Xe,a4 as Qe,a5 as $e,a6 as bn,a7 as xt,a8 as It,a9 as ns,aa as rs,ab as an,ac as Sn,ad as wn,ae as ss,af as is,ag as as,ah as os,ai as ls,aj as wt,ak as cs,al as Et,am as At,an as it,ao as ds,ap as us}from"./index-4badbb40.js";const hs={mtr:()=>O(()=>import("./index-29210f32.js"),["assets/index-29210f32.js","assets/vendor-40a796df.js","assets/index-4badbb40.js","assets/index-c7ec3755.css","assets/share-6dcf0cee.js","assets/mtr-8420daf1.js"]),gzmtr:()=>O(()=>import("./index-d4fc1de5.js"),["assets/index-d4fc1de5.js","assets/vendor-40a796df.js","assets/index-4badbb40.js","assets/index-c7ec3755.css","assets/share-6dcf0cee.js"]),shmetro:()=>O(()=>import("./index-5f343177.js"),["assets/index-5f343177.js","assets/vendor-40a796df.js","assets/index-4badbb40.js","assets/index-c7ec3755.css","assets/share-6dcf0cee.js","assets/mtr-8420daf1.js"])};function ms(e){const[p,r]=J.useState({});return J.useEffect(()=>(hs[e]().then(l=>{r(l.default)}).catch(l=>{console.error(`Failed to load canvas for style ${e}`,l),r({})}),()=>{r({})}),[e]),p}const ps={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function fs(){const{canvasToShow:e,canvasScale:p}=te(t=>t.app),{svg_height:r,style:l}=te(t=>t.param),o=ms(l);J.useEffect(()=>{document.getElementById("css_share").href=`/rmg/styles/share_${l}.css`,me.event(be.STYLE_CHANGE,{style:l})},[l]);const n=Object.keys(o).filter(t=>e.includes(t)),s=r*p;return b(Te,{minH:s,sx:ps,children:Object.keys(o).length===0?b(_t,{isIndeterminate:!0}):n.map(t=>b(un,{sx:{minWidth:750,height:s},children:o[t]},t+l))})}function _s(){const{t:e}=oe(),p=ve(),r=te(i=>i.app.selectedStation);console.log("InfoSection:: Rendering for",r);const l=te(i=>i.param.style),{num:o,name:n,secondaryName:s}=te(i=>i.param.stn_list[r]),t=[{type:"input",label:e("StationSidePanel.info.num"),value:o,placeholder:"01",onChange:i=>p(yr(r,i)),hidden:![ee.GZMTR].includes(l)},{type:"input",label:e("Chinese name"),value:n[0],onChange:i=>p(en(r,[i,n[1]]))},{type:"input",label:e("English name"),value:n[1],onChange:i=>p(en(r,[n[0],i]))},{type:"input",label:e("StationSidePanel.info.zhSecondary"),value:s?s[0]:"",placeholder:"1å·èˆªç«™æ¥¼",onChange:i=>p(tn(r,[i,s?s[1]:""])),hidden:![ee.GZMTR].includes(l)},{type:"input",label:e("StationSidePanel.info.enSecondary"),value:s?s[1]:"",placeholder:"Terminal 1",onChange:i=>p(tn(r,[s?s[0]:"",i])),hidden:![ee.GZMTR].includes(l)}];return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("StationSidePanel.info.title")}),b(ge,{fields:t,minW:130})]})}const En=(e,p)=>{const r=e[p];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((l,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+p)))})};function gs(e){const{countryCode:p,svgFilename:r}=e,[l,o]=J.useState(void 0);return J.useEffect(()=>{r&&En(Object.assign({"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1F9.svg":()=>O(()=>import("./1F1E6-1F1F9-a3474a87.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1FF.svg":()=>O(()=>import("./1F1E6-1F1FF-c961f61f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1EA.svg":()=>O(()=>import("./1F1E7-1F1EA-87b63ce0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1F4.svg":()=>O(()=>import("./1F1E7-1F1F4-8e88acbd.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1F7.svg":()=>O(()=>import("./1F1E7-1F1F7-2e5da46f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1E6.svg":()=>O(()=>import("./1F1E8-1F1E6-572cf376.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1F1.svg":()=>O(()=>import("./1F1E8-1F1F1-bb957357.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1F3.svg":()=>O(()=>import("./1F1E8-1F1F3-866d09b5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E9-1F1EA.svg":()=>O(()=>import("./1F1E9-1F1EA-2bcac591.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E9-1F1F0.svg":()=>O(()=>import("./1F1E9-1F1F0-130b3df9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EA-1F1EC.svg":()=>O(()=>import("./1F1EA-1F1EC-190b639e.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EA-1F1F8.svg":()=>O(()=>import("./1F1EA-1F1F8-e9f6e238.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EB-1F1F7.svg":()=>O(()=>import("./1F1EB-1F1F7-12f823eb.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EC-1F1F7.svg":()=>O(()=>import("./1F1EC-1F1F7-d16bd178.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1ED-1F1F0.svg":()=>O(()=>import("./1F1ED-1F1F0-1346b158.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1ED-1F1FA.svg":()=>O(()=>import("./1F1ED-1F1FA-e44befe3.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1E9.svg":()=>O(()=>import("./1F1EE-1F1E9-256ea73c.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F3.svg":()=>O(()=>import("./1F1EE-1F1F3-44d109aa.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F7.svg":()=>O(()=>import("./1F1EE-1F1F7-c924004a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F9.svg":()=>O(()=>import("./1F1EE-1F1F9-38eff108.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EF-1F1F5.svg":()=>O(()=>import("./1F1EF-1F1F5-93518547.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F0-1F1F7.svg":()=>O(()=>import("./1F1F0-1F1F7-4e778503.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1F4.svg":()=>O(()=>import("./1F1F2-1F1F4-bb2225c7.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1FD.svg":()=>O(()=>import("./1F1F2-1F1FD-31d458ab.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1FE.svg":()=>O(()=>import("./1F1F2-1F1FE-9d12ac27.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F3-1F1F4.svg":()=>O(()=>import("./1F1F3-1F1F4-36b22a7a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1EA.svg":()=>O(()=>import("./1F1F5-1F1EA-2359ab5b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1F1.svg":()=>O(()=>import("./1F1F5-1F1F1-56d472c9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1F9.svg":()=>O(()=>import("./1F1F5-1F1F9-48f96f04.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F7-1F1F4.svg":()=>O(()=>import("./1F1F7-1F1F4-a774c3a2.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F7-1F1FA.svg":()=>O(()=>import("./1F1F7-1F1FA-3b81f8de.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1E6.svg":()=>O(()=>import("./1F1F8-1F1E6-481d8837.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1EA.svg":()=>O(()=>import("./1F1F8-1F1EA-3583e0b5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1EC.svg":()=>O(()=>import("./1F1F8-1F1EC-2b92413d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1ED.svg":()=>O(()=>import("./1F1F9-1F1ED-0757641b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1F7.svg":()=>O(()=>import("./1F1F9-1F1F7-f7cf6b4a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1FC.svg":()=>O(()=>import("./1F1F9-1F1FC-82e8fcc5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1E6.svg":()=>O(()=>import("./1F1FA-1F1E6-fc868471.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1F3.svg":()=>O(()=>import("./1F1FA-1F1F3-dddb091b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1F8.svg":()=>O(()=>import("./1F1FA-1F1F8-47f8491b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1FF.svg":()=>O(()=>import("./1F1FA-1F1FF-0989e0a8.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FB-1F1EA.svg":()=>O(()=>import("./1F1FB-1F1EA-8edd6b29.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FB-1F1F3.svg":()=>O(()=>import("./1F1FB-1F1F3-2e88414b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F3F4-E0067-E0062-E0065-E006E-E0067-E007F.svg":()=>O(()=>import("./1F3F4-E0067-E0062-E0065-E006E-E0067-E007F-8302e24f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F3F4-E0067-E0062-E0073-E0063-E0074-E007F.svg":()=>O(()=>import("./1F3F4-E0067-E0062-E0073-E0063-E0074-E007F-a5d75104.js"),[])}),`../../../../node_modules/@railmapgen/rmg-palette-resources/flags/${r.slice(0,-4)}.svg`).then(n=>n.default).then(o).catch(n=>console.error(`Failed to find SVG file ${r} as ${n==null?void 0:n.message}`))},[r]),l?b(Mn,{src:l,alt:`Flag of ${p}`,h:17,mr:1}):b(We,{})}function vs(e){const{defaultValueId:p,onChange:r}=e,{i18n:l}=oe(),o=p?Kt.find(c=>c.id===p):void 0,n=c=>{var g,u;return(u=(g=l.languages.map(f=>c.name[f]).find(f=>f!==void 0))!=null?g:c.name.en)!=null?u:""},s=c=>{var m,y;const g=c.country==="TW"&&[mt.ChineseSimp,mt.ChineseCN].includes(l.languages[0]),u=["Win32","Win64"].includes(navigator.platform),f=l.languages.map(v=>c.name[v]).find(v=>v!==void 0),d=(m=Jt.find(v=>v.id===c.country))==null?void 0:m.flagSvg,_=(y=Jt.find(v=>v.id===c.country))==null?void 0:y.flagEmoji;return $(We,{children:[g?b("span",{children:"ðŸ´Â "}):u?b(gs,{countryCode:c.country,svgFilename:d}):$("span",{children:[_,"Â "]}),f]})},t=(c,g)=>Object.values(c.name).some(u=>u.includes(g)),i=Kt.slice().sort((c,g)=>c.id===Ie.Other?1:g.id===Ie.Other?-1:n(c).localeCompare(n(g),l.languages[0]));return b(hn,{data:i,displayValue:n,displayHandler:s,predicate:t,defaultValue:o,onChange:c=>r==null?void 0:r(c.id)})}const ys=e=>{const[p,r]=J.useState([]);return J.useEffect(()=>{En(Object.assign({"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ankara.js":()=>O(()=>import("./ankara-4ed9ce70.js"),["assets/ankara-4ed9ce70.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/athens.js":()=>O(()=>import("./athens-eab5dca8.js"),["assets/athens-eab5dca8.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/baku.js":()=>O(()=>import("./baku-bae24922.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bangkok.js":()=>O(()=>import("./bangkok-24cc66a7.js"),["assets/bangkok-24cc66a7.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/barcelona.js":()=>O(()=>import("./barcelona-9746292d.js"),["assets/barcelona-9746292d.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/beijing.js":()=>O(()=>import("./beijing-68434a03.js"),["assets/beijing-68434a03.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/berlin.js":()=>O(()=>import("./berlin-b3beb8d8.js"),["assets/berlin-b3beb8d8.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bonn.js":()=>O(()=>import("./bonn-8f614dcf.js"),["assets/bonn-8f614dcf.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/boston.js":()=>O(()=>import("./boston-899702fa.js"),["assets/boston-899702fa.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/brussels.js":()=>O(()=>import("./brussels-b56fac53.js"),["assets/brussels-b56fac53.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bucharest.js":()=>O(()=>import("./bucharest-dec16d21.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/budapest.js":()=>O(()=>import("./budapest-7e29ae7b.js"),["assets/budapest-7e29ae7b.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/busan.js":()=>O(()=>import("./busan-8d8f3a21.js"),["assets/busan-8d8f3a21.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cairo.js":()=>O(()=>import("./cairo-0257dc90.js"),["assets/cairo-0257dc90.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/caracas.js":()=>O(()=>import("./caracas-27aeb0d9.js"),["assets/caracas-27aeb0d9.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changchun.js":()=>O(()=>import("./changchun-5ccf253e.js"),["assets/changchun-5ccf253e.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changsha.js":()=>O(()=>import("./changsha-1210790b.js"),["assets/changsha-1210790b.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/chengdu.js":()=>O(()=>import("./chengdu-2fde8740.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/chongqing.js":()=>O(()=>import("./chongqing-4e77f42f.js"),["assets/chongqing-4e77f42f.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cochabamba.js":()=>O(()=>import("./cochabamba-791817e4.js"),["assets/cochabamba-791817e4.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cologne.js":()=>O(()=>import("./cologne-9d6b3f1b.js"),["assets/cologne-9d6b3f1b.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/copenhagen.js":()=>O(()=>import("./copenhagen-5f4a6cba.js"),["assets/copenhagen-5f4a6cba.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/daegu.js":()=>O(()=>import("./daegu-8f53d357.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dalian.js":()=>O(()=>import("./dalian-08981d46.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/delhi.js":()=>O(()=>import("./delhi-eaa3d5a0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dongguan.js":()=>O(()=>import("./dongguan-9877cd9c.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dortmund.js":()=>O(()=>import("./dortmund-1d0f660d.js"),["assets/dortmund-1d0f660d.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/edinburgh.js":()=>O(()=>import("./edinburgh-37959f85.js"),["assets/edinburgh-37959f85.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/eskisehir.js":()=>O(()=>import("./eskisehir-5404753b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/foshan.js":()=>O(()=>import("./foshan-725a6d62.js"),["assets/foshan-725a6d62.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/frankfurt.js":()=>O(()=>import("./frankfurt-f1ee3295.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/glasgow.js":()=>O(()=>import("./glasgow-e714346d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/gothenburg.js":()=>O(()=>import("./gothenburg-fb604ac8.js"),["assets/gothenburg-fb604ac8.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/guadalajara.js":()=>O(()=>import("./guadalajara-dc4a5f1d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/guangzhou.js":()=>O(()=>import("./guangzhou-3ef3c94c.js"),["assets/guangzhou-3ef3c94c.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hamburg.js":()=>O(()=>import("./hamburg-958ee775.js"),["assets/hamburg-958ee775.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hangzhou.js":()=>O(()=>import("./hangzhou-fd5d597f.js"),["assets/hangzhou-fd5d597f.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hanoi.js":()=>O(()=>import("./hanoi-acd9e760.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/harbin.js":()=>O(()=>import("./harbin-687d6138.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hefei.js":()=>O(()=>import("./hefei-1ee3072c.js"),["assets/hefei-1ee3072c.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hiroshima.js":()=>O(()=>import("./hiroshima-25e52516.js"),["assets/hiroshima-25e52516.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hochiminh.js":()=>O(()=>import("./hochiminh-65ab3a97.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hongkong.js":()=>O(()=>import("./hongkong-1f572c4b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/iashi.js":()=>O(()=>import("./iashi-7e0a5699.js"),["assets/iashi-7e0a5699.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/istanbul.js":()=>O(()=>import("./istanbul-3b77210c.js"),["assets/istanbul-3b77210c.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/jakarta.js":()=>O(()=>import("./jakarta-09b986c7.js"),["assets/jakarta-09b986c7.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/jinan.js":()=>O(()=>import("./jinan-b6389b78.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kansai.js":()=>O(()=>import("./kansai-709561e4.js"),["assets/kansai-709561e4.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kaohsiung.js":()=>O(()=>import("./kaohsiung-1a75e57f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kharkiv.js":()=>O(()=>import("./kharkiv-04c971bf.js"),["assets/kharkiv-04c971bf.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/klangvalley.js":()=>O(()=>import("./klangvalley-9114a5fa.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kunming.js":()=>O(()=>import("./kunming-0eb12c61.js"),["assets/kunming-0eb12c61.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/lima.js":()=>O(()=>import("./lima-118ba6e3.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/lisbon.js":()=>O(()=>import("./lisbon-82e2f436.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/london.js":()=>O(()=>import("./london-4cc3d948.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/luoyang.js":()=>O(()=>import("./luoyang-4ab5ad8d.js"),["assets/luoyang-4ab5ad8d.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/macao.js":()=>O(()=>import("./macao-19ac9346.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/madrid.js":()=>O(()=>import("./madrid-63cba169.js"),["assets/madrid-63cba169.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/manchester.js":()=>O(()=>import("./manchester-91d1dbb5.js"),["assets/manchester-91d1dbb5.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/milan.js":()=>O(()=>import("./milan-880fab1a.js"),["assets/milan-880fab1a.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/monterrey.js":()=>O(()=>import("./monterrey-7e4295ab.js"),["assets/monterrey-7e4295ab.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/montreal.js":()=>O(()=>import("./montreal-57e78b90.js"),["assets/montreal-57e78b90.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/munich.js":()=>O(()=>import("./munich-4904dc09.js"),["assets/munich-4904dc09.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/nanjing.js":()=>O(()=>import("./nanjing-6764d59b.js"),["assets/nanjing-6764d59b.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/nanning.js":()=>O(()=>import("./nanning-f8fc6fa6.js"),["assets/nanning-f8fc6fa6.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/naples.js":()=>O(()=>import("./naples-19d71e84.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/neworleans.js":()=>O(()=>import("./neworleans-480d174d.js"),["assets/neworleans-480d174d.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/newtaipei.js":()=>O(()=>import("./newtaipei-2d07dd7a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/newyork.js":()=>O(()=>import("./newyork-08e567d0.js"),["assets/newyork-08e567d0.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ningbo.js":()=>O(()=>import("./ningbo-6e662990.js"),["assets/ningbo-6e662990.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/osaka.js":()=>O(()=>import("./osaka-910379eb.js"),["assets/osaka-910379eb.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/oslo.js":()=>O(()=>import("./oslo-faff320a.js"),["assets/oslo-faff320a.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/other.js":()=>O(()=>import("./other-176be433.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ottawa.js":()=>O(()=>import("./ottawa-c7d43313.js"),["assets/ottawa-c7d43313.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/paris.js":()=>O(()=>import("./paris-3ceb8eda.js"),["assets/paris-3ceb8eda.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/qingdao.js":()=>O(()=>import("./qingdao-b0165fb3.js"),["assets/qingdao-b0165fb3.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rheinruhr.js":()=>O(()=>import("./rheinruhr-d291a748.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rio.js":()=>O(()=>import("./rio-14a81329.js"),["assets/rio-14a81329.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/riyadh.js":()=>O(()=>import("./riyadh-f34fb99a.js"),["assets/riyadh-f34fb99a.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sanfrancisco.js":()=>O(()=>import("./sanfrancisco-fe1b19e4.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sanktpeterburg.js":()=>O(()=>import("./sanktpeterburg-87b7088d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/santiago.js":()=>O(()=>import("./santiago-ed7e6e86.js"),["assets/santiago-ed7e6e86.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/saopaulo.js":()=>O(()=>import("./saopaulo-54070840.js"),["assets/saopaulo-54070840.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/seoul.js":()=>O(()=>import("./seoul-96a9529b.js"),["assets/seoul-96a9529b.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sevilla.js":()=>O(()=>import("./sevilla-1946de2c.js"),["assets/sevilla-1946de2c.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shanghai.js":()=>O(()=>import("./shanghai-62e60b95.js"),["assets/shanghai-62e60b95.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shaoxing.js":()=>O(()=>import("./shaoxing-88d3e4cf.js"),["assets/shaoxing-88d3e4cf.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shenyang.js":()=>O(()=>import("./shenyang-62628740.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shenzhen.js":()=>O(()=>import("./shenzhen-08c5694e.js"),["assets/shenzhen-08c5694e.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/singapore.js":()=>O(()=>import("./singapore-83fc1a08.js"),["assets/singapore-83fc1a08.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/stockholm.js":()=>O(()=>import("./stockholm-5eca41a9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/suzhou.js":()=>O(()=>import("./suzhou-c47f374d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taichung.js":()=>O(()=>import("./taichung-1d9f00cc.js"),["assets/taichung-1d9f00cc.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taipei.js":()=>O(()=>import("./taipei-61e571fc.js"),["assets/taipei-61e571fc.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taiyuan.js":()=>O(()=>import("./taiyuan-5df8f19f.js"),["assets/taiyuan-5df8f19f.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taoyuan.js":()=>O(()=>import("./taoyuan-9b1678aa.js"),["assets/taoyuan-9b1678aa.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tashkent.js":()=>O(()=>import("./tashkent-bedb4b53.js"),["assets/tashkent-bedb4b53.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tehran.js":()=>O(()=>import("./tehran-293c71a8.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tianjin.js":()=>O(()=>import("./tianjin-cd24cc67.js"),["assets/tianjin-cd24cc67.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tokyo.js":()=>O(()=>import("./tokyo-84bc5329.js"),["assets/tokyo-84bc5329.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/toronto.js":()=>O(()=>import("./toronto-22d1608a.js"),["assets/toronto-22d1608a.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tyneandwear.js":()=>O(()=>import("./tyneandwear-b3da8462.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/vienna.js":()=>O(()=>import("./vienna-1e8eea57.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/warsaw.js":()=>O(()=>import("./warsaw-3070c4ed.js"),["assets/warsaw-3070c4ed.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/washington.js":()=>O(()=>import("./washington-b29f884e.js"),["assets/washington-b29f884e.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/wuhan.js":()=>O(()=>import("./wuhan-eb678328.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/wuxi.js":()=>O(()=>import("./wuxi-68576026.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xiamen.js":()=>O(()=>import("./xiamen-cca9c4f0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xian.js":()=>O(()=>import("./xian-84e19a1a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/yevpatoria.js":()=>O(()=>import("./yevpatoria-20ca86fb.js"),["assets/yevpatoria-20ca86fb.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/yokohama.js":()=>O(()=>import("./yokohama-c059a37f.js"),["assets/yokohama-c059a37f.js","assets/vendor-40a796df.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/zhengzhou.js":()=>O(()=>import("./zhengzhou-ae694ed0.js"),[])}),`../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/${e}.js`).then(l=>r(l.default)).catch(()=>r([]))},[e]),p};function bs(e){const{city:p,defaultValueId:r,onChange:l}=e,{i18n:o}=oe(),n=ys(p),s=r?n.find(g=>g.id===r):void 0,t=g=>{var u;return(u=o.languages.map(f=>g.name[f]).find(f=>f!==void 0))!=null?u:""};return b(hn,{data:n,displayValue:t,displayHandler:g=>{const u=t(g);return b(mn,{name:u,fg:g.fg||Ae.white,bg:g.colour})},predicate:(g,u)=>Object.values(g.name).some(f=>f.includes(u)),defaultValue:s,onChange:g=>l==null?void 0:l(g.id,g.colour,g.fg||Ae.white)})}function Wt(e){const{isOpen:p,onClose:r,defaultTheme:l,onUpdate:o}=e,{t:n}=oe(),s=Nn("primary.500","primary.300"),[t,i]=J.useState(l==null?void 0:l[0]),[c,g]=J.useState(l==null?void 0:l[1]),[u,f]=J.useState((l==null?void 0:l[2])||"#AAAAAA"),[d,_]=J.useState((l==null?void 0:l[3])||Ae.white);J.useEffect(()=>{l&&(i(l[0]),g(l[1]),f(l[2]),_(l[3]))},[p,l==null?void 0:l.toString()]);const m=[{type:"custom",label:n("ColourModal.city"),component:b(vs,{defaultValueId:t,onChange:A=>{i(A),g(void 0),f("#AAAAAA"),_(Ae.white)}})},{type:"custom",label:n("ColourModal.line"),component:b(bs,{city:t,defaultValueId:c,onChange:(A,T,F)=>{g(A),f(T),_(F)}})}],y=[{type:"input",label:n("ColourModal.bg"),variant:"color",value:u,placeholder:"#F3D03E",onChange:A=>{i(Ie.Other),g("other"),f(A)}},{type:"select",label:n("ColourModal.fg"),value:d,options:{[Ae.white]:n("ColourModal.white"),[Ae.black]:n("ColourModal.black")},onChange:A=>{i(Ie.Other),g("other"),_(A)}}],v=()=>{me.isStandaloneWindow()?window.open("/rmg-palette","_blank"):me.openApp("rmg-palette")},w=t&&c&&u&&d,R=()=>{w&&(o==null||o([t,c,u,d]),r(),me.event(be.SELECT_COLOUR,{cityCode:t,lineCode:c}))};return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[b(Ne,{children:n("ColourModal.title")}),b(Ve,{}),b(He,{children:$(gt,{children:[b(mn,{name:n("ColourModal.example"),fg:d,bg:u}),$(jt,{isFitted:!0,colorScheme:"primary",w:"100%",defaultIndex:t===Ie.Other?1:0,children:[$(Ft,{children:[b(qe,{children:n("ColourModal.palette")}),b(qe,{children:n("ColourModal.custom")})]}),$(Bt,{children:[b(pt,{children:b(ge,{fields:m})}),b(pt,{children:b(ge,{fields:y})})]})]})]})}),$(Ye,{children:[$(ot,{fontSize:"sm",marginRight:2,children:[n("ColourModal.seeAll"),$(Ot,{color:s,onClick:v,children:[n("Palette")," ",b(Vn,{as:Hn})]})]}),b(ue,{colorScheme:"primary",onClick:R,isDisabled:!w,children:n("Confirm")})]})]})]})}class Ss{static hexToRgb(p){return[parseInt(p.slice(1,3),16),parseInt(p.slice(3,5),16),parseInt(p.slice(5,7),16)]}static fade(p,r){return`rgba(${[...this.hexToRgb(p),r].join(",")})`}static euclideanDistance(p,r){return this.hexToRgb(p).reduce((l,o,n)=>l+Math.pow(o-this.hexToRgb(r)[n],2),0)}}function Zt(e){const{theme:p,onClick:r}=e,{t:l}=oe();return b(De,{size:"xs","aria-label":l("Colour"),mt:"0.45px",color:p[3],bg:p[2],_hover:{bg:Ss.fade(p[2],.7)},icon:b(Un,{}),onClick:r})}function ws(e){var _;const{interchangeList:p,onAdd:r,onDelete:l,onUpdate:o}=e,{t:n}=oe(),[s,t]=J.useState(!1),[i,c]=J.useState(0),{theme:g,stn_list:u}=te(m=>m.param),f=Object.values(u).reduce((m,y)=>{const[v,w]=m;return[[...new Set(v.concat(y.transfer.info.flat().map(R=>R[4])))],[...new Set(w.concat(y.transfer.info.flat().map(R=>R[5])))]]},[[],[]]),d=p.map((m,y)=>[{type:"input",label:n("Chinese name"),value:m[4],minW:"80px",onChange:v=>o==null?void 0:o(y,[m[0],m[1],m[2],m[3],v,m[5]]),optionList:f[0]},{type:"input",label:n("English name"),value:m[5],minW:"80px",onChange:v=>o==null?void 0:o(y,[m[0],m[1],m[2],m[3],m[4],v]),optionList:f[1]}]);return $(Ze,{direction:"column",children:[p.length===0&&$(Le,{spacing:.5,"data-testid":"interchange-card-stack",children:[b(ot,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:n("StationSidePanel.interchange.noInterchanges")}),b(De,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.add"),onClick:()=>r==null?void 0:r([g[0],"","#aaaaaa",Ae.white,"",""]),icon:b(je,{})})]}),p.map((m,y)=>$(Le,{spacing:.5,"data-testid":`interchange-card-stack-${y}`,children:[b(Rt,{label:n("Colour"),minW:"40px",noLabel:y!==0,children:b(Zt,{theme:[m[0],m[1],m[2],m[3]],onClick:()=>{t(!0),c(y)}})}),b(ge,{fields:d[y],noLabel:y!==0}),r&&y===d.length-1?b(De,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.copy"),onClick:()=>r==null?void 0:r(p.slice(-1)[0]),icon:b(Wn,{})}):b(Ee,{minW:8}),l&&b(De,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.remove"),onClick:()=>l==null?void 0:l(y),icon:b(vt,{})})]},y)),b(Wt,{isOpen:s,onClose:()=>t(!1),defaultTheme:(_=p[i])==null?void 0:_.slice(0,4),onUpdate:m=>o==null?void 0:o(i,[...m,p[i][4],p[i][5]])})]})}function Es(){const{t:e}=oe(),p=ve(),r=te(u=>u.app.selectedStation),{theme:l,style:o}=te(u=>u.param),{transfer:n}=te(u=>u.param.stn_list[r]),s=u=>{var f,d;return[{type:"input",label:e("Station Chinese name"),value:(f=n.osi_names[u])==null?void 0:f[0],hidden:![ee.MTR].includes(o),onChange:_=>{var m;return p(nn(r,u,[_,(m=n.osi_names[u])==null?void 0:m[1]]))}},{type:"input",label:e("Station English name"),value:(d=n.osi_names[u])==null?void 0:d[1],hidden:![ee.MTR].includes(o),onChange:_=>{var m;return p(nn(r,u,[(m=n.osi_names[u])==null?void 0:m[0],_]))}},{type:"switch",label:e("Paid area"),isChecked:n.paid_area,onChange:_=>p(Sr(r,_)),hidden:![ee.MTR].includes(o)||u!==0,oneLine:!0}]},t=u=>f=>{p(rn(r,u,f))},i=u=>f=>{p(wr(r,u,f))},c=u=>(f,d)=>{p(Er(r,u,f,d))},g=()=>{p(rn(r,n.info.length,[l[0],"","#AAAAAA",Ae.white,"",""]))};return $(gt,{align:"flex-start",p:1,children:[$(Te,{w:"100%",children:[b(we,{as:"h5",size:"sm",mr:"auto",children:e("StationSidePanel.interchange.title")}),o===ee.MTR&&b(lt,{selections:[{label:e("Text on the left"),value:Je.left},{label:e("Text on the right"),value:Je.right}],defaultValue:n.tick_direc,onChange:u=>p(br(r,u))})]}),n.info.map((u,f)=>$(J.Fragment,{children:[b(we,{as:"h6",size:"xs",children:e(f===0?"StationSidePanel.interchange.within":f===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),f!==0&&b(ge,{fields:s(f-1)}),b(ws,{interchangeList:u,onAdd:t(f),onDelete:i(f),onUpdate:c(f)})]},f)),n.info.length<3&&b(ue,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:b(je,{}),onClick:g,children:e("StationSidePanel.interchange.addGroup")})]})}function As(){const{t:e}=oe(),p=ve(),r=te(_=>_.app.selectedStation),{style:l,loop:o}=te(_=>_.param),{services:n,facility:s,loop_pivot:t,one_line:i,int_padding:c}=te(_=>_.param.stn_list[r]),g=Object.values(zt).map(_=>({label:e("StationSidePanel.more."+_),value:_,disabled:_===zt.local&&l!==ee.SHMetro})),u={[xe.none]:e("StationSidePanel.more.none"),[xe.airport]:e("StationSidePanel.more.airport"),[xe.hsr]:e("StationSidePanel.more.hsr"),[xe.disney]:e("StationSidePanel.more.disney")},f={[xe.none]:e("StationSidePanel.more.none"),[xe.airport]:e("StationSidePanel.more.airport"),[xe.railway]:e("StationSidePanel.more.railway"),[xe.disney]:e("StationSidePanel.more.disney")},d=[{type:"custom",label:e("StationSidePanel.more.service"),component:b(lt,{selections:g,defaultValue:n,onChange:_=>p(Ar(r,_)),multiSelect:!0}),hidden:![ee.GZMTR,ee.SHMetro].includes(l)},{type:"select",label:e("StationSidePanel.more.facility"),value:s,options:l===ee.MTR?u:f,onChange:_=>p(kr(r,_)),hidden:![ee.MTR,ee.SHMetro].includes(l)},{type:"switch",label:e("StationSidePanel.more.pivot"),isChecked:t,onChange:_=>p(Or(r,_)),hidden:![ee.SHMetro].includes(l)||!o,minW:"full",oneLine:!0},{type:"switch",label:e("StationSidePanel.more.oneLine"),isChecked:i,onChange:_=>p(Rr(r,_)),hidden:![ee.SHMetro].includes(l),minW:"full",oneLine:!0},{type:"input",label:e("StationSidePanel.more.intPadding"),value:c.toString(),validator:_=>Number.isInteger(_),onChange:_=>p(Tr(r,Number(_))),hidden:![ee.SHMetro].includes(l)},{type:"custom",label:e("StationSidePanel.more.intPaddingApplyGlobal"),component:b(lt,{selections:[{label:e("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:_=>p(Pr(r))}),oneLine:!0,hidden:![ee.SHMetro].includes(l)}];return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("StationSidePanel.more.title")}),b(ge,{fields:d})]})}function ks(){const{t:e}=oe(),p=ve(),r=te(u=>u.app.selectedStation),l=te(u=>u.param.stn_list),{parents:o,children:n,branch:s}=l[r],t={[ft.through]:e("StationSidePanel.branch.through"),[ft.nonThrough]:e("StationSidePanel.branch.nonThrough")},i=u=>(u===Oe.left?o:n).reduce((f,d)=>({...f,[d]:l[d].name.join(" ")}),{}),c={upper:e("StationSidePanel.branch.upper"),lower:e("StationSidePanel.branch.lower")},g=u=>s[u].length?[{type:"select",label:e("StationSidePanel.branch.type"),options:t,value:s[u][0],onChange:f=>p(Cr(r,u,f))},{type:"select",label:e("StationSidePanel.branch.firstStation"),options:i(u),value:s[u][1],onChange:f=>p(zr(r,u,f))},{type:"select",label:e("StationSidePanel.branch.position"),options:c,value:(u===Oe.left?o:n)[0]===s[u][1]?"upper":"lower",onChange:()=>p(xr(r,u))}]:[];return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("Branches")}),b(we,{as:"h6",size:"xs",children:e("Branch on the left")}),b(Ze,{direction:"column",children:o.length===2?b(ge,{fields:g(Oe.left)}):b(ot,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("No branches found")})}),b(we,{as:"h6",size:"xs",children:e("Branch on the right")}),b(Ze,{direction:"column",children:n.length===2?b(ge,{fields:g(Oe.right)}):b(ot,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("No branches found")})})]})}function Os(){return $(Mt,{children:[b(_s,{}),b(Ue,{}),b(Es,{}),b(Ue,{}),b(ks,{}),b(Ue,{}),b(As,{})]})}function Rs(){const{t:e}=oe(),p=Nt(),{style:r,svgWidth:l,svg_height:o,y_pc:n,branchSpacingPct:s,padding:t,direction_gz_x:i,direction_gz_y:c,loop:g}=te(f=>f.param),u=[...Ut[r].map(f=>({type:"input",label:e(`StyleSidePanel.layout.${f}Width`),value:l[f].toString(),onChange:d=>p(Ir(Number(d),f))})),{type:"input",label:e("StyleSidePanel.layout.canvasHeight"),value:o.toString(),onChange:f=>p(Dr(Number(f)))},{type:"slider",label:e("StyleSidePanel.layout.verticalPosition"),value:n,min:0,max:100,onChange:f=>p(Lr(f)),leftIcon:b(Tt,{}),rightIcon:b(Pt,{}),hidden:![ee.MTR,ee.GZMTR].includes(r)},{type:"slider",label:e(g?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:s,min:0,max:g?50:100,onChange:f=>p(jr(f)),leftIcon:b(Xt,{}),rightIcon:b(je,{})},{type:"slider",label:e("StyleSidePanel.layout.padding"),value:t,min:0,max:50,onChange:f=>p(Fr(f)),leftIcon:b(Xt,{}),rightIcon:b(je,{})},{type:"slider",label:e("StyleSidePanel.layout.directionGzX"),value:i,min:0,max:100,onChange:f=>p(Br(f)),leftIcon:b(pn,{}),rightIcon:b(fn,{}),hidden:![ee.GZMTR].includes(r)},{type:"slider",label:e("StyleSidePanel.layout.directionGzY"),value:c,min:0,max:100,onChange:f=>p(Mr(f)),leftIcon:b(Tt,{}),rightIcon:b(Pt,{}),hidden:![ee.GZMTR].includes(r)}];return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("StyleSidePanel.layout.title")}),b(ge,{fields:u,minW:130})]})}function Ts(){const{t:e}=oe(),p=ve(),{style:r,theme:l,line_name:o,line_num:n,direction:s,platform_num:t,psd_num:i,namePosMTR:c,customiseMTRDest:g,info_panel_type:u}=te(A=>A.param),[f,d]=J.useState(!1),_=[{label:e("StyleSidePanel.design.left"),value:Je.left},{label:e("StyleSidePanel.design.right"),value:Je.right}],m=Object.values(vn).reduce((A,T)=>({...A,[T]:e("StyleSidePanel.design."+T)}),{}),y=Object.values(yn).reduce((A,T)=>({...A,[T]:e("StyleSidePanel.design."+T)}),{}),v=[{type:"custom",label:e("Colour"),component:b(Zt,{theme:l,onClick:()=>d(!0)}),minW:"40px"},{type:"input",label:e("StyleSidePanel.design.zhLineName"),value:o[0],onChange:A=>p(sn([A,o[1]])),minW:130},{type:"input",label:e("StyleSidePanel.design.enLineName"),value:o[1],onChange:A=>p(sn([o[0],A])),minW:130},{type:"input",label:e("StyleSidePanel.design.lineNum"),value:n,onChange:A=>p(Nr(A)),hidden:![ee.GZMTR].includes(r)},{type:"input",label:e("StyleSidePanel.design.platformNum"),value:t||"",onChange:A=>p(Vr(A))},{type:"input",label:e("StyleSidePanel.design.psdNum"),value:i,onChange:A=>p(Hr(A)),hidden:![ee.GZMTR].includes(r)},{type:"select",label:e("StyleSidePanel.design.panelType"),value:u,options:r===ee.GZMTR?m:y,onChange:A=>p(Ur(A)),hidden:![ee.GZMTR,ee.SHMetro].includes(r)},{type:"custom",label:e("StyleSidePanel.design.direction"),component:b(lt,{selections:_,defaultValue:s,onChange:A=>p(Wr(A))}),minW:"full",oneLine:!0}],w=[{label:e("StyleSidePanel.design.alternatively"),value:!0},{label:e("StyleSidePanel.design.onOneSide"),value:!1}],R=[{type:"custom",label:e("StyleSidePanel.design.nameDisplay"),component:$(Le,{children:[b(lt,{selections:w,defaultValue:c.isStagger,onChange:A=>p(Zr(A))}),b(ue,{size:"xs",variant:"ghost",leftIcon:b(Zn,{}),onClick:()=>p(Gr()),children:e("StyleSidePanel.design.flip")})]}),minW:"full",oneLine:!0,hidden:![ee.MTR].includes(r)},{type:"switch",label:e("StyleSidePanel.design.legacyDestination"),isChecked:g.isLegacy,onChange:A=>p($r(A)),hidden:![ee.MTR].includes(r),minW:"full",oneLine:!0},{type:"switch",label:e("StyleSidePanel.design.overrideTerminal"),isChecked:g.terminal!==!1,onChange:A=>p(St(A?["",""]:!1)),hidden:![ee.MTR].includes(r),minW:"full",oneLine:!0},{type:"input",label:e("StyleSidePanel.design.terminalZhName"),value:g.terminal?g.terminal[0]:"",placeholder:"æ©Ÿå ´åŠåšè¦½é¤¨",onChange:A=>p(St([A,g.terminal?g.terminal[1]:""])),hidden:![ee.MTR].includes(r)||g.terminal===!1},{type:"input",label:e("StyleSidePanel.design.terminalEnName"),value:g.terminal?g.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:A=>p(St([g.terminal?g.terminal[0]:"",A])),hidden:![ee.MTR].includes(r)||g.terminal===!1}];return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("StyleSidePanel.design.title")}),b(ge,{fields:[...v,...R],minW:130}),b(Wt,{isOpen:f,onClose:()=>d(!1),defaultTheme:l,onUpdate:A=>p(Yr(A))})]})}function Ps(){const{t:e}=oe(),p=ve(),{branches:r}=te(f=>f.helper),{loop:l,loop_info:o}=te(f=>f.param),{bank:n,left_and_right_factor:s,bottom_factor:t}=o,i=r.flat().filter((f=>d=>(f[d]=(f[d]||0)+1)===2)({})).filter(f=>!["linestart","lineend"].includes(f)),c=Math.abs(r[0].indexOf(i[0])-r[0].indexOf(i[1])),g=r.length>=2?(0,Math.min)(r[0].length-2-c,c):Math.floor((r[0].length-2-t*2)/2),u=[{type:"switch",label:e("StyleSidePanel.loop.isLoop"),isChecked:l,onChange:f=>p(qr(f)),minW:"full",oneLine:!0},{type:"switch",label:e("StyleSidePanel.loop.isBank"),isChecked:n,onChange:f=>p(Kr(f)),minW:"full",oneLine:!0,hidden:!l},{type:"slider",label:e("StyleSidePanel.loop.leftRightFactor"),value:s,min:0,max:g,onChange:f=>p(Jr(Math.floor(f))),hidden:!l},{type:"slider",label:e("StyleSidePanel.loop.bottomFactor"),value:t,min:0,max:Math.floor((r[0].length-2-s*2)/2),onChange:f=>p(Xr(Math.floor(f))),hidden:!l||l&&r.length>2}];return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("StyleSidePanel.loop.title")}),b(ge,{fields:u})]})}function Cs(e){const{note:p,onUpdate:r,onDelete:l}=e,{t:o}=oe(),n=[{type:"textarea",label:o("StyleSidePanel.note.zhNote"),value:p[0],onChange:t=>r==null?void 0:r([t,p[1],p[2],p[3],p[4]])},{type:"textarea",label:o("StyleSidePanel.note.enNote"),value:p[1],onChange:t=>r==null?void 0:r([p[0],t,p[2],p[3],p[4]])},{type:"switch",label:o("StyleSidePanel.note.border"),isChecked:p[4],onChange:t=>r==null?void 0:r([p[0],p[1],p[2],p[3],t]),oneLine:!0}],s=[{type:"slider",label:o("StyleSidePanel.note.positionX"),value:p[2],min:0,max:100,onChange:t=>r==null?void 0:r([p[0],p[1],t,p[3],p[4]]),leftIcon:b(pn,{}),rightIcon:b(fn,{})},{type:"slider",label:o("StyleSidePanel.note.positionY"),value:p[3],min:0,max:100,onChange:t=>r==null?void 0:r([p[0],p[1],p[2],t,p[4]]),leftIcon:b(Tt,{}),rightIcon:b(Pt,{})}];return $(Ze,{direction:"column",children:[b(ge,{fields:n,minW:"full"}),$(Le,{spacing:.5,sx:{"&>div":{flex:1}},children:[b(ge,{fields:s}),b(De,{size:"sm",variant:"ghost","aria-label":o("StyleSidePanel.note.remove"),onClick:()=>l==null?void 0:l(),icon:b(vt,{})})]})]})}function zs(){const{t:e}=oe(),p=ve(),r=te(l=>l.param.notesGZMTR);return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("StyleSidePanel.note.title")}),$(gt,{spacing:.5,children:[r.map((l,o)=>b(Cs,{note:l,onUpdate:n=>p(Qr(o,n)),onDelete:()=>p(es(o))},o)),b(ue,{size:"xs",variant:"ghost",leftIcon:b(je,{}),alignSelf:"flex-end",onClick:()=>p(ts()),children:e("StyleSidePanel.note.add")})]})]})}function xs(){const{style:e}=te(p=>p.param);return $(Mt,{children:[b(Rs,{}),b(Ue,{}),b(Ts,{}),e===ee.GZMTR&&$(We,{children:[b(Ue,{}),b(zs,{})]}),e===ee.SHMetro&&$(We,{children:[b(Ue,{}),b(Ps,{})]})]})}const Gt=(e,p)=>{if(["linestart","lineend"].includes(e)||p[e].parents.length>1||p[e].children.length>1)return 0;const r=p[e].parents[0];return r?p[r].children.length===1?Gt(r,p):p[r].children.indexOf(e)===0?1:-1:0},Is=e=>(p,r)=>{const{stn_list:l,current_stn_idx:o}=r().param;if(e===o)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:n,children:s}=l[e];return Object.keys(l).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):n.length===2&&s.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(l).some(i=>![e,"linestart","lineend"].includes(i)&&Gt(i,l)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Ds=e=>(p,r)=>{const l=r().param.stn_list,{parents:o,children:n}=l[e];let s=JSON.parse(JSON.stringify(l));o.length===2||n.length===2?(o.forEach(t=>{s[t].children=n}),n.forEach(t=>{s[t].parents=o}),o.length===1&&(s[o[0]].branch.right=s[e].branch.right),n.length===1&&(s[n[0]].branch.left=s[e].branch.left)):l[o[0]].children.length===2&&l[n[0]].parents.length===2?s={...l,[o[0]]:{...l[o[0]],children:l[o[0]].children.filter(t=>t!==e),branch:{...l[o[0]].branch,right:[]}},[n[0]]:{...l[n[0]],parents:l[n[0]].parents.filter(t=>t!==e),branch:{...l[n[0]].branch,left:[]}}}:(o.forEach(t=>{const i=s[t].children.indexOf(e);n.length?s[t].children[i]=n[0]:s[t].children.splice(i,1),s[t].branch.right[1]===e&&(s[t].branch.right[1]=n[0])}),n.forEach(t=>{const i=s[t].parents.indexOf(e);o.length?s[t].parents[i]=o[0]:s[t].parents.splice(i,1),s[t].branch.left[1]===e&&(s[t].branch.left[1]=o[0])})),delete s[e],p(Ge(s))};function Ls(...e){return e.reduce((p,r)=>p.map(l=>r.map(o=>l.concat([o]))).reduce((l,o)=>l.concat(o),[]),[[]])}const et=(e,p)=>!!p[e[0]].children.indexOf(e[1]),An=(e,p)=>[e[0][1],e[0][e[0].length-2],...e[0].filter(r=>e.slice(1).filter(l=>et(l,p)).map(l=>l.filter(o=>!["linestart","lineend"].includes(o))).map(l=>[l[0],l[l.length-1]]).flat().includes(r))],js=(e,p)=>e.slice(1).filter(r=>et(r,p)).map(r=>r.filter(l=>!["linestart","lineend"].includes(l))).map(r=>[r[0],r[r.length-1]]),Fs=e=>(p,r)=>{const l=r().helper.branches;if(e===0){const o=r().param.stn_list,n=An(l,o);return Ls(n,n).filter(s=>s[0]!==s[1])}else{const o=l[e];if(o){const n=o.filter(s=>!["linestart","lineend"].includes(s));return[[n[0],n.slice(-1)[0]]]}else return[]}},Yi=(e,p)=>(r,l)=>{const o=l().param.coline,n=l().helper.branches[p];for(const[s,t]of Object.entries(o))if(t.from===e&&n.includes(t.to)){const i=n.indexOf(e),c=n.indexOf(t.to);if(c>i)return[c-i+1,s]}else if(t.to===e&&n.includes(t.to)){const i=n.indexOf(e),c=n.indexOf(t.from);if(c>i)return[c-i+1,s]}return[0,void 0]},kn=(e,p)=>(r,l)=>{const o=l().param.stn_list,n=l().helper.branches;if(e===p)throw new Error("addColine():: failed for same stnId");const s=An(n,o).filter(i=>[e,p].includes(i)),t=js(n,o).filter(i=>[e,p].every(c=>i.includes(c)));if(s.length===2&&t.length>0)throw new Error(`addColine():: main check failed for ${e}, ${p}`);if(s.length!==2&&t.length!==1)throw new Error(`addColine():: branch check failed for ${e}, ${p}`)},Bs=e=>(p,r)=>{const l=r().param.coline,n=r().helper.branches[e];return n?Object.entries(l).reduce((s,t)=>n.includes(t[1].from)&&n.includes(t[1].to)?{...s,[t[0]]:t[1]}:{...s},{}):{}},Ms=e=>(p,r)=>{const l=r().param.coline;if(Object.keys(l).length===0)return;const o=Object.entries(l).reduce((n,s)=>s[1].from!==e&&s[1].to!==e?{...n,[s[0]]:s[1]}:{...n},{});p(Xe(o))},Ns=(e,p,r,l=!0)=>(o,n)=>{const s=n().param.coline;o(kn(e,p)),o(Xe({...s,[Ke(4)]:{from:e,to:p,colors:r,display:l}}))},Vs=(e,p,r,l=!0)=>(o,n)=>{const s=n().param.coline;if(e in s){o(kn(p,r));const t={...s,[e]:{...s[e],from:p,to:r,display:l}};o(Xe(t))}},Hs=(e,p)=>(r,l)=>{const o=l().param.coline;if(e in o&&o[e].colors.length>p){const n=o[e].colors.filter((s,t)=>t!==p);if(n.length===0){const{[e]:s,...t}=o;r(Xe(t))}else{const s={...o,[e]:{...o[e],colors:n}};r(Xe(s))}}},Us=(e,p,r)=>(l,o)=>{const n=o().param.coline;e in n&&n[e].colors.length>p&&(n[e].colors=n[e].colors.map((s,t)=>t===p?[0,1,2,3,4,5].map(i=>r[i]===void 0?s[i]:r[i]):s),l(Xe(n)))};function Ws(e){const{isOpen:p,onClose:r}=e,{t:l}=oe(),o=ve(),n=te(c=>c.app.selectedStation),[s,t]=J.useState(!1);J.useEffect(()=>{p||t(!1)},[p]);const i=()=>{const c=o(Is(n));c?(r(),o(Qe($e.CLOSE)),o(bn("linestart")),o(Ms(n)),o(Ds(n))):t(!0),me.event(be.REMOVE_STATION,{success:c})};return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[s&&$(Vt,{status:"error",variant:"solid",size:"xs",children:[b(Ht,{}),l("Unable to remove this station.")]}),$(Ee,{position:"relative",children:[b(Ne,{children:l("Remove station")}),b(Ve,{})]}),b(He,{children:l("Are you sure to remove station? You cannot undo this action.")}),$(Ye,{children:[b(ue,{onClick:r,children:l("Cancel")}),b(ue,{colorScheme:"primary",onClick:i,ml:3,children:l("Confirm")})]})]})]})}function Zs(){const{t:e}=oe(),p=ve(),r=te(n=>n.app.selectedStation),[l,o]=J.useState(!1);return $(Gn,{children:[$(Le,{children:[b(ue,{size:"sm",variant:"outline",onClick:()=>p(xt(r)),children:e("StationSidePanel.footer.current")}),b(ue,{size:"sm",variant:"outline",onClick:()=>o(!0),children:e("StationSidePanel.footer.remove")})]}),b(Ws,{isOpen:l,onClose:()=>o(!1)})]})}function Gs(e){const{colineInfo:p,routeOptions:r,onUpdateRoute:l,onUpdateColourInfo:o,onDelete:n}=e,{t:s}=oe(),[t,i]=J.useState(!1),c=[{type:"select",label:"Route",value:[p.from,p.to].join(","),options:r,onChange:u=>l==null?void 0:l(u)}],g=[{type:"custom",label:s("Colour"),component:b(Zt,{theme:[p.colors[0][0],p.colors[0][1],p.colors[0][2],p.colors[0][3]],onClick:()=>i(!0)})},{type:"input",label:s("Chinese name"),value:p.colors[0][4],minW:120,onChange:u=>o==null?void 0:o([p.colors[0][0],p.colors[0][1],p.colors[0][2],p.colors[0][3],u,p.colors[0][5]])},{type:"input",label:s("English name"),value:p.colors[0][5],minW:120,onChange:u=>o==null?void 0:o([p.colors[0][0],p.colors[0][1],p.colors[0][2],p.colors[0][3],p.colors[0][4],u])}];return $(Ze,{direction:"column",children:[b(ge,{fields:c,minW:"full"}),$(Le,{spacing:.5,children:[b(ge,{fields:g}),b(De,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>n==null?void 0:n(0),icon:b(vt,{})})]}),b(Wt,{isOpen:t,onClose:()=>i(!1),defaultTheme:p.colors[0].slice(0,4),onUpdate:u=>o==null?void 0:o([...u,p.colors[0][4],p.colors[0][5]])})]})}function $s(){const{t:e}=oe(),p=ve(),r=te(f=>f.app.selectedBranch),{theme:l,stn_list:o}=te(f=>f.param),n=p(Bs(r)),s=p(Fs(r)),t=f=>f.map(d=>o[d].name.join(" - ")).join(" ~ "),i=s.reduce((f,d)=>({...f,[d.join(",")]:t(d)}),{}),c=()=>{console.log(`ColineSection.handleAddTrackSharing():: Adding track sharing to branch ${r} with default combination`,s[0]),p(Ns(s[0][0],s[0][1],[[l[0],"","#AAAAAA",Ae.white,"",""]]))},g=f=>d=>{const[_,m]=d.split(",");console.log(`ColineSection.handleUpdateRoute():: Updating route, colineId=${f}, from=${_}, to=${m}`);try{p(Vs(f,_,m))}catch(y){p(It({status:"error",message:"Unable to draw this share track."}))}},u=(f,d)=>{p(Hs(f,d))};return $(gt,{align:"flex-start",p:1,children:[b(we,{as:"h5",size:"sm",children:e("BranchSidePanel.coline.title")}),Object.entries(n).map(([f,d])=>b(Gs,{colineInfo:d,routeOptions:i,onUpdateRoute:g(f),onUpdateColourInfo:_=>p(Us(f,0,_)),onDelete:_=>u(f,_)},f)),(r===0||Object.keys(n).length===0)&&b(ue,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:b(je,{}),onClick:c,children:e("BranchSidePanel.coline.add")})]})}function Ys(e){const{isOpen:p,onClose:r}=e,{t:l}=oe(),o=ve(),n=te(A=>A.app.selectedBranch),{style:s,stn_list:t}=te(A=>A.param),i=te(A=>A.helper.branches),[c,g]=J.useState(n),[u,f]=J.useState("1"),[d,_]=J.useState("2"),[m,y]=J.useState("asc");J.useEffect(()=>{g(n)},[n]);const v=[{type:"select",label:l("AutoNumModal.where"),value:c,options:{...i.reduce((A,T,F)=>({...A,[F]:F===0?l("AutoNumModal.main"):s!==ee.SHMetro||!et(T,t)?l("AutoNumModal.branch")+" "+F:l("AutoNumModal.external")+" "+F}),{})},onChange:A=>g(A)},{type:"input",label:l("AutoNumModal.from"),value:u,validator:A=>!isNaN(Number(A)),onChange:f,debouncedDelay:0},{type:"input",label:l("AutoNumModal.maxLength"),validator:A=>!isNaN(Number(A)),value:d,onChange:_,debouncedDelay:0},{type:"select",label:l("AutoNumModal.sort"),value:m,options:{asc:l("AutoNumModal.asc"),desc:l("AutoNumModal.desc")},onChange:A=>y(A)}],w=()=>{o(ns(c,Number(u),Number(d),m)),r(),me.event(be.AUTO_NUMBERING,{})},R=!u||!d||isNaN(Number(u))||isNaN(Number(d));return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[b(Ne,{children:l("AutoNumModal.title")}),b(Ve,{}),b(He,{children:b(ge,{fields:v})}),b(Ye,{children:b(ue,{colorScheme:"primary",isDisabled:R,onClick:w,children:l("Confirm")})})]})]})}const $t=e=>(p,r)=>{const o=r().helper.branches[e];return o.includes("linestart")||o.includes("lineend")?1:2},On=e=>(p,r)=>{const{branches:l}=r().helper,o=l[0],n=l[e];return o.slice(o.indexOf(n[0])+1,o.indexOf(n.slice(-1)[0]))},qs=(e,p)=>r=>r($t(p))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):r(On(p)).includes(e)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Ks=(e,p)=>(r,l)=>{if(!r(qs(e,p)))return!1;const{branches:n}=l().helper,s=l().param.stn_list,t=n[p];if(t[0]==="linestart"){const i={...s,[t[1]]:{...s[t[1]],parents:[e]},[e]:{...s[e],children:s.linestart.children.map(c=>c===t[1]?c:s[e].children[0]),branch:{left:[],right:s.linestart.branch.right}},linestart:{...s.linestart,children:s.linestart.children.filter(c=>c!==t[1]),branch:{left:[],right:[]}}};return r(Ge(i)),!0}else{const i=t.slice(-2)[0],c={...s,[i]:{...s[i],children:[e]},[e]:{...s[e],parents:s.lineend.parents.map(g=>g===i?g:s[e].parents[0]),branch:{right:[],left:s.lineend.branch.left}},lineend:{...s.lineend,parents:s.lineend.parents.filter(g=>g!==i),branch:{left:[],right:[]}}};return r(Ge(c)),!0}},Rn=e=>(p,r)=>{const{branches:l}=r().helper,o=r().param.stn_list,n=l[0],s=l[e];if(p($t(e))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const i=n.indexOf(s[0]),c=n.slice(0,i),g=n.indexOf(s.slice(-1)[0]),u=n.slice(g+1),f=c.every(_=>o[_].children.length<=1&&o[_].parents.length<=1),d=u.every(_=>o[_].children.length<=1&&o[_].parents.length<=1);return f?d?[Oe.left,Oe.right]:[Oe.left]:d?[Oe.right]:[]},Js=(e,p)=>(r,l)=>{if(!r(Rn(p)).includes(e))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:n}=l().helper,s=l().param.stn_list,t=n[0],i=n[p];if(e===Oe.left){const c=i[0],g={...s,[i[1]]:{...s[i[1]],parents:["linestart"]},[c]:{...s[c],children:s[c].children.filter(u=>u!==i[1]),branch:{right:[],left:[]}},linestart:{...s.linestart,children:s[c].children.map(u=>u===i[1]?u:t[1]),branch:{left:[],right:s[c].branch.right}}};return r(Ge(g)),!0}else{const c=i.slice(-1)[0],g=i.slice(-2)[0],u={...s,[g]:{...s[g],children:["lineend"]},[c]:{...s[c],parents:s[c].parents.filter(f=>f!==g),branch:{right:[],left:[]}},lineend:{...s.lineend,parents:s[c].parents.map(f=>f===g?f:t.slice(-2)[0]),branch:{right:[],left:s[c].branch.left}}};return r(Ge(u)),!0}};function on(e){const{direction:p}=e,{t:r}=oe(),l=ve(),{branches:o}=te(I=>I.helper),n=te(I=>I.app.selectedBranch),{style:s,stn_list:t}=te(I=>I.param),[i,c]=J.useState(!1),[g,u]=J.useState(""),f=o[n].filter(I=>!["linestart","lineend"].includes(I)),d=p===Oe.left?f[0]:f.slice(-1)[0],_=t[d],m=l(On(n)),y=l($t(n)),v=l(Rn(n)),w=y===1&&!o[0].includes(d),R=v.includes(p),A=m.reduce((I,B)=>{var z;return{...I,[B]:(z=t[B])==null?void 0:z.name.join(" - ")}},{"":r("Please select...")}),T=()=>{const I=l(Ks(g,n));I?c(!1):l(It({status:"error",message:r("Unable to connect to main line.")})),me.event(be.CONNECT_BRANCH,{style:s,success:I})},F=()=>{const I=l(Js(p,n));I||l(It({status:"error",message:r("Unable to disconnect from main line.")})),me.event(be.DISCONNECT_BRANCH,{style:s,success:I})};return $(Ze,{direction:"column",children:[$(Te,{alignItems:"center",children:[b(Rt,{label:r("Station name"),flex:1,children:b($n,{defaultValue:_.name.join(" "),isDisabled:!0})}),i?b(ue,{mx:1,size:"sm",variant:"outline",onClick:()=>c(!1),children:r("Cancel")}):w?b(ue,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>c(!0),children:r("Connect to main line")}):b(ue,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:F,isDisabled:!R,children:r("Disconnect from main line")})]}),i&&$(Te,{alignItems:"center",children:[b(Rt,{label:r("Target station"),flex:1,children:b(Yn,{defaultValue:g,options:A,disabledOptions:[""],onChange:({target:{value:I}})=>u(I)})}),b(ue,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:T,isDisabled:!g,children:r("Confirm")})]})]})}function Xs(){const{t:e}=oe(),p=ve(),r=te(t=>t.param.style),l=te(t=>t.app.selectedBranch),[o,n]=J.useState(!1),s=()=>{p(rs(r===ee.SHMetro)),me.event(be.REVERSE_STATIONS,{style:r})};return $(Ee,{p:1,children:[b(we,{as:"h5",size:"sm",children:e("BranchSidePanel.action.title")}),$(Te,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[l!==0&&r!==ee.SHMetro&&$(We,{children:[b(we,{as:"h6",size:"xs",children:e("Branch left end")}),b(on,{direction:Oe.left}),b(we,{as:"h6",size:"xs",children:e("Branch right end")}),b(on,{direction:Oe.right})]}),r===ee.GZMTR&&b(ue,{size:"sm",variant:"outline",leftIcon:b(qn,{}),alignSelf:"flex-end",onClick:()=>n(!0),children:e("BranchSidePanel.action.autoNum")}),b(ue,{size:"sm",variant:"outline",leftIcon:b(Kn,{}),alignSelf:"flex-end",onClick:s,children:r===ee.SHMetro?e("BranchSidePanel.action.flip"):e("BranchSidePanel.action.reverse")})]}),b(Ys,{isOpen:o,onClose:()=>n(!1)})]})}function Qs(){const e=te(o=>o.app.selectedBranch),{style:p,stn_list:r}=te(o=>o.param),l=te(o=>o.helper.branches);return $(Mt,{children:[p===ee.SHMetro&&(e===0||et(l[e],r))&&$(We,{children:[b($s,{}),b(Ue,{})]}),b(Xs,{})]})}const ei=375;function ti(){var t,i;const{t:e}=oe(),p=Nt(),{sidePanelMode:r,selectedStation:l}=te(c=>c.app),o=te(c=>{var g;return(g=c.param.stn_list[l])==null?void 0:g.name}),n={STATION:{header:b(Jn,{text:(o==null?void 0:o.join(" - "))||""}),body:b(Os,{}),footer:b(Zs,{})},STYLE:{header:e("StyleSidePanel.header"),body:b(xs,{})},BRANCH:{header:e("BranchSidePanel.header"),body:b(Qs,{})},CLOSE:{header:"Close"}},s=()=>{p(Qe($e.CLOSE))};return $(Xn,{isOpen:r!==$e.CLOSE,width:ei,header:"Dummy header",children:[b(Qn,{onClose:s,children:n[r].header}),(t=n[r])==null?void 0:t.body,(i=n[r])==null?void 0:i.footer]})}const Tn=(e,p,r)=>{const l=new Blob([r],{type:p});Dt(e,l)},Dt=(e,p)=>{const r=window.URL.createObjectURL(p),l=document.createElement("a");l.href=r,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r)},ni=e=>new Promise(p=>{const r=new FileReader;r.onloadend=()=>p(r.result),r.readAsText(e)}),Pn=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),ri=e=>{if(e){const p=new Date().getTime()-e;return p<60*1e3?["Just now"]:p<2*60*1e3?["1","minute ago"]:p<60*60*1e3?[Math.floor(p/1e3/60).toString(),"minutes ago"]:p<2*60*60*1e3?["1","hour ago"]:p<24*60*60*1e3?[Math.floor(p/1e3/60/60).toString(),"hours ago"]:p<48*60*60*1e3?["1","day ago"]:[Math.floor(p/1e3/60/60/24).toString(),"days ago"]}else return["Unknown"]};function ht(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Lt={},si={get exports(){return Lt},set exports(e){Lt=e}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,p){(function(r){e.exports=r()})(function(){return function r(l,o,n){function s(c,g){if(!o[c]){if(!l[c]){var u=typeof ht=="function"&&ht;if(!g&&u)return u(c,!0);if(t)return t(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var d=o[c]={exports:{}};l[c][0].call(d.exports,function(_){var m=l[c][1][_];return s(m||_)},d,d.exports,r,l,o,n)}return o[c].exports}for(var t=typeof ht=="function"&&ht,i=0;i<n.length;i++)s(n[i]);return s}({1:[function(r,l,o){var n=r("./utils"),s=r("./support"),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(i){for(var c,g,u,f,d,_,m,y=[],v=0,w=i.length,R=w,A=n.getTypeOf(i)!=="string";v<i.length;)R=w-v,u=A?(c=i[v++],g=v<w?i[v++]:0,v<w?i[v++]:0):(c=i.charCodeAt(v++),g=v<w?i.charCodeAt(v++):0,v<w?i.charCodeAt(v++):0),f=c>>2,d=(3&c)<<4|g>>4,_=1<R?(15&g)<<2|u>>6:64,m=2<R?63&u:64,y.push(t.charAt(f)+t.charAt(d)+t.charAt(_)+t.charAt(m));return y.join("")},o.decode=function(i){var c,g,u,f,d,_,m=0,y=0,v="data:";if(i.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var w,R=3*(i=i.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(i.charAt(i.length-1)===t.charAt(64)&&R--,i.charAt(i.length-2)===t.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=s.uint8array?new Uint8Array(0|R):new Array(0|R);m<i.length;)c=t.indexOf(i.charAt(m++))<<2|(f=t.indexOf(i.charAt(m++)))>>4,g=(15&f)<<4|(d=t.indexOf(i.charAt(m++)))>>2,u=(3&d)<<6|(_=t.indexOf(i.charAt(m++))),w[y++]=c,d!==64&&(w[y++]=g),_!==64&&(w[y++]=u);return w}},{"./support":30,"./utils":32}],2:[function(r,l,o){var n=r("./external"),s=r("./stream/DataWorker"),t=r("./stream/Crc32Probe"),i=r("./stream/DataLengthProbe");function c(g,u,f,d,_){this.compressedSize=g,this.uncompressedSize=u,this.crc32=f,this.compression=d,this.compressedContent=_}c.prototype={getContentWorker:function(){var g=new s(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new i("data_length")),u=this;return g.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),g},getCompressedWorker:function(){return new s(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(g,u,f){return g.pipe(new t).pipe(new i("uncompressedSize")).pipe(u.compressWorker(f)).pipe(new i("compressedSize")).withStreamInfo("compression",u)},l.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,l,o){var n=r("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},o.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,l,o){var n=r("./utils"),s=function(){for(var t,i=[],c=0;c<256;c++){t=c;for(var g=0;g<8;g++)t=1&t?3988292384^t>>>1:t>>>1;i[c]=t}return i}();l.exports=function(t,i){return t!==void 0&&t.length?n.getTypeOf(t)!=="string"?function(c,g,u,f){var d=s,_=f+u;c^=-1;for(var m=f;m<_;m++)c=c>>>8^d[255&(c^g[m])];return-1^c}(0|i,t,t.length,0):function(c,g,u,f){var d=s,_=f+u;c^=-1;for(var m=f;m<_;m++)c=c>>>8^d[255&(c^g.charCodeAt(m))];return-1^c}(0|i,t,t.length,0):0}},{"./utils":32}],5:[function(r,l,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(r,l,o){var n=null;n=typeof Promise<"u"?Promise:r("lie"),l.exports={Promise:n}},{lie:37}],7:[function(r,l,o){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=r("pako"),t=r("./utils"),i=r("./stream/GenericWorker"),c=n?"uint8array":"array";function g(u,f){i.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=f,this.meta={}}o.magic="\b\0",t.inherits(g,i),g.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(t.transformTo(c,u.data),!1)},g.prototype.flush=function(){i.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},g.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._pako=null},g.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(f){u.push({data:f,meta:u.meta})}},o.compressWorker=function(u){return new g("Deflate",u)},o.uncompressWorker=function(){return new g("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,l,o){function n(d,_){var m,y="";for(m=0;m<_;m++)y+=String.fromCharCode(255&d),d>>>=8;return y}function s(d,_,m,y,v,w){var R,A,T=d.file,F=d.compression,I=w!==c.utf8encode,B=t.transformTo("string",w(T.name)),z=t.transformTo("string",c.utf8encode(T.name)),V=T.comment,q=t.transformTo("string",w(V)),k=t.transformTo("string",c.utf8encode(V)),j=z.length!==T.name.length,h=k.length!==V.length,M="",se="",W="",ae=T.dir,Z=T.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};_&&!m||(ie.crc32=d.crc32,ie.compressedSize=d.compressedSize,ie.uncompressedSize=d.uncompressedSize);var D=0;_&&(D|=8),I||!j&&!h||(D|=2048);var x=0,re=0;ae&&(x|=16),v==="UNIX"?(re=798,x|=function(K,pe){var Se=K;return K||(Se=pe?16893:33204),(65535&Se)<<16}(T.unixPermissions,ae)):(re=20,x|=function(K){return 63&(K||0)}(T.dosPermissions)),R=Z.getUTCHours(),R<<=6,R|=Z.getUTCMinutes(),R<<=5,R|=Z.getUTCSeconds()/2,A=Z.getUTCFullYear()-1980,A<<=4,A|=Z.getUTCMonth()+1,A<<=5,A|=Z.getUTCDate(),j&&(se=n(1,1)+n(g(B),4)+z,M+="up"+n(se.length,2)+se),h&&(W=n(1,1)+n(g(q),4)+k,M+="uc"+n(W.length,2)+W);var X="";return X+=`
\0`,X+=n(D,2),X+=F.magic,X+=n(R,2),X+=n(A,2),X+=n(ie.crc32,4),X+=n(ie.compressedSize,4),X+=n(ie.uncompressedSize,4),X+=n(B.length,2),X+=n(M.length,2),{fileRecord:u.LOCAL_FILE_HEADER+X+B+M,dirRecord:u.CENTRAL_FILE_HEADER+n(re,2)+X+n(q.length,2)+"\0\0\0\0"+n(x,4)+n(y,4)+B+M+q}}var t=r("../utils"),i=r("../stream/GenericWorker"),c=r("../utf8"),g=r("../crc32"),u=r("../signature");function f(d,_,m,y){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=m,this.encodeFileName=y,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}t.inherits(f,i),f.prototype.push=function(d){var _=d.meta.percent||0,m=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,i.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(_+100*(m-y-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var _=this.streamFiles&&!d.file.dir;if(_){var m=s(d,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var _=this.streamFiles&&!d.file.dir,m=s(d,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),_)this.push({data:function(y){return u.DATA_DESCRIPTOR+n(y.crc32,4)+n(y.compressedSize,4)+n(y.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var m=this.bytesWritten-d,y=function(v,w,R,A,T){var F=t.transformTo("string",T(A));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(v,2)+n(v,2)+n(w,4)+n(R,4)+n(F.length,2)+F}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var _=this;return d.on("data",function(m){_.processChunk(m)}),d.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),d.on("error",function(m){_.error(m)}),this},f.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var _=this._sources;if(!i.prototype.error.call(this,d))return!1;for(var m=0;m<_.length;m++)try{_[m].error(d)}catch(y){}return!0},f.prototype.lock=function(){i.prototype.lock.call(this);for(var d=this._sources,_=0;_<d.length;_++)d[_].lock()},l.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,l,o){var n=r("../compressions"),s=r("./ZipFileWorker");o.generateWorker=function(t,i,c){var g=new s(i.streamFiles,c,i.platform,i.encodeFileName),u=0;try{t.forEach(function(f,d){u++;var _=function(w,R){var A=w||R,T=n[A];if(!T)throw new Error(A+" is not a valid compression method !");return T}(d.options.compression,i.compression),m=d.options.compressionOptions||i.compressionOptions||{},y=d.dir,v=d.date;d._compressWorker(_,m).withStreamInfo("file",{name:f,dir:y,date:v,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(g)}),g.entriesCount=u}catch(f){g.error(f)}return g}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,l,o){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new n;for(var t in this)typeof this[t]!="function"&&(s[t]=this[t]);return s}}(n.prototype=r("./object")).loadAsync=r("./load"),n.support=r("./support"),n.defaults=r("./defaults"),n.version="3.10.1",n.loadAsync=function(s,t){return new n().loadAsync(s,t)},n.external=r("./external"),l.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,l,o){var n=r("./utils"),s=r("./external"),t=r("./utf8"),i=r("./zipEntries"),c=r("./stream/Crc32Probe"),g=r("./nodejsUtils");function u(f){return new s.Promise(function(d,_){var m=f.decompressed.getContentWorker().pipe(new c);m.on("error",function(y){_(y)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}l.exports=function(f,d){var _=this;return d=n.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:t.utf8decode}),g.isNode&&g.isStream(f)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var y=new i(d);return y.load(m),y}).then(function(m){var y=[s.Promise.resolve(m)],v=m.files;if(d.checkCRC32)for(var w=0;w<v.length;w++)y.push(u(v[w]));return s.Promise.all(y)}).then(function(m){for(var y=m.shift(),v=y.files,w=0;w<v.length;w++){var R=v[w],A=R.fileNameStr,T=n.resolve(R.fileNameStr);_.file(T,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:d.createFolders}),R.dir||(_.file(T).unsafeOriginalName=A)}return y.zipComment.length&&(_.comment=y.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,l,o){var n=r("../utils"),s=r("../stream/GenericWorker");function t(i,c){s.call(this,"Nodejs stream input adapter for "+i),this._upstreamEnded=!1,this._bindStream(c)}n.inherits(t,s),t.prototype._bindStream=function(i){var c=this;(this._stream=i).pause(),i.on("data",function(g){c.push({data:g,meta:{percent:0}})}).on("error",function(g){c.isPaused?this.generatedError=g:c.error(g)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},t.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},t.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=t},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,l,o){var n=r("readable-stream").Readable;function s(t,i,c){n.call(this,i),this._helper=t;var g=this;t.on("data",function(u,f){g.push(u)||g._helper.pause(),c&&c(f)}).on("error",function(u){g.emit("error",u)}).on("end",function(){g.push(null)})}r("../utils").inherits(s,n),s.prototype._read=function(){this._helper.resume()},l.exports=s},{"../utils":32,"readable-stream":16}],14:[function(r,l,o){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,s);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,s)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var s=new Buffer(n);return s.fill(0),s},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(r,l,o){function n(T,F,I){var B,z=t.getTypeOf(F),V=t.extend(I||{},g);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(T=v(T)),V.createFolders&&(B=y(T))&&w.call(this,B,!0);var q=z==="string"&&V.binary===!1&&V.base64===!1;I&&I.binary!==void 0||(V.binary=!q),(F instanceof u&&F.uncompressedSize===0||V.dir||!F||F.length===0)&&(V.base64=!1,V.binary=!0,F="",V.compression="STORE",z="string");var k=null;k=F instanceof u||F instanceof i?F:_.isNode&&_.isStream(F)?new m(T,F):t.prepareContent(T,F,V.binary,V.optimizedBinaryString,V.base64);var j=new f(T,k,V);this.files[T]=j}var s=r("./utf8"),t=r("./utils"),i=r("./stream/GenericWorker"),c=r("./stream/StreamHelper"),g=r("./defaults"),u=r("./compressedObject"),f=r("./zipObject"),d=r("./generate"),_=r("./nodejsUtils"),m=r("./nodejs/NodejsStreamInputAdapter"),y=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var F=T.lastIndexOf("/");return 0<F?T.substring(0,F):""},v=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},w=function(T,F){return F=F!==void 0?F:g.createFolders,T=v(T),this.files[T]||n.call(this,T,null,{dir:!0,createFolders:F}),this.files[T]};function R(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var F,I,B;for(F in this.files)B=this.files[F],(I=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&T(I,B)},filter:function(T){var F=[];return this.forEach(function(I,B){T(I,B)&&F.push(B)}),F},file:function(T,F,I){if(arguments.length!==1)return T=this.root+T,n.call(this,T,F,I),this;if(R(T)){var B=T;return this.filter(function(V,q){return!q.dir&&B.test(V)})}var z=this.files[this.root+T];return z&&!z.dir?z:null},folder:function(T){if(!T)return this;if(R(T))return this.filter(function(z,V){return V.dir&&T.test(z)});var F=this.root+T,I=w.call(this,F),B=this.clone();return B.root=I.name,B},remove:function(T){T=this.root+T;var F=this.files[T];if(F||(T.slice(-1)!=="/"&&(T+="/"),F=this.files[T]),F&&!F.dir)delete this.files[T];else for(var I=this.filter(function(z,V){return V.name.slice(0,T.length)===T}),B=0;B<I.length;B++)delete this.files[I[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var F,I={};try{if((I=t.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");t.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var B=I.comment||this.comment||"";F=d.generateWorker(this,I,B)}catch(z){(F=new i("error")).error(z)}return new c(F,I.type||"string",I.mimeType)},generateAsync:function(T,F){return this.generateInternalStream(T).accumulate(F)},generateNodeStream:function(T,F){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(F)}};l.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,l,o){l.exports=r("stream")},{stream:void 0}],17:[function(r,l,o){var n=r("./DataReader");function s(t){n.call(this,t);for(var i=0;i<this.data.length;i++)t[i]=255&t[i]}r("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data[this.zero+t]},s.prototype.lastIndexOfSignature=function(t){for(var i=t.charCodeAt(0),c=t.charCodeAt(1),g=t.charCodeAt(2),u=t.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===i&&this.data[f+1]===c&&this.data[f+2]===g&&this.data[f+3]===u)return f-this.zero;return-1},s.prototype.readAndCheckSignature=function(t){var i=t.charCodeAt(0),c=t.charCodeAt(1),g=t.charCodeAt(2),u=t.charCodeAt(3),f=this.readData(4);return i===f[0]&&c===f[1]&&g===f[2]&&u===f[3]},s.prototype.readData=function(t){if(this.checkOffset(t),t===0)return[];var i=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=s},{"../utils":32,"./DataReader":18}],18:[function(r,l,o){var n=r("../utils");function s(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var i,c=0;for(this.checkOffset(t),i=this.index+t-1;i>=this.index;i--)c=(c<<8)+this.byteAt(i);return this.index+=t,c},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},l.exports=s},{"../utils":32}],19:[function(r,l,o){var n=r("./Uint8ArrayReader");function s(t){n.call(this,t)}r("../utils").inherits(s,n),s.prototype.readData=function(t){this.checkOffset(t);var i=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,l,o){var n=r("./DataReader");function s(t){n.call(this,t)}r("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},s.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},s.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},s.prototype.readData=function(t){this.checkOffset(t);var i=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=s},{"../utils":32,"./DataReader":18}],21:[function(r,l,o){var n=r("./ArrayReader");function s(t){n.call(this,t)}r("../utils").inherits(s,n),s.prototype.readData=function(t){if(this.checkOffset(t),t===0)return new Uint8Array(0);var i=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(r,l,o){var n=r("../utils"),s=r("../support"),t=r("./ArrayReader"),i=r("./StringReader"),c=r("./NodeBufferReader"),g=r("./Uint8ArrayReader");l.exports=function(u){var f=n.getTypeOf(u);return n.checkSupport(f),f!=="string"||s.uint8array?f==="nodebuffer"?new c(u):s.uint8array?new g(n.transformTo("uint8array",u)):new t(n.transformTo("array",u)):new i(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,l,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,l,o){var n=r("./GenericWorker"),s=r("../utils");function t(i){n.call(this,"ConvertWorker to "+i),this.destType=i}s.inherits(t,n),t.prototype.processChunk=function(i){this.push({data:s.transformTo(this.destType,i.data),meta:i.meta})},l.exports=t},{"../utils":32,"./GenericWorker":28}],25:[function(r,l,o){var n=r("./GenericWorker"),s=r("../crc32");function t(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(t,n),t.prototype.processChunk=function(i){this.streamInfo.crc32=s(i.data,this.streamInfo.crc32||0),this.push(i)},l.exports=t},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,l,o){var n=r("../utils"),s=r("./GenericWorker");function t(i){s.call(this,"DataLengthProbe for "+i),this.propName=i,this.withStreamInfo(i,0)}n.inherits(t,s),t.prototype.processChunk=function(i){if(i){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+i.data.length}s.prototype.processChunk.call(this,i)},l.exports=t},{"../utils":32,"./GenericWorker":28}],27:[function(r,l,o){var n=r("../utils"),s=r("./GenericWorker");function t(i){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,i.then(function(g){c.dataIsReady=!0,c.data=g,c.max=g&&g.length||0,c.type=n.getTypeOf(g),c.isPaused||c._tickAndRepeat()},function(g){c.error(g)})}n.inherits(t,s),t.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},t.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},t.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},t.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var i=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":i=this.data.substring(this.index,c);break;case"uint8array":i=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":i=this.data.slice(this.index,c)}return this.index=c,this.push({data:i,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=t},{"../utils":32,"./GenericWorker":28}],28:[function(r,l,o){function n(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,t){return this._listeners[s].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,t){if(this._listeners[s])for(var i=0;i<this._listeners[s].length;i++)this._listeners[s][i].call(this,t)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var t=this;return s.on("data",function(i){t.processChunk(i)}),s.on("end",function(){t.end()}),s.on("error",function(i){t.error(i)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,t){return this.extraStreamInfo[s]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},l.exports=n},{}],29:[function(r,l,o){var n=r("../utils"),s=r("./ConvertWorker"),t=r("./GenericWorker"),i=r("../base64"),c=r("../support"),g=r("../external"),u=null;if(c.nodestream)try{u=r("../nodejs/NodejsStreamOutputAdapter")}catch(_){}function f(_,m){return new g.Promise(function(y,v){var w=[],R=_._internalType,A=_._outputType,T=_._mimeType;_.on("data",function(F,I){w.push(F),m&&m(I)}).on("error",function(F){w=[],v(F)}).on("end",function(){try{var F=function(I,B,z){switch(I){case"blob":return n.newBlob(n.transformTo("arraybuffer",B),z);case"base64":return i.encode(B);default:return n.transformTo(I,B)}}(A,function(I,B){var z,V=0,q=null,k=0;for(z=0;z<B.length;z++)k+=B[z].length;switch(I){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(q=new Uint8Array(k),z=0;z<B.length;z++)q.set(B[z],V),V+=B[z].length;return q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+I+"'")}}(R,w),T);y(F)}catch(I){v(I)}w=[]}).resume()})}function d(_,m,y){var v=m;switch(m){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=m,this._mimeType=y,n.checkSupport(v),this._worker=_.pipe(new s(v)),_.lock()}catch(w){this._worker=new t("error"),this._worker.error(w)}}d.prototype={accumulate:function(_){return f(this,_)},on:function(_,m){var y=this;return _==="data"?this._worker.on(_,function(v){m.call(y,v.data,v.meta)}):this._worker.on(_,function(){n.delay(m,arguments,y)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},_)}},l.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,l,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var n=new ArrayBuffer(0);try{o.blob=new Blob([n],{type:"application/zip"}).size===0}catch(t){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(n),o.blob=s.getBlob("application/zip").size===0}catch(i){o.blob=!1}}}try{o.nodestream=!!r("readable-stream").Readable}catch(t){o.nodestream=!1}},{"readable-stream":16}],31:[function(r,l,o){for(var n=r("./utils"),s=r("./support"),t=r("./nodejsUtils"),i=r("./stream/GenericWorker"),c=new Array(256),g=0;g<256;g++)c[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;c[254]=c[254]=1;function u(){i.call(this,"utf-8 decode"),this.leftOver=null}function f(){i.call(this,"utf-8 encode")}o.utf8encode=function(d){return s.nodebuffer?t.newBufferFrom(d,"utf-8"):function(_){var m,y,v,w,R,A=_.length,T=0;for(w=0;w<A;w++)(64512&(y=_.charCodeAt(w)))==55296&&w+1<A&&(64512&(v=_.charCodeAt(w+1)))==56320&&(y=65536+(y-55296<<10)+(v-56320),w++),T+=y<128?1:y<2048?2:y<65536?3:4;for(m=s.uint8array?new Uint8Array(T):new Array(T),w=R=0;R<T;w++)(64512&(y=_.charCodeAt(w)))==55296&&w+1<A&&(64512&(v=_.charCodeAt(w+1)))==56320&&(y=65536+(y-55296<<10)+(v-56320),w++),y<128?m[R++]=y:(y<2048?m[R++]=192|y>>>6:(y<65536?m[R++]=224|y>>>12:(m[R++]=240|y>>>18,m[R++]=128|y>>>12&63),m[R++]=128|y>>>6&63),m[R++]=128|63&y);return m}(d)},o.utf8decode=function(d){return s.nodebuffer?n.transformTo("nodebuffer",d).toString("utf-8"):function(_){var m,y,v,w,R=_.length,A=new Array(2*R);for(m=y=0;m<R;)if((v=_[m++])<128)A[y++]=v;else if(4<(w=c[v]))A[y++]=65533,m+=w-1;else{for(v&=w===2?31:w===3?15:7;1<w&&m<R;)v=v<<6|63&_[m++],w--;1<w?A[y++]=65533:v<65536?A[y++]=v:(v-=65536,A[y++]=55296|v>>10&1023,A[y++]=56320|1023&v)}return A.length!==y&&(A.subarray?A=A.subarray(0,y):A.length=y),n.applyFromCharCode(A)}(d=n.transformTo(s.uint8array?"uint8array":"array",d))},n.inherits(u,i),u.prototype.processChunk=function(d){var _=n.transformTo(s.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var m=_;(_=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),_.set(m,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var y=function(w,R){var A;for((R=R||w.length)>w.length&&(R=w.length),A=R-1;0<=A&&(192&w[A])==128;)A--;return A<0||A===0?R:A+c[w[A]]>R?A:R}(_),v=_;y!==_.length&&(s.uint8array?(v=_.subarray(0,y),this.leftOver=_.subarray(y,_.length)):(v=_.slice(0,y),this.leftOver=_.slice(y,_.length))),this.push({data:o.utf8decode(v),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=u,n.inherits(f,i),f.prototype.processChunk=function(d){this.push({data:o.utf8encode(d.data),meta:d.meta})},o.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,l,o){var n=r("./support"),s=r("./base64"),t=r("./nodejsUtils"),i=r("./external");function c(m){return m}function g(m,y){for(var v=0;v<m.length;++v)y[v]=255&m.charCodeAt(v);return y}r("setimmediate"),o.newBlob=function(m,y){o.checkSupport("blob");try{return new Blob([m],{type:y})}catch(w){try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(m),v.getBlob(y)}catch(R){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,y,v){var w=[],R=0,A=m.length;if(A<=v)return String.fromCharCode.apply(null,m);for(;R<A;)y==="array"||y==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(R,Math.min(R+v,A)))):w.push(String.fromCharCode.apply(null,m.subarray(R,Math.min(R+v,A)))),R+=v;return w.join("")},stringifyByChar:function(m){for(var y="",v=0;v<m.length;v++)y+=String.fromCharCode(m[v]);return y},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(m){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,t.allocBuffer(1)).length===1}catch(m){return!1}}()}};function f(m){var y=65536,v=o.getTypeOf(m),w=!0;if(v==="uint8array"?w=u.applyCanBeUsed.uint8array:v==="nodebuffer"&&(w=u.applyCanBeUsed.nodebuffer),w)for(;1<y;)try{return u.stringifyByChunk(m,v,y)}catch(R){y=Math.floor(y/2)}return u.stringifyByChar(m)}function d(m,y){for(var v=0;v<m.length;v++)y[v]=m[v];return y}o.applyFromCharCode=f;var _={};_.string={string:c,array:function(m){return g(m,new Array(m.length))},arraybuffer:function(m){return _.string.uint8array(m).buffer},uint8array:function(m){return g(m,new Uint8Array(m.length))},nodebuffer:function(m){return g(m,t.allocBuffer(m.length))}},_.array={string:f,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return t.newBufferFrom(m)}},_.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return t.newBufferFrom(new Uint8Array(m))}},_.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return t.newBufferFrom(m)}},_.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return _.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:c},o.transformTo=function(m,y){if(y=y||"",!m)return y;o.checkSupport(m);var v=o.getTypeOf(y);return _[v][m](y)},o.resolve=function(m){for(var y=m.split("/"),v=[],w=0;w<y.length;w++){var R=y[w];R==="."||R===""&&w!==0&&w!==y.length-1||(R===".."?v.pop():v.push(R))}return v.join("/")},o.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":n.nodebuffer&&t.isBuffer(m)?"nodebuffer":n.uint8array&&m instanceof Uint8Array?"uint8array":n.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(m){if(!n[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(m){var y,v,w="";for(v=0;v<(m||"").length;v++)w+="\\x"+((y=m.charCodeAt(v))<16?"0":"")+y.toString(16).toUpperCase();return w},o.delay=function(m,y,v){setImmediate(function(){m.apply(v||null,y||[])})},o.inherits=function(m,y){function v(){}v.prototype=y.prototype,m.prototype=new v},o.extend=function(){var m,y,v={};for(m=0;m<arguments.length;m++)for(y in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],y)&&v[y]===void 0&&(v[y]=arguments[m][y]);return v},o.prepareContent=function(m,y,v,w,R){return i.Promise.resolve(y).then(function(A){return n.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new i.Promise(function(T,F){var I=new FileReader;I.onload=function(B){T(B.target.result)},I.onerror=function(B){F(B.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var T=o.getTypeOf(A);return T?(T==="arraybuffer"?A=o.transformTo("uint8array",A):T==="string"&&(R?A=s.decode(A):v&&w!==!0&&(A=function(F){return g(F,n.uint8array?new Uint8Array(F.length):new Array(F.length))}(A))),A):i.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,l,o){var n=r("./reader/readerFor"),s=r("./utils"),t=r("./signature"),i=r("./zipEntry"),c=r("./support");function g(u){this.files=[],this.loadOptions=u}g.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(f)+", expected "+s.pretty(u)+")")}},isSignature:function(u,f){var d=this.reader.index;this.reader.setIndex(u);var _=this.reader.readString(4)===f;return this.reader.setIndex(d),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),f=c.uint8array?"uint8array":"array",d=s.transformTo(f,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,f,d,_=this.zip64EndOfCentralSize-44;0<_;)u=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[u]={id:u,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,f;for(u=0;u<this.files.length;u++)f=this.files[u],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(t.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(t.CENTRAL_FILE_HEADER);)(u=new i({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(t.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,t.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var f=u;if(this.checkSignature(t.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,t.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var _=f-d;if(0<_)this.isSignature(f,t.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(u){this.reader=n(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=g},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,l,o){var n=r("./reader/readerFor"),s=r("./utils"),t=r("./compressedObject"),i=r("./crc32"),c=r("./utf8"),g=r("./compressions"),u=r("./support");function f(d,_){this.options=d,this.loadOptions=_}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var _,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=function(y){for(var v in g)if(Object.prototype.hasOwnProperty.call(g,v)&&g[v].magic===y)return g[v];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new t(this.compressedSize,this.uncompressedSize,this.crc32,_,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var _=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(_),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var _,m,y,v=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<v;)_=d.readInt(2),m=d.readInt(2),y=d.readData(m),this.extraFields[_]={id:_,length:m,value:y};d.setIndex(v)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var m=s.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var v=s.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var _=n(d.value);return _.readInt(1)!==1||i(this.fileName)!==_.readInt(4)?null:c.utf8decode(_.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var _=n(d.value);return _.readInt(1)!==1||i(this.fileComment)!==_.readInt(4)?null:c.utf8decode(_.readData(d.length-5))}return null}},l.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,l,o){function n(_,m,y){this.name=_,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=m,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var s=r("./stream/StreamHelper"),t=r("./stream/DataWorker"),i=r("./utf8"),c=r("./compressedObject"),g=r("./stream/GenericWorker");n.prototype={internalStream:function(_){var m=null,y="string";try{if(!_)throw new Error("No output type specified.");var v=(y=_.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!v&&(m=m.pipe(new i.Utf8EncodeWorker)),!w&&v&&(m=m.pipe(new i.Utf8DecodeWorker))}catch(R){(m=new g("error")).error(R)}return new s(m,y,"")},async:function(_,m){return this.internalStream(_).accumulate(m)},nodeStream:function(_,m){return this.internalStream(_||"nodebuffer").toNodejsStream(m)},_compressWorker:function(_,m){if(this._data instanceof c&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new i.Utf8EncodeWorker)),c.createWorkerFrom(y,_,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof g?this._data:new t(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)n.prototype[u[d]]=f;l.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,l,o){(function(n){var s,t,i=n.MutationObserver||n.WebKitMutationObserver;if(i){var c=0,g=new i(_),u=n.document.createTextNode("");g.observe(u,{characterData:!0}),s=function(){u.data=c=++c%2}}else if(n.setImmediate||n.MessageChannel===void 0)s="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var m=n.document.createElement("script");m.onreadystatechange=function(){_(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},n.document.documentElement.appendChild(m)}:function(){setTimeout(_,0)};else{var f=new n.MessageChannel;f.port1.onmessage=_,s=function(){f.port2.postMessage(0)}}var d=[];function _(){var m,y;t=!0;for(var v=d.length;v;){for(y=d,d=[],m=-1;++m<v;)y[m]();v=d.length}t=!1}l.exports=function(m){d.push(m)!==1||t||s()}}).call(this,typeof ut<"u"?ut:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,l,o){var n=r("immediate");function s(){}var t={},i=["REJECTED"],c=["FULFILLED"],g=["PENDING"];function u(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,v!==s&&m(this,v)}function f(v,w,R){this.promise=v,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function d(v,w,R){n(function(){var A;try{A=w(R)}catch(T){return t.reject(v,T)}A===v?t.reject(v,new TypeError("Cannot resolve promise with itself")):t.resolve(v,A)})}function _(v){var w=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof w=="function")return function(){w.apply(v,arguments)}}function m(v,w){var R=!1;function A(I){R||(R=!0,t.reject(v,I))}function T(I){R||(R=!0,t.resolve(v,I))}var F=y(function(){w(T,A)});F.status==="error"&&A(F.value)}function y(v,w){var R={};try{R.value=v(w),R.status="success"}catch(A){R.status="error",R.value=A}return R}(l.exports=u).prototype.finally=function(v){if(typeof v!="function")return this;var w=this.constructor;return this.then(function(R){return w.resolve(v()).then(function(){return R})},function(R){return w.resolve(v()).then(function(){throw R})})},u.prototype.catch=function(v){return this.then(null,v)},u.prototype.then=function(v,w){if(typeof v!="function"&&this.state===c||typeof w!="function"&&this.state===i)return this;var R=new this.constructor(s);return this.state!==g?d(R,this.state===c?v:w,this.outcome):this.queue.push(new f(R,v,w)),R},f.prototype.callFulfilled=function(v){t.resolve(this.promise,v)},f.prototype.otherCallFulfilled=function(v){d(this.promise,this.onFulfilled,v)},f.prototype.callRejected=function(v){t.reject(this.promise,v)},f.prototype.otherCallRejected=function(v){d(this.promise,this.onRejected,v)},t.resolve=function(v,w){var R=y(_,w);if(R.status==="error")return t.reject(v,R.value);var A=R.value;if(A)m(v,A);else{v.state=c,v.outcome=w;for(var T=-1,F=v.queue.length;++T<F;)v.queue[T].callFulfilled(w)}return v},t.reject=function(v,w){v.state=i,v.outcome=w;for(var R=-1,A=v.queue.length;++R<A;)v.queue[R].callRejected(w);return v},u.resolve=function(v){return v instanceof this?v:t.resolve(new this(s),v)},u.reject=function(v){var w=new this(s);return t.reject(w,v)},u.all=function(v){var w=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=v.length,A=!1;if(!R)return this.resolve([]);for(var T=new Array(R),F=0,I=-1,B=new this(s);++I<R;)z(v[I],I);return B;function z(V,q){w.resolve(V).then(function(k){T[q]=k,++F!==R||A||(A=!0,t.resolve(B,T))},function(k){A||(A=!0,t.reject(B,k))})}},u.race=function(v){var w=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=v.length,A=!1;if(!R)return this.resolve([]);for(var T=-1,F=new this(s);++T<R;)I=v[T],w.resolve(I).then(function(B){A||(A=!0,t.resolve(F,B))},function(B){A||(A=!0,t.reject(F,B))});var I;return F}},{immediate:36}],38:[function(r,l,o){var n={};(0,r("./lib/utils/common").assign)(n,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),l.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,l,o){var n=r("./zlib/deflate"),s=r("./utils/common"),t=r("./utils/strings"),i=r("./zlib/messages"),c=r("./zlib/zstream"),g=Object.prototype.toString,u=0,f=-1,d=0,_=8;function m(v){if(!(this instanceof m))return new m(v);this.options=s.assign({level:f,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},v||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var R=n.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(R!==u)throw new Error(i[R]);if(w.header&&n.deflateSetHeader(this.strm,w.header),w.dictionary){var A;if(A=typeof w.dictionary=="string"?t.string2buf(w.dictionary):g.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(R=n.deflateSetDictionary(this.strm,A))!==u)throw new Error(i[R]);this._dict_set=!0}}function y(v,w){var R=new m(w);if(R.push(v,!0),R.err)throw R.msg||i[R.err];return R.result}m.prototype.push=function(v,w){var R,A,T=this.strm,F=this.options.chunkSize;if(this.ended)return!1;A=w===~~w?w:w===!0?4:0,typeof v=="string"?T.input=t.string2buf(v):g.call(v)==="[object ArrayBuffer]"?T.input=new Uint8Array(v):T.input=v,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new s.Buf8(F),T.next_out=0,T.avail_out=F),(R=n.deflate(T,A))!==1&&R!==u)return this.onEnd(R),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(t.buf2binstring(s.shrinkBuf(T.output,T.next_out))):this.onData(s.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&R!==1);return A===4?(R=n.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===u):A!==2||(this.onEnd(u),!(T.avail_out=0))},m.prototype.onData=function(v){this.chunks.push(v)},m.prototype.onEnd=function(v){v===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},o.Deflate=m,o.deflate=y,o.deflateRaw=function(v,w){return(w=w||{}).raw=!0,y(v,w)},o.gzip=function(v,w){return(w=w||{}).gzip=!0,y(v,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,l,o){var n=r("./zlib/inflate"),s=r("./utils/common"),t=r("./utils/strings"),i=r("./zlib/constants"),c=r("./zlib/messages"),g=r("./zlib/zstream"),u=r("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},m||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||m&&m.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var v=n.inflateInit2(this.strm,y.windowBits);if(v!==i.Z_OK)throw new Error(c[v]);this.header=new u,n.inflateGetHeader(this.strm,this.header)}function _(m,y){var v=new d(y);if(v.push(m,!0),v.err)throw v.msg||c[v.err];return v.result}d.prototype.push=function(m,y){var v,w,R,A,T,F,I=this.strm,B=this.options.chunkSize,z=this.options.dictionary,V=!1;if(this.ended)return!1;w=y===~~y?y:y===!0?i.Z_FINISH:i.Z_NO_FLUSH,typeof m=="string"?I.input=t.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?I.input=new Uint8Array(m):I.input=m,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new s.Buf8(B),I.next_out=0,I.avail_out=B),(v=n.inflate(I,i.Z_NO_FLUSH))===i.Z_NEED_DICT&&z&&(F=typeof z=="string"?t.string2buf(z):f.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,v=n.inflateSetDictionary(this.strm,F)),v===i.Z_BUF_ERROR&&V===!0&&(v=i.Z_OK,V=!1),v!==i.Z_STREAM_END&&v!==i.Z_OK)return this.onEnd(v),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&v!==i.Z_STREAM_END&&(I.avail_in!==0||w!==i.Z_FINISH&&w!==i.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=t.utf8border(I.output,I.next_out),A=I.next_out-R,T=t.buf2string(I.output,R),I.next_out=A,I.avail_out=B-A,A&&s.arraySet(I.output,I.output,R,A,0),this.onData(T)):this.onData(s.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(V=!0)}while((0<I.avail_in||I.avail_out===0)&&v!==i.Z_STREAM_END);return v===i.Z_STREAM_END&&(w=i.Z_FINISH),w===i.Z_FINISH?(v=n.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===i.Z_OK):w!==i.Z_SYNC_FLUSH||(this.onEnd(i.Z_OK),!(I.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===i.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},o.Inflate=d,o.inflate=_,o.inflateRaw=function(m,y){return(y=y||{}).raw=!0,_(m,y)},o.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,l,o){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(i){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var g=c.shift();if(g){if(typeof g!="object")throw new TypeError(g+"must be non-object");for(var u in g)g.hasOwnProperty(u)&&(i[u]=g[u])}}return i},o.shrinkBuf=function(i,c){return i.length===c?i:i.subarray?i.subarray(0,c):(i.length=c,i)};var s={arraySet:function(i,c,g,u,f){if(c.subarray&&i.subarray)i.set(c.subarray(g,g+u),f);else for(var d=0;d<u;d++)i[f+d]=c[g+d]},flattenChunks:function(i){var c,g,u,f,d,_;for(c=u=0,g=i.length;c<g;c++)u+=i[c].length;for(_=new Uint8Array(u),c=f=0,g=i.length;c<g;c++)d=i[c],_.set(d,f),f+=d.length;return _}},t={arraySet:function(i,c,g,u,f){for(var d=0;d<u;d++)i[f+d]=c[g+d]},flattenChunks:function(i){return[].concat.apply([],i)}};o.setTyped=function(i){i?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,t))},o.setTyped(n)},{}],42:[function(r,l,o){var n=r("./common"),s=!0,t=!0;try{String.fromCharCode.apply(null,[0])}catch(u){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){t=!1}for(var i=new n.Buf8(256),c=0;c<256;c++)i[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function g(u,f){if(f<65537&&(u.subarray&&t||!u.subarray&&s))return String.fromCharCode.apply(null,n.shrinkBuf(u,f));for(var d="",_=0;_<f;_++)d+=String.fromCharCode(u[_]);return d}i[254]=i[254]=1,o.string2buf=function(u){var f,d,_,m,y,v=u.length,w=0;for(m=0;m<v;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<v&&(64512&(_=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(_-56320),m++),w+=d<128?1:d<2048?2:d<65536?3:4;for(f=new n.Buf8(w),m=y=0;y<w;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<v&&(64512&(_=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(_-56320),m++),d<128?f[y++]=d:(d<2048?f[y++]=192|d>>>6:(d<65536?f[y++]=224|d>>>12:(f[y++]=240|d>>>18,f[y++]=128|d>>>12&63),f[y++]=128|d>>>6&63),f[y++]=128|63&d);return f},o.buf2binstring=function(u){return g(u,u.length)},o.binstring2buf=function(u){for(var f=new n.Buf8(u.length),d=0,_=f.length;d<_;d++)f[d]=u.charCodeAt(d);return f},o.buf2string=function(u,f){var d,_,m,y,v=f||u.length,w=new Array(2*v);for(d=_=0;d<v;)if((m=u[d++])<128)w[_++]=m;else if(4<(y=i[m]))w[_++]=65533,d+=y-1;else{for(m&=y===2?31:y===3?15:7;1<y&&d<v;)m=m<<6|63&u[d++],y--;1<y?w[_++]=65533:m<65536?w[_++]=m:(m-=65536,w[_++]=55296|m>>10&1023,w[_++]=56320|1023&m)}return g(w,_)},o.utf8border=function(u,f){var d;for((f=f||u.length)>u.length&&(f=u.length),d=f-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?f:d+i[u[d]]>f?d:f}},{"./common":41}],43:[function(r,l,o){l.exports=function(n,s,t,i){for(var c=65535&n|0,g=n>>>16&65535|0,u=0;t!==0;){for(t-=u=2e3<t?2e3:t;g=g+(c=c+s[i++]|0)|0,--u;);c%=65521,g%=65521}return c|g<<16|0}},{}],44:[function(r,l,o){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,l,o){var n=function(){for(var s,t=[],i=0;i<256;i++){s=i;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;t[i]=s}return t}();l.exports=function(s,t,i,c){var g=n,u=c+i;s^=-1;for(var f=c;f<u;f++)s=s>>>8^g[255&(s^t[f])];return-1^s}},{}],46:[function(r,l,o){var n,s=r("../utils/common"),t=r("./trees"),i=r("./adler32"),c=r("./crc32"),g=r("./messages"),u=0,f=4,d=0,_=-2,m=-1,y=4,v=2,w=8,R=9,A=286,T=30,F=19,I=2*A+1,B=15,z=3,V=258,q=V+z+1,k=42,j=113,h=1,M=2,se=3,W=4;function ae(a,N){return a.msg=g[N],N}function Z(a){return(a<<1)-(4<a?9:0)}function ie(a){for(var N=a.length;0<=--N;)a[N]=0}function D(a){var N=a.state,L=N.pending;L>a.avail_out&&(L=a.avail_out),L!==0&&(s.arraySet(a.output,N.pending_buf,N.pending_out,L,a.next_out),a.next_out+=L,N.pending_out+=L,a.total_out+=L,a.avail_out-=L,N.pending-=L,N.pending===0&&(N.pending_out=0))}function x(a,N){t._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,N),a.block_start=a.strstart,D(a.strm)}function re(a,N){a.pending_buf[a.pending++]=N}function X(a,N){a.pending_buf[a.pending++]=N>>>8&255,a.pending_buf[a.pending++]=255&N}function K(a,N){var L,E,S=a.max_chain_length,P=a.strstart,H=a.prev_length,U=a.nice_match,C=a.strstart>a.w_size-q?a.strstart-(a.w_size-q):0,G=a.window,Q=a.w_mask,Y=a.prev,ne=a.strstart+V,he=G[P+H-1],ce=G[P+H];a.prev_length>=a.good_match&&(S>>=2),U>a.lookahead&&(U=a.lookahead);do if(G[(L=N)+H]===ce&&G[L+H-1]===he&&G[L]===G[P]&&G[++L]===G[P+1]){P+=2,L++;do;while(G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&P<ne);if(E=V-(ne-P),P=ne-V,H<E){if(a.match_start=N,U<=(H=E))break;he=G[P+H-1],ce=G[P+H]}}while((N=Y[N&Q])>C&&--S!=0);return H<=a.lookahead?H:a.lookahead}function pe(a){var N,L,E,S,P,H,U,C,G,Q,Y=a.w_size;do{if(S=a.window_size-a.lookahead-a.strstart,a.strstart>=Y+(Y-q)){for(s.arraySet(a.window,a.window,Y,Y,0),a.match_start-=Y,a.strstart-=Y,a.block_start-=Y,N=L=a.hash_size;E=a.head[--N],a.head[N]=Y<=E?E-Y:0,--L;);for(N=L=Y;E=a.prev[--N],a.prev[N]=Y<=E?E-Y:0,--L;);S+=Y}if(a.strm.avail_in===0)break;if(H=a.strm,U=a.window,C=a.strstart+a.lookahead,G=S,Q=void 0,Q=H.avail_in,G<Q&&(Q=G),L=Q===0?0:(H.avail_in-=Q,s.arraySet(U,H.input,H.next_in,Q,C),H.state.wrap===1?H.adler=i(H.adler,U,Q,C):H.state.wrap===2&&(H.adler=c(H.adler,U,Q,C)),H.next_in+=Q,H.total_in+=Q,Q),a.lookahead+=L,a.lookahead+a.insert>=z)for(P=a.strstart-a.insert,a.ins_h=a.window[P],a.ins_h=(a.ins_h<<a.hash_shift^a.window[P+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[P+z-1])&a.hash_mask,a.prev[P&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=P,P++,a.insert--,!(a.lookahead+a.insert<z)););}while(a.lookahead<q&&a.strm.avail_in!==0)}function Se(a,N){for(var L,E;;){if(a.lookahead<q){if(pe(a),a.lookahead<q&&N===u)return h;if(a.lookahead===0)break}if(L=0,a.lookahead>=z&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),L!==0&&a.strstart-L<=a.w_size-q&&(a.match_length=K(a,L)),a.match_length>=z)if(E=t._tr_tally(a,a.strstart-a.match_start,a.match_length-z),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=z){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else E=t._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(E&&(x(a,!1),a.strm.avail_out===0))return h}return a.insert=a.strstart<z-1?a.strstart:z-1,N===f?(x(a,!0),a.strm.avail_out===0?se:W):a.last_lit&&(x(a,!1),a.strm.avail_out===0)?h:M}function le(a,N){for(var L,E,S;;){if(a.lookahead<q){if(pe(a),a.lookahead<q&&N===u)return h;if(a.lookahead===0)break}if(L=0,a.lookahead>=z&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=z-1,L!==0&&a.prev_length<a.max_lazy_match&&a.strstart-L<=a.w_size-q&&(a.match_length=K(a,L),a.match_length<=5&&(a.strategy===1||a.match_length===z&&4096<a.strstart-a.match_start)&&(a.match_length=z-1)),a.prev_length>=z&&a.match_length<=a.prev_length){for(S=a.strstart+a.lookahead-z,E=t._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-z),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=S&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+z-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=z-1,a.strstart++,E&&(x(a,!1),a.strm.avail_out===0))return h}else if(a.match_available){if((E=t._tr_tally(a,0,a.window[a.strstart-1]))&&x(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return h}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(E=t._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<z-1?a.strstart:z-1,N===f?(x(a,!0),a.strm.avail_out===0?se:W):a.last_lit&&(x(a,!1),a.strm.avail_out===0)?h:M}function de(a,N,L,E,S){this.good_length=a,this.max_lazy=N,this.nice_length=L,this.max_chain=E,this.func=S}function ye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*I),this.dyn_dtree=new s.Buf16(2*(2*T+1)),this.bl_tree=new s.Buf16(2*(2*F+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(B+1),this.heap=new s.Buf16(2*A+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*A+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fe(a){var N;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=v,(N=a.state).pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap?k:j,a.adler=N.wrap===2?0:1,N.last_flush=u,t._tr_init(N),d):ae(a,_)}function Pe(a){var N=fe(a);return N===d&&function(L){L.window_size=2*L.w_size,ie(L.head),L.max_lazy_match=n[L.level].max_lazy,L.good_match=n[L.level].good_length,L.nice_match=n[L.level].nice_length,L.max_chain_length=n[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=z-1,L.match_available=0,L.ins_h=0}(a.state),N}function Re(a,N,L,E,S,P){if(!a)return _;var H=1;if(N===m&&(N=6),E<0?(H=0,E=-E):15<E&&(H=2,E-=16),S<1||R<S||L!==w||E<8||15<E||N<0||9<N||P<0||y<P)return ae(a,_);E===8&&(E=9);var U=new ye;return(a.state=U).strm=a,U.wrap=H,U.gzhead=null,U.w_bits=E,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=S+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+z-1)/z),U.window=new s.Buf8(2*U.w_size),U.head=new s.Buf16(U.hash_size),U.prev=new s.Buf16(U.w_size),U.lit_bufsize=1<<S+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new s.Buf8(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=N,U.strategy=P,U.method=L,Pe(a)}n=[new de(0,0,0,0,function(a,N){var L=65535;for(L>a.pending_buf_size-5&&(L=a.pending_buf_size-5);;){if(a.lookahead<=1){if(pe(a),a.lookahead===0&&N===u)return h;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var E=a.block_start+L;if((a.strstart===0||a.strstart>=E)&&(a.lookahead=a.strstart-E,a.strstart=E,x(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-q&&(x(a,!1),a.strm.avail_out===0))return h}return a.insert=0,N===f?(x(a,!0),a.strm.avail_out===0?se:W):(a.strstart>a.block_start&&(x(a,!1),a.strm.avail_out),h)}),new de(4,4,8,4,Se),new de(4,5,16,8,Se),new de(4,6,32,32,Se),new de(4,4,16,16,le),new de(8,16,32,32,le),new de(8,16,128,128,le),new de(8,32,128,256,le),new de(32,128,258,1024,le),new de(32,258,258,4096,le)],o.deflateInit=function(a,N){return Re(a,N,w,15,8,0)},o.deflateInit2=Re,o.deflateReset=Pe,o.deflateResetKeep=fe,o.deflateSetHeader=function(a,N){return a&&a.state?a.state.wrap!==2?_:(a.state.gzhead=N,d):_},o.deflate=function(a,N){var L,E,S,P;if(!a||!a.state||5<N||N<0)return a?ae(a,_):_;if(E=a.state,!a.output||!a.input&&a.avail_in!==0||E.status===666&&N!==f)return ae(a,a.avail_out===0?-5:_);if(E.strm=a,L=E.last_flush,E.last_flush=N,E.status===k)if(E.wrap===2)a.adler=0,re(E,31),re(E,139),re(E,8),E.gzhead?(re(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),re(E,255&E.gzhead.time),re(E,E.gzhead.time>>8&255),re(E,E.gzhead.time>>16&255),re(E,E.gzhead.time>>24&255),re(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),re(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(re(E,255&E.gzhead.extra.length),re(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(a.adler=c(a.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(re(E,0),re(E,0),re(E,0),re(E,0),re(E,0),re(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),re(E,3),E.status=j);else{var H=w+(E.w_bits-8<<4)<<8;H|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(H|=32),H+=31-H%31,E.status=j,X(E,H),E.strstart!==0&&(X(E,a.adler>>>16),X(E,65535&a.adler)),a.adler=1}if(E.status===69)if(E.gzhead.extra){for(S=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),D(a),S=E.pending,E.pending!==E.pending_buf_size));)re(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){S=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),D(a),S=E.pending,E.pending===E.pending_buf_size)){P=1;break}P=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,re(E,P)}while(P!==0);E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),P===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){S=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),D(a),S=E.pending,E.pending===E.pending_buf_size)){P=1;break}P=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,re(E,P)}while(P!==0);E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),P===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&D(a),E.pending+2<=E.pending_buf_size&&(re(E,255&a.adler),re(E,a.adler>>8&255),a.adler=0,E.status=j)):E.status=j),E.pending!==0){if(D(a),a.avail_out===0)return E.last_flush=-1,d}else if(a.avail_in===0&&Z(N)<=Z(L)&&N!==f)return ae(a,-5);if(E.status===666&&a.avail_in!==0)return ae(a,-5);if(a.avail_in!==0||E.lookahead!==0||N!==u&&E.status!==666){var U=E.strategy===2?function(C,G){for(var Q;;){if(C.lookahead===0&&(pe(C),C.lookahead===0)){if(G===u)return h;break}if(C.match_length=0,Q=t._tr_tally(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++,Q&&(x(C,!1),C.strm.avail_out===0))return h}return C.insert=0,G===f?(x(C,!0),C.strm.avail_out===0?se:W):C.last_lit&&(x(C,!1),C.strm.avail_out===0)?h:M}(E,N):E.strategy===3?function(C,G){for(var Q,Y,ne,he,ce=C.window;;){if(C.lookahead<=V){if(pe(C),C.lookahead<=V&&G===u)return h;if(C.lookahead===0)break}if(C.match_length=0,C.lookahead>=z&&0<C.strstart&&(Y=ce[ne=C.strstart-1])===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]){he=C.strstart+V;do;while(Y===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]&&Y===ce[++ne]&&ne<he);C.match_length=V-(he-ne),C.match_length>C.lookahead&&(C.match_length=C.lookahead)}if(C.match_length>=z?(Q=t._tr_tally(C,1,C.match_length-z),C.lookahead-=C.match_length,C.strstart+=C.match_length,C.match_length=0):(Q=t._tr_tally(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++),Q&&(x(C,!1),C.strm.avail_out===0))return h}return C.insert=0,G===f?(x(C,!0),C.strm.avail_out===0?se:W):C.last_lit&&(x(C,!1),C.strm.avail_out===0)?h:M}(E,N):n[E.level].func(E,N);if(U!==se&&U!==W||(E.status=666),U===h||U===se)return a.avail_out===0&&(E.last_flush=-1),d;if(U===M&&(N===1?t._tr_align(E):N!==5&&(t._tr_stored_block(E,0,0,!1),N===3&&(ie(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),D(a),a.avail_out===0))return E.last_flush=-1,d}return N!==f?d:E.wrap<=0?1:(E.wrap===2?(re(E,255&a.adler),re(E,a.adler>>8&255),re(E,a.adler>>16&255),re(E,a.adler>>24&255),re(E,255&a.total_in),re(E,a.total_in>>8&255),re(E,a.total_in>>16&255),re(E,a.total_in>>24&255)):(X(E,a.adler>>>16),X(E,65535&a.adler)),D(a),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?d:1)},o.deflateEnd=function(a){var N;return a&&a.state?(N=a.state.status)!==k&&N!==69&&N!==73&&N!==91&&N!==103&&N!==j&&N!==666?ae(a,_):(a.state=null,N===j?ae(a,-3):d):_},o.deflateSetDictionary=function(a,N){var L,E,S,P,H,U,C,G,Q=N.length;if(!a||!a.state||(P=(L=a.state).wrap)===2||P===1&&L.status!==k||L.lookahead)return _;for(P===1&&(a.adler=i(a.adler,N,Q,0)),L.wrap=0,Q>=L.w_size&&(P===0&&(ie(L.head),L.strstart=0,L.block_start=0,L.insert=0),G=new s.Buf8(L.w_size),s.arraySet(G,N,Q-L.w_size,L.w_size,0),N=G,Q=L.w_size),H=a.avail_in,U=a.next_in,C=a.input,a.avail_in=Q,a.next_in=0,a.input=N,pe(L);L.lookahead>=z;){for(E=L.strstart,S=L.lookahead-(z-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[E+z-1])&L.hash_mask,L.prev[E&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=E,E++,--S;);L.strstart=E,L.lookahead=z-1,pe(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=z-1,L.match_available=0,a.next_in=U,a.input=C,a.avail_in=H,L.wrap=P,d},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,l,o){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,l,o){l.exports=function(n,s){var t,i,c,g,u,f,d,_,m,y,v,w,R,A,T,F,I,B,z,V,q,k,j,h,M;t=n.state,i=n.next_in,h=n.input,c=i+(n.avail_in-5),g=n.next_out,M=n.output,u=g-(s-n.avail_out),f=g+(n.avail_out-257),d=t.dmax,_=t.wsize,m=t.whave,y=t.wnext,v=t.window,w=t.hold,R=t.bits,A=t.lencode,T=t.distcode,F=(1<<t.lenbits)-1,I=(1<<t.distbits)-1;e:do{R<15&&(w+=h[i++]<<R,R+=8,w+=h[i++]<<R,R+=8),B=A[w&F];t:for(;;){if(w>>>=z=B>>>24,R-=z,(z=B>>>16&255)===0)M[g++]=65535&B;else{if(!(16&z)){if(!(64&z)){B=A[(65535&B)+(w&(1<<z)-1)];continue t}if(32&z){t.mode=12;break e}n.msg="invalid literal/length code",t.mode=30;break e}V=65535&B,(z&=15)&&(R<z&&(w+=h[i++]<<R,R+=8),V+=w&(1<<z)-1,w>>>=z,R-=z),R<15&&(w+=h[i++]<<R,R+=8,w+=h[i++]<<R,R+=8),B=T[w&I];n:for(;;){if(w>>>=z=B>>>24,R-=z,!(16&(z=B>>>16&255))){if(!(64&z)){B=T[(65535&B)+(w&(1<<z)-1)];continue n}n.msg="invalid distance code",t.mode=30;break e}if(q=65535&B,R<(z&=15)&&(w+=h[i++]<<R,(R+=8)<z&&(w+=h[i++]<<R,R+=8)),d<(q+=w&(1<<z)-1)){n.msg="invalid distance too far back",t.mode=30;break e}if(w>>>=z,R-=z,(z=g-u)<q){if(m<(z=q-z)&&t.sane){n.msg="invalid distance too far back",t.mode=30;break e}if(j=v,(k=0)===y){if(k+=_-z,z<V){for(V-=z;M[g++]=v[k++],--z;);k=g-q,j=M}}else if(y<z){if(k+=_+y-z,(z-=y)<V){for(V-=z;M[g++]=v[k++],--z;);if(k=0,y<V){for(V-=z=y;M[g++]=v[k++],--z;);k=g-q,j=M}}}else if(k+=y-z,z<V){for(V-=z;M[g++]=v[k++],--z;);k=g-q,j=M}for(;2<V;)M[g++]=j[k++],M[g++]=j[k++],M[g++]=j[k++],V-=3;V&&(M[g++]=j[k++],1<V&&(M[g++]=j[k++]))}else{for(k=g-q;M[g++]=M[k++],M[g++]=M[k++],M[g++]=M[k++],2<(V-=3););V&&(M[g++]=M[k++],1<V&&(M[g++]=M[k++]))}break}}break}}while(i<c&&g<f);i-=V=R>>3,w&=(1<<(R-=V<<3))-1,n.next_in=i,n.next_out=g,n.avail_in=i<c?c-i+5:5-(i-c),n.avail_out=g<f?f-g+257:257-(g-f),t.hold=w,t.bits=R}},{}],49:[function(r,l,o){var n=r("../utils/common"),s=r("./adler32"),t=r("./crc32"),i=r("./inffast"),c=r("./inftrees"),g=1,u=2,f=0,d=-2,_=1,m=852,y=592;function v(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(k){var j;return k&&k.state?(j=k.state,k.total_in=k.total_out=j.total=0,k.msg="",j.wrap&&(k.adler=1&j.wrap),j.mode=_,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new n.Buf32(m),j.distcode=j.distdyn=new n.Buf32(y),j.sane=1,j.back=-1,f):d}function A(k){var j;return k&&k.state?((j=k.state).wsize=0,j.whave=0,j.wnext=0,R(k)):d}function T(k,j){var h,M;return k&&k.state?(M=k.state,j<0?(h=0,j=-j):(h=1+(j>>4),j<48&&(j&=15)),j&&(j<8||15<j)?d:(M.window!==null&&M.wbits!==j&&(M.window=null),M.wrap=h,M.wbits=j,A(k))):d}function F(k,j){var h,M;return k?(M=new w,(k.state=M).window=null,(h=T(k,j))!==f&&(k.state=null),h):d}var I,B,z=!0;function V(k){if(z){var j;for(I=new n.Buf32(512),B=new n.Buf32(32),j=0;j<144;)k.lens[j++]=8;for(;j<256;)k.lens[j++]=9;for(;j<280;)k.lens[j++]=7;for(;j<288;)k.lens[j++]=8;for(c(g,k.lens,0,288,I,0,k.work,{bits:9}),j=0;j<32;)k.lens[j++]=5;c(u,k.lens,0,32,B,0,k.work,{bits:5}),z=!1}k.lencode=I,k.lenbits=9,k.distcode=B,k.distbits=5}function q(k,j,h,M){var se,W=k.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new n.Buf8(W.wsize)),M>=W.wsize?(n.arraySet(W.window,j,h-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(M<(se=W.wsize-W.wnext)&&(se=M),n.arraySet(W.window,j,h-M,se,W.wnext),(M-=se)?(n.arraySet(W.window,j,h-M,M,0),W.wnext=M,W.whave=W.wsize):(W.wnext+=se,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=se))),0}o.inflateReset=A,o.inflateReset2=T,o.inflateResetKeep=R,o.inflateInit=function(k){return F(k,15)},o.inflateInit2=F,o.inflate=function(k,j){var h,M,se,W,ae,Z,ie,D,x,re,X,K,pe,Se,le,de,ye,fe,Pe,Re,a,N,L,E,S=0,P=new n.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return d;(h=k.state).mode===12&&(h.mode=13),ae=k.next_out,se=k.output,ie=k.avail_out,W=k.next_in,M=k.input,Z=k.avail_in,D=h.hold,x=h.bits,re=Z,X=ie,N=f;e:for(;;)switch(h.mode){case _:if(h.wrap===0){h.mode=13;break}for(;x<16;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(2&h.wrap&&D===35615){P[h.check=0]=255&D,P[1]=D>>>8&255,h.check=t(h.check,P,2,0),x=D=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&D)<<8)+(D>>8))%31){k.msg="incorrect header check",h.mode=30;break}if((15&D)!=8){k.msg="unknown compression method",h.mode=30;break}if(x-=4,a=8+(15&(D>>>=4)),h.wbits===0)h.wbits=a;else if(a>h.wbits){k.msg="invalid window size",h.mode=30;break}h.dmax=1<<a,k.adler=h.check=1,h.mode=512&D?10:12,x=D=0;break;case 2:for(;x<16;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(h.flags=D,(255&h.flags)!=8){k.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){k.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=D>>8&1),512&h.flags&&(P[0]=255&D,P[1]=D>>>8&255,h.check=t(h.check,P,2,0)),x=D=0,h.mode=3;case 3:for(;x<32;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}h.head&&(h.head.time=D),512&h.flags&&(P[0]=255&D,P[1]=D>>>8&255,P[2]=D>>>16&255,P[3]=D>>>24&255,h.check=t(h.check,P,4,0)),x=D=0,h.mode=4;case 4:for(;x<16;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}h.head&&(h.head.xflags=255&D,h.head.os=D>>8),512&h.flags&&(P[0]=255&D,P[1]=D>>>8&255,h.check=t(h.check,P,2,0)),x=D=0,h.mode=5;case 5:if(1024&h.flags){for(;x<16;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}h.length=D,h.head&&(h.head.extra_len=D),512&h.flags&&(P[0]=255&D,P[1]=D>>>8&255,h.check=t(h.check,P,2,0)),x=D=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(Z<(K=h.length)&&(K=Z),K&&(h.head&&(a=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),n.arraySet(h.head.extra,M,W,K,a)),512&h.flags&&(h.check=t(h.check,M,K,W)),Z-=K,W+=K,h.length-=K),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(Z===0)break e;for(K=0;a=M[W+K++],h.head&&a&&h.length<65536&&(h.head.name+=String.fromCharCode(a)),a&&K<Z;);if(512&h.flags&&(h.check=t(h.check,M,K,W)),Z-=K,W+=K,a)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(Z===0)break e;for(K=0;a=M[W+K++],h.head&&a&&h.length<65536&&(h.head.comment+=String.fromCharCode(a)),a&&K<Z;);if(512&h.flags&&(h.check=t(h.check,M,K,W)),Z-=K,W+=K,a)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;x<16;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(D!==(65535&h.check)){k.msg="header crc mismatch",h.mode=30;break}x=D=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),k.adler=h.check=0,h.mode=12;break;case 10:for(;x<32;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}k.adler=h.check=v(D),x=D=0,h.mode=11;case 11:if(h.havedict===0)return k.next_out=ae,k.avail_out=ie,k.next_in=W,k.avail_in=Z,h.hold=D,h.bits=x,2;k.adler=h.check=1,h.mode=12;case 12:if(j===5||j===6)break e;case 13:if(h.last){D>>>=7&x,x-=7&x,h.mode=27;break}for(;x<3;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}switch(h.last=1&D,x-=1,3&(D>>>=1)){case 0:h.mode=14;break;case 1:if(V(h),h.mode=20,j!==6)break;D>>>=2,x-=2;break e;case 2:h.mode=17;break;case 3:k.msg="invalid block type",h.mode=30}D>>>=2,x-=2;break;case 14:for(D>>>=7&x,x-=7&x;x<32;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if((65535&D)!=(D>>>16^65535)){k.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&D,x=D=0,h.mode=15,j===6)break e;case 15:h.mode=16;case 16:if(K=h.length){if(Z<K&&(K=Z),ie<K&&(K=ie),K===0)break e;n.arraySet(se,M,W,K,ae),Z-=K,W+=K,ie-=K,ae+=K,h.length-=K;break}h.mode=12;break;case 17:for(;x<14;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(h.nlen=257+(31&D),D>>>=5,x-=5,h.ndist=1+(31&D),D>>>=5,x-=5,h.ncode=4+(15&D),D>>>=4,x-=4,286<h.nlen||30<h.ndist){k.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;x<3;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}h.lens[H[h.have++]]=7&D,D>>>=3,x-=3}for(;h.have<19;)h.lens[H[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,L={bits:h.lenbits},N=c(0,h.lens,0,19,h.lencode,0,h.work,L),h.lenbits=L.bits,N){k.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;de=(S=h.lencode[D&(1<<h.lenbits)-1])>>>16&255,ye=65535&S,!((le=S>>>24)<=x);){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(ye<16)D>>>=le,x-=le,h.lens[h.have++]=ye;else{if(ye===16){for(E=le+2;x<E;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(D>>>=le,x-=le,h.have===0){k.msg="invalid bit length repeat",h.mode=30;break}a=h.lens[h.have-1],K=3+(3&D),D>>>=2,x-=2}else if(ye===17){for(E=le+3;x<E;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}x-=le,a=0,K=3+(7&(D>>>=le)),D>>>=3,x-=3}else{for(E=le+7;x<E;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}x-=le,a=0,K=11+(127&(D>>>=le)),D>>>=7,x-=7}if(h.have+K>h.nlen+h.ndist){k.msg="invalid bit length repeat",h.mode=30;break}for(;K--;)h.lens[h.have++]=a}}if(h.mode===30)break;if(h.lens[256]===0){k.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,L={bits:h.lenbits},N=c(g,h.lens,0,h.nlen,h.lencode,0,h.work,L),h.lenbits=L.bits,N){k.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,L={bits:h.distbits},N=c(u,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,L),h.distbits=L.bits,N){k.msg="invalid distances set",h.mode=30;break}if(h.mode=20,j===6)break e;case 20:h.mode=21;case 21:if(6<=Z&&258<=ie){k.next_out=ae,k.avail_out=ie,k.next_in=W,k.avail_in=Z,h.hold=D,h.bits=x,i(k,X),ae=k.next_out,se=k.output,ie=k.avail_out,W=k.next_in,M=k.input,Z=k.avail_in,D=h.hold,x=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;de=(S=h.lencode[D&(1<<h.lenbits)-1])>>>16&255,ye=65535&S,!((le=S>>>24)<=x);){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(de&&!(240&de)){for(fe=le,Pe=de,Re=ye;de=(S=h.lencode[Re+((D&(1<<fe+Pe)-1)>>fe)])>>>16&255,ye=65535&S,!(fe+(le=S>>>24)<=x);){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}D>>>=fe,x-=fe,h.back+=fe}if(D>>>=le,x-=le,h.back+=le,h.length=ye,de===0){h.mode=26;break}if(32&de){h.back=-1,h.mode=12;break}if(64&de){k.msg="invalid literal/length code",h.mode=30;break}h.extra=15&de,h.mode=22;case 22:if(h.extra){for(E=h.extra;x<E;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}h.length+=D&(1<<h.extra)-1,D>>>=h.extra,x-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;de=(S=h.distcode[D&(1<<h.distbits)-1])>>>16&255,ye=65535&S,!((le=S>>>24)<=x);){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(!(240&de)){for(fe=le,Pe=de,Re=ye;de=(S=h.distcode[Re+((D&(1<<fe+Pe)-1)>>fe)])>>>16&255,ye=65535&S,!(fe+(le=S>>>24)<=x);){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}D>>>=fe,x-=fe,h.back+=fe}if(D>>>=le,x-=le,h.back+=le,64&de){k.msg="invalid distance code",h.mode=30;break}h.offset=ye,h.extra=15&de,h.mode=24;case 24:if(h.extra){for(E=h.extra;x<E;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}h.offset+=D&(1<<h.extra)-1,D>>>=h.extra,x-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){k.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(ie===0)break e;if(K=X-ie,h.offset>K){if((K=h.offset-K)>h.whave&&h.sane){k.msg="invalid distance too far back",h.mode=30;break}pe=K>h.wnext?(K-=h.wnext,h.wsize-K):h.wnext-K,K>h.length&&(K=h.length),Se=h.window}else Se=se,pe=ae-h.offset,K=h.length;for(ie<K&&(K=ie),ie-=K,h.length-=K;se[ae++]=Se[pe++],--K;);h.length===0&&(h.mode=21);break;case 26:if(ie===0)break e;se[ae++]=h.length,ie--,h.mode=21;break;case 27:if(h.wrap){for(;x<32;){if(Z===0)break e;Z--,D|=M[W++]<<x,x+=8}if(X-=ie,k.total_out+=X,h.total+=X,X&&(k.adler=h.check=h.flags?t(h.check,se,X,ae-X):s(h.check,se,X,ae-X)),X=ie,(h.flags?D:v(D))!==h.check){k.msg="incorrect data check",h.mode=30;break}x=D=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;x<32;){if(Z===0)break e;Z--,D+=M[W++]<<x,x+=8}if(D!==(4294967295&h.total)){k.msg="incorrect length check",h.mode=30;break}x=D=0}h.mode=29;case 29:N=1;break e;case 30:N=-3;break e;case 31:return-4;case 32:default:return d}return k.next_out=ae,k.avail_out=ie,k.next_in=W,k.avail_in=Z,h.hold=D,h.bits=x,(h.wsize||X!==k.avail_out&&h.mode<30&&(h.mode<27||j!==4))&&q(k,k.output,k.next_out,X-k.avail_out)?(h.mode=31,-4):(re-=k.avail_in,X-=k.avail_out,k.total_in+=re,k.total_out+=X,h.total+=X,h.wrap&&X&&(k.adler=h.check=h.flags?t(h.check,se,X,k.next_out-X):s(h.check,se,X,k.next_out-X)),k.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(re==0&&X===0||j===4)&&N===f&&(N=-5),N)},o.inflateEnd=function(k){if(!k||!k.state)return d;var j=k.state;return j.window&&(j.window=null),k.state=null,f},o.inflateGetHeader=function(k,j){var h;return k&&k.state&&2&(h=k.state).wrap?((h.head=j).done=!1,f):d},o.inflateSetDictionary=function(k,j){var h,M=j.length;return k&&k.state?(h=k.state).wrap!==0&&h.mode!==11?d:h.mode===11&&s(1,j,M,0)!==h.check?-3:q(k,j,M,M)?(h.mode=31,-4):(h.havedict=1,f):d},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,l,o){var n=r("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],t=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(g,u,f,d,_,m,y,v){var w,R,A,T,F,I,B,z,V,q=v.bits,k=0,j=0,h=0,M=0,se=0,W=0,ae=0,Z=0,ie=0,D=0,x=null,re=0,X=new n.Buf16(16),K=new n.Buf16(16),pe=null,Se=0;for(k=0;k<=15;k++)X[k]=0;for(j=0;j<d;j++)X[u[f+j]]++;for(se=q,M=15;1<=M&&X[M]===0;M--);if(M<se&&(se=M),M===0)return _[m++]=20971520,_[m++]=20971520,v.bits=1,0;for(h=1;h<M&&X[h]===0;h++);for(se<h&&(se=h),k=Z=1;k<=15;k++)if(Z<<=1,(Z-=X[k])<0)return-1;if(0<Z&&(g===0||M!==1))return-1;for(K[1]=0,k=1;k<15;k++)K[k+1]=K[k]+X[k];for(j=0;j<d;j++)u[f+j]!==0&&(y[K[u[f+j]]++]=j);if(I=g===0?(x=pe=y,19):g===1?(x=s,re-=257,pe=t,Se-=257,256):(x=i,pe=c,-1),k=h,F=m,ae=j=D=0,A=-1,T=(ie=1<<(W=se))-1,g===1&&852<ie||g===2&&592<ie)return 1;for(;;){for(B=k-ae,V=y[j]<I?(z=0,y[j]):y[j]>I?(z=pe[Se+y[j]],x[re+y[j]]):(z=96,0),w=1<<k-ae,h=R=1<<W;_[F+(D>>ae)+(R-=w)]=B<<24|z<<16|V|0,R!==0;);for(w=1<<k-1;D&w;)w>>=1;if(w!==0?(D&=w-1,D+=w):D=0,j++,--X[k]==0){if(k===M)break;k=u[f+y[j]]}if(se<k&&(D&T)!==A){for(ae===0&&(ae=se),F+=h,Z=1<<(W=k-ae);W+ae<M&&!((Z-=X[W+ae])<=0);)W++,Z<<=1;if(ie+=1<<W,g===1&&852<ie||g===2&&592<ie)return 1;_[A=D&T]=se<<24|W<<16|F-m|0}}return D!==0&&(_[F+D]=k-ae<<24|64<<16|0),v.bits=se,0}},{"../utils/common":41}],51:[function(r,l,o){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,l,o){var n=r("../utils/common"),s=0,t=1;function i(S){for(var P=S.length;0<=--P;)S[P]=0}var c=0,g=29,u=256,f=u+1+g,d=30,_=19,m=2*f+1,y=15,v=16,w=7,R=256,A=16,T=17,F=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(f+2));i(q);var k=new Array(2*d);i(k);var j=new Array(512);i(j);var h=new Array(256);i(h);var M=new Array(g);i(M);var se,W,ae,Z=new Array(d);function ie(S,P,H,U,C){this.static_tree=S,this.extra_bits=P,this.extra_base=H,this.elems=U,this.max_length=C,this.has_stree=S&&S.length}function D(S,P){this.dyn_tree=S,this.max_code=0,this.stat_desc=P}function x(S){return S<256?j[S]:j[256+(S>>>7)]}function re(S,P){S.pending_buf[S.pending++]=255&P,S.pending_buf[S.pending++]=P>>>8&255}function X(S,P,H){S.bi_valid>v-H?(S.bi_buf|=P<<S.bi_valid&65535,re(S,S.bi_buf),S.bi_buf=P>>v-S.bi_valid,S.bi_valid+=H-v):(S.bi_buf|=P<<S.bi_valid&65535,S.bi_valid+=H)}function K(S,P,H){X(S,H[2*P],H[2*P+1])}function pe(S,P){for(var H=0;H|=1&S,S>>>=1,H<<=1,0<--P;);return H>>>1}function Se(S,P,H){var U,C,G=new Array(y+1),Q=0;for(U=1;U<=y;U++)G[U]=Q=Q+H[U-1]<<1;for(C=0;C<=P;C++){var Y=S[2*C+1];Y!==0&&(S[2*C]=pe(G[Y]++,Y))}}function le(S){var P;for(P=0;P<f;P++)S.dyn_ltree[2*P]=0;for(P=0;P<d;P++)S.dyn_dtree[2*P]=0;for(P=0;P<_;P++)S.bl_tree[2*P]=0;S.dyn_ltree[2*R]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function de(S){8<S.bi_valid?re(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ye(S,P,H,U){var C=2*P,G=2*H;return S[C]<S[G]||S[C]===S[G]&&U[P]<=U[H]}function fe(S,P,H){for(var U=S.heap[H],C=H<<1;C<=S.heap_len&&(C<S.heap_len&&ye(P,S.heap[C+1],S.heap[C],S.depth)&&C++,!ye(P,U,S.heap[C],S.depth));)S.heap[H]=S.heap[C],H=C,C<<=1;S.heap[H]=U}function Pe(S,P,H){var U,C,G,Q,Y=0;if(S.last_lit!==0)for(;U=S.pending_buf[S.d_buf+2*Y]<<8|S.pending_buf[S.d_buf+2*Y+1],C=S.pending_buf[S.l_buf+Y],Y++,U===0?K(S,C,P):(K(S,(G=h[C])+u+1,P),(Q=I[G])!==0&&X(S,C-=M[G],Q),K(S,G=x(--U),H),(Q=B[G])!==0&&X(S,U-=Z[G],Q)),Y<S.last_lit;);K(S,R,P)}function Re(S,P){var H,U,C,G=P.dyn_tree,Q=P.stat_desc.static_tree,Y=P.stat_desc.has_stree,ne=P.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=m,H=0;H<ne;H++)G[2*H]!==0?(S.heap[++S.heap_len]=he=H,S.depth[H]=0):G[2*H+1]=0;for(;S.heap_len<2;)G[2*(C=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[C]=0,S.opt_len--,Y&&(S.static_len-=Q[2*C+1]);for(P.max_code=he,H=S.heap_len>>1;1<=H;H--)fe(S,G,H);for(C=ne;H=S.heap[1],S.heap[1]=S.heap[S.heap_len--],fe(S,G,1),U=S.heap[1],S.heap[--S.heap_max]=H,S.heap[--S.heap_max]=U,G[2*C]=G[2*H]+G[2*U],S.depth[C]=(S.depth[H]>=S.depth[U]?S.depth[H]:S.depth[U])+1,G[2*H+1]=G[2*U+1]=C,S.heap[1]=C++,fe(S,G,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ce,ke){var tt,Ce,nt,_e,ct,bt,ze=ke.dyn_tree,Yt=ke.max_code,jn=ke.stat_desc.static_tree,Fn=ke.stat_desc.has_stree,Bn=ke.stat_desc.extra_bits,qt=ke.stat_desc.extra_base,rt=ke.stat_desc.max_length,dt=0;for(_e=0;_e<=y;_e++)ce.bl_count[_e]=0;for(ze[2*ce.heap[ce.heap_max]+1]=0,tt=ce.heap_max+1;tt<m;tt++)rt<(_e=ze[2*ze[2*(Ce=ce.heap[tt])+1]+1]+1)&&(_e=rt,dt++),ze[2*Ce+1]=_e,Yt<Ce||(ce.bl_count[_e]++,ct=0,qt<=Ce&&(ct=Bn[Ce-qt]),bt=ze[2*Ce],ce.opt_len+=bt*(_e+ct),Fn&&(ce.static_len+=bt*(jn[2*Ce+1]+ct)));if(dt!==0){do{for(_e=rt-1;ce.bl_count[_e]===0;)_e--;ce.bl_count[_e]--,ce.bl_count[_e+1]+=2,ce.bl_count[rt]--,dt-=2}while(0<dt);for(_e=rt;_e!==0;_e--)for(Ce=ce.bl_count[_e];Ce!==0;)Yt<(nt=ce.heap[--tt])||(ze[2*nt+1]!==_e&&(ce.opt_len+=(_e-ze[2*nt+1])*ze[2*nt],ze[2*nt+1]=_e),Ce--)}}(S,P),Se(G,he,S.bl_count)}function a(S,P,H){var U,C,G=-1,Q=P[1],Y=0,ne=7,he=4;for(Q===0&&(ne=138,he=3),P[2*(H+1)+1]=65535,U=0;U<=H;U++)C=Q,Q=P[2*(U+1)+1],++Y<ne&&C===Q||(Y<he?S.bl_tree[2*C]+=Y:C!==0?(C!==G&&S.bl_tree[2*C]++,S.bl_tree[2*A]++):Y<=10?S.bl_tree[2*T]++:S.bl_tree[2*F]++,G=C,he=(Y=0)===Q?(ne=138,3):C===Q?(ne=6,3):(ne=7,4))}function N(S,P,H){var U,C,G=-1,Q=P[1],Y=0,ne=7,he=4;for(Q===0&&(ne=138,he=3),U=0;U<=H;U++)if(C=Q,Q=P[2*(U+1)+1],!(++Y<ne&&C===Q)){if(Y<he)for(;K(S,C,S.bl_tree),--Y!=0;);else C!==0?(C!==G&&(K(S,C,S.bl_tree),Y--),K(S,A,S.bl_tree),X(S,Y-3,2)):Y<=10?(K(S,T,S.bl_tree),X(S,Y-3,3)):(K(S,F,S.bl_tree),X(S,Y-11,7));G=C,he=(Y=0)===Q?(ne=138,3):C===Q?(ne=6,3):(ne=7,4)}}i(Z);var L=!1;function E(S,P,H,U){X(S,(c<<1)+(U?1:0),3),function(C,G,Q,Y){de(C),Y&&(re(C,Q),re(C,~Q)),n.arraySet(C.pending_buf,C.window,G,Q,C.pending),C.pending+=Q}(S,P,H,!0)}o._tr_init=function(S){L||(function(){var P,H,U,C,G,Q=new Array(y+1);for(C=U=0;C<g-1;C++)for(M[C]=U,P=0;P<1<<I[C];P++)h[U++]=C;for(h[U-1]=C,C=G=0;C<16;C++)for(Z[C]=G,P=0;P<1<<B[C];P++)j[G++]=C;for(G>>=7;C<d;C++)for(Z[C]=G<<7,P=0;P<1<<B[C]-7;P++)j[256+G++]=C;for(H=0;H<=y;H++)Q[H]=0;for(P=0;P<=143;)q[2*P+1]=8,P++,Q[8]++;for(;P<=255;)q[2*P+1]=9,P++,Q[9]++;for(;P<=279;)q[2*P+1]=7,P++,Q[7]++;for(;P<=287;)q[2*P+1]=8,P++,Q[8]++;for(Se(q,f+1,Q),P=0;P<d;P++)k[2*P+1]=5,k[2*P]=pe(P,5);se=new ie(q,I,u+1,f,y),W=new ie(k,B,0,d,y),ae=new ie(new Array(0),z,0,_,w)}(),L=!0),S.l_desc=new D(S.dyn_ltree,se),S.d_desc=new D(S.dyn_dtree,W),S.bl_desc=new D(S.bl_tree,ae),S.bi_buf=0,S.bi_valid=0,le(S)},o._tr_stored_block=E,o._tr_flush_block=function(S,P,H,U){var C,G,Q=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(Y){var ne,he=4093624447;for(ne=0;ne<=31;ne++,he>>>=1)if(1&he&&Y.dyn_ltree[2*ne]!==0)return s;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return t;for(ne=32;ne<u;ne++)if(Y.dyn_ltree[2*ne]!==0)return t;return s}(S)),Re(S,S.l_desc),Re(S,S.d_desc),Q=function(Y){var ne;for(a(Y,Y.dyn_ltree,Y.l_desc.max_code),a(Y,Y.dyn_dtree,Y.d_desc.max_code),Re(Y,Y.bl_desc),ne=_-1;3<=ne&&Y.bl_tree[2*V[ne]+1]===0;ne--);return Y.opt_len+=3*(ne+1)+5+5+4,ne}(S),C=S.opt_len+3+7>>>3,(G=S.static_len+3+7>>>3)<=C&&(C=G)):C=G=H+5,H+4<=C&&P!==-1?E(S,P,H,U):S.strategy===4||G===C?(X(S,2+(U?1:0),3),Pe(S,q,k)):(X(S,4+(U?1:0),3),function(Y,ne,he,ce){var ke;for(X(Y,ne-257,5),X(Y,he-1,5),X(Y,ce-4,4),ke=0;ke<ce;ke++)X(Y,Y.bl_tree[2*V[ke]+1],3);N(Y,Y.dyn_ltree,ne-1),N(Y,Y.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,Q+1),Pe(S,S.dyn_ltree,S.dyn_dtree)),le(S),U&&de(S)},o._tr_tally=function(S,P,H){return S.pending_buf[S.d_buf+2*S.last_lit]=P>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&P,S.pending_buf[S.l_buf+S.last_lit]=255&H,S.last_lit++,P===0?S.dyn_ltree[2*H]++:(S.matches++,P--,S.dyn_ltree[2*(h[H]+u+1)]++,S.dyn_dtree[2*x(P)]++),S.last_lit===S.lit_bufsize-1},o._tr_align=function(S){X(S,2,3),K(S,R,q),function(P){P.bi_valid===16?(re(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):8<=P.bi_valid&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(r,l,o){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,l,o){(function(n){(function(s,t){if(!s.setImmediate){var i,c,g,u,f=1,d={},_=!1,m=s.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(s);y=y&&y.setTimeout?y:s,i={}.toString.call(s.process)==="[object process]"?function(A){process.nextTick(function(){w(A)})}:function(){if(s.postMessage&&!s.importScripts){var A=!0,T=s.onmessage;return s.onmessage=function(){A=!1},s.postMessage("","*"),s.onmessage=T,A}}()?(u="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",R,!1):s.attachEvent("onmessage",R),function(A){s.postMessage(u+A,"*")}):s.MessageChannel?((g=new MessageChannel).port1.onmessage=function(A){w(A.data)},function(A){g.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(A){var T=m.createElement("script");T.onreadystatechange=function(){w(A),T.onreadystatechange=null,c.removeChild(T),T=null},c.appendChild(T)}):function(A){setTimeout(w,0,A)},y.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var T=new Array(arguments.length-1),F=0;F<T.length;F++)T[F]=arguments[F+1];var I={callback:A,args:T};return d[f]=I,i(f),f++},y.clearImmediate=v}function v(A){delete d[A]}function w(A){if(_)setTimeout(w,0,A);else{var T=d[A];if(T){_=!0;try{(function(F){var I=F.callback,B=F.args;switch(B.length){case 0:I();break;case 1:I(B[0]);break;case 2:I(B[0],B[1]);break;case 3:I(B[0],B[1],B[2]);break;default:I.apply(t,B)}})(T)}finally{v(A),_=!1}}}}function R(A){A.source===s&&typeof A.data=="string"&&A.data.indexOf(u)===0&&w(+A.data.slice(u.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof ut<"u"?ut:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(si);const ii=Lt,ai=async(e,p,r,l,o)=>{var i,c,g;const n=document.querySelector(`svg#${e}`);if(!n)throw new Error("Requested canvas SVG element not found");const s=Number((i=n.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:i[0]),t=n.cloneNode(!0);if(t.setAttribute("height",(s*(o||100)/100).toString()),t.style.setProperty("all","initial"),["share"].map(u=>{var f;return[...((f=[...document.querySelectorAll("link")].filter(d=>d.id==="css_"+u)[0])==null?void 0:f.sheet).cssRules].map(d=>d.cssText).join(" ")}).forEach(u=>{const f=document.createElement("style");f.textContent=u,t.prepend(f)}),(c=t.querySelector("rect#canvas-border"))==null||c.setAttribute("stroke",l?"black":"none"),(g=t.querySelector("rect#canvas-bg"))==null||g.setAttribute("fill",r?"none":"white"),p===ee.MTR)try{const u=await ci(t),f=document.createElement("style");f.textContent=u.join(`
`),t.prepend(f)}catch(u){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(u)}return t},oi=e=>new Promise(p=>{const r=new FileReader;r.onloadend=()=>p(r.result),r.readAsDataURL(e)}),li=(e,p)=>e.find(r=>{const l=r.style;return l.fontFamily.replace(/^"(.+)"$/,"$1")===p.family&&l.unicodeRange===p.unicodeRange}),ci=async e=>{var n,s,t;const p=Array.from(new Set([...e.querySelectorAll(".rmg-name__zh"),...e.querySelectorAll(".rmg-name__en")].map(i=>i.innerHTML).join("").replace(/\s/g,""))).join(""),r=await document.fonts.load("80px GenYoMin TW, Vegur",p),l=Array.from(((t=(s=(n=document.querySelector("link#css_share"))==null?void 0:n.sheet)==null?void 0:s.cssRules)==null?void 0:t[0]).styleSheet.cssRules),o=r.reduce((i,c)=>{const g=li(l,c);return g?i.find(f=>{const d=f.style,_=g.style;return d.fontFamily===_.fontFamily&&d.unicodeRange===_.unicodeRange})?i:i.concat(g):i},[]);return await Promise.all(o.map(async i=>{try{const c=await fetch(di(i)),g=await oi(await c.blob());return i.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${g}'); `)}catch(c){return console.error(c),""}}))},di=e=>{var r;const p=e.style.src;return Pn()?p.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmg/styles/"+((r=p.match(/^url\("([\S*]+)"\)/))==null?void 0:r[1])},ui=async(e,p,r)=>{const l=e.viewBox.baseVal.width,o=e.viewBox.baseVal.height,n=document.querySelectorAll("canvas")[0];n.width=Number(l)*window.devicePixelRatio*p,n.height=Number(o)*window.devicePixelRatio*p,e.setAttribute("width",n.width.toString()),e.setAttribute("height",n.height.toString());const s=n.getContext("2d");return s.clearRect(0,0,n.width,n.height),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach(t=>t.setAttribute("font-size","11px")),e.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(t=>t.setAttribute("font-size","8.5px")),e.querySelectorAll("text, tspan").forEach(t=>{const i=window.getComputedStyle(t);t.setAttribute("font-family",i.fontFamily),t.setAttribute("fill",i.fill),t.setAttribute("dominant-baseline",i.dominantBaseline),t.setAttribute("text-anchor",i.textAnchor||"")}),new Promise((t,i)=>{const c=new Image;c.onload=()=>{setTimeout(()=>{s.drawImage(c,0,0,n.width,n.height),n.toBlob(g=>{g?t(g):i("Canvas blob is null")},"image/png")},r?2e3:0)},c.onerror=i,c.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.outerHTML)))})},hi=e=>{var p,r,l,o,n,s,t;"line_name"in e||(e.line_name=["è·¯ç·šå","Name of Line"]),"dest_legacy"in e||(e.dest_legacy=!1),delete e.fontZH,delete e.fontEN,delete e.weightZH,delete e.weightEN;for(const[i,c]of Object.entries(e.stn_list))"branch"in c||(e.stn_list[i].branch={left:[],right:[]},c.children.length===2?e.stn_list[i].branch.right=["through",c.children[1]]:e.stn_list[i].branch.right=[],c.parents.length===2?e.stn_list[i].branch.left=["through",c.parents[1]]:e.stn_list[i].branch.left=[]);"psd_num"in e?e.psd_num=e.psd_num.toString():e.psd_num="1","line_num"in e||(e.line_num="1"),e.theme.length===3&&e.theme.push("#fff");for(const[i,c]of Object.entries(e.stn_list))"num"in c||(e.stn_list[i].num="00"),"interchange"in c&&c.interchange.map(g=>g.forEach(u=>{u.length===5&&u.splice(3,0,"#fff")}));for(const[i,c]of Object.entries(e.stn_list))c.change_type==="osi22_end_p"&&(e.stn_list[i].change_type="osi22_pr"),c.change_type==="osi22_end_u"&&(e.stn_list[i].change_type="osi22_ur");for(const[i,c]of Object.entries(e.stn_list))"interchange"in c||(e.stn_list[i].interchange=[[]]);"info_panel_type"in e?e.info_panel_type=(i=>{switch(i){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return i}})(e.info_panel_type):e.info_panel_type="gz28","direction_gz_x"in e||(e.direction_gz_x=50),"direction_gz_y"in e||(e.direction_gz_y=70);for(const[i,c]of Object.entries(e.stn_list))"transfer"in c||(e.stn_list[i].transfer={tick_direc:c.change_type==="none"||c.change_type==="int2"?"r":(p=c.change_type)==null?void 0:p.split("_")[1].split("").slice().reverse()[0],paid_area:((r=c.change_type)==null?void 0:r.indexOf("osi"))!==-1?((l=c.change_type)==null?void 0:l.split("_")[1][0])==="p":!0,osi_names:((o=c.change_type)==null?void 0:o.indexOf("osi"))!==-1?[c.interchange[1][0]]:[],info:c.interchange.length===2?[c.interchange[0],c.interchange[1].slice(1)]:c.interchange}),delete e.stn_list[i].change_type,delete e.stn_list[i].interchange;for(const[i,c]of Object.entries(e.stn_list))"services"in c||(e.stn_list[i].services=["local"]),"facility"in c||("usage"in c?e.stn_list[i].facility=c.usage:e.stn_list[i].facility=""),delete e.stn_list[i].usage;"customiseMTRDest"in e||(e.customiseMTRDest={isLegacy:e.dest_legacy||!1,terminal:!1}),delete e.dest_legacy,"svgWidth"in e||(e.svgWidth={destination:e.svg_dest_width,runin:e.svg_dest_width,railmap:e.svg_width,indoor:e.svg_width}),"indoor"in e.svgWidth||(e.svgWidth.indoor=e.svgWidth.railmap),delete e.svg_width,delete e.svg_dest_width,"notesGZMTR"in e||(e.notesGZMTR=[]),e.notesGZMTR=(n=e.notesGZMTR)==null?void 0:n.map(i=>i.length===4?i.concat([!1]):i),delete e.char_form,delete e.show_outer,delete e.strip_pc,delete e.txt_bg_gap,"namePosMTR"in e||(e.namePosMTR={isStagger:!0,isFlip:e.txt_flip}),delete e.txt_flip,Object.keys(e.stn_list).forEach(i=>{"secondaryName"in e.stn_list[i]?e.stn_list[i].secondaryName!==!1&&e.stn_list[i].secondaryName.join()===","&&(e.stn_list[i].secondaryName=!1):e.stn_list[i].secondaryName=!1,"type"in e.stn_list[i].transfer&&delete e.stn_list[i].transfer.type}),e.style=e.style===void 0||!Object.values(ee).includes(e.style)?ee.MTR:e.style,e.coline=(s=e.coline)!=null?s:[],e.loop=(t=e.loop)!=null?t:!1,e.loop_info=e.loop_info===void 0?{bank:!0,left_and_right_factor:0,bottom_factor:1}:{...e.loop_info,bottom_factor:Math.max(e.loop_info.bottom_factor,1)};for(const[i,c]of Object.entries(e.stn_list))"loop_pivot"in c||(e.stn_list[i].loop_pivot=!1);return Array.isArray(e.coline)&&(e.coline=e.coline.reduce((i,c)=>({...i,[Ke(4)]:c}),{})),e.platform_num===!1&&(e.platform_num=""),Object.values(e.stn_list).forEach(i=>{var g,u;const c=i;c.one_line=(g=c.one_line)!=null?g:!1,c.int_padding=(u=c.int_padding)!=null?u:e.loop?250:355}),e.branchSpacingPct===void 0&&(e.style===ee.SHMetro?e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*300):e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*200),delete e.branch_spacing),e},mi=e=>new Promise(p=>{setTimeout(p,e)});function pi(e){const{isOpen:p,onClose:r}=e,{t:l}=oe(),o=ve(),[n,s]=J.useState(""),[t,i]=J.useState(!1),[c,g]=J.useState(!1),[u,f]=J.useState(100),[d,_]=J.useState("png"),m=te(z=>z.app.canvasToShow),{style:y,stn_list:v,current_stn_idx:w,line_name:R}=te(z=>z.param);J.useEffect(()=>{n!==""&&!m.includes(n)&&s("")},[m]);const A=Ut[y].reduce((z,V)=>m.includes(V)?{...z,[V]:l("CanvasType."+V)}:{...z},{"":l("DownloadModal.pleaseSelect")}),T=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((z,V)=>({...z,[V]:`${V}%`}),{}),F={png:l("DownloadModal.png"),svg:l("DownloadModal.svg")},I=[{type:"select",label:l("DownloadModal.canvas"),value:n,options:A,disabledOptions:[""],onChange:z=>s(z),minW:"full"},{type:"switch",label:l("DownloadModal.transparent"),isChecked:t,onChange:i,oneLine:!0,minW:"full"},{type:"switch",label:l("DownloadModal.showBorder"),isChecked:c,onChange:g,oneLine:!0,minW:"full"},{type:"select",label:l("DownloadModal.scale"),value:u,options:T,onChange:z=>f(z)},{type:"select",label:l("DownloadModal.format"),value:d,options:F,onChange:z=>_(z)}],B=async z=>{o(an(0));const V=z==="current"?[w]:Object.keys(v).filter(k=>!["linestart","lineend"].includes(k)),q=new ii;for(const k in V){o(an((Number(k)+1)/V.length*100));const j=V[k];o(xt(j)),await mi(500);const h=await ai(n,y,t,c,u);document.body.appendChild(h);const M=`rmg.${j}.${v[j].name[0]}.${v[j].name[1]}`.replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(d==="png"){const se=Pn()&&k==="0",W=await ui(h,u/100,se);V.length>1?q.file(`${M}.png`,W):Dt(`${M}.png`,W)}else if(d==="svg"){h.removeAttribute("height");const se="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h.outerHTML)));V.length>1?q.file(`${M}.svg`,se.split("base64,")[1],{base64:!0}):Tn(M+".svg","image/svg+xml",h.outerHTML)}document.body.removeChild(h)}if(V.length>1){const k=await q.generateAsync({type:"blob"}),j=`rmg.${R[0]}.${R[1]}.zip`.replaceAll(" ","_");Dt(j,k)}me.event(be.DOWNLOAD_IMAGES,{canvasToDownload:n,style:y,option:z,format:d}),o(xt(w)),o(Sn()),r()};return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[b(Ne,{children:l("DownloadModal.title")}),b(Ve,{}),b(He,{children:b(ge,{fields:I})}),b(Ye,{children:$(Le,{children:[b(ue,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>B("current"),isDisabled:!n,children:l("DownloadModal.downloadOne")}),y!==ee.GZMTR&&b(ue,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>B("all"),isDisabled:!n,children:l("DownloadModal.downloadAll")})]})})]})]})}function fi(){const{t:e}=oe(),[p,r]=J.useState(!1),{paramConfig:l}=te(s=>s.app),o=te(s=>s.param),n=()=>{Tn(`RMG_${l==null?void 0:l.id}.json`,"application/json",JSON.stringify(o)),me.event(be.DOWNLOAD_PARAM,{style:o.style})};return $(er,{children:[b(tr,{as:ue,variant:"ghost",size:"sm",rightIcon:b(nr,{}),children:e("DownloadActions.downloads")}),$(rr,{children:[b(Qt,{onClick:n,children:e("DownloadActions.configFile")}),b(Qt,{onClick:()=>r(!0),children:e("DownloadActions.images")})]}),b(pi,{isOpen:p,onClose:()=>r(!1)})]})}function yt(){const[e,p]=sr();return[e,l=>{if(p(l),Object.keys(l)){const o=new URLSearchParams(l);me.updateUrl("/rmg/?"+o)}else me.updateUrl("/rmg/")}]}function _i(){const{t:e}=oe(),p=Nt(),[,r]=yt();return $(Le,{ml:"auto",w:"fit-content",children:[b(ue,{variant:"ghost",size:"sm",leftIcon:b(ir,{}),onClick:()=>{p(Qe($e.CLOSE)),p(wn(void 0)),r({})},children:e("All projects")}),b(fi,{}),b(ue,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:b(ar,{}),onClick:()=>p(Qe($e.STYLE)),children:e("HeaderActions.editStyle")})]})}function gi(){const{t:e}=oe(),p=ve(),{canvasToShow:r,canvasScale:l}=te(c=>c.app),o=te(c=>c.param.style),n=Object.values(ee).reduce((c,g)=>({...c,[g]:e("RmgStyle."+g)}),{}),s=Ut[o].map(c=>({label:e("CanvasType."+c),value:c})),t=c=>{p(as(c))},i=[{type:"select",label:e("Style"),value:o,options:n,onChange:c=>t(c)},{type:"custom",label:e("View"),component:b(or,{displayValue:e("Select canvas"),selections:s,defaultValue:r,onChange:c=>p(ss(c))})},{type:"slider",label:e("Canvas scale"),value:l,min:.1,max:2,step:.01,onChange:c=>p(is(c)),leftIcon:b(lr,{}),rightIcon:b(cr,{})}];return $(dr,{children:[b(ge,{fields:i,minW:160}),b(_i,{})]})}const vi=e=>{switch(e){case ee.MTR:return[Ie.Hongkong,"twl","#E2231A",Ae.white];case ee.GZMTR:return[Ie.Guangzhou,"gz1","#F3D03E",Ae.black];case ee.SHMetro:return[Ie.Shanghai,"sh1","#E4002B",Ae.white];default:return[Ie.Other,"other","#AAAAAA",Ae.white]}},yi=e=>{switch(e){case mt.ChineseSimp:return["1å·çº¿","Line 1"];case mt.ChineseTrad:return["èƒç£ç¶«","Tsuen Wan Line"];default:return["åœ°éµç·š","Metro Line"]}},st=e=>({name:["æœªå‘½å "+e,"Unnamed "+e],secondaryName:!1,num:"00",services:[zt.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{info:[[]],tick_direc:Je.right,paid_area:!0,osi_names:[]},facility:xe.none,loop_pivot:!1,one_line:!0,int_padding:355}),bi=(e,p)=>{const r=st("linestart");r.name=["LEFT END","LEFT END"];const l=st("lineend");l.name=["RIGHT END","RIGHT END"];const o=Ke(6),n=st(o);n.num="01";const s=Ke(6),t=st(s);return t.num="02",r.children=[o],n.parents=["linestart"],n.children=[s],t.parents=[o],t.children=["lineend"],l.parents=[s],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:e,y_pc:50,padding:10,branchSpacingPct:33,direction:Je.left,platform_num:"1",theme:vi(e),line_name:yi(p),current_stn_idx:s,stn_list:{linestart:r,[o]:n,[s]:t,lineend:l},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:e===ee.SHMetro?yn.sh:vn.gz1,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}},at=(e,p,r,l)=>(o,n)=>{const s=n().param.stn_list;let t=Ke(6);for(;t in s;)t=Ke(6);const i=st(t);if(e!=="new"){const c={...s,[p]:{...s[p],children:s[p].children.map(g=>g===r?t:g),branch:{left:s[p].branch.left,right:s[p].branch.right.length&&s[p].branch.right[1]===r?[s[p].branch.right[0],t]:s[p].branch.right}},[r]:{...s[r],parents:s[r].parents.map(g=>g===p?t:g),branch:{left:s[r].branch.left.length&&s[r].branch.left[1]===p?[s[r].branch.left[0],t]:s[r].branch.left,right:s[r].branch.right}},[t]:{...i,parents:[p],children:[r]}};return o(Ge(c)),t}else{if(!l)return!1;const c={...s,[p]:{...s[p],children:l==="upper"?[t,s[p].children[0]]:[s[p].children[0],t],branch:{left:s[p].branch.left,right:[ft.through,t]}},[r]:{...s[r],parents:l==="upper"?[t,s[r].parents[0]]:[s[r].parents[0],t],branch:{left:[ft.through,t],right:s[r].branch.right}},[t]:{...i,parents:[p],children:[r]}};return o(Ge(c)),t}},Si=(e,p,r)=>(l,o)=>{const s=o().helper.branches[e];if(s!=null&&s.length)if(p==="before"){const t=s[s.indexOf(r)-1];return l(at(e.toString(),t,r))}else{const t=s[s.indexOf(r)+1];return l(at(e.toString(),r,t))}else return!1},wi=()=>(e,p)=>{const r=p().param.stn_list;return p().helper.branches[0].filter(o=>{const n=r[o].parents.length+r[o].children.length===4,s=Gt(o,r)===0;return!n&&s})},ln=(e,p)=>(r,l)=>{const o=l().param.stn_list,n=l().helper.branches;return!n[0].includes(e)||!n[0].includes(p)?"Branch should end at main line":n[0].indexOf(e)>=n[0].indexOf(p)?"Not in correct ordering":e==="linestart"&&p==="lineend"?"Should not be parallel to main line":e==="linestart"&&n[0].indexOf(p)===1?"Branch should not be open jaw from the first station":p==="lineend"&&n[0].indexOf(e)===n[0].length-2?"Branch should not be open jaw from the last station":o[e].children.length>1||o[p].parents.length>1?"Branch already exist":n.slice(1).some(i=>i.slice(1,-1).includes(e)||i.slice(1,-1).includes(p))?"Cannot branch out from existing branch":n[0].slice(n[0].indexOf(e)+1,n[0].indexOf(p)).every(i=>o[i].parents.length===1&&o[i].children.length===1)?"":"One or more stations between both ends are branching out"};function Ei(e){var F,I;const{isOpen:p,onClose:r}=e,{t:l}=oe(),o=ve(),n=te(B=>B.app.selectedBranch),{style:s,stn_list:t}=te(B=>B.param),i=te(B=>B.helper.branches),[c,g]=J.useState(n),[u,f]=J.useState("before"),[d,_]=J.useState(""),[m,y]=J.useState(!1);J.useEffect(()=>{g(n)},[n]),J.useEffect(()=>{p||y(!1)},[p]);const v=(I=(F=i[Number(c)])==null?void 0:F.slice(1,-1))!=null?I:[],w=B=>B.reduce((z,V)=>{var q;return{...z,[V]:(q=t[V])==null?void 0:q.name.join(" - ")}},{"":l("AddStationModal.pleaseSelect")}),R=[{type:"select",label:l("AddStationModal.where"),value:c,options:{...i.reduce((B,z,V)=>({...B,[V]:V===0?l("AddStationModal.main"):s!==ee.SHMetro||!et(z,t)?l("AddStationModal.branch")+" "+V:l("AddStationModal.external")+" "+V}),{})},onChange:B=>A(B),minW:"full"},{type:"select",label:l("AddStationModal.preposition"),value:u,options:{before:l("AddStationModal.before"),after:l("AddStationModal.after")},onChange:B=>f(B)},{type:"select",label:l("AddStationModal.pivot"),value:d,options:w(v),disabledOptions:[""],onChange:B=>_(B)}],A=B=>{g(B),_("")},T=()=>{const B=o(Si(c,u,d));B?(r(),o(bn(B)),o(Qe($e.STATION))):(console.log("false here"),y(!0)),me.event(be.ADD_STATION,{style:s,branchIndex:c,success:B})};return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[m&&$(Vt,{status:"error",variant:"solid",size:"xs",children:[b(Ht,{}),l("AddStationModal.error")]}),$(Ee,{position:"relative",children:[b(Ne,{children:l("AddStationModal.title")}),b(Ve,{})]}),b(He,{children:b(ge,{fields:R})}),b(Ye,{children:b(ue,{colorScheme:"primary",onClick:T,isDisabled:!d,children:l("Confirm")})})]})]})}function Ai(e){const{isOpen:p,onClose:r}=e,{t:l}=oe(),o=ve(),[n,s]=J.useState("new"),[t,i]=J.useState(""),[c,g]=J.useState(""),[u,f]=J.useState("upper"),[d,_]=J.useState(""),[m,y]=J.useState(""),{style:v,stn_list:w}=te(q=>q.param);J.useEffect(()=>{p||(s("new"),i(""),g(""))},[p]);const A=(q=>q.reduce((k,j)=>{var h;return{...k,[j]:(h=w[j])==null?void 0:h.name.join(" - ")}},{"":l("NewBranchModal.pleaseSelect")}))(o(wi())),T=[{type:"select",label:l("NewBranchModal.where"),value:n,options:{new:l("NewBranchModal.new"),ext:l("NewBranchModal.ext")},disabledOptions:v===ee.SHMetro?[]:["ext"],onChange:q=>F(q),minW:"full"},{type:"select",label:l("NewBranchModal.from"),value:t,options:A,disabledOptions:[""],onChange:q=>I(q),isInvalid:Boolean(d)},{type:"select",label:l("NewBranchModal.to"),value:c,options:A,disabledOptions:[""],onChange:q=>B(q),isInvalid:Boolean(m)},{type:"select",label:l("NewBranchModal.position"),value:u,options:{upper:l("NewBranchModal.upper"),lower:l("NewBranchModal.lower")},onChange:q=>f(q),minW:"full",hidden:n!=="new"||v===ee.SHMetro}],F=q=>{s(q),i(""),g(""),_(""),y("")},I=q=>{i(q),_(""),q&&c&&y(o(ln(q,c)))},B=q=>{g(q),y(""),t&&q&&_(o(ln(t,q)))},z=()=>{let q;n==="ext"?q=o(at("new",t,c,"lower")):v===ee.SHMetro?q=o(at("new",t,c,"upper")):q=o(at("new",t,c,u)),q&&(r(),me.event(be.ADD_BRANCH,{style:v,where:n}))},V=Boolean(!t||!c||d||m);return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[b(Ne,{children:l("NewBranchModal.title")}),b(Ve,{}),b(He,{children:b(ge,{fields:T})}),b(Ye,{children:b(ue,{colorScheme:"primary",title:V?d||m:l("Confirm"),onClick:z,isDisabled:V,children:l("Confirm")})})]})]})}const ki=J.lazy(()=>O(()=>import("./station-ag-grid-9f8ff1fa.js"),["assets/station-ag-grid-9f8ff1fa.js","assets/vendor-40a796df.js","assets/index-4badbb40.js","assets/index-c7ec3755.css"]));function Oi(){const{t:e}=oe(),p=ve(),[r,l]=J.useState(!1),[o,n]=J.useState(!1),s=te(u=>u.app.selectedBranch),{style:t,stn_list:i}=te(u=>u.param),c=te(u=>u.helper.branches),g=()=>{p(Qe($e.BRANCH))};return $(Ee,{flex:1,overflow:"hidden",children:[$(jt,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:s,onChange:u=>p(os(u)),children:[$(Ft,{children:[c.map((u,f)=>f===0?b(qe,{children:e("GridTabs.main")},f):t!==ee.SHMetro||!et(u,i)?b(qe,{children:e("GridTabs.branch")+" "+f},f):b(qe,{children:e("GridTabs.external")+" "+f},f)),b(De,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>n(!0),icon:b(je,{})}),$(Le,{marginLeft:"auto",marginRight:1,children:[b(ue,{variant:"outline",size:"xs",leftIcon:b(je,{}),onClick:()=>l(!0),children:e("GridTabs.addStation")}),b(ue,{size:"xs",colorScheme:"primary",onClick:g,children:e("GridTabs.editLine")})]})]}),b(Bt,{flex:1,overflowY:"auto",children:c.map((u,f)=>b(pt,{padding:0,h:"100%",position:"relative",children:b(un,{suspenseFallback:b(_t,{isIndeterminate:!0}),children:b(ki,{branchIndex:f})})},f))})]}),b(Ei,{isOpen:r,onClose:()=>l(!1)}),b(Ai,{isOpen:o,onClose:()=>n(!1)})]})}function Ri(){const e=ve(),p=te(l=>l.app.globalAlerts),r=l=>{me.isStandaloneWindow()?window.open(`/${l}`,"_blank"):me.openApp(l)};return b(We,{children:Object.entries(p).map(([l,{message:o,url:n,linkedApp:s}])=>$(Vt,{status:l,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[b(Ht,{}),s?b(Ot,{onClick:()=>r(s),children:o}):n?b(Ot,{href:n,target:"_blank",children:o}):o,b(ur,{ml:"auto",onClick:()=>e(ls(l))})]},l))})}function Ti(){const e=te(p=>p.app.isLoading);return $(_n,{children:[e&&b(_t,{isIndeterminate:e<0,value:e>=0?e:void 0}),b(gi,{}),b(Ri,{}),$(Te,{flex:1,overflow:"hidden",position:"relative",children:[$(Te,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[b(Ee,{children:b(fs,{})}),b(Oi,{})]}),b(ti,{})]}),b("canvas",{style:{display:"none"}})]})}function Pi(e){var c;const{config:p,onClose:r,onUpdate:l}=e,{t:o}=oe(),[n,s]=J.useState((c=p==null?void 0:p.name)!=null?c:"");J.useEffect(()=>{var g;p&&s((g=p.name)!=null?g:"")},[p]);const t=[{type:"input",label:o("Project name"),value:n,onChange:s,debouncedDelay:0}],i=()=>{var g;p&&((g=p.name)!=null?g:"")!==n&&l({...p,name:n})};return $(Fe,{isOpen:!!p,onClose:r,isCentered:!0,children:[b(Be,{}),$(Me,{children:[b(Ne,{children:o("Edit project info")}),b(Ve,{}),b(He,{children:b(ge,{fields:t})}),b(Ye,{children:b(ue,{colorScheme:"primary",onClick:i,children:o("Confirm")})})]})]})}const Ci={flex:"2 1 0%",overflow:"hidden",minW:{base:"unset",md:240},w:{base:"100%",md:"unset"},mr:{base:0,md:2},mb:{base:2,md:0},"& > div":{flexDirection:"column",h:200,overflowX:"hidden",overflowY:"auto",borderRadius:"md",borderWidth:2,"& >.chakra-button":{alignItems:"center"},"& .chakra-button__group":{"& button:not(:first-of-type)":{h:"100%"}}}};function zi(e){const{paramRegistry:p,downloading:r,selectedParam:l,onParamSelect:o,onParamRemove:n,onParamUpdate:s}=e,{t}=oe(),[i,c]=J.useState(),g=u=>{s(u),c(void 0)};return $(Ee,{sx:Ci,children:[$(Te,{children:[r&&b(Ct,{variant:"ghost",primaryText:t("Downloading")+"...",secondaryText:r,isDisabled:!0}),p.slice().sort((u,f)=>{var d,_;return((d=f.lastModified)!=null?d:0)-((_=u.lastModified)!=null?_:0)}).map(u=>{var f;return $(hr,{size:"sm",isAttached:!0,colorScheme:l===u.id?"primary":void 0,variant:l===u.id?"solid":"ghost",children:[b(Ct,{primaryText:(f=u.name)!=null?f:t("Project")+" "+u.id,secondaryText:t("Last modified")+": "+ri(u.lastModified).map(t).join(" "),onClick:()=>o(u.id)}),b(De,{"aria-label":t("Edit project info"),title:t("Edit project info"),icon:b(mr,{}),onClick:()=>c(u)}),b(De,{"aria-label":t("Remove project"),title:t("Remove project"),icon:b(vt,{}),onClick:()=>n(u.id)})]},u.id)})]}),p.length>=10&&b(ot,{as:"em",fontSize:"xs",children:t("You have reached the maximum number of projects.")}),b(Pi,{config:i,onClose:()=>c(void 0),onUpdate:g})]})}const Cn=[{id:"basic",name:{en:"Basic",zh:"åŸºæœ¬"}},{id:"mtr",name:{en:"MTR","zh-Hans":"æ¸¯é“","zh-Hant":"æ¸¯éµ"}},{id:"gzmtr",name:{en:"Guangzhou Metro","zh-Hans":"å¹¿å·žåœ°é“","zh-Hant":"å»£å·žåœ°éµ"}},{id:"shmetro",name:{en:"Shanghai Metro","zh-Hans":"ä¸Šæµ·åœ°é“","zh-Hant":"ä¸Šæµ·åœ°éµ"}}],xi=Object.freeze(Object.defineProperty({__proto__:null,default:Cn},Symbol.toStringTag,{value:"Module"})),zn=[{filename:"default",name:{en:"Default","zh-Hans":"é»˜è®¤","zh-Hant":"é è¨­"},style:"mtr"},{filename:"coline",name:{en:"Track Share","zh-Hans":"å…±çº¿","zh-Hant":"å…±ç¶«"},style:"shmetro"},{filename:"loop",name:{en:"Loop Line","zh-Hans":"çŽ¯çº¿","zh-Hant":"ç’°ç¶«"},style:"shmetro"}],xn=[{filename:"twl",name:{en:"Tsuen Wan Line","zh-Hans":"èƒæ¹¾çº¿","zh-Hant":"èƒç£ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"ktl",name:{en:"Kwun Tong Line","zh-Hans":"è§‚å¡˜çº¿","zh-Hant":"è§€å¡˜ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"isl",name:{en:"Island Line","zh-Hans":"æ¸¯å²›çº¿","zh-Hant":"æ¸¯å³¶ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"tkl",name:{en:"Tseung Kwan O Line","zh-Hans":"å°†å†›æ¾³çº¿","zh-Hant":"å°‡è»æ¾³ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"tcl",name:{en:"Tung Chung Line","zh-Hans":"ä¸œæ¶Œçº¿","zh-Hant":"æ±æ¶Œç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"sile",name:{en:"South Island Line","zh-Hans":"å—æ¸¯å²›çº¿","zh-Hant":"å—æ¸¯å³¶ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"drl",name:{en:"Disneyland Resort Line","zh-Hans":"è¿ªå£«å°¼çº¿","zh-Hant":"è¿ªå£«å°¼ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"ael",name:{en:"Airport Express","zh-Hans":"æœºåœºå¿«çº¿","zh-Hant":"æ©Ÿå ´å¿«ç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"eal",name:{en:"East Rail Line","zh-Hans":"ä¸œé“çº¿","zh-Hant":"æ±éµç¶«"},uploadBy:"wongchito",style:"mtr"},{filename:"tml",name:{en:"Tuen Ma Line","zh-Hans":"å±¯é©¬çº¿","zh-Hant":"å±¯é¦¬ç¶«"},uploadBy:"wongchito",style:"mtr"}],In=[{filename:"gz1",name:{en:"Line 1","zh-Hans":"1å·çº¿","zh-Hant":"1è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz2",name:{en:"Line 2","zh-Hans":"2å·çº¿","zh-Hant":"2è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz3",name:{en:"Line 3","zh-Hans":"3å·çº¿","zh-Hant":"3è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz4",name:{en:"Line 4","zh-Hans":"4å·çº¿","zh-Hant":"4è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz5",name:{en:"Line 5","zh-Hans":"5å·çº¿","zh-Hant":"5è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz6",name:{en:"Line 6","zh-Hans":"6å·çº¿","zh-Hant":"6è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz7",name:{en:"Line 7","zh-Hans":"7å·çº¿","zh-Hant":"7è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz8",name:{en:"Line 8","zh-Hans":"8å·çº¿","zh-Hant":"8è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz9",name:{en:"Line 9","zh-Hans":"9å·çº¿","zh-Hant":"9è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz13",name:{en:"Line 13","zh-Hans":"13å·çº¿","zh-Hant":"13è™Ÿç·š"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"gz14",name:{en:"Line 14","zh-Hans":"14å·çº¿","zh-Hant":"14è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz18",name:{en:"Line 18","zh-Hans":"18å·çº¿","zh-Hant":"18è™Ÿç·š"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"gz21",name:{en:"Line 21","zh-Hans":"21å·çº¿","zh-Hant":"21è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz22",name:{en:"Line 22","zh-Hans":"22å·çº¿","zh-Hant":"22è™Ÿç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gf",name:{en:"Guangfo Line","zh-Hans":"å¹¿ä½›çº¿","zh-Hant":"å»£ä½›ç·š"},uploadBy:"wongchito",style:"gzmtr"},{filename:"apm",name:{en:"APM Line","zh-Hans":"APMçº¿","zh-Hant":"APMç·š"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"thz1",name:{en:"Haizhu Tram Line 1","zh-Hans":"æµ·ç æœ‰è½¨1å·çº¿","zh-Hant":"æµ·ç æœ‰è»Œ1è™Ÿç·š"},uploadBy:"clearng-kly",style:"gzmtr"},{filename:"thp1",name:{en:"Huangpu Tram Line 1","zh-Hans":"é»„åŸ”æœ‰è½¨1å·çº¿","zh-Hant":"é»ƒåŸ”æœ‰è»Œ1è™Ÿç·š"},uploadBy:"clearng-kly",style:"gzmtr"}],Dn=[{filename:"sh1",name:{en:"Line 1","zh-Hans":"1å·çº¿","zh-Hant":"1è™Ÿç·š"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh2",name:{en:"Line 2","zh-Hans":"2å·çº¿","zh-Hant":"2è™Ÿç·š"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh3",name:{en:"Line 3 (External)","zh-Hans":"3å·çº¿ ï¼ˆå…±çº¿ï¼‰","zh-Hant":"3è™Ÿç·š ï¼ˆå…±ç·šï¼‰"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh4",name:{en:"Line 4 (Loop)","zh-Hans":"4å·çº¿ ï¼ˆçŽ¯çº¿ï¼‰","zh-Hant":"4è™Ÿç·š ï¼ˆç’°ç·šï¼‰"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh3&4",name:{en:"Line 3 and 4 (External with Loop)","zh-Hans":"3ä¸Ž4å·çº¿ ï¼ˆå…±çº¿ä¸ŽçŽ¯çº¿ï¼‰","zh-Hant":"3èˆ‡4è™Ÿç·š ï¼ˆå…±ç·šèˆ‡ç’°ç·šï¼‰"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh5",name:{en:"Line 5","zh-Hans":"5å·çº¿","zh-Hant":"5è™Ÿç·š"},uploadBy:"Tianxiu11111",style:"shmetro"},{filename:"sh6",name:{en:"Line 6","zh-Hans":"6å·çº¿","zh-Hant":"6è™Ÿç·š"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh7",name:{en:"Line 7","zh-Hans":"7å·çº¿","zh-Hant":"7è™Ÿç·š"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh8",name:{en:"Line 8","zh-Hans":"8å·çº¿","zh-Hant":"8è™Ÿç·š"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh9",name:{en:"Line 9","zh-Hans":"9å·çº¿","zh-Hant":"9è™Ÿç·š"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh10",name:{en:"Line 10 (Branch)","zh-Hans":"10å·çº¿ ï¼ˆæ”¯çº¿ï¼‰","zh-Hant":"10è™Ÿç·š ï¼ˆæ”¯ç·šï¼‰"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh11",name:{en:"Line 11","zh-Hans":"11å·çº¿","zh-Hant":"11è™Ÿç·š"},uploadBy:"Tianxiu11111",style:"shmetro"},{filename:"sh12",name:{en:"Line 12","zh-Hans":"12å·çº¿","zh-Hant":"12è™Ÿç·š"},uploadBy:"Andy1782010",style:"shmetro"},{filename:"sh13",name:{en:"Line 13","zh-Hans":"13å·çº¿","zh-Hant":"13è™Ÿç·š"},uploadBy:"Andy1782010",style:"shmetro"},{filename:"sh14",name:{en:"Line 14","zh-Hans":"14å·çº¿","zh-Hant":"14è™Ÿç·š"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh15",name:{en:"Line 15","zh-Hans":"15å·çº¿","zh-Hant":"15è™Ÿç·š"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh16",name:{en:"Line 16 (Express)","zh-Hans":"16å·çº¿ ï¼ˆå¿«è½¦ï¼‰","zh-Hant":"16è™Ÿç·š ï¼ˆå¿«è»Šï¼‰"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh17",name:{en:"Line 17","zh-Hans":"17å·çº¿","zh-Hant":"17è™Ÿç·š"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh18",name:{en:"Line 18","zh-Hans":"18å·çº¿","zh-Hant":"18è™Ÿç·š"},uploadBy:"Tianxiu11111",style:"shmetro"}],Ln={basic:zn,mtr:xn,gzmtr:In,shmetro:Dn},Ii=Object.freeze(Object.defineProperty({__proto__:null,basic:zn,default:Ln,gzmtr:In,mtr:xn,shmetro:Dn},Symbol.toStringTag,{value:"Module"}));var cn;(function(e){e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro"})(cn||(cn={}));var dn;(function(e){e.Azerbaijani="az",e.Arabic="ar",e.Catalan="ca",e.Chinese="zh",e.ChineseCN="zh-CN",e.ChineseSimp="zh-Hans",e.ChineseTrad="zh-Hant",e.ChineseHK="zh-HK",e.ChineseTW="zh-TW",e.Danish="da",e.English="en",e.French="fr",e.Gaelic="ga",e.German="de",e.Greek="el",e.Hindi="hi",e.Hungarian="hu",e.Indonesian="id",e.Italian="it",e.Japanese="ja",e.Korean="ko",e.Malay="ms",e.Norwegian="no",e.Persian="fa",e.Polish="pl",e.Portuguese="pt",e.Romanian="ro",e.Russian="ru",e.Spanish="es",e.Swedish="sv",e.Thai="th",e.Turkish="tr",e.Urdu="ur",e.Uzbek="uz",e.Vietnamese="vn"})(dn||(dn={}));const kt=Cn,Di=Ln,Li=async()=>{try{return await(await fetch("/rmg-templates/resources/other-company-config.json")).json()}catch(e){return console.error("Failed to fetch non-core company config",e),[]}},ji=async e=>{try{return await(await fetch("/rmg-templates/resources/templates/"+e+"/00config.json")).json()}catch(p){return console.error("Failed to fetch template list for "+e,p),[]}},Fi=async(e,p)=>await(await fetch(`/rmg-templates/resources/templates/${e}/${p}.json`)).json(),Bi=Object.assign({"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/coline.json":()=>O(()=>import("./coline-f8f9d6ad.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/default.json":()=>O(()=>import("./default-8638e856.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/loop.json":()=>O(()=>import("./loop-d33ec3ba.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/company-config.json":()=>O(()=>Promise.resolve().then(()=>xi),void 0),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/apm.json":()=>O(()=>import("./apm-6e72c810.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gf.json":()=>O(()=>import("./gf-18503731.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz1.json":()=>O(()=>import("./gz1-75ca50af.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz13.json":()=>O(()=>import("./gz13-05ce4bc5.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz14.json":()=>O(()=>import("./gz14-0d29f52b.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz18.json":()=>O(()=>import("./gz18-d789dd2d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz2.json":()=>O(()=>import("./gz2-4c7b72d4.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz21.json":()=>O(()=>import("./gz21-fde5cfda.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz22.json":()=>O(()=>import("./gz22-68732269.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz3.json":()=>O(()=>import("./gz3-6bbd1d1a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz4.json":()=>O(()=>import("./gz4-cda087f7.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz5.json":()=>O(()=>import("./gz5-9cfad33f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz6.json":()=>O(()=>import("./gz6-ef051d83.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz7.json":()=>O(()=>import("./gz7-d485fe1c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz8.json":()=>O(()=>import("./gz8-9bfb0da0.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz9.json":()=>O(()=>import("./gz9-d4b7ed92.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/thp1.json":()=>O(()=>import("./thp1-a903ecca.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/thz1.json":()=>O(()=>import("./thz1-1ae6befb.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/ael.json":()=>O(()=>import("./ael-4597497c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/drl.json":()=>O(()=>import("./drl-31b14420.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/eal.json":()=>O(()=>import("./eal-34089efb.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/isl.json":()=>O(()=>import("./isl-f1ae743f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/ktl.json":()=>O(()=>import("./ktl-a9936c0c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/sile.json":()=>O(()=>import("./sile-9f2ad194.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tcl.json":()=>O(()=>import("./tcl-820e4d78.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tkl.json":()=>O(()=>import("./tkl-8050f7fc.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tml.json":()=>O(()=>import("./tml-a6ec2eb1.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/twl.json":()=>O(()=>import("./twl-cfa1235a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh1.json":()=>O(()=>import("./sh1-16505f5a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh10.json":()=>O(()=>import("./sh10-20d49595.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh11.json":()=>O(()=>import("./sh11-f590ba3c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh12.json":()=>O(()=>import("./sh12-55a7651d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh13.json":()=>O(()=>import("./sh13-f5ab141e.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh14.json":()=>O(()=>import("./sh14-e4f19564.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh15.json":()=>O(()=>import("./sh15-450e891e.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh16.json":()=>O(()=>import("./sh16-af851e67.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh17.json":()=>O(()=>import("./sh17-7a345c0f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh18.json":()=>O(()=>import("./sh18-57e7f645.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh2.json":()=>O(()=>import("./sh2-5e30f125.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh3&4.json":()=>O(()=>import("./sh3_4-e404007d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh3.json":()=>O(()=>import("./sh3-d2f3bfdd.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh4.json":()=>O(()=>import("./sh4-f52274b7.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh5.json":()=>O(()=>import("./sh5-4c805b99.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh6.json":()=>O(()=>import("./sh6-9ebc745d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh7.json":()=>O(()=>import("./sh7-8f088603.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh8.json":()=>O(()=>import("./sh8-87130c53.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh9.json":()=>O(()=>import("./sh9-7e967e6c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/template-configs.json":()=>O(()=>Promise.resolve().then(()=>Ii),void 0)});function Mi(e){const{isOpen:p,onClose:r,onOpenParam:l}=e,{t:o}=oe(),n=ve(),[s,t]=J.useState(kt),[i,c]=J.useState(Di);J.useEffect(()=>{Li().then(u=>{t([...kt,...u]);for(const f of u)ji(f.id).then(d=>{c(_=>({..._,[f.id]:d}))})})},[]);const g=async(u,f,d)=>{n(cs());const _=s.find(v=>v.id===u),m=_?wt(_.name):u,y=kt.some(v=>v.id===u);try{const v=y?(await Bi[`/node_modules/@railmapgen/rmg-templates-resources/templates/${u}/${f}.json`]()).default:await Fi(u,f);l(v,[m,d].join(" "))}catch(v){console.error("Failed to fetch template",v)}me.event(be.OPEN_TEMPLATE,{company:u,filename:f}),n(Sn())};return $(Fe,{isOpen:p,onClose:r,children:[b(Be,{}),$(Me,{children:[b(Ne,{children:o("TemplateModal.title")}),b(Ve,{}),b(He,{children:$(jt,{isLazy:!0,size:"sm",orientation:"vertical",colorScheme:"primary",children:[b(Ft,{maxW:150,children:s.map(u=>b(qe,{children:wt(u.name)},u.id))}),b(Bt,{maxW:250,children:Object.entries(i).sort((u,f)=>s.findIndex(d=>d.id===u[0])-s.findIndex(d=>d.id===f[0])).map(([u,f])=>b(pt,{as:Te,flexDirection:"column",py:0,px:1,children:f.map(d=>{var m;const _=wt(d.name);return b(Ct,{variant:"ghost",size:"sm",primaryText:_,secondaryText:o("by")+": "+((m=d.uploadBy)!=null?m:"Unknown"),onClick:()=>g(u,d.filename,_)},d.filename)})},u))})]})})]})]})}const Ni={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function Vi(e){const{selectedParam:p,disableNew:r,onError:l}=e,{t:o}=oe(),[,n]=yt(),[s,t]=J.useState(!1),i=J.useRef(null),c=J.useRef(null);J.useEffect(()=>{var _;p&&((_=c.current)==null||_.focus())},[p]);const g=()=>{const _=bi(ee.MTR,me.getLanguage()),m=Et(JSON.stringify(_));n({project:m}),me.event(be.NEW_PARAM,{})},u=(_,m)=>{const y=Et(JSON.stringify(_),m);n({project:y})},f=async _=>{var y;const m=(y=_.target.files)==null?void 0:y[0];console.log("handleImportProject():: received file",m);try{if(!m)l(o("OpenActions.unknownError"));else if(m.type!=="application/json")l(o("OpenActions.invalidType"));else{const v=await ni(m),w=Et(v);n({project:w}),me.event(be.UPLOAD_PARAM,{})}}catch(v){l(o("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",v)}_.target.value=""},d=()=>{p&&(n({project:p}),me.event(be.OPEN_PARAM,{}))};return $(Te,{sx:Ni,children:[b(ue,{leftIcon:b(je,{}),onClick:g,isDisabled:r,children:o("Blank project")}),b(ue,{leftIcon:b(pr,{}),onClick:()=>t(!0),isDisabled:r,children:o("Open template")}),b(ue,{leftIcon:b(fr,{}),onClick:()=>{var _;return(_=i.current)==null?void 0:_.click()},isDisabled:r,children:o("Import project")}),b(ue,{ref:c,colorScheme:"primary",leftIcon:b(_r,{}),onClick:d,isDisabled:p===void 0,children:o("Open selected")}),b("input",{ref:i,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),b(Mi,{isOpen:s,onClose:()=>t(!1),onOpenParam:u})]})}const Hi={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Ui(e){const{downloading:p}=e,{t:r}=oe(),[l]=yt(),o=l.get("project"),[n,s]=J.useState([]),[t,i]=J.useState(),c=J.useRef(null),g=gn();J.useEffect(()=>{s(At())},[p]),gr({ref:c,handler:()=>i(void 0)});const u=_=>{const{id:m,name:y,lastModified:v}=_;m&&(window.localStorage.setItem(it.PARAM_CONFIG_BY_ID+m,JSON.stringify({name:y,lastModified:v})),i(void 0),s(At()),me.event(be.UPDATE_PARAM_CONFIG,{}))},f=_=>{window.localStorage.removeItem(it.PARAM_BY_ID+_),window.localStorage.removeItem(it.PARAM_CONFIG_BY_ID+_),i(void 0),s(At()),me.event(be.REMOVE_PARAM,{})},d=_=>{g({description:_,status:"error",duration:1e4,isClosable:!0})};return $(_n,{justifyContent:"center",children:[o&&b(_t,{isIndeterminate:!0}),b(vr,{children:$(Ze,{sx:Hi,children:[b(we,{as:"h3",size:"lg",children:r("Saved projects")}),$(Te,{ref:c,children:[b(zi,{paramRegistry:n,downloading:p,selectedParam:t,onParamSelect:i,onParamRemove:f,onParamUpdate:u}),b(Vi,{selectedParam:t,disableNew:n.length>=10,onError:d})]})]})})]})}const Wi=e=>p=>{let r={id:e};const l=window.localStorage.getItem(it.PARAM_CONFIG_BY_ID+e);l===null?console.warn(`Config for paramID=${e} does not exist in localStorage`):r={...r,...JSON.parse(l)};try{const o=window.localStorage.getItem(it.PARAM_BY_ID+e);if(o===null)return console.warn(`Param ID=${e} does not exist in localStorage`),!1;{const n=hi(JSON.parse(o));return p(wn(r)),p(ds(n)),!0}}catch(o){return console.warn("Failed to parse param.",o),!1}};function Zi(){const{t:e}=oe(),p=ve(),{paramConfig:r}=te(f=>f.app),[l,o]=yt(),n=l.get("project"),s=l.get("external"),[t,i]=J.useState(!1),[c,g]=J.useState(),u=gn();return J.useEffect(()=>{if(console.log(`searchParam: project=${n}, external=${s}`),n&&s)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),o({project:n});else if(n)u.closeAll(),n===(r==null?void 0:r.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),i(!0)):(console.log(`AppRouter:: Loading app view for param (ID=${n})...`),p(Wi(n))?i(!0):(console.log(`AppRouter:: Failed to read param (ID=${n}). Rendering param selector view...`),u({description:e("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),o({})));else if(s){console.log("AppRouter:: External project URl is provided. Downloading project...");const f=decodeURIComponent(s);g(f),us(f).then(d=>{d?o({project:d}):(console.log(`AppRouter:: Failed to download param from ${f}. Rendering param selector view...`),u({description:e("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),o({})),g(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),i(!1)},[n,s]),t?b(Ti,{}):b(Ui,{downloading:c})}const qi=Object.freeze(Object.defineProperty({__proto__:null,default:Zi},Symbol.toStringTag,{value:"Module"}));export{qi as a,Yi as g,et as i,mi as w};
