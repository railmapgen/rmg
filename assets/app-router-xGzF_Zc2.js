import{j as _,a8 as bn,e as Oe,O as Se,a4 as ye,E as Pe,a7 as Ae,s as lt,a9 as At,d as de,aa as Ie,a2 as Ke,M as Xe,a3 as Je,w as dt,x as ht,p as Qe,q as et,r as tt,t as nt,W as Kt,ab as _n,ac as yn,ad as vn,ae as Dt,af as Sn,ag as xn,ah as mt,ai as wn,aj as kn,L as $e,ak as Xt,a as Cn,al as jn}from"./chakra-LCOuRCmM.js";import{r as X,c as st,g as An,u as En}from"./react-_H4gDEjW.js";import{_ as ot,u as J,r as ce,E as ve,R as ut,a as Jt,b as le,c as ue,d as On,e as Q,f as Lt,g as Ft,M as Rn,F as yt,h as Be,i as ze,j as Re,k as vt,o as Et,l as zn,m as Ot,n as Te,S as Le,p as Pn,q as Ut,s as Tn,t as Wt,v as In,w as Bn,x as St,y as Mn,z as Nn,A as Dn,B as Ln,C as Fn,D as Un,G as ct,H as we,I as Wn,J as Zn,K as Hn,L as Rt,N as zt,O as Pt,P as Gn,Q as Vn,T as $n,U as xt,V as wt,W as Yn,X as Zt,Y as qn,Z as Kn,$ as Qt,a0 as en,a1 as Xn,a2 as Jn,a3 as tn,a4 as nn,a5 as Ht,a6 as Qn,a7 as er,a8 as tr,a9 as nr,aa as rr,ab as ir,ac as sr,ad as ar,ae as or,af as lr,ag as cr,ah as gt,ai as dr,aj as hr,ak as ur,al as fr,am as pr,an as mr,ao as gr,ap as Me,aq as Fe,ar as Ue,as as Ne,at as rn,au as br,av as kt,aw as Ct,ax as _r,ay as yr,az as vr,aA as Sr,aB as xr,aC as wr,aD as sn,aE as kr,aF as Cr,aG as jr,aH as Ar,aI as Gt,aJ as Er,aK as Or,aL as Rr,aM as zr,aN as jt,aO as Pr,aP as Tr,aQ as Ir,aR as Br,aS as Mr,aT as Nr,aU as Dr,aV as Lr,aW as Fr,aX as Ye,aY as an,aZ as Ur,a_ as Wr,a$ as Zr,b0 as Vt}from"./index-zC30_Mze.js";import{R as be,n as De,w as Hr,i as Gr,d as $t,a as on,s as Vr,b as bt,r as $r,g as _t,P as Yr,c as qr,u as Kr,e as Xr,f as Jr}from"./param-manager-utils-5KMxANin.js";var Qr=function(p){var g=p.text,n=p.delimiter;return _.jsx("span",{children:g.split(n||"\\").map(function(o,s){return s?[_.jsx(bn,{children:"⏎"},s),o]:o})})};const ei={mtr:()=>ot(()=>import("./index-mhuy4KHT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),gzmtr:()=>ot(()=>import("./index-bF8GoVOo.js"),__vite__mapDeps([8,1,2,3,4,5,7])),shmetro:()=>ot(()=>import("./index-Zh0MyKal.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]))};function ti(p){const[g,n]=X.useState({});return X.useEffect(()=>(ei[p]().then(o=>{n(o.default)}).catch(o=>{console.error("Failed to load canvas for style ".concat(p),o),n({})}),()=>{n({})}),[p]),g}const ni={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function ri(){const{canvasToShow:p,canvasScale:g}=J(r=>r.app),{svg_height:n,style:o}=J(r=>r.param),s=ti(o);X.useEffect(()=>{document.getElementById("css_share").href="/rmg/styles/share_".concat(o,".css"),ce.event(ve.STYLE_CHANGE,{style:o})},[o]);const t=Object.keys(s).filter(r=>p.includes(r)),e=n*g;return _.jsx(Oe,{minH:e,sx:ni,children:Object.keys(s).length===0?_.jsx(ut,{isIndeterminate:!0}):t.map(r=>_.jsx(Jt,{sx:{minWidth:750,height:e},children:s[r]},r+o))})}function ii(){const{t:p}=le(),g=ue(),n=J(l=>l.app.selectedStation);console.log("InfoSection:: Rendering for",n);const o=J(l=>l.param.style),{num:s,name:t,secondaryName:e}=J(l=>l.param.stn_list[n]),r=[{type:"input",label:p("StationSidePanel.info.num"),value:s,placeholder:"01",onChange:l=>g(On(n,l)),hidden:![Q.GZMTR].includes(o)},{type:"input",label:p("Chinese name"),value:t[0],onChange:l=>g(Lt(n,[l,t[1]]))},{type:"input",label:p("English name"),value:t[1],onChange:l=>g(Lt(n,[t[0],l]))},{type:"input",label:p("StationSidePanel.info.zhSecondary"),value:e?e[0]:"",placeholder:"1号航站楼",onChange:l=>g(Ft(n,[l,e?e[1]:""])),hidden:![Q.GZMTR].includes(o)},{type:"input",label:p("StationSidePanel.info.enSecondary"),value:e?e[1]:"",placeholder:"Terminal 1",onChange:l=>g(Ft(n,[e?e[0]:"",l])),hidden:![Q.GZMTR].includes(o)}];return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("StationSidePanel.info.title")}),_.jsx(be,{fields:r,minW:130})]})}class si{static hexToRgb(g){return[parseInt(g.slice(1,3),16),parseInt(g.slice(3,5),16),parseInt(g.slice(5,7),16)]}static fade(g,n){return"rgba(".concat([...this.hexToRgb(g),n].join(","),")")}static euclideanDistance(g,n){return this.hexToRgb(g).reduce((o,s,t)=>o+Math.pow(s-this.hexToRgb(n)[t],2),0)}}function Tt(p){var s;const{theme:g,onClick:n}=p,{t:o}=le();return _.jsx(Pe,{size:"xs","aria-label":o("Colour"),mt:"0.45px",color:g==null?void 0:g[3],bg:g==null?void 0:g[2],_hover:{bg:si.fade((s=g==null?void 0:g[2])!=null?s:"#aaaaaa",.7)},icon:_.jsx(Rn,{}),onClick:n})}function ai(p){const{interchangeList:g,onAdd:n,onDelete:o,onUpdate:s}=p,{t}=le(),e=ue(),[r,l]=X.useState(),{paletteAppClipOutput:u}=J(y=>y.app),{style:v,theme:f,stn_list:d}=J(y=>y.param);X.useEffect(()=>{r!==void 0&&u&&(s==null||s(r,{...g[r],theme:u}),l(void 0))},[u==null?void 0:u.toString()]);const a=Object.values(d).reduce((y,b)=>{const[x,C]=y;return[[...new Set(x.concat(b.transfer.groups.map(j=>{var A,M;return(M=(A=j.lines)==null?void 0:A.map(O=>O.name[0]))!=null?M:[]}).flat()))],[...new Set(C.concat(b.transfer.groups.map(j=>{var A,M;return(M=(A=j.lines)==null?void 0:A.map(O=>O.name[1]))!=null?M:[]}).flat()))]]},[[],[]]),m=Object.fromEntries(Object.entries(yt).filter(([y])=>!["railway"].includes(y)).map(([y,b])=>[y,t(b)])),h=g.map((y,b)=>[{type:"input",label:t("Chinese name"),value:y.name[0],onChange:x=>s==null?void 0:s(b,{...y,name:[x,y.name[1]]}),optionList:a[0]},{type:"input",label:t("English name"),value:y.name[1],onChange:x=>s==null?void 0:s(b,{...y,name:[y.name[0],x]}),optionList:a[1]},{type:"select",label:t("Line icon"),value:y.facility,options:m,onChange:x=>s==null?void 0:s(b,{...y,facility:x}),hidden:![Q.MTR].includes(v)}]);return _.jsxs(Be,{direction:"column",children:[g.length===0&&_.jsxs(Ae,{spacing:.5,"data-testid":"interchange-card-stack",children:[_.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:t("StationSidePanel.interchange.noInterchanges")}),_.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n({theme:[f[0],"","#aaaaaa",ze.white],name:["",""]}),icon:_.jsx(Re,{})})]}),g.map((y,b)=>_.jsxs(Ae,{spacing:.5,"data-testid":"interchange-card-stack-".concat(b),children:[_.jsx(vt,{label:t("Colour"),minW:"40px",noLabel:b!==0,children:_.jsx(Tt,{theme:y.theme,onClick:()=>{var x;l(b),e(Et((x=y.theme)!=null?x:[f[0],"","#aaaaaa",ze.white]))}})}),_.jsx(be,{fields:h[b],noLabel:b!==0}),n&&b===h.length-1?_.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(g.slice(-1)[0]),icon:_.jsx(zn,{})}):_.jsx(Se,{minW:8}),o&&_.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.remove"),onClick:()=>o==null?void 0:o(b),icon:_.jsx(Ot,{})})]},b))]})}function oi(){const{t:p}=le(),g=ue(),n=J(f=>f.app.selectedStation),{theme:o,style:s}=J(f=>f.param),{transfer:t}=J(f=>f.param.stn_list[n]),e=f=>{var d,a,m,h;return[{type:"input",label:p("Station Chinese name"),value:(a=(d=t.groups[f].name)==null?void 0:d[0])!=null?a:"",hidden:![Q.MTR].includes(s),onChange:y=>{var b,x;return g(Ut(n,f,[y,(x=(b=t.groups[f].name)==null?void 0:b[1])!=null?x:""]))}},{type:"input",label:p("Station English name"),value:(h=(m=t.groups[f].name)==null?void 0:m[1])!=null?h:"",hidden:![Q.MTR].includes(s),onChange:y=>{var b,x;return g(Ut(n,f,[(x=(b=t.groups[f].name)==null?void 0:b[0])!=null?x:"",y]))}},{type:"switch",label:p("Paid area"),isChecked:t.paid_area,onChange:y=>g(Tn(n,y)),hidden:![Q.MTR].includes(s)||f===0,oneLine:!0}]},r=f=>d=>{g(Wt(n,f,d))},l=f=>d=>{g(In(n,f,d))},u=f=>(d,a)=>{g(Bn(n,f,d,a))},v=()=>{g(Wt(n,t.groups.length,{theme:[o[0],"","#AAAAAA",ze.white],name:["",""]}))};return _.jsxs(At,{align:"flex-start",p:1,children:[_.jsxs(Oe,{w:"100%",children:[_.jsx(ye,{as:"h5",size:"sm",mr:"auto",children:p("StationSidePanel.interchange.title")}),s===Q.MTR&&_.jsx(Te,{selections:[{label:p("Text on the left"),value:Le.left},{label:p("Text on the right"),value:Le.right}],defaultValue:t.tick_direc,onChange:f=>g(Pn(n,f))})]}),t.groups.map((f,d)=>{var a;return _.jsxs(X.Fragment,{children:[_.jsx(ye,{as:"h6",size:"xs",children:p(d===0?"StationSidePanel.interchange.within":d===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),d!==0&&_.jsx(be,{fields:e(d)}),_.jsx(ai,{interchangeList:(a=f.lines)!=null?a:[],onAdd:r(d),onDelete:l(d),onUpdate:u(d)})]},d)}),t.groups.length<3&&_.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:_.jsx(Re,{}),onClick:v,children:p("StationSidePanel.interchange.addGroup")})]})}function li(){const{t:p}=le(),g=ue(),n=J(m=>m.app.selectedStation),{style:o,loop:s}=J(m=>m.param),{services:t,facility:e,loop_pivot:r,one_line:l,int_padding:u}=J(m=>m.param.stn_list[n]),v=Object.values(St).map(m=>({label:p("StationSidePanel.more."+m),value:m,disabled:m===St.local&&o!==Q.SHMetro})),f=Object.fromEntries(Object.entries(yt).filter(([m])=>!["railway"].includes(m)).map(([m,h])=>[m,p(h)])),d=Object.fromEntries(Object.entries(yt).filter(([m])=>!["np360"].includes(m)).map(([m,h])=>[m,p(h)])),a=[{type:"custom",label:p("StationSidePanel.more.service"),component:_.jsx(Te,{selections:v,defaultValue:t,onChange:m=>g(Mn(n,m)),multiSelect:!0}),hidden:![Q.GZMTR,Q.SHMetro].includes(o)},{type:"select",label:p("StationSidePanel.more.facility"),value:e||"",options:{"":p("None"),...o===Q.MTR?f:d},onChange:m=>g(Nn(n,m)),hidden:![Q.MTR,Q.SHMetro].includes(o)},{type:"switch",label:p("StationSidePanel.more.pivot"),isChecked:r,onChange:m=>g(Dn(n,m)),hidden:![Q.SHMetro].includes(o)||!s,minW:"full",oneLine:!0},{type:"switch",label:p("StationSidePanel.more.oneLine"),isChecked:l,onChange:m=>g(Ln(n,m)),hidden:![Q.SHMetro].includes(o),minW:"full",oneLine:!0},{type:"input",label:p("StationSidePanel.more.intPadding"),value:u.toString(),validator:m=>Number.isInteger(m),onChange:m=>g(Fn(n,Number(m))),hidden:![Q.SHMetro].includes(o)},{type:"custom",label:p("StationSidePanel.more.intPaddingApplyGlobal"),component:_.jsx(Te,{selections:[{label:p("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:m=>g(Un(n))}),oneLine:!0,hidden:![Q.SHMetro].includes(o)}];return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("StationSidePanel.more.title")}),_.jsx(be,{fields:a})]})}function ci(){const{t:p}=le(),g=ue(),n=J(f=>f.app.selectedStation),o=J(f=>f.param.stn_list),{parents:s,children:t,branch:e}=o[n],r={[ct.through]:p("StationSidePanel.branch.through"),[ct.nonThrough]:p("StationSidePanel.branch.nonThrough")},l=f=>(f===we.left?s:t).reduce((d,a)=>({...d,[a]:o[a].name.join(" ")}),{}),u={upper:p("StationSidePanel.branch.upper"),lower:p("StationSidePanel.branch.lower")},v=f=>{const d=e==null?void 0:e[f];return d?[{type:"select",label:p("StationSidePanel.branch.type"),options:r,value:d[0],onChange:a=>g(Wn(n,f,a))},{type:"select",label:p("StationSidePanel.branch.firstStation"),options:l(f),value:d[1],onChange:a=>g(Zn(n,f,a))},{type:"select",label:p("StationSidePanel.branch.position"),options:u,value:(f===we.left?s:t)[0]===d[1]?"upper":"lower",onChange:()=>g(Hn(n,f))}]:[]};return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("Branches")}),_.jsx(ye,{as:"h6",size:"xs",children:p("Branch on the left")}),_.jsx(Be,{direction:"column",children:s.length===2?_.jsx(be,{fields:v(we.left)}):_.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:p("No branches found")})}),_.jsx(ye,{as:"h6",size:"xs",children:p("Branch on the right")}),_.jsx(Be,{direction:"column",children:t.length===2?_.jsx(be,{fields:v(we.right)}):_.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:p("No branches found")})})]})}function di(){return _.jsxs(Rt,{children:[_.jsx(ii,{}),_.jsx(Ie,{}),_.jsx(oi,{}),_.jsx(Ie,{}),_.jsx(ci,{}),_.jsx(Ie,{}),_.jsx(li,{})]})}function hi(){const{t:p}=le(),g=zt(),{style:n,svgWidth:o,svg_height:s,y_pc:t,branchSpacingPct:e,padding:r,direction_gz_x:l,direction_gz_y:u,loop:v}=J(d=>d.param),f=[...Pt[n].map(d=>({type:"input",label:p("StyleSidePanel.layout.".concat(d,"Width")),value:o[d].toString(),onChange:a=>g(Gn(Number(a),d))})),{type:"input",label:p("StyleSidePanel.layout.canvasHeight"),value:s.toString(),onChange:d=>g(Vn(Number(d)))},{type:"slider",label:p("StyleSidePanel.layout.verticalPosition"),value:t,min:0,max:100,onChange:d=>g($n(d)),leftIcon:_.jsx(xt,{}),rightIcon:_.jsx(wt,{}),hidden:![Q.MTR,Q.GZMTR].includes(n)},{type:"slider",label:p(v?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:e,min:0,max:v?50:100,onChange:d=>g(Yn(d)),leftIcon:_.jsx(Zt,{}),rightIcon:_.jsx(Re,{})},{type:"slider",label:p("StyleSidePanel.layout.padding"),value:r,min:0,max:50,onChange:d=>g(qn(d)),leftIcon:_.jsx(Zt,{}),rightIcon:_.jsx(Re,{})},{type:"slider",label:p("StyleSidePanel.layout.directionGzX"),value:l,min:0,max:100,onChange:d=>g(Kn(d)),leftIcon:_.jsx(Qt,{}),rightIcon:_.jsx(en,{}),hidden:![Q.GZMTR].includes(n)},{type:"slider",label:p("StyleSidePanel.layout.directionGzY"),value:u,min:0,max:100,onChange:d=>g(Xn(d)),leftIcon:_.jsx(xt,{}),rightIcon:_.jsx(wt,{}),hidden:![Q.GZMTR].includes(n)}];return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("StyleSidePanel.layout.title")}),_.jsx(be,{fields:f,minW:130})]})}function ui(){var G;const{t:p}=le(),g=ue(),{paletteAppClipOutput:n}=J(w=>w.app),{style:o,theme:s,line_name:t,line_num:e,spanLineNum:r,direction:l,platform_num:u,psd_num:v,namePosMTR:f,customiseMTRDest:d,info_panel_type:a,stn_list:m,loop:h}=J(w=>w.param),y=Math.max(...Object.values(m).map(w=>w.services.length)),[b,x]=X.useState(!1);X.useEffect(()=>{b&&n&&(g(Jn(n)),x(!1))},[n==null?void 0:n.toString()]);const C=[{label:p("StyleSidePanel.design.left"),value:Le.left},{label:p("StyleSidePanel.design.right"),value:Le.right}],j=Object.values(tn).reduce((w,T)=>({...w,[T]:p("StyleSidePanel.design."+T)}),{}),A=Object.values(nn).reduce((w,T)=>({...w,[T]:p("StyleSidePanel.design."+T)}),{}),M=[{type:"custom",label:p("Colour"),component:_.jsx(Tt,{theme:s,onClick:()=>{x(!0),g(Et(s))}}),minW:"40px"},{type:"input",label:p("StyleSidePanel.design.zhLineName"),value:t[0],onChange:w=>g(Ht([w,t[1]])),minW:130},{type:"input",label:p("StyleSidePanel.design.enLineName"),value:t[1],onChange:w=>g(Ht([t[0],w])),minW:130},{type:"input",label:p("StyleSidePanel.design.lineNum"),value:e,onChange:w=>g(Qn(w)),hidden:![Q.GZMTR].includes(o)},{type:"custom",label:p("Span digits over rows"),component:_.jsx(Te,{selections:[{label:p("Yes"),value:!0},{label:p("No"),value:!1}],defaultValue:r!=null?r:!1,onChange:w=>g(er(w))}),hidden:![Q.GZMTR].includes(o)},{type:"input",label:p("StyleSidePanel.design.platformNum"),value:u||"",onChange:w=>g(tr(w))},{type:"input",label:p("StyleSidePanel.design.psdNum"),value:v,onChange:w=>g(nr(w)),hidden:![Q.GZMTR].includes(o)},{type:"select",label:p("StyleSidePanel.design.panelType"),value:a,options:o===Q.GZMTR?j:A,onChange:w=>g(rr(w)),hidden:![Q.GZMTR,Q.SHMetro].includes(o)},{type:"custom",label:p("StyleSidePanel.design.direction"),component:_.jsx(Te,{selections:C,defaultValue:l,onChange:w=>g(ir(w))}),minW:"full",oneLine:!0}],O=[{label:p("StyleSidePanel.design.upwards"),value:!0},{label:p("StyleSidePanel.design.downward"),value:!1}],N=[{type:"custom",label:p("StyleSidePanel.design.firstStationNameDisplay"),component:_.jsx(Ae,{spacing:.5,children:_.jsx(Te,{selections:O,defaultValue:(G=f.isFlip)!=null?G:!0,onChange:w=>g(sr(w))})}),minW:"full",oneLine:!0,hidden:![Q.SHMetro].includes(o)||y>1||h}],R=[{label:p("StyleSidePanel.design.alternatively"),value:!0},{label:p("StyleSidePanel.design.onOneSide"),value:!1}],F=[{type:"custom",label:p("StyleSidePanel.design.nameDisplay"),component:_.jsxs(Ae,{spacing:.5,children:[_.jsx(Pe,{size:"xs",variant:"ghost","aria-label":p("StyleSidePanel.design.flip"),title:p("StyleSidePanel.design.flip"),icon:_.jsx(ar,{}),onClick:()=>g(or())}),_.jsx(Te,{selections:R,defaultValue:f.isStagger,onChange:w=>g(lr(w))})]}),minW:"full",oneLine:!0,hidden:![Q.MTR].includes(o)},{type:"switch",label:p("StyleSidePanel.design.legacyDestination"),isChecked:d.isLegacy,onChange:w=>g(cr(w)),hidden:![Q.MTR].includes(o),minW:"full",oneLine:!0},{type:"switch",label:p("StyleSidePanel.design.overrideTerminal"),isChecked:d.terminal!==!1,onChange:w=>g(gt(w?["",""]:!1)),hidden:![Q.MTR].includes(o),minW:"full",oneLine:!0},{type:"input",label:p("StyleSidePanel.design.terminalZhName"),value:d.terminal?d.terminal[0]:"",placeholder:"機場及博覽館",onChange:w=>g(gt([w,d.terminal?d.terminal[1]:""])),hidden:![Q.MTR].includes(o)||d.terminal===!1},{type:"input",label:p("StyleSidePanel.design.terminalEnName"),value:d.terminal?d.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:w=>g(gt([d.terminal?d.terminal[0]:"",w])),hidden:![Q.MTR].includes(o)||d.terminal===!1}];return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("StyleSidePanel.design.title")}),_.jsx(be,{fields:[...M,...F,...N],minW:130})]})}function fi(){const{t:p}=le(),g=ue(),{branches:n}=J(d=>d.helper),{loop:o,loop_info:s}=J(d=>d.param),{bank:t,left_and_right_factor:e,bottom_factor:r}=s,l=n.flat().filter((d=>a=>(d[a]=(d[a]||0)+1)===2)({})).filter(d=>!["linestart","lineend"].includes(d)),u=Math.abs(n[0].indexOf(l[0])-n[0].indexOf(l[1])),v=n.length>=2?(0,Math.min)(n[0].length-2-u,u):Math.floor((n[0].length-2-r*2)/2),f=[{type:"switch",label:p("StyleSidePanel.loop.isLoop"),isChecked:o,onChange:d=>g(dr(d)),minW:"full",oneLine:!0},{type:"switch",label:p("StyleSidePanel.loop.isBank"),isChecked:t,onChange:d=>g(hr(d)),minW:"full",oneLine:!0,hidden:!o},{type:"slider",label:p("StyleSidePanel.loop.leftRightFactor"),value:e,min:0,max:v,onChange:d=>g(ur(Math.floor(d))),hidden:!o},{type:"slider",label:p("StyleSidePanel.loop.bottomFactor"),value:r,min:0,max:Math.floor((n[0].length-2-e*2)/2),onChange:d=>g(fr(Math.floor(d))),hidden:!o||o&&n.length>2}];return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("StyleSidePanel.loop.title")}),_.jsx(be,{fields:f})]})}function pi(p){const{note:g,onUpdate:n,onDelete:o}=p,{t:s}=le(),t=[{type:"textarea",label:s("StyleSidePanel.note.zhNote"),value:g[0],onChange:r=>n==null?void 0:n([r,g[1],g[2],g[3],g[4]])},{type:"textarea",label:s("StyleSidePanel.note.enNote"),value:g[1],onChange:r=>n==null?void 0:n([g[0],r,g[2],g[3],g[4]])},{type:"switch",label:s("StyleSidePanel.note.border"),isChecked:g[4],onChange:r=>n==null?void 0:n([g[0],g[1],g[2],g[3],r]),oneLine:!0}],e=[{type:"slider",label:s("StyleSidePanel.note.positionX"),value:g[2],min:0,max:100,onChange:r=>n==null?void 0:n([g[0],g[1],r,g[3],g[4]]),leftIcon:_.jsx(Qt,{}),rightIcon:_.jsx(en,{})},{type:"slider",label:s("StyleSidePanel.note.positionY"),value:g[3],min:0,max:100,onChange:r=>n==null?void 0:n([g[0],g[1],g[2],r,g[4]]),leftIcon:_.jsx(xt,{}),rightIcon:_.jsx(wt,{})}];return _.jsxs(Be,{direction:"column",children:[_.jsx(be,{fields:t,minW:"full"}),_.jsxs(Ae,{spacing:.5,sx:{"&>div":{flex:1}},children:[_.jsx(be,{fields:e}),_.jsx(Pe,{size:"sm",variant:"ghost","aria-label":s("StyleSidePanel.note.remove"),onClick:()=>o==null?void 0:o(),icon:_.jsx(Ot,{})})]})]})}function mi(){const{t:p}=le(),g=ue(),n=J(o=>o.param.notesGZMTR);return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("StyleSidePanel.note.title")}),_.jsxs(At,{spacing:.5,children:[n==null?void 0:n.map((o,s)=>_.jsx(pi,{note:o,onUpdate:t=>g(pr(s,t)),onDelete:()=>g(mr(s))},s)),_.jsx(de,{size:"xs",variant:"ghost",leftIcon:_.jsx(Re,{}),alignSelf:"flex-end",onClick:()=>g(gr()),children:p("StyleSidePanel.note.add")})]})]})}function gi(){const{style:p}=J(g=>g.param);return _.jsxs(Rt,{children:[_.jsx(hi,{}),_.jsx(Ie,{}),_.jsx(ui,{}),p===Q.GZMTR&&_.jsxs(_.Fragment,{children:[_.jsx(Ie,{}),_.jsx(mi,{})]}),p===Q.SHMetro&&_.jsxs(_.Fragment,{children:[_.jsx(Ie,{}),_.jsx(fi,{})]})]})}const It=(p,g)=>{if(["linestart","lineend"].includes(p)||g[p].parents.length>1||g[p].children.length>1)return 0;const n=g[p].parents[0];return n?g[n].children.length===1?It(n,g):g[n].children.indexOf(p)===0?1:-1:0},bi=p=>(g,n)=>{const{stn_list:o,current_stn_idx:s}=n().param;if(p===s)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:t,children:e}=o[p];return Object.keys(o).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):t.length===2&&e.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(o).some(l=>![p,"linestart","lineend"].includes(l)&&It(l,o)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},_i=p=>(g,n)=>{var r,l;const o=n().param.stn_list,{parents:s,children:t}=o[p];let e=JSON.parse(JSON.stringify(o));s.length===2||t.length===2?(s.forEach(u=>{e[u].children=t}),t.forEach(u=>{e[u].parents=s}),s.length===1&&(e[s[0]].branch={...e[s[0]].branch,right:(r=e[p].branch)==null?void 0:r.right}),t.length===1&&(e[t[0]].branch={...e[t[0]].branch,left:(l=e[p].branch)==null?void 0:l.left})):o[s[0]].children.length===2&&o[t[0]].parents.length===2?e={...o,[s[0]]:{...o[s[0]],children:o[s[0]].children.filter(u=>u!==p),branch:{...o[s[0]].branch,right:void 0}},[t[0]]:{...o[t[0]],parents:o[t[0]].parents.filter(u=>u!==p),branch:{...o[t[0]].branch,left:void 0}}}:(s.forEach(u=>{var f,d,a,m;const v=e[u].children.indexOf(p);t.length?e[u].children[v]=t[0]:e[u].children.splice(v,1),((d=(f=e[u].branch)==null?void 0:f.right)==null?void 0:d[1])===p&&(e[u].branch={...e[u].branch,right:(m=(a=e[u].branch)==null?void 0:a.right)==null?void 0:m.with(1,t[0])})}),t.forEach(u=>{var f,d,a,m;const v=e[u].parents.indexOf(p);s.length?e[u].parents[v]=s[0]:e[u].parents.splice(v,1),((d=(f=e[u].branch)==null?void 0:f.left)==null?void 0:d[1])===p&&(e[u].branch={...e[u].branch,left:(m=(a=e[u].branch)==null?void 0:a.left)==null?void 0:m.with(1,s[0])})})),delete e[p],g(Me(e))};function yi(...p){return p.reduce((g,n)=>g.map(o=>n.map(s=>o.concat([s]))).reduce((o,s)=>o.concat(s),[]),[[]])}const We=(p,g)=>!!g[p[0]].children.indexOf(p[1]),ln=(p,g)=>[p[0][1],p[0][p[0].length-2],...p[0].filter(n=>p.slice(1).filter(o=>We(o,g)).map(o=>o.filter(s=>!["linestart","lineend"].includes(s))).map(o=>[o[0],o[o.length-1]]).flat().includes(n))],vi=(p,g)=>p.slice(1).filter(n=>We(n,g)).map(n=>n.filter(o=>!["linestart","lineend"].includes(o))).map(n=>[n[0],n[n.length-1]]),Si=p=>(g,n)=>{const o=n().helper.branches;if(p===0){const s=n().param.stn_list,t=ln(o,s);return yi(t,t).filter(e=>e[0]!==e[1])}else{const s=o[p];if(s){const t=s.filter(e=>!["linestart","lineend"].includes(e));return[[t[0],t.slice(-1)[0]]]}else return[]}},Cs=(p,g)=>(n,o)=>{const s=o().param.coline,t=o().helper.branches[g];for(const[e,r]of Object.entries(s))if(r.from===p&&t.includes(r.to)){const l=t.indexOf(p),u=t.indexOf(r.to);if(u>l)return[u-l+1,e]}else if(r.to===p&&t.includes(r.to)){const l=t.indexOf(p),u=t.indexOf(r.from);if(u>l)return[u-l+1,e]}return[0,void 0]},cn=(p,g)=>(n,o)=>{const s=o().param.stn_list,t=o().helper.branches;if(p===g)throw new Error("addColine():: failed for same stnId");const e=ln(t,s).filter(l=>[p,g].includes(l)),r=vi(t,s).filter(l=>[p,g].every(u=>l.includes(u)));if(e.length===2&&r.length>0)throw new Error("addColine():: main check failed for ".concat(p,", ").concat(g));if(e.length!==2&&r.length!==1)throw new Error("addColine():: branch check failed for ".concat(p,", ").concat(g))},xi=p=>(g,n)=>{const o=n().param.coline,t=n().helper.branches[p];return t?Object.entries(o).reduce((e,r)=>t.includes(r[1].from)&&t.includes(r[1].to)?{...e,[r[0]]:r[1]}:{...e},{}):{}},wi=p=>(g,n)=>{const o=n().param.coline;if(Object.keys(o).length===0)return;const s=Object.entries(o).reduce((t,e)=>e[1].from!==p&&e[1].to!==p?{...t,[e[0]]:e[1]}:{...t},{});g(Fe(s))},ki=(p,g,n,o=!0)=>(s,t)=>{const e=t().param.coline;s(cn(p,g)),s(Fe({...e,[De(4)]:{from:p,to:g,colors:n,display:o}}))},Ci=(p,g,n,o=!0)=>(s,t)=>{const e=t().param.coline;if(p in e){s(cn(g,n));const r={...e,[p]:{...e[p],from:g,to:n,display:o}};s(Fe(r))}},ji=(p,g)=>(n,o)=>{const s=o().param.coline;if(p in s&&s[p].colors.length>g){const t=s[p].colors.filter((e,r)=>r!==g);if(t.length===0){const{[p]:e,...r}=s;n(Fe(r))}else{const e={...s,[p]:{...s[p],colors:t}};n(Fe(e))}}},Ai=(p,g,n)=>(o,s)=>{const t=s().param.coline;if(p in t&&t[p].colors.length>g){const e={...t,[p]:{...t[p],colors:t[p].colors.map((r,l)=>l===g?[0,1,2,3,4,5].map(u=>n[u]===void 0?r[u]:n[u]):r)}};o(Fe(e))}};function Ei(p){const{isOpen:g,onClose:n}=p,{t:o}=le(),s=ue(),t=J(u=>u.app.selectedStation),[e,r]=X.useState(!1);X.useEffect(()=>{g||r(!1)},[g]);const l=()=>{const u=s(bi(t));u?(n(),s(Ue(Ne.CLOSE)),s(rn("linestart")),s(wi(t)),s(_i(t))):r(!0),ce.event(ve.REMOVE_STATION,{success:u})};return _.jsxs(Ke,{isOpen:g,onClose:n,children:[_.jsx(Xe,{}),_.jsxs(Je,{children:[e&&_.jsxs(dt,{status:"error",variant:"solid",size:"xs",children:[_.jsx(ht,{}),o("Unable to remove this station.")]}),_.jsxs(Se,{position:"relative",children:[_.jsx(Qe,{children:o("Remove station")}),_.jsx(et,{})]}),_.jsx(tt,{children:o("Are you sure to remove station? You cannot undo this action.")}),_.jsxs(nt,{children:[_.jsx(de,{onClick:n,children:o("Cancel")}),_.jsx(de,{colorScheme:"primary",onClick:l,ml:3,children:o("Confirm")})]})]})]})}function Oi(){const{t:p}=le(),g=ue(),n=J(t=>t.app.selectedStation),[o,s]=X.useState(!1);return _.jsxs(br,{children:[_.jsxs(Ae,{children:[_.jsx(de,{size:"sm",variant:"outline",onClick:()=>g(kt(n)),children:p("StationSidePanel.footer.current")}),_.jsx(de,{size:"sm",variant:"outline",onClick:()=>s(!0),children:p("StationSidePanel.footer.remove")})]}),_.jsx(Ei,{isOpen:o,onClose:()=>s(!1)})]})}function Ri(p){const{colineInfo:g,routeOptions:n,onUpdateRoute:o,onUpdateColourInfo:s,onDelete:t}=p,{t:e}=le(),r=ue(),{paletteAppClipOutput:l}=J(a=>a.app),[u,v]=X.useState(!1);X.useEffect(()=>{u&&l&&(s==null||s([...l,g.colors[0][4],g.colors[0][5]]),v(!1))},[l==null?void 0:l.toString()]);const f=[{type:"select",label:"Route",value:[g.from,g.to].join(","),options:n,onChange:a=>o==null?void 0:o(a)}],d=[{type:"custom",label:e("Colour"),component:_.jsx(Tt,{theme:[g.colors[0][0],g.colors[0][1],g.colors[0][2],g.colors[0][3]],onClick:()=>{v(!0),r(Et(g.colors[0].slice(0,4)))}})},{type:"input",label:e("Chinese name"),value:g.colors[0][4],minW:120,onChange:a=>s==null?void 0:s([g.colors[0][0],g.colors[0][1],g.colors[0][2],g.colors[0][3],a,g.colors[0][5]])},{type:"input",label:e("English name"),value:g.colors[0][5],minW:120,onChange:a=>s==null?void 0:s([g.colors[0][0],g.colors[0][1],g.colors[0][2],g.colors[0][3],g.colors[0][4],a])}];return _.jsxs(Be,{direction:"column",children:[_.jsx(be,{fields:f,minW:"full"}),_.jsxs(Ae,{spacing:.5,children:[_.jsx(be,{fields:d}),_.jsx(Pe,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>t==null?void 0:t(0),icon:_.jsx(Ot,{})})]})]})}function zi(){const{t:p}=le(),g=ue(),n=J(d=>d.app.selectedBranch),{theme:o,stn_list:s}=J(d=>d.param),t=g(xi(n)),e=g(Si(n)),r=d=>d.map(a=>s[a].name.join(" - ")).join(" ~ "),l=e.reduce((d,a)=>({...d,[a.join(",")]:r(a)}),{}),u=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(n," with default combination"),e[0]),g(ki(e[0][0],e[0][1],[[o[0],"","#AAAAAA",ze.white,"",""]]))},v=d=>a=>{const[m,h]=a.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(d,", from=").concat(m,", to=").concat(h));try{g(Ci(d,m,h))}catch(y){g(Ct({status:"error",message:"Unable to draw this share track."}))}},f=(d,a)=>{g(ji(d,a))};return _.jsxs(At,{align:"flex-start",p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("BranchSidePanel.coline.title")}),Object.entries(t).map(([d,a])=>_.jsx(Ri,{colineInfo:a,routeOptions:l,onUpdateRoute:v(d),onUpdateColourInfo:m=>g(Ai(d,0,m)),onDelete:m=>f(d,m)},d)),(n===0||Object.keys(t).length===0)&&_.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:_.jsx(Re,{}),onClick:u,children:p("BranchSidePanel.coline.add")})]})}function Pi(p){const{isOpen:g,onClose:n}=p,{t:o}=le(),s=ue(),t=J(j=>j.app.selectedBranch),{style:e,stn_list:r}=J(j=>j.param),l=J(j=>j.helper.branches),[u,v]=X.useState(t),[f,d]=X.useState("1"),[a,m]=X.useState("2"),[h,y]=X.useState("asc");X.useEffect(()=>{v(t)},[t]);const b=[{type:"select",label:o("AutoNumModal.where"),value:u,options:{...l.reduce((j,A,M)=>({...j,[M]:M===0?o("AutoNumModal.main"):e!==Q.SHMetro||!We(A,r)?o("AutoNumModal.branch")+" "+M:o("AutoNumModal.external")+" "+M}),{})},onChange:j=>v(j)},{type:"input",label:o("AutoNumModal.from"),value:f,validator:j=>!isNaN(Number(j)),onChange:d,debouncedDelay:0},{type:"input",label:o("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:a,onChange:m,debouncedDelay:0},{type:"select",label:o("AutoNumModal.sort"),value:h,options:{asc:o("AutoNumModal.asc"),desc:o("AutoNumModal.desc")},onChange:j=>y(j)}],x=()=>{s(_r(u,Number(f),Number(a),h)),n(),ce.event(ve.AUTO_NUMBERING,{})},C=!f||!a||isNaN(Number(f))||isNaN(Number(a));return _.jsxs(Ke,{isOpen:g,onClose:n,children:[_.jsx(Xe,{}),_.jsxs(Je,{children:[_.jsx(Qe,{children:o("AutoNumModal.title")}),_.jsx(et,{}),_.jsx(tt,{children:_.jsx(be,{fields:b})}),_.jsx(nt,{children:_.jsx(de,{colorScheme:"primary",isDisabled:C,onClick:x,children:o("Confirm")})})]})]})}const Bt=p=>(g,n)=>{const s=n().helper.branches[p];return s.includes("linestart")||s.includes("lineend")?1:2},dn=p=>(g,n)=>{const{branches:o}=n().helper,s=o[0],t=o[p];return s.slice(s.indexOf(t[0])+1,s.indexOf(t.slice(-1)[0]))},Ti=(p,g)=>n=>n(Bt(g))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(dn(g)).includes(p)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Ii=(p,g)=>(n,o)=>{var l,u;if(!n(Ti(p,g)))return!1;const{branches:t}=o().helper,e=o().param.stn_list,r=t[g];if(r[0]==="linestart"){const v={...e,[r[1]]:{...e[r[1]],parents:[p]},[p]:{...e[p],children:e.linestart.children.map(f=>f===r[1]?f:e[p].children[0]),branch:{right:(l=e.linestart.branch)==null?void 0:l.right}},linestart:{...e.linestart,children:e.linestart.children.filter(f=>f!==r[1]),branch:{}}};return n(Me(v)),!0}else{const v=r.slice(-2)[0],f={...e,[v]:{...e[v],children:[p]},[p]:{...e[p],parents:e.lineend.parents.map(d=>d===v?d:e[p].parents[0]),branch:{left:(u=e.lineend.branch)==null?void 0:u.left}},lineend:{...e.lineend,parents:e.lineend.parents.filter(d=>d!==v),branch:{}}};return n(Me(f)),!0}},hn=p=>(g,n)=>{const{branches:o}=n().helper,s=n().param.stn_list,t=o[0],e=o[p];if(g(Bt(p))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const l=t.indexOf(e[0]),u=t.slice(0,l),v=t.indexOf(e.slice(-1)[0]),f=t.slice(v+1),d=u.every(m=>s[m].children.length<=1&&s[m].parents.length<=1),a=f.every(m=>s[m].children.length<=1&&s[m].parents.length<=1);return d?a?[we.left,we.right]:[we.left]:a?[we.right]:[]},Bi=(p,g)=>(n,o)=>{var u,v;if(!n(hn(g)).includes(p))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:t}=o().helper,e=o().param.stn_list,r=t[0],l=t[g];if(p===we.left){const f=l[0],d={...e,[l[1]]:{...e[l[1]],parents:["linestart"]},[f]:{...e[f],children:e[f].children.filter(a=>a!==l[1]),branch:{}},linestart:{...e.linestart,children:e[f].children.map(a=>a===l[1]?a:r[1]),branch:{right:(u=e[f].branch)==null?void 0:u.right}}};return n(Me(d)),!0}else{const f=l.slice(-1)[0],d=l.slice(-2)[0],a={...e,[d]:{...e[d],children:["lineend"]},[f]:{...e[f],parents:e[f].parents.filter(m=>m!==d),branch:{}},lineend:{...e.lineend,parents:e[f].parents.map(m=>m===d?m:r.slice(-2)[0]),branch:{left:(v=e[f].branch)==null?void 0:v.left}}};return n(Me(a)),!0}};function Yt(p){const{direction:g}=p,{t:n}=le(),o=ue(),{branches:s}=J(O=>O.helper),t=J(O=>O.app.selectedBranch),{style:e,stn_list:r}=J(O=>O.param),[l,u]=X.useState(!1),[v,f]=X.useState(""),d=s[t].filter(O=>!["linestart","lineend"].includes(O)),a=g===we.left?d[0]:d.slice(-1)[0],m=r[a],h=o(dn(t)),y=o(Bt(t)),b=o(hn(t)),x=y===1&&!s[0].includes(a),C=b.includes(g),j=h.reduce((O,N)=>{var R;return{...O,[N]:(R=r[N])==null?void 0:R.name.join(" - ")}},{"":n("Please select...")}),A=()=>{const O=o(Ii(v,t));O?u(!1):o(Ct({status:"error",message:n("Unable to connect to main line.")})),ce.event(ve.CONNECT_BRANCH,{style:e,success:O})},M=()=>{const O=o(Bi(g,t));O||o(Ct({status:"error",message:n("Unable to disconnect from main line.")})),ce.event(ve.DISCONNECT_BRANCH,{style:e,success:O})};return _.jsxs(Be,{direction:"column",children:[_.jsxs(Oe,{alignItems:"center",children:[_.jsx(vt,{label:n("Station name"),flex:1,children:_.jsx(yr,{defaultValue:m.name.join(" "),isDisabled:!0})}),l?_.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>u(!1),children:n("Cancel")}):x?_.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>u(!0),children:n("Connect to main line")}):_.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:M,isDisabled:!C,children:n("Disconnect from main line")})]}),l&&_.jsxs(Oe,{alignItems:"center",children:[_.jsx(vt,{label:n("Target station"),flex:1,children:_.jsx(vr,{defaultValue:v,options:j,disabledOptions:[""],onChange:({target:{value:O}})=>f(O)})}),_.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!v,children:n("Confirm")})]})]})}function Mi(){const{t:p}=le(),g=ue(),n=J(r=>r.param.style),o=J(r=>r.app.selectedBranch),[s,t]=X.useState(!1),e=()=>{g(wr(n===Q.SHMetro)),ce.event(ve.REVERSE_STATIONS,{style:n})};return _.jsxs(Se,{p:1,children:[_.jsx(ye,{as:"h5",size:"sm",children:p("BranchSidePanel.action.title")}),_.jsxs(Oe,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[o!==0&&n!==Q.SHMetro&&_.jsxs(_.Fragment,{children:[_.jsx(ye,{as:"h6",size:"xs",children:p("Branch left end")}),_.jsx(Yt,{direction:we.left}),_.jsx(ye,{as:"h6",size:"xs",children:p("Branch right end")}),_.jsx(Yt,{direction:we.right})]}),n===Q.GZMTR&&_.jsx(de,{size:"sm",variant:"outline",leftIcon:_.jsx(Sr,{}),alignSelf:"flex-end",onClick:()=>t(!0),children:p("BranchSidePanel.action.autoNum")}),_.jsx(de,{size:"sm",variant:"outline",leftIcon:_.jsx(xr,{}),alignSelf:"flex-end",onClick:e,children:n===Q.SHMetro?p("BranchSidePanel.action.flip"):p("BranchSidePanel.action.reverse")})]}),_.jsx(Pi,{isOpen:s,onClose:()=>t(!1)})]})}function Ni(){const p=J(s=>s.app.selectedBranch),{style:g,stn_list:n}=J(s=>s.param),o=J(s=>s.helper.branches);return _.jsxs(Rt,{children:[g===Q.SHMetro&&(p===0||We(o[p],n))&&_.jsxs(_.Fragment,{children:[_.jsx(zi,{}),_.jsx(Ie,{})]}),_.jsx(Mi,{})]})}const Di="rmg-palette-bridge--",Li={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function Fi(p){const{isOpen:g,onClose:n,defaultTheme:o,onSelect:s}=p,[t]=X.useState(De()),[e,r]=X.useState(!1),l="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:ce.getAppName(),parentId:t}),u=X.useRef();return X.useEffect(()=>{const v=new BroadcastChannel(Di+t);return u.current=v,v.onmessage=f=>{const{event:d,data:a}=f.data;console.log("[rmg] Received event from Palette app clip:",d),d==="CLOSE"?n():d==="SELECT"?s(a):d==="LOADED"&&r(!0)},()=>{v.close()}},[]),X.useEffect(()=>{var v;o&&((v=u.current)==null||v.postMessage({event:"OPEN",data:o}))},[e,o==null?void 0:o.toString()]),_.jsxs(sn,{size:"md",isOpen:g,onClose:n,sx:Li,children:[_.jsx(Kt,{onClick:n}),_.jsx("iframe",{src:l,loading:"eager"})]})}const Ui=410;function Wi(){var l,u;const{t:p}=le(),g=zt(),{sidePanelMode:n,selectedStation:o,paletteAppClipInput:s}=J(v=>v.app),t=J(v=>{var f;return(f=v.param.stn_list[o])==null?void 0:f.name}),e={STATION:{header:_.jsx(Qr,{text:(t==null?void 0:t.join(" - "))||""}),body:_.jsx(di,{}),footer:_.jsx(Oi,{})},STYLE:{header:p("StyleSidePanel.header"),body:_.jsx(gi,{})},BRANCH:{header:p("BranchSidePanel.header"),body:_.jsx(Ni,{})},CLOSE:{header:"Close"}},r=()=>{g(Ue(Ne.CLOSE))};return _.jsxs(kr,{isOpen:n!==Ne.CLOSE,width:Ui,header:"Dummy header",children:[_.jsx(Cr,{onClose:r,children:e[n].header}),(l=e[n])==null?void 0:l.body,(u=e[n])==null?void 0:u.footer,_.jsx(Fi,{isOpen:!!s,onClose:()=>g(jr()),defaultTheme:s,onSelect:v=>g(Ar(v))})]})}function at(p){throw new Error('Could not dynamically require "'+p+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var un={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(p,g){(function(n){p.exports=n()})(function(){return function n(o,s,t){function e(u,v){if(!s[u]){if(!o[u]){var f=typeof at=="function"&&at;if(!v&&f)return f(u,!0);if(r)return r(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var a=s[u]={exports:{}};o[u][0].call(a.exports,function(m){var h=o[u][1][m];return e(h||m)},a,a.exports,n,o,s,t)}return s[u].exports}for(var r=typeof at=="function"&&at,l=0;l<t.length;l++)e(t[l]);return e}({1:[function(n,o,s){var t=n("./utils"),e=n("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var u,v,f,d,a,m,h,y=[],b=0,x=l.length,C=x,j=t.getTypeOf(l)!=="string";b<l.length;)C=x-b,f=j?(u=l[b++],v=b<x?l[b++]:0,b<x?l[b++]:0):(u=l.charCodeAt(b++),v=b<x?l.charCodeAt(b++):0,b<x?l.charCodeAt(b++):0),d=u>>2,a=(3&u)<<4|v>>4,m=1<C?(15&v)<<2|f>>6:64,h=2<C?63&f:64,y.push(r.charAt(d)+r.charAt(a)+r.charAt(m)+r.charAt(h));return y.join("")},s.decode=function(l){var u,v,f,d,a,m,h=0,y=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===r.charAt(64)&&C--,l.charAt(l.length-2)===r.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=e.uint8array?new Uint8Array(0|C):new Array(0|C);h<l.length;)u=r.indexOf(l.charAt(h++))<<2|(d=r.indexOf(l.charAt(h++)))>>4,v=(15&d)<<4|(a=r.indexOf(l.charAt(h++)))>>2,f=(3&a)<<6|(m=r.indexOf(l.charAt(h++))),x[y++]=u,a!==64&&(x[y++]=v),m!==64&&(x[y++]=f);return x}},{"./support":30,"./utils":32}],2:[function(n,o,s){var t=n("./external"),e=n("./stream/DataWorker"),r=n("./stream/Crc32Probe"),l=n("./stream/DataLengthProbe");function u(v,f,d,a,m){this.compressedSize=v,this.uncompressedSize=f,this.crc32=d,this.compression=a,this.compressedContent=m}u.prototype={getContentWorker:function(){var v=new e(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return v.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new e(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(v,f,d){return v.pipe(new r).pipe(new l("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},o.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,o,s){var t=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,o,s){var t=n("./utils"),e=function(){for(var r,l=[],u=0;u<256;u++){r=u;for(var v=0;v<8;v++)r=1&r?3988292384^r>>>1:r>>>1;l[u]=r}return l}();o.exports=function(r,l){return r!==void 0&&r.length?t.getTypeOf(r)!=="string"?function(u,v,f,d){var a=e,m=d+f;u^=-1;for(var h=d;h<m;h++)u=u>>>8^a[255&(u^v[h])];return-1^u}(0|l,r,r.length,0):function(u,v,f,d){var a=e,m=d+f;u^=-1;for(var h=d;h<m;h++)u=u>>>8^a[255&(u^v.charCodeAt(h))];return-1^u}(0|l,r,r.length,0):0}},{"./utils":32}],5:[function(n,o,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,o,s){var t=null;t=typeof Promise<"u"?Promise:n("lie"),o.exports={Promise:t}},{lie:37}],7:[function(n,o,s){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",e=n("pako"),r=n("./utils"),l=n("./stream/GenericWorker"),u=t?"uint8array":"array";function v(f,d){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}s.magic="\b\0",r.inherits(v,l),v.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(u,f.data),!1)},v.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new e[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},s.compressWorker=function(f){return new v("Deflate",f)},s.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,o,s){function t(a,m){var h,y="";for(h=0;h<m;h++)y+=String.fromCharCode(255&a),a>>>=8;return y}function e(a,m,h,y,b,x){var C,j,A=a.file,M=a.compression,O=x!==u.utf8encode,N=r.transformTo("string",x(A.name)),R=r.transformTo("string",u.utf8encode(A.name)),F=A.comment,G=r.transformTo("string",x(F)),w=r.transformTo("string",u.utf8encode(F)),T=R.length!==A.name.length,c=w.length!==F.length,D="",ne="",Z="",ie=A.dir,H=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};m&&!h||(re.crc32=a.crc32,re.compressedSize=a.compressedSize,re.uncompressedSize=a.uncompressedSize);var I=0;m&&(I|=8),O||!T&&!c||(I|=2048);var P=0,te=0;ie&&(P|=16),b==="UNIX"?(te=798,P|=function(Y,fe){var _e=Y;return Y||(_e=fe?16893:33204),(65535&_e)<<16}(A.unixPermissions,ie)):(te=20,P|=function(Y){return 63&(Y||0)}(A.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,j=H.getUTCFullYear()-1980,j<<=4,j|=H.getUTCMonth()+1,j<<=5,j|=H.getUTCDate(),T&&(ne=t(1,1)+t(v(N),4)+R,D+="up"+t(ne.length,2)+ne),c&&(Z=t(1,1)+t(v(G),4)+w,D+="uc"+t(Z.length,2)+Z);var q="";return q+="\n\0",q+=t(I,2),q+=M.magic,q+=t(C,2),q+=t(j,2),q+=t(re.crc32,4),q+=t(re.compressedSize,4),q+=t(re.uncompressedSize,4),q+=t(N.length,2),q+=t(D.length,2),{fileRecord:f.LOCAL_FILE_HEADER+q+N+D,dirRecord:f.CENTRAL_FILE_HEADER+t(te,2)+q+t(G.length,2)+"\0\0\0\0"+t(P,4)+t(y,4)+N+D+G}}var r=n("../utils"),l=n("../stream/GenericWorker"),u=n("../utf8"),v=n("../crc32"),f=n("../signature");function d(a,m,h,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=h,this.encodeFileName=y,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(d,l),d.prototype.push=function(a){var m=a.meta.percent||0,h=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,l.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:h?(m+100*(h-y-1))/h:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var m=this.streamFiles&&!a.file.dir;if(m){var h=e(a,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var m=this.streamFiles&&!a.file.dir,h=e(a,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),m)this.push({data:function(y){return f.DATA_DESCRIPTOR+t(y.crc32,4)+t(y.compressedSize,4)+t(y.uncompressedSize,4)}(a),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var h=this.bytesWritten-a,y=function(b,x,C,j,A){var M=r.transformTo("string",A(j));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(b,2)+t(b,2)+t(x,4)+t(C,4)+t(M.length,2)+M}(this.dirRecords.length,h,a,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var m=this;return a.on("data",function(h){m.processChunk(h)}),a.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),a.on("error",function(h){m.error(h)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var m=this._sources;if(!l.prototype.error.call(this,a))return!1;for(var h=0;h<m.length;h++)try{m[h].error(a)}catch(y){}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var a=this._sources,m=0;m<a.length;m++)a[m].lock()},o.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,o,s){var t=n("../compressions"),e=n("./ZipFileWorker");s.generateWorker=function(r,l,u){var v=new e(l.streamFiles,u,l.platform,l.encodeFileName),f=0;try{r.forEach(function(d,a){f++;var m=function(x,C){var j=x||C,A=t[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(a.options.compression,l.compression),h=a.options.compressionOptions||l.compressionOptions||{},y=a.dir,b=a.date;a._compressWorker(m,h).withStreamInfo("file",{name:d,dir:y,date:b,comment:a.comment||"",unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions}).pipe(v)}),v.entriesCount=f}catch(d){v.error(d)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,o,s){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new t;for(var r in this)typeof this[r]!="function"&&(e[r]=this[r]);return e}}(t.prototype=n("./object")).loadAsync=n("./load"),t.support=n("./support"),t.defaults=n("./defaults"),t.version="3.10.1",t.loadAsync=function(e,r){return new t().loadAsync(e,r)},t.external=n("./external"),o.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,o,s){var t=n("./utils"),e=n("./external"),r=n("./utf8"),l=n("./zipEntries"),u=n("./stream/Crc32Probe"),v=n("./nodejsUtils");function f(d){return new e.Promise(function(a,m){var h=d.decompressed.getContentWorker().pipe(new u);h.on("error",function(y){m(y)}).on("end",function(){h.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):a()}).resume()})}o.exports=function(d,a){var m=this;return a=t.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),v.isNode&&v.isStream(d)?e.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",d,!0,a.optimizedBinaryString,a.base64).then(function(h){var y=new l(a);return y.load(h),y}).then(function(h){var y=[e.Promise.resolve(h)],b=h.files;if(a.checkCRC32)for(var x=0;x<b.length;x++)y.push(f(b[x]));return e.Promise.all(y)}).then(function(h){for(var y=h.shift(),b=y.files,x=0;x<b.length;x++){var C=b[x],j=C.fileNameStr,A=t.resolve(C.fileNameStr);m.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:a.createFolders}),C.dir||(m.file(A).unsafeOriginalName=j)}return y.zipComment.length&&(m.comment=y.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,o,s){var t=n("../utils"),e=n("../stream/GenericWorker");function r(l,u){e.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}t.inherits(r,e),r.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(v){u.push({data:v,meta:{percent:0}})}).on("error",function(v){u.isPaused?this.generatedError=v:u.error(v)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},r.prototype.pause=function(){return!!e.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},o.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,o,s){var t=n("readable-stream").Readable;function e(r,l,u){t.call(this,l),this._helper=r;var v=this;r.on("data",function(f,d){v.push(f)||v._helper.pause(),u&&u(d)}).on("error",function(f){v.emit("error",f)}).on("end",function(){v.push(null)})}n("../utils").inherits(e,t),e.prototype._read=function(){this._helper.resume()},o.exports=e},{"../utils":32,"readable-stream":16}],14:[function(n,o,s){o.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(n,o,s){function t(A,M,O){var N,R=r.getTypeOf(M),F=r.extend(O||{},v);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(A=b(A)),F.createFolders&&(N=y(A))&&x.call(this,N,!0);var G=R==="string"&&F.binary===!1&&F.base64===!1;O&&O.binary!==void 0||(F.binary=!G),(M instanceof f&&M.uncompressedSize===0||F.dir||!M||M.length===0)&&(F.base64=!1,F.binary=!0,M="",F.compression="STORE",R="string");var w=null;w=M instanceof f||M instanceof l?M:m.isNode&&m.isStream(M)?new h(A,M):r.prepareContent(A,M,F.binary,F.optimizedBinaryString,F.base64);var T=new d(A,w,F);this.files[A]=T}var e=n("./utf8"),r=n("./utils"),l=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),v=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),a=n("./generate"),m=n("./nodejsUtils"),h=n("./nodejs/NodejsStreamInputAdapter"),y=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var M=A.lastIndexOf("/");return 0<M?A.substring(0,M):""},b=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,M){return M=M!==void 0?M:v.createFolders,A=b(A),this.files[A]||t.call(this,A,null,{dir:!0,createFolders:M}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var M,O,N;for(M in this.files)N=this.files[M],(O=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&A(O,N)},filter:function(A){var M=[];return this.forEach(function(O,N){A(O,N)&&M.push(N)}),M},file:function(A,M,O){if(arguments.length!==1)return A=this.root+A,t.call(this,A,M,O),this;if(C(A)){var N=A;return this.filter(function(F,G){return!G.dir&&N.test(F)})}var R=this.files[this.root+A];return R&&!R.dir?R:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(R,F){return F.dir&&A.test(R)});var M=this.root+A,O=x.call(this,M),N=this.clone();return N.root=O.name,N},remove:function(A){A=this.root+A;var M=this.files[A];if(M||(A.slice(-1)!=="/"&&(A+="/"),M=this.files[A]),M&&!M.dir)delete this.files[A];else for(var O=this.filter(function(R,F){return F.name.slice(0,A.length)===A}),N=0;N<O.length;N++)delete this.files[O[N].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var M,O={};try{if((O=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");r.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var N=O.comment||this.comment||"";M=a.generateWorker(this,O,N)}catch(R){(M=new l("error")).error(R)}return new u(M,O.type||"string",O.mimeType)},generateAsync:function(A,M){return this.generateInternalStream(A).accumulate(M)},generateNodeStream:function(A,M){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(M)}};o.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,o,s){o.exports=n("stream")},{stream:void 0}],17:[function(n,o,s){var t=n("./DataReader");function e(r){t.call(this,r);for(var l=0;l<this.data.length;l++)r[l]=255&r[l]}n("../utils").inherits(e,t),e.prototype.byteAt=function(r){return this.data[this.zero+r]},e.prototype.lastIndexOfSignature=function(r){for(var l=r.charCodeAt(0),u=r.charCodeAt(1),v=r.charCodeAt(2),f=r.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===u&&this.data[d+2]===v&&this.data[d+3]===f)return d-this.zero;return-1},e.prototype.readAndCheckSignature=function(r){var l=r.charCodeAt(0),u=r.charCodeAt(1),v=r.charCodeAt(2),f=r.charCodeAt(3),d=this.readData(4);return l===d[0]&&u===d[1]&&v===d[2]&&f===d[3]},e.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},o.exports=e},{"../utils":32,"./DataReader":18}],18:[function(n,o,s){var t=n("../utils");function e(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}e.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var l,u=0;for(this.checkOffset(r),l=this.index+r-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=r,u},readString:function(r){return t.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},o.exports=e},{"../utils":32}],19:[function(n,o,s){var t=n("./Uint8ArrayReader");function e(r){t.call(this,r)}n("../utils").inherits(e,t),e.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},o.exports=e},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,o,s){var t=n("./DataReader");function e(r){t.call(this,r)}n("../utils").inherits(e,t),e.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},e.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},e.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},e.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},o.exports=e},{"../utils":32,"./DataReader":18}],21:[function(n,o,s){var t=n("./ArrayReader");function e(r){t.call(this,r)}n("../utils").inherits(e,t),e.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},o.exports=e},{"../utils":32,"./ArrayReader":17}],22:[function(n,o,s){var t=n("../utils"),e=n("../support"),r=n("./ArrayReader"),l=n("./StringReader"),u=n("./NodeBufferReader"),v=n("./Uint8ArrayReader");o.exports=function(f){var d=t.getTypeOf(f);return t.checkSupport(d),d!=="string"||e.uint8array?d==="nodebuffer"?new u(f):e.uint8array?new v(t.transformTo("uint8array",f)):new r(t.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,o,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,o,s){var t=n("./GenericWorker"),e=n("../utils");function r(l){t.call(this,"ConvertWorker to "+l),this.destType=l}e.inherits(r,t),r.prototype.processChunk=function(l){this.push({data:e.transformTo(this.destType,l.data),meta:l.meta})},o.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(n,o,s){var t=n("./GenericWorker"),e=n("../crc32");function r(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(r,t),r.prototype.processChunk=function(l){this.streamInfo.crc32=e(l.data,this.streamInfo.crc32||0),this.push(l)},o.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,o,s){var t=n("../utils"),e=n("./GenericWorker");function r(l){e.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}t.inherits(r,e),r.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}e.prototype.processChunk.call(this,l)},o.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(n,o,s){var t=n("../utils"),e=n("./GenericWorker");function r(l){e.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(v){u.dataIsReady=!0,u.data=v,u.max=v&&v.length||0,u.type=t.getTypeOf(v),u.isPaused||u._tickAndRepeat()},function(v){u.error(v)})}t.inherits(r,e),r.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},o.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(n,o,s){function t(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,r){return this._listeners[e].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,r){if(this._listeners[e])for(var l=0;l<this._listeners[e].length;l++)this._listeners[e][l].call(this,r)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var r=this;return e.on("data",function(l){r.processChunk(l)}),e.on("end",function(){r.end()}),e.on("error",function(l){r.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,r){return this.extraStreamInfo[e]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},o.exports=t},{}],29:[function(n,o,s){var t=n("../utils"),e=n("./ConvertWorker"),r=n("./GenericWorker"),l=n("../base64"),u=n("../support"),v=n("../external"),f=null;if(u.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch(m){}function d(m,h){return new v.Promise(function(y,b){var x=[],C=m._internalType,j=m._outputType,A=m._mimeType;m.on("data",function(M,O){x.push(M),h&&h(O)}).on("error",function(M){x=[],b(M)}).on("end",function(){try{var M=function(O,N,R){switch(O){case"blob":return t.newBlob(t.transformTo("arraybuffer",N),R);case"base64":return l.encode(N);default:return t.transformTo(O,N)}}(j,function(O,N){var R,F=0,G=null,w=0;for(R=0;R<N.length;R++)w+=N[R].length;switch(O){case"string":return N.join("");case"array":return Array.prototype.concat.apply([],N);case"uint8array":for(G=new Uint8Array(w),R=0;R<N.length;R++)G.set(N[R],F),F+=N[R].length;return G;case"nodebuffer":return Buffer.concat(N);default:throw new Error("concat : unsupported type '"+O+"'")}}(C,x),A);y(M)}catch(O){b(O)}x=[]}).resume()})}function a(m,h,y){var b=h;switch(h){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=h,this._mimeType=y,t.checkSupport(b),this._worker=m.pipe(new e(b)),m.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}a.prototype={accumulate:function(m){return d(this,m)},on:function(m,h){var y=this;return m==="data"?this._worker.on(m,function(b){h.call(y,b.data,b.meta)}):this._worker.on(m,function(){t.delay(h,arguments,y)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},o.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,o,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var t=new ArrayBuffer(0);try{s.blob=new Blob([t],{type:"application/zip"}).size===0}catch(r){try{var e=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);e.append(t),s.blob=e.getBlob("application/zip").size===0}catch(l){s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch(r){s.nodestream=!1}},{"readable-stream":16}],31:[function(n,o,s){for(var t=n("./utils"),e=n("./support"),r=n("./nodejsUtils"),l=n("./stream/GenericWorker"),u=new Array(256),v=0;v<256;v++)u[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;u[254]=u[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}s.utf8encode=function(a){return e.nodebuffer?r.newBufferFrom(a,"utf-8"):function(m){var h,y,b,x,C,j=m.length,A=0;for(x=0;x<j;x++)(64512&(y=m.charCodeAt(x)))==55296&&x+1<j&&(64512&(b=m.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),x++),A+=y<128?1:y<2048?2:y<65536?3:4;for(h=e.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(y=m.charCodeAt(x)))==55296&&x+1<j&&(64512&(b=m.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),x++),y<128?h[C++]=y:(y<2048?h[C++]=192|y>>>6:(y<65536?h[C++]=224|y>>>12:(h[C++]=240|y>>>18,h[C++]=128|y>>>12&63),h[C++]=128|y>>>6&63),h[C++]=128|63&y);return h}(a)},s.utf8decode=function(a){return e.nodebuffer?t.transformTo("nodebuffer",a).toString("utf-8"):function(m){var h,y,b,x,C=m.length,j=new Array(2*C);for(h=y=0;h<C;)if((b=m[h++])<128)j[y++]=b;else if(4<(x=u[b]))j[y++]=65533,h+=x-1;else{for(b&=x===2?31:x===3?15:7;1<x&&h<C;)b=b<<6|63&m[h++],x--;1<x?j[y++]=65533:b<65536?j[y++]=b:(b-=65536,j[y++]=55296|b>>10&1023,j[y++]=56320|1023&b)}return j.length!==y&&(j.subarray?j=j.subarray(0,y):j.length=y),t.applyFromCharCode(j)}(a=t.transformTo(e.uint8array?"uint8array":"array",a))},t.inherits(f,l),f.prototype.processChunk=function(a){var m=t.transformTo(e.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(e.uint8array){var h=m;(m=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),m.set(h,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var y=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+u[x[j]]>C?j:C}(m),b=m;y!==m.length&&(e.uint8array?(b=m.subarray(0,y),this.leftOver=m.subarray(y,m.length)):(b=m.slice(0,y),this.leftOver=m.slice(y,m.length))),this.push({data:s.utf8decode(b),meta:a.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=f,t.inherits(d,l),d.prototype.processChunk=function(a){this.push({data:s.utf8encode(a.data),meta:a.meta})},s.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,o,s){var t=n("./support"),e=n("./base64"),r=n("./nodejsUtils"),l=n("./external");function u(h){return h}function v(h,y){for(var b=0;b<h.length;++b)y[b]=255&h.charCodeAt(b);return y}n("setimmediate"),s.newBlob=function(h,y){s.checkSupport("blob");try{return new Blob([h],{type:y})}catch(x){try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(h),b.getBlob(y)}catch(C){throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(h,y,b){var x=[],C=0,j=h.length;if(j<=b)return String.fromCharCode.apply(null,h);for(;C<j;)y==="array"||y==="nodebuffer"?x.push(String.fromCharCode.apply(null,h.slice(C,Math.min(C+b,j)))):x.push(String.fromCharCode.apply(null,h.subarray(C,Math.min(C+b,j)))),C+=b;return x.join("")},stringifyByChar:function(h){for(var y="",b=0;b<h.length;b++)y+=String.fromCharCode(h[b]);return y},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(h){return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch(h){return!1}}()}};function d(h){var y=65536,b=s.getTypeOf(h),x=!0;if(b==="uint8array"?x=f.applyCanBeUsed.uint8array:b==="nodebuffer"&&(x=f.applyCanBeUsed.nodebuffer),x)for(;1<y;)try{return f.stringifyByChunk(h,b,y)}catch(C){y=Math.floor(y/2)}return f.stringifyByChar(h)}function a(h,y){for(var b=0;b<h.length;b++)y[b]=h[b];return y}s.applyFromCharCode=d;var m={};m.string={string:u,array:function(h){return v(h,new Array(h.length))},arraybuffer:function(h){return m.string.uint8array(h).buffer},uint8array:function(h){return v(h,new Uint8Array(h.length))},nodebuffer:function(h){return v(h,r.allocBuffer(h.length))}},m.array={string:d,array:u,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return r.newBufferFrom(h)}},m.arraybuffer={string:function(h){return d(new Uint8Array(h))},array:function(h){return a(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:u,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return r.newBufferFrom(new Uint8Array(h))}},m.uint8array={string:d,array:function(h){return a(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:u,nodebuffer:function(h){return r.newBufferFrom(h)}},m.nodebuffer={string:d,array:function(h){return a(h,new Array(h.length))},arraybuffer:function(h){return m.nodebuffer.uint8array(h).buffer},uint8array:function(h){return a(h,new Uint8Array(h.length))},nodebuffer:u},s.transformTo=function(h,y){if(y=y||"",!h)return y;s.checkSupport(h);var b=s.getTypeOf(y);return m[b][h](y)},s.resolve=function(h){for(var y=h.split("/"),b=[],x=0;x<y.length;x++){var C=y[x];C==="."||C===""&&x!==0&&x!==y.length-1||(C===".."?b.pop():b.push(C))}return b.join("/")},s.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":t.nodebuffer&&r.isBuffer(h)?"nodebuffer":t.uint8array&&h instanceof Uint8Array?"uint8array":t.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(h){if(!t[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(h){var y,b,x="";for(b=0;b<(h||"").length;b++)x+="\\x"+((y=h.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return x},s.delay=function(h,y,b){setImmediate(function(){h.apply(b||null,y||[])})},s.inherits=function(h,y){function b(){}b.prototype=y.prototype,h.prototype=new b},s.extend=function(){var h,y,b={};for(h=0;h<arguments.length;h++)for(y in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],y)&&b[y]===void 0&&(b[y]=arguments[h][y]);return b},s.prepareContent=function(h,y,b,x,C){return l.Promise.resolve(y).then(function(j){return t.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new l.Promise(function(A,M){var O=new FileReader;O.onload=function(N){A(N.target.result)},O.onerror=function(N){M(N.target.error)},O.readAsArrayBuffer(j)}):j}).then(function(j){var A=s.getTypeOf(j);return A?(A==="arraybuffer"?j=s.transformTo("uint8array",j):A==="string"&&(C?j=e.decode(j):b&&x!==!0&&(j=function(M){return v(M,t.uint8array?new Uint8Array(M.length):new Array(M.length))}(j))),j):l.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,o,s){var t=n("./reader/readerFor"),e=n("./utils"),r=n("./signature"),l=n("./zipEntry"),u=n("./support");function v(f){this.files=[],this.loadOptions=f}v.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+e.pretty(d)+", expected "+e.pretty(f)+")")}},isSignature:function(f,d){var a=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(a),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",a=e.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,a,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),a=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:a}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===e.MAX_VALUE_16BITS||this.diskWithCentralDirStart===e.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===e.MAX_VALUE_16BITS||this.centralDirRecords===e.MAX_VALUE_16BITS||this.centralDirSize===e.MAX_VALUE_32BITS||this.centralDirOffset===e.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a+=20,a+=12+this.zip64EndOfCentralSize);var m=d-a;if(0<m)this.isSignature(d,r.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=t(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},o.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,o,s){var t=n("./reader/readerFor"),e=n("./utils"),r=n("./compressedObject"),l=n("./crc32"),u=n("./utf8"),v=n("./compressions"),f=n("./support");function d(a,m){this.options=a,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(a){var m,h;if(a.skip(22),this.fileNameLength=a.readInt(2),h=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(y){for(var b in v)if(Object.prototype.hasOwnProperty.call(v,b)&&v[b].magic===y)return v[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+e.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,m,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var m=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(m),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a==0&&(this.dosPermissions=63&this.externalFileAttributes),a==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=t(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var m,h,y,b=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index+4<b;)m=a.readInt(2),h=a.readInt(2),y=a.readData(h),this.extraFields[m]={id:m,length:h,value:y};a.setIndex(b)},handleUTF8:function(){var a=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var h=e.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=e.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var m=t(a.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:u.utf8decode(m.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var m=t(a.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:u.utf8decode(m.readData(a.length-5))}return null}},o.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,o,s){function t(m,h,y){this.name=m,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=h,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var e=n("./stream/StreamHelper"),r=n("./stream/DataWorker"),l=n("./utf8"),u=n("./compressedObject"),v=n("./stream/GenericWorker");t.prototype={internalStream:function(m){var h=null,y="string";try{if(!m)throw new Error("No output type specified.");var b=(y=m.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),h=this._decompressWorker();var x=!this._dataBinary;x&&!b&&(h=h.pipe(new l.Utf8EncodeWorker)),!x&&b&&(h=h.pipe(new l.Utf8DecodeWorker))}catch(C){(h=new v("error")).error(C)}return new e(h,y,"")},async:function(m,h){return this.internalStream(m).accumulate(h)},nodeStream:function(m,h){return this.internalStream(m||"nodebuffer").toNodejsStream(h)},_compressWorker:function(m,h){if(this._data instanceof u&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(y,m,h)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof v?this._data:new r(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},a=0;a<f.length;a++)t.prototype[f[a]]=d;o.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,o,s){(function(t){var e,r,l=t.MutationObserver||t.WebKitMutationObserver;if(l){var u=0,v=new l(m),f=t.document.createTextNode("");v.observe(f,{characterData:!0}),e=function(){f.data=u=++u%2}}else if(t.setImmediate||t.MessageChannel===void 0)e="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var h=t.document.createElement("script");h.onreadystatechange=function(){m(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},t.document.documentElement.appendChild(h)}:function(){setTimeout(m,0)};else{var d=new t.MessageChannel;d.port1.onmessage=m,e=function(){d.port2.postMessage(0)}}var a=[];function m(){var h,y;r=!0;for(var b=a.length;b;){for(y=a,a=[],h=-1;++h<b;)y[h]();b=a.length}r=!1}o.exports=function(h){a.push(h)!==1||r||e()}}).call(this,typeof st<"u"?st:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,o,s){var t=n("immediate");function e(){}var r={},l=["REJECTED"],u=["FULFILLED"],v=["PENDING"];function f(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,b!==e&&h(this,b)}function d(b,x,C){this.promise=b,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function a(b,x,C){t(function(){var j;try{j=x(C)}catch(A){return r.reject(b,A)}j===b?r.reject(b,new TypeError("Cannot resolve promise with itself")):r.resolve(b,j)})}function m(b){var x=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof x=="function")return function(){x.apply(b,arguments)}}function h(b,x){var C=!1;function j(O){C||(C=!0,r.reject(b,O))}function A(O){C||(C=!0,r.resolve(b,O))}var M=y(function(){x(A,j)});M.status==="error"&&j(M.value)}function y(b,x){var C={};try{C.value=b(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(o.exports=f).prototype.finally=function(b){if(typeof b!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(b()).then(function(){return C})},function(C){return x.resolve(b()).then(function(){throw C})})},f.prototype.catch=function(b){return this.then(null,b)},f.prototype.then=function(b,x){if(typeof b!="function"&&this.state===u||typeof x!="function"&&this.state===l)return this;var C=new this.constructor(e);return this.state!==v?a(C,this.state===u?b:x,this.outcome):this.queue.push(new d(C,b,x)),C},d.prototype.callFulfilled=function(b){r.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){a(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){r.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){a(this.promise,this.onRejected,b)},r.resolve=function(b,x){var C=y(m,x);if(C.status==="error")return r.reject(b,C.value);var j=C.value;if(j)h(b,j);else{b.state=u,b.outcome=x;for(var A=-1,M=b.queue.length;++A<M;)b.queue[A].callFulfilled(x)}return b},r.reject=function(b,x){b.state=l,b.outcome=x;for(var C=-1,j=b.queue.length;++C<j;)b.queue[C].callRejected(x);return b},f.resolve=function(b){return b instanceof this?b:r.resolve(new this(e),b)},f.reject=function(b){var x=new this(e);return r.reject(x,b)},f.all=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=b.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),M=0,O=-1,N=new this(e);++O<C;)R(b[O],O);return N;function R(F,G){x.resolve(F).then(function(w){A[G]=w,++M!==C||j||(j=!0,r.resolve(N,A))},function(w){j||(j=!0,r.reject(N,w))})}},f.race=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=b.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,M=new this(e);++A<C;)O=b[A],x.resolve(O).then(function(N){j||(j=!0,r.resolve(M,N))},function(N){j||(j=!0,r.reject(M,N))});var O;return M}},{immediate:36}],38:[function(n,o,s){var t={};(0,n("./lib/utils/common").assign)(t,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),o.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,o,s){var t=n("./zlib/deflate"),e=n("./utils/common"),r=n("./utils/strings"),l=n("./zlib/messages"),u=n("./zlib/zstream"),v=Object.prototype.toString,f=0,d=-1,a=0,m=8;function h(b){if(!(this instanceof h))return new h(b);this.options=e.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:a,to:""},b||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=t.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==f)throw new Error(l[C]);if(x.header&&t.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?r.string2buf(x.dictionary):v.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=t.deflateSetDictionary(this.strm,j))!==f)throw new Error(l[C]);this._dict_set=!0}}function y(b,x){var C=new h(x);if(C.push(b,!0),C.err)throw C.msg||l[C.err];return C.result}h.prototype.push=function(b,x){var C,j,A=this.strm,M=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof b=="string"?A.input=r.string2buf(b):v.call(b)==="[object ArrayBuffer]"?A.input=new Uint8Array(b):A.input=b,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new e.Buf8(M),A.next_out=0,A.avail_out=M),(C=t.deflate(A,j))!==1&&C!==f)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(e.shrinkBuf(A.output,A.next_out))):this.onData(e.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=t.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===f):j!==2||(this.onEnd(f),!(A.avail_out=0))},h.prototype.onData=function(b){this.chunks.push(b)},h.prototype.onEnd=function(b){b===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},s.Deflate=h,s.deflate=y,s.deflateRaw=function(b,x){return(x=x||{}).raw=!0,y(b,x)},s.gzip=function(b,x){return(x=x||{}).gzip=!0,y(b,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,o,s){var t=n("./zlib/inflate"),e=n("./utils/common"),r=n("./utils/strings"),l=n("./zlib/constants"),u=n("./zlib/messages"),v=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function a(h){if(!(this instanceof a))return new a(h);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},h||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||h&&h.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var b=t.inflateInit2(this.strm,y.windowBits);if(b!==l.Z_OK)throw new Error(u[b]);this.header=new f,t.inflateGetHeader(this.strm,this.header)}function m(h,y){var b=new a(y);if(b.push(h,!0),b.err)throw b.msg||u[b.err];return b.result}a.prototype.push=function(h,y){var b,x,C,j,A,M,O=this.strm,N=this.options.chunkSize,R=this.options.dictionary,F=!1;if(this.ended)return!1;x=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof h=="string"?O.input=r.binstring2buf(h):d.call(h)==="[object ArrayBuffer]"?O.input=new Uint8Array(h):O.input=h,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new e.Buf8(N),O.next_out=0,O.avail_out=N),(b=t.inflate(O,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&R&&(M=typeof R=="string"?r.string2buf(R):d.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,b=t.inflateSetDictionary(this.strm,M)),b===l.Z_BUF_ERROR&&F===!0&&(b=l.Z_OK,F=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&b!==l.Z_STREAM_END&&(O.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=r.utf8border(O.output,O.next_out),j=O.next_out-C,A=r.buf2string(O.output,C),O.next_out=j,O.avail_out=N-j,j&&e.arraySet(O.output,O.output,C,j,0),this.onData(A)):this.onData(e.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(F=!0)}while((0<O.avail_in||O.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(b=t.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(O.avail_out=0))},a.prototype.onData=function(h){this.chunks.push(h)},a.prototype.onEnd=function(h){h===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},s.Inflate=a,s.inflate=m,s.inflateRaw=function(h,y){return(y=y||{}).raw=!0,m(h,y)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,o,s){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var v=u.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var f in v)v.hasOwnProperty(f)&&(l[f]=v[f])}}return l},s.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var e={arraySet:function(l,u,v,f,d){if(u.subarray&&l.subarray)l.set(u.subarray(v,v+f),d);else for(var a=0;a<f;a++)l[d+a]=u[v+a]},flattenChunks:function(l){var u,v,f,d,a,m;for(u=f=0,v=l.length;u<v;u++)f+=l[u].length;for(m=new Uint8Array(f),u=d=0,v=l.length;u<v;u++)a=l[u],m.set(a,d),d+=a.length;return m}},r={arraySet:function(l,u,v,f,d){for(var a=0;a<f;a++)l[d+a]=u[v+a]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,e)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,r))},s.setTyped(t)},{}],42:[function(n,o,s){var t=n("./common"),e=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(f){e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(f){r=!1}for(var l=new t.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function v(f,d){if(d<65537&&(f.subarray&&r||!f.subarray&&e))return String.fromCharCode.apply(null,t.shrinkBuf(f,d));for(var a="",m=0;m<d;m++)a+=String.fromCharCode(f[m]);return a}l[254]=l[254]=1,s.string2buf=function(f){var d,a,m,h,y,b=f.length,x=0;for(h=0;h<b;h++)(64512&(a=f.charCodeAt(h)))==55296&&h+1<b&&(64512&(m=f.charCodeAt(h+1)))==56320&&(a=65536+(a-55296<<10)+(m-56320),h++),x+=a<128?1:a<2048?2:a<65536?3:4;for(d=new t.Buf8(x),h=y=0;y<x;h++)(64512&(a=f.charCodeAt(h)))==55296&&h+1<b&&(64512&(m=f.charCodeAt(h+1)))==56320&&(a=65536+(a-55296<<10)+(m-56320),h++),a<128?d[y++]=a:(a<2048?d[y++]=192|a>>>6:(a<65536?d[y++]=224|a>>>12:(d[y++]=240|a>>>18,d[y++]=128|a>>>12&63),d[y++]=128|a>>>6&63),d[y++]=128|63&a);return d},s.buf2binstring=function(f){return v(f,f.length)},s.binstring2buf=function(f){for(var d=new t.Buf8(f.length),a=0,m=d.length;a<m;a++)d[a]=f.charCodeAt(a);return d},s.buf2string=function(f,d){var a,m,h,y,b=d||f.length,x=new Array(2*b);for(a=m=0;a<b;)if((h=f[a++])<128)x[m++]=h;else if(4<(y=l[h]))x[m++]=65533,a+=y-1;else{for(h&=y===2?31:y===3?15:7;1<y&&a<b;)h=h<<6|63&f[a++],y--;1<y?x[m++]=65533:h<65536?x[m++]=h:(h-=65536,x[m++]=55296|h>>10&1023,x[m++]=56320|1023&h)}return v(x,m)},s.utf8border=function(f,d){var a;for((d=d||f.length)>f.length&&(d=f.length),a=d-1;0<=a&&(192&f[a])==128;)a--;return a<0||a===0?d:a+l[f[a]]>d?a:d}},{"./common":41}],43:[function(n,o,s){o.exports=function(t,e,r,l){for(var u=65535&t|0,v=t>>>16&65535|0,f=0;r!==0;){for(r-=f=2e3<r?2e3:r;v=v+(u=u+e[l++]|0)|0,--f;);u%=65521,v%=65521}return u|v<<16|0}},{}],44:[function(n,o,s){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,o,s){var t=function(){for(var e,r=[],l=0;l<256;l++){e=l;for(var u=0;u<8;u++)e=1&e?3988292384^e>>>1:e>>>1;r[l]=e}return r}();o.exports=function(e,r,l,u){var v=t,f=u+l;e^=-1;for(var d=u;d<f;d++)e=e>>>8^v[255&(e^r[d])];return-1^e}},{}],46:[function(n,o,s){var t,e=n("../utils/common"),r=n("./trees"),l=n("./adler32"),u=n("./crc32"),v=n("./messages"),f=0,d=4,a=0,m=-2,h=-1,y=4,b=2,x=8,C=9,j=286,A=30,M=19,O=2*j+1,N=15,R=3,F=258,G=F+R+1,w=42,T=113,c=1,D=2,ne=3,Z=4;function ie(i,L){return i.msg=v[L],L}function H(i){return(i<<1)-(4<i?9:0)}function re(i){for(var L=i.length;0<=--L;)i[L]=0}function I(i){var L=i.state,B=L.pending;B>i.avail_out&&(B=i.avail_out),B!==0&&(e.arraySet(i.output,L.pending_buf,L.pending_out,B,i.next_out),i.next_out+=B,L.pending_out+=B,i.total_out+=B,i.avail_out-=B,L.pending-=B,L.pending===0&&(L.pending_out=0))}function P(i,L){r._tr_flush_block(i,0<=i.block_start?i.block_start:-1,i.strstart-i.block_start,L),i.block_start=i.strstart,I(i.strm)}function te(i,L){i.pending_buf[i.pending++]=L}function q(i,L){i.pending_buf[i.pending++]=L>>>8&255,i.pending_buf[i.pending++]=255&L}function Y(i,L){var B,k,S=i.max_chain_length,E=i.strstart,U=i.prev_length,W=i.nice_match,z=i.strstart>i.w_size-G?i.strstart-(i.w_size-G):0,V=i.window,K=i.w_mask,$=i.prev,ee=i.strstart+F,he=V[E+U-1],ae=V[E+U];i.prev_length>=i.good_match&&(S>>=2),W>i.lookahead&&(W=i.lookahead);do if(V[(B=L)+U]===ae&&V[B+U-1]===he&&V[B]===V[E]&&V[++B]===V[E+1]){E+=2,B++;do;while(V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&V[++E]===V[++B]&&E<ee);if(k=F-(ee-E),E=ee-F,U<k){if(i.match_start=L,W<=(U=k))break;he=V[E+U-1],ae=V[E+U]}}while((L=$[L&K])>z&&--S!=0);return U<=i.lookahead?U:i.lookahead}function fe(i){var L,B,k,S,E,U,W,z,V,K,$=i.w_size;do{if(S=i.window_size-i.lookahead-i.strstart,i.strstart>=$+($-G)){for(e.arraySet(i.window,i.window,$,$,0),i.match_start-=$,i.strstart-=$,i.block_start-=$,L=B=i.hash_size;k=i.head[--L],i.head[L]=$<=k?k-$:0,--B;);for(L=B=$;k=i.prev[--L],i.prev[L]=$<=k?k-$:0,--B;);S+=$}if(i.strm.avail_in===0)break;if(U=i.strm,W=i.window,z=i.strstart+i.lookahead,V=S,K=void 0,K=U.avail_in,V<K&&(K=V),B=K===0?0:(U.avail_in-=K,e.arraySet(W,U.input,U.next_in,K,z),U.state.wrap===1?U.adler=l(U.adler,W,K,z):U.state.wrap===2&&(U.adler=u(U.adler,W,K,z)),U.next_in+=K,U.total_in+=K,K),i.lookahead+=B,i.lookahead+i.insert>=R)for(E=i.strstart-i.insert,i.ins_h=i.window[E],i.ins_h=(i.ins_h<<i.hash_shift^i.window[E+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[E+R-1])&i.hash_mask,i.prev[E&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=E,E++,i.insert--,!(i.lookahead+i.insert<R)););}while(i.lookahead<G&&i.strm.avail_in!==0)}function _e(i,L){for(var B,k;;){if(i.lookahead<G){if(fe(i),i.lookahead<G&&L===f)return c;if(i.lookahead===0)break}if(B=0,i.lookahead>=R&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+R-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),B!==0&&i.strstart-B<=i.w_size-G&&(i.match_length=Y(i,B)),i.match_length>=R)if(k=r._tr_tally(i,i.strstart-i.match_start,i.match_length-R),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=R){for(i.match_length--;i.strstart++,i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+R-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart,--i.match_length!=0;);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+1])&i.hash_mask;else k=r._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(k&&(P(i,!1),i.strm.avail_out===0))return c}return i.insert=i.strstart<R-1?i.strstart:R-1,L===d?(P(i,!0),i.strm.avail_out===0?ne:Z):i.last_lit&&(P(i,!1),i.strm.avail_out===0)?c:D}function se(i,L){for(var B,k,S;;){if(i.lookahead<G){if(fe(i),i.lookahead<G&&L===f)return c;if(i.lookahead===0)break}if(B=0,i.lookahead>=R&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+R-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=R-1,B!==0&&i.prev_length<i.max_lazy_match&&i.strstart-B<=i.w_size-G&&(i.match_length=Y(i,B),i.match_length<=5&&(i.strategy===1||i.match_length===R&&4096<i.strstart-i.match_start)&&(i.match_length=R-1)),i.prev_length>=R&&i.match_length<=i.prev_length){for(S=i.strstart+i.lookahead-R,k=r._tr_tally(i,i.strstart-1-i.prev_match,i.prev_length-R),i.lookahead-=i.prev_length-1,i.prev_length-=2;++i.strstart<=S&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+R-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),--i.prev_length!=0;);if(i.match_available=0,i.match_length=R-1,i.strstart++,k&&(P(i,!1),i.strm.avail_out===0))return c}else if(i.match_available){if((k=r._tr_tally(i,0,i.window[i.strstart-1]))&&P(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return c}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(k=r._tr_tally(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<R-1?i.strstart:R-1,L===d?(P(i,!0),i.strm.avail_out===0?ne:Z):i.last_lit&&(P(i,!1),i.strm.avail_out===0)?c:D}function oe(i,L,B,k,S){this.good_length=i,this.max_lazy=L,this.nice_length=B,this.max_chain=k,this.func=S}function ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new e.Buf16(2*O),this.dyn_dtree=new e.Buf16(2*(2*A+1)),this.bl_tree=new e.Buf16(2*(2*M+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new e.Buf16(N+1),this.heap=new e.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new e.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(i){var L;return i&&i.state?(i.total_in=i.total_out=0,i.data_type=b,(L=i.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?w:T,i.adler=L.wrap===2?0:1,L.last_flush=f,r._tr_init(L),a):ie(i,m)}function Ce(i){var L=pe(i);return L===a&&function(B){B.window_size=2*B.w_size,re(B.head),B.max_lazy_match=t[B.level].max_lazy,B.good_match=t[B.level].good_length,B.nice_match=t[B.level].nice_length,B.max_chain_length=t[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=R-1,B.match_available=0,B.ins_h=0}(i.state),L}function ke(i,L,B,k,S,E){if(!i)return m;var U=1;if(L===h&&(L=6),k<0?(U=0,k=-k):15<k&&(U=2,k-=16),S<1||C<S||B!==x||k<8||15<k||L<0||9<L||E<0||y<E)return ie(i,m);k===8&&(k=9);var W=new ge;return(i.state=W).strm=i,W.wrap=U,W.gzhead=null,W.w_bits=k,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+R-1)/R),W.window=new e.Buf8(2*W.w_size),W.head=new e.Buf16(W.hash_size),W.prev=new e.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new e.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=L,W.strategy=E,W.method=B,Ce(i)}t=[new oe(0,0,0,0,function(i,L){var B=65535;for(B>i.pending_buf_size-5&&(B=i.pending_buf_size-5);;){if(i.lookahead<=1){if(fe(i),i.lookahead===0&&L===f)return c;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;var k=i.block_start+B;if((i.strstart===0||i.strstart>=k)&&(i.lookahead=i.strstart-k,i.strstart=k,P(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-G&&(P(i,!1),i.strm.avail_out===0))return c}return i.insert=0,L===d?(P(i,!0),i.strm.avail_out===0?ne:Z):(i.strstart>i.block_start&&(P(i,!1),i.strm.avail_out),c)}),new oe(4,4,8,4,_e),new oe(4,5,16,8,_e),new oe(4,6,32,32,_e),new oe(4,4,16,16,se),new oe(8,16,32,32,se),new oe(8,16,128,128,se),new oe(8,32,128,256,se),new oe(32,128,258,1024,se),new oe(32,258,258,4096,se)],s.deflateInit=function(i,L){return ke(i,L,x,15,8,0)},s.deflateInit2=ke,s.deflateReset=Ce,s.deflateResetKeep=pe,s.deflateSetHeader=function(i,L){return i&&i.state?i.state.wrap!==2?m:(i.state.gzhead=L,a):m},s.deflate=function(i,L){var B,k,S,E;if(!i||!i.state||5<L||L<0)return i?ie(i,m):m;if(k=i.state,!i.output||!i.input&&i.avail_in!==0||k.status===666&&L!==d)return ie(i,i.avail_out===0?-5:m);if(k.strm=i,B=k.last_flush,k.last_flush=L,k.status===w)if(k.wrap===2)i.adler=0,te(k,31),te(k,139),te(k,8),k.gzhead?(te(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),te(k,255&k.gzhead.time),te(k,k.gzhead.time>>8&255),te(k,k.gzhead.time>>16&255),te(k,k.gzhead.time>>24&255),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(te(k,255&k.gzhead.extra.length),te(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(i.adler=u(i.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(te(k,0),te(k,0),te(k,0),te(k,0),te(k,0),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,3),k.status=T);else{var U=x+(k.w_bits-8<<4)<<8;U|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(U|=32),U+=31-U%31,k.status=T,q(k,U),k.strstart!==0&&(q(k,i.adler>>>16),q(k,65535&i.adler)),i.adler=1}if(k.status===69)if(k.gzhead.extra){for(S=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>S&&(i.adler=u(i.adler,k.pending_buf,k.pending-S,S)),I(i),S=k.pending,k.pending!==k.pending_buf_size));)te(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>S&&(i.adler=u(i.adler,k.pending_buf,k.pending-S,S)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){S=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>S&&(i.adler=u(i.adler,k.pending_buf,k.pending-S,S)),I(i),S=k.pending,k.pending===k.pending_buf_size)){E=1;break}E=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,te(k,E)}while(E!==0);k.gzhead.hcrc&&k.pending>S&&(i.adler=u(i.adler,k.pending_buf,k.pending-S,S)),E===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){S=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>S&&(i.adler=u(i.adler,k.pending_buf,k.pending-S,S)),I(i),S=k.pending,k.pending===k.pending_buf_size)){E=1;break}E=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,te(k,E)}while(E!==0);k.gzhead.hcrc&&k.pending>S&&(i.adler=u(i.adler,k.pending_buf,k.pending-S,S)),E===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&I(i),k.pending+2<=k.pending_buf_size&&(te(k,255&i.adler),te(k,i.adler>>8&255),i.adler=0,k.status=T)):k.status=T),k.pending!==0){if(I(i),i.avail_out===0)return k.last_flush=-1,a}else if(i.avail_in===0&&H(L)<=H(B)&&L!==d)return ie(i,-5);if(k.status===666&&i.avail_in!==0)return ie(i,-5);if(i.avail_in!==0||k.lookahead!==0||L!==f&&k.status!==666){var W=k.strategy===2?function(z,V){for(var K;;){if(z.lookahead===0&&(fe(z),z.lookahead===0)){if(V===f)return c;break}if(z.match_length=0,K=r._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,K&&(P(z,!1),z.strm.avail_out===0))return c}return z.insert=0,V===d?(P(z,!0),z.strm.avail_out===0?ne:Z):z.last_lit&&(P(z,!1),z.strm.avail_out===0)?c:D}(k,L):k.strategy===3?function(z,V){for(var K,$,ee,he,ae=z.window;;){if(z.lookahead<=F){if(fe(z),z.lookahead<=F&&V===f)return c;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=R&&0<z.strstart&&($=ae[ee=z.strstart-1])===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]){he=z.strstart+F;do;while($===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&$===ae[++ee]&&ee<he);z.match_length=F-(he-ee),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=R?(K=r._tr_tally(z,1,z.match_length-R),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(K=r._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),K&&(P(z,!1),z.strm.avail_out===0))return c}return z.insert=0,V===d?(P(z,!0),z.strm.avail_out===0?ne:Z):z.last_lit&&(P(z,!1),z.strm.avail_out===0)?c:D}(k,L):t[k.level].func(k,L);if(W!==ne&&W!==Z||(k.status=666),W===c||W===ne)return i.avail_out===0&&(k.last_flush=-1),a;if(W===D&&(L===1?r._tr_align(k):L!==5&&(r._tr_stored_block(k,0,0,!1),L===3&&(re(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),I(i),i.avail_out===0))return k.last_flush=-1,a}return L!==d?a:k.wrap<=0?1:(k.wrap===2?(te(k,255&i.adler),te(k,i.adler>>8&255),te(k,i.adler>>16&255),te(k,i.adler>>24&255),te(k,255&i.total_in),te(k,i.total_in>>8&255),te(k,i.total_in>>16&255),te(k,i.total_in>>24&255)):(q(k,i.adler>>>16),q(k,65535&i.adler)),I(i),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?a:1)},s.deflateEnd=function(i){var L;return i&&i.state?(L=i.state.status)!==w&&L!==69&&L!==73&&L!==91&&L!==103&&L!==T&&L!==666?ie(i,m):(i.state=null,L===T?ie(i,-3):a):m},s.deflateSetDictionary=function(i,L){var B,k,S,E,U,W,z,V,K=L.length;if(!i||!i.state||(E=(B=i.state).wrap)===2||E===1&&B.status!==w||B.lookahead)return m;for(E===1&&(i.adler=l(i.adler,L,K,0)),B.wrap=0,K>=B.w_size&&(E===0&&(re(B.head),B.strstart=0,B.block_start=0,B.insert=0),V=new e.Buf8(B.w_size),e.arraySet(V,L,K-B.w_size,B.w_size,0),L=V,K=B.w_size),U=i.avail_in,W=i.next_in,z=i.input,i.avail_in=K,i.next_in=0,i.input=L,fe(B);B.lookahead>=R;){for(k=B.strstart,S=B.lookahead-(R-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[k+R-1])&B.hash_mask,B.prev[k&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=k,k++,--S;);B.strstart=k,B.lookahead=R-1,fe(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=R-1,B.match_available=0,i.next_in=W,i.input=z,i.avail_in=U,B.wrap=E,a},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,o,s){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,o,s){o.exports=function(t,e){var r,l,u,v,f,d,a,m,h,y,b,x,C,j,A,M,O,N,R,F,G,w,T,c,D;r=t.state,l=t.next_in,c=t.input,u=l+(t.avail_in-5),v=t.next_out,D=t.output,f=v-(e-t.avail_out),d=v+(t.avail_out-257),a=r.dmax,m=r.wsize,h=r.whave,y=r.wnext,b=r.window,x=r.hold,C=r.bits,j=r.lencode,A=r.distcode,M=(1<<r.lenbits)-1,O=(1<<r.distbits)-1;e:do{C<15&&(x+=c[l++]<<C,C+=8,x+=c[l++]<<C,C+=8),N=j[x&M];t:for(;;){if(x>>>=R=N>>>24,C-=R,(R=N>>>16&255)===0)D[v++]=65535&N;else{if(!(16&R)){if(!(64&R)){N=j[(65535&N)+(x&(1<<R)-1)];continue t}if(32&R){r.mode=12;break e}t.msg="invalid literal/length code",r.mode=30;break e}F=65535&N,(R&=15)&&(C<R&&(x+=c[l++]<<C,C+=8),F+=x&(1<<R)-1,x>>>=R,C-=R),C<15&&(x+=c[l++]<<C,C+=8,x+=c[l++]<<C,C+=8),N=A[x&O];n:for(;;){if(x>>>=R=N>>>24,C-=R,!(16&(R=N>>>16&255))){if(!(64&R)){N=A[(65535&N)+(x&(1<<R)-1)];continue n}t.msg="invalid distance code",r.mode=30;break e}if(G=65535&N,C<(R&=15)&&(x+=c[l++]<<C,(C+=8)<R&&(x+=c[l++]<<C,C+=8)),a<(G+=x&(1<<R)-1)){t.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=R,C-=R,(R=v-f)<G){if(h<(R=G-R)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break e}if(T=b,(w=0)===y){if(w+=m-R,R<F){for(F-=R;D[v++]=b[w++],--R;);w=v-G,T=D}}else if(y<R){if(w+=m+y-R,(R-=y)<F){for(F-=R;D[v++]=b[w++],--R;);if(w=0,y<F){for(F-=R=y;D[v++]=b[w++],--R;);w=v-G,T=D}}}else if(w+=y-R,R<F){for(F-=R;D[v++]=b[w++],--R;);w=v-G,T=D}for(;2<F;)D[v++]=T[w++],D[v++]=T[w++],D[v++]=T[w++],F-=3;F&&(D[v++]=T[w++],1<F&&(D[v++]=T[w++]))}else{for(w=v-G;D[v++]=D[w++],D[v++]=D[w++],D[v++]=D[w++],2<(F-=3););F&&(D[v++]=D[w++],1<F&&(D[v++]=D[w++]))}break}}break}}while(l<u&&v<d);l-=F=C>>3,x&=(1<<(C-=F<<3))-1,t.next_in=l,t.next_out=v,t.avail_in=l<u?u-l+5:5-(l-u),t.avail_out=v<d?d-v+257:257-(v-d),r.hold=x,r.bits=C}},{}],49:[function(n,o,s){var t=n("../utils/common"),e=n("./adler32"),r=n("./crc32"),l=n("./inffast"),u=n("./inftrees"),v=1,f=2,d=0,a=-2,m=1,h=852,y=592;function b(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(w){var T;return w&&w.state?(T=w.state,w.total_in=w.total_out=T.total=0,w.msg="",T.wrap&&(w.adler=1&T.wrap),T.mode=m,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new t.Buf32(h),T.distcode=T.distdyn=new t.Buf32(y),T.sane=1,T.back=-1,d):a}function j(w){var T;return w&&w.state?((T=w.state).wsize=0,T.whave=0,T.wnext=0,C(w)):a}function A(w,T){var c,D;return w&&w.state?(D=w.state,T<0?(c=0,T=-T):(c=1+(T>>4),T<48&&(T&=15)),T&&(T<8||15<T)?a:(D.window!==null&&D.wbits!==T&&(D.window=null),D.wrap=c,D.wbits=T,j(w))):a}function M(w,T){var c,D;return w?(D=new x,(w.state=D).window=null,(c=A(w,T))!==d&&(w.state=null),c):a}var O,N,R=!0;function F(w){if(R){var T;for(O=new t.Buf32(512),N=new t.Buf32(32),T=0;T<144;)w.lens[T++]=8;for(;T<256;)w.lens[T++]=9;for(;T<280;)w.lens[T++]=7;for(;T<288;)w.lens[T++]=8;for(u(v,w.lens,0,288,O,0,w.work,{bits:9}),T=0;T<32;)w.lens[T++]=5;u(f,w.lens,0,32,N,0,w.work,{bits:5}),R=!1}w.lencode=O,w.lenbits=9,w.distcode=N,w.distbits=5}function G(w,T,c,D){var ne,Z=w.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new t.Buf8(Z.wsize)),D>=Z.wsize?(t.arraySet(Z.window,T,c-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(D<(ne=Z.wsize-Z.wnext)&&(ne=D),t.arraySet(Z.window,T,c-D,ne,Z.wnext),(D-=ne)?(t.arraySet(Z.window,T,c-D,D,0),Z.wnext=D,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}s.inflateReset=j,s.inflateReset2=A,s.inflateResetKeep=C,s.inflateInit=function(w){return M(w,15)},s.inflateInit2=M,s.inflate=function(w,T){var c,D,ne,Z,ie,H,re,I,P,te,q,Y,fe,_e,se,oe,ge,pe,Ce,ke,i,L,B,k,S=0,E=new t.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return a;(c=w.state).mode===12&&(c.mode=13),ie=w.next_out,ne=w.output,re=w.avail_out,Z=w.next_in,D=w.input,H=w.avail_in,I=c.hold,P=c.bits,te=H,q=re,L=d;e:for(;;)switch(c.mode){case m:if(c.wrap===0){c.mode=13;break}for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(2&c.wrap&&I===35615){E[c.check=0]=255&I,E[1]=I>>>8&255,c.check=r(c.check,E,2,0),P=I=0,c.mode=2;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&I)<<8)+(I>>8))%31){w.msg="incorrect header check",c.mode=30;break}if((15&I)!=8){w.msg="unknown compression method",c.mode=30;break}if(P-=4,i=8+(15&(I>>>=4)),c.wbits===0)c.wbits=i;else if(i>c.wbits){w.msg="invalid window size",c.mode=30;break}c.dmax=1<<i,w.adler=c.check=1,c.mode=512&I?10:12,P=I=0;break;case 2:for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(c.flags=I,(255&c.flags)!=8){w.msg="unknown compression method",c.mode=30;break}if(57344&c.flags){w.msg="unknown header flags set",c.mode=30;break}c.head&&(c.head.text=I>>8&1),512&c.flags&&(E[0]=255&I,E[1]=I>>>8&255,c.check=r(c.check,E,2,0)),P=I=0,c.mode=3;case 3:for(;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}c.head&&(c.head.time=I),512&c.flags&&(E[0]=255&I,E[1]=I>>>8&255,E[2]=I>>>16&255,E[3]=I>>>24&255,c.check=r(c.check,E,4,0)),P=I=0,c.mode=4;case 4:for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}c.head&&(c.head.xflags=255&I,c.head.os=I>>8),512&c.flags&&(E[0]=255&I,E[1]=I>>>8&255,c.check=r(c.check,E,2,0)),P=I=0,c.mode=5;case 5:if(1024&c.flags){for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}c.length=I,c.head&&(c.head.extra_len=I),512&c.flags&&(E[0]=255&I,E[1]=I>>>8&255,c.check=r(c.check,E,2,0)),P=I=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(1024&c.flags&&(H<(Y=c.length)&&(Y=H),Y&&(c.head&&(i=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),t.arraySet(c.head.extra,D,Z,Y,i)),512&c.flags&&(c.check=r(c.check,D,Y,Z)),H-=Y,Z+=Y,c.length-=Y),c.length))break e;c.length=0,c.mode=7;case 7:if(2048&c.flags){if(H===0)break e;for(Y=0;i=D[Z+Y++],c.head&&i&&c.length<65536&&(c.head.name+=String.fromCharCode(i)),i&&Y<H;);if(512&c.flags&&(c.check=r(c.check,D,Y,Z)),H-=Y,Z+=Y,i)break e}else c.head&&(c.head.name=null);c.length=0,c.mode=8;case 8:if(4096&c.flags){if(H===0)break e;for(Y=0;i=D[Z+Y++],c.head&&i&&c.length<65536&&(c.head.comment+=String.fromCharCode(i)),i&&Y<H;);if(512&c.flags&&(c.check=r(c.check,D,Y,Z)),H-=Y,Z+=Y,i)break e}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(512&c.flags){for(;P<16;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(I!==(65535&c.check)){w.msg="header crc mismatch",c.mode=30;break}P=I=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),w.adler=c.check=0,c.mode=12;break;case 10:for(;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}w.adler=c.check=b(I),P=I=0,c.mode=11;case 11:if(c.havedict===0)return w.next_out=ie,w.avail_out=re,w.next_in=Z,w.avail_in=H,c.hold=I,c.bits=P,2;w.adler=c.check=1,c.mode=12;case 12:if(T===5||T===6)break e;case 13:if(c.last){I>>>=7&P,P-=7&P,c.mode=27;break}for(;P<3;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}switch(c.last=1&I,P-=1,3&(I>>>=1)){case 0:c.mode=14;break;case 1:if(F(c),c.mode=20,T!==6)break;I>>>=2,P-=2;break e;case 2:c.mode=17;break;case 3:w.msg="invalid block type",c.mode=30}I>>>=2,P-=2;break;case 14:for(I>>>=7&P,P-=7&P;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if((65535&I)!=(I>>>16^65535)){w.msg="invalid stored block lengths",c.mode=30;break}if(c.length=65535&I,P=I=0,c.mode=15,T===6)break e;case 15:c.mode=16;case 16:if(Y=c.length){if(H<Y&&(Y=H),re<Y&&(Y=re),Y===0)break e;t.arraySet(ne,D,Z,Y,ie),H-=Y,Z+=Y,re-=Y,ie+=Y,c.length-=Y;break}c.mode=12;break;case 17:for(;P<14;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(c.nlen=257+(31&I),I>>>=5,P-=5,c.ndist=1+(31&I),I>>>=5,P-=5,c.ncode=4+(15&I),I>>>=4,P-=4,286<c.nlen||30<c.ndist){w.msg="too many length or distance symbols",c.mode=30;break}c.have=0,c.mode=18;case 18:for(;c.have<c.ncode;){for(;P<3;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}c.lens[U[c.have++]]=7&I,I>>>=3,P-=3}for(;c.have<19;)c.lens[U[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,B={bits:c.lenbits},L=u(0,c.lens,0,19,c.lencode,0,c.work,B),c.lenbits=B.bits,L){w.msg="invalid code lengths set",c.mode=30;break}c.have=0,c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;oe=(S=c.lencode[I&(1<<c.lenbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(ge<16)I>>>=se,P-=se,c.lens[c.have++]=ge;else{if(ge===16){for(k=se+2;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(I>>>=se,P-=se,c.have===0){w.msg="invalid bit length repeat",c.mode=30;break}i=c.lens[c.have-1],Y=3+(3&I),I>>>=2,P-=2}else if(ge===17){for(k=se+3;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}P-=se,i=0,Y=3+(7&(I>>>=se)),I>>>=3,P-=3}else{for(k=se+7;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}P-=se,i=0,Y=11+(127&(I>>>=se)),I>>>=7,P-=7}if(c.have+Y>c.nlen+c.ndist){w.msg="invalid bit length repeat",c.mode=30;break}for(;Y--;)c.lens[c.have++]=i}}if(c.mode===30)break;if(c.lens[256]===0){w.msg="invalid code -- missing end-of-block",c.mode=30;break}if(c.lenbits=9,B={bits:c.lenbits},L=u(v,c.lens,0,c.nlen,c.lencode,0,c.work,B),c.lenbits=B.bits,L){w.msg="invalid literal/lengths set",c.mode=30;break}if(c.distbits=6,c.distcode=c.distdyn,B={bits:c.distbits},L=u(f,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,B),c.distbits=B.bits,L){w.msg="invalid distances set",c.mode=30;break}if(c.mode=20,T===6)break e;case 20:c.mode=21;case 21:if(6<=H&&258<=re){w.next_out=ie,w.avail_out=re,w.next_in=Z,w.avail_in=H,c.hold=I,c.bits=P,l(w,q),ie=w.next_out,ne=w.output,re=w.avail_out,Z=w.next_in,D=w.input,H=w.avail_in,I=c.hold,P=c.bits,c.mode===12&&(c.back=-1);break}for(c.back=0;oe=(S=c.lencode[I&(1<<c.lenbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(oe&&!(240&oe)){for(pe=se,Ce=oe,ke=ge;oe=(S=c.lencode[ke+((I&(1<<pe+Ce)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(se=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}I>>>=pe,P-=pe,c.back+=pe}if(I>>>=se,P-=se,c.back+=se,c.length=ge,oe===0){c.mode=26;break}if(32&oe){c.back=-1,c.mode=12;break}if(64&oe){w.msg="invalid literal/length code",c.mode=30;break}c.extra=15&oe,c.mode=22;case 22:if(c.extra){for(k=c.extra;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}c.length+=I&(1<<c.extra)-1,I>>>=c.extra,P-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=23;case 23:for(;oe=(S=c.distcode[I&(1<<c.distbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(!(240&oe)){for(pe=se,Ce=oe,ke=ge;oe=(S=c.distcode[ke+((I&(1<<pe+Ce)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(se=S>>>24)<=P);){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}I>>>=pe,P-=pe,c.back+=pe}if(I>>>=se,P-=se,c.back+=se,64&oe){w.msg="invalid distance code",c.mode=30;break}c.offset=ge,c.extra=15&oe,c.mode=24;case 24:if(c.extra){for(k=c.extra;P<k;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}c.offset+=I&(1<<c.extra)-1,I>>>=c.extra,P-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){w.msg="invalid distance too far back",c.mode=30;break}c.mode=25;case 25:if(re===0)break e;if(Y=q-re,c.offset>Y){if((Y=c.offset-Y)>c.whave&&c.sane){w.msg="invalid distance too far back",c.mode=30;break}fe=Y>c.wnext?(Y-=c.wnext,c.wsize-Y):c.wnext-Y,Y>c.length&&(Y=c.length),_e=c.window}else _e=ne,fe=ie-c.offset,Y=c.length;for(re<Y&&(Y=re),re-=Y,c.length-=Y;ne[ie++]=_e[fe++],--Y;);c.length===0&&(c.mode=21);break;case 26:if(re===0)break e;ne[ie++]=c.length,re--,c.mode=21;break;case 27:if(c.wrap){for(;P<32;){if(H===0)break e;H--,I|=D[Z++]<<P,P+=8}if(q-=re,w.total_out+=q,c.total+=q,q&&(w.adler=c.check=c.flags?r(c.check,ne,q,ie-q):e(c.check,ne,q,ie-q)),q=re,(c.flags?I:b(I))!==c.check){w.msg="incorrect data check",c.mode=30;break}P=I=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;P<32;){if(H===0)break e;H--,I+=D[Z++]<<P,P+=8}if(I!==(4294967295&c.total)){w.msg="incorrect length check",c.mode=30;break}P=I=0}c.mode=29;case 29:L=1;break e;case 30:L=-3;break e;case 31:return-4;case 32:default:return a}return w.next_out=ie,w.avail_out=re,w.next_in=Z,w.avail_in=H,c.hold=I,c.bits=P,(c.wsize||q!==w.avail_out&&c.mode<30&&(c.mode<27||T!==4))&&G(w,w.output,w.next_out,q-w.avail_out)?(c.mode=31,-4):(te-=w.avail_in,q-=w.avail_out,w.total_in+=te,w.total_out+=q,c.total+=q,c.wrap&&q&&(w.adler=c.check=c.flags?r(c.check,ne,q,w.next_out-q):e(c.check,ne,q,w.next_out-q)),w.data_type=c.bits+(c.last?64:0)+(c.mode===12?128:0)+(c.mode===20||c.mode===15?256:0),(te==0&&q===0||T===4)&&L===d&&(L=-5),L)},s.inflateEnd=function(w){if(!w||!w.state)return a;var T=w.state;return T.window&&(T.window=null),w.state=null,d},s.inflateGetHeader=function(w,T){var c;return w&&w.state&&2&(c=w.state).wrap?((c.head=T).done=!1,d):a},s.inflateSetDictionary=function(w,T){var c,D=T.length;return w&&w.state?(c=w.state).wrap!==0&&c.mode!==11?a:c.mode===11&&e(1,T,D,0)!==c.check?-3:G(w,T,D,D)?(c.mode=31,-4):(c.havedict=1,d):a},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,o,s){var t=n("../utils/common"),e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(v,f,d,a,m,h,y,b){var x,C,j,A,M,O,N,R,F,G=b.bits,w=0,T=0,c=0,D=0,ne=0,Z=0,ie=0,H=0,re=0,I=0,P=null,te=0,q=new t.Buf16(16),Y=new t.Buf16(16),fe=null,_e=0;for(w=0;w<=15;w++)q[w]=0;for(T=0;T<a;T++)q[f[d+T]]++;for(ne=G,D=15;1<=D&&q[D]===0;D--);if(D<ne&&(ne=D),D===0)return m[h++]=20971520,m[h++]=20971520,b.bits=1,0;for(c=1;c<D&&q[c]===0;c++);for(ne<c&&(ne=c),w=H=1;w<=15;w++)if(H<<=1,(H-=q[w])<0)return-1;if(0<H&&(v===0||D!==1))return-1;for(Y[1]=0,w=1;w<15;w++)Y[w+1]=Y[w]+q[w];for(T=0;T<a;T++)f[d+T]!==0&&(y[Y[f[d+T]]++]=T);if(O=v===0?(P=fe=y,19):v===1?(P=e,te-=257,fe=r,_e-=257,256):(P=l,fe=u,-1),w=c,M=h,ie=T=I=0,j=-1,A=(re=1<<(Z=ne))-1,v===1&&852<re||v===2&&592<re)return 1;for(;;){for(N=w-ie,F=y[T]<O?(R=0,y[T]):y[T]>O?(R=fe[_e+y[T]],P[te+y[T]]):(R=96,0),x=1<<w-ie,c=C=1<<Z;m[M+(I>>ie)+(C-=x)]=N<<24|R<<16|F|0,C!==0;);for(x=1<<w-1;I&x;)x>>=1;if(x!==0?(I&=x-1,I+=x):I=0,T++,--q[w]==0){if(w===D)break;w=f[d+y[T]]}if(ne<w&&(I&A)!==j){for(ie===0&&(ie=ne),M+=c,H=1<<(Z=w-ie);Z+ie<D&&!((H-=q[Z+ie])<=0);)Z++,H<<=1;if(re+=1<<Z,v===1&&852<re||v===2&&592<re)return 1;m[j=I&A]=ne<<24|Z<<16|M-h|0}}return I!==0&&(m[M+I]=w-ie<<24|64<<16|0),b.bits=ne,0}},{"../utils/common":41}],51:[function(n,o,s){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,o,s){var t=n("../utils/common"),e=0,r=1;function l(S){for(var E=S.length;0<=--E;)S[E]=0}var u=0,v=29,f=256,d=f+1+v,a=30,m=19,h=2*d+1,y=15,b=16,x=7,C=256,j=16,A=17,M=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(d+2));l(G);var w=new Array(2*a);l(w);var T=new Array(512);l(T);var c=new Array(256);l(c);var D=new Array(v);l(D);var ne,Z,ie,H=new Array(a);function re(S,E,U,W,z){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=z,this.has_stree=S&&S.length}function I(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function P(S){return S<256?T[S]:T[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,U){S.bi_valid>b-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>b-S.bi_valid,S.bi_valid+=U-b):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function Y(S,E,U){q(S,U[2*E],U[2*E+1])}function fe(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function _e(S,E,U){var W,z,V=new Array(y+1),K=0;for(W=1;W<=y;W++)V[W]=K=K+U[W-1]<<1;for(z=0;z<=E;z++){var $=S[2*z+1];$!==0&&(S[2*z]=fe(V[$]++,$))}}function se(S){var E;for(E=0;E<d;E++)S.dyn_ltree[2*E]=0;for(E=0;E<a;E++)S.dyn_dtree[2*E]=0;for(E=0;E<m;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function oe(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ge(S,E,U,W){var z=2*E,V=2*U;return S[z]<S[V]||S[z]===S[V]&&W[E]<=W[U]}function pe(S,E,U){for(var W=S.heap[U],z=U<<1;z<=S.heap_len&&(z<S.heap_len&&ge(E,S.heap[z+1],S.heap[z],S.depth)&&z++,!ge(E,W,S.heap[z],S.depth));)S.heap[U]=S.heap[z],U=z,z<<=1;S.heap[U]=W}function Ce(S,E,U){var W,z,V,K,$=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*$]<<8|S.pending_buf[S.d_buf+2*$+1],z=S.pending_buf[S.l_buf+$],$++,W===0?Y(S,z,E):(Y(S,(V=c[z])+f+1,E),(K=O[V])!==0&&q(S,z-=D[V],K),Y(S,V=P(--W),U),(K=N[V])!==0&&q(S,W-=H[V],K)),$<S.last_lit;);Y(S,C,E)}function ke(S,E){var U,W,z,V=E.dyn_tree,K=E.stat_desc.static_tree,$=E.stat_desc.has_stree,ee=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=h,U=0;U<ee;U++)V[2*U]!==0?(S.heap[++S.heap_len]=he=U,S.depth[U]=0):V[2*U+1]=0;for(;S.heap_len<2;)V[2*(z=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[z]=0,S.opt_len--,$&&(S.static_len-=K[2*z+1]);for(E.max_code=he,U=S.heap_len>>1;1<=U;U--)pe(S,V,U);for(z=ee;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,V,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,V[2*z]=V[2*U]+V[2*W],S.depth[z]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,V[2*U+1]=V[2*W+1]=z,S.heap[1]=z++,pe(S,V,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,xe){var Ze,je,He,me,rt,pt,Ee=xe.dyn_tree,Mt=xe.max_code,pn=xe.stat_desc.static_tree,mn=xe.stat_desc.has_stree,gn=xe.stat_desc.extra_bits,Nt=xe.stat_desc.extra_base,Ge=xe.stat_desc.max_length,it=0;for(me=0;me<=y;me++)ae.bl_count[me]=0;for(Ee[2*ae.heap[ae.heap_max]+1]=0,Ze=ae.heap_max+1;Ze<h;Ze++)Ge<(me=Ee[2*Ee[2*(je=ae.heap[Ze])+1]+1]+1)&&(me=Ge,it++),Ee[2*je+1]=me,Mt<je||(ae.bl_count[me]++,rt=0,Nt<=je&&(rt=gn[je-Nt]),pt=Ee[2*je],ae.opt_len+=pt*(me+rt),mn&&(ae.static_len+=pt*(pn[2*je+1]+rt)));if(it!==0){do{for(me=Ge-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[Ge]--,it-=2}while(0<it);for(me=Ge;me!==0;me--)for(je=ae.bl_count[me];je!==0;)Mt<(He=ae.heap[--Ze])||(Ee[2*He+1]!==me&&(ae.opt_len+=(me-Ee[2*He+1])*Ee[2*He],Ee[2*He+1]=me),je--)}}(S,E),_e(V,he,S.bl_count)}function i(S,E,U){var W,z,V=-1,K=E[1],$=0,ee=7,he=4;for(K===0&&(ee=138,he=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)z=K,K=E[2*(W+1)+1],++$<ee&&z===K||($<he?S.bl_tree[2*z]+=$:z!==0?(z!==V&&S.bl_tree[2*z]++,S.bl_tree[2*j]++):$<=10?S.bl_tree[2*A]++:S.bl_tree[2*M]++,V=z,he=($=0)===K?(ee=138,3):z===K?(ee=6,3):(ee=7,4))}function L(S,E,U){var W,z,V=-1,K=E[1],$=0,ee=7,he=4;for(K===0&&(ee=138,he=3),W=0;W<=U;W++)if(z=K,K=E[2*(W+1)+1],!(++$<ee&&z===K)){if($<he)for(;Y(S,z,S.bl_tree),--$!=0;);else z!==0?(z!==V&&(Y(S,z,S.bl_tree),$--),Y(S,j,S.bl_tree),q(S,$-3,2)):$<=10?(Y(S,A,S.bl_tree),q(S,$-3,3)):(Y(S,M,S.bl_tree),q(S,$-11,7));V=z,he=($=0)===K?(ee=138,3):z===K?(ee=6,3):(ee=7,4)}}l(H);var B=!1;function k(S,E,U,W){q(S,(u<<1)+(W?1:0),3),function(z,V,K,$){oe(z),$&&(te(z,K),te(z,~K)),t.arraySet(z.pending_buf,z.window,V,K,z.pending),z.pending+=K}(S,E,U,!0)}s._tr_init=function(S){B||(function(){var E,U,W,z,V,K=new Array(y+1);for(z=W=0;z<v-1;z++)for(D[z]=W,E=0;E<1<<O[z];E++)c[W++]=z;for(c[W-1]=z,z=V=0;z<16;z++)for(H[z]=V,E=0;E<1<<N[z];E++)T[V++]=z;for(V>>=7;z<a;z++)for(H[z]=V<<7,E=0;E<1<<N[z]-7;E++)T[256+V++]=z;for(U=0;U<=y;U++)K[U]=0;for(E=0;E<=143;)G[2*E+1]=8,E++,K[8]++;for(;E<=255;)G[2*E+1]=9,E++,K[9]++;for(;E<=279;)G[2*E+1]=7,E++,K[7]++;for(;E<=287;)G[2*E+1]=8,E++,K[8]++;for(_e(G,d+1,K),E=0;E<a;E++)w[2*E+1]=5,w[2*E]=fe(E,5);ne=new re(G,O,f+1,d,y),Z=new re(w,N,0,a,y),ie=new re(new Array(0),R,0,m,x)}(),B=!0),S.l_desc=new I(S.dyn_ltree,ne),S.d_desc=new I(S.dyn_dtree,Z),S.bl_desc=new I(S.bl_tree,ie),S.bi_buf=0,S.bi_valid=0,se(S)},s._tr_stored_block=k,s._tr_flush_block=function(S,E,U,W){var z,V,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function($){var ee,he=4093624447;for(ee=0;ee<=31;ee++,he>>>=1)if(1&he&&$.dyn_ltree[2*ee]!==0)return e;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return r;for(ee=32;ee<f;ee++)if($.dyn_ltree[2*ee]!==0)return r;return e}(S)),ke(S,S.l_desc),ke(S,S.d_desc),K=function($){var ee;for(i($,$.dyn_ltree,$.l_desc.max_code),i($,$.dyn_dtree,$.d_desc.max_code),ke($,$.bl_desc),ee=m-1;3<=ee&&$.bl_tree[2*F[ee]+1]===0;ee--);return $.opt_len+=3*(ee+1)+5+5+4,ee}(S),z=S.opt_len+3+7>>>3,(V=S.static_len+3+7>>>3)<=z&&(z=V)):z=V=U+5,U+4<=z&&E!==-1?k(S,E,U,W):S.strategy===4||V===z?(q(S,2+(W?1:0),3),Ce(S,G,w)):(q(S,4+(W?1:0),3),function($,ee,he,ae){var xe;for(q($,ee-257,5),q($,he-1,5),q($,ae-4,4),xe=0;xe<ae;xe++)q($,$.bl_tree[2*F[xe]+1],3);L($,$.dyn_ltree,ee-1),L($,$.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Ce(S,S.dyn_ltree,S.dyn_dtree)),se(S),W&&oe(S)},s._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(c[U]+f+1)]++,S.dyn_dtree[2*P(E)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){q(S,2,3),Y(S,C,G),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,o,s){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,o,s){(function(t){(function(e,r){if(!e.setImmediate){var l,u,v,f,d=1,a={},m=!1,h=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e);y=y&&y.setTimeout?y:e,l={}.toString.call(e.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(e.postMessage&&!e.importScripts){var j=!0,A=e.onmessage;return e.onmessage=function(){j=!1},e.postMessage("","*"),e.onmessage=A,j}}()?(f="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",C,!1):e.attachEvent("onmessage",C),function(j){e.postMessage(f+j,"*")}):e.MessageChannel?((v=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){v.port2.postMessage(j)}):h&&"onreadystatechange"in h.createElement("script")?(u=h.documentElement,function(j){var A=h.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,u.removeChild(A),A=null},u.appendChild(A)}):function(j){setTimeout(x,0,j)},y.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),M=0;M<A.length;M++)A[M]=arguments[M+1];var O={callback:j,args:A};return a[d]=O,l(d),d++},y.clearImmediate=b}function b(j){delete a[j]}function x(j){if(m)setTimeout(x,0,j);else{var A=a[j];if(A){m=!0;try{(function(M){var O=M.callback,N=M.args;switch(N.length){case 0:O();break;case 1:O(N[0]);break;case 2:O(N[0],N[1]);break;case 3:O(N[0],N[1],N[2]);break;default:O.apply(r,N)}})(A)}finally{b(j),m=!1}}}}function C(j){j.source===e&&typeof j.data=="string"&&j.data.indexOf(f)===0&&x(+j.data.slice(f.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof st<"u"?st:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(un);var Zi=un.exports;const Hi=An(Zi),fn=/url\("([\S*]+)"\)/,Gi=async(p,g,n,o,s)=>{var l,u,v;const t=document.querySelector("svg#".concat(p));if(!t)throw new Error("Requested canvas SVG element not found");const e=Number((l=t.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:l[0]),r=t.cloneNode(!0);if(r.setAttribute("height",(e*(s||100)/100).toString()),r.style.setProperty("all","initial"),["share"].map(f=>{var d;return[...((d=[...document.querySelectorAll("link")].filter(a=>a.id==="css_"+f)[0])==null?void 0:d.sheet).cssRules].map(a=>a.cssText).join(" ")}).forEach(f=>{const d=document.createElement("style");d.textContent=f,r.prepend(d)}),(u=r.querySelector("rect#canvas-border"))==null||u.setAttribute("stroke",o?"black":"none"),(v=r.querySelector("rect#canvas-bg"))==null||v.setAttribute("fill",n?"none":"white"),g===Q.MTR)try{const f=await Yi(r),d=document.createElement("style");d.textContent=f.join("\n"),r.prepend(d)}catch(f){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(f)}return r},Vi=p=>new Promise(g=>{const n=new FileReader;n.onloadend=()=>g(n.result),n.readAsDataURL(p)}),$i=(p,g)=>p.find(n=>{const o=n.style;return o.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===g.family&&o.getPropertyValue("unicode-range")===g.unicodeRange}),Yi=async p=>{var t,e,r,l;const g=Array.from(new Set([...p.querySelectorAll(".rmg-name__zh"),...p.querySelectorAll(".rmg-name__en")].map(u=>u.innerHTML).join("").replace(/\s/g,""))).join(""),n=await document.fonts.load("80px GenYoMin TW, Vegur",g),o=Array.from(((l=((r=(e=(t=document.querySelector("link#css_share"))==null?void 0:t.sheet)==null?void 0:e.cssRules)==null?void 0:r[0]).styleSheet)==null?void 0:l.cssRules)||[]),s=n.reduce((u,v)=>{const f=$i(o,v);return f?u.find(a=>{const m=a.style,h=f.style;return m.getPropertyValue("font-family")===h.getPropertyValue("font-family")&&m.getPropertyValue("unicode-range")===h.getPropertyValue("unicode-range")})?u:u.concat(f):u},[]);return await Promise.all(s.map(async u=>{try{const v=await fetch(qi(u)),f=await Vi(await v.blob());return u.cssText.replace(fn,"url('".concat(f,"')"))}catch(v){return console.error(v),""}}))},qi=p=>{var n;return"/styles/"+((n=p.style.src.match(fn))==null?void 0:n[1])},Ki=async(p,g,n)=>{const o=p.viewBox.baseVal.width,s=p.viewBox.baseVal.height,t=document.querySelectorAll("canvas")[0];t.width=Number(o)*window.devicePixelRatio*g,t.height=Number(s)*window.devicePixelRatio*g,p.setAttribute("width",t.width.toString()),p.setAttribute("height",t.height.toString());const e=t.getContext("2d");return e.clearRect(0,0,t.width,t.height),p.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(r=>r.setAttribute("font-size","8.5px")),p.querySelectorAll("text, tspan").forEach(r=>{const l=window.getComputedStyle(r);r.setAttribute("font-family",l.fontFamily),r.setAttribute("fill",l.fill),r.setAttribute("dominant-baseline",l.dominantBaseline),r.setAttribute("text-anchor",l.textAnchor||"")}),new Promise((r,l)=>{const u=new Image;u.onload=()=>{setTimeout(()=>{e.drawImage(u,0,0,t.width,t.height),t.toBlob(v=>{v?r(v):l("Canvas blob is null")},"image/png")},n?2e3:0)},u.onerror=l,u.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(p.outerHTML)))})};function Xi(p){const{isOpen:g,onClose:n}=p,{t:o}=le(),s=ue(),[t,e]=X.useState(""),[r,l]=X.useState(!1),[u,v]=X.useState(!1),[f,d]=X.useState(100),[a,m]=X.useState("png"),h=J(R=>R.app.canvasToShow),{style:y,stn_list:b,current_stn_idx:x,line_name:C}=J(R=>R.param);X.useEffect(()=>{t!==""&&!h.includes(t)&&e("")},[h]);const j=Pt[y].reduce((R,F)=>h.includes(F)?{...R,[F]:o("CanvasType."+F)}:{...R},{"":o("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((R,F)=>({...R,[F]:"".concat(F,"%")}),{}),M={png:o("DownloadModal.png"),svg:o("DownloadModal.svg")},O=[{type:"select",label:o("DownloadModal.canvas"),value:t,options:j,disabledOptions:[""],onChange:R=>e(R),minW:"full"},{type:"switch",label:o("DownloadModal.transparent"),isChecked:r,onChange:l,oneLine:!0,minW:"full"},{type:"switch",label:o("DownloadModal.showBorder"),isChecked:u,onChange:v,oneLine:!0,minW:"full"},{type:"select",label:o("DownloadModal.scale"),value:f,options:A,onChange:R=>d(R)},{type:"select",label:o("DownloadModal.format"),value:a,options:M,onChange:R=>m(R)}],N=async R=>{s(Gt(0));const F=R==="current"?[x]:Object.keys(b).filter(w=>!["linestart","lineend"].includes(w)),G=new Hi;for(const w in F){s(Gt((Number(w)+1)/F.length*100));const T=F[w];s(kt(T)),await Hr(500);const c=await Gi(t,y,r,u,f);document.body.appendChild(c);const D="rmg.".concat(T,".").concat(b[T].name[0],".").concat(b[T].name[1]).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(a==="png"){const ne=Gr()&&w==="0",Z=await Ki(c,f/100,ne);F.length>1?G.file("".concat(D,".png"),Z):$t("".concat(D,".png"),Z)}else if(a==="svg"){c.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(c.outerHTML)));F.length>1?G.file("".concat(D,".svg"),ne.split("base64,")[1],{base64:!0}):on(D+".svg","image/svg+xml",c.outerHTML)}document.body.removeChild(c)}if(F.length>1){const w=await G.generateAsync({type:"blob"}),T="rmg.".concat(C[0],".").concat(C[1],".zip").replaceAll(" ","_");$t(T,w)}ce.event(ve.DOWNLOAD_IMAGES,{canvasToDownload:t,style:y,option:R,format:a}),s(kt(x)),s(Er()),n()};return _.jsxs(Ke,{isOpen:g,onClose:n,children:[_.jsx(Xe,{}),_.jsxs(Je,{children:[_.jsx(Qe,{children:o("DownloadModal.title")}),_.jsx(et,{}),_.jsx(tt,{children:_.jsx(be,{fields:O})}),_.jsx(nt,{children:_.jsxs(Ae,{children:[_.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>N("current"),isDisabled:!t,children:o("DownloadModal.downloadOne")}),y!==Q.GZMTR&&_.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>N("all"),isDisabled:!t,children:o("DownloadModal.downloadAll")})]})})]})]})}function Ji(){const{t:p}=le(),[g,n]=X.useState(!1),{paramConfig:o}=J(e=>e.app),s=J(e=>e.param),t=()=>{const e=Vr(s);on("RMG_".concat(o==null?void 0:o.id,".json"),"application/json",JSON.stringify(e)),ce.event(ve.DOWNLOAD_PARAM,{style:s.style})};return _.jsxs(_n,{children:[_.jsx(yn,{as:de,variant:"ghost",size:"sm",rightIcon:_.jsx(Or,{}),children:p("DownloadActions.downloads")}),_.jsxs(vn,{children:[_.jsx(Dt,{onClick:t,children:p("DownloadActions.configFile")}),_.jsx(Dt,{onClick:()=>n(!0),children:p("DownloadActions.images")})]}),_.jsx(Xi,{isOpen:g,onClose:()=>n(!1)})]})}function ft(){const[p,g]=En();return[p,o=>{if(g(o),Object.keys(o)){const s=new URLSearchParams(o);ce.updateUrl("/rmg/#/?"+s)}else ce.updateUrl("/rmg/#/")}]}function Qi(){const{t:p}=le(),g=zt(),[,n]=ft(),o=()=>{g(Ue(Ne.CLOSE)),g(jt(void 0)),n({})};return _.jsxs(Ae,{ml:"auto",w:"fit-content",children:[_.jsx(de,{variant:"ghost",size:"sm",leftIcon:_.jsx(Rr,{}),onClick:o,children:p("All projects")}),_.jsx(Ji,{}),_.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:_.jsx(zr,{}),onClick:()=>g(Ue(Ne.STYLE)),children:p("HeaderActions.editStyle")})]})}function es(){const{t:p}=le(),g=ue(),{canvasToShow:n,canvasScale:o}=J(u=>u.app),s=J(u=>u.param.style),t=Object.values(Q).reduce((u,v)=>({...u,[v]:p("RmgStyle."+v)}),{}),e=Pt[s].map(u=>({label:p("CanvasType."+u),value:u})),r=u=>{g(Dr(u))},l=[{type:"select",label:p("Style"),value:s,options:t,onChange:u=>r(u)},{type:"custom",label:p("View"),component:_.jsx(Pr,{displayValue:p("Select canvas"),selections:e,defaultValue:n,onChange:u=>g(Tr(u))})},{type:"slider",label:p("Canvas scale"),value:o,min:.1,max:2,step:.01,onChange:u=>g(Ir(u)),leftIcon:_.jsx(Br,{}),rightIcon:_.jsx(Mr,{})}];return _.jsxs(Nr,{children:[_.jsx(be,{fields:l,minW:160}),_.jsx(Qi,{})]})}const ts=p=>{switch(p){case Q.MTR:return["hongkong","twl","#E2231A",ze.white];case Q.GZMTR:return["guangzhou","gz1","#F3D03E",ze.black];case Q.SHMetro:return["shanghai","sh1","#E4002B",ze.white];default:return["other","other","#AAAAAA",ze.white]}},ns=p=>{switch(p){case"zh-Hans":return["1号线","Line 1"];case"zh-Hant":return["荃灣綫","Tsuen Wan Line"];default:return["地鐵線","Metro Line"]}},Ve=p=>({name:["未命名 "+p,"Unnamed "+p],num:"00",services:[St.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Le.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355}),rs=(p,g)=>{const n=Ve("linestart");n.name=["LEFT END","LEFT END"];const o=Ve("lineend");o.name=["RIGHT END","RIGHT END"];const s=De(6),t=Ve(s);t.num="01";const e=De(6),r=Ve(e);return r.num="02",n.children=[s],t.parents=["linestart"],t.children=[e],r.parents=[s],r.children=["lineend"],o.parents=[e],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:p,y_pc:50,padding:10,branchSpacingPct:33,direction:Le.left,platform_num:"1",theme:ts(p),line_name:ns(g),current_stn_idx:e,stn_list:{linestart:n,[s]:t,[e]:r,lineend:o},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",spanLineNum:!0,psd_num:"1",info_panel_type:p===Q.SHMetro?nn.sh:tn.gz1,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}},qe=(p,g,n,o)=>(s,t)=>{var u,v,f,d,a,m,h,y,b,x,C,j,A,M;const e=t().param.stn_list;let r=De(6);for(;r in e;)r=De(6);const l=Ve(r);if(p!=="new"){const O={...e,[g]:{...e[g],children:e[g].children.map(N=>N===n?r:N),branch:{left:(u=e[g].branch)==null?void 0:u.left,right:((f=(v=e[g].branch)==null?void 0:v.right)==null?void 0:f[1])===n?(a=(d=e[g].branch)==null?void 0:d.right)==null?void 0:a.with(1,r):(m=e[g].branch)==null?void 0:m.right}},[n]:{...e[n],parents:e[n].parents.map(N=>N===g?r:N),branch:{left:((y=(h=e[n].branch)==null?void 0:h.left)==null?void 0:y[1])===g?(x=(b=e[n].branch)==null?void 0:b.left)==null?void 0:x.with(1,r):(C=e[n].branch)==null?void 0:C.left,right:(j=e[n].branch)==null?void 0:j.right}},[r]:{...l,parents:[g],children:[n]}};return s(Me(O)),r}else{if(!o)return!1;const O={...e,[g]:{...e[g],children:o==="upper"?[r,e[g].children[0]]:[e[g].children[0],r],branch:{left:(A=e[g].branch)==null?void 0:A.left,right:[ct.through,r]}},[n]:{...e[n],parents:o==="upper"?[r,e[n].parents[0]]:[e[n].parents[0],r],branch:{left:[ct.through,r],right:(M=e[n].branch)==null?void 0:M.right}},[r]:{...l,parents:[g],children:[n]}};return s(Me(O)),r}},is=(p,g,n)=>(o,s)=>{const e=s().helper.branches[p];if(e!=null&&e.length)if(g==="before"){const r=e[e.indexOf(n)-1];return o(qe(p.toString(),r,n))}else{const r=e[e.indexOf(n)+1];return o(qe(p.toString(),n,r))}else return!1},ss=()=>(p,g)=>{const n=g().param.stn_list;return g().helper.branches[0].filter(s=>{const t=n[s].parents.length+n[s].children.length===4,e=It(s,n)===0;return!t&&e})},qt=(p,g)=>(n,o)=>{const s=o().param.stn_list,t=o().helper.branches;return!t[0].includes(p)||!t[0].includes(g)?"Branch should end at main line":t[0].indexOf(p)>=t[0].indexOf(g)?"Not in correct ordering":p==="linestart"&&g==="lineend"?"Should not be parallel to main line":p==="linestart"&&t[0].indexOf(g)===1?"Branch should not be open jaw from the first station":g==="lineend"&&t[0].indexOf(p)===t[0].length-2?"Branch should not be open jaw from the last station":s[p].children.length>1||s[g].parents.length>1?"Branch already exist":t.slice(1).some(l=>l.slice(1,-1).includes(p)||l.slice(1,-1).includes(g))?"Cannot branch out from existing branch":t[0].slice(t[0].indexOf(p)+1,t[0].indexOf(g)).every(l=>s[l].parents.length===1&&s[l].children.length===1)?"":"One or more stations between both ends are branching out"};function as(p){var M,O;const{isOpen:g,onClose:n}=p,{t:o}=le(),s=ue(),t=J(N=>N.app.selectedBranch),{style:e,stn_list:r}=J(N=>N.param),l=J(N=>N.helper.branches),[u,v]=X.useState(t),[f,d]=X.useState("before"),[a,m]=X.useState(""),[h,y]=X.useState(!1);X.useEffect(()=>{v(t)},[t]),X.useEffect(()=>{g||y(!1)},[g]);const b=(O=(M=l[Number(u)])==null?void 0:M.slice(1,-1))!=null?O:[],x=N=>N.reduce((R,F)=>{var G;return{...R,[F]:(G=r[F])==null?void 0:G.name.join(" - ")}},{"":o("AddStationModal.pleaseSelect")}),C=[{type:"select",label:o("AddStationModal.where"),value:u,options:{...l.reduce((N,R,F)=>({...N,[F]:F===0?o("AddStationModal.main"):e!==Q.SHMetro||!We(R,r)?o("AddStationModal.branch")+" "+F:o("AddStationModal.external")+" "+F}),{})},onChange:N=>j(N),minW:"full"},{type:"select",label:o("AddStationModal.preposition"),value:f,options:{before:o("AddStationModal.before"),after:o("AddStationModal.after")},onChange:N=>d(N)},{type:"select",label:o("AddStationModal.pivot"),value:a,options:x(b),disabledOptions:[""],onChange:N=>m(N)}],j=N=>{v(N),m("")},A=()=>{const N=s(is(u,f,a));N?(n(),s(rn(N)),s(Ue(Ne.STATION))):(console.log("false here"),y(!0)),ce.event(ve.ADD_STATION,{style:e,branchIndex:u,success:N})};return _.jsxs(Ke,{isOpen:g,onClose:n,children:[_.jsx(Xe,{}),_.jsxs(Je,{children:[h&&_.jsxs(dt,{status:"error",variant:"solid",size:"xs",children:[_.jsx(ht,{}),o("AddStationModal.error")]}),_.jsxs(Se,{position:"relative",children:[_.jsx(Qe,{children:o("AddStationModal.title")}),_.jsx(et,{})]}),_.jsx(tt,{children:_.jsx(be,{fields:C})}),_.jsx(nt,{children:_.jsx(de,{colorScheme:"primary",onClick:A,isDisabled:!a,children:o("Confirm")})})]})]})}function os(p){const{isOpen:g,onClose:n}=p,{t:o}=le(),s=ue(),[t,e]=X.useState("new"),[r,l]=X.useState(""),[u,v]=X.useState(""),[f,d]=X.useState("upper"),[a,m]=X.useState(""),[h,y]=X.useState(""),{style:b,stn_list:x}=J(G=>G.param);X.useEffect(()=>{g||(e("new"),l(""),v(""))},[g]);const j=(G=>G.reduce((w,T)=>{var c;return{...w,[T]:T==="linestart"?"(".concat(o("LEFT END"),")"):T==="lineend"?"(".concat(o("RIGHT END"),")"):(c=x[T])==null?void 0:c.name.join(" - ")}},{"":o("Please select...")}))(s(ss())),A=[{type:"select",label:o("NewBranchModal.where"),value:t,options:{new:o("NewBranchModal.new"),ext:o("NewBranchModal.ext")},disabledOptions:b===Q.SHMetro?[]:["ext"],onChange:G=>M(G),minW:"full"},{type:"select",label:o("NewBranchModal.from"),value:r,options:j,disabledOptions:[""],onChange:G=>O(G),isInvalid:!!a},{type:"select",label:o("NewBranchModal.to"),value:u,options:j,disabledOptions:[""],onChange:G=>N(G),isInvalid:!!h},{type:"select",label:o("NewBranchModal.position"),value:f,options:{upper:o("NewBranchModal.upper"),lower:o("NewBranchModal.lower")},onChange:G=>d(G),minW:"full",hidden:t!=="new"||b===Q.SHMetro}],M=G=>{e(G),l(""),v(""),m(""),y("")},O=G=>{l(G),m(""),G&&u&&y(s(qt(G,u)))},N=G=>{v(G),y(""),r&&G&&m(s(qt(r,G)))},R=()=>{let G;t==="ext"?G=s(qe("new",r,u,"lower")):b===Q.SHMetro?G=s(qe("new",r,u,"upper")):G=s(qe("new",r,u,f)),G&&(n(),ce.event(ve.ADD_BRANCH,{style:b,where:t}))},F=!!(!r||!u||a||h);return _.jsxs(Ke,{isOpen:g,onClose:n,children:[_.jsx(Xe,{}),_.jsxs(Je,{children:[_.jsx(Qe,{children:o("NewBranchModal.title")}),_.jsx(et,{}),_.jsx(tt,{children:_.jsx(be,{fields:A})}),_.jsx(nt,{children:_.jsx(de,{colorScheme:"primary",title:F?a||h:o("Confirm"),onClick:R,isDisabled:F,children:o("Confirm")})})]})]})}const ls=X.lazy(()=>ot(()=>import("./station-ag-grid-2l4fA8e1.js"),__vite__mapDeps([10,1,2,3,4,11,7])));function cs(){const{t:p}=le(),g=ue(),[n,o]=X.useState(!1),[s,t]=X.useState(!1),e=J(f=>f.app.selectedBranch),{style:r,stn_list:l}=J(f=>f.param),u=J(f=>f.helper.branches),v=()=>{g(Ue(Ne.BRANCH))};return _.jsxs(Se,{flex:1,overflow:"hidden",children:[_.jsxs(Sn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:e,onChange:f=>g(Lr(f)),children:[_.jsxs(xn,{children:[u.map((f,d)=>d===0?_.jsx(mt,{children:p("GridTabs.main")},d):r!==Q.SHMetro||!We(f,l)?_.jsx(mt,{children:p("GridTabs.branch")+" "+d},d):_.jsx(mt,{children:p("GridTabs.external")+" "+d},d)),_.jsx(Pe,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>t(!0),icon:_.jsx(Re,{})}),_.jsxs(Ae,{marginLeft:"auto",marginRight:1,children:[_.jsx(de,{variant:"outline",size:"xs",leftIcon:_.jsx(Re,{}),onClick:()=>o(!0),children:p("GridTabs.addStation")}),_.jsx(de,{size:"xs",colorScheme:"primary",onClick:v,children:p("GridTabs.editLine")})]})]}),_.jsx(wn,{flex:1,overflowY:"auto",children:u.map((f,d)=>_.jsx(kn,{padding:0,h:"100%",position:"relative",children:_.jsx(Jt,{suspenseFallback:_.jsx(ut,{isIndeterminate:!0}),children:_.jsx(ls,{branchIndex:d})})},d))})]}),_.jsx(as,{isOpen:n,onClose:()=>o(!1)}),_.jsx(os,{isOpen:s,onClose:()=>t(!1)})]})}function ds(){const p=ue(),g=J(o=>o.app.globalAlerts),n=o=>{ce.isStandaloneWindow()?window.open("/".concat(o),"_blank"):ce.openApp(o)};return _.jsx(_.Fragment,{children:Object.entries(g).map(([o,{message:s,url:t,linkedApp:e}])=>_.jsxs(dt,{status:o,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[_.jsx(ht,{}),e?_.jsx($e,{onClick:()=>n(e),children:s}):t?_.jsx($e,{href:t,target:"_blank",children:s}):s,_.jsx(Kt,{ml:"auto",onClick:()=>p(Fr(o))})]},o))})}function hs(){const{t:p}=le(),g=J(s=>s.app.isLoading),[n,o]=X.useState(!1);return X.useEffect(()=>{ce.isStandaloneWindow()&&!ce.storage.get(Ye.DO_NOT_SHOW_RMT_MSG)&&o(!0)},[]),_.jsxs(an,{children:[g&&_.jsx(ut,{isIndeterminate:g<0,value:g>=0?g:void 0}),_.jsx(es,{}),n&&_.jsxs(dt,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[_.jsx(ht,{}),_.jsxs(lt,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[p("Try out")," ",_.jsx($e,{href:"/?app=rmg",isExternal:!0,children:p("Rail Map Toolkit")})," ",p("now and enjoy an even better rail map design experience!")," ",_.jsx($e,{as:"button",ml:"auto",onClick:()=>o(!1),children:p("Close")})," | ",_.jsx($e,{as:"button",onClick:()=>{o(!1),ce.storage.set(Ye.DO_NOT_SHOW_RMT_MSG,"true")},children:p("Don't show me again")})]})]}),_.jsx(ds,{}),_.jsxs(Oe,{flex:1,overflow:"hidden",position:"relative",children:[_.jsxs(Oe,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[_.jsx(Se,{children:_.jsx(ri,{})}),_.jsx(cs,{})]}),_.jsx(Wi,{})]}),_.jsx("canvas",{style:{display:"none"}})]})}const us="rmg-templates-bridge--",fs={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function ps(p){const{isOpen:g,onClose:n,onImport:o}=p,[s]=X.useState(De()),t="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:ce.getAppName(),parentId:s});return X.useEffect(()=>{const e=new BroadcastChannel(us+s);return e.onmessage=r=>{const{event:l,meta:u,data:v}=r.data;console.log("[rmg] Received event from RMG Templates app clip:",l),l==="CLOSE"?n():l==="IMPORT"&&o(v,u.name)},()=>{e.close()}},[]),_.jsx(sn,{size:"xl",isOpen:g,onClose:n,sx:fs,children:_.jsx("iframe",{src:t,loading:"eager"})})}const ms={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function gs(p){const{selectedParam:g,disableNew:n,onError:o}=p,{t:s}=le(),[,t]=ft(),[e,r]=X.useState(!1),l=X.useRef(null),u=X.useRef(null);X.useEffect(()=>{var m;g&&((m=u.current)==null||m.focus())},[g]);const v=()=>{const m=rs(Q.MTR,ce.getLanguage()),h=bt(JSON.stringify(m));t({project:h}),ce.event(ve.NEW_PARAM,{})},f=(m,h)=>{const y=bt(JSON.stringify(m),h);t({project:y})},d=async m=>{var y;const h=(y=m.target.files)==null?void 0:y[0];console.log("handleImportProject():: received file",h);try{if(!h)o(s("OpenActions.unknownError"));else if(h.type!=="application/json")o(s("OpenActions.invalidType"));else{const b=await $r(h),x=bt(b);t({project:x}),ce.event(ve.UPLOAD_PARAM,{})}}catch(b){o(s("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",b)}m.target.value=""},a=()=>{g&&(t({project:g}),ce.event(ve.OPEN_PARAM,{}))};return _.jsxs(Oe,{sx:ms,children:[_.jsx(de,{leftIcon:_.jsx(Re,{}),onClick:v,isDisabled:n,children:s("Blank project")}),_.jsx(de,{leftIcon:_.jsx(Ur,{}),onClick:()=>r(!0),isDisabled:n,children:s("Open template")}),_.jsx(de,{leftIcon:_.jsx(Wr,{}),onClick:()=>{var m;return(m=l.current)==null?void 0:m.click()},isDisabled:n,children:s("Import project")}),_.jsx(de,{ref:u,colorScheme:"primary",leftIcon:_.jsx(Zr,{}),onClick:a,isDisabled:g===void 0,children:s("Open selected")}),_.jsx("input",{ref:l,type:"file",accept:".json",hidden:!0,onChange:d,"data-testid":"file-upload"}),_.jsx(ps,{isOpen:e,onClose:()=>r(!1),onImport:f})]})}const bs={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function _s(p){const{downloading:g}=p,{t:n}=le(),[o]=ft(),s=o.get("project"),[t,e]=X.useState([]),[r,l]=X.useState(),u=X.useRef(null),v=Xt();X.useEffect(()=>{e(_t())},[g]),Cn({ref:u,handler:()=>l(void 0)});const f=m=>{const{id:h,name:y,lastModified:b}=m;h&&(ce.storage.set(Ye.PARAM_CONFIG_BY_ID+h,JSON.stringify({name:y,lastModified:b})),l(void 0),e(_t()),ce.event(ve.UPDATE_PARAM_CONFIG,{}))},d=m=>{ce.storage.remove(Ye.PARAM_BY_ID+m),ce.storage.remove(Ye.PARAM_CONFIG_BY_ID+m),l(void 0),e(_t()),ce.event(ve.REMOVE_PARAM,{})},a=m=>{v({description:m,status:"error",duration:1e4,isClosable:!0})};return _.jsxs(an,{justifyContent:"center",children:[s&&_.jsx(ut,{isIndeterminate:!0}),_.jsx(jn,{children:_.jsxs(Be,{sx:bs,children:[_.jsx(ye,{as:"h3",size:"lg",children:n("Saved projects")}),_.jsxs(Oe,{ref:u,children:[_.jsx(Yr,{paramRegistry:t,downloading:g,selectedParam:r,onParamSelect:l,onParamRemove:d,onParamUpdate:f}),_.jsx(gs,{selectedParam:r,disableNew:t.length>=10,onError:a})]})]})})]})}const ys=p=>async g=>{try{const{config:n,param:o}=qr(p);if(!o)return!1;const s={id:p,...n!=null?n:{}},t=Kr(o);try{const e=await Xr(t);g(jt(s)),g(Vt(e))}catch(e){g(jt(s)),g(Vt(t))}return!0}catch(n){return console.warn("Failed to parse param.",n),!1}};function vs(){const{t:p}=le(),g=ue(),{paramConfig:n}=J(d=>d.app),[o,s]=ft(),t=o.get("project"),e=o.get("external"),[r,l]=X.useState(!1),[u,v]=X.useState(),f=Xt();return X.useEffect(()=>{if(console.log("searchParam: project=".concat(t,", external=").concat(e)),t&&e)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),s({project:t});else if(t)f.closeAll(),t===(n==null?void 0:n.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),l(!0)):(console.log("AppRouter:: Loading app view for param (ID=".concat(t,")...")),g(ys(t)).then(d=>{d?l(!0):(console.log("AppRouter:: Failed to read param (ID=".concat(t,"). Rendering param selector view...")),f({description:p("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),s({}))}));else if(e){console.log("AppRouter:: External project URl is provided. Downloading project...");const d=decodeURIComponent(e);v(d),Jr(d).then(a=>{a?s({project:a}):(console.log("AppRouter:: Failed to download param from ".concat(d,". Rendering param selector view...")),f({description:p("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),s({})),v(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),l(!1)},[t,e]),r?_.jsx(hs,{}):_.jsx(_s,{downloading:u})}const js=Object.freeze(Object.defineProperty({__proto__:null,default:vs},Symbol.toStringTag,{value:"Module"}));export{Qr as R,js as a,Cs as g,We as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-mhuy4KHT.js","assets/chakra-LCOuRCmM.js","assets/react-_H4gDEjW.js","assets/index-zC30_Mze.js","assets/index-e13pkHY7.css","assets/share-6xAjXClY.js","assets/mtr-AxHD9wEQ.js","assets/param-manager-utils-5KMxANin.js","assets/index-bF8GoVOo.js","assets/index-Zh0MyKal.js","assets/station-ag-grid-2l4fA8e1.js","assets/ag-grid-BFjBf33n.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}