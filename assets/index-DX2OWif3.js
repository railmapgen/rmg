import{j as s}from"./chakra-CXrhlirJ.js";import{a as m}from"./react-Caefwd5V.js";import{h as W,aY as R,u as z,m as Ze,S as O,aR as $,P as I}from"./index-BqOgmhc6.js";import{a as Xe,c as B,b as Ye,d as Ue}from"./share-C4aXWUdL.js";import{S as Ee}from"./svg-wrapper-DO1Iqw6o.js";import{i as Je}from"./param-selector-B7mXBf6L.js";function Ve(e){const{num:t,inStrip:a,...n}=e;return s.jsxs("g",{textAnchor:"middle",fill:a?W.black:"var(--rmg-theme-fg)",...n,children:[s.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:a?"#fff":"var(--rmg-theme-colour)"}),s.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),s.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),s.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})}const Re=e=>{const t=(r=>{switch(r){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":return 20;default:return 0}})(e.variant),a=m.useMemo(()=>{switch(e.variant){case"gz1":return s.jsx("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return s.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return s.jsx("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return s.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return s.jsx("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return s.jsx("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return s.jsx("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return s.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});default:return s.jsx(s.Fragment,{})}},[e.variant]);return s.jsxs("g",{transform:"translate(0,".concat(e.variant==="gz4"?-20:0,")"),children:[s.jsx("rect",{id:"strip_gz",style:{"--height":"".concat(t,"px")}}),s.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:e.isShowLight&&a}),e.isShowPSD!==!1&&s.jsx(qe,{...e})]})},qe=m.memo(function(t){const a=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),n=(r=>{switch(r){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";default:return"58px"}})(t.variant);return s.jsx(Ve,{num:t.isShowPSD,inStrip:a,style:{"--psd-dy":n,transform:"translate(var(--translate-x), var(--translate-y))","--translate-x":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))"}})},(e,t)=>e.variant===t.variant&&e.isShowPSD===t.isShowPSD);var A=1.3,Ie=1.7,U=18.5,Ke=U+A,X=U*2+A;var Z=45,P=Z-3,Ae=function(e,t){var a=[e,t].map(function(n){return n.match(/^(\w+).+$/)});if(a[0]&&a[1]&&a[0][1]===a[1][1])return a[0][1]},me=function(e){var t=e.match(/^(\d+)\D+$/);return t==null?void 0:t[1]},Q=function(){return Q=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},Q.apply(this,arguments)},Qe=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};function J(e){var t=e.customWidth,a=Qe(e,["customWidth"]),n=(t!=null?t:Z)-Z;return s.jsx("rect",Q({x:-22.5-n/2,height:24,width:t!=null?t:Z,rx:4.5},a,{"data-testid":"intBox"}))}var ee=function(){return ee=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ee.apply(this,arguments)},et=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},tt=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,i=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return i},nt=function(e,t){var a=me(e);if(a)return{isDigit:!0,spanningPart:a};var n=Ae(e,t);return n?{isDigit:!1,spanningPart:n}:{isDigit:!1,spanningPart:""}};function pe(e){var t=e.zhName,a=e.enName,n=e.foregroundColour,r=e.backgroundColour,i=e.zhClassName,o=e.enClassName,l=e.passed,c=e.children,d=et(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),f=nt(t,a),x=f.isDigit,u=f.spanningPart,g=m.useRef(null),h=tt(m.useState({x:0,height:0,width:0}),2),y=h[0],p=h[1];m.useEffect(function(){g.current&&p(g.current.getBBox())},[t,a]);var j=P/Math.max(P,y.width),S=(-y.x-y.width/2)*j,v=y.height*(1-j)/2;return s.jsxs("g",ee({textAnchor:"middle",fill:l?W.white:n},d,{children:[s.jsx(J,{fill:l?"#aaa":r}),s.jsx("g",{ref:g,transform:"translate(".concat(S,",").concat(v,")scale(").concat(j,")"),children:s.jsxs("text",{className:i,fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",children:[u,s.jsx("tspan",{className:i,fontSize:10,x:0,dy:-4,textAnchor:"start",dominantBaseline:"central",children:t.slice(u.length).trim()}),s.jsx("tspan",{className:o,fontSize:6.5,letterSpacing:-.1,x:0,dy:10,textAnchor:"start",dominantBaseline:"middle",children:x?a:a.slice(u.length).trim()})]})}),c]}))}var te=function(){return te=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},te.apply(this,arguments)},rt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},ve=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,i=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return i};function at(e){var t,a=e.zhName,n=e.enName,r=e.foregroundColour,i=e.backgroundColour,o=e.zhClassName,l=e.enClassName,c=e.passed,d=e.children,f=rt(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),x=(t=me(a))!==null&&t!==void 0?t:"",u=m.useRef(null),g=m.useRef(null),h=ve(m.useState({width:0}),2),y=h[0],p=h[1],j=ve(m.useState({width:0}),2),S=j[0],v=j[1];m.useEffect(function(){u.current&&p(u.current.getBBox()),g.current&&v(g.current.getBBox())},[a,n]);var _=P/Math.max(P,y.width),N=P/Math.max(P,S.width),C={nameZh:{y:7.3+13.5*(1-_)*_/2},nameEn:{y:19.5-9*(1-N)*N/2}};return s.jsxs("g",te({textAnchor:"middle",fill:c?W.white:r},f,{children:[s.jsx(J,{fill:c?"#aaa":i}),s.jsxs("text",{ref:u,className:o,fontSize:12,transform:"translate(0,".concat(C.nameZh.y,")scale(").concat(_,")"),dominantBaseline:"central",children:[s.jsx("tspan",{fontSize:16,dy:.7,dominantBaseline:"central",children:x}),s.jsx("tspan",{dy:-.7,dominantBaseline:"central",children:a.slice(x.length)})]}),s.jsx("text",{ref:g,className:l,fontSize:8,transform:"translate(0,".concat(C.nameEn.y,")scale(").concat(N,")"),dominantBaseline:"middle",children:n}),d]}))}var ne=function(){return ne=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ne.apply(this,arguments)},st=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},ot=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,i=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return i};function it(e){var t=e.zhName,a=e.enName,n=e.foregroundColour,r=e.backgroundColour,i=e.zhClassName,o=e.enClassName,l=e.passed,c=e.children,d=st(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),f=m.useRef(null),x=ot(m.useState({width:0}),2),u=x[0],g=x[1];m.useEffect(function(){f.current&&g(f.current.getBBox())},[t,a]);var h=Math.max(45,u.width+4);return s.jsxs("g",ne({textAnchor:"middle",fill:l?W.white:n},d,{children:[s.jsx(J,{customWidth:h,fill:l?"#aaa":r}),s.jsxs("g",{ref:f,children:[s.jsx("text",{className:i,fontSize:8.5,y:8,dominantBaseline:"central",children:t}),s.jsx("text",{className:o,fontSize:5.5,y:18,dominantBaseline:"middle",children:a})]}),c]}))}var re=function(){return re=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},re.apply(this,arguments)},lt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},_e=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,i=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return i};function ct(e){var t=e.zhName,a=e.enName,n=e.foregroundColour,r=e.backgroundColour,i=e.zhClassName,o=e.enClassName,l=e.passed,c=e.children,d=lt(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),f=m.useRef(null),x=m.useRef(null),u=_e(m.useState({width:0}),2),g=u[0],h=u[1],y=_e(m.useState({width:0}),2),p=y[0],j=y[1];m.useEffect(function(){f.current&&h(f.current.getBBox()),x.current&&j(x.current.getBBox())},[t,a]);var S=P/Math.max(P,g.width),v=P/Math.max(P,p.width),_={nameZh:{y:7.3+13.5*(1-S)*S/2},nameEn:{y:19.5-9*(1-v)*v/2}};return s.jsxs("g",re({textAnchor:"middle",fill:l?W.white:n},d,{children:[s.jsx(J,{fill:l?"#aaa":r}),s.jsx("text",{ref:f,className:i,fontSize:12,transform:"translate(0,".concat(_.nameZh.y,")scale(").concat(S,")"),dominantBaseline:"central",children:t}),s.jsx("text",{ref:x,className:o,fontSize:8,transform:"translate(0,".concat(_.nameEn.y,")scale(").concat(v,")"),dominantBaseline:"middle",children:a}),c]}))}var T=function(){return T=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},T.apply(this,arguments)};const Me=m.memo(function(t){var a=t.zhName,n=t.enName,r=t.spanDigits,i=dt(a,n);switch(i){case 1:return r?s.jsx(pe,T({},t)):s.jsx(at,T({},t));case 2:return s.jsx(pe,T({},t));default:return a.length>=5?s.jsx(it,T({},t)):s.jsx(ct,T({},t))}});var dt=function(e,t){var a=me(e);if(a!==void 0)return 1;var n=Ae(e,t);return n!==void 0?2:3},ae=function(){return ae=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ae.apply(this,arguments)},ut=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},L=5,H=5.625,je=U-L,Se=U-2*H;const Te=m.memo(function(t){var a=t.stroke,n=t.filled,r=t.bolder,i=ut(t,["stroke","filled","bolder"]),o="M0,9.25 V-9.25 H-".concat(je," l-").concat(L,",").concat(H," v").concat(Se," l").concat(L,",").concat(H," H").concat(je," l").concat(L,",-").concat(H," v-").concat(Se," l-").concat(L,",-").concat(H," H0");return s.jsx("path",ae({d:o,fill:n?a:"#fff",strokeWidth:r?Ie:A,stroke:a},i))});var se=function(){return se=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},se.apply(this,arguments)},mt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};const De=m.memo(function(t){var a=t.stroke,n=t.filled,r=t.bolder,i=mt(t,["stroke","filled","bolder"]),o="M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0";return s.jsx("path",se({d:o,fill:n?a:"#fff",strokeWidth:r?Ie:A,stroke:a},i))});var ft={updateId:0,update:function(){}},ht=m.createContext(ft),oe=function(){return oe=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},oe.apply(this,arguments)},gt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},Ne=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,i=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return i},G=17,We=m.forwardRef(function(t,a){var n=t.Icon,r=t.lineNum,i=t.stnNum,o=t.strokeColour,l=t.passed,c=t.size,d=t.textClassName,f=t.bolderBorder,x=t.alwaysShowColouredBorder,u=t.useSameScale,g=t.children,h=gt(t,["Icon","lineNum","stnNum","strokeColour","passed","size","textClassName","bolderBorder","alwaysShowColouredBorder","useSameScale","children"]),y=m.useContext(ht).updateId,p=m.useRef(null),j=m.useRef(null),S=Ne(m.useState({width:0}),2),v=S[0],_=S[1],N=Ne(m.useState({width:0}),2),C=N[0],k=N[1];m.useEffect(function(){p.current&&_(p.current.getBBox()),j.current&&k(j.current.getBBox())},[r,i,y]);var b=r&&r.length>2;m.useEffect(function(){u&&b&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[u,b]);var w=G/Math.max(G,v.width),E=u&&(r==null?void 0:r.length)===2?w:G/Math.max(G,C.width),D=c==="sm"?"0.7":c==="lg"?"1.4":1;return s.jsxs("g",oe({ref:a},h,{children:[s.jsxs("g",{transform:"scale(".concat(D,")"),children:[s.jsx(n,{stroke:l&&!x?"#aaa":o,filled:!r&&!i,bolder:f}),(r||i)&&s.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:l?"#aaa":"#000",children:[s.jsx("g",{transform:"translate(-9.25,0)scale(".concat(w,")"),children:s.jsx("text",{ref:p,className:d,dominantBaseline:"central",x:.5,children:r})}),s.jsx("g",{transform:"translate(9.25,0)scale(".concat(E,")"),children:s.jsx("text",{ref:j,className:d,dominantBaseline:"central",children:i})})]})]}),g]}))}),ie=function(){return ie=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ie.apply(this,arguments)},xt=m.forwardRef(function(t,a){return s.jsx(We,ie({Icon:Te},t,{ref:a}))}),le=function(){return le=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},le.apply(this,arguments)},fe=m.forwardRef(function(t,a){return s.jsx(We,le({Icon:De},t,{ref:a}))}),ce=function(){return ce=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ce.apply(this,arguments)},yt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};function be(e){var t=e.position,a=yt(e,["position"]),n=t==="right"?"rotate(180)":"rotate(0)";return s.jsx("circle",ce({cx:-X*.4,cy:0,r:X/4,stroke:"#aaa",strokeWidth:A*1.75,fill:"white",strokeDasharray:"2.7 2.5",transform:n},a))}var Y=function(){return Y=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},Y.apply(this,arguments)},Oe=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},we=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,i=[],o;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(l){o={error:l}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return i},V=function(e,t){return Array.from(Array(e).keys()).map(function(a){return(a-(e-1)/2)*t})},pt=function(e,t,a){if(e<=0)return[];if(e===1)return[[0,0]];for(var n=t>e?e:t,r=X,i=Ke,o=V(n,r),l=Math.ceil(e/n),c=V(l,i),d=e%n,f=[],x=0;x<l;x++){var u=a?l-1:0;if(d===0||x!==u)for(var g=0;g<n;g++)f.push([o[g],c[x]]);else for(var h=V(d,r),g=0;g<d;g++)f.push([h[g],c[x]])}return f},ze=function(e){return e==="fmetro"?Te:De},M=A*7,q=A*2.2;m.forwardRef(function(t,a){var n=t.stations,r=t.textClassName,i=t.columns,o=i===void 0?2:i,l=t.topHeavy,c=t.anchorAt,d=t.osiPosition,f=t.children,x=Oe(t,["stations","textClassName","columns","topHeavy","anchorAt","osiPosition","children"]),u=m.useMemo(function(){return pt(n.length,o,l)},[n.length,o,l]),g=we(m.useMemo(function(){if(c===void 0)return[0,0];if(c<0||c>=u.length)return console.warn("<InterchangeStation2024/>, anchor index ".concat(c," is out of bound")),[0,0];var v=we(u[c],2),_=v[0],N=v[1];return[-_,-N]},[u,c]),2),h=g[0],y=g[1],p=m.useRef(null),j=m.useRef([]);m.useEffect(function(){j.current=j.current.slice(0,n.length)},[n.length]);var S=n.length===2&&o===1&&!!d;return m.useImperativeHandle(a,function(){return{target:p.current,children:j.current,getCoordinates:function(){return u},getCorrectedBBox:function(){var v,_,N=(_=(v=p.current)===null||v===void 0?void 0:v.getBBox())!==null&&_!==void 0?_:{x:0,y:0,width:0,height:0};return N.y-=M/2,N.height+=M,S?(d==="left"?N.x-=q/2:N.x-=M/2,N.width+=q/2+M/2):(N.x-=M/2,N.width+=M),N},getTranslate:function(){return[h,y]}}},[u,h,y,p.current,j.current,d]),s.jsxs("g",Y({ref:p,transform:"translate(".concat(h,",").concat(y,")")},x,{children:[n.map(function(v,_){var N=v.style,C=ze(N);return s.jsx(C,{stroke:"#aaa",filled:!0,strokeWidth:M,transform:"translate(".concat(u[_][0],",").concat(u[_][1],")")},_)}),S&&s.jsx(be,{position:d,r:X/2.9,strokeWidth:q,strokeDasharray:void 0}),n.map(function(v,_){var N=v.style,C=ze(N);return s.jsx(C,{stroke:"white",filled:!0,strokeWidth:A*2.6,transform:"translate(".concat(u[_][0],",").concat(u[_][1],")")},_)}),S&&s.jsx(be,{position:d}),n.length&&s.jsx("rect",{fill:"white",x:-12,y:u[0][1],width:24,height:-u[0][1]*2}),n.map(function(v,_){var N=v.style,C=Oe(v,["style"]),k=N==="fmetro"?xt:fe;return s.jsx(k,Y({ref:function(b){return j.current[_]=b},transform:"translate(".concat(u[_][0],",").concat(u[_][1],")"),textClassName:r},C),_)}),f]}))});var de=function(){return de=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},de.apply(this,arguments)},F=9,Le=10*Math.PI/180,vt=F*Math.sin(Le),_t=F*Math.cos(Le),Be="M0,".concat(F," A").concat(F,",").concat(F," 0 0,0 ").concat(vt,",-").concat(_t);function jt(e){return s.jsxs("g",de({},e,{children:[s.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),s.jsx("path",{d:Be,stroke:"red",strokeWidth:3,fill:"none"}),s.jsx("path",{d:Be,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),s.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]}))}var ue=function(){return ue=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ue.apply(this,arguments)},St=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},Nt=m.forwardRef(function(t,a){var n=t.clockwise,r=t.anchorAt,i=r===void 0?"text":r,o=St(t,["clockwise","anchorAt"]),l=i==="circle"?29:0;return s.jsx("g",ue({ref:a},o,{children:s.jsxs("g",{transform:"translate(".concat(l,",0)"),children:[s.jsx(jt,{transform:"translate(-30,0)scale(".concat(n?-1:1,",1)")}),s.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),s.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})}))});const bt=m.memo(function(t){const{stnName:a,onUpdate:n}=t,{zh:r="",en:i=""}=a,o=m.useRef(null);return m.useEffect(()=>{o.current&&n&&n(o.current.getBBox())},[JSON.stringify(a)]),s.jsxs("g",{ref:o,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:18,children:r}),s.jsx("g",{fontSize:10.5,children:i.split("\\").map((l,c)=>s.jsx("text",{className:"rmg-name__en",dy:16+c*11,children:l},c))})]})},(e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName));function Ot(e){const{stnName:t,onUpdate:a,passed:n,...r}=e,{zh:i="",en:o=""}=t,l=m.useRef(null),[c,d]=m.useState({x:0,width:0});return m.useEffect(()=>{if(l.current){const f=l.current.getBBox();d(f),a==null||a(f)}},[JSON.stringify(t)]),!i&&!o?s.jsx(s.Fragment,{}):s.jsxs("g",{fill:n?"#aaa":"#000",...r,children:[s.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[s.jsx("text",{textAnchor:"end",x:c.x-3,className:"rmg-name__zh",children:"("}),s.jsx("text",{textAnchor:"start",x:c.width+c.x+3,className:"rmg-name__zh",children:")"})]}),s.jsxs("g",{ref:l,textAnchor:"middle",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:13,children:i}),s.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:o})]})]})}function wt(e){const{passed:t,...a}=e;return s.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...a,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),s.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function zt(e){var g,h,y;const{primaryName:t,secondaryName:a,stationState:n,flipped:r,express:i}=e,[o,l]=m.useState({width:0}),[c,d]=m.useState({x:0,width:-20}),f=p=>{switch(p){case R.PASSED:return"#aaa";case R.CURRENT:return"#f00";case R.FUTURE:return"#000"}},x=(y=(h=(g=t.en)==null?void 0:g.split("\\"))==null?void 0:h.length)!=null?y:1,u={g:{x:0,y:r?17.5:-20-x*14*Math.cos(-45)},StationSecondaryName:{x:(o.width+c.width/2+10)*(r?-1:1),y:2+5*(x-1)},ExpressTag:{x:(o.width+c.width+20+35)*(r?-1:1),y:2+5*(x-1)}};return s.jsxs("g",{textAnchor:r?"end":"start",fill:f(n),transform:"translate(".concat(u.g.x,",").concat(u.g.y,")rotate(-45)"),children:[s.jsx(bt,{stnName:t,onUpdate:l}),a&&s.jsx(Ot,{stnName:a,onUpdate:d,passed:n===R.PASSED,transform:"translate(".concat(u.StationSecondaryName.x,",").concat(u.StationSecondaryName.y,")")}),i&&s.jsx(wt,{passed:n===R.PASSED,transform:"translate(".concat(u.ExpressTag.x,",").concat(u.ExpressTag.y,")")})]})}function Bt(e){var C,k,b,w,E,D,ge,xe,ye;const{stnId:t,stnState:a,stnY:n}=e,{theme:r,line_name:i,line_num:o,spanLineNum:l,stn_list:c,loop:d,loop_info:{midpoint_station:f,clockwise:x}}=z(Ge=>Ge.param),u=c[t],g=f===t,[h,y]=m.useState({height:0}),p=m.useRef(null);m.useEffect(()=>{p.current&&y(p.current.getBBox())},[p.current,n,u.localisedName,u.localisedSecondaryName,u.services]);const j=u.parents.length===2||u.children.length===2,S=n>0||u.parents.indexOf(((k=(C=u.branch)==null?void 0:C.left)==null?void 0:k[1])||"")===1||u.children.indexOf(((w=(b=u.branch)==null?void 0:b.right)==null?void 0:w[1])||"")===1?180:0,v=(ge=(D=(E=u.localisedName.en)==null?void 0:E.split("\\"))==null?void 0:D.length)!=null?ge:1,_=j?S===180?16+(v-1)*12*Math.cos(-45):-9:S===180?-6:(25+(v-1)*15)*Math.cos(-45),N=n>0?h.height+23:-h.height-23;return s.jsxs(s.Fragment,{children:[s.jsx($t,{intInfos:j?[{theme:[r[0],r[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:i},...(xe=u.transfer.groups[0].lines)!=null?xe:[]]:(ye=u.transfer.groups[0].lines)!=null?ye:[],stnState:d?R.FUTURE:a,tickRotation:S,spanDigits:l}),s.jsx(fe,{lineNum:o,stnNum:u.num,strokeColour:r[2],textClassName:"rmg-name__zh",passed:a===-1,alwaysShowColouredBorder:d,bolderBorder:!0,useSameScale:!0}),s.jsx("g",{ref:p,transform:"translate(".concat(-_,",0)"),children:s.jsx(zt,{primaryName:u.localisedName,secondaryName:u.localisedSecondaryName,stationState:a,flipped:S===180,express:u.services.includes(Ze.express)})}),g&&s.jsx(Nt,{transform:"translate(0,".concat(N,")"),clockwise:x,anchorAt:n>0?"text":"circle"})]})}const $t=e=>s.jsxs(s.Fragment,{children:[s.jsx(Ct,{strokeWidth:4,...e}),s.jsx(kt,{transform:"translate(0,".concat(e.tickRotation===180?-47:23,")"),...e})]}),Ct=e=>{const{intInfos:t,stnState:a,tickRotation:n,spanDigits:r,...i}=e;return s.jsx("g",{...i,children:t.map((o,l)=>{var c;return s.jsx("use",{xlinkHref:"#inttick",stroke:a===-1?"#aaa":(c=o.theme)==null?void 0:c[2],transform:"translate(".concat(-2*(t.length-1)+4*l,",0)rotate(").concat(n===180?180:0,")")},l)})})},kt=e=>{const{intInfos:t,tickRotation:a,stnState:n,spanDigits:r,...i}=e;return s.jsx("g",{...i,children:t.map((o,l)=>{var c,d,f,x;return s.jsx("g",{transform:"translate(0,".concat(l*28*(a===180?-1:1),")"),children:s.jsx(Me,{zhName:o.name[0],enName:o.name[1],foregroundColour:(d=(c=o.theme)==null?void 0:c[3])!=null?d:W.white,backgroundColour:(x=(f=o.theme)==null?void 0:f[2])!=null?x:"#aaaaaa",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",passed:n===-1,spanDigits:r})},l)})})};function He(e){const{xs:t,ys:a,stnStates:n}=e,{stn_list:r,loop:i}=z(c=>c.param),{branches:o}=z(c=>c.helper),l=i?o[0].slice(1,-1):Object.keys(r);return s.jsx("g",{id:"stn_icons",children:l.filter(c=>!["linestart","lineend"].includes(c)).map(c=>s.jsx("g",{style:{transform:"translate(".concat(t[c],"px,").concat(a[c],"px)")},children:s.jsx(Bt,{stnId:c,stnState:n[c],stnY:a[c]})},c))})}const $e=(e,t)=>e[t].parents.length===2||e[t].children.length===2?.25:0,Pt=(e,t,a)=>{const n=B("linestart","lineend",t);if(n.nodes.includes(e))return B(n.nodes[1],e,t).len;{const r=a.filter(d=>d.includes(e))[0];let i=e;for(;!n.nodes.includes(i);)i=r[r.indexOf(i)-1];let o=e;for(;!n.nodes.includes(o);)o=r[r.indexOf(o)+1];const l=i==="linestart",c=o==="lineend";if(r.toString()===a[0].toString()){const d=[];return!l&&!c?(d[0]=B(n.nodes[1],i,t).len,d[1]=B(i,o,t).len,d[2]=B(i,e,t).len,d[3]=B(e,o,t).len):l?(d[0]=0,d[1]=B(n.nodes[1],o,t).len,d[2]=B(r[1],e,t).len,d[3]=B(e,o,t).len):(d[0]=B(n.nodes[1],i,t).len,d[1]=B(i,n.nodes.slice(-2)[0],t).len,d[2]=B(i,e,t).len,d[3]=B(e,r.slice(-2)[0],t).len),d[0]+d[2]*d[1]/(d[2]+d[3])}else if(!l&&!c){const d=[];return d[0]=B(n.nodes[1],i,t).len,d[1]=B(i,o,t).len,d[2]=B(i,e,t).len,d[3]=B(e,o,t).len,d[0]+d[2]*d[1]/(d[2]+d[3])}else return l?B(n.nodes[1],o,t).len-B(e,o,t).len:B(n.nodes[1],i,t).len+B(i,e,t).len}},Et=()=>{const{branches:e,routes:t,depsStr:a}=z(b=>b.helper),{svgWidth:n,svg_height:r,y_pc:i,padding:o,branchSpacingPct:l,direction:c,line_name:d,spanLineNum:f,current_stn_idx:x,stn_list:u}=z(b=>b.param),g=Xe(u,$e,$e),h=m.useMemo(()=>(console.log("computing x shares"),Object.keys(u).reduce((b,w)=>({...b,[w]:Pt(w,g,e)}),{})),[e.toString(),JSON.stringify(g)]),y=B("linestart","lineend",g),p=B(y.nodes[1],y.nodes.slice(-2)[0],g),j=c===O.right?[n[$.RailMap]*o/100+65,n[$.RailMap]*(1-o/100)-20]:[n[$.RailMap]*o/100,n[$.RailMap]*(1-o/100)-65],S=Object.keys(h).reduce((b,w)=>({...b,[w]:j[0]+h[w]/p.len*(j[1]-j[0])}),{}),v=m.useMemo(()=>(console.log("computing y shares"),Object.keys(u).reduce((b,w)=>{if(e[0].includes(w))return{...b,[w]:0};{const E=e.slice(1).filter(D=>D.includes(w))[0];return{...b,[w]:u[E[0]].children.indexOf(E[1])?-2:2}}},{})),[a]),_=Object.keys(v).reduce((b,w)=>({...b,[w]:-v[w]*l*r/200}),{}),N=m.useMemo(()=>Ye(x,t,c),[x,c,t.toString()]),C=e.map(b=>Ue(b,N)).reduce((b,w)=>(b.main.push(w.main),b.pass.push(w.pass),b),{main:[],pass:[]}),k=Object.keys(C).reduce((b,w)=>({...b,[w]:C[w].map(E=>It(E,S,_))}),{});return s.jsxs("g",{id:"main",style:{"--y-percentage":i,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[s.jsx(Rt,{paths:k}),s.jsx(He,{xs:S,ys:_,stnStates:N}),s.jsx("g",{id:"line_name",style:{"--translate-x":c===O.right?"".concat(j[0]-65,"px"):"".concat(j[1]+65,"px")},children:s.jsx(Me,{zhName:d[0],enName:d[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:f})})]})},Rt=m.memo(function(t){return s.jsxs("g",{fill:"none",strokeWidth:4,children:[s.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((a,n)=>s.jsx("path",{d:a},n))}),s.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((a,n)=>s.jsx("path",{d:a},n))})]})},(e,t)=>JSON.stringify(e.paths)===JSON.stringify(t.paths)),It=(e,t,a)=>{let n;const r=[];return e.forEach(i=>{const o=t[i],l=a[i];if(!n&&n!==0){n=l,r.push("M ".concat(o,",").concat(l));return}l===0?(l<n&&r.push("H ".concat(o-40),"a 40,40 0 0,0 40,-40","V ".concat(l)),l>n&&r.push("H ".concat(o-40),"a 40,40 0 0,1 40,40","V ".concat(l))):(l<n&&r.push("V ".concat(l+40),"a 40,40 0 0,1 40,-40","H ".concat(o)),l>n&&r.push("V ".concat(l-40),"a 40,40 0 0,0 40,40","H ".concat(o))),r.push("H ".concat(o)),n=l}),r.join(" ").replace(/( H ([\d.]+))+/g," H $2")};function he(e){return s.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black",...e})}function At(e){const{destIds:t,textAnchor:a,...n}=e,r=z(d=>d.param.direction),i=z(d=>d.param.stn_list),o=t.map(d=>{var f,x;return(x=(f=i[d].localisedName.zh)==null?void 0:f.length)!=null?x:0}),l=Math.min(...o),c=l>1&&o[0]!==o[1]?Math.abs(o[0]-o[1])/(l-1):0;return s.jsxs("g",{textAnchor:a,...n,children:[t.map((d,f)=>{var g;const x=o[f]>o[1-f],u=!Je()&&a==="end"&&!x;return s.jsxs(m.Fragment,{children:[s.jsx("text",{className:"rmg-name__zh",fontSize:25,x:r===O.left?0:-75,y:-21+42*f,letterSpacing:x?"0em":"".concat(c,"em"),dx:u?"".concat(c,"em"):"0em",children:i[d].localisedName.zh}),s.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:r===O.left?0:-75,y:-1+42*f,children:"Towards "+((g=i[d].localisedName.en)==null?void 0:g.replace("\\"," "))})]},d)}),s.jsx("text",{className:"rmg-name__zh",fontSize:28,x:r===O.left?25*(Math.max(...o)+1):0,y:5,children:"方向"})]})}const Mt=(e,t,a,n)=>{const o=e*(1-2*t/100)*(a-1)/a-n,l=e-o;return[l/2,e-l/2]},Tt=(e,t,a)=>{const n=Math.min(...Object.values(e)),r=Math.max(...Object.values(e)),i=Math.min(...Object.values(t)),l=Math.max(...Object.values(t))-i,c=l/2;return"M".concat(r,",").concat(i," H").concat(n," h-").concat(a/2," a").concat(c,",").concat(c," 0 0,0 0,").concat(l," H").concat(r," h").concat(a/2," a").concat(c,",").concat(c," 0 0,0 0,-").concat(l,"Z")},Dt=(e,t,a,n)=>{const r=e.indexOf(a),i=e.indexOf(n!=null?n:a);let o;return i<0?o=e:t?o=r<=i?[...e.slice(0,r+1),...e.slice(i)]:e.slice(i,r+1):o=r<i?e.slice(r,i+1):[...e.slice(r),...e.slice(0,i+1)],e.reduce((l,c,d)=>r===d?{...l,[c]:R.CURRENT}:o.includes(c)?{...l,[c]:R.FUTURE}:{...l,[c]:R.PASSED},{})},Ce=6;function Wt({currentStationX:e,currentStationY:t,stationGap:a,loopClockwise:n}){const r=t>0?n?-1:1:n?1:-1,i=(a/3-Ce)*r,o=e+i+Ce*r,l=(t-12)*-r;return s.jsx("g",{transform:"scale(1,".concat(-r,")"),children:s.jsx("path",{d:"M".concat(o,",").concat(l," h").concat(i),strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function ke({clockwise:e,...t}){return s.jsx("g",{...t,children:s.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:16,children:e?"内环":"外环"}),s.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:e?"Inner Circle":"Outer Circle"})]})})}const Fe=2/3,Lt=2-Fe,Ht=25*Math.PI/180,Ft=Math.asin(Math.sin(35*Math.PI/180)/2);function Gt({cxLeft:e,cxRight:t,yGap:a,clockwise:n}){const r=a/2,i=r*(n?Fe:Lt),o=n?Ht:Ft,l=i*Math.cos(o),c=n?1:-1,d=n?1:0,f=i*Math.sin(o)*c,x=2*f,u={rotate:n?"-4deg":"2deg"};return s.jsxs(s.Fragment,{children:[s.jsxs("g",{transform:"translate(".concat(e,",0)"),children:[s.jsx("path",{d:"M".concat(-l,",").concat(f," a").concat(i,",").concat(i," 0 0,").concat(d," 0,").concat(-x),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:u}),s.jsx(ke,{transform:"translate(".concat(n?0:-2*r,",0)"),clockwise:n})]}),s.jsxs("g",{transform:"translate(".concat(t,",0)"),children:[s.jsx("path",{d:"M".concat(l,",").concat(-f," a").concat(i,",").concat(i," 0 0,").concat(d," 0,").concat(x),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:u}),s.jsx(ke,{transform:"translate(".concat(n?0:2*r,",0)"),clockwise:n})]})]})}function Zt(){const{branches:e}=z(v=>v.helper),{svgWidth:t,svg_height:a,y_pc:n,padding:r,branchSpacingPct:i,current_stn_idx:o,loop_info:{midpoint_station:l,clockwise:c}}=z(v=>v.param),d=e[0].slice(1,-1),f=Math.ceil(d.length/2),x=m.useMemo(()=>(console.log("computing x shares"),d.reduce((v,_,N,C)=>{let k;return N<f?k=f-N-1:(k=N-f,C.length&1&&(k+=.5)),{...v,[_]:k}},{})),[d.toString()]),u=i*a*2/100,g=Mt(t[$.RailMap],r,f,u),h=(g[1]-g[0])/(f-1),y=Object.keys(x).reduce((v,_)=>({...v,[_]:g[0]+x[_]*h}),{}),p=m.useMemo(()=>(console.log("computing y shares"),d.reduce((v,_,N)=>({...v,[_]:N<f?1:-1}),{})),[d.toString()]),j=Object.keys(p).reduce((v,_)=>({...v,[_]:-p[_]*u/2}),{}),S=Dt(d,c!=null?c:!1,o,l);return s.jsxs("g",{id:"main",style:{"--y-percentage":n,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[s.jsx("path",{d:Tt(y,j,h),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),s.jsx(He,{xs:y,ys:j,stnStates:S}),s.jsx(Wt,{currentStationX:y[o],currentStationY:j[o],stationGap:h,loopClockwise:c}),s.jsx(Gt,{cxLeft:g[0]-h/2,cxRight:g[1]+h/2,yGap:u,clockwise:c})]})}const Pe=$.RailMap,Xt=()=>{const{canvasScale:e}=z(g=>g.app),{svgWidth:t,svg_height:a,direction:n,psd_num:r,info_panel_type:i,notesGZMTR:o,current_stn_idx:l,stn_list:c,theme:d,loop:f}=z(g=>g.param),x=t[Pe],u=c[l];return s.jsxs(Ee,{type:Pe,svgWidth:x,svgHeight:a,canvasScale:e,theme:d,children:[s.jsx(Yt,{}),s.jsx(Re,{variant:i,isShowLight:i===I.gz2otis,isShowPSD:i===I.gz2otis&&r}),n===O.left&&u.parents.includes("linestart")||n===O.right&&u.children.includes("lineend")?s.jsx(Vt,{}):s.jsxs(s.Fragment,{children:[f?s.jsx(Zt,{}):s.jsx(Et,{}),!f&&s.jsx(Ut,{}),o==null?void 0:o.map((g,h)=>s.jsx(qt,{note:g},h))]}),i===I.gz2otis&&s.jsx("line",{x2:x,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},Yt=m.memo(function(){return s.jsxs("defs",{children:[s.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),s.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:s.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),Ut=()=>{const{routes:e}=z(l=>l.helper),{direction:t,direction_gz_x:a,direction_gz_y:n,current_stn_idx:r}=z(l=>l.param),i=m.useMemo(()=>[...new Set(e.reduce((l,c)=>c.includes(r)?l.concat(c.filter(d=>!["linestart","lineend"].includes(d)).slice(t===O.left?0:-1)[0]):l,[]).filter(l=>l!==r))],[r,t,e.toString()]),o={textAnchor:t===O.left?"start":"end",transform:"translate(".concat(t===O.left?65:-65,",-5)"),destIds:i};return s.jsxs("g",{id:"direction_gz",style:{"--x-percentage":a,"--y-percentage":n},children:[s.jsx(he,{transform:"scale(0.35)rotate(".concat(t===O.left?0:180,")")}),i.length!==2?s.jsx(Jt,{...o}):s.jsx(At,{...o})]})},Jt=e=>{const{destIds:t,...a}=e,n=z(r=>r.param.stn_list);return s.jsxs("g",{...a,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(r=>n[r].localisedName.zh).join("/")+"方向"}),s.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(r=>{var i;return(i=n[r].localisedName.en)==null?void 0:i.replace("\\"," ")}).join("/")})]})},Vt=m.memo(function(){return s.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),s.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),s.jsxs("g",{strokeWidth:8,stroke:"#000",children:[s.jsx("path",{d:"M -160,68 h -160"}),s.jsx("path",{d:"M 160,68 h 160"})]})]})}),qt=m.memo(function(t){const a=m.useRef(null),[n,r]=m.useState({width:0,height:0,y:0});return m.useEffect(()=>{a.current&&r(a.current.getBBox())},[t.note[0],t.note[1]]),s.jsxs("g",{className:"note-box",style:{"--x-percentage":t.note[2],"--y-percentage":t.note[3]},children:[t.note[4]&&s.jsx("rect",{height:n.height+4,width:n.width+4,x:-2,y:n.y-2,fill:"none",stroke:"black",strokeWidth:.5}),s.jsxs("g",{ref:a,children:[s.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((i,o)=>s.jsx("text",{className:"rmg-name__zh",y:o*18,children:i},o))}),s.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((i,o)=>{var l;return s.jsx("text",{className:"rmg-name__en",y:o*11,textLength:o<(((l=t.note[1].match(/\n/g))==null?void 0:l.length)||0)?n.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:i},o)})})]})]})},(e,t)=>e.note.toString()===t.note.toString()),Kt=m.memo(function(t){var i,o;const{stnName:a,onUpdate:n}=t,r=m.useRef(null);return m.useEffect(()=>{r.current&&n&&n(r.current.getBBox())},[JSON.stringify(a)]),s.jsxs("g",{ref:r,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:90,children:a.zh}),s.jsx("g",{fontSize:36,children:(o=(i=a.en)==null?void 0:i.split("\\"))==null?void 0:o.map((l,c)=>s.jsx("text",{className:"rmg-name__en",dy:70+c*36,children:l},c))})]})},(e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName)),Qt=e=>{const{secondaryName:t,transform:a}=e,n=m.useRef(null),[r,i]=m.useState({x:0,width:0});return m.useEffect(()=>{n.current&&i(n.current.getBBox())},[t.toString()]),s.jsxs("g",{transform:a,children:[s.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[s.jsx("text",{textAnchor:"end",x:r.x-3,className:"rmg-name__zh",children:"("}),s.jsx("text",{textAnchor:"start",x:r.width+r.x+3,className:"rmg-name__zh",children:")"})]}),s.jsxs("g",{ref:n,textAnchor:"middle",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),s.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},en=()=>{var y,p,j;const{svg_height:e,svgWidth:t,theme:a,direction:n,info_panel_type:r,line_num:i,current_stn_idx:o,stn_list:l}=z(S=>S.param),c=l[o],[d,f]=m.useState({width:0}),x=(j=(p=(y=c.localisedName.en)==null?void 0:y.split("\\"))==null?void 0:p.length)!=null?j:1,u=c[n===O.left?"parents":"children"],g={name:"translate(".concat((n===O.left?1:-1)*t[$.RunIn]/4,",45)"),next:"translate(".concat((n===O.left?1:-1)*t[$.RunIn]/10,",45)")},h={nameGroup:{x:t.runin/2,y:.5*e-50-(x-1)*18-(c.localisedSecondaryName?29:0)},secondaryName:{x:0,y:70+x*36}};return s.jsxs("g",{children:[s.jsxs("g",{transform:r===I.gz2otis?g.name:"",children:[s.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(h.nameGroup.x,",").concat(h.nameGroup.y,")"),children:[s.jsx(Kt,{stnName:c.localisedName,onUpdate:f}),c.localisedSecondaryName&&s.jsx(Qt,{secondaryName:c.localisedSecondaryName,transform:"translate(".concat(h.secondaryName.x,",").concat(h.secondaryName.y,")")})]}),s.jsx(fe,{lineNum:i,stnNum:c.num,strokeColour:a[2],textClassName:"rmg-name__zh",style:{"--translate-x":"".concat((t[$.RunIn]+d.width)/2+55,"px"),"--translate-y":"".concat(.5*e-30-(x-1)*18-(c.localisedSecondaryName?58/2:0),"px"),transform:"translate(var(--translate-x, 800px), var(--translate-y, 145px))"},size:"lg"})]}),s.jsx("g",{transform:r===I.gz2otis?g.next:"",children:!u||u.includes("linestart")||u.includes("lineend")?s.jsx(s.Fragment,{}):u.length===1?s.jsx(tn,{nextId:u[0],nameBBox:d}):s.jsx(rn,{nextIds:u,nameBBox:d})})]})},tn=e=>{const{nextId:t,nameBBox:a}=e,n=z(y=>y.param.svgWidth),r=z(y=>y.param.direction),i=z(y=>y.param.stn_list[t]),{localisedName:o,localisedSecondaryName:l}=i,{zh:c="",en:d=""}=o,[f,x]=m.useState({width:0}),u=m.useRef(null);m.useEffect(()=>{u.current&&x(u.current.getBBox())},[c,d]);const g=c.length,h=(n[$.RunIn]-a.width)/2;return s.jsxs(s.Fragment,{children:[s.jsxs("g",{id:"big_next",children:[s.jsxs("g",{textAnchor:"middle",style:{"--translate-x":r===O.left?"80px":g<=2?"".concat(n[$.RunIn]-45-f.width-70,"px"):"".concat(n[$.RunIn]-45-f.width-35*1.5,"px")},children:[s.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),s.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),s.jsxs("g",{textAnchor:"start",ref:u,style:{"--translate-x":r===O.left?g<=2?"150px":"".concat(115+35/2,"px"):"".concat(n[$.RunIn]-45-f.width,"px")},children:[s.jsx("text",{className:"rmg-name__zh",fontSize:35,children:c}),s.jsx("g",{fontSize:17,children:d.split("\\").map((y,p)=>s.jsx("text",{className:"rmg-name__en",dy:30+p*17,children:y},p))})]}),l&&s.jsx("g",{textAnchor:"middle",style:{"--translate-x":r===O.left?g<=2?"150px":"".concat(115+35/2,"px"):"".concat(n[$.RunIn]-45-f.width,"px")},children:s.jsx(nn,{secName:l,transform:"translate(".concat(f.width/2,",").concat(30+d.split("\\").length*17+5,")")})})]}),s.jsx(he,{id:"arrow",style:{"--translate-x":r===O.left?"".concat((115+35*((g<=2?1:.5)+g)+h)/2-20,"px"):"".concat((n[$.RunIn]-45-f.width-(g<=2?105:35*2.5)+h+e.nameBBox.width+55+18.5*1.4)/2+20,"px"),"--rotate":r===O.left?"0deg":"180deg"}})]})},nn=e=>{const{secName:t,...a}=e,{zh:n,en:r}=t,i=m.useRef(null),[o,l]=m.useState({x:0,width:0});return m.useEffect(()=>{i.current&&l(i.current.getBBox())},[n,r]),s.jsxs("g",{...a,children:[s.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[s.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),s.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),s.jsxs("g",{ref:i,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:18,children:n}),s.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:r})]})]})},rn=e=>{const{nextIds:t,nameBBox:a}=e,{routes:n}=z(h=>h.helper),r=z(h=>h.param.svgWidth),i=z(h=>h.param.direction),o=z(h=>h.param.stn_list),l=t.map(h=>o[h].localisedName),[c,d]=m.useState({width:0}),f=m.useRef([]);m.useEffect(()=>{d(h=>({...h,width:0})),f.current.forEach(h=>{const y=h==null?void 0:h.getBBox();d(p=>y?p.width>y.width?p:y:p)})},[l.toString()]);const x=e.nextIds.map(h=>n.reduce((y,p)=>p.includes(h)?y.concat(p.filter(j=>!["linestart","lineend"].includes(j)).slice(i===O.left?0:-1)[0]):y,[])),u=Math.max(...l.map(h=>{var y,p;return(p=(y=h.zh)==null?void 0:y.length)!=null?p:0})),g=(r[$.RunIn]-a.width)/2;return s.jsxs(s.Fragment,{children:[s.jsx("g",{id:"big_next_2",children:l.map((h,y)=>{var p,j;return s.jsxs(m.Fragment,{children:[s.jsxs("g",{textAnchor:"middle",style:{"--translate-x":i===O.left?"72px":"".concat(r[$.RunIn]-45-c.width-41,"px")},children:[s.jsx("text",{className:"rmg-name__zh",children:"下站"}),s.jsx("text",{className:"rmg-name__en",y:22,children:"Next"})]}),s.jsxs("g",{ref:S=>f.current[y]=S,textAnchor:"start",style:{"--translate-x":i===O.left?"113px":"".concat(r[$.RunIn]-45-c.width,"px")},children:[s.jsx("text",{className:"rmg-name__zh",children:h.zh}),(j=(p=h.en)==null?void 0:p.split("\\"))==null?void 0:j.map((S,v)=>s.jsx("text",{className:"rmg-name__en",y:22+v*13,children:S},v)),s.jsx("text",{className:"rmg-name__zh",y:-35,children:x[y].map(S=>o[S].localisedName.zh).join("/")+"方向"}),s.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+x[y].map(S=>o[S].localisedName.en).join("/").replace("\\"," ")})]})]},y)})}),s.jsx(he,{id:"arrow",style:{"--translate-x":i===O.left?"".concat((99+27*(1+u)+g)/2-20,"px"):"".concat((r[$.RunIn]-45-c.width-41-27+g+e.nameBBox.width+55+18.5*1.4)/2+20,"px"),"--rotate":i===O.left?"0deg":"180deg"}})]})};function an(e){const{num:t,...a}=e;return s.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...a,children:[s.jsx("circle",{cx:0,cy:0,r:30,fill:"var(--rmg-theme-colour)"}),s.jsx("text",{className:"rmg-name__en",fontSize:38,dy:-9.5,children:t}),s.jsx("text",{className:"rmg-name__zh",fontSize:13,dy:10,children:"站台"}),s.jsx("text",{className:"rmg-name__en",fontSize:9,dy:21,children:"Platform"})]})}function sn(e){const{canvasType:t}=e,{svgWidth:a,svg_height:n}=z(r=>r.param);return s.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[s.jsx("line",{y2:n,transform:"translate(".concat(a[t]/2,",0)")}),s.jsx("line",{x2:a[t],transform:"translate(0,90)"})]})}const K=$.RunIn;function on(){const{canvasScale:e}=z(f=>f.app),{svgWidth:t,svg_height:a,direction:n,info_panel_type:r,platform_num:i,psd_num:o,theme:l}=z(f=>f.param),c=t[K],d={platform:"translate(".concat(n===O.left?50:-50,",45)")};return s.jsxs(Ee,{type:K,svgWidth:c,svgHeight:a,canvasScale:e,theme:l,children:[s.jsx(Re,{variant:r,isShowLight:r!==I.gz2otis,isShowPSD:r!==I.gz2otis&&o}),s.jsx("g",{transform:r===I.gz2otis?d.platform:"",children:s.jsx(an,{num:i,style:{"--translate-x":"".concat(n===O.left?c-100:100,"px"),"--translate-y":"calc(var(--rmg-svg-height) / 2 - 30px)",transform:"translate(var(--translate-x, 100px), var(--translate-y))"}})}),s.jsx(en,{}),r===I.gz2otis&&s.jsx(sn,{canvasType:K})]})}const hn={runin:s.jsx(on,{}),railmap:s.jsx(Xt,{})};export{hn as default};
