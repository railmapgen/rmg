System.register(["./index-legacy-BBuv-yrc.js","./chakra-legacy-OvwQ_II1.js","./react-legacy-BR1l8Q-0.js"],(function(e,t){"use strict";var n,i,s,a,o,r,l,c,d,u,h,g,f,p,_,m,v,b,y,j,x,w,O,A,D,C,R,S,M,P,k,N,T,E;return{setters:[e=>{n=e.i,i=e.ag,s=e.aO,a=e.aP,o=e.af,r=e.e,l=e.a8,c=e.aL,d=e.aQ,u=e.r,h=e.g,g=e.aE,f=e.aR,p=e.aS,_=e.k},e=>{m=e.u,v=e.j,b=e.c,y=e.g,j=e.aP,x=e.aw,w=e.$,O=e.ax,A=e.a1,D=e.a2,C=e.a3,R=e.a5,S=e.O,M=e.B,P=e.N,k=e.af,N=e.a4},e=>{T=e.r,E=e.u}],execute:function(){e({P:function(e){const{paramRegistry:t,downloading:n,selectedParam:i,onParamSelect:s,onParamRemove:a,onParamUpdate:o}=e,{t:r}=E(),[l,c]=T.useState();return v.jsxs(M,{sx:V,children:[v.jsxs(y,{children:[n&&v.jsx(f,{variant:"ghost",primaryText:r("Downloading")+"...",secondaryText:n,isDisabled:!0}),t.slice().sort(((e,t)=>{var n,i;return(null!==(n=t.lastModified)&&void 0!==n?n:0)-(null!==(i=e.lastModified)&&void 0!==i?i:0)})).map((e=>{var t;return v.jsxs(P,{size:"sm",isAttached:!0,colorScheme:i===e.id?"primary":void 0,variant:i===e.id?"solid":"ghost",children:[v.jsx(f,{primaryText:null!==(t=e.name)&&void 0!==t?t:r("Project")+" "+e.id,secondaryText:r("Last modified")+": "+L(e.lastModified).map((e=>r(e))).join(" "),"aria-pressed":i===e.id,onClick:()=>s(e.id)}),o&&v.jsx(k,{"aria-label":r("Edit project info"),title:r("Edit project info"),icon:v.jsx(p,{}),onClick:()=>c(e)}),a&&v.jsx(k,{"aria-label":r("Remove project"),title:r("Remove project"),icon:v.jsx(_,{}),onClick:()=>a(e.id)})]},e.id)}))]}),t.length>=10&&v.jsx(N,{as:"em",fontSize:"xs",children:r("You have reached the maximum number of projects.")}),v.jsx(J,{config:l,onClose:()=>c(void 0),onUpdate:e=>{null==o||o(e),c(void 0)}})]})},R:I});var t=function(e){var t=e.children,n=e.noWrap,i=m("RmgOutput",{noWrap:n});return v.jsx(b.output,{sx:i,children:t})};function I(e){var r=e.fields,l=e.noLabel,c=e.minW;return v.jsx(y,{wrap:"wrap",children:r.map((function(e,r){if(e.hidden)return v.jsx(T.Fragment,{},r);var d=e.minW||c,u="full"===d;return v.jsx(n,{className:u?"mw-full":"",label:e.label,flex:u?void 0:1,minW:u?void 0:d,noLabel:l,oneLine:e.oneLine,children:function(e){switch(e.type){case"input":return v.jsx(o,{placeholder:e.placeholder,defaultValue:e.value,type:e.variant,validator:e.validator,onDebouncedChange:e.onChange,delay:e.debouncedDelay,optionList:e.optionList,isDisabled:e.isDisabled});case"output":return v.jsx(t,{noWrap:e.noWrap,children:e.value});case"textarea":return v.jsx(a,{placeholder:e.placeholder,defaultValue:e.value,onDebouncedChange:e.onChange,isDisabled:e.isDisabled});case"slider":return v.jsx(s,{defaultValue:e.value,min:e.min,max:e.max,step:e.step,onThrottledChange:e.onChange,leftIcon:e.leftIcon,rightIcon:e.rightIcon,isDisabled:e.isDisabled});case"select":return v.jsx(i,{defaultValue:e.value,onChange:function(t){var n,i=t.target.value;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,"number"==typeof e.value?Number(i):i.toString())},options:e.options,disabledOptions:e.disabledOptions,isInvalid:e.isInvalid,isDisabled:e.isDisabled});case"switch":return v.jsx(j,{isChecked:e.isChecked,isDisabled:e.isDisabled,onChange:function(t){var n,i=t.target.checked;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,i)}});case"custom":return e.component;default:return v.jsx("div",{})}}(e)},r)}))})}e("a",((e,t,n)=>{const i=new Blob([n],{type:t});W(e,i)}));const W=e("d",((e,t)=>{const n=window.URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)})),L=(e("r",(e=>new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsText(e)})))),e("i",(()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))),e=>{if(e){const t=(new Date).getTime()-e;return t<6e4?["Just now"]:t<12e4?["1","minute ago"]:t<36e5?[Math.floor(t/1e3/60).toString(),"minutes ago"]:t<72e5?["1","hour ago"]:t<864e5?[Math.floor(t/1e3/60/60).toString(),"hours ago"]:t<1728e5?["1","day ago"]:[Math.floor(t/1e3/60/60/24).toString(),"days ago"]}return["Unknown"]}),z=(e("w",(e=>new Promise((t=>{setTimeout(t,e)})))),e("u",(e=>{var t,n,i;"line_name"in e||(e.line_name=["路線名","Name of Line"]),delete e.fontZH,delete e.fontEN,delete e.weightZH,delete e.weightEN;for(const[r,l]of Object.entries(e.stn_list))"branch"in l||(e.stn_list[r].branch={},2===l.children.length&&(e.stn_list[r].branch.right=["through",l.children[1]]),2===l.parents.length&&(e.stn_list[r].branch.left=["through",l.parents[1]]),0===Object.keys(e.stn_list[r].branch).length&&delete e.stn_list[r].branch);e.psd_num="psd_num"in e?e.psd_num.toString():"1","line_num"in e||(e.line_num="1"),3===e.theme.length&&e.theme.push("#fff");for(const[r,l]of Object.entries(e.stn_list))"num"in l||(e.stn_list[r].num="00"),"interchange"in l&&l.interchange.map((e=>e.forEach((e=>{5===e.length&&e.splice(3,0,"#fff")}))));for(const[r,l]of Object.entries(e.stn_list))"osi22_end_p"===l.change_type&&(e.stn_list[r].change_type="osi22_pr"),"osi22_end_u"===l.change_type&&(e.stn_list[r].change_type="osi22_ur");for(const[r,l]of Object.entries(e.stn_list))"interchange"in l||(e.stn_list[r].interchange=[[]]);e.info_panel_type="info_panel_type"in e?(e=>{switch(e){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return e}})(e.info_panel_type):"gz28","direction_gz_x"in e||(e.direction_gz_x=50),"direction_gz_y"in e||(e.direction_gz_y=70);for(const[r,l]of Object.entries(e.stn_list)){var s,a,o,c;"transfer"in l||(e.stn_list[r].transfer={tick_direc:"none"===l.change_type||"int2"===l.change_type?"r":null===(s=l.change_type)||void 0===s?void 0:s.split("_")[1].split("").slice().reverse()[0],paid_area:-1===(null===(a=l.change_type)||void 0===a?void 0:a.indexOf("osi"))||"p"===(null===(o=l.change_type)||void 0===o?void 0:o.split("_")[1][0]),osi_names:-1!==(null===(c=l.change_type)||void 0===c?void 0:c.indexOf("osi"))?[l.interchange[1][0]]:[],info:2===l.interchange.length?[l.interchange[0],l.interchange[1].slice(1)]:l.interchange}),delete e.stn_list[r].change_type,delete e.stn_list[r].interchange}for(const[r,l]of Object.entries(e.stn_list))"services"in l||(e.stn_list[r].services=["local"]),"facility"in l?""===l.facility&&(e.stn_list[r].facility=void 0):e.stn_list[r].facility=l.usage||void 0,delete e.stn_list[r].usage;"customiseMTRDest"in e||(e.customiseMTRDest={isLegacy:e.dest_legacy||!1,terminal:!1}),delete e.dest_legacy,"svgWidth"in e||(e.svgWidth={destination:e.svg_dest_width,runin:e.svg_dest_width,railmap:e.svg_width,indoor:e.svg_width}),"indoor"in e.svgWidth||(e.svgWidth.indoor=e.svgWidth.railmap),delete e.svg_width,delete e.svg_dest_width,e.notesGZMTR=null===(t=e.notesGZMTR)||void 0===t?void 0:t.map((e=>4===e.length?e.concat([!1]):e)),delete e.char_form,delete e.show_outer,delete e.strip_pc,delete e.txt_bg_gap,"namePosMTR"in e||(e.namePosMTR={isStagger:!0,isFlip:e.txt_flip}),delete e.txt_flip,Object.keys(e.stn_list).forEach((t=>{"secondaryName"in e.stn_list[t]&&!1===e.stn_list[t].secondaryName&&delete e.stn_list[t].secondaryName,"type"in e.stn_list[t].transfer&&delete e.stn_list[t].transfer.type})),e.style=void 0!==e.style&&Object.values(r).includes(e.style)?e.style:r.MTR,e.coline=null!==(n=e.coline)&&void 0!==n?n:[],e.loop=null!==(i=e.loop)&&void 0!==i&&i,e.loop_info=void 0===e.loop_info?{bank:!0,left_and_right_factor:0,bottom_factor:1}:{...e.loop_info,bottom_factor:Math.max(e.loop_info.bottom_factor,1)};for(const[r,l]of Object.entries(e.stn_list))"loop_pivot"in l||(e.stn_list[r].loop_pivot=!1);return Array.isArray(e.coline)&&(e.coline=e.coline.reduce(((e,t)=>({...e,[l(4)]:t})),{})),!1===e.platform_num&&(e.platform_num=""),Object.values(e.stn_list).forEach((t=>{var n,i;const s=t;s.one_line=null!==(n=s.one_line)&&void 0!==n&&n,s.int_padding=null!==(i=s.int_padding)&&void 0!==i?i:e.loop?250:355})),void 0===e.branchSpacingPct&&(e.style===r.SHMetro?e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*300):e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*200),delete e.branch_spacing),z(e),U(e),e})),e=>{for(const[t,n]of Object.entries(e.stn_list)){const i=n.transfer.info;i&&(e.stn_list[t].transfer.groups=i.map(((e,t)=>e.length?{name:n.transfer.osi_names[t-1],lines:e.map((e=>{const t=e;return{theme:t.slice(0,4),name:t.slice(4,6)}}))}:{lines:[]}))),delete e.stn_list[t].transfer.info,delete e.stn_list[t].transfer.osi_names}}),F=e=>4===e.length&&e.every((e=>"string"==typeof e))&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(h).includes(e[3]),$=(e,t,n)=>{const i=t.split(".");let s=e;for(let a=0;a<i.length-1;a++)s=s[i[a]];s[i[i.length-1]]=n},B=(e("f",(async e=>{const t=(new Date).getTime(),n=(e=>{const t=[],n=(e,i)=>{if(Array.isArray(e)&&F(e))t.push({path:i||"",value:e});else for(const s in e){const a=e[s],o=i?`${i}.${s}`:s;Array.isArray(a)?F(a)?t.push({path:o,value:a}):a.forEach(((e,t)=>n(e,`${o}.${t}`))):a&&"object"==typeof a&&n(a,o)}};return n(e),t})(e);c.info("Found all themes pending for update",n);const i=JSON.parse(JSON.stringify(e));let s,a=!1;const o=new Promise(((e,t)=>{s=setTimeout((()=>{a=!0,t("Executing time exceeds 5000ms")}),5e3),(async()=>{for(const{path:e,value:t}of n){if(a)throw new Error("Update aborted");const n=await d(t);$(i,e,n)}})().then(e).catch(t)}));try{return await o,c.info(`Themes update completed, elapsed time ${((new Date).getTime()-t)/1e3} sec`),i}catch(r){return c.warn(`Error occurs when updating themes, elapsed time ${((new Date).getTime()-t)/1e3} sec`,r),i}finally{clearTimeout(s)}})),{notesGZMTR:e=>!(null!=e&&e.length),"stn_list.*.branch.left":e=>!(null!=e&&e.length),"stn_list.*.branch.right":e=>!(null!=e&&e.length),"stn_list.*.branch":e=>!e||0===Object.keys(e).length,"stn_list.*.facility":e=>!e,"stn_list.*.secondaryName":e=>!e||","===e.join(","),"stn_list.*.transfer.groups.*.lines":e=>!(null!=e&&e.length)}),U=e("s",(e=>{const t=structuredClone(e);return Object.entries(B).forEach((([e,n])=>{Object.entries(((e,t)=>{const n={},i=(e,t,s)=>{var a;let o=e;for(let n=0;n<s.length-1;n++){var r;if("*"===s[n])return void Object.keys(o).forEach((e=>i(o,[...t,...s.slice(0,n)],[e,...s.slice(n+1)])));if(o=null===(r=o)||void 0===r?void 0:r[s[n]],void 0===o)return}var l;void 0!==(null===(a=o)||void 0===a?void 0:a[s[s.length-1]])&&(n[[...t,...s].join(".")]=null===(l=o)||void 0===l?void 0:l[s[s.length-1]])};return i(e,[],t.split(".")),n})(t,e)).forEach((([e,i])=>{c.debug("Sanitising",e,i),n(i)&&$(t,e,void 0)}))})),t.version=u.getAppVersion(),t})),Y=(e("c",(()=>{const e=(()=>{const e=`${u.getAppName()}__${g.PARAM_CONFIG_BY_ID}`,t=Object.entries(u.storage.getAll()).filter((([t])=>t.startsWith(e))).map((([t,n])=>{const i=t.slice(e.length);if(!n)return{id:i};try{return{...JSON.parse(n),id:i}}catch(s){return{id:i}}}));return c.info("loadParamRegistry(), Found param config in localStorage",t.map((e=>e.id))),t})(),t=`${u.getAppName()}__${g.PARAM_BY_ID}`,n=Object.keys(u.storage.getAll()).filter((e=>e.startsWith(t))).map((n=>{var i;const s=n.slice(t.length);return null!==(i=e.find((e=>e.id===s)))&&void 0!==i?i:{id:s}}));return c.info("getParamRegistry(), Actual param found in localStorage",n.map((e=>e.id))),e.filter((e=>n.every((t=>t.id!==e.id)))).forEach((e=>u.storage.remove(g.PARAM_CONFIG_BY_ID+e.id))),n})),e("g",(e=>{const t=u.storage.get(g.PARAM_CONFIG_BY_ID+e);return t?JSON.parse(t):t}))),G=(e("e",(e=>{const t=u.storage.get(g.PARAM_BY_ID+e);return{param:t?JSON.parse(t):t,config:Y(e)}})),e("b",((e,t)=>{const n=l();return u.storage.set(g.PARAM_BY_ID+n,e),u.storage.set(g.PARAM_CONFIG_BY_ID+n,JSON.stringify({name:t,lastModified:Date.now()})),n})));function J(e){var t;const{config:n,onClose:i,onUpdate:s}=e,{t:a}=E(),[o,r]=T.useState(null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"");T.useEffect((()=>{var e;n&&r(null!==(e=n.name)&&void 0!==e?e:"")}),[n]);const l=[{type:"input",label:a("Project name"),value:o,onChange:r,debouncedDelay:0}];return v.jsxs(x,{isOpen:!!n,onClose:i,isCentered:!0,children:[v.jsx(w,{}),v.jsxs(O,{children:[v.jsx(A,{children:a("Edit project info")}),v.jsx(D,{}),v.jsx(C,{children:v.jsx(I,{fields:l})}),v.jsx(R,{children:v.jsx(S,{colorScheme:"primary",onClick:()=>{var e;n&&(null!==(e=n.name)&&void 0!==e?e:"")!==o&&s({...n,name:o})},children:a("Confirm")})})]})]})}e("h",(async e=>{const t=e.split("/").at(-1);try{const n=await fetch(e);if(n.ok){const e=await n.text();return G(e,t)}return c.warn("Failed to download param"),null}catch(n){return c.warn("Failed to download param.",n),null}}));const V={flex:"2 1 0%",overflow:"hidden",minW:{base:"unset",md:240},w:{base:"100%",md:"unset"},mr:{base:0,md:2},mb:{base:2,md:0},"& > div":{flexDirection:"column",h:200,overflowX:"hidden",overflowY:"auto",borderRadius:"md",borderWidth:2,"& >.chakra-button":{alignItems:"center"},"& .chakra-button__group":{"& button:not(:first-of-type)":{h:"100%"}}}}}}}));
