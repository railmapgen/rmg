import{j as e}from"./chakra-jT2-teuD.js";import{a as h}from"./react-BNX4K-US.js";import{i as O,V as Ze,P as v,b2 as A,u as w,n as Ge,S as $,aY as T}from"./index-HyGScCuj.js";import{a as Xe,c as E,b as Ue,d as Ve}from"./share-BVgUIVfG.js";import{S as Be}from"./svg-wrapper-h0h12Ph0.js";import{i as Ye}from"./param-selector-Co1Y1OOn.js";function Je(n){const{num:t,psdLabel:r,inStrip:s,...a}=n;return e.jsxs("g",{textAnchor:"middle",fill:s?O.black:"var(--rmg-theme-fg)",...a,children:[e.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:s?"#fff":"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),r===Ze.platform?e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),e.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),e.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]})}const Ee=n=>{const t=(a=>{switch(a){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(n.variant),r=h.useMemo(()=>{switch(n.variant){case"gz1":return e.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return e.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return e.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return e.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return e.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return e.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return e.jsx(e.Fragment,{})}},[n.variant]);return e.jsxs("g",{transform:`translate(0,${n.variant==="gz4"?-15:0})`,style:{"--strip-height":`${t}px`},children:[e.jsx("rect",{id:"strip_gz"}),n.variant===v.gz1&&e.jsx("rect",{className:"gz1-gap"}),e.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:n.isShowLight&&r}),n.isShowPSD!==!1&&e.jsx(qe,{...n})]})},qe=h.memo(function(t){const r=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),s=(i=>{switch(i){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(t.variant),a=(i=>{switch(i){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(t.variant),o=[v.gz1,v.gz3,v.gz4,v.gz5,v.gz1421,v.gz7w,v.gz11].includes(t.variant);return e.jsx(Je,{num:t.isShowPSD,psdLabel:t.psdLabel,inStrip:r,style:{"--psd-dy":s,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":o?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":a}})},(n,t)=>n.variant===t.variant&&n.isShowPSD===t.isShowPSD&&n.psdLabel===t.psdLabel);function ve(n){var t,r,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var a=n.length;for(t=0;t<a;t++)n[t]&&(r=ve(n[t]))&&(s&&(s+=" "),s+=r)}else for(r in n)n[r]&&(s&&(s+=" "),s+=r);return s}function U(){for(var n,t,r=0,s="",a=arguments.length;r<a;r++)(n=arguments[r])&&(t=ve(n))&&(s&&(s+=" "),s+=t);return s}const M=1.3,Re=1.7,Q=18.5,Ke=Q+M,q=Q*2+M,Z=5,G=5.625,xe=Q-Z,ge=Q-2*G,be=h.memo(function(t){const{stroke:r,filled:s,bolder:a,...o}=t,i=`M0,9.25 V-9.25 H-${xe} l-${Z},${G} v${ge} l${Z},${G} H${xe} l${Z},-${G} v-${ge} l-${Z},-${G} H0`;return e.jsx("path",{d:i,fill:s?r:"#fff",strokeWidth:a?Re:M,stroke:r,...o})}),Qe={updateId:0,update:()=>{}},et=h.createContext(Qe),V=17,tt=["Arial"],Te=h.forwardRef(function(t,r){const{Icon:s,lineNum:a,stnNum:o,strokeColour:i,passed:c,size:m,bolderBorder:l,alwaysShowColouredBorder:d,useSameScale:x,className:g,classNames:j,children:u,textProps:S,...y}=t,{updateId:p}=h.useContext(et),f=h.useRef(null),N=h.useRef(null),[_,z]=h.useState({width:0}),[b,k]=h.useState({width:0}),H=()=>{f.current&&z(f.current.getBBox()),N.current&&k(N.current.getBBox())};h.useEffect(()=>{const C=new AbortController;return H(),document.fonts.load("12px "+tt.join(", "),(a??"")+(o??"")).then().finally(()=>{setTimeout(()=>{C.signal.aborted||H()},100)}),()=>{C.abort()}},[a,o,p]);const L=a&&a.length>2,P=o&&o.length>2;h.useEffect(()=>{x&&(L||P)&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[x,L,P]);const F=V/Math.max(V,_.width),B=x&&!L&&!P?F:V/Math.max(V,b.width),R=m==="sm"?"0.7":m==="lg"?"1.6":1;return e.jsxs("g",{ref:r,className:U(j?.wrapper,g),...y,children:[e.jsxs("g",{transform:`scale(${R})`,children:[e.jsx(s,{stroke:c&&!d?"#aaa":i,filled:!a&&!o,bolder:l}),(a||o)&&e.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:c?"#aaa":"#000",children:[e.jsx("g",{transform:`translate(-9.25,0)scale(${F})`,children:e.jsx("text",{ref:f,dominantBaseline:"central",x:.5,className:j?.digits,...S,children:a})}),e.jsx("g",{transform:`translate(9.25,0)scale(${B})`,children:e.jsx("text",{ref:N,dominantBaseline:"central",className:j?.digits,...S,children:o})})]})]}),u]})}),nt=h.forwardRef(function(t,r){return e.jsx(Te,{Icon:be,...t,ref:r})}),J=45,I=J-3,ke=(n,t)=>{const r=[n,t].map(s=>s.match(/^(\w+).+$/));if(r[0]&&r[1]&&r[0][1]===r[1][1])return r[0][1]},me=n=>n.match(/^(\d+)\D+$/)?.[1];function ee(n){const{customWidth:t,...r}=n,s=(t??J)-J;return e.jsx("rect",{x:-22.5-s/2,height:24,width:t??J,rx:4.5,...r,"data-testid":"intBox"})}const st=(n,t)=>{const r=me(n);if(r)return{isDigit:!0,spanningPart:r};const s=ke(n,t);return s?{isDigit:!1,spanningPart:s}:{isDigit:!1,spanningPart:""}},ue=h.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:l,classNames:d,children:x,textProps:g,...j}=t,{isDigit:u,spanningPart:S}=st(s,a),y=h.useRef(null),[p,f]=h.useState({x:0,height:0,width:0});h.useEffect(()=>{y.current&&f(y.current.getBBox())},[s,a]);const N=I/Math.max(I,p.width),_=(-p.x-p.width/2)*N,z=p.height*(1-N)/2;return e.jsxs("g",{ref:r,textAnchor:"middle",fill:c?O.white:o,className:U(d?.wrapper,l),...j,children:[e.jsx(ee,{fill:c?"#aaa":i}),e.jsxs("g",{ref:y,transform:`translate(${_},${z})scale(${N})`,children:[e.jsx("text",{fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",className:d?.digits,...g?.digits,children:S}),e.jsx("text",{fontSize:10,x:0,y:8,textAnchor:"start",dominantBaseline:"central",className:d?.zh,...g?.zh,children:s.slice(S.length).trim()}),e.jsx("text",{fontSize:6.5,letterSpacing:-.1,x:0,y:18,textAnchor:"start",dominantBaseline:"middle",className:d?.en,...g?.en,children:u?a:a.slice(S.length).trim()})]}),x]})}),rt=h.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:l,classNames:d,children:x,textProps:g,...j}=t,u=me(s)??"",S=h.useRef(null),y=h.useRef(null),[p,f]=h.useState({x:0,width:0}),[N,_]=h.useState({width:0});h.useEffect(()=>{S.current&&f(S.current.getBBox()),y.current&&_(y.current.getBBox())},[s,a]);const z=I/Math.max(I,p.width),b=I/Math.max(I,N.width),k={nameZh:{x:-(p.x+p.width/2)*z,y:7.3+13.5*(1-z)*z/2*z},nameEn:{y:19.5-9*(1-b)*b/2}};return e.jsxs("g",{ref:r,fill:c?O.white:o,className:U(d?.wrapper,l),...j,children:[e.jsx(ee,{fill:c?"#aaa":i}),e.jsxs("g",{ref:S,transform:`translate(${k.nameZh.x},${k.nameZh.y})scale(${z})`,children:[e.jsx("text",{ref:S,fontSize:16,textAnchor:"end",y:.7,dominantBaseline:"central",className:d?.digits,...g?.digits,children:u}),e.jsx("text",{fontSize:12,textAnchor:"start",dominantBaseline:"central",className:d?.zh,...g?.zh,children:s.slice(u.length)})]}),e.jsx("text",{ref:y,fontSize:8,textAnchor:"middle",transform:`translate(0,${k.nameEn.y})scale(${b})`,dominantBaseline:"middle",className:d?.en,...g?.en,children:a}),x]})}),at=h.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:l,classNames:d,children:x,textProps:g,...j}=t,u=h.useRef(null),[S,y]=h.useState({width:0});h.useEffect(()=>{u.current&&y(u.current.getBBox())},[s,a]);const p=Math.max(45,S.width+4);return e.jsxs("g",{ref:r,textAnchor:"middle",fill:c?O.white:o,className:U(d?.wrapper,l),...j,children:[e.jsx(ee,{customWidth:p,fill:c?"#aaa":i}),e.jsxs("g",{ref:u,children:[e.jsx("text",{fontSize:8.5,y:8,dominantBaseline:"central",className:d?.zh,...g?.zh,children:s}),e.jsx("text",{fontSize:5.5,y:18,dominantBaseline:"middle",className:d?.en,...g?.en,children:a})]}),x]})}),ot=h.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:l,classNames:d,children:x,textProps:g,...j}=t,u=h.useRef(null),S=h.useRef(null),[y,p]=h.useState({width:0}),[f,N]=h.useState({width:0});h.useEffect(()=>{u.current&&p(u.current.getBBox()),S.current&&N(S.current.getBBox())},[s,a]);const _=I/Math.max(I,y.width),z=I/Math.max(I,f.width),b={nameZh:{y:7.3+13.5*(1-_)*_/2},nameEn:{y:19.5-9*(1-z)*z/2}};return e.jsxs("g",{ref:r,textAnchor:"middle",fill:c?O.white:o,className:U(d?.wrapper,l),...j,children:[e.jsx(ee,{fill:c?"#aaa":i}),e.jsx("text",{ref:u,fontSize:12,transform:`translate(0,${b.nameZh.y})scale(${_})`,dominantBaseline:"central",className:d?.zh,...g?.zh,children:s}),e.jsx("text",{ref:S,fontSize:8,transform:`translate(0,${b.nameEn.y})scale(${z})`,dominantBaseline:"middle",className:d?.en,...g?.en,children:a}),x]})}),he=h.memo(h.forwardRef(function(t,r){const{zhName:s,enName:a,spanDigits:o}=t;switch(it(s,a)){case 1:return o?e.jsx(ue,{ref:r,...t}):e.jsx(rt,{ref:r,...t});case 2:return e.jsx(ue,{ref:r,...t});default:return s.length>=5?e.jsx(at,{ref:r,...t}):e.jsx(ot,{ref:r,...t})}})),it=(n,t)=>me(n)!==void 0?1:ke(n,t)!==void 0?2:3,Ae=h.memo(function(t){const{stroke:r,filled:s,bolder:a,...o}=t;return e.jsx("path",{d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:s?r:"#fff",strokeWidth:a?Re:M,stroke:r,...o})}),de=h.forwardRef(function(t,r){return e.jsx(Te,{Icon:Ae,...t,ref:r})});function fe({position:n,...t}){const r=n==="right"?"rotate(180)":"rotate(0)";return e.jsx("circle",{cx:-q*.4,cy:0,r:q/4,stroke:"#aaa",strokeWidth:M*1.75,fill:"white",strokeDasharray:"2.7 2.5",transform:r,...t})}const ne=(n,t)=>Array.from(Array(n).keys()).map(r=>(r-(n-1)/2)*t),ct=(n,t,r)=>{if(n<=0)return[];if(n===1)return[[0,0]];const s=t>n?n:t,a=q,o=Ke,i=ne(s,a),c=Math.ceil(n/s),m=ne(c,o),l=n%s,d=[];for(let x=0;x<c;x++){const g=r?c-1:0;if(l===0||x!==g)for(let j=0;j<s;j++)d.push([i[j],m[x]]);else{const j=ne(l,a);for(let u=0;u<l;u++)d.push([j[u],m[x]])}}return d},pe=n=>n==="fmetro"?be:Ae,D=M*7,se=M*2.2;h.forwardRef(function({stations:t,classNames:r,textProps:s,columns:a=2,topHeavy:o,anchorAt:i,osiPosition:c,children:m,...l},d){const x=h.useMemo(()=>ct(t.length,a,o),[t.length,a,o]),[g,j]=h.useMemo(()=>{if(i===void 0)return[0,0];if(i<0||i>=x.length)return console.warn(`<InterchangeStation2024/>, anchor index ${i} is out of bound`),[0,0];{const[p,f]=x[i];return[-p,-f]}},[x,i]),u=h.useRef(null),S=h.useRef([]);h.useEffect(()=>{S.current=S.current.slice(0,t.length)},[t.length]);const y=t.length===2&&a===1&&!!c;return h.useImperativeHandle(d,()=>({target:u.current,children:S.current,getCoordinates:()=>x,getCorrectedBBox:()=>{const p=u.current?.getBBox()??{x:0,y:0,width:0,height:0};return p.y-=D/2,p.height+=D,y?(c==="left"?p.x-=se/2:p.x-=D/2,p.width+=se/2+D/2):(p.x-=D/2,p.width+=D),p},getTranslate:()=>[g,j]}),[x,g,j,u.current,S.current,c]),e.jsxs("g",{ref:u,transform:`translate(${g},${j})`,...l,children:[t.map(({style:p},f)=>{const N=pe(p);return e.jsx(N,{stroke:"#aaa",filled:!0,strokeWidth:D,transform:`translate(${x[f][0]},${x[f][1]})`},f)}),y&&e.jsx(fe,{position:c,r:q/2.9,strokeWidth:se,strokeDasharray:void 0}),t.map(({style:p},f)=>{const N=pe(p);return e.jsx(N,{stroke:"white",filled:!0,strokeWidth:M*2.6,transform:`translate(${x[f][0]},${x[f][1]})`},f)}),y&&e.jsx(fe,{position:c}),t.length&&e.jsx("rect",{fill:"white",x:-12,y:x[0][1],width:24,height:-x[0][1]*2}),t.map(({style:p,...f},N)=>{const _=p==="fmetro"?nt:de;return e.jsx(_,{ref:z=>S.current[N]=z,transform:`translate(${x[N][0]},${x[N][1]})`,classNames:r,textProps:s,...f},N)}),m]})});const X=9,Ie=10*Math.PI/180,lt=X*Math.sin(Ie),mt=X*Math.cos(Ie),Ne=`M0,${X} A${X},${X} 0 0,0 ${lt},-${mt}`;function ht(n){return e.jsxs("g",{...n,children:[e.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),e.jsx("path",{d:Ne,stroke:"red",strokeWidth:3,fill:"none"}),e.jsx("path",{d:Ne,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),e.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]})}const dt=h.forwardRef(function({clockwise:t,anchorAt:r="text",...s},a){const o=r==="circle"?29:0;return e.jsx("g",{ref:a,...s,children:e.jsxs("g",{transform:`translate(${o},0)`,children:[e.jsx(ht,{transform:`translate(-30,0)scale(${t?-1:1},1)`}),e.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),e.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})})}),xt=h.memo(function(t){const{stnName:r,onUpdate:s,onEnNameUpdate:a}=t,{zh:o="",en:i=""}=r,c=h.useRef(null);return h.useEffect(()=>{if(c.current){s?.(c.current.getBBox());const m=c.current.querySelector("g");m&&a?.(m.getBBox())}},[JSON.stringify(r),c.current]),e.jsxs("g",{ref:c,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:o}),e.jsx("g",{fontSize:10.5,children:i.split("\\").map((m,l)=>e.jsx("text",{className:"rmg-name__en",dy:16+l*11,children:m},l))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName));function gt(n){const{stnName:t,onUpdate:r,passed:s,...a}=n,{zh:o="",en:i=""}=t,c=h.useRef(null),[m,l]=h.useState({x:0,width:0});return h.useEffect(()=>{if(c.current){const d=c.current.getBBox();l(d),r?.(d)}},[JSON.stringify(t)]),!o&&!i?e.jsx(e.Fragment,{}):e.jsxs("g",{fill:s?"#aaa":"#000",...a,children:[e.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[e.jsx("text",{textAnchor:"end",x:m.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:m.width+m.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:c,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:o}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:i})]})]})}function ut(n){const{passed:t,...r}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...r,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function ft(n){const{passed:t,temporary:r,...s}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...s,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),e.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),r&&e.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function pt(n){const{primaryName:t,secondaryName:r,stationState:s,flipped:a,express:o,underConstruction:i}=n,[c,m]=h.useState({width:0}),[l,d]=h.useState({width:0}),[x,g]=h.useState({x:0,width:-20}),j=y=>{switch(y){case A.PASSED:return"#aaa";case A.CURRENT:return"#f00";case A.FUTURE:return"#000"}},u=t.en?.split("\\")?.length??1,S={g:{x:0,y:a?17.5:-20-u*14*Math.cos(-45)},StationSecondaryName:{x:(c.width+x.width/2+10)*(a?-1:1),y:2+5*(u-1)},ExpressTag:{x:(c.width+x.width+20+35)*(a?-1:1),y:2+5*(u-1)},UnderConstructionTag:{x:(l.width+5+20)*(a?-1:1),y:c.y+c.height-14}};return e.jsxs("g",{textAnchor:a?"end":"start",fill:j(s),transform:`translate(${S.g.x},${S.g.y})rotate(-45)`,children:[e.jsx(xt,{stnName:t,onUpdate:m,onEnNameUpdate:d}),r&&e.jsx(gt,{stnName:r,onUpdate:g,passed:s===A.PASSED,transform:`translate(${S.StationSecondaryName.x},${S.StationSecondaryName.y})`}),o&&e.jsx(ut,{passed:s===A.PASSED,transform:`translate(${S.ExpressTag.x},${S.ExpressTag.y})`}),i&&e.jsx(ft,{passed:s===A.PASSED,temporary:i==="temp",transform:`translate(${S.UnderConstructionTag.x},${S.UnderConstructionTag.y})`})]})}function Nt(n){const{stnId:t,stnState:r,stnY:s}=n,{theme:a,line_name:o,line_num:i,spanLineNum:c,stn_list:m,loop:l,loop_info:{midpoint_station:d,clockwise:x}}=w(b=>b.param),g=m[t],j=d===t,[u,S]=h.useState({height:0}),y=h.useRef(null);h.useEffect(()=>{y.current&&S(y.current.getBBox())},[y.current,s,g.localisedName,g.localisedSecondaryName,g.services]);const p=g.parents.length===2||g.children.length===2,f=s>0||g.parents.indexOf(g.branch?.left?.[1]||"")===1||g.children.indexOf(g.branch?.right?.[1]||"")===1?180:0,N=g.localisedName.en?.split("\\")?.length??1,_=p?f===180?16+(N-1)*12*Math.cos(-45):-9:f===180?-6:(25+(N-1)*15)*Math.cos(-45),z=s>0?u.height+23:-u.height-23;return e.jsxs(e.Fragment,{children:[e.jsx(St,{intInfos:p?[{theme:[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:o},...g.transfer.groups[0].lines??[]]:g.transfer.groups[0].lines??[],stnState:l?A.FUTURE:r,tickRotation:f,spanDigits:c}),e.jsx(de,{lineNum:i,stnNum:g.num,strokeColour:a[2],classNames:{digits:"rmg-name__zh"},passed:r===-1,alwaysShowColouredBorder:l,bolderBorder:!0,useSameScale:!0}),e.jsx("g",{ref:y,transform:`translate(${-_},0)`,children:e.jsx(pt,{primaryName:g.localisedName,secondaryName:g.localisedSecondaryName,stationState:r,flipped:f===180,express:g.services.includes(Ge.express),underConstruction:g.underConstruction})}),j&&e.jsx(dt,{transform:`translate(0,${z})`,clockwise:x,anchorAt:s>0?"text":"circle"})]})}const St=n=>e.jsxs(e.Fragment,{children:[e.jsx(jt,{strokeWidth:4,...n}),e.jsx(_t,{transform:`translate(0,${n.tickRotation===180?-47:23})`,...n})]}),jt=n=>{const{intInfos:t,stnState:r,tickRotation:s,spanDigits:a,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>e.jsx("use",{xlinkHref:"#inttick",stroke:r===-1?"#aaa":i.theme?.[2],transform:`translate(${-2*(t.length-1)+4*c},0)rotate(${s===180?180:0})`},c))})},_t=n=>{const{intInfos:t,tickRotation:r,stnState:s,spanDigits:a,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>e.jsx("g",{transform:`translate(0,${c*28*(r===180?-1:1)})`,children:e.jsx(he,{zhName:i.name[0],enName:i.name[1],foregroundColour:i.theme?.[3]??O.white,backgroundColour:i.theme?.[2]??"#aaaaaa",passed:s===-1,spanDigits:a,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})},c))})};function We(n){const{xs:t,ys:r,stnStates:s}=n,{stn_list:a,loop:o}=w(m=>m.param),{branches:i}=w(m=>m.helper),c=o?i[0].slice(1,-1):Object.keys(a);return e.jsx("g",{id:"stn_icons",children:c.filter(m=>!["linestart","lineend"].includes(m)).map(m=>e.jsx("g",{style:{transform:`translate(${t[m]}px,${r[m]}px)`},children:e.jsx(Nt,{stnId:m,stnState:s[m],stnY:r[m]})},m))})}const Se=(n,t)=>n[t].parents.length===2||n[t].children.length===2?.25:0,yt=(n,t,r)=>{const s=E("linestart","lineend",t);if(s.nodes.includes(n))return E(s.nodes[1],n,t).len;{const a=r.filter(l=>l.includes(n))[0];let o=n;for(;!s.nodes.includes(o);)o=a[a.indexOf(o)-1];let i=n;for(;!s.nodes.includes(i);)i=a[a.indexOf(i)+1];const c=o==="linestart",m=i==="lineend";if(a.toString()===r[0].toString()){const l=[];return!c&&!m?(l[0]=E(s.nodes[1],o,t).len,l[1]=E(o,i,t).len,l[2]=E(o,n,t).len,l[3]=E(n,i,t).len):c?(l[0]=0,l[1]=E(s.nodes[1],i,t).len,l[2]=E(a[1],n,t).len,l[3]=E(n,i,t).len):(l[0]=E(s.nodes[1],o,t).len,l[1]=E(o,s.nodes.slice(-2)[0],t).len,l[2]=E(o,n,t).len,l[3]=E(n,a.slice(-2)[0],t).len),l[0]+l[2]*l[1]/(l[2]+l[3])}else if(!c&&!m){const l=[];return l[0]=E(s.nodes[1],o,t).len,l[1]=E(o,i,t).len,l[2]=E(o,n,t).len,l[3]=E(n,i,t).len,l[0]+l[2]*l[1]/(l[2]+l[3])}else return c?E(s.nodes[1],i,t).len-E(n,i,t).len:E(s.nodes[1],o,t).len+E(o,n,t).len}},zt=()=>{const{branches:n,routes:t,depsStr:r}=w(B=>B.helper),[s,a]=h.useState(45),{svgWidth:o,svg_height:i,y_pc:c,padding:m,branchSpacingPct:l,direction:d,line_name:x,spanLineNum:g,current_stn_idx:j,stn_list:u}=w(B=>B.param),S=h.useRef(null);h.useEffect(()=>{const B=setTimeout(()=>{S.current&&a(S.current.getBBox().width)},100);return()=>{clearTimeout(B)}},[S.current,x[0],x[1],g]);const y=Xe(u,Se,Se),p=h.useMemo(()=>(console.log("computing x shares"),Object.keys(u).reduce((B,R)=>({...B,[R]:yt(R,y,n)}),{})),[n.toString(),JSON.stringify(y)]),f=E("linestart","lineend",y),N=E(f.nodes[1],f.nodes.slice(-2)[0],y),_=d===$.right?[o[T.RailMap]*m/100+65,o[T.RailMap]*(1-m/100)-20]:[o[T.RailMap]*m/100,o[T.RailMap]*(1-m/100)-65],z=Object.keys(p).reduce((B,R)=>({...B,[R]:_[0]+p[R]/N.len*(_[1]-_[0])}),{}),b=h.useMemo(()=>(console.log("computing y shares"),Object.keys(u).reduce((B,R)=>{if(n[0].includes(R))return{...B,[R]:0};{const C=n.slice(1).filter(Fe=>Fe.includes(R))[0];return{...B,[R]:u[C[0]].children.indexOf(C[1])?-2:2}}},{})),[r]),k=Object.keys(b).reduce((B,R)=>({...B,[R]:-b[R]*l*i/200}),{}),H=h.useMemo(()=>Ue(j,t,d),[j,d,t.toString()]),L=n.map(B=>Ve(B,H)).reduce((B,R)=>(B.main.push(R.main),B.pass.push(R.pass),B),{main:[],pass:[]}),P=Object.keys(L).reduce((B,R)=>({...B,[R]:L[R].map(C=>wt(C,z,k))}),{}),F=s+20;return e.jsxs("g",{id:"main",style:{"--y-percentage":c,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx($t,{paths:P}),e.jsx(We,{xs:z,ys:k,stnStates:H}),e.jsx("g",{className:"line_name",style:{"--translate-x":d===$.right?`${_[0]-F}px`:`${_[1]+F}px`},children:e.jsx(he,{ref:S,zhName:x[0],enName:x[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",spanDigits:g,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})})]})},$t=h.memo(function(t){return e.jsxs("g",{fill:"none",strokeWidth:4,children:[e.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((r,s)=>e.jsx("path",{d:r},s))}),e.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((r,s)=>e.jsx("path",{d:r},s))})]})},(n,t)=>JSON.stringify(n.paths)===JSON.stringify(t.paths)),wt=(n,t,r)=>{let s;const a=[];return n.forEach(o=>{const i=t[o],c=r[o];if(!s&&s!==0){s=c,a.push(`M ${i},${c}`);return}c===0?(c<s&&a.push(`H ${i-40}`,"a 40,40 0 0,0 40,-40",`V ${c}`),c>s&&a.push(`H ${i-40}`,"a 40,40 0 0,1 40,40",`V ${c}`)):(c<s&&a.push(`V ${c+40}`,"a 40,40 0 0,1 40,-40",`H ${i}`),c>s&&a.push(`V ${c-40}`,"a 40,40 0 0,0 40,40",`H ${i}`)),a.push(`H ${i}`),s=c}),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},Me=150;function te(n){return e.jsx("path",{d:`M60,60 L0,0 L60,-60 H90 L40,-10 H${Me} V10 H40 L90,60z`,fill:"black",...n})}function Bt(n){const{destIds:t,textAnchor:r,...s}=n,a=w(l=>l.param.direction),o=w(l=>l.param.stn_list),i=t.map(l=>o[l].localisedName.zh?.length??0),c=Math.min(...i),m=c>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(c-1):0;return e.jsxs("g",{textAnchor:r,...s,children:[t.map((l,d)=>{const x=i[d]>i[1-d],g=!Ye()&&r==="end"&&!x;return e.jsxs(h.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,x:a===$.left?0:-75,y:-21+42*d,letterSpacing:x?"0em":`${m}em`,dx:g?`${m}em`:"0em",children:o[l].localisedName.zh}),e.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:a===$.left?0:-75,y:-1+42*d,children:"Towards "+o[l].localisedName.en?.replace("\\"," ")})]},l)}),e.jsx("text",{className:"rmg-name__zh",fontSize:28,x:a===$.left?25*(Math.max(...i)+1):0,y:5,children:"方向"})]})}const Et=(n,t,r,s)=>{const i=n*(1-2*t/100)*(r-1)/r-s,c=n-i;return[c/2,n-c/2]},vt=(n,t,r)=>{const s=Math.min(...Object.values(n)),a=Math.max(...Object.values(n)),o=Math.min(...Object.values(t)),c=Math.max(...Object.values(t))-o,m=c/2;return`M${a},${o} H${s} h-${r/2} a${m},${m} 0 0,0 0,${c} H${a} h${r/2} a${m},${m} 0 0,0 0,-${c}Z`},Rt=(n,t,r,s)=>{const a=n.indexOf(r),o=n.indexOf(s??r);let i;return o<0?i=n:t?i=a<=o?[...n.slice(0,a+1),...n.slice(o)]:n.slice(o,a+1):i=a<o?n.slice(a,o+1):[...n.slice(a),...n.slice(0,o+1)],n.reduce((c,m,l)=>a===l?{...c,[m]:A.CURRENT}:i.includes(m)?{...c,[m]:A.FUTURE}:{...c,[m]:A.PASSED},{})},je=6;function bt({currentStationX:n,currentStationY:t,stationGap:r,loopClockwise:s}){const a=t>0?s?-1:1:s?1:-1,o=(r/3-je)*a,i=n+o+je*a,c=(t-12)*-a;return e.jsx("g",{transform:`scale(1,${-a})`,children:e.jsx("path",{d:`M${i},${c} h${o}`,strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function _e({clockwise:n,...t}){return e.jsx("g",{...t,children:e.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:16,children:n?"内环":"外环"}),e.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:n?"Inner Circle":"Outer Circle"})]})})}const Ce=2/3,Tt=2-Ce,kt=25*Math.PI/180,At=Math.asin(Math.sin(35*Math.PI/180)/2);function It({cxLeft:n,cxRight:t,yGap:r,clockwise:s}){const a=r/2,o=a*(s?Ce:Tt),i=s?kt:At,c=o*Math.cos(i),m=s?1:-1,l=s?1:0,d=o*Math.sin(i)*m,x=2*d,g={rotate:s?"-4deg":"2deg"};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:`translate(${n},0)`,children:[e.jsx("path",{d:`M${-c},${d} a${o},${o} 0 0,${l} 0,${-x}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:g}),e.jsx(_e,{transform:`translate(${s?0:-2*a},0)`,clockwise:s})]}),e.jsxs("g",{transform:`translate(${t},0)`,children:[e.jsx("path",{d:`M${c},${-d} a${o},${o} 0 0,${l} 0,${x}`,fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:g}),e.jsx(_e,{transform:`translate(${s?0:2*a},0)`,clockwise:s})]})]})}function Wt(){const{branches:n}=w(N=>N.helper),{svgWidth:t,svg_height:r,y_pc:s,padding:a,branchSpacingPct:o,current_stn_idx:i,loop_info:{midpoint_station:c,clockwise:m}}=w(N=>N.param),l=n[0].slice(1,-1),d=Math.ceil(l.length/2),x=h.useMemo(()=>(console.log("computing x shares"),l.reduce((N,_,z,b)=>{let k;return z<d?k=d-z-1:(k=z-d,b.length&1&&(k+=.5)),{...N,[_]:k}},{})),[l.toString()]),g=o*r*2/100,j=Et(t[T.RailMap],a,d,g),u=(j[1]-j[0])/(d-1),S=Object.keys(x).reduce((N,_)=>({...N,[_]:j[0]+x[_]*u}),{}),y=h.useMemo(()=>(console.log("computing y shares"),l.reduce((N,_,z)=>({...N,[_]:z<d?1:-1}),{})),[l.toString()]),p=Object.keys(y).reduce((N,_)=>({...N,[_]:-y[_]*g/2}),{}),f=Rt(l,m??!1,i,c);return e.jsxs("g",{id:"main",style:{"--y-percentage":s,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx("path",{d:vt(S,p,u),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),e.jsx(We,{xs:S,ys:p,stnStates:f}),e.jsx(bt,{currentStationX:S[i],currentStationY:p[i],stationGap:u,loopClockwise:m}),e.jsx(It,{cxLeft:j[0]-u/2,cxRight:j[1]+u/2,yGap:g,clockwise:m})]})}const ye=T.RailMap,Mt=()=>{const{canvasScale:n}=w(u=>u.app),{svgWidth:t,svg_height:r,direction:s,psd_num:a,psdLabel:o,info_panel_type:i,notesGZMTR:c,current_stn_idx:m,stn_list:l,theme:d,loop:x}=w(u=>u.param),g=t[ye],j=l[m];return e.jsxs(Be,{type:ye,svgWidth:g,svgHeight:r,canvasScale:n,theme:d,children:[e.jsx(Ct,{}),e.jsx(Ee,{variant:i,isShowLight:i===v.gz2otis,isShowPSD:i===v.gz2otis&&a,psdLabel:o}),!x&&(s===$.left&&j.parents.includes("linestart")||s===$.right&&j.children.includes("lineend"))?e.jsx(Lt,{}):e.jsxs(e.Fragment,{children:[x?e.jsx(Wt,{}):e.jsx(zt,{}),!x&&e.jsx(Dt,{}),c?.map((u,S)=>e.jsx(Ht,{note:u},S))]}),i===v.gz2otis&&e.jsx("line",{x2:g,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},Ct=h.memo(function(){return e.jsxs("defs",{children:[e.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),e.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:e.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),Dt=()=>{const{routes:n}=w(c=>c.helper),{direction:t,direction_gz_x:r,direction_gz_y:s,current_stn_idx:a}=w(c=>c.param),o=h.useMemo(()=>[...new Set(n.reduce((c,m)=>m.includes(a)?c.concat(m.filter(l=>!["linestart","lineend"].includes(l)).slice(t===$.left?0:-1)[0]):c,[]).filter(c=>c!==a))],[a,t,n.toString()]),i={textAnchor:t===$.left?"start":"end",transform:`translate(${t===$.left?65:-65},-5)`,destIds:o};return e.jsxs("g",{id:"direction_gz",style:{"--x-percentage":r,"--y-percentage":s},children:[e.jsx(te,{transform:`scale(0.35)rotate(${t===$.left?0:180})`}),o.length!==2?e.jsx(Ot,{...i}):e.jsx(Bt,{...i})]})},Ot=n=>{const{destIds:t,...r}=n,s=w(a=>a.param.stn_list);return e.jsxs("g",{...r,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(a=>s[a].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(a=>s[a].localisedName.en?.replace("\\"," ")).join("/")})]})},Lt=h.memo(function(){return e.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),e.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),e.jsxs("g",{strokeWidth:8,stroke:"#000",children:[e.jsx("path",{d:"M -160,68 h -160"}),e.jsx("path",{d:"M 160,68 h 160"})]})]})}),Ht=h.memo(function(t){const r=h.useRef(null),[s,a]=h.useState({width:0,height:0,y:0});return h.useEffect(()=>{r.current&&a(r.current.getBBox())},[t.note[0],t.note[1]]),e.jsxs("g",{className:"note-box",style:{"--x-percentage":t.note[2],"--y-percentage":t.note[3]},children:[t.note[4]&&e.jsx("rect",{height:s.height+4,width:s.width+4,x:-2,y:s.y-2,fill:"none",stroke:"black",strokeWidth:.5}),e.jsxs("g",{ref:r,children:[e.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split(`
`).map((o,i)=>e.jsx("text",{className:"rmg-name__zh",y:i*18,children:o},i))}),e.jsx("g",{fontSize:10,letterSpacing:.33,transform:`translate(0,${18*t.note[0].split(`
`).length})`,children:t.note[1].split(`
`).map((o,i)=>e.jsx("text",{className:"rmg-name__en",y:i*11,textLength:i<(t.note[1].match(/\n/g)?.length||0)?s.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:o},i))})]})]})},(n,t)=>n.note.toString()===t.note.toString()),re=92,Pt=(n,t)=>{switch(t){case 2:return n==="gz11"?.2:.5;case 3:return .1;default:return 0}},Ft=h.memo(function(t){const{stnName:r,panelType:s,onUpdate:a}=t,o=h.useRef(null),i=Pt(s,r.zh?.length);return h.useEffect(()=>{if(o.current&&a){const c=o.current.getBBox();a({...c,x:c.x+i*re/2,width:c.width-i*re})}},[o.current,JSON.stringify(r),s]),e.jsxs("g",{ref:o,fontWeight:s==="gz11"?"bold":"normal",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:re,x:i/2+"em",letterSpacing:i+"em",children:r.zh}),e.jsx("g",{fontSize:40,children:r.en?.split("\\")?.map((c,m)=>e.jsx("text",{className:"rmg-name__en",dy:72+m*42,children:c},m))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName)&&n.panelType===t.panelType),Zt=n=>{const{secondaryName:t,transform:r}=n,s=h.useRef(null),[a,o]=h.useState({x:0,width:0});return h.useEffect(()=>{s.current&&o(s.current.getBBox())},[t.toString()]),e.jsxs("g",{transform:r,children:[e.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[e.jsx("text",{textAnchor:"end",x:a.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:a.width+a.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:s,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),e.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},K=55,De=18.5*1.4,Oe=30,Gt=Oe*4,Le=.82,He=.25,ze=.4,Pe=(n,t,r)=>{const{stn_list:s,current_stn_idx:a,direction:o,loop:i,loop_info:{midpoint_station:c,clockwise:m}}=n;return i?Ut(t[0].slice(1,-1),s,a,c,m):Xt(r,s,a,o)},Xt=(n,t,r,s)=>{const a=s==="l"?"parents":"children",o=t[r][a].map(c=>t[c].underConstruction?t[c][a]:c).flat(),i=n.find(c=>c.includes(r)&&c.includes(o[0]));if(i){const c=i.indexOf(r),l=(s==="l"?i.slice(0,c).toReversed():i.slice(c+1)).filter(d=>!["linestart","lineend"].includes(d)).reduce((d,x)=>t[x].transfer.groups[0].lines?.length?[...d,x]:d,[]).slice(0,3);return{nextStations:o,viaStations:l}}else return{nextStations:o,viaStations:[]}},Ut=(n,t,r,s,a)=>{const o=n.filter(g=>!t[g].underConstruction),i=a?o.toReversed():o,c=i.indexOf(r),m=[...i,...i].slice(c+1),l=[m[0]],d=m.slice(1).reduce((g,j)=>t[j].transfer.groups[0].lines?.length?[...g,j]:t[j].loop_pivot?[...g,j]:g,[]),x=s?[...d.slice(0,2),s]:d.slice(0,3);return{nextStations:l,viaStations:x}},Vt=h.forwardRef(function({stationInfo:t,...r},s){const{localisedName:a,transfer:{groups:[{lines:o}]}}=t,[i,c]=h.useState({width:0}),m=h.useRef(null);return h.useEffect(()=>{m.current&&c(m.current.getBBox())},[m.current,JSON.stringify(a)]),e.jsxs("g",{ref:s,...r,children:[e.jsxs("g",{ref:m,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:a.zh}),a.en?.split("\\")?.map((l,d)=>e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*d,children:l},d))]}),e.jsx("g",{transform:`translate(${i.width+2},7)`,children:o?.length&&e.jsxs(e.Fragment,{children:[e.jsx("g",{transform:`translate(0,-${3.5*(o.length-1)/2})`,children:o.map(({theme:l},d)=>e.jsx("path",{d:`M0,${3.5*d} H8`,stroke:l?.[2]??"#aaa",strokeWidth:3.5},`tick-${d}`))}),o.map((l,d)=>e.jsx(he,{zhName:l.name[0],enName:l.name[1],backgroundColour:l.theme?.[2]??"#aaa",foregroundColour:l.theme?.[3]??O.white,spanDigits:!0,transform:`translate(${27+36*d},-8.5)scale(0.75)`,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}},`line-icon-${d}`))]})})]})});function Yt({viaStations:n,stationList:t}){const r=h.useRef([]),[s,a]=h.useState([]);h.useEffect(()=>{a(r.current.map(i=>i?.getBBox()?.height??0))},[n,r.current]);const o=h.useCallback(i=>s.slice(0,i).reduce((c,m)=>c+m+4,0),[s]);return e.jsx(e.Fragment,{children:n.map((i,c)=>e.jsx(Vt,{ref:m=>r.current[c]=m,stationInfo:t[i],transform:`translate(0,${o(c)})`},i))})}const ae=44,oe=25;function Jt({nameBBox:n}){const t=w(N=>N.param),{svg_height:r,svgWidth:s,direction:a,current_stn_idx:o,stn_list:i}=t,{branches:c,routes:m}=w(N=>N.helper),l=s[T.RunIn],{nextStations:[d],viaStations:x}=Pe(t,c,m),{localisedName:{en:g=""},localisedSecondaryName:j}=i[o],{localisedName:{zh:u="",en:S=""}}=i[d],y=S.split("\\").length,p=(l-n.width)/2,f={next:{x:80},nextName:{x:80+ae*1.7},via:{dy:75+25*(y-1)},arrow:{x:a===$.left?(115+50*(.5+u.length)+p)/2-20:((l+n.width)/2+(l*Le-Gt/2))/2+Me*ze/2,y:.5*r-(g.split("\\").length-2)*18-(j?58/2:0),rotate:a===$.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:`translate(0,${r/2+5-f.via.dy})`,children:[e.jsxs("g",{textAnchor:"middle",transform:`translate(${f.next.x},0)`,children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ae,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:oe,dy:40,children:"Next"})]}),e.jsxs("g",{transform:`translate(0,${f.via.dy})`,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),e.jsxs("g",{textAnchor:"start",transform:`translate(${f.nextName.x},0)`,children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ae,children:u}),e.jsx("g",{fontSize:oe,children:S.split("\\").map((N,_)=>e.jsx("text",{className:"rmg-name__en",dy:40+_*oe,children:N},_))})]}),x&&e.jsx("g",{transform:`translate(0,${f.via.dy})`,children:e.jsx(Yt,{viaStations:x,stationList:i})})]})]}),e.jsx(te,{transform:`translate(${f.arrow.x},${f.arrow.y})scale(${ze})rotate(${f.arrow.rotate})`})]})}function qt({secName:n,...t}){const{zh:r,en:s}=n,a=h.useRef(null),[o,i]=h.useState({x:0,width:0});return h.useEffect(()=>{a.current&&i(a.current.getBBox())},[r,s]),e.jsxs("g",{...t,children:[e.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[e.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:a,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:r}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:s})]})]})}const Y=35,ie=17;function Kt({nextId:n,nameBBox:t,ignoreNumWidth:r}){const{svgWidth:s,svg_height:a,direction:o}=w(f=>f.param),i=w(f=>f.param.stn_list[n]),{localisedName:c,localisedSecondaryName:m}=i,{zh:l="",en:d=""}=c,x=s[T.RunIn],[g,j]=h.useState({width:0}),u=h.useRef(null);h.useEffect(()=>{u.current&&j(u.current.getBBox())},[l,d]);const S=l.length,y=(x-t.width)/2,p={next:{x:o===$.left?80:x-45-g.width-Y*(S<=2?2:1.5)},nextName:{x:o===$.left?80+Y*(S<=2?2:1.5):x-45-g.width},arrow:{x:o===$.left?(115+35*((S<=2?1:.5)+S)+y)/2-20:(x-45-g.width-(S<=2?105:35*2.5)+y+t.width+(r?0:K+De))/2+20,y:a/2-30,rotate:o===$.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:`translate(0,${a/2-40})`,children:[e.jsxs("g",{textAnchor:"middle",transform:`translate(${p.next.x},0)`,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:Y,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ie,dy:30,children:"Next"})]}),e.jsxs("g",{textAnchor:"start",ref:u,transform:`translate(${p.nextName.x},0)`,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:Y,children:l}),e.jsx("g",{fontSize:ie,children:d.split("\\").map((f,N)=>e.jsx("text",{className:"rmg-name__en",dy:30+N*ie,children:f},N))})]}),m&&e.jsx("g",{textAnchor:"middle",transform:`translate(${p.nextName.x},0)`,children:e.jsx(qt,{secName:m,transform:`translate(${g.width/2},${30+d.split("\\").length*17+5})`})})]}),e.jsx(te,{transform:`translate(${p.arrow.x},${p.arrow.y})scale(${He})rotate(${p.arrow.rotate})`})]})}const Qt=()=>{const n=w(b=>b.param),{svg_height:t,svgWidth:r,theme:s,direction:a,info_panel_type:o,line_num:i,current_stn_idx:c,stn_list:m}=n,{branches:l,routes:d}=w(b=>b.helper),x=m[c],{localisedName:g,localisedSecondaryName:j}=x,[u,S]=h.useState({width:0}),y=g.en?.split("\\")?.length??1,{nextStations:p}=Pe(n,l,d),f=[v.gz7w,v.gz11].includes(o),N={name:`translate(${(a===$.left?1:-1)*r[T.RunIn]/4},45)`,next:`translate(${(a===$.left?1:-1)*r[T.RunIn]/10},45)`},_=(r[T.RunIn]+u.width)/2+K,z={nameGroup:{x:r.runin/2,y:.5*t-50-(y-1)*18-(j?29:0)},secondaryName:{x:0,y:70+y*36},stationNumber:{x:_,y:.5*t-30-(y-1)*18-(j?58/2:0)},stationNumberPost2022:{x:a===$.left?_:(r[T.RunIn]-u.width)/2-K,y:.5*t-(y-2)*18-(j?58/2:0)}};return e.jsxs("g",{children:[e.jsxs("g",{transform:o===v.gz2otis?N.name:"",children:[e.jsxs("g",{textAnchor:"middle",transform:`translate(${z.nameGroup.x},${z.nameGroup.y})`,children:[e.jsx(Ft,{stnName:g,panelType:o,onUpdate:S}),j&&e.jsx(Zt,{secondaryName:j,transform:`translate(${z.secondaryName.x},${z.secondaryName.y})`})]}),e.jsx(de,{lineNum:i,stnNum:x.num,strokeColour:s[2],classNames:{digits:"rmg-font__en"},transform:f?`translate(${z.stationNumberPost2022.x},${z.stationNumberPost2022.y})`:`translate(${z.stationNumber.x},${z.stationNumber.y})`,size:"lg"})]}),o===v.gz11?e.jsx(Jt,{nameBBox:u}):e.jsx("g",{transform:o===v.gz2otis?N.next:"",children:!p||p.includes("linestart")||p.includes("lineend")?e.jsx(e.Fragment,{}):p.length===1?e.jsx(Kt,{nextId:p[0],nameBBox:u,ignoreNumWidth:f}):e.jsx(en,{nextIds:p,nameBBox:u,ignoreNumWidth:f})})]})},$e=27,ce=13,we=110,en=n=>{const{nextIds:t,nameBBox:r,ignoreNumWidth:s}=n,{routes:a}=w(f=>f.helper),{svgWidth:o,svg_height:i,direction:c,stn_list:m}=w(f=>f.param),l=o[T.RunIn],d=t.map(f=>m[f].localisedName),[x,g]=h.useState({width:0}),j=h.useRef([]);h.useEffect(()=>{g(f=>({...f,width:0})),j.current.forEach(f=>{const N=f?.getBBox();g(_=>N?_.width>N.width?_:N:_)})},[d.toString()]);const u=n.nextIds.map(f=>a.reduce((N,_)=>_.includes(f)?N.concat(_.filter(z=>!["linestart","lineend"].includes(z)).slice(c===$.left?0:-1)[0]):N,[])),S=Math.max(...d.map(f=>f.zh?.length??0)),y=(l-r.width)/2,p={next:{x:c===$.left?72:l-45-x.width-41},nextName:{x:c===$.left?113:l-45-x.width},arrow:{x:c===$.left?(99+27*(1+S)+y)/2-20:(l-45-x.width-41-27+y+n.nameBBox.width+(s?0:K+De))/2+20,y:i/2-30,rotate:c===$.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsx("g",{transform:`translate(0,${i/2-70})`,children:d.map((f,N)=>e.jsxs(h.Fragment,{children:[e.jsxs("g",{textAnchor:"middle",transform:`translate(${p.next.x},${we*N})`,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:$e,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ce,y:22,children:"Next"})]}),e.jsxs("g",{ref:_=>j.current[N]=_,textAnchor:"start",transform:`translate(${p.nextName.x},${we*N})`,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:$e,children:f.zh}),f.en?.split("\\")?.map((_,z)=>e.jsx("text",{className:"rmg-name__en",fontSize:ce,y:22+z*ce,children:_},z)),e.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:u[N].map(_=>m[_].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+u[N].map(_=>m[_].localisedName.en).join("/").replace("\\"," ")})]})]},N))}),e.jsx(te,{transform:`translate(${p.arrow.x},${p.arrow.y})scale(${He})rotate(${p.arrow.rotate})`})]})};function tn(n){const{num:t,...r}=n;return e.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...r,children:[e.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),e.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function nn(n){const{canvasType:t}=n,{svgWidth:r,svg_height:s}=w(a=>a.param);return e.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[e.jsx("line",{y2:s,transform:`translate(${r[t]/2},0)`}),e.jsx("line",{x2:r[t],transform:"translate(0,90)"})]})}const W=Oe;function sn({coachNumber:n,...t}){return e.jsxs("g",{...t,children:[e.jsx("path",{d:`M-${W},-${W} a${W},${W} 0 0,0 0,${2*W} h${2*W} a${W},${W}, 0 0,0 0,-${2*W}Z`,fill:"whitesmoke",stroke:"lightgrey"}),e.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),e.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:e.jsx("text",{className:"rmg-name__zh",fontSize:36,children:n})})]})}const le=T.RunIn;function rn(){const{canvasScale:n}=w(u=>u.app),{svgWidth:t,svg_height:r,direction:s,info_panel_type:a,platform_num:o,psd_num:i,psdLabel:c,coachNum:m,theme:l}=w(u=>u.param),d=t[le],x=[v.gz7w,v.gz11].includes(a),g=x?r-78:r/2-30,j={platform:`translate(${s===$.left?50:-50},45)`};return e.jsxs(Be,{type:le,svgWidth:d,svgHeight:r,canvasScale:n,theme:l,children:[e.jsx(Ee,{variant:a,isShowLight:a!==v.gz2otis,isShowPSD:a!==v.gz2otis&&i,psdLabel:c}),e.jsx("g",{transform:a===v.gz2otis?j.platform:"",children:e.jsx(tn,{num:o,style:{"--translate-x":`${s===$.left||a===v.gz11?d-100:100}px`,"--translate-y":g+"px","--scale":x?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),x&&e.jsx(sn,{coachNumber:m,transform:`translate(${d*Le},${r*.58})`}),e.jsx(Qt,{}),a===v.gz2otis&&e.jsx(nn,{canvasType:le})]})}const dn={runin:e.jsx(rn,{}),railmap:e.jsx(Mt,{})};export{dn as default};
