import{j as y}from"./chakra-C4MmXJaB.js";import{S as _}from"./index-DPSoksCq.js";function W(i){const{type:t,svgWidth:s,svgHeight:e,canvasScale:n,theme:r,children:h}=i;return y.jsxs("svg",{id:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",height:e*n,viewBox:"0 0 ".concat(s," ").concat(e),colorInterpolationFilters:"sRGB",style:{"--rmg-svg-width":s+"px","--rmg-svg-height":e+"px","--rmg-theme-colour":r[2],"--rmg-theme-fg":r[3]},children:[y.jsx("rect",{id:"canvas-bg",fill:"white",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}}),h,y.jsx("rect",{id:"canvas-border",fill:"none",strokeWidth:3,stroke:"none",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}})]})}const k=(i,t,s)=>Object.keys(i).reduce((e,n)=>({...e,[n]:i[n].children.reduce((r,h)=>({...r,[h]:1+t(i,h)+s(i,n)}),{})}),{}),c=(i,t,s)=>{if(i===t)return{len:0,nodes:[i]};const e=[],n=[];Object.keys(s[i]).forEach(h=>{const o=c(h,t,s);o.len<0||(e.push(s[i][h]+o.len),o.nodes.unshift(i),n.push(o.nodes))});const r=Math.max(...e);return{len:r,nodes:n[e.indexOf(r)]}},L=(i,t,s)=>{const e=c("linestart","lineend",t);if(e.nodes.includes(i))return c(e.nodes[1],i,t).len;{const n=s.filter(g=>g.includes(i))[0];let r=i;for(;!e.nodes.includes(r);)r=n[n.indexOf(r)-1];let h=i;for(;!e.nodes.includes(h);)h=n[n.indexOf(h)+1];const o=r==="linestart",$=h==="lineend",l=[];return!o&&!$?(l[0]=c(e.nodes[1],r,t).len,l[1]=c(r,h,t).len,l[2]=c(r,i,t).len,l[3]=c(i,h,t).len):o?(l[0]=0,l[1]=c(e.nodes[1],h,t).len,l[2]=c(n[1],i,t).len,l[3]=c(i,h,t).len):(l[0]=c(e.nodes[1],r,t).len,l[1]=c(r,e.nodes.slice(-2)[0],t).len,l[2]=c(r,i,t).len,l[3]=c(i,n.slice(-2)[0],t).len),l[0]+l[2]*l[1]/(l[2]+l[3])}},O=(i,t,s)=>{for(const e of s){const n=e.indexOf(i),r=e.indexOf(t);if(r!==-1&&r<n)return!0}return!1},P=(i,t,s)=>{for(const e of s){const n=e.indexOf(i),r=e.indexOf(t);if(n!==-1&&n<r)return!0}return!1},F=(i,t,s)=>(console.log("computing stations' states"),[...new Set([].concat(...t))].reduce((e,n)=>({...e,[n]:n===i?0:(s===_.right?P(i,n,t):O(i,n,t))?1:-1}),{}));class H{constructor(t){this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=s=>0,this.rightWideFactor=s=>0,this.pathTurnParams=s=>{const r=35-17.5*Math.sqrt(3),h=s-2*r,o=h*Math.sqrt(3);return{tr:35,dx_a:17.5,dy_a:r,dx_l:o,dy_l:h}},this.pathTurnSE=s=>{const{tr:e,dx_a:n,dy_a:r,dx_l:h,dy_l:o}=this.pathTurnParams(s);return"a ".concat(e,",").concat(e," 0 0,1 ").concat(n,",").concat(r," l ").concat(h,",").concat(o," a ").concat(e,",").concat(e," 0 0,0 ").concat(n,",").concat(r)},this.pathTurnNE=s=>{const{tr:e,dx_a:n,dy_a:r,dx_l:h,dy_l:o}=this.pathTurnParams(s);return"a ".concat(e,",").concat(e," 0 0,0 ").concat(n,",").concat(-r," l ").concat(h,",").concat(-o," a ").concat(e,",").concat(e," 0 0,1 ").concat(n,",").concat(-r)},this.stnList=t.stnList,this.criticalPath=t.criticalPath}getYShare(t){if(t in this.yShares)return this.yShares[t];if(["linestart","lineend"].includes(t)||this.stnList[t].parents.length>1||this.stnList[t].children.length>1)return this.yShares[t]=0,0;const s=this.stnList[t].parents[0];if(s)if(this.stnList[s].children.length===1){const e=this.getYShare(s);return this.yShares[t]=e,e}else{const e=this.stnList[s].children.indexOf(t)===0?1:-1;return this.yShares[t]=e,e}else return this.yShares[t]=0,0}static getYShares(t){console.log("computing y shares");const s=new this({stnList:t});return Object.keys(t).forEach(e=>{["linestart","lineend"].includes(e)||e in s.yShares||s.getYShare(e)}),s.yShares}_linePath(t,s,e,n,r,h,o,$){let[l,g,S]=[];const a=[],{dx_a:w,dx_l:v}=this.pathTurnParams(h),m=w+v/2,d=(s[1]-s[0])/o.len*2,x=((s[1]-s[0])/o.len-2*m)/2;return x+d<0&&console.warn("SVG width too small! ".concat(x+d)),t.forEach(p=>{const f=n[p],u=r[p];if(!g&&g!==0){[l,S,g]=[p,f,u],t.length===1?a.push("M ".concat(f,",").concat(u)):e[0].includes(p)?e[0].includes(t[1])?a.push("M ".concat(f,",").concat(u)):(n[t[1]]>0&&a.push("M ".concat(f,",").concat(u+$)),r[t[1]]<0&&a.push("M ".concat(f,",").concat(u-$))):a.push("M ".concat(f,",").concat(u));return}u>g?(a.push(u===0?"h ".concat(f-S-d*this.leftWideFactor(p)-x-m*2):"h ".concat(d*this.rightWideFactor(l)+x)),a.push(this.pathTurnSE(h))):u<g&&(a.push(u===0?"h ".concat(f-S-d*this.leftWideFactor(p)-x-m*2):"h ".concat(d*this.rightWideFactor(l)+x)),a.push(this.pathTurnNE(h))),a.push("H ".concat(f)),[l,S,g]=[p,f,u]}),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}const Y=(i,t)=>{i=i.filter(n=>!["linestart","lineend"].includes(n));let s=i.filter(n=>t[n]>=0),e=i.filter(n=>t[n]<=0);return s.length===1&&(e=i),s.filter(n=>e.indexOf(n)!==-1).length===0&&s.length&&(e[0]===i[0]?e.push(s[0]):s[0]===i[0]&&s[s.length-1]===i[i.length-1]&&e.length?(e=i,s=[]):e.unshift(s[s.length-1])),{main:s,pass:e}};export{W as S,k as a,F as b,c,Y as d,H as e,L as g};
