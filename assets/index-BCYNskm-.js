import{j as e}from"./chakra-CTSlVI42.js";import{a as h}from"./react-D6Vx58LK.js";import{i as P,P as v,b0 as I,u as E,n as Pe,S as w,aW as k}from"./index-XBZmo_Ri.js";import{a as Fe,c as T,b as Ze,d as Ge}from"./share-BsUKPq_O.js";import{S as Be}from"./svg-wrapper-BRfVxP60.js";import{i as Xe}from"./param-selector-C0-8fq35.js";function Ue(n){const{num:t,inStrip:a,showAsPlatformDoor:s,...r}=n;return e.jsxs("g",{textAnchor:"middle",fill:a?P.black:"var(--rmg-theme-fg)",...r,children:[e.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:a?"#fff":"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),s?e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),e.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),e.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]})}const Ee=n=>{const t=(r=>{switch(r){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(n.variant),a=h.useMemo(()=>{switch(n.variant){case"gz1":return e.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return e.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return e.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return e.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return e.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return e.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return e.jsx(e.Fragment,{})}},[n.variant]);return e.jsxs("g",{transform:"translate(0,".concat(n.variant==="gz4"?-15:0,")"),style:{"--strip-height":"".concat(t,"px")},children:[e.jsx("rect",{id:"strip_gz"}),n.variant===v.gz1&&e.jsx("rect",{className:"gz1-gap"}),e.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:n.isShowLight&&a}),n.isShowPSD!==!1&&e.jsx(Ve,{...n})]})},Ve=h.memo(function(t){const a=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),s=(i=>{switch(i){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(t.variant),r=(i=>{switch(i){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(t.variant),o=[v.gz1,v.gz3,v.gz4,v.gz5,v.gz1421,v.gz7w,v.gz11].includes(t.variant);return e.jsx(Ue,{num:t.isShowPSD,inStrip:a,showAsPlatformDoor:t.variant===v.gz11,style:{"--psd-dy":s,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":o?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":r}})},(n,t)=>n.variant===t.variant&&n.isShowPSD===t.isShowPSD),D=1.3,ve=1.7,q=18.5,Ye=q+D,le=q*2+D,Z=5,G=5.625,xe=q-Z,ge=q-2*G,Re=h.memo(function(t){const{stroke:a,filled:s,bolder:r,...o}=t,i="M0,9.25 V-9.25 H-".concat(xe," l-").concat(Z,",").concat(G," v").concat(ge," l").concat(Z,",").concat(G," H").concat(xe," l").concat(Z,",-").concat(G," v-").concat(ge," l-").concat(Z,",-").concat(G," H0");return e.jsx("path",{d:i,fill:s?a:"#fff",strokeWidth:r?ve:D,stroke:a,...o})}),Je={updateId:0,update:()=>{}},qe=h.createContext(Je),U=17,Ke=["Arial"],Te=h.forwardRef(function(t,a){const{Icon:s,lineNum:r,stnNum:o,strokeColour:i,passed:c,size:m,textClassName:l,bolderBorder:d,alwaysShowColouredBorder:f,useSameScale:x,children:u,...N}=t,{updateId:_}=h.useContext(qe),p=h.useRef(null),S=h.useRef(null),[g,j]=h.useState({width:0}),[y,z]=h.useState({width:0}),B=()=>{p.current&&j(p.current.getBBox()),S.current&&z(S.current.getBBox())};h.useEffect(()=>{const $=new AbortController;return B(),document.fonts.load("12px "+Ke.join(", "),(r!=null?r:"")+(o!=null?o:"")).then().finally(()=>{setTimeout(()=>{$.signal.aborted||B()},100)}),()=>{$.abort()}},[r,o,_]);const R=r&&r.length>2,C=o&&o.length>2;h.useEffect(()=>{x&&(R||C)&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[x,R,C]);const A=U/Math.max(U,g.width),F=x&&!R&&!C?A:U/Math.max(U,y.width),O=m==="sm"?"0.7":m==="lg"?"1.6":1;return e.jsxs("g",{ref:a,...N,children:[e.jsxs("g",{transform:"scale(".concat(O,")"),children:[e.jsx(s,{stroke:c&&!f?"#aaa":i,filled:!r&&!o,bolder:d}),(r||o)&&e.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:c?"#aaa":"#000",children:[e.jsx("g",{transform:"translate(-9.25,0)scale(".concat(A,")"),children:e.jsx("text",{ref:p,className:l,dominantBaseline:"central",x:.5,children:r})}),e.jsx("g",{transform:"translate(9.25,0)scale(".concat(F,")"),children:e.jsx("text",{ref:S,className:l,dominantBaseline:"central",children:o})})]})]}),u]})}),Qe=h.forwardRef(function(t,a){return e.jsx(Te,{Icon:Re,...t,ref:a})}),Y=45,M=Y-3,be=(n,t)=>{const a=[n,t].map(s=>s.match(/^(\w+).+$/));if(a[0]&&a[1]&&a[0][1]===a[1][1])return a[0][1]},me=n=>{const t=n.match(/^(\d+)\D+$/);return t==null?void 0:t[1]};function K(n){const{customWidth:t,...a}=n,s=(t!=null?t:Y)-Y;return e.jsx("rect",{x:-22.5-s/2,height:24,width:t!=null?t:Y,rx:4.5,...a,"data-testid":"intBox"})}const et=(n,t)=>{const a=me(n);if(a)return{isDigit:!0,spanningPart:a};const s=be(n,t);return s?{isDigit:!1,spanningPart:s}:{isDigit:!1,spanningPart:""}},ue=h.forwardRef(function(t,a){const{zhName:s,enName:r,foregroundColour:o,backgroundColour:i,zhClassName:c,enClassName:m,passed:l,children:d,spanDigits:f,...x}=t,{isDigit:u,spanningPart:N}=et(s,r),_=h.useRef(null),[p,S]=h.useState({x:0,height:0,width:0});h.useEffect(()=>{_.current&&S(_.current.getBBox())},[s,r]);const g=M/Math.max(M,p.width),j=(-p.x-p.width/2)*g,y=p.height*(1-g)/2;return e.jsxs("g",{ref:a,textAnchor:"middle",fill:l?P.white:o,...x,children:[e.jsx(K,{fill:l?"#aaa":i}),e.jsxs("g",{ref:_,transform:"translate(".concat(j,",").concat(y,")scale(").concat(g,")"),children:[e.jsx("text",{className:m,fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",children:N}),e.jsx("text",{className:c,fontSize:10,x:0,y:8,textAnchor:"start",dominantBaseline:"central",children:s.slice(N.length).trim()}),e.jsx("text",{className:m,fontSize:6.5,letterSpacing:-.1,x:0,y:18,textAnchor:"start",dominantBaseline:"middle",children:u?r:r.slice(N.length).trim()})]}),d]})}),tt=h.forwardRef(function(t,a){var R;const{zhName:s,enName:r,foregroundColour:o,backgroundColour:i,zhClassName:c,enClassName:m,passed:l,children:d,spanDigits:f,...x}=t,u=(R=me(s))!=null?R:"",N=h.useRef(null),_=h.useRef(null),[p,S]=h.useState({x:0,width:0}),[g,j]=h.useState({width:0});h.useEffect(()=>{N.current&&S(N.current.getBBox()),_.current&&j(_.current.getBBox())},[s,r]);const y=M/Math.max(M,p.width),z=M/Math.max(M,g.width),B={nameZh:{x:-(p.x+p.width/2)*y,y:7.3+13.5*(1-y)*y/2*y},nameEn:{y:19.5-9*(1-z)*z/2}};return e.jsxs("g",{ref:a,fill:l?P.white:o,...x,children:[e.jsx(K,{fill:l?"#aaa":i}),e.jsxs("g",{ref:N,transform:"translate(".concat(B.nameZh.x,",").concat(B.nameZh.y,")scale(").concat(y,")"),children:[e.jsx("text",{ref:N,className:c,fontSize:16,textAnchor:"end",y:.7,dominantBaseline:"central",children:u}),e.jsx("text",{className:c,fontSize:12,textAnchor:"start",dominantBaseline:"central",children:s.slice(u.length)})]}),e.jsx("text",{ref:_,className:m,fontSize:8,textAnchor:"middle",transform:"translate(0,".concat(B.nameEn.y,")scale(").concat(z,")"),dominantBaseline:"middle",children:r}),d]})}),nt=h.forwardRef(function(t,a){const{zhName:s,enName:r,foregroundColour:o,backgroundColour:i,zhClassName:c,enClassName:m,passed:l,children:d,spanDigits:f,...x}=t,u=h.useRef(null),[N,_]=h.useState({width:0});h.useEffect(()=>{u.current&&_(u.current.getBBox())},[s,r]);const p=Math.max(45,N.width+4);return e.jsxs("g",{ref:a,textAnchor:"middle",fill:l?P.white:o,...x,children:[e.jsx(K,{customWidth:p,fill:l?"#aaa":i}),e.jsxs("g",{ref:u,children:[e.jsx("text",{className:c,fontSize:8.5,y:8,dominantBaseline:"central",children:s}),e.jsx("text",{className:m,fontSize:5.5,y:18,dominantBaseline:"middle",children:r})]}),d]})}),st=h.forwardRef(function(t,a){const{zhName:s,enName:r,foregroundColour:o,backgroundColour:i,zhClassName:c,enClassName:m,passed:l,children:d,spanDigits:f,...x}=t,u=h.useRef(null),N=h.useRef(null),[_,p]=h.useState({width:0}),[S,g]=h.useState({width:0});h.useEffect(()=>{u.current&&p(u.current.getBBox()),N.current&&g(N.current.getBBox())},[s,r]);const j=M/Math.max(M,_.width),y=M/Math.max(M,S.width),z={nameZh:{y:7.3+13.5*(1-j)*j/2},nameEn:{y:19.5-9*(1-y)*y/2}};return e.jsxs("g",{ref:a,textAnchor:"middle",fill:l?P.white:o,...x,children:[e.jsx(K,{fill:l?"#aaa":i}),e.jsx("text",{ref:u,className:c,fontSize:12,transform:"translate(0,".concat(z.nameZh.y,")scale(").concat(j,")"),dominantBaseline:"central",children:s}),e.jsx("text",{ref:N,className:m,fontSize:8,transform:"translate(0,".concat(z.nameEn.y,")scale(").concat(y,")"),dominantBaseline:"middle",children:r}),d]})}),he=h.memo(h.forwardRef(function(t,a){const{zhName:s,enName:r,spanDigits:o}=t;switch(rt(s,r)){case 1:return o?e.jsx(ue,{ref:a,...t}):e.jsx(tt,{ref:a,...t});case 2:return e.jsx(ue,{ref:a,...t});default:return s.length>=5?e.jsx(nt,{ref:a,...t}):e.jsx(st,{ref:a,...t})}})),rt=(n,t)=>me(n)!==void 0?1:be(n,t)!==void 0?2:3,ke=h.memo(function(t){const{stroke:a,filled:s,bolder:r,...o}=t;return e.jsx("path",{d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:s?a:"#fff",strokeWidth:r?ve:D,stroke:a,...o})}),de=h.forwardRef(function(t,a){return e.jsx(Te,{Icon:ke,...t,ref:a})});function fe({position:n,...t}){const a=n==="right"?"rotate(180)":"rotate(0)";return e.jsx("circle",{cx:-38.3*.4,cy:0,r:le/4,stroke:"#aaa",strokeWidth:D*1.75,fill:"white",strokeDasharray:"2.7 2.5",transform:a,...t})}const te=(n,t)=>Array.from(Array(n).keys()).map(a=>(a-(n-1)/2)*t),at=(n,t,a)=>{if(n<=0)return[];if(n===1)return[[0,0]];const s=t>n?n:t,r=le,o=Ye,i=te(s,r),c=Math.ceil(n/s),m=te(c,o),l=n%s,d=[];for(let f=0;f<c;f++){const x=a?c-1:0;if(l===0||f!==x)for(let u=0;u<s;u++)d.push([i[u],m[f]]);else{const u=te(l,r);for(let N=0;N<l;N++)d.push([u[N],m[f]])}}return d},Ne=n=>n==="fmetro"?Re:ke,H=D*7,ne=D*2.2;h.forwardRef(function({stations:t,textClassName:a,columns:s=2,topHeavy:r,anchorAt:o,osiPosition:i,children:c,...m},l){const d=h.useMemo(()=>at(t.length,s,r),[t.length,s,r]),[f,x]=h.useMemo(()=>{if(o===void 0)return[0,0];if(o<0||o>=d.length)return console.warn("<InterchangeStation2024/>, anchor index ".concat(o," is out of bound")),[0,0];{const[p,S]=d[o];return[-p,-S]}},[d,o]),u=h.useRef(null),N=h.useRef([]);h.useEffect(()=>{N.current=N.current.slice(0,t.length)},[t.length]);const _=t.length===2&&s===1&&!!i;return h.useImperativeHandle(l,()=>({target:u.current,children:N.current,getCoordinates:()=>d,getCorrectedBBox:()=>{var S,g;const p=(g=(S=u.current)==null?void 0:S.getBBox())!=null?g:{x:0,y:0,width:0,height:0};return p.y-=H/2,p.height+=H,_?(i==="left"?p.x-=ne/2:p.x-=H/2,p.width+=ne/2+H/2):(p.x-=H/2,p.width+=H),p},getTranslate:()=>[f,x]}),[d,f,x,u.current,N.current,i]),e.jsxs("g",{ref:u,transform:"translate(".concat(f,",").concat(x,")"),...m,children:[t.map(({style:p},S)=>{const g=Ne(p);return e.jsx(g,{stroke:"#aaa",filled:!0,strokeWidth:H,transform:"translate(".concat(d[S][0],",").concat(d[S][1],")")},S)}),_&&e.jsx(fe,{position:i,r:le/2.9,strokeWidth:ne,strokeDasharray:void 0}),t.map(({style:p},S)=>{const g=Ne(p);return e.jsx(g,{stroke:"white",filled:!0,strokeWidth:D*2.6,transform:"translate(".concat(d[S][0],",").concat(d[S][1],")")},S)}),_&&e.jsx(fe,{position:i}),t.length&&e.jsx("rect",{fill:"white",x:-12,y:d[0][1],width:24,height:-d[0][1]*2}),t.map(({style:p,...S},g)=>{const j=p==="fmetro"?Qe:de;return e.jsx(j,{ref:y=>N.current[g]=y,transform:"translate(".concat(d[g][0],",").concat(d[g][1],")"),textClassName:a,...S},g)}),c]})});const X=9,Ce=10*Math.PI/180,ot=X*Math.sin(Ce),it=X*Math.cos(Ce),pe="M0,".concat(X," A").concat(X,",").concat(X," 0 0,0 ").concat(ot,",-").concat(it);function ct(n){return e.jsxs("g",{...n,children:[e.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),e.jsx("path",{d:pe,stroke:"red",strokeWidth:3,fill:"none"}),e.jsx("path",{d:pe,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),e.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]})}const lt=h.forwardRef(function({clockwise:t,anchorAt:a="text",...s},r){const o=a==="circle"?29:0;return e.jsx("g",{ref:r,...s,children:e.jsxs("g",{transform:"translate(".concat(o,",0)"),children:[e.jsx(ct,{transform:"translate(-30,0)scale(".concat(t?-1:1,",1)")}),e.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),e.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})})}),mt=h.memo(function(t){const{stnName:a,onUpdate:s,onEnNameUpdate:r}=t,{zh:o="",en:i=""}=a,c=h.useRef(null);return h.useEffect(()=>{if(c.current){s==null||s(c.current.getBBox());const m=c.current.querySelector("g");m&&(r==null||r(m.getBBox()))}},[JSON.stringify(a),c.current]),e.jsxs("g",{ref:c,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:o}),e.jsx("g",{fontSize:10.5,children:i.split("\\").map((m,l)=>e.jsx("text",{className:"rmg-name__en",dy:16+l*11,children:m},l))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName));function ht(n){const{stnName:t,onUpdate:a,passed:s,...r}=n,{zh:o="",en:i=""}=t,c=h.useRef(null),[m,l]=h.useState({x:0,width:0});return h.useEffect(()=>{if(c.current){const d=c.current.getBBox();l(d),a==null||a(d)}},[JSON.stringify(t)]),!o&&!i?e.jsx(e.Fragment,{}):e.jsxs("g",{fill:s?"#aaa":"#000",...r,children:[e.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[e.jsx("text",{textAnchor:"end",x:m.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:m.width+m.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:c,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:o}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:i})]})]})}function dt(n){const{passed:t,...a}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...a,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function xt(n){const{passed:t,temporary:a,...s}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...s,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),e.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),a&&e.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function gt(n){var p,S,g;const{primaryName:t,secondaryName:a,stationState:s,flipped:r,express:o,underConstruction:i}=n,[c,m]=h.useState({width:0}),[l,d]=h.useState({width:0}),[f,x]=h.useState({x:0,width:-20}),u=j=>{switch(j){case I.PASSED:return"#aaa";case I.CURRENT:return"#f00";case I.FUTURE:return"#000"}},N=(g=(S=(p=t.en)==null?void 0:p.split("\\"))==null?void 0:S.length)!=null?g:1,_={g:{x:0,y:r?17.5:-20-N*14*Math.cos(-45)},StationSecondaryName:{x:(c.width+f.width/2+10)*(r?-1:1),y:2+5*(N-1)},ExpressTag:{x:(c.width+f.width+20+35)*(r?-1:1),y:2+5*(N-1)},UnderConstructionTag:{x:(l.width+5+20)*(r?-1:1),y:c.y+c.height-14}};return e.jsxs("g",{textAnchor:r?"end":"start",fill:u(s),transform:"translate(".concat(_.g.x,",").concat(_.g.y,")rotate(-45)"),children:[e.jsx(mt,{stnName:t,onUpdate:m,onEnNameUpdate:d}),a&&e.jsx(ht,{stnName:a,onUpdate:x,passed:s===I.PASSED,transform:"translate(".concat(_.StationSecondaryName.x,",").concat(_.StationSecondaryName.y,")")}),o&&e.jsx(dt,{passed:s===I.PASSED,transform:"translate(".concat(_.ExpressTag.x,",").concat(_.ExpressTag.y,")")}),i&&e.jsx(xt,{passed:s===I.PASSED,temporary:i==="temp",transform:"translate(".concat(_.UnderConstructionTag.x,",").concat(_.UnderConstructionTag.y,")")})]})}function ut(n){var B,R,C,A,F,O,$,b,L;const{stnId:t,stnState:a,stnY:s}=n,{theme:r,line_name:o,line_num:i,spanLineNum:c,stn_list:m,loop:l,loop_info:{midpoint_station:d,clockwise:f}}=E(ee=>ee.param),x=m[t],u=d===t,[N,_]=h.useState({height:0}),p=h.useRef(null);h.useEffect(()=>{p.current&&_(p.current.getBBox())},[p.current,s,x.localisedName,x.localisedSecondaryName,x.services]);const S=x.parents.length===2||x.children.length===2,g=s>0||x.parents.indexOf(((R=(B=x.branch)==null?void 0:B.left)==null?void 0:R[1])||"")===1||x.children.indexOf(((A=(C=x.branch)==null?void 0:C.right)==null?void 0:A[1])||"")===1?180:0,j=($=(O=(F=x.localisedName.en)==null?void 0:F.split("\\"))==null?void 0:O.length)!=null?$:1,y=S?g===180?16+(j-1)*12*Math.cos(-45):-9:g===180?-6:(25+(j-1)*15)*Math.cos(-45),z=s>0?N.height+23:-N.height-23;return e.jsxs(e.Fragment,{children:[e.jsx(ft,{intInfos:S?[{theme:[r[0],r[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:o},...(b=x.transfer.groups[0].lines)!=null?b:[]]:(L=x.transfer.groups[0].lines)!=null?L:[],stnState:l?I.FUTURE:a,tickRotation:g,spanDigits:c}),e.jsx(de,{lineNum:i,stnNum:x.num,strokeColour:r[2],textClassName:"rmg-name__zh",passed:a===-1,alwaysShowColouredBorder:l,bolderBorder:!0,useSameScale:!0}),e.jsx("g",{ref:p,transform:"translate(".concat(-y,",0)"),children:e.jsx(gt,{primaryName:x.localisedName,secondaryName:x.localisedSecondaryName,stationState:a,flipped:g===180,express:x.services.includes(Pe.express),underConstruction:x.underConstruction})}),u&&e.jsx(lt,{transform:"translate(0,".concat(z,")"),clockwise:f,anchorAt:s>0?"text":"circle"})]})}const ft=n=>e.jsxs(e.Fragment,{children:[e.jsx(Nt,{strokeWidth:4,...n}),e.jsx(pt,{transform:"translate(0,".concat(n.tickRotation===180?-47:23,")"),...n})]}),Nt=n=>{const{intInfos:t,stnState:a,tickRotation:s,spanDigits:r,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>{var m;return e.jsx("use",{xlinkHref:"#inttick",stroke:a===-1?"#aaa":(m=i.theme)==null?void 0:m[2],transform:"translate(".concat(-2*(t.length-1)+4*c,",0)rotate(").concat(s===180?180:0,")")},c)})})},pt=n=>{const{intInfos:t,tickRotation:a,stnState:s,spanDigits:r,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>{var m,l,d,f;return e.jsx("g",{transform:"translate(0,".concat(c*28*(a===180?-1:1),")"),children:e.jsx(he,{zhName:i.name[0],enName:i.name[1],foregroundColour:(l=(m=i.theme)==null?void 0:m[3])!=null?l:P.white,backgroundColour:(f=(d=i.theme)==null?void 0:d[2])!=null?f:"#aaaaaa",zhClassName:"rmg-font__zh",enClassName:"rmg-font__en",passed:s===-1,spanDigits:r})},c)})})};function Ae(n){const{xs:t,ys:a,stnStates:s}=n,{stn_list:r,loop:o}=E(m=>m.param),{branches:i}=E(m=>m.helper),c=o?i[0].slice(1,-1):Object.keys(r);return e.jsx("g",{id:"stn_icons",children:c.filter(m=>!["linestart","lineend"].includes(m)).map(m=>e.jsx("g",{style:{transform:"translate(".concat(t[m],"px,").concat(a[m],"px)")},children:e.jsx(ut,{stnId:m,stnState:s[m],stnY:a[m]})},m))})}const Se=(n,t)=>n[t].parents.length===2||n[t].children.length===2?.25:0,St=(n,t,a)=>{const s=T("linestart","lineend",t);if(s.nodes.includes(n))return T(s.nodes[1],n,t).len;{const r=a.filter(l=>l.includes(n))[0];let o=n;for(;!s.nodes.includes(o);)o=r[r.indexOf(o)-1];let i=n;for(;!s.nodes.includes(i);)i=r[r.indexOf(i)+1];const c=o==="linestart",m=i==="lineend";if(r.toString()===a[0].toString()){const l=[];return!c&&!m?(l[0]=T(s.nodes[1],o,t).len,l[1]=T(o,i,t).len,l[2]=T(o,n,t).len,l[3]=T(n,i,t).len):c?(l[0]=0,l[1]=T(s.nodes[1],i,t).len,l[2]=T(r[1],n,t).len,l[3]=T(n,i,t).len):(l[0]=T(s.nodes[1],o,t).len,l[1]=T(o,s.nodes.slice(-2)[0],t).len,l[2]=T(o,n,t).len,l[3]=T(n,r.slice(-2)[0],t).len),l[0]+l[2]*l[1]/(l[2]+l[3])}else if(!c&&!m){const l=[];return l[0]=T(s.nodes[1],o,t).len,l[1]=T(o,i,t).len,l[2]=T(o,n,t).len,l[3]=T(n,i,t).len,l[0]+l[2]*l[1]/(l[2]+l[3])}else return c?T(s.nodes[1],i,t).len-T(n,i,t).len:T(s.nodes[1],o,t).len+T(o,n,t).len}},jt=()=>{const{branches:n,routes:t,depsStr:a}=E($=>$.helper),[s,r]=h.useState(45),{svgWidth:o,svg_height:i,y_pc:c,padding:m,branchSpacingPct:l,direction:d,line_name:f,spanLineNum:x,current_stn_idx:u,stn_list:N}=E($=>$.param),_=h.useRef(null);h.useEffect(()=>{const $=setTimeout(()=>{_.current&&r(_.current.getBBox().width)},100);return()=>{clearTimeout($)}},[_.current,f[0],f[1],x]);const p=Fe(N,Se,Se),S=h.useMemo(()=>(console.log("computing x shares"),Object.keys(N).reduce(($,b)=>({...$,[b]:St(b,p,n)}),{})),[n.toString(),JSON.stringify(p)]),g=T("linestart","lineend",p),j=T(g.nodes[1],g.nodes.slice(-2)[0],p),y=d===w.right?[o[k.RailMap]*m/100+65,o[k.RailMap]*(1-m/100)-20]:[o[k.RailMap]*m/100,o[k.RailMap]*(1-m/100)-65],z=Object.keys(S).reduce(($,b)=>({...$,[b]:y[0]+S[b]/j.len*(y[1]-y[0])}),{}),B=h.useMemo(()=>(console.log("computing y shares"),Object.keys(N).reduce(($,b)=>{if(n[0].includes(b))return{...$,[b]:0};{const L=n.slice(1).filter(ee=>ee.includes(b))[0];return{...$,[b]:N[L[0]].children.indexOf(L[1])?-2:2}}},{})),[a]),R=Object.keys(B).reduce(($,b)=>({...$,[b]:-B[b]*l*i/200}),{}),C=h.useMemo(()=>Ze(u,t,d),[u,d,t.toString()]),A=n.map($=>Ge($,C)).reduce(($,b)=>($.main.push(b.main),$.pass.push(b.pass),$),{main:[],pass:[]}),F=Object.keys(A).reduce(($,b)=>({...$,[b]:A[b].map(L=>yt(L,z,R))}),{}),O=s+20;return e.jsxs("g",{id:"main",style:{"--y-percentage":c,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx(_t,{paths:F}),e.jsx(Ae,{xs:z,ys:R,stnStates:C}),e.jsx("g",{className:"line_name",style:{"--translate-x":d===w.right?"".concat(y[0]-O,"px"):"".concat(y[1]+O,"px")},children:e.jsx(he,{ref:_,zhName:f[0],enName:f[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:x})})]})},_t=h.memo(function(t){return e.jsxs("g",{fill:"none",strokeWidth:4,children:[e.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((a,s)=>e.jsx("path",{d:a},s))}),e.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((a,s)=>e.jsx("path",{d:a},s))})]})},(n,t)=>JSON.stringify(n.paths)===JSON.stringify(t.paths)),yt=(n,t,a)=>{let s;const r=[];return n.forEach(o=>{const i=t[o],c=a[o];if(!s&&s!==0){s=c,r.push("M ".concat(i,",").concat(c));return}c===0?(c<s&&r.push("H ".concat(i-40),"a 40,40 0 0,0 40,-40","V ".concat(c)),c>s&&r.push("H ".concat(i-40),"a 40,40 0 0,1 40,40","V ".concat(c))):(c<s&&r.push("V ".concat(c+40),"a 40,40 0 0,1 40,-40","H ".concat(i)),c>s&&r.push("V ".concat(c-40),"a 40,40 0 0,0 40,40","H ".concat(i))),r.push("H ".concat(i)),s=c}),r.join(" ").replace(/( H ([\d.]+))+/g," H $2")},Ie=150;function Q(n){return e.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H".concat(Ie," V10 H40 L90,60z"),fill:"black",...n})}function zt(n){const{destIds:t,textAnchor:a,...s}=n,r=E(l=>l.param.direction),o=E(l=>l.param.stn_list),i=t.map(l=>{var d,f;return(f=(d=o[l].localisedName.zh)==null?void 0:d.length)!=null?f:0}),c=Math.min(...i),m=c>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(c-1):0;return e.jsxs("g",{textAnchor:a,...s,children:[t.map((l,d)=>{var u;const f=i[d]>i[1-d],x=!Xe()&&a==="end"&&!f;return e.jsxs(h.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,x:r===w.left?0:-75,y:-21+42*d,letterSpacing:f?"0em":"".concat(m,"em"),dx:x?"".concat(m,"em"):"0em",children:o[l].localisedName.zh}),e.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:r===w.left?0:-75,y:-1+42*d,children:"Towards "+((u=o[l].localisedName.en)==null?void 0:u.replace("\\"," "))})]},l)}),e.jsx("text",{className:"rmg-name__zh",fontSize:28,x:r===w.left?25*(Math.max(...i)+1):0,y:5,children:"方向"})]})}const $t=(n,t,a,s)=>{const i=n*(1-2*t/100)*(a-1)/a-s,c=n-i;return[c/2,n-c/2]},wt=(n,t,a)=>{const s=Math.min(...Object.values(n)),r=Math.max(...Object.values(n)),o=Math.min(...Object.values(t)),c=Math.max(...Object.values(t))-o,m=c/2;return"M".concat(r,",").concat(o," H").concat(s," h-").concat(a/2," a").concat(m,",").concat(m," 0 0,0 0,").concat(c," H").concat(r," h").concat(a/2," a").concat(m,",").concat(m," 0 0,0 0,-").concat(c,"Z")},Bt=(n,t,a,s)=>{const r=n.indexOf(a),o=n.indexOf(s!=null?s:a);let i;return o<0?i=n:t?i=r<=o?[...n.slice(0,r+1),...n.slice(o)]:n.slice(o,r+1):i=r<o?n.slice(r,o+1):[...n.slice(r),...n.slice(0,o+1)],n.reduce((c,m,l)=>r===l?{...c,[m]:I.CURRENT}:i.includes(m)?{...c,[m]:I.FUTURE}:{...c,[m]:I.PASSED},{})},je=6;function Et({currentStationX:n,currentStationY:t,stationGap:a,loopClockwise:s}){const r=t>0?s?-1:1:s?1:-1,o=(a/3-je)*r,i=n+o+je*r,c=(t-12)*-r;return e.jsx("g",{transform:"scale(1,".concat(-r,")"),children:e.jsx("path",{d:"M".concat(i,",").concat(c," h").concat(o),strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function _e({clockwise:n,...t}){return e.jsx("g",{...t,children:e.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:16,children:n?"内环":"外环"}),e.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:n?"Inner Circle":"Outer Circle"})]})})}const Me=2/3,vt=2-Me,Rt=25*Math.PI/180,Tt=Math.asin(Math.sin(35*Math.PI/180)/2);function bt({cxLeft:n,cxRight:t,yGap:a,clockwise:s}){const r=a/2,o=r*(s?Me:vt),i=s?Rt:Tt,c=o*Math.cos(i),m=s?1:-1,l=s?1:0,d=o*Math.sin(i)*m,f=2*d,x={rotate:s?"-4deg":"2deg"};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(".concat(n,",0)"),children:[e.jsx("path",{d:"M".concat(-c,",").concat(d," a").concat(o,",").concat(o," 0 0,").concat(l," 0,").concat(-f),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:x}),e.jsx(_e,{transform:"translate(".concat(s?0:-2*r,",0)"),clockwise:s})]}),e.jsxs("g",{transform:"translate(".concat(t,",0)"),children:[e.jsx("path",{d:"M".concat(c,",").concat(-d," a").concat(o,",").concat(o," 0 0,").concat(l," 0,").concat(f),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:x}),e.jsx(_e,{transform:"translate(".concat(s?0:2*r,",0)"),clockwise:s})]})]})}function kt(){const{branches:n}=E(j=>j.helper),{svgWidth:t,svg_height:a,y_pc:s,padding:r,branchSpacingPct:o,current_stn_idx:i,loop_info:{midpoint_station:c,clockwise:m}}=E(j=>j.param),l=n[0].slice(1,-1),d=Math.ceil(l.length/2),f=h.useMemo(()=>(console.log("computing x shares"),l.reduce((j,y,z,B)=>{let R;return z<d?R=d-z-1:(R=z-d,B.length&1&&(R+=.5)),{...j,[y]:R}},{})),[l.toString()]),x=o*a*2/100,u=$t(t[k.RailMap],r,d,x),N=(u[1]-u[0])/(d-1),_=Object.keys(f).reduce((j,y)=>({...j,[y]:u[0]+f[y]*N}),{}),p=h.useMemo(()=>(console.log("computing y shares"),l.reduce((j,y,z)=>({...j,[y]:z<d?1:-1}),{})),[l.toString()]),S=Object.keys(p).reduce((j,y)=>({...j,[y]:-p[y]*x/2}),{}),g=Bt(l,m!=null?m:!1,i,c);return e.jsxs("g",{id:"main",style:{"--y-percentage":s,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx("path",{d:wt(_,S,N),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),e.jsx(Ae,{xs:_,ys:S,stnStates:g}),e.jsx(Et,{currentStationX:_[i],currentStationY:S[i],stationGap:N,loopClockwise:m}),e.jsx(bt,{cxLeft:u[0]-N/2,cxRight:u[1]+N/2,yGap:x,clockwise:m})]})}const ye=k.RailMap,Ct=()=>{const{canvasScale:n}=E(u=>u.app),{svgWidth:t,svg_height:a,direction:s,psd_num:r,info_panel_type:o,notesGZMTR:i,current_stn_idx:c,stn_list:m,theme:l,loop:d}=E(u=>u.param),f=t[ye],x=m[c];return e.jsxs(Be,{type:ye,svgWidth:f,svgHeight:a,canvasScale:n,theme:l,children:[e.jsx(At,{}),e.jsx(Ee,{variant:o,isShowLight:o===v.gz2otis,isShowPSD:o===v.gz2otis&&r}),!d&&(s===w.left&&x.parents.includes("linestart")||s===w.right&&x.children.includes("lineend"))?e.jsx(Wt,{}):e.jsxs(e.Fragment,{children:[d?e.jsx(kt,{}):e.jsx(jt,{}),!d&&e.jsx(It,{}),i==null?void 0:i.map((u,N)=>e.jsx(Dt,{note:u},N))]}),o===v.gz2otis&&e.jsx("line",{x2:f,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},At=h.memo(function(){return e.jsxs("defs",{children:[e.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),e.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:e.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),It=()=>{const{routes:n}=E(c=>c.helper),{direction:t,direction_gz_x:a,direction_gz_y:s,current_stn_idx:r}=E(c=>c.param),o=h.useMemo(()=>[...new Set(n.reduce((c,m)=>m.includes(r)?c.concat(m.filter(l=>!["linestart","lineend"].includes(l)).slice(t===w.left?0:-1)[0]):c,[]).filter(c=>c!==r))],[r,t,n.toString()]),i={textAnchor:t===w.left?"start":"end",transform:"translate(".concat(t===w.left?65:-65,",-5)"),destIds:o};return e.jsxs("g",{id:"direction_gz",style:{"--x-percentage":a,"--y-percentage":s},children:[e.jsx(Q,{transform:"scale(0.35)rotate(".concat(t===w.left?0:180,")")}),o.length!==2?e.jsx(Mt,{...i}):e.jsx(zt,{...i})]})},Mt=n=>{const{destIds:t,...a}=n,s=E(r=>r.param.stn_list);return e.jsxs("g",{...a,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(r=>s[r].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(r=>{var o;return(o=s[r].localisedName.en)==null?void 0:o.replace("\\"," ")}).join("/")})]})},Wt=h.memo(function(){return e.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),e.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),e.jsxs("g",{strokeWidth:8,stroke:"#000",children:[e.jsx("path",{d:"M -160,68 h -160"}),e.jsx("path",{d:"M 160,68 h 160"})]})]})}),Dt=h.memo(function(t){const a=h.useRef(null),[s,r]=h.useState({width:0,height:0,y:0});return h.useEffect(()=>{a.current&&r(a.current.getBBox())},[t.note[0],t.note[1]]),e.jsxs("g",{className:"note-box",style:{"--x-percentage":t.note[2],"--y-percentage":t.note[3]},children:[t.note[4]&&e.jsx("rect",{height:s.height+4,width:s.width+4,x:-2,y:s.y-2,fill:"none",stroke:"black",strokeWidth:.5}),e.jsxs("g",{ref:a,children:[e.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((o,i)=>e.jsx("text",{className:"rmg-name__zh",y:i*18,children:o},i))}),e.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((o,i)=>{var c;return e.jsx("text",{className:"rmg-name__en",y:i*11,textLength:i<(((c=t.note[1].match(/\n/g))==null?void 0:c.length)||0)?s.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:o},i)})})]})]})},(n,t)=>n.note.toString()===t.note.toString()),se=92,Ot=(n,t)=>{switch(t){case 2:return n==="gz11"?.2:.5;case 3:return .1;default:return 0}},Lt=h.memo(function(t){var c,m,l;const{stnName:a,panelType:s,onUpdate:r}=t,o=h.useRef(null),i=Ot(s,(c=a.zh)==null?void 0:c.length);return h.useEffect(()=>{if(o.current&&r){const d=o.current.getBBox();r({...d,x:d.x+i*se/2,width:d.width-i*se})}},[o.current,JSON.stringify(a),s]),e.jsxs("g",{ref:o,fontWeight:s==="gz11"?"bold":"normal",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:se,x:i/2+"em",letterSpacing:i+"em",children:a.zh}),e.jsx("g",{fontSize:40,children:(l=(m=a.en)==null?void 0:m.split("\\"))==null?void 0:l.map((d,f)=>e.jsx("text",{className:"rmg-name__en",dy:72+f*42,children:d},f))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName)&&n.panelType===t.panelType),Ht=n=>{const{secondaryName:t,transform:a}=n,s=h.useRef(null),[r,o]=h.useState({x:0,width:0});return h.useEffect(()=>{s.current&&o(s.current.getBBox())},[t.toString()]),e.jsxs("g",{transform:a,children:[e.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[e.jsx("text",{textAnchor:"end",x:r.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:r.width+r.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:s,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),e.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},J=55,We=18.5*1.4,De=30,Pt=De*4,Oe=.82,Le=.25,ze=.4,He=(n,t,a)=>{const{stn_list:s,current_stn_idx:r,direction:o,loop:i,loop_info:{midpoint_station:c,clockwise:m}}=n;return i?Zt(t[0].slice(1,-1),s,r,c,m):Ft(a,s,r,o)},Ft=(n,t,a,s)=>{const r=s==="l"?"parents":"children",o=t[a][r].map(c=>t[c].underConstruction?t[c][r]:c).flat(),i=n.find(c=>c.includes(a)&&c.includes(o[0]));if(i){const c=i.indexOf(a),l=(s==="l"?i.slice(0,c).toReversed():i.slice(c+1)).filter(d=>!["linestart","lineend"].includes(d)).reduce((d,f)=>{var x;return(x=t[f].transfer.groups[0].lines)!=null&&x.length?[...d,f]:d},[]).slice(0,3);return{nextStations:o,viaStations:l}}else return{nextStations:o,viaStations:[]}},Zt=(n,t,a,s,r)=>{const o=n.filter(x=>!t[x].underConstruction),i=r?o.toReversed():o,c=i.indexOf(a),m=[...i,...i].slice(c+1),l=[m[0]],d=m.slice(1).reduce((x,u)=>{var N;return(N=t[u].transfer.groups[0].lines)!=null&&N.length?[...x,u]:t[u].loop_pivot?[...x,u]:x},[]),f=s?[...d.slice(0,2),s]:d.slice(0,3);return{nextStations:l,viaStations:f}},Gt=h.forwardRef(function({stationInfo:t,...a},s){var l,d,f,x,u,N,_,p;const{localisedName:r,transfer:{groups:[{lines:o}]}}=t,[i,c]=h.useState({width:0}),m=h.useRef(null);return h.useEffect(()=>{m.current&&c(m.current.getBBox())},[m.current,JSON.stringify(r)]),e.jsxs("g",{ref:s,...a,children:[e.jsxs("g",{ref:m,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:r.zh}),(d=(l=r.en)==null?void 0:l.split("\\"))==null?void 0:d.map((S,g)=>e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*g,children:S},g))]}),e.jsx("g",{transform:"translate(".concat(i.width+2,",7)"),children:(o==null?void 0:o.length)&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M0,0 H8",stroke:(x=(f=o[0].theme)==null?void 0:f[2])!=null?x:"#aaa",strokeWidth:3.5}),e.jsx(he,{zhName:o[0].name[0],enName:o[0].name[1],backgroundColour:(N=(u=o[0].theme)==null?void 0:u[2])!=null?N:"#aaa",foregroundColour:(p=(_=o[0].theme)==null?void 0:_[3])!=null?p:P.white,zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:!0,transform:"translate(27,-8.5)scale(0.75)"})]})})]})});function Xt({viaStations:n,stationList:t}){const a=h.useRef([]),[s,r]=h.useState([]);h.useEffect(()=>{a.current=[]},[n,t]),h.useEffect(()=>{r(a.current.map(i=>{var c,m;return(m=(c=i==null?void 0:i.getBBox())==null?void 0:c.height)!=null?m:0}))},[a.current]);const o=h.useCallback(i=>s.slice(0,i).reduce((c,m)=>c+m+4,0),[s]);return e.jsx(e.Fragment,{children:n.map((i,c)=>e.jsx(Gt,{ref:m=>a.current[c]=m,stationInfo:t[i],transform:"translate(0,".concat(o(c),")")},i))})}const re=44,ae=25;function Ut({nameBBox:n}){const t=E(j=>j.param),{svg_height:a,svgWidth:s,direction:r,current_stn_idx:o,stn_list:i}=t,{branches:c,routes:m}=E(j=>j.helper),l=s[k.RunIn],{nextStations:[d],viaStations:f}=He(t,c,m),{localisedName:{en:x=""},localisedSecondaryName:u}=i[o],{localisedName:{zh:N="",en:_=""}}=i[d],p=_.split("\\").length,S=(l-n.width)/2,g={next:{x:80},nextName:{x:80+re*1.7},via:{dy:75+25*(p-1)},arrow:{x:r===w.left?(115+50*(.5+N.length)+S)/2-20:((l+n.width)/2+(l*Oe-Pt/2))/2+Ie*ze/2,y:.5*a-(x.split("\\").length-2)*18-(u?58/2:0),rotate:r===w.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(0,".concat(a/2+5-g.via.dy,")"),children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(g.next.x,",0)"),children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:re,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ae,dy:40,children:"Next"})]}),e.jsxs("g",{transform:"translate(0,".concat(g.via.dy,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),e.jsxs("g",{textAnchor:"start",transform:"translate(".concat(g.nextName.x,",0)"),children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:re,children:N}),e.jsx("g",{fontSize:ae,children:_.split("\\").map((j,y)=>e.jsx("text",{className:"rmg-name__en",dy:40+y*ae,children:j},y))})]}),f&&e.jsx("g",{transform:"translate(0,".concat(g.via.dy,")"),children:e.jsx(Xt,{viaStations:f,stationList:i})})]})]}),e.jsx(Q,{transform:"translate(".concat(g.arrow.x,",").concat(g.arrow.y,")scale(").concat(ze,")rotate(").concat(g.arrow.rotate,")")})]})}function Vt({secName:n,...t}){const{zh:a,en:s}=n,r=h.useRef(null),[o,i]=h.useState({x:0,width:0});return h.useEffect(()=>{r.current&&i(r.current.getBBox())},[a,s]),e.jsxs("g",{...t,children:[e.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[e.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:r,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:a}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:s})]})]})}const V=35,oe=17;function Yt({nextId:n,nameBBox:t,ignoreNumWidth:a}){const{svgWidth:s,svg_height:r,direction:o}=E(g=>g.param),i=E(g=>g.param.stn_list[n]),{localisedName:c,localisedSecondaryName:m}=i,{zh:l="",en:d=""}=c,f=s[k.RunIn],[x,u]=h.useState({width:0}),N=h.useRef(null);h.useEffect(()=>{N.current&&u(N.current.getBBox())},[l,d]);const _=l.length,p=(f-t.width)/2,S={next:{x:o===w.left?80:f-45-x.width-V*(_<=2?2:1.5)},nextName:{x:o===w.left?80+V*(_<=2?2:1.5):f-45-x.width},arrow:{x:o===w.left?(115+35*((_<=2?1:.5)+_)+p)/2-20:(f-45-x.width-(_<=2?105:35*2.5)+p+t.width+(a?0:J+We))/2+20,y:r/2-30,rotate:o===w.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(0,".concat(r/2-40,")"),children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(S.next.x,",0)"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:V,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:oe,dy:30,children:"Next"})]}),e.jsxs("g",{textAnchor:"start",ref:N,transform:"translate(".concat(S.nextName.x,",0)"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:V,children:l}),e.jsx("g",{fontSize:oe,children:d.split("\\").map((g,j)=>e.jsx("text",{className:"rmg-name__en",dy:30+j*oe,children:g},j))})]}),m&&e.jsx("g",{textAnchor:"middle",transform:"translate(".concat(S.nextName.x,",0)"),children:e.jsx(Vt,{secName:m,transform:"translate(".concat(x.width/2,",").concat(30+d.split("\\").length*17+5,")")})})]}),e.jsx(Q,{transform:"translate(".concat(S.arrow.x,",").concat(S.arrow.y,")scale(").concat(Le,")rotate(").concat(S.arrow.rotate,")")})]})}const Jt=()=>{var B,R,C;const n=E(A=>A.param),{svg_height:t,svgWidth:a,theme:s,direction:r,info_panel_type:o,line_num:i,current_stn_idx:c,stn_list:m}=n,{branches:l,routes:d}=E(A=>A.helper),f=m[c],{localisedName:x,localisedSecondaryName:u}=f,[N,_]=h.useState({width:0}),p=(C=(R=(B=x.en)==null?void 0:B.split("\\"))==null?void 0:R.length)!=null?C:1,{nextStations:S}=He(n,l,d),g=[v.gz7w,v.gz11].includes(o),j={name:"translate(".concat((r===w.left?1:-1)*a[k.RunIn]/4,",45)"),next:"translate(".concat((r===w.left?1:-1)*a[k.RunIn]/10,",45)")},y=(a[k.RunIn]+N.width)/2+J,z={nameGroup:{x:a.runin/2,y:.5*t-50-(p-1)*18-(u?29:0)},secondaryName:{x:0,y:70+p*36},stationNumber:{x:y,y:.5*t-30-(p-1)*18-(u?58/2:0)},stationNumberPost2022:{x:r===w.left?y:(a[k.RunIn]-N.width)/2-J,y:.5*t-(p-2)*18-(u?58/2:0)}};return e.jsxs("g",{children:[e.jsxs("g",{transform:o===v.gz2otis?j.name:"",children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(z.nameGroup.x,",").concat(z.nameGroup.y,")"),children:[e.jsx(Lt,{stnName:x,panelType:o,onUpdate:_}),u&&e.jsx(Ht,{secondaryName:u,transform:"translate(".concat(z.secondaryName.x,",").concat(z.secondaryName.y,")")})]}),e.jsx(de,{lineNum:i,stnNum:f.num,strokeColour:s[2],textClassName:"rmg-name__zh",transform:g?"translate(".concat(z.stationNumberPost2022.x,",").concat(z.stationNumberPost2022.y,")"):"translate(".concat(z.stationNumber.x,",").concat(z.stationNumber.y,")"),size:"lg"})]}),o===v.gz11?e.jsx(Ut,{nameBBox:N}):e.jsx("g",{transform:o===v.gz2otis?j.next:"",children:!S||S.includes("linestart")||S.includes("lineend")?e.jsx(e.Fragment,{}):S.length===1?e.jsx(Yt,{nextId:S[0],nameBBox:N,ignoreNumWidth:g}):e.jsx(qt,{nextIds:S,nameBBox:N,ignoreNumWidth:g})})]})},$e=27,ie=13,we=110,qt=n=>{const{nextIds:t,nameBBox:a,ignoreNumWidth:s}=n,{routes:r}=E(g=>g.helper),{svgWidth:o,svg_height:i,direction:c,stn_list:m}=E(g=>g.param),l=o[k.RunIn],d=t.map(g=>m[g].localisedName),[f,x]=h.useState({width:0}),u=h.useRef([]);h.useEffect(()=>{x(g=>({...g,width:0})),u.current.forEach(g=>{const j=g==null?void 0:g.getBBox();x(y=>j?y.width>j.width?y:j:y)})},[d.toString()]);const N=n.nextIds.map(g=>r.reduce((j,y)=>y.includes(g)?j.concat(y.filter(z=>!["linestart","lineend"].includes(z)).slice(c===w.left?0:-1)[0]):j,[])),_=Math.max(...d.map(g=>{var j,y;return(y=(j=g.zh)==null?void 0:j.length)!=null?y:0})),p=(l-a.width)/2,S={next:{x:c===w.left?72:l-45-f.width-41},nextName:{x:c===w.left?113:l-45-f.width},arrow:{x:c===w.left?(99+27*(1+_)+p)/2-20:(l-45-f.width-41-27+p+n.nameBBox.width+(s?0:J+We))/2+20,y:i/2-30,rotate:c===w.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsx("g",{transform:"translate(0,".concat(i/2-70,")"),children:d.map((g,j)=>{var y,z;return e.jsxs(h.Fragment,{children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(S.next.x,",").concat(we*j,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:$e,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ie,y:22,children:"Next"})]}),e.jsxs("g",{ref:B=>u.current[j]=B,textAnchor:"start",transform:"translate(".concat(S.nextName.x,",").concat(we*j,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:$e,children:g.zh}),(z=(y=g.en)==null?void 0:y.split("\\"))==null?void 0:z.map((B,R)=>e.jsx("text",{className:"rmg-name__en",fontSize:ie,y:22+R*ie,children:B},R)),e.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:N[j].map(B=>m[B].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+N[j].map(B=>m[B].localisedName.en).join("/").replace("\\"," ")})]})]},j)})}),e.jsx(Q,{transform:"translate(".concat(S.arrow.x,",").concat(S.arrow.y,")scale(").concat(Le,")rotate(").concat(S.arrow.rotate,")")})]})};function Kt(n){const{num:t,...a}=n;return e.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...a,children:[e.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),e.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function Qt(n){const{canvasType:t}=n,{svgWidth:a,svg_height:s}=E(r=>r.param);return e.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[e.jsx("line",{y2:s,transform:"translate(".concat(a[t]/2,",0)")}),e.jsx("line",{x2:a[t],transform:"translate(0,90)"})]})}const W=De;function en({coachNumber:n,...t}){return e.jsxs("g",{...t,children:[e.jsx("path",{d:"M-".concat(W,",-").concat(W," a").concat(W,",").concat(W," 0 0,0 0,").concat(2*W," h").concat(2*W," a").concat(W,",").concat(W,", 0 0,0 0,-").concat(2*W,"Z"),fill:"whitesmoke",stroke:"lightgrey"}),e.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),e.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:e.jsx("text",{className:"rmg-name__zh",fontSize:36,children:n})})]})}const ce=k.RunIn;function tn(){const{canvasScale:n}=E(u=>u.app),{svgWidth:t,svg_height:a,direction:s,info_panel_type:r,platform_num:o,psd_num:i,coachNum:c,theme:m}=E(u=>u.param),l=t[ce],d=[v.gz7w,v.gz11].includes(r),f=d?a-78:a/2-30,x={platform:"translate(".concat(s===w.left?50:-50,",45)")};return e.jsxs(Be,{type:ce,svgWidth:l,svgHeight:a,canvasScale:n,theme:m,children:[e.jsx(Ee,{variant:r,isShowLight:r!==v.gz2otis,isShowPSD:r!==v.gz2otis&&i}),e.jsx("g",{transform:r===v.gz2otis?x.platform:"",children:e.jsx(Kt,{num:o,style:{"--translate-x":"".concat(s===w.left||r===v.gz11?l-100:100,"px"),"--translate-y":f+"px","--scale":d?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),d&&e.jsx(en,{coachNumber:c,transform:"translate(".concat(l*Oe,",").concat(a*.58,")")}),e.jsx(Jt,{}),r===v.gz2otis&&e.jsx(Qt,{canvasType:ce})]})}const ln={runin:e.jsx(tn,{}),railmap:e.jsx(Ct,{})};export{ln as default};
