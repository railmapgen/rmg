import{j as e}from"./chakra-Dgz8Jjnv.js";import{a as x}from"./react-D3Mhupst.js";import{i as P,P as R,b0 as C,u as E,n as Ze,S as B,aW as A}from"./index-C0iFBgzo.js";import{a as Ge,c as T,b as Xe,d as Ue}from"./share-BAUmhlP9.js";import{S as Ee}from"./svg-wrapper-DI4Q6-3G.js";import{i as Ve}from"./param-selector-DmgwPVqB.js";function Ye(n){const{num:t,inStrip:r,showAsPlatformDoor:s,...a}=n;return e.jsxs("g",{textAnchor:"middle",fill:r?P.black:"var(--rmg-theme-fg)",...a,children:[e.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:r?"#fff":"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),s?e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),e.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),e.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]})}const ve=n=>{const t=(a=>{switch(a){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(n.variant),r=x.useMemo(()=>{switch(n.variant){case"gz1":return e.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return e.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return e.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return e.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return e.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return e.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return e.jsx(e.Fragment,{})}},[n.variant]);return e.jsxs("g",{transform:"translate(0,".concat(n.variant==="gz4"?-15:0,")"),style:{"--strip-height":"".concat(t,"px")},children:[e.jsx("rect",{id:"strip_gz"}),n.variant===R.gz1&&e.jsx("rect",{className:"gz1-gap"}),e.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:n.isShowLight&&r}),n.isShowPSD!==!1&&e.jsx(Je,{...n})]})},Je=x.memo(function(t){const r=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),s=(i=>{switch(i){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(t.variant),a=(i=>{switch(i){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(t.variant),o=[R.gz1,R.gz3,R.gz4,R.gz5,R.gz1421,R.gz7w,R.gz11].includes(t.variant);return e.jsx(Ye,{num:t.isShowPSD,inStrip:r,showAsPlatformDoor:t.variant===R.gz11,style:{"--psd-dy":s,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":o?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":a}})},(n,t)=>n.variant===t.variant&&n.isShowPSD===t.isShowPSD);function Re(n){var t,r,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var a=n.length;for(t=0;t<a;t++)n[t]&&(r=Re(n[t]))&&(s&&(s+=" "),s+=r)}else for(r in n)n[r]&&(s&&(s+=" "),s+=r);return s}function U(){for(var n,t,r=0,s="",a=arguments.length;r<a;r++)(n=arguments[r])&&(t=Re(n))&&(s&&(s+=" "),s+=t);return s}const H=1.3,Te=1.7,Q=18.5,qe=Q+H,q=Q*2+H,Z=5,G=5.625,ge=Q-Z,ue=Q-2*G,be=x.memo(function(t){const{stroke:r,filled:s,bolder:a,...o}=t,i="M0,9.25 V-9.25 H-".concat(ge," l-").concat(Z,",").concat(G," v").concat(ue," l").concat(Z,",").concat(G," H").concat(ge," l").concat(Z,",-").concat(G," v-").concat(ue," l-").concat(Z,",-").concat(G," H0");return e.jsx("path",{d:i,fill:s?r:"#fff",strokeWidth:a?Te:H,stroke:r,...o})}),Ke={updateId:0,update:()=>{}},Qe=x.createContext(Ke),V=17,et=["Arial"],ke=x.forwardRef(function(t,r){const{Icon:s,lineNum:a,stnNum:o,strokeColour:i,passed:c,size:m,bolderBorder:h,alwaysShowColouredBorder:l,useSameScale:g,className:d,classNames:u,children:j,textProps:_,...N}=t,{updateId:S}=x.useContext(Qe),f=x.useRef(null),p=x.useRef(null),[y,z]=x.useState({width:0}),[$,b]=x.useState({width:0}),k=()=>{f.current&&z(f.current.getBBox()),p.current&&b(p.current.getBBox())};x.useEffect(()=>{const M=new AbortController;return k(),document.fonts.load("12px "+et.join(", "),(a!=null?a:"")+(o!=null?o:"")).then().finally(()=>{setTimeout(()=>{M.signal.aborted||k()},100)}),()=>{M.abort()}},[a,o,S]);const I=a&&a.length>2,O=o&&o.length>2;x.useEffect(()=>{g&&(I||O)&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[g,I,O]);const L=V/Math.max(V,y.width),w=g&&!I&&!O?L:V/Math.max(V,$.width),v=m==="sm"?"0.7":m==="lg"?"1.6":1;return e.jsxs("g",{ref:r,className:U(u==null?void 0:u.wrapper,d),...N,children:[e.jsxs("g",{transform:"scale(".concat(v,")"),children:[e.jsx(s,{stroke:c&&!l?"#aaa":i,filled:!a&&!o,bolder:h}),(a||o)&&e.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:c?"#aaa":"#000",children:[e.jsx("g",{transform:"translate(-9.25,0)scale(".concat(L,")"),children:e.jsx("text",{ref:f,dominantBaseline:"central",x:.5,className:u==null?void 0:u.digits,..._,children:a})}),e.jsx("g",{transform:"translate(9.25,0)scale(".concat(w,")"),children:e.jsx("text",{ref:p,dominantBaseline:"central",className:u==null?void 0:u.digits,..._,children:o})})]})]}),j]})}),tt=x.forwardRef(function(t,r){return e.jsx(ke,{Icon:be,...t,ref:r})}),J=45,W=J-3,Ae=(n,t)=>{const r=[n,t].map(s=>s.match(/^(\w+).+$/));if(r[0]&&r[1]&&r[0][1]===r[1][1])return r[0][1]},me=n=>{const t=n.match(/^(\d+)\D+$/);return t==null?void 0:t[1]};function ee(n){const{customWidth:t,...r}=n,s=(t!=null?t:J)-J;return e.jsx("rect",{x:-22.5-s/2,height:24,width:t!=null?t:J,rx:4.5,...r,"data-testid":"intBox"})}const nt=(n,t)=>{const r=me(n);if(r)return{isDigit:!0,spanningPart:r};const s=Ae(n,t);return s?{isDigit:!1,spanningPart:s}:{isDigit:!1,spanningPart:""}},fe=x.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:h,classNames:l,children:g,textProps:d,...u}=t,{isDigit:j,spanningPart:_}=nt(s,a),N=x.useRef(null),[S,f]=x.useState({x:0,height:0,width:0});x.useEffect(()=>{N.current&&f(N.current.getBBox())},[s,a]);const p=W/Math.max(W,S.width),y=(-S.x-S.width/2)*p,z=S.height*(1-p)/2;return e.jsxs("g",{ref:r,textAnchor:"middle",fill:c?P.white:o,className:U(l==null?void 0:l.wrapper,h),...u,children:[e.jsx(ee,{fill:c?"#aaa":i}),e.jsxs("g",{ref:N,transform:"translate(".concat(y,",").concat(z,")scale(").concat(p,")"),children:[e.jsx("text",{fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",className:l==null?void 0:l.digits,...d==null?void 0:d.digits,children:_}),e.jsx("text",{fontSize:10,x:0,y:8,textAnchor:"start",dominantBaseline:"central",className:l==null?void 0:l.zh,...d==null?void 0:d.zh,children:s.slice(_.length).trim()}),e.jsx("text",{fontSize:6.5,letterSpacing:-.1,x:0,y:18,textAnchor:"start",dominantBaseline:"middle",className:l==null?void 0:l.en,...d==null?void 0:d.en,children:j?a:a.slice(_.length).trim()})]}),g]})}),st=x.forwardRef(function(t,r){var k;const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:h,classNames:l,children:g,textProps:d,...u}=t,j=(k=me(s))!=null?k:"",_=x.useRef(null),N=x.useRef(null),[S,f]=x.useState({x:0,width:0}),[p,y]=x.useState({width:0});x.useEffect(()=>{_.current&&f(_.current.getBBox()),N.current&&y(N.current.getBBox())},[s,a]);const z=W/Math.max(W,S.width),$=W/Math.max(W,p.width),b={nameZh:{x:-(S.x+S.width/2)*z,y:7.3+13.5*(1-z)*z/2*z},nameEn:{y:19.5-9*(1-$)*$/2}};return e.jsxs("g",{ref:r,fill:c?P.white:o,className:U(l==null?void 0:l.wrapper,h),...u,children:[e.jsx(ee,{fill:c?"#aaa":i}),e.jsxs("g",{ref:_,transform:"translate(".concat(b.nameZh.x,",").concat(b.nameZh.y,")scale(").concat(z,")"),children:[e.jsx("text",{ref:_,fontSize:16,textAnchor:"end",y:.7,dominantBaseline:"central",className:l==null?void 0:l.digits,...d==null?void 0:d.digits,children:j}),e.jsx("text",{fontSize:12,textAnchor:"start",dominantBaseline:"central",className:l==null?void 0:l.zh,...d==null?void 0:d.zh,children:s.slice(j.length)})]}),e.jsx("text",{ref:N,fontSize:8,textAnchor:"middle",transform:"translate(0,".concat(b.nameEn.y,")scale(").concat($,")"),dominantBaseline:"middle",className:l==null?void 0:l.en,...d==null?void 0:d.en,children:a}),g]})}),rt=x.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:h,classNames:l,children:g,textProps:d,...u}=t,j=x.useRef(null),[_,N]=x.useState({width:0});x.useEffect(()=>{j.current&&N(j.current.getBBox())},[s,a]);const S=Math.max(45,_.width+4);return e.jsxs("g",{ref:r,textAnchor:"middle",fill:c?P.white:o,className:U(l==null?void 0:l.wrapper,h),...u,children:[e.jsx(ee,{customWidth:S,fill:c?"#aaa":i}),e.jsxs("g",{ref:j,children:[e.jsx("text",{fontSize:8.5,y:8,dominantBaseline:"central",className:l==null?void 0:l.zh,...d==null?void 0:d.zh,children:s}),e.jsx("text",{fontSize:5.5,y:18,dominantBaseline:"middle",className:l==null?void 0:l.en,...d==null?void 0:d.en,children:a})]}),g]})}),at=x.forwardRef(function(t,r){const{zhName:s,enName:a,foregroundColour:o,backgroundColour:i,passed:c,spanDigits:m,className:h,classNames:l,children:g,textProps:d,...u}=t,j=x.useRef(null),_=x.useRef(null),[N,S]=x.useState({width:0}),[f,p]=x.useState({width:0});x.useEffect(()=>{j.current&&S(j.current.getBBox()),_.current&&p(_.current.getBBox())},[s,a]);const y=W/Math.max(W,N.width),z=W/Math.max(W,f.width),$={nameZh:{y:7.3+13.5*(1-y)*y/2},nameEn:{y:19.5-9*(1-z)*z/2}};return e.jsxs("g",{ref:r,textAnchor:"middle",fill:c?P.white:o,className:U(l==null?void 0:l.wrapper,h),...u,children:[e.jsx(ee,{fill:c?"#aaa":i}),e.jsx("text",{ref:j,fontSize:12,transform:"translate(0,".concat($.nameZh.y,")scale(").concat(y,")"),dominantBaseline:"central",className:l==null?void 0:l.zh,...d==null?void 0:d.zh,children:s}),e.jsx("text",{ref:_,fontSize:8,transform:"translate(0,".concat($.nameEn.y,")scale(").concat(z,")"),dominantBaseline:"middle",className:l==null?void 0:l.en,...d==null?void 0:d.en,children:a}),g]})}),de=x.memo(x.forwardRef(function(t,r){const{zhName:s,enName:a,spanDigits:o}=t;switch(ot(s,a)){case 1:return o?e.jsx(fe,{ref:r,...t}):e.jsx(st,{ref:r,...t});case 2:return e.jsx(fe,{ref:r,...t});default:return s.length>=5?e.jsx(rt,{ref:r,...t}):e.jsx(at,{ref:r,...t})}})),ot=(n,t)=>me(n)!==void 0?1:Ae(n,t)!==void 0?2:3,Ie=x.memo(function(t){const{stroke:r,filled:s,bolder:a,...o}=t;return e.jsx("path",{d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:s?r:"#fff",strokeWidth:a?Te:H,stroke:r,...o})}),xe=x.forwardRef(function(t,r){return e.jsx(ke,{Icon:Ie,...t,ref:r})});function pe({position:n,...t}){const r=n==="right"?"rotate(180)":"rotate(0)";return e.jsx("circle",{cx:-q*.4,cy:0,r:q/4,stroke:"#aaa",strokeWidth:H*1.75,fill:"white",strokeDasharray:"2.7 2.5",transform:r,...t})}const se=(n,t)=>Array.from(Array(n).keys()).map(r=>(r-(n-1)/2)*t),it=(n,t,r)=>{if(n<=0)return[];if(n===1)return[[0,0]];const s=t>n?n:t,a=q,o=qe,i=se(s,a),c=Math.ceil(n/s),m=se(c,o),h=n%s,l=[];for(let g=0;g<c;g++){const d=r?c-1:0;if(h===0||g!==d)for(let u=0;u<s;u++)l.push([i[u],m[g]]);else{const u=se(h,a);for(let j=0;j<h;j++)l.push([u[j],m[g]])}}return l},Se=n=>n==="fmetro"?be:Ie,F=H*7,re=H*2.2;x.forwardRef(function({stations:t,classNames:r,textProps:s,columns:a=2,topHeavy:o,anchorAt:i,osiPosition:c,children:m,...h},l){const g=x.useMemo(()=>it(t.length,a,o),[t.length,a,o]),[d,u]=x.useMemo(()=>{if(i===void 0)return[0,0];if(i<0||i>=g.length)return console.warn("<InterchangeStation2024/>, anchor index ".concat(i," is out of bound")),[0,0];{const[S,f]=g[i];return[-S,-f]}},[g,i]),j=x.useRef(null),_=x.useRef([]);x.useEffect(()=>{_.current=_.current.slice(0,t.length)},[t.length]);const N=t.length===2&&a===1&&!!c;return x.useImperativeHandle(l,()=>({target:j.current,children:_.current,getCoordinates:()=>g,getCorrectedBBox:()=>{var f,p;const S=(p=(f=j.current)==null?void 0:f.getBBox())!=null?p:{x:0,y:0,width:0,height:0};return S.y-=F/2,S.height+=F,N?(c==="left"?S.x-=re/2:S.x-=F/2,S.width+=re/2+F/2):(S.x-=F/2,S.width+=F),S},getTranslate:()=>[d,u]}),[g,d,u,j.current,_.current,c]),e.jsxs("g",{ref:j,transform:"translate(".concat(d,",").concat(u,")"),...h,children:[t.map(({style:S},f)=>{const p=Se(S);return e.jsx(p,{stroke:"#aaa",filled:!0,strokeWidth:F,transform:"translate(".concat(g[f][0],",").concat(g[f][1],")")},f)}),N&&e.jsx(pe,{position:c,r:q/2.9,strokeWidth:re,strokeDasharray:void 0}),t.map(({style:S},f)=>{const p=Se(S);return e.jsx(p,{stroke:"white",filled:!0,strokeWidth:H*2.6,transform:"translate(".concat(g[f][0],",").concat(g[f][1],")")},f)}),N&&e.jsx(pe,{position:c}),t.length&&e.jsx("rect",{fill:"white",x:-12,y:g[0][1],width:24,height:-g[0][1]*2}),t.map(({style:S,...f},p)=>{const y=S==="fmetro"?tt:xe;return e.jsx(y,{ref:z=>_.current[p]=z,transform:"translate(".concat(g[p][0],",").concat(g[p][1],")"),classNames:r,textProps:s,...f},p)}),m]})});const X=9,Me=10*Math.PI/180,ct=X*Math.sin(Me),lt=X*Math.cos(Me),je="M0,".concat(X," A").concat(X,",").concat(X," 0 0,0 ").concat(ct,",-").concat(lt);function ht(n){return e.jsxs("g",{...n,children:[e.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),e.jsx("path",{d:je,stroke:"red",strokeWidth:3,fill:"none"}),e.jsx("path",{d:je,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),e.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]})}const mt=x.forwardRef(function({clockwise:t,anchorAt:r="text",...s},a){const o=r==="circle"?29:0;return e.jsx("g",{ref:a,...s,children:e.jsxs("g",{transform:"translate(".concat(o,",0)"),children:[e.jsx(ht,{transform:"translate(-30,0)scale(".concat(t?-1:1,",1)")}),e.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),e.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})})}),dt=x.memo(function(t){const{stnName:r,onUpdate:s,onEnNameUpdate:a}=t,{zh:o="",en:i=""}=r,c=x.useRef(null);return x.useEffect(()=>{if(c.current){s==null||s(c.current.getBBox());const m=c.current.querySelector("g");m&&(a==null||a(m.getBBox()))}},[JSON.stringify(r),c.current]),e.jsxs("g",{ref:c,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:o}),e.jsx("g",{fontSize:10.5,children:i.split("\\").map((m,h)=>e.jsx("text",{className:"rmg-name__en",dy:16+h*11,children:m},h))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName));function xt(n){const{stnName:t,onUpdate:r,passed:s,...a}=n,{zh:o="",en:i=""}=t,c=x.useRef(null),[m,h]=x.useState({x:0,width:0});return x.useEffect(()=>{if(c.current){const l=c.current.getBBox();h(l),r==null||r(l)}},[JSON.stringify(t)]),!o&&!i?e.jsx(e.Fragment,{}):e.jsxs("g",{fill:s?"#aaa":"#000",...a,children:[e.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[e.jsx("text",{textAnchor:"end",x:m.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:m.width+m.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:c,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:o}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:i})]})]})}function gt(n){const{passed:t,...r}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...r,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function ut(n){const{passed:t,temporary:r,...s}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...s,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),e.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),r&&e.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function ft(n){var N,S,f;const{primaryName:t,secondaryName:r,stationState:s,flipped:a,express:o,underConstruction:i}=n,[c,m]=x.useState({width:0}),[h,l]=x.useState({width:0}),[g,d]=x.useState({x:0,width:-20}),u=p=>{switch(p){case C.PASSED:return"#aaa";case C.CURRENT:return"#f00";case C.FUTURE:return"#000"}},j=(f=(S=(N=t.en)==null?void 0:N.split("\\"))==null?void 0:S.length)!=null?f:1,_={g:{x:0,y:a?17.5:-20-j*14*Math.cos(-45)},StationSecondaryName:{x:(c.width+g.width/2+10)*(a?-1:1),y:2+5*(j-1)},ExpressTag:{x:(c.width+g.width+20+35)*(a?-1:1),y:2+5*(j-1)},UnderConstructionTag:{x:(h.width+5+20)*(a?-1:1),y:c.y+c.height-14}};return e.jsxs("g",{textAnchor:a?"end":"start",fill:u(s),transform:"translate(".concat(_.g.x,",").concat(_.g.y,")rotate(-45)"),children:[e.jsx(dt,{stnName:t,onUpdate:m,onEnNameUpdate:l}),r&&e.jsx(xt,{stnName:r,onUpdate:d,passed:s===C.PASSED,transform:"translate(".concat(_.StationSecondaryName.x,",").concat(_.StationSecondaryName.y,")")}),o&&e.jsx(gt,{passed:s===C.PASSED,transform:"translate(".concat(_.ExpressTag.x,",").concat(_.ExpressTag.y,")")}),i&&e.jsx(ut,{passed:s===C.PASSED,temporary:i==="temp",transform:"translate(".concat(_.UnderConstructionTag.x,",").concat(_.UnderConstructionTag.y,")")})]})}function pt(n){var $,b,k,I,O,L,w,v,M;const{stnId:t,stnState:r,stnY:s}=n,{theme:a,line_name:o,line_num:i,spanLineNum:c,stn_list:m,loop:h,loop_info:{midpoint_station:l,clockwise:g}}=E(ne=>ne.param),d=m[t],u=l===t,[j,_]=x.useState({height:0}),N=x.useRef(null);x.useEffect(()=>{N.current&&_(N.current.getBBox())},[N.current,s,d.localisedName,d.localisedSecondaryName,d.services]);const S=d.parents.length===2||d.children.length===2,f=s>0||d.parents.indexOf(((b=($=d.branch)==null?void 0:$.left)==null?void 0:b[1])||"")===1||d.children.indexOf(((I=(k=d.branch)==null?void 0:k.right)==null?void 0:I[1])||"")===1?180:0,p=(w=(L=(O=d.localisedName.en)==null?void 0:O.split("\\"))==null?void 0:L.length)!=null?w:1,y=S?f===180?16+(p-1)*12*Math.cos(-45):-9:f===180?-6:(25+(p-1)*15)*Math.cos(-45),z=s>0?j.height+23:-j.height-23;return e.jsxs(e.Fragment,{children:[e.jsx(St,{intInfos:S?[{theme:[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:o},...(v=d.transfer.groups[0].lines)!=null?v:[]]:(M=d.transfer.groups[0].lines)!=null?M:[],stnState:h?C.FUTURE:r,tickRotation:f,spanDigits:c}),e.jsx(xe,{lineNum:i,stnNum:d.num,strokeColour:a[2],classNames:{digits:"rmg-name__zh"},passed:r===-1,alwaysShowColouredBorder:h,bolderBorder:!0,useSameScale:!0}),e.jsx("g",{ref:N,transform:"translate(".concat(-y,",0)"),children:e.jsx(ft,{primaryName:d.localisedName,secondaryName:d.localisedSecondaryName,stationState:r,flipped:f===180,express:d.services.includes(Ze.express),underConstruction:d.underConstruction})}),u&&e.jsx(mt,{transform:"translate(0,".concat(z,")"),clockwise:g,anchorAt:s>0?"text":"circle"})]})}const St=n=>e.jsxs(e.Fragment,{children:[e.jsx(jt,{strokeWidth:4,...n}),e.jsx(_t,{transform:"translate(0,".concat(n.tickRotation===180?-47:23,")"),...n})]}),jt=n=>{const{intInfos:t,stnState:r,tickRotation:s,spanDigits:a,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>{var m;return e.jsx("use",{xlinkHref:"#inttick",stroke:r===-1?"#aaa":(m=i.theme)==null?void 0:m[2],transform:"translate(".concat(-2*(t.length-1)+4*c,",0)rotate(").concat(s===180?180:0,")")},c)})})},_t=n=>{const{intInfos:t,tickRotation:r,stnState:s,spanDigits:a,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>{var m,h,l,g;return e.jsx("g",{transform:"translate(0,".concat(c*28*(r===180?-1:1),")"),children:e.jsx(de,{zhName:i.name[0],enName:i.name[1],foregroundColour:(h=(m=i.theme)==null?void 0:m[3])!=null?h:P.white,backgroundColour:(g=(l=i.theme)==null?void 0:l[2])!=null?g:"#aaaaaa",passed:s===-1,spanDigits:a,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})},c)})})};function Ce(n){const{xs:t,ys:r,stnStates:s}=n,{stn_list:a,loop:o}=E(m=>m.param),{branches:i}=E(m=>m.helper),c=o?i[0].slice(1,-1):Object.keys(a);return e.jsx("g",{id:"stn_icons",children:c.filter(m=>!["linestart","lineend"].includes(m)).map(m=>e.jsx("g",{style:{transform:"translate(".concat(t[m],"px,").concat(r[m],"px)")},children:e.jsx(pt,{stnId:m,stnState:s[m],stnY:r[m]})},m))})}const _e=(n,t)=>n[t].parents.length===2||n[t].children.length===2?.25:0,Nt=(n,t,r)=>{const s=T("linestart","lineend",t);if(s.nodes.includes(n))return T(s.nodes[1],n,t).len;{const a=r.filter(h=>h.includes(n))[0];let o=n;for(;!s.nodes.includes(o);)o=a[a.indexOf(o)-1];let i=n;for(;!s.nodes.includes(i);)i=a[a.indexOf(i)+1];const c=o==="linestart",m=i==="lineend";if(a.toString()===r[0].toString()){const h=[];return!c&&!m?(h[0]=T(s.nodes[1],o,t).len,h[1]=T(o,i,t).len,h[2]=T(o,n,t).len,h[3]=T(n,i,t).len):c?(h[0]=0,h[1]=T(s.nodes[1],i,t).len,h[2]=T(a[1],n,t).len,h[3]=T(n,i,t).len):(h[0]=T(s.nodes[1],o,t).len,h[1]=T(o,s.nodes.slice(-2)[0],t).len,h[2]=T(o,n,t).len,h[3]=T(n,a.slice(-2)[0],t).len),h[0]+h[2]*h[1]/(h[2]+h[3])}else if(!c&&!m){const h=[];return h[0]=T(s.nodes[1],o,t).len,h[1]=T(o,i,t).len,h[2]=T(o,n,t).len,h[3]=T(n,i,t).len,h[0]+h[2]*h[1]/(h[2]+h[3])}else return c?T(s.nodes[1],i,t).len-T(n,i,t).len:T(s.nodes[1],o,t).len+T(o,n,t).len}},yt=()=>{const{branches:n,routes:t,depsStr:r}=E(w=>w.helper),[s,a]=x.useState(45),{svgWidth:o,svg_height:i,y_pc:c,padding:m,branchSpacingPct:h,direction:l,line_name:g,spanLineNum:d,current_stn_idx:u,stn_list:j}=E(w=>w.param),_=x.useRef(null);x.useEffect(()=>{const w=setTimeout(()=>{_.current&&a(_.current.getBBox().width)},100);return()=>{clearTimeout(w)}},[_.current,g[0],g[1],d]);const N=Ge(j,_e,_e),S=x.useMemo(()=>(console.log("computing x shares"),Object.keys(j).reduce((w,v)=>({...w,[v]:Nt(v,N,n)}),{})),[n.toString(),JSON.stringify(N)]),f=T("linestart","lineend",N),p=T(f.nodes[1],f.nodes.slice(-2)[0],N),y=l===B.right?[o[A.RailMap]*m/100+65,o[A.RailMap]*(1-m/100)-20]:[o[A.RailMap]*m/100,o[A.RailMap]*(1-m/100)-65],z=Object.keys(S).reduce((w,v)=>({...w,[v]:y[0]+S[v]/p.len*(y[1]-y[0])}),{}),$=x.useMemo(()=>(console.log("computing y shares"),Object.keys(j).reduce((w,v)=>{if(n[0].includes(v))return{...w,[v]:0};{const M=n.slice(1).filter(ne=>ne.includes(v))[0];return{...w,[v]:j[M[0]].children.indexOf(M[1])?-2:2}}},{})),[r]),b=Object.keys($).reduce((w,v)=>({...w,[v]:-$[v]*h*i/200}),{}),k=x.useMemo(()=>Xe(u,t,l),[u,l,t.toString()]),I=n.map(w=>Ue(w,k)).reduce((w,v)=>(w.main.push(v.main),w.pass.push(v.pass),w),{main:[],pass:[]}),O=Object.keys(I).reduce((w,v)=>({...w,[v]:I[v].map(M=>$t(M,z,b))}),{}),L=s+20;return e.jsxs("g",{id:"main",style:{"--y-percentage":c,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx(zt,{paths:O}),e.jsx(Ce,{xs:z,ys:b,stnStates:k}),e.jsx("g",{className:"line_name",style:{"--translate-x":l===B.right?"".concat(y[0]-L,"px"):"".concat(y[1]+L,"px")},children:e.jsx(de,{ref:_,zhName:g[0],enName:g[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",spanDigits:d,classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}})})]})},zt=x.memo(function(t){return e.jsxs("g",{fill:"none",strokeWidth:4,children:[e.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((r,s)=>e.jsx("path",{d:r},s))}),e.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((r,s)=>e.jsx("path",{d:r},s))})]})},(n,t)=>JSON.stringify(n.paths)===JSON.stringify(t.paths)),$t=(n,t,r)=>{let s;const a=[];return n.forEach(o=>{const i=t[o],c=r[o];if(!s&&s!==0){s=c,a.push("M ".concat(i,",").concat(c));return}c===0?(c<s&&a.push("H ".concat(i-40),"a 40,40 0 0,0 40,-40","V ".concat(c)),c>s&&a.push("H ".concat(i-40),"a 40,40 0 0,1 40,40","V ".concat(c))):(c<s&&a.push("V ".concat(c+40),"a 40,40 0 0,1 40,-40","H ".concat(i)),c>s&&a.push("V ".concat(c-40),"a 40,40 0 0,0 40,40","H ".concat(i))),a.push("H ".concat(i)),s=c}),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},We=150;function te(n){return e.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H".concat(We," V10 H40 L90,60z"),fill:"black",...n})}function wt(n){const{destIds:t,textAnchor:r,...s}=n,a=E(h=>h.param.direction),o=E(h=>h.param.stn_list),i=t.map(h=>{var l,g;return(g=(l=o[h].localisedName.zh)==null?void 0:l.length)!=null?g:0}),c=Math.min(...i),m=c>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(c-1):0;return e.jsxs("g",{textAnchor:r,...s,children:[t.map((h,l)=>{var u;const g=i[l]>i[1-l],d=!Ve()&&r==="end"&&!g;return e.jsxs(x.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,x:a===B.left?0:-75,y:-21+42*l,letterSpacing:g?"0em":"".concat(m,"em"),dx:d?"".concat(m,"em"):"0em",children:o[h].localisedName.zh}),e.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:a===B.left?0:-75,y:-1+42*l,children:"Towards "+((u=o[h].localisedName.en)==null?void 0:u.replace("\\"," "))})]},h)}),e.jsx("text",{className:"rmg-name__zh",fontSize:28,x:a===B.left?25*(Math.max(...i)+1):0,y:5,children:"方向"})]})}const Bt=(n,t,r,s)=>{const i=n*(1-2*t/100)*(r-1)/r-s,c=n-i;return[c/2,n-c/2]},Et=(n,t,r)=>{const s=Math.min(...Object.values(n)),a=Math.max(...Object.values(n)),o=Math.min(...Object.values(t)),c=Math.max(...Object.values(t))-o,m=c/2;return"M".concat(a,",").concat(o," H").concat(s," h-").concat(r/2," a").concat(m,",").concat(m," 0 0,0 0,").concat(c," H").concat(a," h").concat(r/2," a").concat(m,",").concat(m," 0 0,0 0,-").concat(c,"Z")},vt=(n,t,r,s)=>{const a=n.indexOf(r),o=n.indexOf(s!=null?s:r);let i;return o<0?i=n:t?i=a<=o?[...n.slice(0,a+1),...n.slice(o)]:n.slice(o,a+1):i=a<o?n.slice(a,o+1):[...n.slice(a),...n.slice(0,o+1)],n.reduce((c,m,h)=>a===h?{...c,[m]:C.CURRENT}:i.includes(m)?{...c,[m]:C.FUTURE}:{...c,[m]:C.PASSED},{})},Ne=6;function Rt({currentStationX:n,currentStationY:t,stationGap:r,loopClockwise:s}){const a=t>0?s?-1:1:s?1:-1,o=(r/3-Ne)*a,i=n+o+Ne*a,c=(t-12)*-a;return e.jsx("g",{transform:"scale(1,".concat(-a,")"),children:e.jsx("path",{d:"M".concat(i,",").concat(c," h").concat(o),strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function ye({clockwise:n,...t}){return e.jsx("g",{...t,children:e.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:16,children:n?"内环":"外环"}),e.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:n?"Inner Circle":"Outer Circle"})]})})}const De=2/3,Tt=2-De,bt=25*Math.PI/180,kt=Math.asin(Math.sin(35*Math.PI/180)/2);function At({cxLeft:n,cxRight:t,yGap:r,clockwise:s}){const a=r/2,o=a*(s?De:Tt),i=s?bt:kt,c=o*Math.cos(i),m=s?1:-1,h=s?1:0,l=o*Math.sin(i)*m,g=2*l,d={rotate:s?"-4deg":"2deg"};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(".concat(n,",0)"),children:[e.jsx("path",{d:"M".concat(-c,",").concat(l," a").concat(o,",").concat(o," 0 0,").concat(h," 0,").concat(-g),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:d}),e.jsx(ye,{transform:"translate(".concat(s?0:-2*a,",0)"),clockwise:s})]}),e.jsxs("g",{transform:"translate(".concat(t,",0)"),children:[e.jsx("path",{d:"M".concat(c,",").concat(-l," a").concat(o,",").concat(o," 0 0,").concat(h," 0,").concat(g),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:d}),e.jsx(ye,{transform:"translate(".concat(s?0:2*a,",0)"),clockwise:s})]})]})}function It(){const{branches:n}=E(p=>p.helper),{svgWidth:t,svg_height:r,y_pc:s,padding:a,branchSpacingPct:o,current_stn_idx:i,loop_info:{midpoint_station:c,clockwise:m}}=E(p=>p.param),h=n[0].slice(1,-1),l=Math.ceil(h.length/2),g=x.useMemo(()=>(console.log("computing x shares"),h.reduce((p,y,z,$)=>{let b;return z<l?b=l-z-1:(b=z-l,$.length&1&&(b+=.5)),{...p,[y]:b}},{})),[h.toString()]),d=o*r*2/100,u=Bt(t[A.RailMap],a,l,d),j=(u[1]-u[0])/(l-1),_=Object.keys(g).reduce((p,y)=>({...p,[y]:u[0]+g[y]*j}),{}),N=x.useMemo(()=>(console.log("computing y shares"),h.reduce((p,y,z)=>({...p,[y]:z<l?1:-1}),{})),[h.toString()]),S=Object.keys(N).reduce((p,y)=>({...p,[y]:-N[y]*d/2}),{}),f=vt(h,m!=null?m:!1,i,c);return e.jsxs("g",{id:"main",style:{"--y-percentage":s,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx("path",{d:Et(_,S,j),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),e.jsx(Ce,{xs:_,ys:S,stnStates:f}),e.jsx(Rt,{currentStationX:_[i],currentStationY:S[i],stationGap:j,loopClockwise:m}),e.jsx(At,{cxLeft:u[0]-j/2,cxRight:u[1]+j/2,yGap:d,clockwise:m})]})}const ze=A.RailMap,Mt=()=>{const{canvasScale:n}=E(u=>u.app),{svgWidth:t,svg_height:r,direction:s,psd_num:a,info_panel_type:o,notesGZMTR:i,current_stn_idx:c,stn_list:m,theme:h,loop:l}=E(u=>u.param),g=t[ze],d=m[c];return e.jsxs(Ee,{type:ze,svgWidth:g,svgHeight:r,canvasScale:n,theme:h,children:[e.jsx(Ct,{}),e.jsx(ve,{variant:o,isShowLight:o===R.gz2otis,isShowPSD:o===R.gz2otis&&a}),!l&&(s===B.left&&d.parents.includes("linestart")||s===B.right&&d.children.includes("lineend"))?e.jsx(Ot,{}):e.jsxs(e.Fragment,{children:[l?e.jsx(It,{}):e.jsx(yt,{}),!l&&e.jsx(Wt,{}),i==null?void 0:i.map((u,j)=>e.jsx(Lt,{note:u},j))]}),o===R.gz2otis&&e.jsx("line",{x2:g,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},Ct=x.memo(function(){return e.jsxs("defs",{children:[e.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),e.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:e.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),Wt=()=>{const{routes:n}=E(c=>c.helper),{direction:t,direction_gz_x:r,direction_gz_y:s,current_stn_idx:a}=E(c=>c.param),o=x.useMemo(()=>[...new Set(n.reduce((c,m)=>m.includes(a)?c.concat(m.filter(h=>!["linestart","lineend"].includes(h)).slice(t===B.left?0:-1)[0]):c,[]).filter(c=>c!==a))],[a,t,n.toString()]),i={textAnchor:t===B.left?"start":"end",transform:"translate(".concat(t===B.left?65:-65,",-5)"),destIds:o};return e.jsxs("g",{id:"direction_gz",style:{"--x-percentage":r,"--y-percentage":s},children:[e.jsx(te,{transform:"scale(0.35)rotate(".concat(t===B.left?0:180,")")}),o.length!==2?e.jsx(Dt,{...i}):e.jsx(wt,{...i})]})},Dt=n=>{const{destIds:t,...r}=n,s=E(a=>a.param.stn_list);return e.jsxs("g",{...r,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(a=>s[a].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(a=>{var o;return(o=s[a].localisedName.en)==null?void 0:o.replace("\\"," ")}).join("/")})]})},Ot=x.memo(function(){return e.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),e.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),e.jsxs("g",{strokeWidth:8,stroke:"#000",children:[e.jsx("path",{d:"M -160,68 h -160"}),e.jsx("path",{d:"M 160,68 h 160"})]})]})}),Lt=x.memo(function(t){const r=x.useRef(null),[s,a]=x.useState({width:0,height:0,y:0});return x.useEffect(()=>{r.current&&a(r.current.getBBox())},[t.note[0],t.note[1]]),e.jsxs("g",{className:"note-box",style:{"--x-percentage":t.note[2],"--y-percentage":t.note[3]},children:[t.note[4]&&e.jsx("rect",{height:s.height+4,width:s.width+4,x:-2,y:s.y-2,fill:"none",stroke:"black",strokeWidth:.5}),e.jsxs("g",{ref:r,children:[e.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((o,i)=>e.jsx("text",{className:"rmg-name__zh",y:i*18,children:o},i))}),e.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((o,i)=>{var c;return e.jsx("text",{className:"rmg-name__en",y:i*11,textLength:i<(((c=t.note[1].match(/\n/g))==null?void 0:c.length)||0)?s.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:o},i)})})]})]})},(n,t)=>n.note.toString()===t.note.toString()),ae=92,Ht=(n,t)=>{switch(t){case 2:return n==="gz11"?.2:.5;case 3:return .1;default:return 0}},Ft=x.memo(function(t){var c,m,h;const{stnName:r,panelType:s,onUpdate:a}=t,o=x.useRef(null),i=Ht(s,(c=r.zh)==null?void 0:c.length);return x.useEffect(()=>{if(o.current&&a){const l=o.current.getBBox();a({...l,x:l.x+i*ae/2,width:l.width-i*ae})}},[o.current,JSON.stringify(r),s]),e.jsxs("g",{ref:o,fontWeight:s==="gz11"?"bold":"normal",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ae,x:i/2+"em",letterSpacing:i+"em",children:r.zh}),e.jsx("g",{fontSize:40,children:(h=(m=r.en)==null?void 0:m.split("\\"))==null?void 0:h.map((l,g)=>e.jsx("text",{className:"rmg-name__en",dy:72+g*42,children:l},g))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName)&&n.panelType===t.panelType),Pt=n=>{const{secondaryName:t,transform:r}=n,s=x.useRef(null),[a,o]=x.useState({x:0,width:0});return x.useEffect(()=>{s.current&&o(s.current.getBBox())},[t.toString()]),e.jsxs("g",{transform:r,children:[e.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[e.jsx("text",{textAnchor:"end",x:a.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:a.width+a.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:s,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),e.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},K=55,Oe=18.5*1.4,Le=30,Zt=Le*4,He=.82,Fe=.25,$e=.4,Pe=(n,t,r)=>{const{stn_list:s,current_stn_idx:a,direction:o,loop:i,loop_info:{midpoint_station:c,clockwise:m}}=n;return i?Xt(t[0].slice(1,-1),s,a,c,m):Gt(r,s,a,o)},Gt=(n,t,r,s)=>{const a=s==="l"?"parents":"children",o=t[r][a].map(c=>t[c].underConstruction?t[c][a]:c).flat(),i=n.find(c=>c.includes(r)&&c.includes(o[0]));if(i){const c=i.indexOf(r),h=(s==="l"?i.slice(0,c).toReversed():i.slice(c+1)).filter(l=>!["linestart","lineend"].includes(l)).reduce((l,g)=>{var d;return(d=t[g].transfer.groups[0].lines)!=null&&d.length?[...l,g]:l},[]).slice(0,3);return{nextStations:o,viaStations:h}}else return{nextStations:o,viaStations:[]}},Xt=(n,t,r,s,a)=>{const o=n.filter(d=>!t[d].underConstruction),i=a?o.toReversed():o,c=i.indexOf(r),m=[...i,...i].slice(c+1),h=[m[0]],l=m.slice(1).reduce((d,u)=>{var j;return(j=t[u].transfer.groups[0].lines)!=null&&j.length?[...d,u]:t[u].loop_pivot?[...d,u]:d},[]),g=s?[...l.slice(0,2),s]:l.slice(0,3);return{nextStations:h,viaStations:g}},Ut=x.forwardRef(function({stationInfo:t,...r},s){var h,l;const{localisedName:a,transfer:{groups:[{lines:o}]}}=t,[i,c]=x.useState({width:0}),m=x.useRef(null);return x.useEffect(()=>{m.current&&c(m.current.getBBox())},[m.current,JSON.stringify(a)]),e.jsxs("g",{ref:s,...r,children:[e.jsxs("g",{ref:m,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:a.zh}),(l=(h=a.en)==null?void 0:h.split("\\"))==null?void 0:l.map((g,d)=>e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*d,children:g},d))]}),e.jsx("g",{transform:"translate(".concat(i.width+2,",7)"),children:(o==null?void 0:o.length)&&e.jsxs(e.Fragment,{children:[e.jsx("g",{transform:"translate(0,-".concat(3.5*(o.length-1)/2,")"),children:o.map(({theme:g},d)=>{var u;return e.jsx("path",{d:"M0,".concat(3.5*d," H8"),stroke:(u=g==null?void 0:g[2])!=null?u:"#aaa",strokeWidth:3.5},"tick-".concat(d))})}),o.map((g,d)=>{var u,j,_,N;return e.jsx(de,{zhName:g.name[0],enName:g.name[1],backgroundColour:(j=(u=g.theme)==null?void 0:u[2])!=null?j:"#aaa",foregroundColour:(N=(_=g.theme)==null?void 0:_[3])!=null?N:P.white,spanDigits:!0,transform:"translate(".concat(27+36*d,",-8.5)scale(0.75)"),classNames:{digits:"rmg-font__en",zh:"rmg-font__zh",en:"rmg-font__en"}},"line-icon-".concat(d))})]})})]})});function Vt({viaStations:n,stationList:t}){const r=x.useRef([]),[s,a]=x.useState([]);x.useEffect(()=>{a(r.current.map(i=>{var c,m;return(m=(c=i==null?void 0:i.getBBox())==null?void 0:c.height)!=null?m:0}))},[n,r.current]);const o=x.useCallback(i=>s.slice(0,i).reduce((c,m)=>c+m+4,0),[s]);return e.jsx(e.Fragment,{children:n.map((i,c)=>e.jsx(Ut,{ref:m=>r.current[c]=m,stationInfo:t[i],transform:"translate(0,".concat(o(c),")")},i))})}const oe=44,ie=25;function Yt({nameBBox:n}){const t=E(p=>p.param),{svg_height:r,svgWidth:s,direction:a,current_stn_idx:o,stn_list:i}=t,{branches:c,routes:m}=E(p=>p.helper),h=s[A.RunIn],{nextStations:[l],viaStations:g}=Pe(t,c,m),{localisedName:{en:d=""},localisedSecondaryName:u}=i[o],{localisedName:{zh:j="",en:_=""}}=i[l],N=_.split("\\").length,S=(h-n.width)/2,f={next:{x:80},nextName:{x:80+oe*1.7},via:{dy:75+25*(N-1)},arrow:{x:a===B.left?(115+50*(.5+j.length)+S)/2-20:((h+n.width)/2+(h*He-Zt/2))/2+We*$e/2,y:.5*r-(d.split("\\").length-2)*18-(u?58/2:0),rotate:a===B.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(0,".concat(r/2+5-f.via.dy,")"),children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(f.next.x,",0)"),children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:oe,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ie,dy:40,children:"Next"})]}),e.jsxs("g",{transform:"translate(0,".concat(f.via.dy,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),e.jsxs("g",{textAnchor:"start",transform:"translate(".concat(f.nextName.x,",0)"),children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:oe,children:j}),e.jsx("g",{fontSize:ie,children:_.split("\\").map((p,y)=>e.jsx("text",{className:"rmg-name__en",dy:40+y*ie,children:p},y))})]}),g&&e.jsx("g",{transform:"translate(0,".concat(f.via.dy,")"),children:e.jsx(Vt,{viaStations:g,stationList:i})})]})]}),e.jsx(te,{transform:"translate(".concat(f.arrow.x,",").concat(f.arrow.y,")scale(").concat($e,")rotate(").concat(f.arrow.rotate,")")})]})}function Jt({secName:n,...t}){const{zh:r,en:s}=n,a=x.useRef(null),[o,i]=x.useState({x:0,width:0});return x.useEffect(()=>{a.current&&i(a.current.getBBox())},[r,s]),e.jsxs("g",{...t,children:[e.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[e.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:a,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:r}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:s})]})]})}const Y=35,ce=17;function qt({nextId:n,nameBBox:t,ignoreNumWidth:r}){const{svgWidth:s,svg_height:a,direction:o}=E(f=>f.param),i=E(f=>f.param.stn_list[n]),{localisedName:c,localisedSecondaryName:m}=i,{zh:h="",en:l=""}=c,g=s[A.RunIn],[d,u]=x.useState({width:0}),j=x.useRef(null);x.useEffect(()=>{j.current&&u(j.current.getBBox())},[h,l]);const _=h.length,N=(g-t.width)/2,S={next:{x:o===B.left?80:g-45-d.width-Y*(_<=2?2:1.5)},nextName:{x:o===B.left?80+Y*(_<=2?2:1.5):g-45-d.width},arrow:{x:o===B.left?(115+35*((_<=2?1:.5)+_)+N)/2-20:(g-45-d.width-(_<=2?105:35*2.5)+N+t.width+(r?0:K+Oe))/2+20,y:a/2-30,rotate:o===B.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(0,".concat(a/2-40,")"),children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(S.next.x,",0)"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:Y,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ce,dy:30,children:"Next"})]}),e.jsxs("g",{textAnchor:"start",ref:j,transform:"translate(".concat(S.nextName.x,",0)"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:Y,children:h}),e.jsx("g",{fontSize:ce,children:l.split("\\").map((f,p)=>e.jsx("text",{className:"rmg-name__en",dy:30+p*ce,children:f},p))})]}),m&&e.jsx("g",{textAnchor:"middle",transform:"translate(".concat(S.nextName.x,",0)"),children:e.jsx(Jt,{secName:m,transform:"translate(".concat(d.width/2,",").concat(30+l.split("\\").length*17+5,")")})})]}),e.jsx(te,{transform:"translate(".concat(S.arrow.x,",").concat(S.arrow.y,")scale(").concat(Fe,")rotate(").concat(S.arrow.rotate,")")})]})}const Kt=()=>{var $,b,k;const n=E(I=>I.param),{svg_height:t,svgWidth:r,theme:s,direction:a,info_panel_type:o,line_num:i,current_stn_idx:c,stn_list:m}=n,{branches:h,routes:l}=E(I=>I.helper),g=m[c],{localisedName:d,localisedSecondaryName:u}=g,[j,_]=x.useState({width:0}),N=(k=(b=($=d.en)==null?void 0:$.split("\\"))==null?void 0:b.length)!=null?k:1,{nextStations:S}=Pe(n,h,l),f=[R.gz7w,R.gz11].includes(o),p={name:"translate(".concat((a===B.left?1:-1)*r[A.RunIn]/4,",45)"),next:"translate(".concat((a===B.left?1:-1)*r[A.RunIn]/10,",45)")},y=(r[A.RunIn]+j.width)/2+K,z={nameGroup:{x:r.runin/2,y:.5*t-50-(N-1)*18-(u?29:0)},secondaryName:{x:0,y:70+N*36},stationNumber:{x:y,y:.5*t-30-(N-1)*18-(u?58/2:0)},stationNumberPost2022:{x:a===B.left?y:(r[A.RunIn]-j.width)/2-K,y:.5*t-(N-2)*18-(u?58/2:0)}};return e.jsxs("g",{children:[e.jsxs("g",{transform:o===R.gz2otis?p.name:"",children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(z.nameGroup.x,",").concat(z.nameGroup.y,")"),children:[e.jsx(Ft,{stnName:d,panelType:o,onUpdate:_}),u&&e.jsx(Pt,{secondaryName:u,transform:"translate(".concat(z.secondaryName.x,",").concat(z.secondaryName.y,")")})]}),e.jsx(xe,{lineNum:i,stnNum:g.num,strokeColour:s[2],classNames:{digits:"rmg-font__en"},transform:f?"translate(".concat(z.stationNumberPost2022.x,",").concat(z.stationNumberPost2022.y,")"):"translate(".concat(z.stationNumber.x,",").concat(z.stationNumber.y,")"),size:"lg"})]}),o===R.gz11?e.jsx(Yt,{nameBBox:j}):e.jsx("g",{transform:o===R.gz2otis?p.next:"",children:!S||S.includes("linestart")||S.includes("lineend")?e.jsx(e.Fragment,{}):S.length===1?e.jsx(qt,{nextId:S[0],nameBBox:j,ignoreNumWidth:f}):e.jsx(Qt,{nextIds:S,nameBBox:j,ignoreNumWidth:f})})]})},we=27,le=13,Be=110,Qt=n=>{const{nextIds:t,nameBBox:r,ignoreNumWidth:s}=n,{routes:a}=E(f=>f.helper),{svgWidth:o,svg_height:i,direction:c,stn_list:m}=E(f=>f.param),h=o[A.RunIn],l=t.map(f=>m[f].localisedName),[g,d]=x.useState({width:0}),u=x.useRef([]);x.useEffect(()=>{d(f=>({...f,width:0})),u.current.forEach(f=>{const p=f==null?void 0:f.getBBox();d(y=>p?y.width>p.width?y:p:y)})},[l.toString()]);const j=n.nextIds.map(f=>a.reduce((p,y)=>y.includes(f)?p.concat(y.filter(z=>!["linestart","lineend"].includes(z)).slice(c===B.left?0:-1)[0]):p,[])),_=Math.max(...l.map(f=>{var p,y;return(y=(p=f.zh)==null?void 0:p.length)!=null?y:0})),N=(h-r.width)/2,S={next:{x:c===B.left?72:h-45-g.width-41},nextName:{x:c===B.left?113:h-45-g.width},arrow:{x:c===B.left?(99+27*(1+_)+N)/2-20:(h-45-g.width-41-27+N+n.nameBBox.width+(s?0:K+Oe))/2+20,y:i/2-30,rotate:c===B.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsx("g",{transform:"translate(0,".concat(i/2-70,")"),children:l.map((f,p)=>{var y,z;return e.jsxs(x.Fragment,{children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(S.next.x,",").concat(Be*p,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:we,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:le,y:22,children:"Next"})]}),e.jsxs("g",{ref:$=>u.current[p]=$,textAnchor:"start",transform:"translate(".concat(S.nextName.x,",").concat(Be*p,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:we,children:f.zh}),(z=(y=f.en)==null?void 0:y.split("\\"))==null?void 0:z.map(($,b)=>e.jsx("text",{className:"rmg-name__en",fontSize:le,y:22+b*le,children:$},b)),e.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:j[p].map($=>m[$].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+j[p].map($=>m[$].localisedName.en).join("/").replace("\\"," ")})]})]},p)})}),e.jsx(te,{transform:"translate(".concat(S.arrow.x,",").concat(S.arrow.y,")scale(").concat(Fe,")rotate(").concat(S.arrow.rotate,")")})]})};function en(n){const{num:t,...r}=n;return e.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...r,children:[e.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),e.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function tn(n){const{canvasType:t}=n,{svgWidth:r,svg_height:s}=E(a=>a.param);return e.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[e.jsx("line",{y2:s,transform:"translate(".concat(r[t]/2,",0)")}),e.jsx("line",{x2:r[t],transform:"translate(0,90)"})]})}const D=Le;function nn({coachNumber:n,...t}){return e.jsxs("g",{...t,children:[e.jsx("path",{d:"M-".concat(D,",-").concat(D," a").concat(D,",").concat(D," 0 0,0 0,").concat(2*D," h").concat(2*D," a").concat(D,",").concat(D,", 0 0,0 0,-").concat(2*D,"Z"),fill:"whitesmoke",stroke:"lightgrey"}),e.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),e.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:e.jsx("text",{className:"rmg-name__zh",fontSize:36,children:n})})]})}const he=A.RunIn;function sn(){const{canvasScale:n}=E(u=>u.app),{svgWidth:t,svg_height:r,direction:s,info_panel_type:a,platform_num:o,psd_num:i,coachNum:c,theme:m}=E(u=>u.param),h=t[he],l=[R.gz7w,R.gz11].includes(a),g=l?r-78:r/2-30,d={platform:"translate(".concat(s===B.left?50:-50,",45)")};return e.jsxs(Ee,{type:he,svgWidth:h,svgHeight:r,canvasScale:n,theme:m,children:[e.jsx(ve,{variant:a,isShowLight:a!==R.gz2otis,isShowPSD:a!==R.gz2otis&&i}),e.jsx("g",{transform:a===R.gz2otis?d.platform:"",children:e.jsx(en,{num:o,style:{"--translate-x":"".concat(s===B.left||a===R.gz11?h-100:100,"px"),"--translate-y":g+"px","--scale":l?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),l&&e.jsx(nn,{coachNumber:c,transform:"translate(".concat(h*He,",").concat(r*.58,")")}),e.jsx(Kt,{}),a===R.gz2otis&&e.jsx(tn,{canvasType:he})]})}const mn={runin:e.jsx(sn,{}),railmap:e.jsx(Mt,{})};export{mn as default};
