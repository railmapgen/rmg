import{j as s}from"./chakra-CXrhlirJ.js";import{a as d}from"./react-Caefwd5V.js";import{h as D,aZ as E,u as z,m as Ue,S as w,aS as $,P}from"./index--KTv9PqL.js";import{a as Ye,c as B,b as Je,d as Ve}from"./share-BS6mU4tJ.js";import{S as Ie}from"./svg-wrapper-DO1Iqw6o.js";import{i as qe}from"./param-selector-DlvT_aAj.js";function Ke(e){const{num:t,inStrip:a,...n}=e;return s.jsxs("g",{textAnchor:"middle",fill:a?D.black:"var(--rmg-theme-fg)",...n,children:[s.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:a?"#fff":"var(--rmg-theme-colour)"}),s.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),s.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),s.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})}const Re=e=>{const t=(r=>{switch(r){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 20;default:return 0}})(e.variant),a=d.useMemo(()=>{switch(e.variant){case"gz1":return s.jsx("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return s.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return s.jsx("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return s.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return s.jsx("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return s.jsx("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return s.jsx("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return s.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz7w":case"gz11":return s.jsx("ellipse",{cy:-40,rx:28,ry:14,fill:"orange"});default:return s.jsx(s.Fragment,{})}},[e.variant]);return s.jsxs("g",{transform:"translate(0,".concat(e.variant==="gz4"?-20:0,")"),children:[s.jsx("rect",{id:"strip_gz",style:{"--height":"".concat(t,"px")}}),s.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:e.isShowLight&&a}),e.isShowPSD!==!1&&s.jsx(Qe,{...e})]})},Qe=d.memo(function(t){const a=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),n=(o=>{switch(o){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";case"gz7w":case"gz11":return"70px";default:return"58px"}})(t.variant),r=(o=>{switch(o){case"gz7w":case"gz11":return 1.1;default:return 1}})(t.variant);return s.jsx(Ke,{num:t.isShowPSD,inStrip:a,style:{"--psd-dy":n,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":r}})},(e,t)=>e.variant===t.variant&&e.isShowPSD===t.isShowPSD);var A=1.3,Ae=1.7,J=18.5,et=J+A,X=J*2+A;var Z=45,I=Z-3,Te=function(e,t){var a=[e,t].map(function(n){return n.match(/^(\w+).+$/)});if(a[0]&&a[1]&&a[0][1]===a[1][1])return a[0][1]},he=function(e){var t=e.match(/^(\d+)\D+$/);return t==null?void 0:t[1]},ee=function(){return ee=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ee.apply(this,arguments)},tt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};function V(e){var t=e.customWidth,a=tt(e,["customWidth"]),n=(t!=null?t:Z)-Z;return s.jsx("rect",ee({x:-22.5-n/2,height:24,width:t!=null?t:Z,rx:4.5},a,{"data-testid":"intBox"}))}var te=function(){return te=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},te.apply(this,arguments)},nt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},rt=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,o=[],i;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return o},at=function(e,t){var a=he(e);if(a)return{isDigit:!0,spanningPart:a};var n=Te(e,t);return n?{isDigit:!1,spanningPart:n}:{isDigit:!1,spanningPart:""}};function ve(e){var t=e.zhName,a=e.enName,n=e.foregroundColour,r=e.backgroundColour,o=e.zhClassName,i=e.enClassName,c=e.passed,u=e.children,l=nt(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),h=at(t,a),f=h.isDigit,m=h.spanningPart,g=d.useRef(null),_=rt(d.useState({x:0,height:0,width:0}),2),x=_[0],p=_[1];d.useEffect(function(){g.current&&p(g.current.getBBox())},[t,a]);var v=I/Math.max(I,x.width),N=(-x.x-x.width/2)*v,y=x.height*(1-v)/2;return s.jsxs("g",te({textAnchor:"middle",fill:c?D.white:n},l,{children:[s.jsx(V,{fill:c?"#aaa":r}),s.jsx("g",{ref:g,transform:"translate(".concat(N,",").concat(y,")scale(").concat(v,")"),children:s.jsxs("text",{className:o,fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",children:[m,s.jsx("tspan",{className:o,fontSize:10,x:0,dy:-4,textAnchor:"start",dominantBaseline:"central",children:t.slice(m.length).trim()}),s.jsx("tspan",{className:i,fontSize:6.5,letterSpacing:-.1,x:0,dy:10,textAnchor:"start",dominantBaseline:"middle",children:f?a:a.slice(m.length).trim()})]})}),u]}))}var ne=function(){return ne=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ne.apply(this,arguments)},st=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},_e=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,o=[],i;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return o};function ot(e){var t,a=e.zhName,n=e.enName,r=e.foregroundColour,o=e.backgroundColour,i=e.zhClassName,c=e.enClassName,u=e.passed,l=e.children,h=st(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),f=(t=he(a))!==null&&t!==void 0?t:"",m=d.useRef(null),g=d.useRef(null),_=_e(d.useState({width:0}),2),x=_[0],p=_[1],v=_e(d.useState({width:0}),2),N=v[0],y=v[1];d.useEffect(function(){m.current&&p(m.current.getBBox()),g.current&&y(g.current.getBBox())},[a,n]);var j=I/Math.max(I,x.width),S=I/Math.max(I,N.width),C={nameZh:{y:7.3+13.5*(1-j)*j/2},nameEn:{y:19.5-9*(1-S)*S/2}};return s.jsxs("g",ne({textAnchor:"middle",fill:u?D.white:r},h,{children:[s.jsx(V,{fill:u?"#aaa":o}),s.jsxs("text",{ref:m,className:i,fontSize:12,transform:"translate(0,".concat(C.nameZh.y,")scale(").concat(j,")"),dominantBaseline:"central",children:[s.jsx("tspan",{fontSize:16,dy:.7,dominantBaseline:"central",children:f}),s.jsx("tspan",{dy:-.7,dominantBaseline:"central",children:a.slice(f.length)})]}),s.jsx("text",{ref:g,className:c,fontSize:8,transform:"translate(0,".concat(C.nameEn.y,")scale(").concat(S,")"),dominantBaseline:"middle",children:n}),l]}))}var re=function(){return re=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},re.apply(this,arguments)},it=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},ct=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,o=[],i;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return o};function lt(e){var t=e.zhName,a=e.enName,n=e.foregroundColour,r=e.backgroundColour,o=e.zhClassName,i=e.enClassName,c=e.passed,u=e.children,l=it(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),h=d.useRef(null),f=ct(d.useState({width:0}),2),m=f[0],g=f[1];d.useEffect(function(){h.current&&g(h.current.getBBox())},[t,a]);var _=Math.max(45,m.width+4);return s.jsxs("g",re({textAnchor:"middle",fill:c?D.white:n},l,{children:[s.jsx(V,{customWidth:_,fill:c?"#aaa":r}),s.jsxs("g",{ref:h,children:[s.jsx("text",{className:o,fontSize:8.5,y:8,dominantBaseline:"central",children:t}),s.jsx("text",{className:i,fontSize:5.5,y:18,dominantBaseline:"middle",children:a})]}),u]}))}var ae=function(){return ae=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ae.apply(this,arguments)},ut=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},je=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,o=[],i;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return o};function dt(e){var t=e.zhName,a=e.enName,n=e.foregroundColour,r=e.backgroundColour,o=e.zhClassName,i=e.enClassName,c=e.passed,u=e.children,l=ut(e,["zhName","enName","foregroundColour","backgroundColour","zhClassName","enClassName","passed","children"]),h=d.useRef(null),f=d.useRef(null),m=je(d.useState({width:0}),2),g=m[0],_=m[1],x=je(d.useState({width:0}),2),p=x[0],v=x[1];d.useEffect(function(){h.current&&_(h.current.getBBox()),f.current&&v(f.current.getBBox())},[t,a]);var N=I/Math.max(I,g.width),y=I/Math.max(I,p.width),j={nameZh:{y:7.3+13.5*(1-N)*N/2},nameEn:{y:19.5-9*(1-y)*y/2}};return s.jsxs("g",ae({textAnchor:"middle",fill:c?D.white:n},l,{children:[s.jsx(V,{fill:c?"#aaa":r}),s.jsx("text",{ref:h,className:o,fontSize:12,transform:"translate(0,".concat(j.nameZh.y,")scale(").concat(N,")"),dominantBaseline:"central",children:t}),s.jsx("text",{ref:f,className:i,fontSize:8,transform:"translate(0,".concat(j.nameEn.y,")scale(").concat(y,")"),dominantBaseline:"middle",children:a}),u]}))}var M=function(){return M=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},M.apply(this,arguments)};const Me=d.memo(function(t){var a=t.zhName,n=t.enName,r=t.spanDigits,o=mt(a,n);switch(o){case 1:return r?s.jsx(ve,M({},t)):s.jsx(ot,M({},t));case 2:return s.jsx(ve,M({},t));default:return a.length>=5?s.jsx(lt,M({},t)):s.jsx(dt,M({},t))}});var mt=function(e,t){var a=he(e);if(a!==void 0)return 1;var n=Te(e,t);return n!==void 0?2:3},se=function(){return se=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},se.apply(this,arguments)},ht=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},L=5,H=5.625,Ne=J-L,Se=J-2*H;const We=d.memo(function(t){var a=t.stroke,n=t.filled,r=t.bolder,o=ht(t,["stroke","filled","bolder"]),i="M0,9.25 V-9.25 H-".concat(Ne," l-").concat(L,",").concat(H," v").concat(Se," l").concat(L,",").concat(H," H").concat(Ne," l").concat(L,",-").concat(H," v-").concat(Se," l-").concat(L,",-").concat(H," H0");return s.jsx("path",se({d:i,fill:n?a:"#fff",strokeWidth:r?Ae:A,stroke:a},o))});var oe=function(){return oe=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},oe.apply(this,arguments)},ft=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};const De=d.memo(function(t){var a=t.stroke,n=t.filled,r=t.bolder,o=ft(t,["stroke","filled","bolder"]),i="M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0";return s.jsx("path",oe({d:i,fill:n?a:"#fff",strokeWidth:r?Ae:A,stroke:a},o))});var gt={updateId:0,update:function(){}},xt=d.createContext(gt),ie=function(){return ie=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ie.apply(this,arguments)},yt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},be=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,o=[],i;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return o},F=17,Le=d.forwardRef(function(t,a){var n=t.Icon,r=t.lineNum,o=t.stnNum,i=t.strokeColour,c=t.passed,u=t.size,l=t.textClassName,h=t.bolderBorder,f=t.alwaysShowColouredBorder,m=t.useSameScale,g=t.children,_=yt(t,["Icon","lineNum","stnNum","strokeColour","passed","size","textClassName","bolderBorder","alwaysShowColouredBorder","useSameScale","children"]),x=d.useContext(xt).updateId,p=d.useRef(null),v=d.useRef(null),N=be(d.useState({width:0}),2),y=N[0],j=N[1],S=be(d.useState({width:0}),2),C=S[0],k=S[1];d.useEffect(function(){p.current&&j(p.current.getBBox()),v.current&&k(v.current.getBBox())},[r,o,x]);var b=r&&r.length>2;d.useEffect(function(){m&&b&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[m,b]);var O=F/Math.max(F,y.width),R=m&&(r==null?void 0:r.length)===2?O:F/Math.max(F,C.width),W=u==="sm"?"0.7":u==="lg"?"1.4":1;return s.jsxs("g",ie({ref:a},_,{children:[s.jsxs("g",{transform:"scale(".concat(W,")"),children:[s.jsx(n,{stroke:c&&!f?"#aaa":i,filled:!r&&!o,bolder:h}),(r||o)&&s.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:c?"#aaa":"#000",children:[s.jsx("g",{transform:"translate(-9.25,0)scale(".concat(O,")"),children:s.jsx("text",{ref:p,className:l,dominantBaseline:"central",x:.5,children:r})}),s.jsx("g",{transform:"translate(9.25,0)scale(".concat(R,")"),children:s.jsx("text",{ref:v,className:l,dominantBaseline:"central",children:o})})]})]}),g]}))}),ce=function(){return ce=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ce.apply(this,arguments)},pt=d.forwardRef(function(t,a){return s.jsx(Le,ce({Icon:We},t,{ref:a}))}),le=function(){return le=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},le.apply(this,arguments)},fe=d.forwardRef(function(t,a){return s.jsx(Le,le({Icon:De},t,{ref:a}))}),ue=function(){return ue=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ue.apply(this,arguments)},vt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a};function we(e){var t=e.position,a=vt(e,["position"]),n=t==="right"?"rotate(180)":"rotate(0)";return s.jsx("circle",ue({cx:-X*.4,cy:0,r:X/4,stroke:"#aaa",strokeWidth:A*1.75,fill:"white",strokeDasharray:"2.7 2.5",transform:n},a))}var U=function(){return U=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},U.apply(this,arguments)},Oe=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},ze=function(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var n=a.call(e),r,o=[],i;try{for(;(t===void 0||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return o},q=function(e,t){return Array.from(Array(e).keys()).map(function(a){return(a-(e-1)/2)*t})},_t=function(e,t,a){if(e<=0)return[];if(e===1)return[[0,0]];for(var n=t>e?e:t,r=X,o=et,i=q(n,r),c=Math.ceil(e/n),u=q(c,o),l=e%n,h=[],f=0;f<c;f++){var m=a?c-1:0;if(l===0||f!==m)for(var g=0;g<n;g++)h.push([i[g],u[f]]);else for(var _=q(l,r),g=0;g<l;g++)h.push([_[g],u[f]])}return h},Be=function(e){return e==="fmetro"?We:De},T=A*7,K=A*2.2;d.forwardRef(function(t,a){var n=t.stations,r=t.textClassName,o=t.columns,i=o===void 0?2:o,c=t.topHeavy,u=t.anchorAt,l=t.osiPosition,h=t.children,f=Oe(t,["stations","textClassName","columns","topHeavy","anchorAt","osiPosition","children"]),m=d.useMemo(function(){return _t(n.length,i,c)},[n.length,i,c]),g=ze(d.useMemo(function(){if(u===void 0)return[0,0];if(u<0||u>=m.length)return console.warn("<InterchangeStation2024/>, anchor index ".concat(u," is out of bound")),[0,0];var y=ze(m[u],2),j=y[0],S=y[1];return[-j,-S]},[m,u]),2),_=g[0],x=g[1],p=d.useRef(null),v=d.useRef([]);d.useEffect(function(){v.current=v.current.slice(0,n.length)},[n.length]);var N=n.length===2&&i===1&&!!l;return d.useImperativeHandle(a,function(){return{target:p.current,children:v.current,getCoordinates:function(){return m},getCorrectedBBox:function(){var y,j,S=(j=(y=p.current)===null||y===void 0?void 0:y.getBBox())!==null&&j!==void 0?j:{x:0,y:0,width:0,height:0};return S.y-=T/2,S.height+=T,N?(l==="left"?S.x-=K/2:S.x-=T/2,S.width+=K/2+T/2):(S.x-=T/2,S.width+=T),S},getTranslate:function(){return[_,x]}}},[m,_,x,p.current,v.current,l]),s.jsxs("g",U({ref:p,transform:"translate(".concat(_,",").concat(x,")")},f,{children:[n.map(function(y,j){var S=y.style,C=Be(S);return s.jsx(C,{stroke:"#aaa",filled:!0,strokeWidth:T,transform:"translate(".concat(m[j][0],",").concat(m[j][1],")")},j)}),N&&s.jsx(we,{position:l,r:X/2.9,strokeWidth:K,strokeDasharray:void 0}),n.map(function(y,j){var S=y.style,C=Be(S);return s.jsx(C,{stroke:"white",filled:!0,strokeWidth:A*2.6,transform:"translate(".concat(m[j][0],",").concat(m[j][1],")")},j)}),N&&s.jsx(we,{position:l}),n.length&&s.jsx("rect",{fill:"white",x:-12,y:m[0][1],width:24,height:-m[0][1]*2}),n.map(function(y,j){var S=y.style,C=Oe(y,["style"]),k=S==="fmetro"?pt:fe;return s.jsx(k,U({ref:function(b){return v.current[j]=b},transform:"translate(".concat(m[j][0],",").concat(m[j][1],")"),textClassName:r},C),j)}),h]}))});var de=function(){return de=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},de.apply(this,arguments)},G=9,He=10*Math.PI/180,jt=G*Math.sin(He),Nt=G*Math.cos(He),$e="M0,".concat(G," A").concat(G,",").concat(G," 0 0,0 ").concat(jt,",-").concat(Nt);function St(e){return s.jsxs("g",de({},e,{children:[s.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),s.jsx("path",{d:$e,stroke:"red",strokeWidth:3,fill:"none"}),s.jsx("path",{d:$e,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),s.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]}))}var me=function(){return me=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},me.apply(this,arguments)},bt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a},wt=d.forwardRef(function(t,a){var n=t.clockwise,r=t.anchorAt,o=r===void 0?"text":r,i=bt(t,["clockwise","anchorAt"]),c=o==="circle"?29:0;return s.jsx("g",me({ref:a},i,{children:s.jsxs("g",{transform:"translate(".concat(c,",0)"),children:[s.jsx(St,{transform:"translate(-30,0)scale(".concat(n?-1:1,",1)")}),s.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),s.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})}))});const Ot=d.memo(function(t){const{stnName:a,onUpdate:n,onEnNameUpdate:r}=t,{zh:o="",en:i=""}=a,c=d.useRef(null);return d.useEffect(()=>{if(c.current){n==null||n(c.current.getBBox());const u=c.current.querySelector("g");u&&(r==null||r(u.getBBox()))}},[JSON.stringify(a),c.current]),s.jsxs("g",{ref:c,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:18,children:o}),s.jsx("g",{fontSize:10.5,children:i.split("\\").map((u,l)=>s.jsx("text",{className:"rmg-name__en",dy:16+l*11,children:u},l))})]})},(e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName));function zt(e){const{stnName:t,onUpdate:a,passed:n,...r}=e,{zh:o="",en:i=""}=t,c=d.useRef(null),[u,l]=d.useState({x:0,width:0});return d.useEffect(()=>{if(c.current){const h=c.current.getBBox();l(h),a==null||a(h)}},[JSON.stringify(t)]),!o&&!i?s.jsx(s.Fragment,{}):s.jsxs("g",{fill:n?"#aaa":"#000",...r,children:[s.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[s.jsx("text",{textAnchor:"end",x:u.x-3,className:"rmg-name__zh",children:"("}),s.jsx("text",{textAnchor:"start",x:u.width+u.x+3,className:"rmg-name__zh",children:")"})]}),s.jsxs("g",{ref:c,textAnchor:"middle",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:13,children:o}),s.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:i})]})]})}function Bt(e){const{passed:t,...a}=e;return s.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...a,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),s.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function $t(e){const{passed:t,temporary:a,...n}=e;return s.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...n,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),s.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),a&&s.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function Ct(e){var p,v,N;const{primaryName:t,secondaryName:a,stationState:n,flipped:r,express:o,underConstruction:i}=e,[c,u]=d.useState({width:0}),[l,h]=d.useState({width:0}),[f,m]=d.useState({x:0,width:-20}),g=y=>{switch(y){case E.PASSED:return"#aaa";case E.CURRENT:return"#f00";case E.FUTURE:return"#000"}},_=(N=(v=(p=t.en)==null?void 0:p.split("\\"))==null?void 0:v.length)!=null?N:1,x={g:{x:0,y:r?17.5:-20-_*14*Math.cos(-45)},StationSecondaryName:{x:(c.width+f.width/2+10)*(r?-1:1),y:2+5*(_-1)},ExpressTag:{x:(c.width+f.width+20+35)*(r?-1:1),y:2+5*(_-1)},UnderConstructionTag:{x:(l.width+5+20)*(r?-1:1),y:c.y+c.height-14}};return s.jsxs("g",{textAnchor:r?"end":"start",fill:g(n),transform:"translate(".concat(x.g.x,",").concat(x.g.y,")rotate(-45)"),children:[s.jsx(Ot,{stnName:t,onUpdate:u,onEnNameUpdate:h}),a&&s.jsx(zt,{stnName:a,onUpdate:m,passed:n===E.PASSED,transform:"translate(".concat(x.StationSecondaryName.x,",").concat(x.StationSecondaryName.y,")")}),o&&s.jsx(Bt,{passed:n===E.PASSED,transform:"translate(".concat(x.ExpressTag.x,",").concat(x.ExpressTag.y,")")}),i&&s.jsx($t,{passed:n===E.PASSED,temporary:i==="temp",transform:"translate(".concat(x.UnderConstructionTag.x,",").concat(x.UnderConstructionTag.y,")")})]})}function kt(e){var C,k,b,O,R,W,xe,ye,pe;const{stnId:t,stnState:a,stnY:n}=e,{theme:r,line_name:o,line_num:i,spanLineNum:c,stn_list:u,loop:l,loop_info:{midpoint_station:h,clockwise:f}}=z(Xe=>Xe.param),m=u[t],g=h===t,[_,x]=d.useState({height:0}),p=d.useRef(null);d.useEffect(()=>{p.current&&x(p.current.getBBox())},[p.current,n,m.localisedName,m.localisedSecondaryName,m.services]);const v=m.parents.length===2||m.children.length===2,N=n>0||m.parents.indexOf(((k=(C=m.branch)==null?void 0:C.left)==null?void 0:k[1])||"")===1||m.children.indexOf(((O=(b=m.branch)==null?void 0:b.right)==null?void 0:O[1])||"")===1?180:0,y=(xe=(W=(R=m.localisedName.en)==null?void 0:R.split("\\"))==null?void 0:W.length)!=null?xe:1,j=v?N===180?16+(y-1)*12*Math.cos(-45):-9:N===180?-6:(25+(y-1)*15)*Math.cos(-45),S=n>0?_.height+23:-_.height-23;return s.jsxs(s.Fragment,{children:[s.jsx(Pt,{intInfos:v?[{theme:[r[0],r[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:o},...(ye=m.transfer.groups[0].lines)!=null?ye:[]]:(pe=m.transfer.groups[0].lines)!=null?pe:[],stnState:l?E.FUTURE:a,tickRotation:N,spanDigits:c}),s.jsx(fe,{lineNum:i,stnNum:m.num,strokeColour:r[2],textClassName:"rmg-name__zh",passed:a===-1,alwaysShowColouredBorder:l,bolderBorder:!0,useSameScale:!0}),s.jsx("g",{ref:p,transform:"translate(".concat(-j,",0)"),children:s.jsx(Ct,{primaryName:m.localisedName,secondaryName:m.localisedSecondaryName,stationState:a,flipped:N===180,express:m.services.includes(Ue.express),underConstruction:m.underConstruction})}),g&&s.jsx(wt,{transform:"translate(0,".concat(S,")"),clockwise:f,anchorAt:n>0?"text":"circle"})]})}const Pt=e=>s.jsxs(s.Fragment,{children:[s.jsx(Et,{strokeWidth:4,...e}),s.jsx(It,{transform:"translate(0,".concat(e.tickRotation===180?-47:23,")"),...e})]}),Et=e=>{const{intInfos:t,stnState:a,tickRotation:n,spanDigits:r,...o}=e;return s.jsx("g",{...o,children:t.map((i,c)=>{var u;return s.jsx("use",{xlinkHref:"#inttick",stroke:a===-1?"#aaa":(u=i.theme)==null?void 0:u[2],transform:"translate(".concat(-2*(t.length-1)+4*c,",0)rotate(").concat(n===180?180:0,")")},c)})})},It=e=>{const{intInfos:t,tickRotation:a,stnState:n,spanDigits:r,...o}=e;return s.jsx("g",{...o,children:t.map((i,c)=>{var u,l,h,f;return s.jsx("g",{transform:"translate(0,".concat(c*28*(a===180?-1:1),")"),children:s.jsx(Me,{zhName:i.name[0],enName:i.name[1],foregroundColour:(l=(u=i.theme)==null?void 0:u[3])!=null?l:D.white,backgroundColour:(f=(h=i.theme)==null?void 0:h[2])!=null?f:"#aaaaaa",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",passed:n===-1,spanDigits:r})},c)})})};function Ge(e){const{xs:t,ys:a,stnStates:n}=e,{stn_list:r,loop:o}=z(u=>u.param),{branches:i}=z(u=>u.helper),c=o?i[0].slice(1,-1):Object.keys(r);return s.jsx("g",{id:"stn_icons",children:c.filter(u=>!["linestart","lineend"].includes(u)).map(u=>s.jsx("g",{style:{transform:"translate(".concat(t[u],"px,").concat(a[u],"px)")},children:s.jsx(kt,{stnId:u,stnState:n[u],stnY:a[u]})},u))})}const Ce=(e,t)=>e[t].parents.length===2||e[t].children.length===2?.25:0,Rt=(e,t,a)=>{const n=B("linestart","lineend",t);if(n.nodes.includes(e))return B(n.nodes[1],e,t).len;{const r=a.filter(l=>l.includes(e))[0];let o=e;for(;!n.nodes.includes(o);)o=r[r.indexOf(o)-1];let i=e;for(;!n.nodes.includes(i);)i=r[r.indexOf(i)+1];const c=o==="linestart",u=i==="lineend";if(r.toString()===a[0].toString()){const l=[];return!c&&!u?(l[0]=B(n.nodes[1],o,t).len,l[1]=B(o,i,t).len,l[2]=B(o,e,t).len,l[3]=B(e,i,t).len):c?(l[0]=0,l[1]=B(n.nodes[1],i,t).len,l[2]=B(r[1],e,t).len,l[3]=B(e,i,t).len):(l[0]=B(n.nodes[1],o,t).len,l[1]=B(o,n.nodes.slice(-2)[0],t).len,l[2]=B(o,e,t).len,l[3]=B(e,r.slice(-2)[0],t).len),l[0]+l[2]*l[1]/(l[2]+l[3])}else if(!c&&!u){const l=[];return l[0]=B(n.nodes[1],o,t).len,l[1]=B(o,i,t).len,l[2]=B(o,e,t).len,l[3]=B(e,i,t).len,l[0]+l[2]*l[1]/(l[2]+l[3])}else return c?B(n.nodes[1],i,t).len-B(e,i,t).len:B(n.nodes[1],o,t).len+B(o,e,t).len}},At=()=>{const{branches:e,routes:t,depsStr:a}=z(b=>b.helper),{svgWidth:n,svg_height:r,y_pc:o,padding:i,branchSpacingPct:c,direction:u,line_name:l,spanLineNum:h,current_stn_idx:f,stn_list:m}=z(b=>b.param),g=Ye(m,Ce,Ce),_=d.useMemo(()=>(console.log("computing x shares"),Object.keys(m).reduce((b,O)=>({...b,[O]:Rt(O,g,e)}),{})),[e.toString(),JSON.stringify(g)]),x=B("linestart","lineend",g),p=B(x.nodes[1],x.nodes.slice(-2)[0],g),v=u===w.right?[n[$.RailMap]*i/100+65,n[$.RailMap]*(1-i/100)-20]:[n[$.RailMap]*i/100,n[$.RailMap]*(1-i/100)-65],N=Object.keys(_).reduce((b,O)=>({...b,[O]:v[0]+_[O]/p.len*(v[1]-v[0])}),{}),y=d.useMemo(()=>(console.log("computing y shares"),Object.keys(m).reduce((b,O)=>{if(e[0].includes(O))return{...b,[O]:0};{const R=e.slice(1).filter(W=>W.includes(O))[0];return{...b,[O]:m[R[0]].children.indexOf(R[1])?-2:2}}},{})),[a]),j=Object.keys(y).reduce((b,O)=>({...b,[O]:-y[O]*c*r/200}),{}),S=d.useMemo(()=>Je(f,t,u),[f,u,t.toString()]),C=e.map(b=>Ve(b,S)).reduce((b,O)=>(b.main.push(O.main),b.pass.push(O.pass),b),{main:[],pass:[]}),k=Object.keys(C).reduce((b,O)=>({...b,[O]:C[O].map(R=>Mt(R,N,j))}),{});return s.jsxs("g",{id:"main",style:{"--y-percentage":o,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[s.jsx(Tt,{paths:k}),s.jsx(Ge,{xs:N,ys:j,stnStates:S}),s.jsx("g",{id:"line_name",style:{"--translate-x":u===w.right?"".concat(v[0]-65,"px"):"".concat(v[1]+65,"px")},children:s.jsx(Me,{zhName:l[0],enName:l[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:h})})]})},Tt=d.memo(function(t){return s.jsxs("g",{fill:"none",strokeWidth:4,children:[s.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((a,n)=>s.jsx("path",{d:a},n))}),s.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((a,n)=>s.jsx("path",{d:a},n))})]})},(e,t)=>JSON.stringify(e.paths)===JSON.stringify(t.paths)),Mt=(e,t,a)=>{let n;const r=[];return e.forEach(o=>{const i=t[o],c=a[o];if(!n&&n!==0){n=c,r.push("M ".concat(i,",").concat(c));return}c===0?(c<n&&r.push("H ".concat(i-40),"a 40,40 0 0,0 40,-40","V ".concat(c)),c>n&&r.push("H ".concat(i-40),"a 40,40 0 0,1 40,40","V ".concat(c))):(c<n&&r.push("V ".concat(c+40),"a 40,40 0 0,1 40,-40","H ".concat(i)),c>n&&r.push("V ".concat(c-40),"a 40,40 0 0,0 40,40","H ".concat(i))),r.push("H ".concat(i)),n=c}),r.join(" ").replace(/( H ([\d.]+))+/g," H $2")};function ge(e){return s.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black",...e})}function Wt(e){const{destIds:t,textAnchor:a,...n}=e,r=z(l=>l.param.direction),o=z(l=>l.param.stn_list),i=t.map(l=>{var h,f;return(f=(h=o[l].localisedName.zh)==null?void 0:h.length)!=null?f:0}),c=Math.min(...i),u=c>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(c-1):0;return s.jsxs("g",{textAnchor:a,...n,children:[t.map((l,h)=>{var g;const f=i[h]>i[1-h],m=!qe()&&a==="end"&&!f;return s.jsxs(d.Fragment,{children:[s.jsx("text",{className:"rmg-name__zh",fontSize:25,x:r===w.left?0:-75,y:-21+42*h,letterSpacing:f?"0em":"".concat(u,"em"),dx:m?"".concat(u,"em"):"0em",children:o[l].localisedName.zh}),s.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:r===w.left?0:-75,y:-1+42*h,children:"Towards "+((g=o[l].localisedName.en)==null?void 0:g.replace("\\"," "))})]},l)}),s.jsx("text",{className:"rmg-name__zh",fontSize:28,x:r===w.left?25*(Math.max(...i)+1):0,y:5,children:"方向"})]})}const Dt=(e,t,a,n)=>{const i=e*(1-2*t/100)*(a-1)/a-n,c=e-i;return[c/2,e-c/2]},Lt=(e,t,a)=>{const n=Math.min(...Object.values(e)),r=Math.max(...Object.values(e)),o=Math.min(...Object.values(t)),c=Math.max(...Object.values(t))-o,u=c/2;return"M".concat(r,",").concat(o," H").concat(n," h-").concat(a/2," a").concat(u,",").concat(u," 0 0,0 0,").concat(c," H").concat(r," h").concat(a/2," a").concat(u,",").concat(u," 0 0,0 0,-").concat(c,"Z")},Ht=(e,t,a,n)=>{const r=e.indexOf(a),o=e.indexOf(n!=null?n:a);let i;return o<0?i=e:t?i=r<=o?[...e.slice(0,r+1),...e.slice(o)]:e.slice(o,r+1):i=r<o?e.slice(r,o+1):[...e.slice(r),...e.slice(0,o+1)],e.reduce((c,u,l)=>r===l?{...c,[u]:E.CURRENT}:i.includes(u)?{...c,[u]:E.FUTURE}:{...c,[u]:E.PASSED},{})},ke=6;function Gt({currentStationX:e,currentStationY:t,stationGap:a,loopClockwise:n}){const r=t>0?n?-1:1:n?1:-1,o=(a/3-ke)*r,i=e+o+ke*r,c=(t-12)*-r;return s.jsx("g",{transform:"scale(1,".concat(-r,")"),children:s.jsx("path",{d:"M".concat(i,",").concat(c," h").concat(o),strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function Pe({clockwise:e,...t}){return s.jsx("g",{...t,children:s.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:16,children:e?"内环":"外环"}),s.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:e?"Inner Circle":"Outer Circle"})]})})}const Fe=2/3,Ft=2-Fe,Zt=25*Math.PI/180,Xt=Math.asin(Math.sin(35*Math.PI/180)/2);function Ut({cxLeft:e,cxRight:t,yGap:a,clockwise:n}){const r=a/2,o=r*(n?Fe:Ft),i=n?Zt:Xt,c=o*Math.cos(i),u=n?1:-1,l=n?1:0,h=o*Math.sin(i)*u,f=2*h,m={rotate:n?"-4deg":"2deg"};return s.jsxs(s.Fragment,{children:[s.jsxs("g",{transform:"translate(".concat(e,",0)"),children:[s.jsx("path",{d:"M".concat(-c,",").concat(h," a").concat(o,",").concat(o," 0 0,").concat(l," 0,").concat(-f),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:m}),s.jsx(Pe,{transform:"translate(".concat(n?0:-2*r,",0)"),clockwise:n})]}),s.jsxs("g",{transform:"translate(".concat(t,",0)"),children:[s.jsx("path",{d:"M".concat(c,",").concat(-h," a").concat(o,",").concat(o," 0 0,").concat(l," 0,").concat(f),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:m}),s.jsx(Pe,{transform:"translate(".concat(n?0:2*r,",0)"),clockwise:n})]})]})}function Yt(){const{branches:e}=z(y=>y.helper),{svgWidth:t,svg_height:a,y_pc:n,padding:r,branchSpacingPct:o,current_stn_idx:i,loop_info:{midpoint_station:c,clockwise:u}}=z(y=>y.param),l=e[0].slice(1,-1),h=Math.ceil(l.length/2),f=d.useMemo(()=>(console.log("computing x shares"),l.reduce((y,j,S,C)=>{let k;return S<h?k=h-S-1:(k=S-h,C.length&1&&(k+=.5)),{...y,[j]:k}},{})),[l.toString()]),m=o*a*2/100,g=Dt(t[$.RailMap],r,h,m),_=(g[1]-g[0])/(h-1),x=Object.keys(f).reduce((y,j)=>({...y,[j]:g[0]+f[j]*_}),{}),p=d.useMemo(()=>(console.log("computing y shares"),l.reduce((y,j,S)=>({...y,[j]:S<h?1:-1}),{})),[l.toString()]),v=Object.keys(p).reduce((y,j)=>({...y,[j]:-p[j]*m/2}),{}),N=Ht(l,u!=null?u:!1,i,c);return s.jsxs("g",{id:"main",style:{"--y-percentage":n,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[s.jsx("path",{d:Lt(x,v,_),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),s.jsx(Ge,{xs:x,ys:v,stnStates:N}),s.jsx(Gt,{currentStationX:x[i],currentStationY:v[i],stationGap:_,loopClockwise:u}),s.jsx(Ut,{cxLeft:g[0]-_/2,cxRight:g[1]+_/2,yGap:m,clockwise:u})]})}const Ee=$.RailMap,Jt=()=>{const{canvasScale:e}=z(g=>g.app),{svgWidth:t,svg_height:a,direction:n,psd_num:r,info_panel_type:o,notesGZMTR:i,current_stn_idx:c,stn_list:u,theme:l,loop:h}=z(g=>g.param),f=t[Ee],m=u[c];return s.jsxs(Ie,{type:Ee,svgWidth:f,svgHeight:a,canvasScale:e,theme:l,children:[s.jsx(Vt,{}),s.jsx(Re,{variant:o,isShowLight:o===P.gz2otis,isShowPSD:o===P.gz2otis&&r}),n===w.left&&m.parents.includes("linestart")||n===w.right&&m.children.includes("lineend")?s.jsx(Qt,{}):s.jsxs(s.Fragment,{children:[h?s.jsx(Yt,{}):s.jsx(At,{}),!h&&s.jsx(qt,{}),i==null?void 0:i.map((g,_)=>s.jsx(en,{note:g},_))]}),o===P.gz2otis&&s.jsx("line",{x2:f,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},Vt=d.memo(function(){return s.jsxs("defs",{children:[s.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),s.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:s.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),qt=()=>{const{routes:e}=z(c=>c.helper),{direction:t,direction_gz_x:a,direction_gz_y:n,current_stn_idx:r}=z(c=>c.param),o=d.useMemo(()=>[...new Set(e.reduce((c,u)=>u.includes(r)?c.concat(u.filter(l=>!["linestart","lineend"].includes(l)).slice(t===w.left?0:-1)[0]):c,[]).filter(c=>c!==r))],[r,t,e.toString()]),i={textAnchor:t===w.left?"start":"end",transform:"translate(".concat(t===w.left?65:-65,",-5)"),destIds:o};return s.jsxs("g",{id:"direction_gz",style:{"--x-percentage":a,"--y-percentage":n},children:[s.jsx(ge,{transform:"scale(0.35)rotate(".concat(t===w.left?0:180,")")}),o.length!==2?s.jsx(Kt,{...i}):s.jsx(Wt,{...i})]})},Kt=e=>{const{destIds:t,...a}=e,n=z(r=>r.param.stn_list);return s.jsxs("g",{...a,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(r=>n[r].localisedName.zh).join("/")+"方向"}),s.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(r=>{var o;return(o=n[r].localisedName.en)==null?void 0:o.replace("\\"," ")}).join("/")})]})},Qt=d.memo(function(){return s.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),s.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),s.jsxs("g",{strokeWidth:8,stroke:"#000",children:[s.jsx("path",{d:"M -160,68 h -160"}),s.jsx("path",{d:"M 160,68 h 160"})]})]})}),en=d.memo(function(t){const a=d.useRef(null),[n,r]=d.useState({width:0,height:0,y:0});return d.useEffect(()=>{a.current&&r(a.current.getBBox())},[t.note[0],t.note[1]]),s.jsxs("g",{className:"note-box",style:{"--x-percentage":t.note[2],"--y-percentage":t.note[3]},children:[t.note[4]&&s.jsx("rect",{height:n.height+4,width:n.width+4,x:-2,y:n.y-2,fill:"none",stroke:"black",strokeWidth:.5}),s.jsxs("g",{ref:a,children:[s.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((o,i)=>s.jsx("text",{className:"rmg-name__zh",y:i*18,children:o},i))}),s.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((o,i)=>{var c;return s.jsx("text",{className:"rmg-name__en",y:i*11,textLength:i<(((c=t.note[1].match(/\n/g))==null?void 0:c.length)||0)?n.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:o},i)})})]})]})},(e,t)=>e.note.toString()===t.note.toString()),tn=d.memo(function(t){var o,i;const{stnName:a,onUpdate:n}=t,r=d.useRef(null);return d.useEffect(()=>{r.current&&n&&n(r.current.getBBox())},[JSON.stringify(a)]),s.jsxs("g",{ref:r,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:92,children:a.zh}),s.jsx("g",{fontSize:40,children:(i=(o=a.en)==null?void 0:o.split("\\"))==null?void 0:i.map((c,u)=>s.jsx("text",{className:"rmg-name__en",dy:72+u*42,children:c},u))})]})},(e,t)=>JSON.stringify(e.stnName)===JSON.stringify(t.stnName)),nn=e=>{const{secondaryName:t,transform:a}=e,n=d.useRef(null),[r,o]=d.useState({x:0,width:0});return d.useEffect(()=>{n.current&&o(n.current.getBBox())},[t.toString()]),s.jsxs("g",{transform:a,children:[s.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[s.jsx("text",{textAnchor:"end",x:r.x-3,className:"rmg-name__zh",children:"("}),s.jsx("text",{textAnchor:"start",x:r.width+r.x+3,className:"rmg-name__zh",children:")"})]}),s.jsxs("g",{ref:n,textAnchor:"middle",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),s.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},Y=55,Ze=18.5*1.4,rn=()=>{var y,j,S;const{svg_height:e,svgWidth:t,theme:a,direction:n,info_panel_type:r,line_num:o,current_stn_idx:i,stn_list:c}=z(C=>C.param),u=c[i],{localisedName:l,localisedSecondaryName:h}=u,[f,m]=d.useState({width:0}),g=(S=(j=(y=l.en)==null?void 0:y.split("\\"))==null?void 0:j.length)!=null?S:1,_=u[n===w.left?"parents":"children"],x=[P.gz7w,P.gz11].includes(r),p={name:"translate(".concat((n===w.left?1:-1)*t[$.RunIn]/4,",45)"),next:"translate(".concat((n===w.left?1:-1)*t[$.RunIn]/10,",45)")},v=(t[$.RunIn]+f.width)/2+Y,N={nameGroup:{x:t.runin/2,y:.5*e-50-(g-1)*18-(h?29:0)},secondaryName:{x:0,y:70+g*36},stationNumber:{x:v,y:.5*e-30-(g-1)*18-(h?58/2:0)},stationNumberPost2022:{x:n===w.left?v:(t[$.RunIn]-f.width)/2-Y,y:.5*e-(g-1)*18-(h?58/2:0)}};return s.jsxs("g",{children:[s.jsxs("g",{transform:r===P.gz2otis?p.name:"",children:[s.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(N.nameGroup.x,",").concat(N.nameGroup.y,")"),children:[s.jsx(tn,{stnName:l,onUpdate:m}),h&&s.jsx(nn,{secondaryName:h,transform:"translate(".concat(N.secondaryName.x,",").concat(N.secondaryName.y,")")})]}),s.jsx(fe,{lineNum:o,stnNum:u.num,strokeColour:a[2],textClassName:"rmg-name__zh",transform:x?"translate(".concat(N.stationNumberPost2022.x,",").concat(N.stationNumberPost2022.y,")"):"translate(".concat(N.stationNumber.x,",").concat(N.stationNumber.y,")"),size:"lg"})]}),s.jsx("g",{transform:r===P.gz2otis?p.next:"",children:!_||_.includes("linestart")||_.includes("lineend")?s.jsx(s.Fragment,{}):_.length===1?s.jsx(an,{nextId:_[0],nameBBox:f,ignoreNumWidth:x}):s.jsx(on,{nextIds:_,nameBBox:f,ignoreNumWidth:x})})]})},an=e=>{const{nextId:t,nameBBox:a,ignoreNumWidth:n}=e,r=z(p=>p.param.svgWidth),o=z(p=>p.param.direction),i=z(p=>p.param.stn_list[t]),{localisedName:c,localisedSecondaryName:u}=i,{zh:l="",en:h=""}=c,[f,m]=d.useState({width:0}),g=d.useRef(null);d.useEffect(()=>{g.current&&m(g.current.getBBox())},[l,h]);const _=l.length,x=(r[$.RunIn]-a.width)/2;return s.jsxs(s.Fragment,{children:[s.jsxs("g",{id:"big_next",children:[s.jsxs("g",{textAnchor:"middle",style:{"--translate-x":o===w.left?"80px":_<=2?"".concat(r[$.RunIn]-45-f.width-70,"px"):"".concat(r[$.RunIn]-45-f.width-35*1.5,"px")},children:[s.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),s.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),s.jsxs("g",{textAnchor:"start",ref:g,style:{"--translate-x":o===w.left?_<=2?"150px":"".concat(115+35/2,"px"):"".concat(r[$.RunIn]-45-f.width,"px")},children:[s.jsx("text",{className:"rmg-name__zh",fontSize:35,children:l}),s.jsx("g",{fontSize:17,children:h.split("\\").map((p,v)=>s.jsx("text",{className:"rmg-name__en",dy:30+v*17,children:p},v))})]}),u&&s.jsx("g",{textAnchor:"middle",style:{"--translate-x":o===w.left?_<=2?"150px":"".concat(115+35/2,"px"):"".concat(r[$.RunIn]-45-f.width,"px")},children:s.jsx(sn,{secName:u,transform:"translate(".concat(f.width/2,",").concat(30+h.split("\\").length*17+5,")")})})]}),s.jsx(ge,{id:"arrow",style:{"--translate-x":o===w.left?"".concat((115+35*((_<=2?1:.5)+_)+x)/2-20,"px"):"".concat((r[$.RunIn]-45-f.width-(_<=2?105:35*2.5)+x+e.nameBBox.width+(n?0:Y+Ze))/2+20,"px"),"--rotate":o===w.left?"0deg":"180deg"}})]})},sn=e=>{const{secName:t,...a}=e,{zh:n,en:r}=t,o=d.useRef(null),[i,c]=d.useState({x:0,width:0});return d.useEffect(()=>{o.current&&c(o.current.getBBox())},[n,r]),s.jsxs("g",{...a,children:[s.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[s.jsx("text",{textAnchor:"end",x:i.x-3,className:"rmg-name__zh",children:"("}),s.jsx("text",{textAnchor:"start",x:i.width+i.x+3,className:"rmg-name__zh",children:")"})]}),s.jsxs("g",{ref:o,children:[s.jsx("text",{className:"rmg-name__zh",fontSize:18,children:n}),s.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:r})]})]})},on=e=>{const{nextIds:t,nameBBox:a,ignoreNumWidth:n}=e,{routes:r}=z(x=>x.helper),o=z(x=>x.param.svgWidth),i=z(x=>x.param.direction),c=z(x=>x.param.stn_list),u=t.map(x=>c[x].localisedName),[l,h]=d.useState({width:0}),f=d.useRef([]);d.useEffect(()=>{h(x=>({...x,width:0})),f.current.forEach(x=>{const p=x==null?void 0:x.getBBox();h(v=>p?v.width>p.width?v:p:v)})},[u.toString()]);const m=e.nextIds.map(x=>r.reduce((p,v)=>v.includes(x)?p.concat(v.filter(N=>!["linestart","lineend"].includes(N)).slice(i===w.left?0:-1)[0]):p,[])),g=Math.max(...u.map(x=>{var p,v;return(v=(p=x.zh)==null?void 0:p.length)!=null?v:0})),_=(o[$.RunIn]-a.width)/2;return s.jsxs(s.Fragment,{children:[s.jsx("g",{id:"big_next_2",children:u.map((x,p)=>{var v,N;return s.jsxs(d.Fragment,{children:[s.jsxs("g",{textAnchor:"middle",style:{"--translate-x":i===w.left?"72px":"".concat(o[$.RunIn]-45-l.width-41,"px")},children:[s.jsx("text",{className:"rmg-name__zh",children:"下站"}),s.jsx("text",{className:"rmg-name__en",y:22,children:"Next"})]}),s.jsxs("g",{ref:y=>f.current[p]=y,textAnchor:"start",style:{"--translate-x":i===w.left?"113px":"".concat(o[$.RunIn]-45-l.width,"px")},children:[s.jsx("text",{className:"rmg-name__zh",children:x.zh}),(N=(v=x.en)==null?void 0:v.split("\\"))==null?void 0:N.map((y,j)=>s.jsx("text",{className:"rmg-name__en",y:22+j*13,children:y},j)),s.jsx("text",{className:"rmg-name__zh",y:-35,children:m[p].map(y=>c[y].localisedName.zh).join("/")+"方向"}),s.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+m[p].map(y=>c[y].localisedName.en).join("/").replace("\\"," ")})]})]},p)})}),s.jsx(ge,{id:"arrow",style:{"--translate-x":i===w.left?"".concat((99+27*(1+g)+_)/2-20,"px"):"".concat((o[$.RunIn]-45-l.width-41-27+_+e.nameBBox.width+(n?0:Y+Ze))/2+20,"px"),"--rotate":i===w.left?"0deg":"180deg"}})]})};function cn(e){const{num:t,...a}=e;return s.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...a,children:[s.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),s.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),s.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),s.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function ln(e){const{canvasType:t}=e,{svgWidth:a,svg_height:n}=z(r=>r.param);return s.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[s.jsx("line",{y2:n,transform:"translate(".concat(a[t]/2,",0)")}),s.jsx("line",{x2:a[t],transform:"translate(0,90)"})]})}function un({coachNumber:e,...t}){return s.jsxs("g",{...t,children:[s.jsx("path",{d:"M-24,-24 a24,24 0 0,0 0,48 h48 a24,24, 0 0,0 0,-48Z",fill:"whitesmoke",stroke:"lightgrey"}),s.jsxs("g",{textAnchor:"middle",transform:"translate(-15,-7)",children:[s.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"车厢"}),s.jsx("text",{className:"rmg-name__en",fontSize:16,y:20,children:"Car"})]}),s.jsx("g",{textAnchor:"middle",transform:"translate(25,0)",children:s.jsx("text",{className:"rmg-name__zh",fontSize:28,children:e})})]})}const Q=$.RunIn;function dn(){const{canvasScale:e}=z(g=>g.app),{svgWidth:t,svg_height:a,direction:n,info_panel_type:r,platform_num:o,psd_num:i,coachNum:c,theme:u}=z(g=>g.param),l=t[Q],h=[P.gz7w,P.gz11].includes(r),f=h?a-60:a/2-30,m={platform:"translate(".concat(n===w.left?50:-50,",45)")};return s.jsxs(Ie,{type:Q,svgWidth:l,svgHeight:a,canvasScale:e,theme:u,children:[s.jsx(Re,{variant:r,isShowLight:r!==P.gz2otis,isShowPSD:r!==P.gz2otis&&i}),s.jsx("g",{transform:r===P.gz2otis?m.platform:"",children:s.jsx(cn,{num:o,style:{"--translate-x":"".concat(n===w.left?l-100:100,"px"),"--translate-y":f+"px",transform:"translate(var(--translate-x, 100px), var(--translate-y))"}})}),h&&s.jsx(un,{coachNumber:c,transform:"translate(".concat(l*.85,",").concat(a*.65,")")}),s.jsx(rn,{}),r===P.gz2otis&&s.jsx(ln,{canvasType:Q})]})}const pn={runin:s.jsx(dn,{}),railmap:s.jsx(Jt,{})};export{pn as default};
