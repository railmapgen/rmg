import{j as e}from"./chakra-Sn37LbgI.js";import{a as h}from"./react-Cf9aS4i4.js";import{i as H,P as w,b0 as T,u as B,n as Le,S as $,aW as C}from"./index-BkkgaCq0.js";import{a as Fe,c as R,b as Ze,d as Ge}from"./share-BQeIIyrL.js";import{S as we}from"./svg-wrapper-CPeIYnz1.js";import{i as Xe}from"./param-selector-DoRwtffg.js";function Ue(n){const{num:t,inStrip:s,showAsPlatformDoor:r,...a}=n;return e.jsxs("g",{textAnchor:"middle",fill:s?H.black:"var(--rmg-theme-fg)",...a,children:[e.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:s?"#fff":"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),r?e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:11,dy:26,children:"站台门"}),e.jsx("text",{className:"rmg-name__en",fontSize:5.5,dy:36,children:"Platform Door"})]}):e.jsxs(e.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),e.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})]})}const Be=n=>{const t=(a=>{switch(a){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":case"gz11":case"gz1822":case"gz7w":return 30;default:return 0}})(n.variant),s=h.useMemo(()=>{switch(n.variant){case"gz1":return e.jsx("circle",{cy:-65,r:20,fill:"red"});case"gz28":case"gz2otis":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return e.jsx("rect",{x:-18,y:-58,height:36,width:36,fill:"red"});case"gz6":return e.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz5":return e.jsx("rect",{x:-30,y:-80,height:35,width:60,fill:"whitesmoke"});case"gz4":return e.jsx("rect",{x:-60,y:-68,height:30,width:120,fill:"whitesmoke"});case"gzgf":return e.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});case"gz1421":case"gz7w":case"gz11":return e.jsx("ellipse",{cy:-58,rx:36,ry:18,fill:"darkorange"});default:return e.jsx(e.Fragment,{})}},[n.variant]);return e.jsxs("g",{transform:"translate(0,".concat(n.variant==="gz4"?-15:0,")"),style:{"--strip-height":"".concat(t,"px")},children:[e.jsx("rect",{id:"strip_gz"}),n.variant===w.gz1&&e.jsx("rect",{className:"gz1-gap"}),e.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:n.isShowLight&&s}),n.isShowPSD!==!1&&e.jsx(Ve,{...n})]})},Ve=h.memo(function(t){const s=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),r=(i=>{switch(i){case"gz1":case"gz3":return"93px";case"gz4":return"86px";case"gz5":return"90px";case"gz1421":case"gz7w":case"gz11":return"96px";default:return"56px"}})(t.variant),a=(i=>{switch(i){case"gz1":case"gz3":case"gz4":case"gz5":return 1.2;case"gz1421":case"gz7w":case"gz11":return 1.4;default:return 1}})(t.variant),o=[w.gz1,w.gz3,w.gz4,w.gz5,w.gz1421,w.gz7w,w.gz11].includes(t.variant);return e.jsx(Ue,{num:t.isShowPSD,inStrip:s,showAsPlatformDoor:t.variant===w.gz11,style:{"--psd-dy":r,transform:"translate(var(--translate-x), var(--translate-y))scale(var(--scale))","--translate-x":o?"calc(var(--rmg-svg-width) / 2 + 110px)":"calc(var(--rmg-svg-width) / 2 + 80px)","--translate-y":"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))","--scale":a}})},(n,t)=>n.variant===t.variant&&n.isShowPSD===t.isShowPSD),D=1.3,Ee=1.7,V=18.5,Ye=V+D,ae=V*2+D,P=5,L=5.625,de=V-P,xe=V-2*L,ve=h.memo(function(t){const{stroke:s,filled:r,bolder:a,...o}=t,i="M0,9.25 V-9.25 H-".concat(de," l-").concat(P,",").concat(L," v").concat(xe," l").concat(P,",").concat(L," H").concat(de," l").concat(P,",-").concat(L," v-").concat(xe," l-").concat(P,",-").concat(L," H0");return e.jsx("path",{d:i,fill:r?s:"#fff",strokeWidth:a?Ee:D,stroke:s,...o})}),Je={updateId:0,update:()=>{}},qe=h.createContext(Je),Z=17,Ke=["Arial"],Re=h.forwardRef(function(t,s){const{Icon:r,lineNum:a,stnNum:o,strokeColour:i,passed:c,size:l,textClassName:m,bolderBorder:x,alwaysShowColouredBorder:g,useSameScale:d,children:u,...S}=t,{updateId:_}=h.useContext(qe),p=h.useRef(null),N=h.useRef(null),[f,j]=h.useState({width:0}),[y,v]=h.useState({width:0}),b=()=>{p.current&&j(p.current.getBBox()),N.current&&v(N.current.getBBox())};h.useEffect(()=>{const W=new AbortController;return b(),document.fonts.load("12px "+Ke.join(", "),(a!=null?a:"")+(o!=null?o:"")).then().finally(()=>{setTimeout(()=>{W.signal.aborted||b()},100)}),()=>{W.abort()}},[a,o,_]);const k=a&&a.length>2;h.useEffect(()=>{d&&k&&console.warn("GenericStationNumber(), useSameScale props does not work when lineNum has more than 2 characters")},[d,k]);const z=Z/Math.max(Z,f.width),E=d&&(a==null?void 0:a.length)===2?z:Z/Math.max(Z,y.width),I=l==="sm"?"0.7":l==="lg"?"1.6":1;return e.jsxs("g",{ref:s,...S,children:[e.jsxs("g",{transform:"scale(".concat(I,")"),children:[e.jsx(r,{stroke:c&&!g?"#aaa":i,filled:!a&&!o,bolder:x}),(a||o)&&e.jsxs("g",{textAnchor:"middle",fontSize:13.5,fill:c?"#aaa":"#000",children:[e.jsx("g",{transform:"translate(-9.25,0)scale(".concat(z,")"),children:e.jsx("text",{ref:p,className:m,dominantBaseline:"central",x:.5,children:a})}),e.jsx("g",{transform:"translate(9.25,0)scale(".concat(E,")"),children:e.jsx("text",{ref:N,className:m,dominantBaseline:"central",children:o})})]})]}),u]})}),Qe=h.forwardRef(function(t,s){return e.jsx(Re,{Icon:ve,...t,ref:s})}),X=45,A=X-3,be=(n,t)=>{const s=[n,t].map(r=>r.match(/^(\w+).+$/));if(s[0]&&s[1]&&s[0][1]===s[1][1])return s[0][1]},oe=n=>{const t=n.match(/^(\d+)\D+$/);return t==null?void 0:t[1]};function Y(n){const{customWidth:t,...s}=n,r=(t!=null?t:X)-X;return e.jsx("rect",{x:-22.5-r/2,height:24,width:t!=null?t:X,rx:4.5,...s,"data-testid":"intBox"})}const et=(n,t)=>{const s=oe(n);if(s)return{isDigit:!0,spanningPart:s};const r=be(n,t);return r?{isDigit:!1,spanningPart:r}:{isDigit:!1,spanningPart:""}};function ge(n){const{zhName:t,enName:s,foregroundColour:r,backgroundColour:a,zhClassName:o,enClassName:i,passed:c,children:l,spanDigits:m,...x}=n,{isDigit:g,spanningPart:d}=et(t,s),u=h.useRef(null),[S,_]=h.useState({x:0,height:0,width:0});h.useEffect(()=>{u.current&&_(u.current.getBBox())},[t,s]);const p=A/Math.max(A,S.width),N=(-S.x-S.width/2)*p,f=S.height*(1-p)/2;return e.jsxs("g",{textAnchor:"middle",fill:c?H.white:r,...x,children:[e.jsx(Y,{fill:c?"#aaa":a}),e.jsx("g",{ref:u,transform:"translate(".concat(N,",").concat(f,")scale(").concat(p,")"),children:e.jsxs("text",{className:o,fontSize:21,x:-1,y:12,textAnchor:"end",dominantBaseline:"central",children:[d,e.jsx("tspan",{className:o,fontSize:10,x:0,dy:-4,textAnchor:"start",dominantBaseline:"central",children:t.slice(d.length).trim()}),e.jsx("tspan",{className:i,fontSize:6.5,letterSpacing:-.1,x:0,dy:10,textAnchor:"start",dominantBaseline:"middle",children:g?s:s.slice(d.length).trim()})]})}),l]})}function tt(n){var v;const{zhName:t,enName:s,foregroundColour:r,backgroundColour:a,zhClassName:o,enClassName:i,passed:c,children:l,spanDigits:m,...x}=n,g=(v=oe(t))!=null?v:"",d=h.useRef(null),u=h.useRef(null),[S,_]=h.useState({width:0}),[p,N]=h.useState({width:0});h.useEffect(()=>{d.current&&_(d.current.getBBox()),u.current&&N(u.current.getBBox())},[t,s]);const f=A/Math.max(A,S.width),j=A/Math.max(A,p.width),y={nameZh:{y:7.3+13.5*(1-f)*f/2},nameEn:{y:19.5-9*(1-j)*j/2}};return e.jsxs("g",{textAnchor:"middle",fill:c?H.white:r,...x,children:[e.jsx(Y,{fill:c?"#aaa":a}),e.jsxs("text",{ref:d,className:o,fontSize:12,transform:"translate(0,".concat(y.nameZh.y,")scale(").concat(f,")"),dominantBaseline:"central",children:[e.jsx("tspan",{fontSize:16,dy:.7,dominantBaseline:"central",children:g}),e.jsx("tspan",{dy:-.7,dominantBaseline:"central",children:t.slice(g.length)})]}),e.jsx("text",{ref:u,className:i,fontSize:8,transform:"translate(0,".concat(y.nameEn.y,")scale(").concat(j,")"),dominantBaseline:"middle",children:s}),l]})}function nt(n){const{zhName:t,enName:s,foregroundColour:r,backgroundColour:a,zhClassName:o,enClassName:i,passed:c,children:l,spanDigits:m,...x}=n,g=h.useRef(null),[d,u]=h.useState({width:0});h.useEffect(()=>{g.current&&u(g.current.getBBox())},[t,s]);const S=Math.max(45,d.width+4);return e.jsxs("g",{textAnchor:"middle",fill:c?H.white:r,...x,children:[e.jsx(Y,{customWidth:S,fill:c?"#aaa":a}),e.jsxs("g",{ref:g,children:[e.jsx("text",{className:o,fontSize:8.5,y:8,dominantBaseline:"central",children:t}),e.jsx("text",{className:i,fontSize:5.5,y:18,dominantBaseline:"middle",children:s})]}),l]})}function st(n){const{zhName:t,enName:s,foregroundColour:r,backgroundColour:a,zhClassName:o,enClassName:i,passed:c,children:l,spanDigits:m,...x}=n,g=h.useRef(null),d=h.useRef(null),[u,S]=h.useState({width:0}),[_,p]=h.useState({width:0});h.useEffect(()=>{g.current&&S(g.current.getBBox()),d.current&&p(d.current.getBBox())},[t,s]);const N=A/Math.max(A,u.width),f=A/Math.max(A,_.width),j={nameZh:{y:7.3+13.5*(1-N)*N/2},nameEn:{y:19.5-9*(1-f)*f/2}};return e.jsxs("g",{textAnchor:"middle",fill:c?H.white:r,...x,children:[e.jsx(Y,{fill:c?"#aaa":a}),e.jsx("text",{ref:g,className:o,fontSize:12,transform:"translate(0,".concat(j.nameZh.y,")scale(").concat(N,")"),dominantBaseline:"central",children:t}),e.jsx("text",{ref:d,className:i,fontSize:8,transform:"translate(0,".concat(j.nameEn.y,")scale(").concat(f,")"),dominantBaseline:"middle",children:s}),l]})}const ie=h.memo(function(t){const{zhName:s,enName:r,spanDigits:a}=t;switch(rt(s,r)){case 1:return a?e.jsx(ge,{...t}):e.jsx(tt,{...t});case 2:return e.jsx(ge,{...t});default:return s.length>=5?e.jsx(nt,{...t}):e.jsx(st,{...t})}}),rt=(n,t)=>oe(n)!==void 0?1:be(n,t)!==void 0?2:3,ke=h.memo(function(t){const{stroke:s,filled:r,bolder:a,...o}=t;return e.jsx("path",{d:"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:r?s:"#fff",strokeWidth:a?Ee:D,stroke:s,...o})}),ce=h.forwardRef(function(t,s){return e.jsx(Re,{Icon:ke,...t,ref:s})});function ue({position:n,...t}){const s=n==="right"?"rotate(180)":"rotate(0)";return e.jsx("circle",{cx:-38.3*.4,cy:0,r:ae/4,stroke:"#aaa",strokeWidth:D*1.75,fill:"white",strokeDasharray:"2.7 2.5",transform:s,...t})}const q=(n,t)=>Array.from(Array(n).keys()).map(s=>(s-(n-1)/2)*t),at=(n,t,s)=>{if(n<=0)return[];if(n===1)return[[0,0]];const r=t>n?n:t,a=ae,o=Ye,i=q(r,a),c=Math.ceil(n/r),l=q(c,o),m=n%r,x=[];for(let g=0;g<c;g++){const d=s?c-1:0;if(m===0||g!==d)for(let u=0;u<r;u++)x.push([i[u],l[g]]);else{const u=q(m,a);for(let S=0;S<m;S++)x.push([u[S],l[g]])}}return x},fe=n=>n==="fmetro"?ve:ke,O=D*7,K=D*2.2;h.forwardRef(function({stations:t,textClassName:s,columns:r=2,topHeavy:a,anchorAt:o,osiPosition:i,children:c,...l},m){const x=h.useMemo(()=>at(t.length,r,a),[t.length,r,a]),[g,d]=h.useMemo(()=>{if(o===void 0)return[0,0];if(o<0||o>=x.length)return console.warn("<InterchangeStation2024/>, anchor index ".concat(o," is out of bound")),[0,0];{const[p,N]=x[o];return[-p,-N]}},[x,o]),u=h.useRef(null),S=h.useRef([]);h.useEffect(()=>{S.current=S.current.slice(0,t.length)},[t.length]);const _=t.length===2&&r===1&&!!i;return h.useImperativeHandle(m,()=>({target:u.current,children:S.current,getCoordinates:()=>x,getCorrectedBBox:()=>{var N,f;const p=(f=(N=u.current)==null?void 0:N.getBBox())!=null?f:{x:0,y:0,width:0,height:0};return p.y-=O/2,p.height+=O,_?(i==="left"?p.x-=K/2:p.x-=O/2,p.width+=K/2+O/2):(p.x-=O/2,p.width+=O),p},getTranslate:()=>[g,d]}),[x,g,d,u.current,S.current,i]),e.jsxs("g",{ref:u,transform:"translate(".concat(g,",").concat(d,")"),...l,children:[t.map(({style:p},N)=>{const f=fe(p);return e.jsx(f,{stroke:"#aaa",filled:!0,strokeWidth:O,transform:"translate(".concat(x[N][0],",").concat(x[N][1],")")},N)}),_&&e.jsx(ue,{position:i,r:ae/2.9,strokeWidth:K,strokeDasharray:void 0}),t.map(({style:p},N)=>{const f=fe(p);return e.jsx(f,{stroke:"white",filled:!0,strokeWidth:D*2.6,transform:"translate(".concat(x[N][0],",").concat(x[N][1],")")},N)}),_&&e.jsx(ue,{position:i}),t.length&&e.jsx("rect",{fill:"white",x:-12,y:x[0][1],width:24,height:-x[0][1]*2}),t.map(({style:p,...N},f)=>{const j=p==="fmetro"?Qe:ce;return e.jsx(j,{ref:y=>S.current[f]=y,transform:"translate(".concat(x[f][0],",").concat(x[f][1],")"),textClassName:s,...N},f)}),c]})});const F=9,Ce=10*Math.PI/180,ot=F*Math.sin(Ce),it=F*Math.cos(Ce),Ne="M0,".concat(F," A").concat(F,",").concat(F," 0 0,0 ").concat(ot,",-").concat(it);function ct(n){return e.jsxs("g",{...n,children:[e.jsx("circle",{cx:0,cy:0,r:9,stroke:"red",strokeWidth:2,fill:"none"}),e.jsx("path",{d:Ne,stroke:"red",strokeWidth:3,fill:"none"}),e.jsx("path",{d:Ne,stroke:"white",strokeWidth:1,strokeDasharray:"0 1.4 2.3 0",fill:"none"}),e.jsx("path",{d:"M-1,-9 l3.7,2.4 v-4.8z",fill:"red"})]})}const lt=h.forwardRef(function({clockwise:t,anchorAt:s="text",...r},a){const o=s==="circle"?29:0;return e.jsx("g",{ref:a,...r,children:e.jsxs("g",{transform:"translate(".concat(o,",0)"),children:[e.jsx(ct,{transform:"translate(-30,0)scale(".concat(t?-1:1,",1)")}),e.jsxs("g",{textAnchor:"middle",fontWeight:"bold",fill:"red",transform:"translate(0,-2.5)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:12,style:{fontWeight:"bold"},children:"半环站"}),e.jsx("text",{className:"rmg-name__en",y:9,fontSize:4.5,style:{fontWeight:"bold"},children:"Midpoint Station"})]})]})})}),mt=h.memo(function(t){const{stnName:s,onUpdate:r,onEnNameUpdate:a}=t,{zh:o="",en:i=""}=s,c=h.useRef(null);return h.useEffect(()=>{if(c.current){r==null||r(c.current.getBBox());const l=c.current.querySelector("g");l&&(a==null||a(l.getBBox()))}},[JSON.stringify(s),c.current]),e.jsxs("g",{ref:c,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:o}),e.jsx("g",{fontSize:10.5,children:i.split("\\").map((l,m)=>e.jsx("text",{className:"rmg-name__en",dy:16+m*11,children:l},m))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName));function ht(n){const{stnName:t,onUpdate:s,passed:r,...a}=n,{zh:o="",en:i=""}=t,c=h.useRef(null),[l,m]=h.useState({x:0,width:0});return h.useEffect(()=>{if(c.current){const x=c.current.getBBox();m(x),s==null||s(x)}},[JSON.stringify(t)]),!o&&!i?e.jsx(e.Fragment,{}):e.jsxs("g",{fill:r?"#aaa":"#000",...a,children:[e.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[e.jsx("text",{textAnchor:"end",x:l.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:l.width+l.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:c,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:o}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:i})]})]})}function dt(n){const{passed:t,...s}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...s,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),e.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function xt(n){const{passed:t,temporary:s,...r}=n;return e.jsxs("g",{textAnchor:"middle",fill:t?"#aaa":"black",...r,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:9.5,children:"（未开通）"}),e.jsx("text",{dy:9,className:"rmg-name__en",fontSize:3.8,children:"(Under Construction)"}),s&&e.jsx("rect",{x:-19,y:-6,width:38,height:18,fill:"none",stroke:"#aaa",strokeWidth:.5})]})}function gt(n){var p,N,f;const{primaryName:t,secondaryName:s,stationState:r,flipped:a,express:o,underConstruction:i}=n,[c,l]=h.useState({width:0}),[m,x]=h.useState({width:0}),[g,d]=h.useState({x:0,width:-20}),u=j=>{switch(j){case T.PASSED:return"#aaa";case T.CURRENT:return"#f00";case T.FUTURE:return"#000"}},S=(f=(N=(p=t.en)==null?void 0:p.split("\\"))==null?void 0:N.length)!=null?f:1,_={g:{x:0,y:a?17.5:-20-S*14*Math.cos(-45)},StationSecondaryName:{x:(c.width+g.width/2+10)*(a?-1:1),y:2+5*(S-1)},ExpressTag:{x:(c.width+g.width+20+35)*(a?-1:1),y:2+5*(S-1)},UnderConstructionTag:{x:(m.width+5+20)*(a?-1:1),y:c.y+c.height-14}};return e.jsxs("g",{textAnchor:a?"end":"start",fill:u(r),transform:"translate(".concat(_.g.x,",").concat(_.g.y,")rotate(-45)"),children:[e.jsx(mt,{stnName:t,onUpdate:l,onEnNameUpdate:x}),s&&e.jsx(ht,{stnName:s,onUpdate:d,passed:r===T.PASSED,transform:"translate(".concat(_.StationSecondaryName.x,",").concat(_.StationSecondaryName.y,")")}),o&&e.jsx(dt,{passed:r===T.PASSED,transform:"translate(".concat(_.ExpressTag.x,",").concat(_.ExpressTag.y,")")}),i&&e.jsx(xt,{passed:r===T.PASSED,temporary:i==="temp",transform:"translate(".concat(_.UnderConstructionTag.x,",").concat(_.UnderConstructionTag.y,")")})]})}function ut(n){var b,k,z,E,I,W,le,me,he;const{stnId:t,stnState:s,stnY:r}=n,{theme:a,line_name:o,line_num:i,spanLineNum:c,stn_list:l,loop:m,loop_info:{midpoint_station:x,clockwise:g}}=B(Pe=>Pe.param),d=l[t],u=x===t,[S,_]=h.useState({height:0}),p=h.useRef(null);h.useEffect(()=>{p.current&&_(p.current.getBBox())},[p.current,r,d.localisedName,d.localisedSecondaryName,d.services]);const N=d.parents.length===2||d.children.length===2,f=r>0||d.parents.indexOf(((k=(b=d.branch)==null?void 0:b.left)==null?void 0:k[1])||"")===1||d.children.indexOf(((E=(z=d.branch)==null?void 0:z.right)==null?void 0:E[1])||"")===1?180:0,j=(le=(W=(I=d.localisedName.en)==null?void 0:I.split("\\"))==null?void 0:W.length)!=null?le:1,y=N?f===180?16+(j-1)*12*Math.cos(-45):-9:f===180?-6:(25+(j-1)*15)*Math.cos(-45),v=r>0?S.height+23:-S.height-23;return e.jsxs(e.Fragment,{children:[e.jsx(ft,{intInfos:N?[{theme:[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:o},...(me=d.transfer.groups[0].lines)!=null?me:[]]:(he=d.transfer.groups[0].lines)!=null?he:[],stnState:m?T.FUTURE:s,tickRotation:f,spanDigits:c}),e.jsx(ce,{lineNum:i,stnNum:d.num,strokeColour:a[2],textClassName:"rmg-name__zh",passed:s===-1,alwaysShowColouredBorder:m,bolderBorder:!0,useSameScale:!0}),e.jsx("g",{ref:p,transform:"translate(".concat(-y,",0)"),children:e.jsx(gt,{primaryName:d.localisedName,secondaryName:d.localisedSecondaryName,stationState:s,flipped:f===180,express:d.services.includes(Le.express),underConstruction:d.underConstruction})}),u&&e.jsx(lt,{transform:"translate(0,".concat(v,")"),clockwise:g,anchorAt:r>0?"text":"circle"})]})}const ft=n=>e.jsxs(e.Fragment,{children:[e.jsx(Nt,{strokeWidth:4,...n}),e.jsx(pt,{transform:"translate(0,".concat(n.tickRotation===180?-47:23,")"),...n})]}),Nt=n=>{const{intInfos:t,stnState:s,tickRotation:r,spanDigits:a,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>{var l;return e.jsx("use",{xlinkHref:"#inttick",stroke:s===-1?"#aaa":(l=i.theme)==null?void 0:l[2],transform:"translate(".concat(-2*(t.length-1)+4*c,",0)rotate(").concat(r===180?180:0,")")},c)})})},pt=n=>{const{intInfos:t,tickRotation:s,stnState:r,spanDigits:a,...o}=n;return e.jsx("g",{...o,children:t.map((i,c)=>{var l,m,x,g;return e.jsx("g",{transform:"translate(0,".concat(c*28*(s===180?-1:1),")"),children:e.jsx(ie,{zhName:i.name[0],enName:i.name[1],foregroundColour:(m=(l=i.theme)==null?void 0:l[3])!=null?m:H.white,backgroundColour:(g=(x=i.theme)==null?void 0:x[2])!=null?g:"#aaaaaa",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",passed:r===-1,spanDigits:a})},c)})})};function Te(n){const{xs:t,ys:s,stnStates:r}=n,{stn_list:a,loop:o}=B(l=>l.param),{branches:i}=B(l=>l.helper),c=o?i[0].slice(1,-1):Object.keys(a);return e.jsx("g",{id:"stn_icons",children:c.filter(l=>!["linestart","lineend"].includes(l)).map(l=>e.jsx("g",{style:{transform:"translate(".concat(t[l],"px,").concat(s[l],"px)")},children:e.jsx(ut,{stnId:l,stnState:r[l],stnY:s[l]})},l))})}const pe=(n,t)=>n[t].parents.length===2||n[t].children.length===2?.25:0,St=(n,t,s)=>{const r=R("linestart","lineend",t);if(r.nodes.includes(n))return R(r.nodes[1],n,t).len;{const a=s.filter(m=>m.includes(n))[0];let o=n;for(;!r.nodes.includes(o);)o=a[a.indexOf(o)-1];let i=n;for(;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];const c=o==="linestart",l=i==="lineend";if(a.toString()===s[0].toString()){const m=[];return!c&&!l?(m[0]=R(r.nodes[1],o,t).len,m[1]=R(o,i,t).len,m[2]=R(o,n,t).len,m[3]=R(n,i,t).len):c?(m[0]=0,m[1]=R(r.nodes[1],i,t).len,m[2]=R(a[1],n,t).len,m[3]=R(n,i,t).len):(m[0]=R(r.nodes[1],o,t).len,m[1]=R(o,r.nodes.slice(-2)[0],t).len,m[2]=R(o,n,t).len,m[3]=R(n,a.slice(-2)[0],t).len),m[0]+m[2]*m[1]/(m[2]+m[3])}else if(!c&&!l){const m=[];return m[0]=R(r.nodes[1],o,t).len,m[1]=R(o,i,t).len,m[2]=R(o,n,t).len,m[3]=R(n,i,t).len,m[0]+m[2]*m[1]/(m[2]+m[3])}else return c?R(r.nodes[1],i,t).len-R(n,i,t).len:R(r.nodes[1],o,t).len+R(o,n,t).len}},jt=()=>{const{branches:n,routes:t,depsStr:s}=B(z=>z.helper),{svgWidth:r,svg_height:a,y_pc:o,padding:i,branchSpacingPct:c,direction:l,line_name:m,spanLineNum:x,current_stn_idx:g,stn_list:d}=B(z=>z.param),u=Fe(d,pe,pe),S=h.useMemo(()=>(console.log("computing x shares"),Object.keys(d).reduce((z,E)=>({...z,[E]:St(E,u,n)}),{})),[n.toString(),JSON.stringify(u)]),_=R("linestart","lineend",u),p=R(_.nodes[1],_.nodes.slice(-2)[0],u),N=l===$.right?[r[C.RailMap]*i/100+65,r[C.RailMap]*(1-i/100)-20]:[r[C.RailMap]*i/100,r[C.RailMap]*(1-i/100)-65],f=Object.keys(S).reduce((z,E)=>({...z,[E]:N[0]+S[E]/p.len*(N[1]-N[0])}),{}),j=h.useMemo(()=>(console.log("computing y shares"),Object.keys(d).reduce((z,E)=>{if(n[0].includes(E))return{...z,[E]:0};{const I=n.slice(1).filter(W=>W.includes(E))[0];return{...z,[E]:d[I[0]].children.indexOf(I[1])?-2:2}}},{})),[s]),y=Object.keys(j).reduce((z,E)=>({...z,[E]:-j[E]*c*a/200}),{}),v=h.useMemo(()=>Ze(g,t,l),[g,l,t.toString()]),b=n.map(z=>Ge(z,v)).reduce((z,E)=>(z.main.push(E.main),z.pass.push(E.pass),z),{main:[],pass:[]}),k=Object.keys(b).reduce((z,E)=>({...z,[E]:b[E].map(I=>yt(I,f,y))}),{});return e.jsxs("g",{id:"main",style:{"--y-percentage":o,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx(_t,{paths:k}),e.jsx(Te,{xs:f,ys:y,stnStates:v}),e.jsx("g",{id:"line_name",style:{"--translate-x":l===$.right?"".concat(N[0]-65,"px"):"".concat(N[1]+65,"px")},children:e.jsx(ie,{zhName:m[0],enName:m[1],foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:x})})]})},_t=h.memo(function(t){return e.jsxs("g",{fill:"none",strokeWidth:4,children:[e.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((s,r)=>e.jsx("path",{d:s},r))}),e.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((s,r)=>e.jsx("path",{d:s},r))})]})},(n,t)=>JSON.stringify(n.paths)===JSON.stringify(t.paths)),yt=(n,t,s)=>{let r;const a=[];return n.forEach(o=>{const i=t[o],c=s[o];if(!r&&r!==0){r=c,a.push("M ".concat(i,",").concat(c));return}c===0?(c<r&&a.push("H ".concat(i-40),"a 40,40 0 0,0 40,-40","V ".concat(c)),c>r&&a.push("H ".concat(i-40),"a 40,40 0 0,1 40,40","V ".concat(c))):(c<r&&a.push("V ".concat(c+40),"a 40,40 0 0,1 40,-40","H ".concat(i)),c>r&&a.push("V ".concat(c-40),"a 40,40 0 0,0 40,40","H ".concat(i))),a.push("H ".concat(i)),r=c}),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},Ae=150;function J(n){return e.jsx("path",{d:"M60,60 L0,0 L60,-60 H90 L40,-10 H".concat(Ae," V10 H40 L90,60z"),fill:"black",...n})}function zt(n){const{destIds:t,textAnchor:s,...r}=n,a=B(m=>m.param.direction),o=B(m=>m.param.stn_list),i=t.map(m=>{var x,g;return(g=(x=o[m].localisedName.zh)==null?void 0:x.length)!=null?g:0}),c=Math.min(...i),l=c>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(c-1):0;return e.jsxs("g",{textAnchor:s,...r,children:[t.map((m,x)=>{var u;const g=i[x]>i[1-x],d=!Xe()&&s==="end"&&!g;return e.jsxs(h.Fragment,{children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,x:a===$.left?0:-75,y:-21+42*x,letterSpacing:g?"0em":"".concat(l,"em"),dx:d?"".concat(l,"em"):"0em",children:o[m].localisedName.zh}),e.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:a===$.left?0:-75,y:-1+42*x,children:"Towards "+((u=o[m].localisedName.en)==null?void 0:u.replace("\\"," "))})]},m)}),e.jsx("text",{className:"rmg-name__zh",fontSize:28,x:a===$.left?25*(Math.max(...i)+1):0,y:5,children:"方向"})]})}const $t=(n,t,s,r)=>{const i=n*(1-2*t/100)*(s-1)/s-r,c=n-i;return[c/2,n-c/2]},wt=(n,t,s)=>{const r=Math.min(...Object.values(n)),a=Math.max(...Object.values(n)),o=Math.min(...Object.values(t)),c=Math.max(...Object.values(t))-o,l=c/2;return"M".concat(a,",").concat(o," H").concat(r," h-").concat(s/2," a").concat(l,",").concat(l," 0 0,0 0,").concat(c," H").concat(a," h").concat(s/2," a").concat(l,",").concat(l," 0 0,0 0,-").concat(c,"Z")},Bt=(n,t,s,r)=>{const a=n.indexOf(s),o=n.indexOf(r!=null?r:s);let i;return o<0?i=n:t?i=a<=o?[...n.slice(0,a+1),...n.slice(o)]:n.slice(o,a+1):i=a<o?n.slice(a,o+1):[...n.slice(a),...n.slice(0,o+1)],n.reduce((c,l,m)=>a===m?{...c,[l]:T.CURRENT}:i.includes(l)?{...c,[l]:T.FUTURE}:{...c,[l]:T.PASSED},{})},Se=6;function Et({currentStationX:n,currentStationY:t,stationGap:s,loopClockwise:r}){const a=t>0?r?-1:1:r?1:-1,o=(s/3-Se)*a,i=n+o+Se*a,c=(t-12)*-a;return e.jsx("g",{transform:"scale(1,".concat(-a,")"),children:e.jsx("path",{d:"M".concat(i,",").concat(c," h").concat(o),strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)"})})}function je({clockwise:n,...t}){return e.jsx("g",{...t,children:e.jsxs("g",{textAnchor:"middle",transform:"translate(0,-4)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:16,children:n?"内环":"外环"}),e.jsx("text",{className:"rmg-name__en",y:13,fontSize:9,children:n?"Inner Circle":"Outer Circle"})]})})}const Ie=2/3,vt=2-Ie,Rt=25*Math.PI/180,bt=Math.asin(Math.sin(35*Math.PI/180)/2);function kt({cxLeft:n,cxRight:t,yGap:s,clockwise:r}){const a=s/2,o=a*(r?Ie:vt),i=r?Rt:bt,c=o*Math.cos(i),l=r?1:-1,m=r?1:0,x=o*Math.sin(i)*l,g=2*x,d={rotate:r?"-4deg":"2deg"};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(".concat(n,",0)"),children:[e.jsx("path",{d:"M".concat(-c,",").concat(x," a").concat(o,",").concat(o," 0 0,").concat(m," 0,").concat(-g),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:d}),e.jsx(je,{transform:"translate(".concat(r?0:-2*a,",0)"),clockwise:r})]}),e.jsxs("g",{transform:"translate(".concat(t,",0)"),children:[e.jsx("path",{d:"M".concat(c,",").concat(-x," a").concat(o,",").concat(o," 0 0,").concat(m," 0,").concat(g),fill:"none",strokeWidth:4,stroke:"black",markerEnd:"url(#loop_arrow)",style:d}),e.jsx(je,{transform:"translate(".concat(r?0:2*a,",0)"),clockwise:r})]})]})}function Ct(){const{branches:n}=B(j=>j.helper),{svgWidth:t,svg_height:s,y_pc:r,padding:a,branchSpacingPct:o,current_stn_idx:i,loop_info:{midpoint_station:c,clockwise:l}}=B(j=>j.param),m=n[0].slice(1,-1),x=Math.ceil(m.length/2),g=h.useMemo(()=>(console.log("computing x shares"),m.reduce((j,y,v,b)=>{let k;return v<x?k=x-v-1:(k=v-x,b.length&1&&(k+=.5)),{...j,[y]:k}},{})),[m.toString()]),d=o*s*2/100,u=$t(t[C.RailMap],a,x,d),S=(u[1]-u[0])/(x-1),_=Object.keys(g).reduce((j,y)=>({...j,[y]:u[0]+g[y]*S}),{}),p=h.useMemo(()=>(console.log("computing y shares"),m.reduce((j,y,v)=>({...j,[y]:v<x?1:-1}),{})),[m.toString()]),N=Object.keys(p).reduce((j,y)=>({...j,[y]:-p[y]*d/2}),{}),f=Bt(m,l!=null?l:!1,i,c);return e.jsxs("g",{id:"main",style:{"--y-percentage":r,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e.jsx("path",{d:wt(_,N,S),fill:"none",strokeWidth:6,stroke:"var(--rmg-theme-colour)"}),e.jsx(Te,{xs:_,ys:N,stnStates:f}),e.jsx(Et,{currentStationX:_[i],currentStationY:N[i],stationGap:S,loopClockwise:l}),e.jsx(kt,{cxLeft:u[0]-S/2,cxRight:u[1]+S/2,yGap:d,clockwise:l})]})}const _e=C.RailMap,Tt=()=>{const{canvasScale:n}=B(u=>u.app),{svgWidth:t,svg_height:s,direction:r,psd_num:a,info_panel_type:o,notesGZMTR:i,current_stn_idx:c,stn_list:l,theme:m,loop:x}=B(u=>u.param),g=t[_e],d=l[c];return e.jsxs(we,{type:_e,svgWidth:g,svgHeight:s,canvasScale:n,theme:m,children:[e.jsx(At,{}),e.jsx(Be,{variant:o,isShowLight:o===w.gz2otis,isShowPSD:o===w.gz2otis&&a}),!x&&(r===$.left&&d.parents.includes("linestart")||r===$.right&&d.children.includes("lineend"))?e.jsx(Dt,{}):e.jsxs(e.Fragment,{children:[x?e.jsx(Ct,{}):e.jsx(jt,{}),!x&&e.jsx(It,{}),i==null?void 0:i.map((u,S)=>e.jsx(Wt,{note:u},S))]}),o===w.gz2otis&&e.jsx("line",{x2:g,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},At=h.memo(function(){return e.jsxs("defs",{children:[e.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),e.jsx("marker",{id:"loop_arrow",refX:.05,refY:.5,orient:"auto",children:e.jsx("path",{d:"M0,0V2L2,0z",fill:"black"})})]})}),It=()=>{const{routes:n}=B(c=>c.helper),{direction:t,direction_gz_x:s,direction_gz_y:r,current_stn_idx:a}=B(c=>c.param),o=h.useMemo(()=>[...new Set(n.reduce((c,l)=>l.includes(a)?c.concat(l.filter(m=>!["linestart","lineend"].includes(m)).slice(t===$.left?0:-1)[0]):c,[]).filter(c=>c!==a))],[a,t,n.toString()]),i={textAnchor:t===$.left?"start":"end",transform:"translate(".concat(t===$.left?65:-65,",-5)"),destIds:o};return e.jsxs("g",{id:"direction_gz",style:{"--x-percentage":s,"--y-percentage":r},children:[e.jsx(J,{transform:"scale(0.35)rotate(".concat(t===$.left?0:180,")")}),o.length!==2?e.jsx(Mt,{...i}):e.jsx(zt,{...i})]})},Mt=n=>{const{destIds:t,...s}=n,r=B(a=>a.param.stn_list);return e.jsxs("g",{...s,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map(a=>r[a].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(a=>{var o;return(o=r[a].localisedName.en)==null?void 0:o.replace("\\"," ")}).join("/")})]})},Dt=h.memo(function(){return e.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),e.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),e.jsxs("g",{strokeWidth:8,stroke:"#000",children:[e.jsx("path",{d:"M -160,68 h -160"}),e.jsx("path",{d:"M 160,68 h 160"})]})]})}),Wt=h.memo(function(t){const s=h.useRef(null),[r,a]=h.useState({width:0,height:0,y:0});return h.useEffect(()=>{s.current&&a(s.current.getBBox())},[t.note[0],t.note[1]]),e.jsxs("g",{className:"note-box",style:{"--x-percentage":t.note[2],"--y-percentage":t.note[3]},children:[t.note[4]&&e.jsx("rect",{height:r.height+4,width:r.width+4,x:-2,y:r.y-2,fill:"none",stroke:"black",strokeWidth:.5}),e.jsxs("g",{ref:s,children:[e.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((o,i)=>e.jsx("text",{className:"rmg-name__zh",y:i*18,children:o},i))}),e.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((o,i)=>{var c;return e.jsx("text",{className:"rmg-name__en",y:i*11,textLength:i<(((c=t.note[1].match(/\n/g))==null?void 0:c.length)||0)?r.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:o},i)})})]})]})},(n,t)=>n.note.toString()===t.note.toString()),Q=92,Ot=n=>{switch(n){case 2:return .2;case 3:return .1;default:return 0}},Ht=h.memo(function(t){var l,m,x;const{stnName:s,bold:r,sparse:a,onUpdate:o}=t,i=h.useRef(null),c=a?Ot((l=s.zh)==null?void 0:l.length):0;return h.useEffect(()=>{if(i.current&&o){const g=i.current.getBBox();o({...g,x:g.x+c*Q/2,width:g.width-c*Q})}},[i.current,JSON.stringify(s),r,a]),e.jsxs("g",{ref:i,fontWeight:r?"bold":"normal",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:Q,x:c/2+"em",letterSpacing:c+"em",children:s.zh}),e.jsx("g",{fontSize:40,children:(x=(m=s.en)==null?void 0:m.split("\\"))==null?void 0:x.map((g,d)=>e.jsx("text",{className:"rmg-name__en",dy:72+d*42,children:g},d))})]})},(n,t)=>JSON.stringify(n.stnName)===JSON.stringify(t.stnName)),Pt=n=>{const{secondaryName:t,transform:s}=n,r=h.useRef(null),[a,o]=h.useState({x:0,width:0});return h.useEffect(()=>{r.current&&o(r.current.getBBox())},[t.toString()]),e.jsxs("g",{transform:s,children:[e.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[e.jsx("text",{textAnchor:"end",x:a.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:a.width+a.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:r,textAnchor:"middle",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t.zh}),e.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t.en})]})]})},U=55,Me=18.5*1.4,De=30,Lt=De*4,We=.82,Oe=.25,ye=.4,He=(n,t)=>{const{stn_list:s,current_stn_idx:r,direction:a,loop:o,loop_info:{midpoint_station:i,clockwise:c}}=n;return o?Zt(t[0].slice(1,-1),s,r,i,c):Ft(s,r,a)},Ft=(n,t,s)=>{const r=s==="l"?"parents":"children";return{nextStations:n[t][r].map(o=>n[o].underConstruction?n[o][r]:o).flat()}},Zt=(n,t,s,r,a)=>{const o=n.filter(d=>!t[d].underConstruction),i=a?o.toReversed():o,c=i.indexOf(s),l=[...i,...i].slice(c+1),m=[l[0]],x=l.slice(1).reduce((d,u)=>{var S;return(S=t[u].transfer.groups[0].lines)!=null&&S.length?[...d,u]:t[u].loop_pivot?[...d,u]:d},[]),g=r?[...x.slice(0,2),r]:x.slice(0,3);return{nextStations:m,viaStations:g}},Gt=h.forwardRef(function({stationInfo:t,...s},r){var m,x,g,d,u,S,_,p;const{localisedName:a,transfer:{groups:[{lines:o}]}}=t,[i,c]=h.useState({width:0}),l=h.useRef(null);return h.useEffect(()=>{l.current&&c(l.current.getBBox())},[l.current,JSON.stringify(a)]),e.jsxs("g",{ref:r,...s,children:[e.jsxs("g",{ref:l,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:a.zh}),(x=(m=a.en)==null?void 0:m.split("\\"))==null?void 0:x.map((N,f)=>e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19+12*f,children:N},f))]}),e.jsx("g",{transform:"translate(".concat(i.width+2,",7)"),children:(o==null?void 0:o.length)&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M0,0 H8",stroke:(d=(g=o[0].theme)==null?void 0:g[2])!=null?d:"#aaa",strokeWidth:3.5}),e.jsx(ie,{zhName:o[0].name[0],enName:o[0].name[1],backgroundColour:(S=(u=o[0].theme)==null?void 0:u[2])!=null?S:"#aaa",foregroundColour:(p=(_=o[0].theme)==null?void 0:_[3])!=null?p:H.white,zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",spanDigits:!0,transform:"translate(27,-8.5)scale(0.75)"})]})})]})});function Xt({viaStations:n,stationList:t}){const s=h.useRef([]),[r,a]=h.useState([]);h.useEffect(()=>{s.current=[]},[n,t]),h.useEffect(()=>{a(s.current.map(i=>{var c,l;return(l=(c=i==null?void 0:i.getBBox())==null?void 0:c.height)!=null?l:0}))},[s.current]);const o=h.useCallback(i=>r.slice(0,i).reduce((c,l)=>c+l+4,0),[r]);return e.jsx(e.Fragment,{children:n.map((i,c)=>e.jsx(Gt,{ref:l=>s.current[c]=l,stationInfo:t[i],transform:"translate(0,".concat(o(c),")")},i))})}const ee=44,te=25;function Ut({nameBBox:n}){const t=B(f=>f.param),{svg_height:s,svgWidth:r,direction:a,current_stn_idx:o,stn_list:i}=t,{branches:c}=B(f=>f.helper),l=r[C.RunIn],{nextStations:[m],viaStations:x}=He(t,c),{localisedName:{en:g=""},localisedSecondaryName:d}=i[o],{localisedName:{zh:u="",en:S=""}}=i[m],_=S.split("\\").length,p=(l-n.width)/2,N={next:{x:80},nextName:{x:80+ee*1.7},via:{dy:75+25*(_-1)},arrow:{x:a===$.left?(115+50*(.5+u.length)+p)/2-20:((l+n.width)/2+(l*We-Lt/2))/2+Ae*ye/2,y:.5*s-(g.split("\\").length-2)*18-(d?58/2:0),rotate:a===$.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(0,".concat(s/2+5-N.via.dy,")"),children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(N.next.x,",0)"),children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ee,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:te,dy:40,children:"Next"})]}),e.jsxs("g",{transform:"translate(0,".concat(N.via.dy,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:20,children:"途经"}),e.jsx("text",{className:"rmg-name__en",fontSize:12,dy:19,children:"Via"})]})]}),e.jsxs("g",{textAnchor:"start",transform:"translate(".concat(N.nextName.x,",0)"),children:[e.jsxs("g",{fontWeight:"bold",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ee,children:u}),e.jsx("g",{fontSize:te,children:S.split("\\").map((f,j)=>e.jsx("text",{className:"rmg-name__en",dy:40+j*te,children:f},j))})]}),x&&e.jsx("g",{transform:"translate(0,".concat(N.via.dy,")"),children:e.jsx(Xt,{viaStations:x,stationList:i})})]})]}),e.jsx(J,{transform:"translate(".concat(N.arrow.x,",").concat(N.arrow.y,")scale(").concat(ye,")rotate(").concat(N.arrow.rotate,")")})]})}function Vt({secName:n,...t}){const{zh:s,en:r}=n,a=h.useRef(null),[o,i]=h.useState({x:0,width:0});return h.useEffect(()=>{a.current&&i(a.current.getBBox())},[s,r]),e.jsxs("g",{...t,children:[e.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[e.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),e.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),e.jsxs("g",{ref:a,children:[e.jsx("text",{className:"rmg-name__zh",fontSize:18,children:s}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:r})]})]})}const G=35,ne=17;function Yt({nextId:n,nameBBox:t,ignoreNumWidth:s}){const{svgWidth:r,svg_height:a,direction:o}=B(f=>f.param),i=B(f=>f.param.stn_list[n]),{localisedName:c,localisedSecondaryName:l}=i,{zh:m="",en:x=""}=c,g=r[C.RunIn],[d,u]=h.useState({width:0}),S=h.useRef(null);h.useEffect(()=>{S.current&&u(S.current.getBBox())},[m,x]);const _=m.length,p=(g-t.width)/2,N={next:{x:o===$.left?80:g-45-d.width-G*(_<=2?2:1.5)},nextName:{x:o===$.left?80+G*(_<=2?2:1.5):g-45-d.width},arrow:{x:o===$.left?(115+35*((_<=2?1:.5)+_)+p)/2-20:(g-45-d.width-(_<=2?105:35*2.5)+p+t.width+(s?0:U+Me))/2+20,y:a/2-30,rotate:o===$.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsxs("g",{transform:"translate(0,".concat(a/2-40,")"),children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(N.next.x,",0)"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:G,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:ne,dy:30,children:"Next"})]}),e.jsxs("g",{textAnchor:"start",ref:S,transform:"translate(".concat(N.nextName.x,",0)"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:G,children:m}),e.jsx("g",{fontSize:ne,children:x.split("\\").map((f,j)=>e.jsx("text",{className:"rmg-name__en",dy:30+j*ne,children:f},j))})]}),l&&e.jsx("g",{textAnchor:"middle",transform:"translate(".concat(N.nextName.x,",0)"),children:e.jsx(Vt,{secName:l,transform:"translate(".concat(d.width/2,",").concat(30+x.split("\\").length*17+5,")")})})]}),e.jsx(J,{transform:"translate(".concat(N.arrow.x,",").concat(N.arrow.y,")scale(").concat(Oe,")rotate(").concat(N.arrow.rotate,")")})]})}const Jt=()=>{var v,b,k;const n=B(z=>z.param),{svg_height:t,svgWidth:s,theme:r,direction:a,info_panel_type:o,line_num:i,current_stn_idx:c,stn_list:l}=n,{branches:m}=B(z=>z.helper),x=l[c],{localisedName:g,localisedSecondaryName:d}=x,[u,S]=h.useState({width:0}),_=(k=(b=(v=g.en)==null?void 0:v.split("\\"))==null?void 0:b.length)!=null?k:1,{nextStations:p}=He(n,m),N=[w.gz7w,w.gz11].includes(o),f={name:"translate(".concat((a===$.left?1:-1)*s[C.RunIn]/4,",45)"),next:"translate(".concat((a===$.left?1:-1)*s[C.RunIn]/10,",45)")},j=(s[C.RunIn]+u.width)/2+U,y={nameGroup:{x:s.runin/2,y:.5*t-50-(_-1)*18-(d?29:0)},secondaryName:{x:0,y:70+_*36},stationNumber:{x:j,y:.5*t-30-(_-1)*18-(d?58/2:0)},stationNumberPost2022:{x:a===$.left?j:(s[C.RunIn]-u.width)/2-U,y:.5*t-(_-2)*18-(d?58/2:0)}};return e.jsxs("g",{children:[e.jsxs("g",{transform:o===w.gz2otis?f.name:"",children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(y.nameGroup.x,",").concat(y.nameGroup.y,")"),children:[e.jsx(Ht,{stnName:g,bold:o===w.gz11,sparse:o===w.gz11,onUpdate:S}),d&&e.jsx(Pt,{secondaryName:d,transform:"translate(".concat(y.secondaryName.x,",").concat(y.secondaryName.y,")")})]}),e.jsx(ce,{lineNum:i,stnNum:x.num,strokeColour:r[2],textClassName:"rmg-name__zh",transform:N?"translate(".concat(y.stationNumberPost2022.x,",").concat(y.stationNumberPost2022.y,")"):"translate(".concat(y.stationNumber.x,",").concat(y.stationNumber.y,")"),size:"lg"})]}),o===w.gz11?e.jsx(Ut,{nameBBox:u}):e.jsx("g",{transform:o===w.gz2otis?f.next:"",children:!p||p.includes("linestart")||p.includes("lineend")?e.jsx(e.Fragment,{}):p.length===1?e.jsx(Yt,{nextId:p[0],nameBBox:u,ignoreNumWidth:N}):e.jsx(qt,{nextIds:p,nameBBox:u,ignoreNumWidth:N})})]})},ze=27,se=13,$e=110,qt=n=>{const{nextIds:t,nameBBox:s,ignoreNumWidth:r}=n,{routes:a}=B(f=>f.helper),{svgWidth:o,svg_height:i,direction:c,stn_list:l}=B(f=>f.param),m=o[C.RunIn],x=t.map(f=>l[f].localisedName),[g,d]=h.useState({width:0}),u=h.useRef([]);h.useEffect(()=>{d(f=>({...f,width:0})),u.current.forEach(f=>{const j=f==null?void 0:f.getBBox();d(y=>j?y.width>j.width?y:j:y)})},[x.toString()]);const S=n.nextIds.map(f=>a.reduce((j,y)=>y.includes(f)?j.concat(y.filter(v=>!["linestart","lineend"].includes(v)).slice(c===$.left?0:-1)[0]):j,[])),_=Math.max(...x.map(f=>{var j,y;return(y=(j=f.zh)==null?void 0:j.length)!=null?y:0})),p=(m-s.width)/2,N={next:{x:c===$.left?72:m-45-g.width-41},nextName:{x:c===$.left?113:m-45-g.width},arrow:{x:c===$.left?(99+27*(1+_)+p)/2-20:(m-45-g.width-41-27+p+n.nameBBox.width+(r?0:U+Me))/2+20,y:i/2-30,rotate:c===$.left?0:180}};return e.jsxs(e.Fragment,{children:[e.jsx("g",{transform:"translate(0,".concat(i/2-70,")"),children:x.map((f,j)=>{var y,v;return e.jsxs(h.Fragment,{children:[e.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(N.next.x,",").concat($e*j,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ze,children:"下站"}),e.jsx("text",{className:"rmg-name__en",fontSize:se,y:22,children:"Next"})]}),e.jsxs("g",{ref:b=>u.current[j]=b,textAnchor:"start",transform:"translate(".concat(N.nextName.x,",").concat($e*j,")"),children:[e.jsx("text",{className:"rmg-name__zh",fontSize:ze,children:f.zh}),(v=(y=f.en)==null?void 0:y.split("\\"))==null?void 0:v.map((b,k)=>e.jsx("text",{className:"rmg-name__en",fontSize:se,y:22+k*se,children:b},k)),e.jsx("text",{className:"rmg-name__zh",fontSize:18.5,y:-35,children:S[j].map(b=>l[b].localisedName.zh).join("/")+"方向"}),e.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+S[j].map(b=>l[b].localisedName.en).join("/").replace("\\"," ")})]})]},j)})}),e.jsx(J,{transform:"translate(".concat(N.arrow.x,",").concat(N.arrow.y,")scale(").concat(Oe,")rotate(").concat(N.arrow.rotate,")")})]})};function Kt(n){const{num:t,...s}=n;return e.jsxs("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...s,children:[e.jsx("circle",{cx:0,cy:0,r:33,fill:"var(--rmg-theme-colour)"}),e.jsx("text",{className:"rmg-name__en",fontSize:41,dy:-9,children:t}),e.jsx("text",{className:"rmg-name__zh",fontSize:14,dy:11,children:"站台"}),e.jsx("text",{className:"rmg-name__en",fontSize:10,dy:24,children:"Platform"})]})}function Qt(n){const{canvasType:t}=n,{svgWidth:s,svg_height:r}=B(a=>a.param);return e.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[e.jsx("line",{y2:r,transform:"translate(".concat(s[t]/2,",0)")}),e.jsx("line",{x2:s[t],transform:"translate(0,90)"})]})}const M=De;function en({coachNumber:n,...t}){return e.jsxs("g",{...t,children:[e.jsx("path",{d:"M-".concat(M,",-").concat(M," a").concat(M,",").concat(M," 0 0,0 0,").concat(2*M," h").concat(2*M," a").concat(M,",").concat(M,", 0 0,0 0,-").concat(2*M,"Z"),fill:"whitesmoke",stroke:"lightgrey"}),e.jsxs("g",{textAnchor:"middle",transform:"translate(-20,-10)",children:[e.jsx("text",{className:"rmg-name__zh",fontSize:25,children:"车厢"}),e.jsx("text",{className:"rmg-name__en",fontSize:20,y:28,children:"Car"})]}),e.jsx("g",{textAnchor:"middle",transform:"translate(30,0)",children:e.jsx("text",{className:"rmg-name__zh",fontSize:36,children:n})})]})}const re=C.RunIn;function tn(){const{canvasScale:n}=B(u=>u.app),{svgWidth:t,svg_height:s,direction:r,info_panel_type:a,platform_num:o,psd_num:i,coachNum:c,theme:l}=B(u=>u.param),m=t[re],x=[w.gz7w,w.gz11].includes(a),g=x?s-78:s/2-30,d={platform:"translate(".concat(r===$.left?50:-50,",45)")};return e.jsxs(we,{type:re,svgWidth:m,svgHeight:s,canvasScale:n,theme:l,children:[e.jsx(Be,{variant:a,isShowLight:a!==w.gz2otis,isShowPSD:a!==w.gz2otis&&i}),e.jsx("g",{transform:a===w.gz2otis?d.platform:"",children:e.jsx(Kt,{num:o,style:{"--translate-x":"".concat(r===$.left||a===w.gz11?m-100:100,"px"),"--translate-y":g+"px","--scale":x?1.15:1,transform:"translate(var(--translate-x, 100px), var(--translate-y))scale(var(--scale))"}})}),x&&e.jsx(en,{coachNumber:c,transform:"translate(".concat(m*We,",").concat(s*.58,")")}),e.jsx(Jt,{}),a===w.gz2otis&&e.jsx(Qt,{canvasType:re})]})}const ln={runin:e.jsx(tn,{}),railmap:e.jsx(Tt,{})};export{ln as default};
