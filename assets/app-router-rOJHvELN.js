const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BiBEROE9.js","assets/chakra-jT2-teuD.js","assets/react-BNX4K-US.js","assets/index-HyGScCuj.js","assets/index-CCCCWinQ.css","assets/svg-wrapper-h0h12Ph0.js","assets/share-BVgUIVfG.js","assets/mtr-CL9fu2Bp.js","assets/index-Bqy2VowE.js","assets/param-selector-Co1Y1OOn.js","assets/index-BxDaf5t-.js","assets/index-DHuP8ILq.js","assets/station-ag-grid-Bc0gTPwo.js","assets/ag-grid-react-CzfEcuxL.js","assets/ag-grid-community-BXPI1aQR.js"])))=>i.map(i=>d[i]);
import{j as m,ap as An,h as Pe,B as ke,al as ve,a2 as Ne,ao as Oe,N as lt,aq as Et,t as oe,D as Ie,aj as Ke,M as Xe,ak as Je,U as ut,V as ft,J as Qe,K as et,L as tt,O as nt,ab as sn,ar as En,as as On,at as Rn,au as Dt,av as zn,aw as Pn,ax as gt,ay as Tn,az as Bn,R as Ve,aA as an,a as Nn,aB as In}from"./chakra-jT2-teuD.js";import{a as J,u as le,m as on,c as at,g as Mn,s as Dn}from"./react-BNX4K-US.js";import{_ as Fe,l as Ee,r as de,E as we,u as Q,R as pt,a as ln,s as Ln,b as cn,c as Fn,D as Se,d as ue,e as X,f as je,M as Un,F as St,g as De,h as Be,i as ct,j as xt,o as Ot,k as Wn,m as Rt,S as dt,n as Lt,B as ht,p as zt,q as Pt,t as Zn,v as Gn,w as wt,x as kt,y as Hn,z as Ft,A as Vn,C as $n,G as dn,H as hn,I as Yn,J as qn,K as Kn,P as Ut,L as Xn,N as Wt,O as Jn,Q as Qn,T as er,U as tr,V as Zt,W as nr,X as rr,Y as sr,Z as ir,$ as Gt,a0 as ar,a1 as or,a2 as lr,a3 as bt,a4 as cr,a5 as dr,a6 as un,a7 as Le,a8 as Me,a9 as hr,aa as ur,ab as fr,ac as Ue,ad as qe,ae as fn,af as pr,ag as Ct,ah as pn,ai as jt,aj as mr,ak as gr,al as br,am as _r,an as vr,ao as yr,ap as Sr,aq as xr,ar as wr,as as kr,at as mn,au as Cr,av as jr,aw as Ar,ax as Er,ay as Ht,az as Or,aA as Rr,aB as zr,aC as Pr,aD as At,aE as Tr,aF as Br,aG as Nr,aH as Ir,aI as Mr,aJ as Dr,aK as Lr,aL as Fr,aM as Ur,aN as Wr,aO as $e,aP as gn,aQ as Zr,aR as Gr,aS as Hr,aT as Vr}from"./index-HyGScCuj.js";import{R as ge,w as $r,i as Yr,d as Vt,a as bn,s as qr,g as Kr,b as _t,r as Xr,c as vt,P as Jr,e as Qr,u as es,f as ts,h as ns}from"./param-selector-Co1Y1OOn.js";var rs=function(a){var c=a.text,r=a.delimiter;return m.jsx("span",{children:c.split(r||"\\").map(function(s,i){return i?[m.jsx(An,{children:"⏎"},i),s]:s})})};const _n={mtr:{components:()=>Fe(()=>import("./index-BiBEROE9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),fonts:()=>Fe(()=>import("./index-BiBEROE9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(a=>a.mtrFonts)},gzmtr:{components:()=>Fe(()=>import("./index-Bqy2VowE.js"),__vite__mapDeps([8,1,2,3,4,6,5,9]))},shmetro:{components:()=>Fe(()=>import("./index-BxDaf5t-.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,9]))},shsubrwy:{components:()=>Fe(()=>import("./index-DHuP8ILq.js"),__vite__mapDeps([11,1,2,3,4,5]))}};function ss(a){const[c,r]=J.useState({}),{components:s,fonts:i}=_n[a],e=async n=>{const t=await i?.()??[];await Promise.all(t.map(f=>de.loadFont(f))),n.aborted||document.querySelector("#css_share")?.setAttribute("href",`/rmg/styles/share_${a}.css`);const{default:l}=await s();r(l)};return J.useEffect(()=>{const n=new AbortController;return e(n.signal).catch(t=>{Ee.error(`Failed to load canvas for style ${a}`,t),r({})}),de.event(we.STYLE_CHANGE,{style:a}),()=>{n.abort(),r({})}},[a]),c}const is={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function as(){const{canvasToShow:a,canvasScale:c}=Q(t=>t.app),{svg_height:r,style:s}=Q(t=>t.param),i=ss(s),e=Object.keys(i).filter(t=>a.includes(t)),n=r*c;return m.jsx(Pe,{minH:n,sx:is,children:Object.keys(i).length===0?m.jsx(pt,{isIndeterminate:!0}):e.map(t=>m.jsx(ln,{sx:{minWidth:750,height:n},children:i[t]},t+s))})}const $t=a=>c=>{c(Ln(a)),c(cn(a.stn_list))},be=(a,c)=>(r,s)=>{const{stn_list:i}=s().param,e={...i,[a]:c};r(xe(e))},xe=a=>c=>{c(Fn(a)),c(cn(a))},os=(a=!1)=>(c,r)=>{const{stn_list:s}=r().param,i=Object.keys(s).reduce((e,n)=>({...e,[n]:(t=>{switch(t){case"linestart":return{...s.lineend,parents:[],children:a?s.lineend.parents:s.lineend.parents.toReversed(),branch:{right:s.lineend.branch?.left}};case"lineend":return{...s.linestart,parents:a?s.linestart.children:s.linestart.children.toReversed(),children:[],branch:{left:s.linestart.branch?.right}};default:{const l=s[t].children.map(_=>_==="linestart"?"lineend":_==="lineend"?"linestart":_),f=s[t].parents.map(_=>_==="linestart"?"lineend":_==="lineend"?"linestart":_);return{...s[t],parents:a?l:l.reverse(),children:a?f:f.reverse(),branch:{left:s[t].branch?.right,right:s[t].branch?.left}}}}})(n)}),{});c(xe(i))},Yt=a=>(c,r)=>{const{stn_list:s}=r().param,{branches:i}=r().helper,e=i[0][1],n=i[0][2],t=i[0].slice(-2)[0],l=i[0].slice(-3)[0];if(a){const f={...s,linestart:{...s.linestart,children:s.linestart.children.map(_=>_===e?n:_)},[e]:{...s[e],parent:s[e].parents.map(_=>_==="linestart"?t:_),children:s[e].children.map(_=>_===n?"lineend":_)},[n]:{...s[n],parent:s[n].parents.map(_=>_===e?"linestart":_)},[t]:{...s[t],children:s[t].children.map(_=>_==="lineend"?e:_)},lineend:{...s.lineend,parents:s.lineend.parents.map(_=>_===t?e:_)}};c(xe(f))}else{const f={...s,linestart:{...s.linestart,children:s.linestart.children.map(_=>_===e?t:_)},[e]:{...s[e],parent:s[e].parents.map(_=>_==="linestart"?t:_)},[l]:{...s[l],children:s[l].children.map(_=>_===t?"lineend":_)},[t]:{...s[t],parents:s[t].parents.map(_=>_===l?"linestart":_),children:s[t].children.map(_=>_==="lineend"?e:_)},lineend:{...s.lineend,parents:s.lineend.parents.map(_=>_===t?l:_)}};c(xe(f))}},qt=(a,c,r)=>(s,i)=>{const e=i().param.stn_list[a];s(be(a,{...e,localisedName:{...e.localisedName,[c]:r}}))},ls=(a,c)=>(r,s)=>{const{localisedSecondaryName:i,...e}=s().param.stn_list[a];r(c?be(a,{...e,localisedSecondaryName:{}}):be(a,e))},Kt=(a,c,r)=>(s,i)=>{const e=i().param.stn_list[a];s(be(a,{...e,localisedSecondaryName:{...e.localisedSecondaryName,[c]:r}}))},cs=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,num:c}))},Xt=(a,c,r)=>(s,i)=>{const e=i().param.stn_list[a],n=e.transfer.groups.map(t=>({...t}));if(n.length>c)n[c]={...n[c],lines:(n[c].lines??[]).concat(r)};else{for(let t=n.length;t<c;t++)n[t]={lines:[]};n[c]={lines:[r]}}s(be(a,{...e,transfer:{...e.transfer,groups:[n[0],...n.slice(1)??[]]}}))},ds=(a,c,r)=>(s,i)=>{const e=i().param.stn_list[a];if(e.transfer.groups.length>c&&(e.transfer.groups[c].lines?.length||0)>r){const n=e.transfer.groups.map((t,l)=>l===c?{...t,lines:t.lines?.filter((f,_)=>_!==r)}:t);s(be(a,{...e,transfer:{...e.transfer,groups:[n[0],...n.slice(1)??[]]}}))}},hs=(a,c,r,s)=>(i,e)=>{const n=e().param.stn_list[a];if(n.transfer.groups.length>c&&(n.transfer.groups[c].lines?.length||0)>r){const t=n.transfer.groups.map((l,f)=>f===c?{...l,lines:l.lines?.map((_,y)=>y===r?s:_)}:l);i(be(a,{...n,transfer:{...n.transfer,groups:[t[0],...t.slice(1)??[]]}}))}},Jt=(a,c,r)=>(s,i)=>{const e=i().param.stn_list[a],n=e.transfer.groups.map(t=>({...t}));n.length>c&&(n[c]={...n[c],name:r},s(be(a,{...e,transfer:{...e.transfer,groups:[n[0],...n.slice(1)??[]]}})))},us=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,transfer:{...i.transfer,tick_direc:c}}))},fs=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,transfer:{...i.transfer,paid_area:c}}))},ps=(a,c,r)=>(s,i)=>{const e=i().param.stn_list[a];s(be(a,{...e,branch:{...e.branch,[c]:e.branch?.[c]?.with(0,r)}}))},ms=(a,c,r)=>(s,i)=>{const e=i().helper.branches,n={stnId:a,direction:c,first:r};if(c===Se.left){const t=e.slice(1).find(l=>l.slice(-1)[0]===a)?.[0];if(t){const l=e[0][e[0].indexOf(t)+1];s(Qt([n,{stnId:t,direction:Se.right,first:l}]))}}else{const t=e.slice(1).find(l=>l[0]===a)?.slice(-1)?.[0];if(t){const l=e[0][e[0].indexOf(t)-1];s(Qt([n,{stnId:t,direction:Se.left,first:l}]))}}},Qt=a=>(c,r)=>{const{stn_list:s}=r().param;c(xe({...s,[a[0].stnId]:{...s[a[0].stnId],branch:{...s[a[0].stnId].branch,[a[0].direction]:s[a[0].stnId].branch?.[a[0].direction]?.with(1,a[0].first)}},[a[1].stnId]:{...s[a[1].stnId],branch:{...s[a[1].stnId].branch,[a[1].direction]:s[a[1].stnId].branch?.[a[1].direction]?.with(1,a[1].first)}}}))},gs=(a,c)=>(r,s)=>{const i=s().helper.branches;if(c===Se.left){const e=i.slice(1).find(n=>n.slice(-1)[0]===a)?.[0];e&&r(en(a,e))}else{const e=i.slice(1).find(n=>n[0]===a)?.slice(-1)?.[0];e&&r(en(e,a))}},en=(a,c)=>(r,s)=>{const{stn_list:i}=s().param;r(xe({...i,[a]:{...i[a],parents:i[a].parents.slice().reverse()},[c]:{...i[c],children:i[c].children.slice().reverse()}}))},bs=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,facility:c||void 0}))},_s=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,services:c}))},vs=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,underConstruction:c}))},ys=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,loop_pivot:c}))},Ss=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,one_line:c}))},xs=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,int_padding:c}))},ws=a=>(c,r)=>{const i=r().param.stn_list[a].int_padding,e=structuredClone(r().param.stn_list);Object.values(e).forEach(n=>{n.int_padding=i}),c(xe(e))},ks=(a,c)=>(r,s)=>{const i=s().param.stn_list[a];r(be(a,{...i,character_spacing:c}))},Cs=a=>(c,r)=>{const i=r().param.stn_list[a].character_spacing,e=structuredClone(r().param.stn_list);Object.values(e).forEach(n=>{n.character_spacing=i}),c(xe(e))},js=(a,c,r=2,s="asc")=>(i,e)=>{const n=e().param.stn_list,l=e().helper.branches[a]?.slice(1,-1);if(l){const f=l.reduce((_,y,g)=>({..._,[y]:{...n[y],num:(c+g*(s==="desc"?-1:1)).toString().padStart(r,"0")}}),n);i(xe(f))}};function As(){const{t:a}=le(),c=ue(),r=Q(l=>l.app.selectedStation);console.log("InfoSection:: Rendering for",r);const s=Q(l=>l.param.style),{num:i,localisedName:e,localisedSecondaryName:n}=Q(l=>l.param.stn_list[r]),t=[{type:"input",label:a("StationSidePanel.info.num"),value:i,placeholder:"01",onChange:l=>c(cs(r,l)),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("Chinese name"),value:e.zh??"",onChange:l=>c(qt(r,"zh",l))},{type:"input",label:a("English name"),value:e.en??"",onChange:l=>c(qt(r,"en",l))},{type:"custom",label:a("Secondary names"),component:m.jsx(je,{selections:[{label:a("Yes"),value:!0},{label:a("No"),value:!1}],defaultValue:!!n,onChange:l=>c(ls(r,l))}),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("StationSidePanel.info.zhSecondary"),value:n?.zh??"",placeholder:"1号航站楼",onChange:l=>c(Kt(r,"zh",l)),hidden:!n||![X.GZMTR].includes(s)},{type:"input",label:a("StationSidePanel.info.enSecondary"),value:n?.en??"",placeholder:"Terminal 1",onChange:l=>c(Kt(r,"en",l)),hidden:!n||![X.GZMTR].includes(s)}];return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("StationSidePanel.info.title")}),m.jsx(ge,{fields:t,minW:130})]})}class Es{static hexToRgb(c){return[parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5,7),16)]}static fade(c,r){return`rgba(${[...this.hexToRgb(c),r].join(",")})`}static euclideanDistance(c,r){return this.hexToRgb(c).reduce((s,i,e)=>s+Math.pow(i-this.hexToRgb(r)[e],2),0)}}function Tt(a){const{theme:c,onClick:r}=a,{t:s}=le();return m.jsx(Ne,{size:"xs","aria-label":s("Colour"),mt:"0.45px",color:c?.[3],bg:c?.[2],_hover:{bg:Es.fade(c?.[2]??"#aaaaaa",.7)},icon:m.jsx(Un,{}),onClick:r})}function Os(a){const{interchangeList:c,onAdd:r,onDelete:s,onUpdate:i}=a,{t:e}=le(),n=ue(),[t,l]=J.useState(),{paletteAppClipOutput:f}=Q(p=>p.app),{style:_,theme:y,stn_list:g}=Q(p=>p.param);J.useEffect(()=>{t!==void 0&&f&&(i?.(t,{...c[t],theme:f}),l(void 0))},[f?.toString()]);const h=Object.values(g).reduce((p,b)=>{const[x,C]=p;return[[...new Set(x.concat(b.transfer.groups.map(j=>j.lines?.map(A=>A.name[0])??[]).flat()))],[...new Set(C.concat(b.transfer.groups.map(j=>j.lines?.map(A=>A.name[1])??[]).flat()))]]},[[],[]]),v=Object.fromEntries(Object.entries(St).filter(([p])=>!["railway"].includes(p)).map(([p,b])=>[p,e(b)])),u=c.map((p,b)=>[{type:"input",label:e("Chinese name"),value:p.name[0],onChange:x=>i?.(b,{...p,name:[x,p.name[1]]}),optionList:h[0]},{type:"input",label:e("English name"),value:p.name[1],onChange:x=>i?.(b,{...p,name:[p.name[0],x]}),optionList:h[1]},{type:"select",label:e("Line icon"),value:p.facility,options:{"":e("None"),...v},onChange:x=>i?.(b,{...p,facility:x}),hidden:![X.MTR].includes(_)}]);return m.jsxs(De,{direction:"column",children:[c.length===0&&m.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack",children:[m.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("StationSidePanel.interchange.noInterchanges")}),m.jsx(Ne,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.add"),onClick:()=>r?.({theme:[y[0],"","#aaaaaa",ct.white],name:["",""]}),icon:m.jsx(Be,{})})]}),c.map((p,b)=>m.jsxs(Oe,{spacing:.5,"data-testid":`interchange-card-stack-${b}`,children:[m.jsx(xt,{label:e("Colour"),minW:"40px",noLabel:b!==0,children:m.jsx(Tt,{theme:p.theme,onClick:()=>{l(b),n(Ot(p.theme??[y[0],"","#aaaaaa",ct.white]))}})}),m.jsx(ge,{fields:u[b],noLabel:b!==0}),r&&b===u.length-1?m.jsx(Ne,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.copy"),onClick:()=>r?.(c.slice(-1)[0]),icon:m.jsx(Wn,{})}):m.jsx(ke,{minW:8}),s&&m.jsx(Ne,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.remove"),onClick:()=>s?.(b),icon:m.jsx(Rt,{})})]},b))]})}function Rs(){const{t:a}=le(),c=ue(),r=Q(y=>y.app.selectedStation),{theme:s,style:i}=Q(y=>y.param),{transfer:e}=Q(y=>y.param.stn_list[r]),n=y=>[{type:"input",label:a("Station Chinese name"),value:e.groups[y].name?.[0]??"",hidden:![X.MTR].includes(i),onChange:g=>c(Jt(r,y,[g,e.groups[y].name?.[1]??""]))},{type:"input",label:a("Station English name"),value:e.groups[y].name?.[1]??"",hidden:![X.MTR].includes(i),onChange:g=>c(Jt(r,y,[e.groups[y].name?.[0]??"",g]))},{type:"switch",label:a("Paid area"),isChecked:e.paid_area,onChange:g=>c(fs(r,g)),hidden:![X.MTR].includes(i)||y===0,oneLine:!0}],t=y=>g=>{c(Xt(r,y,g))},l=y=>g=>{c(ds(r,y,g))},f=y=>(g,h)=>{c(hs(r,y,g,h))},_=()=>{c(Xt(r,e.groups.length,{theme:[s[0],"","#AAAAAA",ct.white],name:["",""]}))};return m.jsxs(Et,{align:"flex-start",p:1,children:[m.jsxs(Pe,{w:"100%",children:[m.jsx(ve,{as:"h5",size:"sm",mr:"auto",children:a("StationSidePanel.interchange.title")}),i===X.MTR&&m.jsx(je,{selections:[{label:a("Text on the left"),value:dt.left},{label:a("Text on the right"),value:dt.right}],defaultValue:e.tick_direc,onChange:y=>c(us(r,y))})]}),e.groups.map((y,g)=>m.jsxs(J.Fragment,{children:[m.jsx(ve,{as:"h6",size:"xs",children:a(g===0?"StationSidePanel.interchange.within":g===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),g!==0&&m.jsx(ge,{fields:n(g)}),m.jsx(Os,{interchangeList:y.lines??[],onAdd:t(g),onDelete:l(g),onUpdate:f(g)})]},g)),e.groups.length<3&&m.jsx(oe,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:m.jsx(Be,{}),onClick:_,children:a("StationSidePanel.interchange.addGroup")})]})}function zs(){const{t:a}=le(),c=ue(),r=Q(p=>p.app.selectedStation),{style:s,loop:i}=Q(p=>p.param),{services:e,facility:n,loop_pivot:t,one_line:l,int_padding:f,character_spacing:_,underConstruction:y}=Q(p=>p.param.stn_list[r]),g=Object.values(Lt).map(p=>({label:a("StationSidePanel.more."+p),value:p,disabled:p===Lt.local&&s!==X.SHMetro})),h=Object.fromEntries(Object.entries(St).filter(([p])=>!["railway"].includes(p)).map(([p,b])=>[p,a(b)])),v=Object.fromEntries(Object.entries(St).filter(([p])=>!["np360"].includes(p)).map(([p,b])=>[p,a(b)])),u=[{type:"custom",label:a("StationSidePanel.more.service"),component:m.jsx(je,{selections:g,defaultValue:e,onChange:p=>c(_s(r,p)),multiSelect:!0}),hidden:![X.GZMTR,X.SHMetro].includes(s)},{type:"select",label:a("StationSidePanel.more.facility"),value:n||"",options:{"":a("None"),...s===X.MTR?h:v},onChange:p=>c(bs(r,p)),hidden:![X.MTR,X.SHMetro].includes(s)},{type:"switch",label:a("StationSidePanel.more.pivot"),isChecked:t,onChange:p=>c(ys(r,p)),hidden:![X.GZMTR,X.SHMetro].includes(s)||!i,minW:"full",oneLine:!0},{type:"switch",label:a("StationSidePanel.more.oneLine"),isChecked:l,onChange:p=>c(Ss(r,p)),hidden:![X.SHMetro].includes(s),minW:"full",oneLine:!0},{type:"input",label:a("StationSidePanel.more.intPadding"),value:f.toString(),validator:p=>Number.isInteger(p),onChange:p=>c(xs(r,Number(p))),hidden:![X.SHMetro].includes(s)},{type:"custom",label:a("StationSidePanel.more.intPaddingApplyGlobal"),component:m.jsx(je,{selections:[{label:a("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>c(ws(r))}),oneLine:!0,hidden:![X.SHMetro].includes(s)},{type:"input",label:a("StationSidePanel.more.characterSpacing"),value:_.toString(),validator:p=>Number.isInteger(p),onChange:p=>c(ks(r,Number(p))),hidden:![X.SHSuburbanRailway].includes(s)},{type:"custom",label:a("StationSidePanel.more.intPaddingApplyGlobal"),component:m.jsx(je,{selections:[{label:a("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:()=>c(Cs(r))}),oneLine:!0,hidden:![X.SHSuburbanRailway].includes(s)},{type:"custom",label:a("Under construction"),component:m.jsx(je,{selections:[{label:a("No"),value:!1},{label:a("Temporary"),value:"temp"},{label:a("Yes"),value:!0}],defaultValue:y??!1,onChange:p=>c(vs(r,p))}),hidden:![X.GZMTR].includes(s)}];return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("StationSidePanel.more.title")}),m.jsx(ge,{fields:u})]})}function Ps(){const{t:a}=le(),c=ue(),r=Q(y=>y.app.selectedStation),s=Q(y=>y.param.stn_list),{parents:i,children:e,branch:n}=s[r],t={[ht.through]:a("StationSidePanel.branch.through"),[ht.nonThrough]:a("StationSidePanel.branch.nonThrough")},l=y=>(y===Se.left?i:e).reduce((g,h)=>({...g,[h]:s[h].localisedName.zh+"/"+s[h].localisedName.en}),{}),f={upper:a("StationSidePanel.branch.upper"),lower:a("StationSidePanel.branch.lower")},_=y=>{const g=n?.[y];return g?[{type:"select",label:a("StationSidePanel.branch.type"),options:t,value:g[0],onChange:h=>c(ps(r,y,h))},{type:"select",label:a("StationSidePanel.branch.firstStation"),options:l(y),value:g[1],onChange:h=>c(ms(r,y,h))},{type:"select",label:a("StationSidePanel.branch.position"),options:f,value:(y===Se.left?i:e)[0]===g[1]?"upper":"lower",onChange:()=>c(gs(r,y))}]:[]};return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("Branches")}),m.jsx(ve,{as:"h6",size:"xs",children:a("Branch on the left")}),m.jsx(De,{direction:"column",children:i.length===2?m.jsx(ge,{fields:_(Se.left)}):m.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:a("No branches found")})}),m.jsx(ve,{as:"h6",size:"xs",children:a("Branch on the right")}),m.jsx(De,{direction:"column",children:e.length===2?m.jsx(ge,{fields:_(Se.right)}):m.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:a("No branches found")})})]})}function Ts(){return m.jsxs(zt,{children:[m.jsx(As,{}),m.jsx(Ie,{}),m.jsx(Rs,{}),m.jsx(Ie,{}),m.jsx(Ps,{}),m.jsx(Ie,{}),m.jsx(zs,{})]})}function Bs(){const{t:a}=le(),c=ue(),{style:r,svgWidth:s,svg_height:i,y_pc:e,branchSpacingPct:n,padding:t,direction_gz_x:l,direction_gz_y:f,loop:_}=Q(g=>g.param),y=[...Pt[r].map(g=>({type:"input",label:a(`StyleSidePanel.layout.${g}Width`),value:s[g].toString(),onChange:h=>c(Zn({width:Number(h),canvas:g}))})),{type:"input",label:a("StyleSidePanel.layout.canvasHeight"),value:i.toString(),onChange:g=>c(Gn(Number(g)))},{type:"slider",label:a("StyleSidePanel.layout.verticalPosition"),value:e,min:0,max:100,onChange:g=>c(Hn(g)),leftIcon:m.jsx(kt,{}),rightIcon:m.jsx(wt,{}),hidden:![X.MTR,X.GZMTR].includes(r)},{type:"slider",label:_?r===X.GZMTR?a("StyleSidePanel.layout.loopSpacing"):a("StyleSidePanel.layout.branchSpacingLoop"):a("Branch spacing"),value:n,min:0,max:_?50:100,onChange:g=>c(Vn(g)),leftIcon:m.jsx(Ft,{}),rightIcon:m.jsx(Be,{})},{type:"slider",label:a("StyleSidePanel.layout.padding"),value:t,min:0,max:50,onChange:g=>c($n(g)),leftIcon:m.jsx(Ft,{}),rightIcon:m.jsx(Be,{})},{type:"slider",label:a("StyleSidePanel.layout.directionGzX"),value:l,min:0,max:100,onChange:g=>c(Yn(g)),leftIcon:m.jsx(hn,{}),rightIcon:m.jsx(dn,{}),hidden:![X.GZMTR].includes(r)},{type:"slider",label:a("StyleSidePanel.layout.directionGzY"),value:f,min:0,max:100,onChange:g=>c(qn(g)),leftIcon:m.jsx(kt,{}),rightIcon:m.jsx(wt,{}),hidden:![X.GZMTR].includes(r)}];return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.layout.title")}),m.jsx(ge,{fields:y,minW:130})]})}function Ns(){const{t:a}=le(),c=ue(),{paletteAppClipOutput:r}=Q(O=>O.app),{style:s,theme:i,line_name:e,line_num:n,spanLineNum:t,direction:l,platform_num:f,psd_num:_,psdLabel:y,coachNum:g,namePosMTR:h,customiseMTRDest:v,info_panel_type:u,stn_list:p,loop:b}=Q(O=>O.param),x=Math.max(...Object.values(p).map(O=>O.services.length)),[C,j]=J.useState(!1);J.useEffect(()=>{C&&r&&(c(Kn(r)),j(!1))},[r?.toString()]);const A=[{label:a("StyleSidePanel.design.left"),value:dt.left},{label:a("StyleSidePanel.design.right"),value:dt.right}],B=Object.values(Ut).reduce((O,d)=>({...O,[d]:a("StyleSidePanel.design."+d)}),{}),z=Object.values(Xn).reduce((O,d)=>({...O,[d]:a("StyleSidePanel.design."+d)}),{}),L=[{type:"custom",label:a("Colour"),component:m.jsx(Tt,{theme:i,onClick:()=>{j(!0),c(Ot(i))}}),minW:"40px"},{type:"input",label:a("StyleSidePanel.design.zhLineName"),value:e[0],onChange:O=>c(Wt([O,e[1]])),minW:130},{type:"input",label:a("StyleSidePanel.design.enLineName"),value:e[1],onChange:O=>c(Wt([e[0],O])),minW:130},{type:"input",label:a("StyleSidePanel.design.lineNum"),value:n,onChange:O=>c(Jn(O)),hidden:![X.GZMTR].includes(s)},{type:"custom",label:a("Span digits over rows"),component:m.jsx(je,{selections:[{label:a("Yes"),value:!0},{label:a("No"),value:!1}],defaultValue:t??!1,onChange:O=>c(Qn(O))}),hidden:![X.GZMTR].includes(s)},{type:"input",label:a("StyleSidePanel.design.platformNum"),value:f||"",onChange:O=>c(er(O))},{type:"input",label:a("StyleSidePanel.design.psdNum"),value:_,onChange:O=>c(tr(O)),hidden:![X.GZMTR].includes(s)},{type:"custom",label:a("Platform door label"),component:m.jsx(je,{selections:[{label:"屏蔽门 Screen door",value:Zt.screen},{label:"站台门 Platform door",value:Zt.platform}],defaultValue:y,onChange:O=>c(nr(O))}),hidden:![X.GZMTR].includes(s),minW:260},{type:"input",label:a("Coach number"),value:g,onChange:O=>c(rr(O)),hidden:![X.GZMTR].includes(s)},{type:"select",label:a("StyleSidePanel.design.panelType"),value:u,options:s===X.GZMTR?B:z,disabledOptions:[Ut.gz1822],onChange:O=>c(sr(O)),hidden:![X.GZMTR,X.SHMetro].includes(s)},{type:"custom",label:a("StyleSidePanel.design.direction"),component:m.jsx(je,{selections:A,defaultValue:l,onChange:O=>c(ir(O))}),minW:"full",oneLine:!0}],P=[{label:a("StyleSidePanel.design.upwards"),value:!0},{label:a("StyleSidePanel.design.downward"),value:!1}],U=[{type:"custom",label:a("StyleSidePanel.design.firstStationNameDisplay"),component:m.jsx(Oe,{spacing:.5,children:m.jsx(je,{selections:P,defaultValue:h.isFlip??!0,onChange:O=>c(Gt(O))})}),minW:"full",oneLine:!0,hidden:![X.SHMetro].includes(s)||x>1||b}],$=[{label:a("StyleSidePanel.design.alternatively"),value:!0},{label:a("StyleSidePanel.design.onOneSide"),value:!1}],k=[{type:"custom",label:a("StyleSidePanel.design.nameDisplay"),component:m.jsxs(Oe,{spacing:.5,children:[m.jsx(Ne,{size:"xs",variant:"ghost","aria-label":a("StyleSidePanel.design.flip"),title:a("StyleSidePanel.design.flip"),icon:m.jsx(ar,{}),onClick:()=>c(Gt())}),m.jsx(je,{selections:$,defaultValue:h.isStagger,onChange:O=>c(or(O))})]}),minW:"full",oneLine:!0,hidden:![X.MTR].includes(s)},{type:"switch",label:a("StyleSidePanel.design.legacyDestination"),isChecked:v.isLegacy,onChange:O=>c(lr(O)),hidden:![X.MTR].includes(s),minW:"full",oneLine:!0},{type:"switch",label:a("StyleSidePanel.design.overrideTerminal"),isChecked:v.terminal!==!1,onChange:O=>c(bt(O?["",""]:!1)),hidden:![X.MTR].includes(s),minW:"full",oneLine:!0},{type:"input",label:a("StyleSidePanel.design.terminalZhName"),value:v.terminal?v.terminal[0]:"",placeholder:"機場及博覽館",onChange:O=>c(bt([O,v.terminal?v.terminal[1]:""])),hidden:![X.MTR].includes(s)||v.terminal===!1},{type:"input",label:a("StyleSidePanel.design.terminalEnName"),value:v.terminal?v.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:O=>c(bt([v.terminal?v.terminal[0]:"",O])),hidden:![X.MTR].includes(s)||v.terminal===!1}];return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.design.title")}),m.jsx(ge,{fields:[...L,...k,...U],minW:130})]})}function Is(){const{t:a}=le(),c=ue(),{loop:r}=Q(e=>e.param),s=[{type:"switch",label:a("StyleSidePanel.loop.isLoop"),isChecked:r,onChange:e=>c(cr(e)),minW:"full",oneLine:!0}],i=()=>{c(un(0)),c(Le(Me.BRANCH))};return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("Loop line")}),m.jsx(ge,{fields:s}),r&&m.jsx(Pe,{p:1,children:m.jsx(oe,{size:"sm",variant:"outline",leftIcon:m.jsx(dr,{}),onClick:i,flex:1,children:a("More settings")})})]})}function Ms(a){const{note:c,onUpdate:r,onDelete:s}=a,{t:i}=le(),e=[{type:"textarea",label:i("StyleSidePanel.note.zhNote"),value:c[0],onChange:t=>r?.([t,c[1],c[2],c[3],c[4]])},{type:"textarea",label:i("StyleSidePanel.note.enNote"),value:c[1],onChange:t=>r?.([c[0],t,c[2],c[3],c[4]])},{type:"switch",label:i("StyleSidePanel.note.border"),isChecked:c[4],onChange:t=>r?.([c[0],c[1],c[2],c[3],t]),oneLine:!0}],n=[{type:"slider",label:i("StyleSidePanel.note.positionX"),value:c[2],min:0,max:100,onChange:t=>r?.([c[0],c[1],t,c[3],c[4]]),leftIcon:m.jsx(hn,{}),rightIcon:m.jsx(dn,{})},{type:"slider",label:i("StyleSidePanel.note.positionY"),value:c[3],min:0,max:100,onChange:t=>r?.([c[0],c[1],c[2],t,c[4]]),leftIcon:m.jsx(kt,{}),rightIcon:m.jsx(wt,{})}];return m.jsxs(De,{direction:"column",children:[m.jsx(ge,{fields:e,minW:"full"}),m.jsxs(Oe,{spacing:.5,sx:{"&>div":{flex:1}},children:[m.jsx(ge,{fields:n}),m.jsx(Ne,{size:"sm",variant:"ghost","aria-label":i("StyleSidePanel.note.remove"),onClick:()=>s?.(),icon:m.jsx(Rt,{})})]})]})}function Ds(){const{t:a}=le(),c=ue(),r=Q(s=>s.param.notesGZMTR);return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.note.title")}),m.jsxs(Et,{spacing:.5,children:[r?.map((s,i)=>m.jsx(Ms,{note:s,onUpdate:e=>c(ur({index:i,note:e})),onDelete:()=>c(hr(i))},i)),m.jsx(oe,{size:"xs",variant:"ghost",leftIcon:m.jsx(Be,{}),alignSelf:"flex-end",onClick:()=>c(fr()),children:a("StyleSidePanel.note.add")})]})]})}function Ls(){const{style:a}=Q(c=>c.param);return m.jsxs(zt,{children:[m.jsx(Bs,{}),m.jsx(Ie,{}),m.jsx(Ns,{}),[X.GZMTR,X.SHMetro].includes(a)&&m.jsxs(m.Fragment,{children:[m.jsx(Ie,{}),m.jsx(Is,{})]}),a===X.GZMTR&&m.jsxs(m.Fragment,{children:[m.jsx(Ie,{}),m.jsx(Ds,{})]})]})}const Bt=(a,c)=>{if(["linestart","lineend"].includes(a)||c[a].parents.length>1||c[a].children.length>1)return 0;const r=c[a].parents[0];return r?c[r].children.length===1?Bt(r,c):c[r].children.indexOf(a)===0?1:-1:0},Fs=a=>(c,r)=>{const{stn_list:s,current_stn_idx:i}=r().param;if(a===i)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:e,children:n}=s[a];return Object.keys(s).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):e.length===2&&n.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(s).some(l=>![a,"linestart","lineend"].includes(l)&&Bt(l,s)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Us=a=>(c,r)=>{const s=r().param.stn_list,{parents:i,children:e}=s[a];let n=JSON.parse(JSON.stringify(s));i.length===2||e.length===2?(i.forEach(t=>{n[t].children=n[t].children.map(l=>l===a?e:l).flat()}),e.forEach(t=>{n[t].parents=n[t].parents.map(l=>l===a?i:l).flat()}),i.length===1&&(n[i[0]].branch={...n[i[0]].branch,right:n[a].branch?.right}),e.length===1&&(n[e[0]].branch={...n[e[0]].branch,left:n[a].branch?.left})):s[i[0]].children.length===2&&s[e[0]].parents.length===2?n={...s,[i[0]]:{...s[i[0]],children:s[i[0]].children.filter(t=>t!==a),branch:{...s[i[0]].branch,right:void 0}},[e[0]]:{...s[e[0]],parents:s[e[0]].parents.filter(t=>t!==a),branch:{...s[e[0]].branch,left:void 0}}}:(i.forEach(t=>{const l=n[t].children.indexOf(a);e.length?n[t].children[l]=e[0]:n[t].children.splice(l,1),n[t].branch?.right?.[1]===a&&(n[t].branch={...n[t].branch,right:n[t].branch?.right?.with(1,e[0])})}),e.forEach(t=>{const l=n[t].parents.indexOf(a);i.length?n[t].parents[l]=i[0]:n[t].parents.splice(l,1),n[t].branch?.left?.[1]===a&&(n[t].branch={...n[t].branch,left:n[t].branch?.left?.with(1,i[0])})})),delete n[a],c(xe(n))};function Ws(...a){return a.reduce((c,r)=>c.map(s=>r.map(i=>s.concat([i]))).reduce((s,i)=>s.concat(i),[]),[[]])}const We=(a,c)=>!!c[a[0]].children.indexOf(a[1]),vn=(a,c)=>[a[0][1],a[0][a[0].length-2],...a[0].filter(r=>a.slice(1).filter(s=>We(s,c)).map(s=>s.filter(i=>!["linestart","lineend"].includes(i))).map(s=>[s[0],s[s.length-1]]).flat().includes(r))],Zs=(a,c)=>a.slice(1).filter(r=>We(r,c)).map(r=>r.filter(s=>!["linestart","lineend"].includes(s))).map(r=>[r[0],r[r.length-1]]),Gs=a=>(c,r)=>{const s=r().helper.branches;if(a===0){const i=r().param.stn_list,e=vn(s,i);return Ws(e,e).filter(n=>n[0]!==n[1])}else{const i=s[a];if(i){const e=i.filter(n=>!["linestart","lineend"].includes(n));return[[e[0],e.slice(-1)[0]]]}else return[]}},Zi=(a,c)=>(r,s)=>{const i=s().param.coline,e=s().helper.branches[c];for(const[n,t]of Object.entries(i))if(t.from===a&&e.includes(t.to)){const l=e.indexOf(a),f=e.indexOf(t.to);if(f>l)return[f-l+1,n]}else if(t.to===a&&e.includes(t.to)){const l=e.indexOf(a),f=e.indexOf(t.from);if(f>l)return[f-l+1,n]}return[0,void 0]},yn=(a,c)=>(r,s)=>{const i=s().param.stn_list,e=s().helper.branches;if(a===c)throw new Error("addColine():: failed for same stnId");const n=vn(e,i).filter(l=>[a,c].includes(l)),t=Zs(e,i).filter(l=>[a,c].every(f=>l.includes(f)));if(n.length===2&&t.length>0)throw new Error(`addColine():: main check failed for ${a}, ${c}`);if(n.length!==2&&t.length!==1)throw new Error(`addColine():: branch check failed for ${a}, ${c}`)},Hs=a=>(c,r)=>{const s=r().param.coline,e=r().helper.branches[a];return e?Object.entries(s).reduce((n,t)=>e.includes(t[1].from)&&e.includes(t[1].to)?{...n,[t[0]]:t[1]}:{...n},{}):{}},Vs=a=>(c,r)=>{const s=r().param.coline;if(Object.keys(s).length===0)return;const i=Object.entries(s).reduce((e,n)=>n[1].from!==a&&n[1].to!==a?{...e,[n[0]]:n[1]}:{...e},{});c(Ue(i))},$s=(a,c,r,s=!0)=>(i,e)=>{const n=e().param.coline;i(yn(a,c)),i(Ue({...n,[qe(4)]:{from:a,to:c,colors:r,display:s}}))},Ys=(a,c,r,s=!0)=>(i,e)=>{const n=e().param.coline;if(a in n){i(yn(c,r));const t={...n,[a]:{...n[a],from:c,to:r,display:s}};i(Ue(t))}},qs=(a,c)=>(r,s)=>{const i=s().param.coline;if(a in i&&i[a].colors.length>c){const e=i[a].colors.filter((n,t)=>t!==c);if(e.length===0){const{[a]:n,...t}=i;r(Ue(t))}else{const n={...i,[a]:{...i[a],colors:e}};r(Ue(n))}}},Ks=(a,c,r)=>(s,i)=>{const e=i().param.coline;if(a in e&&e[a].colors.length>c){const n={...e,[a]:{...e[a],colors:e[a].colors.map((t,l)=>l===c?[0,1,2,3,4,5].map(f=>r[f]===void 0?t[f]:r[f]):t)}};s(Ue(n))}};function Xs(a){const{isOpen:c,onClose:r}=a,{t:s}=le(),i=ue(),e=Q(f=>f.app.selectedStation),[n,t]=J.useState(!1);J.useEffect(()=>{c||t(!1)},[c]);const l=()=>{const f=i(Fs(e));f?(r(),i(Le(Me.CLOSE)),i(fn("linestart")),i(Vs(e)),i(Us(e))):t(!0),de.event(we.REMOVE_STATION,{success:f})};return m.jsxs(Ke,{isOpen:c,onClose:r,children:[m.jsx(Xe,{}),m.jsxs(Je,{children:[n&&m.jsxs(ut,{status:"error",variant:"solid",size:"xs",children:[m.jsx(ft,{}),s("Unable to remove this station.")]}),m.jsxs(ke,{position:"relative",children:[m.jsx(Qe,{children:s("Remove station")}),m.jsx(et,{})]}),m.jsx(tt,{children:s("Are you sure to remove station? You cannot undo this action.")}),m.jsxs(nt,{children:[m.jsx(oe,{onClick:r,children:s("Cancel")}),m.jsx(oe,{colorScheme:"primary",onClick:l,ml:3,children:s("Confirm")})]})]})]})}function Js(){const{t:a}=le(),c=ue(),{selectedStation:r}=Q(t=>t.app),{loop:s,style:i}=Q(t=>t.param),[e,n]=J.useState(!1);return m.jsxs(pr,{children:[m.jsxs(Oe,{children:[m.jsx(oe,{size:"sm",variant:"outline",onClick:()=>c(Ct(r)),children:a("StationSidePanel.footer.current")}),i===X.GZMTR&&s&&m.jsx(oe,{size:"sm",variant:"outline",onClick:()=>c(pn(r)),children:a("Set as midpoint")}),m.jsx(oe,{size:"sm",variant:"outline",onClick:()=>n(!0),children:a("StationSidePanel.footer.remove")})]}),m.jsx(Xs,{isOpen:e,onClose:()=>n(!1)})]})}function Qs(a){const{colineInfo:c,routeOptions:r,onUpdateRoute:s,onUpdateColourInfo:i,onDelete:e}=a,{t:n}=le(),t=ue(),{paletteAppClipOutput:l}=Q(h=>h.app),[f,_]=J.useState(!1);J.useEffect(()=>{f&&l&&(i?.([...l,c.colors[0][4],c.colors[0][5]]),_(!1))},[l?.toString()]);const y=[{type:"select",label:"Route",value:[c.from,c.to].join(","),options:r,onChange:h=>s?.(h)}],g=[{type:"custom",label:n("Colour"),component:m.jsx(Tt,{theme:[c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3]],onClick:()=>{_(!0),t(Ot(c.colors[0].slice(0,4)))}})},{type:"input",label:n("Chinese name"),value:c.colors[0][4],minW:120,onChange:h=>i?.([c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3],h,c.colors[0][5]])},{type:"input",label:n("English name"),value:c.colors[0][5],minW:120,onChange:h=>i?.([c.colors[0][0],c.colors[0][1],c.colors[0][2],c.colors[0][3],c.colors[0][4],h])}];return m.jsxs(De,{direction:"column",children:[m.jsx(ge,{fields:y,minW:"full"}),m.jsxs(Oe,{spacing:.5,children:[m.jsx(ge,{fields:g}),m.jsx(Ne,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>e?.(0),icon:m.jsx(Rt,{})})]})]})}function ei(){const{t:a}=le(),c=ue(),r=Q(g=>g.app.selectedBranch),{theme:s,stn_list:i}=Q(g=>g.param),e=c(Hs(r)),n=c(Gs(r)),t=g=>g.map(h=>i[h].localisedName.zh+"/"+i[h].localisedName.en).join(" ~ "),l=n.reduce((g,h)=>({...g,[h.join(",")]:t(h)}),{}),f=()=>{console.log(`ColineSection.handleAddTrackSharing():: Adding track sharing to branch ${r} with default combination`,n[0]),c($s(n[0][0],n[0][1],[[s[0],"","#AAAAAA",ct.white,"",""]]))},_=g=>h=>{const[v,u]=h.split(",");console.log(`ColineSection.handleUpdateRoute():: Updating route, colineId=${g}, from=${v}, to=${u}`);try{c(Ys(g,v,u))}catch{c(jt({status:"error",message:"Unable to draw this share track."}))}},y=(g,h)=>{c(qs(g,h))};return m.jsxs(Et,{align:"flex-start",p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("BranchSidePanel.coline.title")}),Object.entries(e).map(([g,h])=>m.jsx(Qs,{colineInfo:h,routeOptions:l,onUpdateRoute:_(g),onUpdateColourInfo:v=>c(Ks(g,0,v)),onDelete:v=>y(g,v)},g)),(r===0||Object.keys(e).length===0)&&m.jsx(oe,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:m.jsx(Be,{}),onClick:f,children:a("BranchSidePanel.coline.add")})]})}function ti(a){const{isOpen:c,onClose:r}=a,{t:s}=le(),i=ue(),e=Q(j=>j.app.selectedBranch),{style:n,stn_list:t}=Q(j=>j.param),l=Q(j=>j.helper.branches),[f,_]=J.useState(e),[y,g]=J.useState("1"),[h,v]=J.useState("2"),[u,p]=J.useState("asc");J.useEffect(()=>{_(e)},[e]);const b=[{type:"select",label:s("AutoNumModal.where"),value:f,options:{...l.reduce((j,A,B)=>({...j,[B]:B===0?s("AutoNumModal.main"):n!==X.SHMetro||!We(A,t)?s("AutoNumModal.branch")+" "+B:s("AutoNumModal.external")+" "+B}),{})},onChange:j=>_(j)},{type:"input",label:s("AutoNumModal.from"),value:y,validator:j=>!isNaN(Number(j)),onChange:g,debouncedDelay:0},{type:"input",label:s("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:h,onChange:v,debouncedDelay:0},{type:"select",label:s("AutoNumModal.sort"),value:u,options:{asc:s("AutoNumModal.asc"),desc:s("AutoNumModal.desc")},onChange:j=>p(j)}],x=()=>{i(js(f,Number(y),Number(h),u)),r(),de.event(we.AUTO_NUMBERING,{})},C=!y||!h||isNaN(Number(y))||isNaN(Number(h));return m.jsxs(Ke,{isOpen:c,onClose:r,children:[m.jsx(Xe,{}),m.jsxs(Je,{children:[m.jsx(Qe,{children:s("AutoNumModal.title")}),m.jsx(et,{}),m.jsx(tt,{children:m.jsx(ge,{fields:b})}),m.jsx(nt,{children:m.jsx(oe,{colorScheme:"primary",isDisabled:C,onClick:x,children:s("Confirm")})})]})]})}const Nt=a=>(c,r)=>{const i=r().helper.branches[a];return i.includes("linestart")||i.includes("lineend")?1:2},Sn=a=>(c,r)=>{const{branches:s}=r().helper,i=s[0],e=s[a];return i.slice(i.indexOf(e[0])+1,i.indexOf(e.slice(-1)[0]))},ni=(a,c)=>r=>r(Nt(c))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):r(Sn(c)).includes(a)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),ri=(a,c)=>(r,s)=>{if(!r(ni(a,c)))return!1;const{branches:e}=s().helper,n=s().param.stn_list,t=e[c];if(t[0]==="linestart"){const l={...n,[t[1]]:{...n[t[1]],parents:[a]},[a]:{...n[a],children:n.linestart.children.map(f=>f===t[1]?f:n[a].children[0]),branch:{right:n.linestart.branch?.right}},linestart:{...n.linestart,children:n.linestart.children.filter(f=>f!==t[1]),branch:{}}};return r(xe(l)),!0}else{const l=t.slice(-2)[0],f={...n,[l]:{...n[l],children:[a]},[a]:{...n[a],parents:n.lineend.parents.map(_=>_===l?_:n[a].parents[0]),branch:{left:n.lineend.branch?.left}},lineend:{...n.lineend,parents:n.lineend.parents.filter(_=>_!==l),branch:{}}};return r(xe(f)),!0}},xn=a=>(c,r)=>{const{branches:s}=r().helper,i=r().param.stn_list,e=s[0],n=s[a];if(c(Nt(a))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const l=e.indexOf(n[0]),f=e.slice(0,l),_=e.indexOf(n.slice(-1)[0]),y=e.slice(_+1),g=f.every(v=>i[v].children.length<=1&&i[v].parents.length<=1),h=y.every(v=>i[v].children.length<=1&&i[v].parents.length<=1);return g?h?[Se.left,Se.right]:[Se.left]:h?[Se.right]:[]},si=(a,c)=>(r,s)=>{if(!r(xn(c)).includes(a))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:e}=s().helper,n=s().param.stn_list,t=e[0],l=e[c];if(a===Se.left){const f=l[0],_={...n,[l[1]]:{...n[l[1]],parents:["linestart"]},[f]:{...n[f],children:n[f].children.filter(y=>y!==l[1]),branch:{}},linestart:{...n.linestart,children:n[f].children.map(y=>y===l[1]?y:t[1]),branch:{right:n[f].branch?.right}}};return r(xe(_)),!0}else{const f=l.slice(-1)[0],_=l.slice(-2)[0],y={...n,[_]:{...n[_],children:["lineend"]},[f]:{...n[f],parents:n[f].parents.filter(g=>g!==_),branch:{}},lineend:{...n.lineend,parents:n[f].parents.map(g=>g===_?g:t.slice(-2)[0]),branch:{left:n[f].branch?.left}}};return r(xe(y)),!0}};function tn(a){const{direction:c}=a,{t:r}=le(),s=ue(),{branches:i}=Q(z=>z.helper),e=Q(z=>z.app.selectedBranch),{style:n,stn_list:t}=Q(z=>z.param),[l,f]=J.useState(!1),[_,y]=J.useState(""),g=i[e].filter(z=>!["linestart","lineend"].includes(z)),h=c===Se.left?g[0]:g.slice(-1)[0],v=t[h],u=s(Sn(e)),p=s(Nt(e)),b=s(xn(e)),x=p===1&&!i[0].includes(h),C=b.includes(c),j=u.reduce((z,L)=>({...z,[L]:t[L]?.localisedName.zh+"/"+t[L]?.localisedName.en}),{"":r("Please select...")}),A=()=>{const z=s(ri(_,e));z?f(!1):s(jt({status:"error",message:r("Unable to connect to main line.")})),de.event(we.CONNECT_BRANCH,{style:n,success:z})},B=()=>{const z=s(si(c,e));z||s(jt({status:"error",message:r("Unable to disconnect from main line.")})),de.event(we.DISCONNECT_BRANCH,{style:n,success:z})};return m.jsxs(De,{direction:"column",children:[m.jsxs(Pe,{alignItems:"center",children:[m.jsx(xt,{label:r("Station name"),flex:1,children:m.jsx(mr,{defaultValue:v.localisedName.zh+"/"+v.localisedName.en,isDisabled:!0})}),l?m.jsx(oe,{mx:1,size:"sm",variant:"outline",onClick:()=>f(!1),children:r("Cancel")}):x?m.jsx(oe,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>f(!0),children:r("Connect to main line")}):m.jsx(oe,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:B,isDisabled:!C,children:r("Disconnect from main line")})]}),l&&m.jsxs(Pe,{alignItems:"center",children:[m.jsx(xt,{label:r("Target station"),flex:1,children:m.jsx(gr,{defaultValue:_,options:j,disabledOptions:[""],onChange:({target:{value:z}})=>y(z)})}),m.jsx(oe,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!_,children:r("Confirm")})]})]})}function ii(){const{t:a}=le(),c=ue(),{style:r,loop:s}=Q(l=>l.param),i=Q(l=>l.app.selectedBranch),[e,n]=J.useState(!1),t=()=>{c(os(r===X.SHMetro)),de.event(we.REVERSE_STATIONS,{style:r})};return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("BranchSidePanel.action.title")}),m.jsxs(Pe,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type), &:not(button)":{marginTop:2}}},children:[i!==0&&r!==X.SHMetro&&m.jsxs(m.Fragment,{children:[m.jsx(ve,{as:"h6",size:"xs",children:a("Branch left end")}),m.jsx(tn,{direction:Se.left}),m.jsx(ve,{as:"h6",size:"xs",children:a("Branch right end")}),m.jsx(tn,{direction:Se.right})]}),r===X.GZMTR&&m.jsx(oe,{size:"sm",variant:"outline",leftIcon:m.jsx(br,{}),alignSelf:"flex-end",onClick:()=>n(!0),children:a("BranchSidePanel.action.autoNum")}),m.jsx(oe,{size:"sm",variant:"outline",leftIcon:m.jsx(_r,{}),alignSelf:"flex-end",onClick:t,children:r===X.SHMetro?a("BranchSidePanel.action.flip"):a("BranchSidePanel.action.reverse")}),s&&r===X.GZMTR&&m.jsxs(Oe,{children:[m.jsx(oe,{size:"sm",variant:"outline",leftIcon:m.jsx(vr,{}),onClick:()=>c(Yt(!1)),flex:1,children:a("Rotate anticlockwise")}),m.jsx(oe,{size:"sm",variant:"outline",leftIcon:m.jsx(yr,{}),onClick:()=>c(Yt(!0)),flex:1,children:a("Rotate clockwise")})]})]}),m.jsx(ti,{isOpen:e,onClose:()=>n(!1)})]})}function ai(){const{t:a}=le(),c=ue(),{branches:r}=Q(v=>v.helper),{loop_info:s,style:i,stn_list:e}=Q(v=>v.param),{bank:n,left_and_right_factor:t,bottom_factor:l,clockwise:f}=s,_=r.flat().filter((v=>u=>(v[u]=(v[u]||0)+1)===2)({})).filter(v=>!["linestart","lineend"].includes(v)),y=Math.abs(r[0].indexOf(_[0])-r[0].indexOf(_[1])),g=r.length>=2?(0,Math.min)(r[0].length-2-y,y):Math.floor((r[0].length-2-l*2)/2),h=[{type:"switch",label:a("StyleSidePanel.loop.isBank"),isChecked:n,onChange:v=>c(Sr(v)),minW:"full",oneLine:!0,hidden:i!==X.SHMetro},{type:"slider",label:a("StyleSidePanel.loop.leftRightFactor"),value:t,min:0,max:g,onChange:v=>c(xr(Math.floor(v))),hidden:i!==X.SHMetro},{type:"slider",label:a("StyleSidePanel.loop.bottomFactor"),value:l,min:0,max:Math.floor((r[0].length-2-t*2)/2),onChange:v=>c(wr(Math.floor(v))),hidden:r.length>2||i!==X.SHMetro},{type:"custom",label:a("Loop direction"),component:m.jsx(je,{selections:[{label:a("Anticlockwise"),value:!1},{label:a("Clockwise"),value:!0}],defaultValue:f??!1,onChange:v=>c(kr(v))}),hidden:![X.GZMTR].includes(i)},{type:"select",label:a("Midpoint station"),options:r[0].slice(1,-1).reduce((v,u)=>{const{zh:p,en:b}=e[u].localisedName;return{...v,[u]:`${p}/${b}`}},{}),value:s.midpoint_station,onChange:v=>c(pn(v)),hidden:![X.GZMTR].includes(i)}];return m.jsxs(ke,{p:1,children:[m.jsx(ve,{as:"h5",size:"sm",children:a("StyleSidePanel.loop.title")}),m.jsx(ge,{fields:h})]})}function oi(){const a=Q(e=>e.app.selectedBranch),{style:c,stn_list:r,loop:s}=Q(e=>e.param),i=Q(e=>e.helper.branches);return m.jsxs(zt,{children:[c===X.SHMetro&&(a===0||We(i[a],r))&&m.jsxs(m.Fragment,{children:[m.jsx(ei,{}),m.jsx(Ie,{})]}),s&&m.jsxs(m.Fragment,{children:[m.jsx(ai,{}),m.jsx(Ie,{})]}),m.jsx(ii,{})]})}const li="rmg-palette-bridge--",ci={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function di(a){const{isOpen:c,onClose:r,defaultTheme:s,onSelect:i}=a,[e]=J.useState(qe()),[n,t]=J.useState(!1),l="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:de.getAppName(),parentId:e}),f=J.useRef();return J.useEffect(()=>{const _=new BroadcastChannel(li+e);return f.current=_,_.onmessage=y=>{const{event:g,data:h}=y.data;console.log("[rmg] Received event from Palette app clip:",g),g==="CLOSE"?r():g==="SELECT"?i(h):g==="LOADED"&&t(!0)},()=>{_.close()}},[]),J.useEffect(()=>{s&&f.current?.postMessage({event:"OPEN",data:s})},[n,s?.toString()]),m.jsxs(mn,{size:"md",isOpen:c,onClose:r,sx:ci,children:[m.jsx(sn,{onClick:r}),m.jsx("iframe",{src:l,loading:"eager"})]})}const hi=410;function ui(){const{t:a}=le(),c=on(),{sidePanelMode:r,selectedStation:s,paletteAppClipInput:i}=Q(l=>l.app),e=Q(l=>l.param.stn_list[s]?.localisedName),n={STATION:{header:m.jsx(rs,{text:e?.zh+"/"+e?.en||""}),body:m.jsx(Ts,{}),footer:m.jsx(Js,{})},STYLE:{header:a("StyleSidePanel.header"),body:m.jsx(Ls,{})},BRANCH:{header:a("BranchSidePanel.header"),body:m.jsx(oi,{})},CLOSE:{header:"Close"}},t=()=>{c(Le(Me.CLOSE))};return m.jsxs(Cr,{isOpen:r!==Me.CLOSE,width:hi,header:"Dummy header",children:[m.jsx(jr,{onClose:t,children:n[r].header}),n[r]?.body,n[r]?.footer,m.jsx(di,{isOpen:!!i,onClose:()=>c(Er()),defaultTheme:i,onSelect:l=>c(Ar(l))})]})}function ot(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var yt={exports:{}};var nn;function fi(){return nn||(nn=1,function(a,c){(function(r){a.exports=r()})(function(){return function r(s,i,e){function n(f,_){if(!i[f]){if(!s[f]){var y=typeof ot=="function"&&ot;if(!_&&y)return y(f,!0);if(t)return t(f,!0);var g=new Error("Cannot find module '"+f+"'");throw g.code="MODULE_NOT_FOUND",g}var h=i[f]={exports:{}};s[f][0].call(h.exports,function(v){var u=s[f][1][v];return n(u||v)},h,h.exports,r,s,i,e)}return i[f].exports}for(var t=typeof ot=="function"&&ot,l=0;l<e.length;l++)n(e[l]);return n}({1:[function(r,s,i){var e=r("./utils"),n=r("./support"),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var f,_,y,g,h,v,u,p=[],b=0,x=l.length,C=x,j=e.getTypeOf(l)!=="string";b<l.length;)C=x-b,y=j?(f=l[b++],_=b<x?l[b++]:0,b<x?l[b++]:0):(f=l.charCodeAt(b++),_=b<x?l.charCodeAt(b++):0,b<x?l.charCodeAt(b++):0),g=f>>2,h=(3&f)<<4|_>>4,v=1<C?(15&_)<<2|y>>6:64,u=2<C?63&y:64,p.push(t.charAt(g)+t.charAt(h)+t.charAt(v)+t.charAt(u));return p.join("")},i.decode=function(l){var f,_,y,g,h,v,u=0,p=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===t.charAt(64)&&C--,l.charAt(l.length-2)===t.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=n.uint8array?new Uint8Array(0|C):new Array(0|C);u<l.length;)f=t.indexOf(l.charAt(u++))<<2|(g=t.indexOf(l.charAt(u++)))>>4,_=(15&g)<<4|(h=t.indexOf(l.charAt(u++)))>>2,y=(3&h)<<6|(v=t.indexOf(l.charAt(u++))),x[p++]=f,h!==64&&(x[p++]=_),v!==64&&(x[p++]=y);return x}},{"./support":30,"./utils":32}],2:[function(r,s,i){var e=r("./external"),n=r("./stream/DataWorker"),t=r("./stream/Crc32Probe"),l=r("./stream/DataLengthProbe");function f(_,y,g,h,v){this.compressedSize=_,this.uncompressedSize=y,this.crc32=g,this.compression=h,this.compressedContent=v}f.prototype={getContentWorker:function(){var _=new n(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),y=this;return _.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),_},getCompressedWorker:function(){return new n(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(_,y,g){return _.pipe(new t).pipe(new l("uncompressedSize")).pipe(y.compressWorker(g)).pipe(new l("compressedSize")).withStreamInfo("compression",y)},s.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,s,i){var e=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,s,i){var e=r("./utils"),n=function(){for(var t,l=[],f=0;f<256;f++){t=f;for(var _=0;_<8;_++)t=1&t?3988292384^t>>>1:t>>>1;l[f]=t}return l}();s.exports=function(t,l){return t!==void 0&&t.length?e.getTypeOf(t)!=="string"?function(f,_,y,g){var h=n,v=g+y;f^=-1;for(var u=g;u<v;u++)f=f>>>8^h[255&(f^_[u])];return-1^f}(0|l,t,t.length,0):function(f,_,y,g){var h=n,v=g+y;f^=-1;for(var u=g;u<v;u++)f=f>>>8^h[255&(f^_.charCodeAt(u))];return-1^f}(0|l,t,t.length,0):0}},{"./utils":32}],5:[function(r,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,s,i){var e=null;e=typeof Promise<"u"?Promise:r("lie"),s.exports={Promise:e}},{lie:37}],7:[function(r,s,i){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=r("pako"),t=r("./utils"),l=r("./stream/GenericWorker"),f=e?"uint8array":"array";function _(y,g){l.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=g,this.meta={}}i.magic="\b\0",t.inherits(_,l),_.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(t.transformTo(f,y.data),!1)},_.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},_.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},_.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(g){y.push({data:g,meta:y.meta})}},i.compressWorker=function(y){return new _("Deflate",y)},i.uncompressWorker=function(){return new _("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,s,i){function e(h,v){var u,p="";for(u=0;u<v;u++)p+=String.fromCharCode(255&h),h>>>=8;return p}function n(h,v,u,p,b,x){var C,j,A=h.file,B=h.compression,z=x!==f.utf8encode,L=t.transformTo("string",x(A.name)),P=t.transformTo("string",f.utf8encode(A.name)),U=A.comment,$=t.transformTo("string",x(U)),k=t.transformTo("string",f.utf8encode(U)),O=P.length!==A.name.length,d=k.length!==U.length,M="",ne="",Z="",se=A.dir,G=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};v&&!u||(re.crc32=h.crc32,re.compressedSize=h.compressedSize,re.uncompressedSize=h.uncompressedSize);var N=0;v&&(N|=8),z||!O&&!d||(N|=2048);var T=0,te=0;se&&(T|=16),b==="UNIX"?(te=798,T|=function(Y,fe){var ye=Y;return Y||(ye=fe?16893:33204),(65535&ye)<<16}(A.unixPermissions,se)):(te=20,T|=function(Y){return 63&(Y||0)}(A.dosPermissions)),C=G.getUTCHours(),C<<=6,C|=G.getUTCMinutes(),C<<=5,C|=G.getUTCSeconds()/2,j=G.getUTCFullYear()-1980,j<<=4,j|=G.getUTCMonth()+1,j<<=5,j|=G.getUTCDate(),O&&(ne=e(1,1)+e(_(L),4)+P,M+="up"+e(ne.length,2)+ne),d&&(Z=e(1,1)+e(_($),4)+k,M+="uc"+e(Z.length,2)+Z);var q="";return q+=`
\0`,q+=e(N,2),q+=B.magic,q+=e(C,2),q+=e(j,2),q+=e(re.crc32,4),q+=e(re.compressedSize,4),q+=e(re.uncompressedSize,4),q+=e(L.length,2),q+=e(M.length,2),{fileRecord:y.LOCAL_FILE_HEADER+q+L+M,dirRecord:y.CENTRAL_FILE_HEADER+e(te,2)+q+e($.length,2)+"\0\0\0\0"+e(T,4)+e(p,4)+L+M+$}}var t=r("../utils"),l=r("../stream/GenericWorker"),f=r("../utf8"),_=r("../crc32"),y=r("../signature");function g(h,v,u,p){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=v,this.zipPlatform=u,this.encodeFileName=p,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}t.inherits(g,l),g.prototype.push=function(h){var v=h.meta.percent||0,u=this.entriesCount,p=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,l.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:u?(v+100*(u-p-1))/u:100}}))},g.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var v=this.streamFiles&&!h.file.dir;if(v){var u=n(h,v,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:u.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(h){this.accumulate=!1;var v=this.streamFiles&&!h.file.dir,u=n(h,v,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(u.dirRecord),v)this.push({data:function(p){return y.DATA_DESCRIPTOR+e(p.crc32,4)+e(p.compressedSize,4)+e(p.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:u.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var h=this.bytesWritten,v=0;v<this.dirRecords.length;v++)this.push({data:this.dirRecords[v],meta:{percent:100}});var u=this.bytesWritten-h,p=function(b,x,C,j,A){var B=t.transformTo("string",A(j));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+e(b,2)+e(b,2)+e(x,4)+e(C,4)+e(B.length,2)+B}(this.dirRecords.length,u,h,this.zipComment,this.encodeFileName);this.push({data:p,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(h){this._sources.push(h);var v=this;return h.on("data",function(u){v.processChunk(u)}),h.on("end",function(){v.closedSource(v.previous.streamInfo),v._sources.length?v.prepareNextSource():v.end()}),h.on("error",function(u){v.error(u)}),this},g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(h){var v=this._sources;if(!l.prototype.error.call(this,h))return!1;for(var u=0;u<v.length;u++)try{v[u].error(h)}catch{}return!0},g.prototype.lock=function(){l.prototype.lock.call(this);for(var h=this._sources,v=0;v<h.length;v++)h[v].lock()},s.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,s,i){var e=r("../compressions"),n=r("./ZipFileWorker");i.generateWorker=function(t,l,f){var _=new n(l.streamFiles,f,l.platform,l.encodeFileName),y=0;try{t.forEach(function(g,h){y++;var v=function(x,C){var j=x||C,A=e[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(h.options.compression,l.compression),u=h.options.compressionOptions||l.compressionOptions||{},p=h.dir,b=h.date;h._compressWorker(v,u).withStreamInfo("file",{name:g,dir:p,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(_)}),_.entriesCount=y}catch(g){_.error(g)}return _}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,s,i){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new e;for(var t in this)typeof this[t]!="function"&&(n[t]=this[t]);return n}}(e.prototype=r("./object")).loadAsync=r("./load"),e.support=r("./support"),e.defaults=r("./defaults"),e.version="3.10.1",e.loadAsync=function(n,t){return new e().loadAsync(n,t)},e.external=r("./external"),s.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,s,i){var e=r("./utils"),n=r("./external"),t=r("./utf8"),l=r("./zipEntries"),f=r("./stream/Crc32Probe"),_=r("./nodejsUtils");function y(g){return new n.Promise(function(h,v){var u=g.decompressed.getContentWorker().pipe(new f);u.on("error",function(p){v(p)}).on("end",function(){u.streamInfo.crc32!==g.decompressed.crc32?v(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}s.exports=function(g,h){var v=this;return h=e.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:t.utf8decode}),_.isNode&&_.isStream(g)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",g,!0,h.optimizedBinaryString,h.base64).then(function(u){var p=new l(h);return p.load(u),p}).then(function(u){var p=[n.Promise.resolve(u)],b=u.files;if(h.checkCRC32)for(var x=0;x<b.length;x++)p.push(y(b[x]));return n.Promise.all(p)}).then(function(u){for(var p=u.shift(),b=p.files,x=0;x<b.length;x++){var C=b[x],j=C.fileNameStr,A=e.resolve(C.fileNameStr);v.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:h.createFolders}),C.dir||(v.file(A).unsafeOriginalName=j)}return p.zipComment.length&&(v.comment=p.zipComment),v})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,s,i){var e=r("../utils"),n=r("../stream/GenericWorker");function t(l,f){n.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(f)}e.inherits(t,n),t.prototype._bindStream=function(l){var f=this;(this._stream=l).pause(),l.on("data",function(_){f.push({data:_,meta:{percent:0}})}).on("error",function(_){f.isPaused?this.generatedError=_:f.error(_)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},t.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},t.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=t},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,s,i){var e=r("readable-stream").Readable;function n(t,l,f){e.call(this,l),this._helper=t;var _=this;t.on("data",function(y,g){_.push(y)||_._helper.pause(),f&&f(g)}).on("error",function(y){_.emit("error",y)}).on("end",function(){_.push(null)})}r("../utils").inherits(n,e),n.prototype._read=function(){this._helper.resume()},s.exports=n},{"../utils":32,"readable-stream":16}],14:[function(r,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(e,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,n);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,n)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var n=new Buffer(e);return n.fill(0),n},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}},{}],15:[function(r,s,i){function e(A,B,z){var L,P=t.getTypeOf(B),U=t.extend(z||{},_);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(A=b(A)),U.createFolders&&(L=p(A))&&x.call(this,L,!0);var $=P==="string"&&U.binary===!1&&U.base64===!1;z&&z.binary!==void 0||(U.binary=!$),(B instanceof y&&B.uncompressedSize===0||U.dir||!B||B.length===0)&&(U.base64=!1,U.binary=!0,B="",U.compression="STORE",P="string");var k=null;k=B instanceof y||B instanceof l?B:v.isNode&&v.isStream(B)?new u(A,B):t.prepareContent(A,B,U.binary,U.optimizedBinaryString,U.base64);var O=new g(A,k,U);this.files[A]=O}var n=r("./utf8"),t=r("./utils"),l=r("./stream/GenericWorker"),f=r("./stream/StreamHelper"),_=r("./defaults"),y=r("./compressedObject"),g=r("./zipObject"),h=r("./generate"),v=r("./nodejsUtils"),u=r("./nodejs/NodejsStreamInputAdapter"),p=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var B=A.lastIndexOf("/");return 0<B?A.substring(0,B):""},b=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,B){return B=B!==void 0?B:_.createFolders,A=b(A),this.files[A]||e.call(this,A,null,{dir:!0,createFolders:B}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var B,z,L;for(B in this.files)L=this.files[B],(z=B.slice(this.root.length,B.length))&&B.slice(0,this.root.length)===this.root&&A(z,L)},filter:function(A){var B=[];return this.forEach(function(z,L){A(z,L)&&B.push(L)}),B},file:function(A,B,z){if(arguments.length!==1)return A=this.root+A,e.call(this,A,B,z),this;if(C(A)){var L=A;return this.filter(function(U,$){return!$.dir&&L.test(U)})}var P=this.files[this.root+A];return P&&!P.dir?P:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(P,U){return U.dir&&A.test(P)});var B=this.root+A,z=x.call(this,B),L=this.clone();return L.root=z.name,L},remove:function(A){A=this.root+A;var B=this.files[A];if(B||(A.slice(-1)!=="/"&&(A+="/"),B=this.files[A]),B&&!B.dir)delete this.files[A];else for(var z=this.filter(function(P,U){return U.name.slice(0,A.length)===A}),L=0;L<z.length;L++)delete this.files[z[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var B,z={};try{if((z=t.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=z.type.toLowerCase(),z.compression=z.compression.toUpperCase(),z.type==="binarystring"&&(z.type="string"),!z.type)throw new Error("No output type specified.");t.checkSupport(z.type),z.platform!=="darwin"&&z.platform!=="freebsd"&&z.platform!=="linux"&&z.platform!=="sunos"||(z.platform="UNIX"),z.platform==="win32"&&(z.platform="DOS");var L=z.comment||this.comment||"";B=h.generateWorker(this,z,L)}catch(P){(B=new l("error")).error(P)}return new f(B,z.type||"string",z.mimeType)},generateAsync:function(A,B){return this.generateInternalStream(A).accumulate(B)},generateNodeStream:function(A,B){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(B)}};s.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,s,i){s.exports=r("stream")},{stream:void 0}],17:[function(r,s,i){var e=r("./DataReader");function n(t){e.call(this,t);for(var l=0;l<this.data.length;l++)t[l]=255&t[l]}r("../utils").inherits(n,e),n.prototype.byteAt=function(t){return this.data[this.zero+t]},n.prototype.lastIndexOfSignature=function(t){for(var l=t.charCodeAt(0),f=t.charCodeAt(1),_=t.charCodeAt(2),y=t.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===l&&this.data[g+1]===f&&this.data[g+2]===_&&this.data[g+3]===y)return g-this.zero;return-1},n.prototype.readAndCheckSignature=function(t){var l=t.charCodeAt(0),f=t.charCodeAt(1),_=t.charCodeAt(2),y=t.charCodeAt(3),g=this.readData(4);return l===g[0]&&f===g[1]&&_===g[2]&&y===g[3]},n.prototype.readData=function(t){if(this.checkOffset(t),t===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,l},s.exports=n},{"../utils":32,"./DataReader":18}],18:[function(r,s,i){var e=r("../utils");function n(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var l,f=0;for(this.checkOffset(t),l=this.index+t-1;l>=this.index;l--)f=(f<<8)+this.byteAt(l);return this.index+=t,f},readString:function(t){return e.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},s.exports=n},{"../utils":32}],19:[function(r,s,i){var e=r("./Uint8ArrayReader");function n(t){e.call(this,t)}r("../utils").inherits(n,e),n.prototype.readData=function(t){this.checkOffset(t);var l=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,l},s.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,s,i){var e=r("./DataReader");function n(t){e.call(this,t)}r("../utils").inherits(n,e),n.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},n.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},n.prototype.readData=function(t){this.checkOffset(t);var l=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,l},s.exports=n},{"../utils":32,"./DataReader":18}],21:[function(r,s,i){var e=r("./ArrayReader");function n(t){e.call(this,t)}r("../utils").inherits(n,e),n.prototype.readData=function(t){if(this.checkOffset(t),t===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,l},s.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(r,s,i){var e=r("../utils"),n=r("../support"),t=r("./ArrayReader"),l=r("./StringReader"),f=r("./NodeBufferReader"),_=r("./Uint8ArrayReader");s.exports=function(y){var g=e.getTypeOf(y);return e.checkSupport(g),g!=="string"||n.uint8array?g==="nodebuffer"?new f(y):n.uint8array?new _(e.transformTo("uint8array",y)):new t(e.transformTo("array",y)):new l(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,s,i){var e=r("./GenericWorker"),n=r("../utils");function t(l){e.call(this,"ConvertWorker to "+l),this.destType=l}n.inherits(t,e),t.prototype.processChunk=function(l){this.push({data:n.transformTo(this.destType,l.data),meta:l.meta})},s.exports=t},{"../utils":32,"./GenericWorker":28}],25:[function(r,s,i){var e=r("./GenericWorker"),n=r("../crc32");function t(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(t,e),t.prototype.processChunk=function(l){this.streamInfo.crc32=n(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=t},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,s,i){var e=r("../utils"),n=r("./GenericWorker");function t(l){n.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}e.inherits(t,n),t.prototype.processChunk=function(l){if(l){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+l.data.length}n.prototype.processChunk.call(this,l)},s.exports=t},{"../utils":32,"./GenericWorker":28}],27:[function(r,s,i){var e=r("../utils"),n=r("./GenericWorker");function t(l){n.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(_){f.dataIsReady=!0,f.data=_,f.max=_&&_.length||0,f.type=e.getTypeOf(_),f.isPaused||f._tickAndRepeat()},function(_){f.error(_)})}e.inherits(t,n),t.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},t.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},t.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},t.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,f);break;case"uint8array":l=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":l=this.data.slice(this.index,f)}return this.index=f,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=t},{"../utils":32,"./GenericWorker":28}],28:[function(r,s,i){function e(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}e.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,t){return this._listeners[n].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,t){if(this._listeners[n])for(var l=0;l<this._listeners[n].length;l++)this._listeners[n][l].call(this,t)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var t=this;return n.on("data",function(l){t.processChunk(l)}),n.on("end",function(){t.end()}),n.on("error",function(l){t.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,t){return this.extraStreamInfo[n]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},s.exports=e},{}],29:[function(r,s,i){var e=r("../utils"),n=r("./ConvertWorker"),t=r("./GenericWorker"),l=r("../base64"),f=r("../support"),_=r("../external"),y=null;if(f.nodestream)try{y=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(v,u){return new _.Promise(function(p,b){var x=[],C=v._internalType,j=v._outputType,A=v._mimeType;v.on("data",function(B,z){x.push(B),u&&u(z)}).on("error",function(B){x=[],b(B)}).on("end",function(){try{var B=function(z,L,P){switch(z){case"blob":return e.newBlob(e.transformTo("arraybuffer",L),P);case"base64":return l.encode(L);default:return e.transformTo(z,L)}}(j,function(z,L){var P,U=0,$=null,k=0;for(P=0;P<L.length;P++)k+=L[P].length;switch(z){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for($=new Uint8Array(k),P=0;P<L.length;P++)$.set(L[P],U),U+=L[P].length;return $;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+z+"'")}}(C,x),A);p(B)}catch(z){b(z)}x=[]}).resume()})}function h(v,u,p){var b=u;switch(u){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=u,this._mimeType=p,e.checkSupport(b),this._worker=v.pipe(new n(b)),v.lock()}catch(x){this._worker=new t("error"),this._worker.error(x)}}h.prototype={accumulate:function(v){return g(this,v)},on:function(v,u){var p=this;return v==="data"?this._worker.on(v,function(b){u.call(p,b.data,b.meta)}):this._worker.on(v,function(){e.delay(u,arguments,p)}),this},resume:function(){return e.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(v){if(e.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},v)}},s.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var e=new ArrayBuffer(0);try{i.blob=new Blob([e],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(e),i.blob=n.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,s,i){for(var e=r("./utils"),n=r("./support"),t=r("./nodejsUtils"),l=r("./stream/GenericWorker"),f=new Array(256),_=0;_<256;_++)f[_]=252<=_?6:248<=_?5:240<=_?4:224<=_?3:192<=_?2:1;f[254]=f[254]=1;function y(){l.call(this,"utf-8 decode"),this.leftOver=null}function g(){l.call(this,"utf-8 encode")}i.utf8encode=function(h){return n.nodebuffer?t.newBufferFrom(h,"utf-8"):function(v){var u,p,b,x,C,j=v.length,A=0;for(x=0;x<j;x++)(64512&(p=v.charCodeAt(x)))==55296&&x+1<j&&(64512&(b=v.charCodeAt(x+1)))==56320&&(p=65536+(p-55296<<10)+(b-56320),x++),A+=p<128?1:p<2048?2:p<65536?3:4;for(u=n.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(p=v.charCodeAt(x)))==55296&&x+1<j&&(64512&(b=v.charCodeAt(x+1)))==56320&&(p=65536+(p-55296<<10)+(b-56320),x++),p<128?u[C++]=p:(p<2048?u[C++]=192|p>>>6:(p<65536?u[C++]=224|p>>>12:(u[C++]=240|p>>>18,u[C++]=128|p>>>12&63),u[C++]=128|p>>>6&63),u[C++]=128|63&p);return u}(h)},i.utf8decode=function(h){return n.nodebuffer?e.transformTo("nodebuffer",h).toString("utf-8"):function(v){var u,p,b,x,C=v.length,j=new Array(2*C);for(u=p=0;u<C;)if((b=v[u++])<128)j[p++]=b;else if(4<(x=f[b]))j[p++]=65533,u+=x-1;else{for(b&=x===2?31:x===3?15:7;1<x&&u<C;)b=b<<6|63&v[u++],x--;1<x?j[p++]=65533:b<65536?j[p++]=b:(b-=65536,j[p++]=55296|b>>10&1023,j[p++]=56320|1023&b)}return j.length!==p&&(j.subarray?j=j.subarray(0,p):j.length=p),e.applyFromCharCode(j)}(h=e.transformTo(n.uint8array?"uint8array":"array",h))},e.inherits(y,l),y.prototype.processChunk=function(h){var v=e.transformTo(n.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var u=v;(v=new Uint8Array(u.length+this.leftOver.length)).set(this.leftOver,0),v.set(u,this.leftOver.length)}else v=this.leftOver.concat(v);this.leftOver=null}var p=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+f[x[j]]>C?j:C}(v),b=v;p!==v.length&&(n.uint8array?(b=v.subarray(0,p),this.leftOver=v.subarray(p,v.length)):(b=v.slice(0,p),this.leftOver=v.slice(p,v.length))),this.push({data:i.utf8decode(b),meta:h.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=y,e.inherits(g,l),g.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,s,i){var e=r("./support"),n=r("./base64"),t=r("./nodejsUtils"),l=r("./external");function f(u){return u}function _(u,p){for(var b=0;b<u.length;++b)p[b]=255&u.charCodeAt(b);return p}r("setimmediate"),i.newBlob=function(u,p){i.checkSupport("blob");try{return new Blob([u],{type:p})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(u),b.getBlob(p)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(u,p,b){var x=[],C=0,j=u.length;if(j<=b)return String.fromCharCode.apply(null,u);for(;C<j;)p==="array"||p==="nodebuffer"?x.push(String.fromCharCode.apply(null,u.slice(C,Math.min(C+b,j)))):x.push(String.fromCharCode.apply(null,u.subarray(C,Math.min(C+b,j)))),C+=b;return x.join("")},stringifyByChar:function(u){for(var p="",b=0;b<u.length;b++)p+=String.fromCharCode(u[b]);return p},applyCanBeUsed:{uint8array:function(){try{return e.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return e.nodebuffer&&String.fromCharCode.apply(null,t.allocBuffer(1)).length===1}catch{return!1}}()}};function g(u){var p=65536,b=i.getTypeOf(u),x=!0;if(b==="uint8array"?x=y.applyCanBeUsed.uint8array:b==="nodebuffer"&&(x=y.applyCanBeUsed.nodebuffer),x)for(;1<p;)try{return y.stringifyByChunk(u,b,p)}catch{p=Math.floor(p/2)}return y.stringifyByChar(u)}function h(u,p){for(var b=0;b<u.length;b++)p[b]=u[b];return p}i.applyFromCharCode=g;var v={};v.string={string:f,array:function(u){return _(u,new Array(u.length))},arraybuffer:function(u){return v.string.uint8array(u).buffer},uint8array:function(u){return _(u,new Uint8Array(u.length))},nodebuffer:function(u){return _(u,t.allocBuffer(u.length))}},v.array={string:g,array:f,arraybuffer:function(u){return new Uint8Array(u).buffer},uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return t.newBufferFrom(u)}},v.arraybuffer={string:function(u){return g(new Uint8Array(u))},array:function(u){return h(new Uint8Array(u),new Array(u.byteLength))},arraybuffer:f,uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return t.newBufferFrom(new Uint8Array(u))}},v.uint8array={string:g,array:function(u){return h(u,new Array(u.length))},arraybuffer:function(u){return u.buffer},uint8array:f,nodebuffer:function(u){return t.newBufferFrom(u)}},v.nodebuffer={string:g,array:function(u){return h(u,new Array(u.length))},arraybuffer:function(u){return v.nodebuffer.uint8array(u).buffer},uint8array:function(u){return h(u,new Uint8Array(u.length))},nodebuffer:f},i.transformTo=function(u,p){if(p=p||"",!u)return p;i.checkSupport(u);var b=i.getTypeOf(p);return v[b][u](p)},i.resolve=function(u){for(var p=u.split("/"),b=[],x=0;x<p.length;x++){var C=p[x];C==="."||C===""&&x!==0&&x!==p.length-1||(C===".."?b.pop():b.push(C))}return b.join("/")},i.getTypeOf=function(u){return typeof u=="string"?"string":Object.prototype.toString.call(u)==="[object Array]"?"array":e.nodebuffer&&t.isBuffer(u)?"nodebuffer":e.uint8array&&u instanceof Uint8Array?"uint8array":e.arraybuffer&&u instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(u){if(!e[u.toLowerCase()])throw new Error(u+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(u){var p,b,x="";for(b=0;b<(u||"").length;b++)x+="\\x"+((p=u.charCodeAt(b))<16?"0":"")+p.toString(16).toUpperCase();return x},i.delay=function(u,p,b){setImmediate(function(){u.apply(b||null,p||[])})},i.inherits=function(u,p){function b(){}b.prototype=p.prototype,u.prototype=new b},i.extend=function(){var u,p,b={};for(u=0;u<arguments.length;u++)for(p in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],p)&&b[p]===void 0&&(b[p]=arguments[u][p]);return b},i.prepareContent=function(u,p,b,x,C){return l.Promise.resolve(p).then(function(j){return e.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new l.Promise(function(A,B){var z=new FileReader;z.onload=function(L){A(L.target.result)},z.onerror=function(L){B(L.target.error)},z.readAsArrayBuffer(j)}):j}).then(function(j){var A=i.getTypeOf(j);return A?(A==="arraybuffer"?j=i.transformTo("uint8array",j):A==="string"&&(C?j=n.decode(j):b&&x!==!0&&(j=function(B){return _(B,e.uint8array?new Uint8Array(B.length):new Array(B.length))}(j))),j):l.Promise.reject(new Error("Can't read the data of '"+u+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,s,i){var e=r("./reader/readerFor"),n=r("./utils"),t=r("./signature"),l=r("./zipEntry"),f=r("./support");function _(y){this.files=[],this.loadOptions=y}_.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(g)+", expected "+n.pretty(y)+")")}},isSignature:function(y,g){var h=this.reader.index;this.reader.setIndex(y);var v=this.reader.readString(4)===g;return this.reader.setIndex(h),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),g=f.uint8array?"uint8array":"array",h=n.transformTo(g,y);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,g,h,v=this.zip64EndOfCentralSize-44;0<v;)y=this.reader.readInt(2),g=this.reader.readInt(4),h=this.reader.readData(g),this.zip64ExtensibleData[y]={id:y,length:g,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,g;for(y=0;y<this.files.length;y++)g=this.files[y],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(t.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(t.CENTRAL_FILE_HEADER);)(y=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(t.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,t.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var g=y;if(this.checkSignature(t.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,t.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var v=g-h;if(0<v)this.isSignature(g,t.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(y){this.reader=e(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=_},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,s,i){var e=r("./reader/readerFor"),n=r("./utils"),t=r("./compressedObject"),l=r("./crc32"),f=r("./utf8"),_=r("./compressions"),y=r("./support");function g(h,v){this.options=h,this.loadOptions=v}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var v,u;if(h.skip(22),this.fileNameLength=h.readInt(2),u=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((v=function(p){for(var b in _)if(Object.prototype.hasOwnProperty.call(_,b)&&_[b].magic===p)return _[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new t(this.compressedSize,this.uncompressedSize,this.crc32,v,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var v=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(v),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=e(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var v,u,p,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)v=h.readInt(2),u=h.readInt(2),p=h.readData(u),this.extraFields[v]={id:v,length:u,value:p};h.setIndex(b)},handleUTF8:function(){var h=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var v=this.findExtraFieldUnicodePath();if(v!==null)this.fileNameStr=v;else{var u=n.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var p=this.findExtraFieldUnicodeComment();if(p!==null)this.fileCommentStr=p;else{var b=n.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var v=e(h.value);return v.readInt(1)!==1||l(this.fileName)!==v.readInt(4)?null:f.utf8decode(v.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var v=e(h.value);return v.readInt(1)!==1||l(this.fileComment)!==v.readInt(4)?null:f.utf8decode(v.readData(h.length-5))}return null}},s.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,s,i){function e(v,u,p){this.name=v,this.dir=p.dir,this.date=p.date,this.comment=p.comment,this.unixPermissions=p.unixPermissions,this.dosPermissions=p.dosPermissions,this._data=u,this._dataBinary=p.binary,this.options={compression:p.compression,compressionOptions:p.compressionOptions}}var n=r("./stream/StreamHelper"),t=r("./stream/DataWorker"),l=r("./utf8"),f=r("./compressedObject"),_=r("./stream/GenericWorker");e.prototype={internalStream:function(v){var u=null,p="string";try{if(!v)throw new Error("No output type specified.");var b=(p=v.toLowerCase())==="string"||p==="text";p!=="binarystring"&&p!=="text"||(p="string"),u=this._decompressWorker();var x=!this._dataBinary;x&&!b&&(u=u.pipe(new l.Utf8EncodeWorker)),!x&&b&&(u=u.pipe(new l.Utf8DecodeWorker))}catch(C){(u=new _("error")).error(C)}return new n(u,p,"")},async:function(v,u){return this.internalStream(v).accumulate(u)},nodeStream:function(v,u){return this.internalStream(v||"nodebuffer").toNodejsStream(u)},_compressWorker:function(v,u){if(this._data instanceof f&&this._data.compression.magic===v.magic)return this._data.getCompressedWorker();var p=this._decompressWorker();return this._dataBinary||(p=p.pipe(new l.Utf8EncodeWorker)),f.createWorkerFrom(p,v,u)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof _?this._data:new t(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<y.length;h++)e.prototype[y[h]]=g;s.exports=e},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,s,i){(function(e){var n,t,l=e.MutationObserver||e.WebKitMutationObserver;if(l){var f=0,_=new l(v),y=e.document.createTextNode("");_.observe(y,{characterData:!0}),n=function(){y.data=f=++f%2}}else if(e.setImmediate||e.MessageChannel===void 0)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var u=e.document.createElement("script");u.onreadystatechange=function(){v(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},e.document.documentElement.appendChild(u)}:function(){setTimeout(v,0)};else{var g=new e.MessageChannel;g.port1.onmessage=v,n=function(){g.port2.postMessage(0)}}var h=[];function v(){var u,p;t=!0;for(var b=h.length;b;){for(p=h,h=[],u=-1;++u<b;)p[u]();b=h.length}t=!1}s.exports=function(u){h.push(u)!==1||t||n()}}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,s,i){var e=r("immediate");function n(){}var t={},l=["REJECTED"],f=["FULFILLED"],_=["PENDING"];function y(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=_,this.queue=[],this.outcome=void 0,b!==n&&u(this,b)}function g(b,x,C){this.promise=b,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function h(b,x,C){e(function(){var j;try{j=x(C)}catch(A){return t.reject(b,A)}j===b?t.reject(b,new TypeError("Cannot resolve promise with itself")):t.resolve(b,j)})}function v(b){var x=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof x=="function")return function(){x.apply(b,arguments)}}function u(b,x){var C=!1;function j(z){C||(C=!0,t.reject(b,z))}function A(z){C||(C=!0,t.resolve(b,z))}var B=p(function(){x(A,j)});B.status==="error"&&j(B.value)}function p(b,x){var C={};try{C.value=b(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(s.exports=y).prototype.finally=function(b){if(typeof b!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(b()).then(function(){return C})},function(C){return x.resolve(b()).then(function(){throw C})})},y.prototype.catch=function(b){return this.then(null,b)},y.prototype.then=function(b,x){if(typeof b!="function"&&this.state===f||typeof x!="function"&&this.state===l)return this;var C=new this.constructor(n);return this.state!==_?h(C,this.state===f?b:x,this.outcome):this.queue.push(new g(C,b,x)),C},g.prototype.callFulfilled=function(b){t.resolve(this.promise,b)},g.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},g.prototype.callRejected=function(b){t.reject(this.promise,b)},g.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},t.resolve=function(b,x){var C=p(v,x);if(C.status==="error")return t.reject(b,C.value);var j=C.value;if(j)u(b,j);else{b.state=f,b.outcome=x;for(var A=-1,B=b.queue.length;++A<B;)b.queue[A].callFulfilled(x)}return b},t.reject=function(b,x){b.state=l,b.outcome=x;for(var C=-1,j=b.queue.length;++C<j;)b.queue[C].callRejected(x);return b},y.resolve=function(b){return b instanceof this?b:t.resolve(new this(n),b)},y.reject=function(b){var x=new this(n);return t.reject(x,b)},y.all=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=b.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),B=0,z=-1,L=new this(n);++z<C;)P(b[z],z);return L;function P(U,$){x.resolve(U).then(function(k){A[$]=k,++B!==C||j||(j=!0,t.resolve(L,A))},function(k){j||(j=!0,t.reject(L,k))})}},y.race=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=b.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,B=new this(n);++A<C;)z=b[A],x.resolve(z).then(function(L){j||(j=!0,t.resolve(B,L))},function(L){j||(j=!0,t.reject(B,L))});var z;return B}},{immediate:36}],38:[function(r,s,i){var e={};(0,r("./lib/utils/common").assign)(e,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),s.exports=e},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,s,i){var e=r("./zlib/deflate"),n=r("./utils/common"),t=r("./utils/strings"),l=r("./zlib/messages"),f=r("./zlib/zstream"),_=Object.prototype.toString,y=0,g=-1,h=0,v=8;function u(b){if(!(this instanceof u))return new u(b);this.options=n.assign({level:g,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var C=e.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==y)throw new Error(l[C]);if(x.header&&e.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?t.string2buf(x.dictionary):_.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=e.deflateSetDictionary(this.strm,j))!==y)throw new Error(l[C]);this._dict_set=!0}}function p(b,x){var C=new u(x);if(C.push(b,!0),C.err)throw C.msg||l[C.err];return C.result}u.prototype.push=function(b,x){var C,j,A=this.strm,B=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof b=="string"?A.input=t.string2buf(b):_.call(b)==="[object ArrayBuffer]"?A.input=new Uint8Array(b):A.input=b,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new n.Buf8(B),A.next_out=0,A.avail_out=B),(C=e.deflate(A,j))!==1&&C!==y)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(t.buf2binstring(n.shrinkBuf(A.output,A.next_out))):this.onData(n.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=e.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===y):j!==2||(this.onEnd(y),!(A.avail_out=0))},u.prototype.onData=function(b){this.chunks.push(b)},u.prototype.onEnd=function(b){b===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=u,i.deflate=p,i.deflateRaw=function(b,x){return(x=x||{}).raw=!0,p(b,x)},i.gzip=function(b,x){return(x=x||{}).gzip=!0,p(b,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,s,i){var e=r("./zlib/inflate"),n=r("./utils/common"),t=r("./utils/strings"),l=r("./zlib/constants"),f=r("./zlib/messages"),_=r("./zlib/zstream"),y=r("./zlib/gzheader"),g=Object.prototype.toString;function h(u){if(!(this instanceof h))return new h(u);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},u||{});var p=this.options;p.raw&&0<=p.windowBits&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(0<=p.windowBits&&p.windowBits<16)||u&&u.windowBits||(p.windowBits+=32),15<p.windowBits&&p.windowBits<48&&(15&p.windowBits)==0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _,this.strm.avail_out=0;var b=e.inflateInit2(this.strm,p.windowBits);if(b!==l.Z_OK)throw new Error(f[b]);this.header=new y,e.inflateGetHeader(this.strm,this.header)}function v(u,p){var b=new h(p);if(b.push(u,!0),b.err)throw b.msg||f[b.err];return b.result}h.prototype.push=function(u,p){var b,x,C,j,A,B,z=this.strm,L=this.options.chunkSize,P=this.options.dictionary,U=!1;if(this.ended)return!1;x=p===~~p?p:p===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof u=="string"?z.input=t.binstring2buf(u):g.call(u)==="[object ArrayBuffer]"?z.input=new Uint8Array(u):z.input=u,z.next_in=0,z.avail_in=z.input.length;do{if(z.avail_out===0&&(z.output=new n.Buf8(L),z.next_out=0,z.avail_out=L),(b=e.inflate(z,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&P&&(B=typeof P=="string"?t.string2buf(P):g.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,b=e.inflateSetDictionary(this.strm,B)),b===l.Z_BUF_ERROR&&U===!0&&(b=l.Z_OK,U=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);z.next_out&&(z.avail_out!==0&&b!==l.Z_STREAM_END&&(z.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=t.utf8border(z.output,z.next_out),j=z.next_out-C,A=t.buf2string(z.output,C),z.next_out=j,z.avail_out=L-j,j&&n.arraySet(z.output,z.output,C,j,0),this.onData(A)):this.onData(n.shrinkBuf(z.output,z.next_out)))),z.avail_in===0&&z.avail_out===0&&(U=!0)}while((0<z.avail_in||z.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(b=e.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(z.avail_out=0))},h.prototype.onData=function(u){this.chunks.push(u)},h.prototype.onEnd=function(u){u===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},i.Inflate=h,i.inflate=v,i.inflateRaw=function(u,p){return(p=p||{}).raw=!0,v(u,p)},i.ungzip=v},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,s,i){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var _=f.shift();if(_){if(typeof _!="object")throw new TypeError(_+"must be non-object");for(var y in _)_.hasOwnProperty(y)&&(l[y]=_[y])}}return l},i.shrinkBuf=function(l,f){return l.length===f?l:l.subarray?l.subarray(0,f):(l.length=f,l)};var n={arraySet:function(l,f,_,y,g){if(f.subarray&&l.subarray)l.set(f.subarray(_,_+y),g);else for(var h=0;h<y;h++)l[g+h]=f[_+h]},flattenChunks:function(l){var f,_,y,g,h,v;for(f=y=0,_=l.length;f<_;f++)y+=l[f].length;for(v=new Uint8Array(y),f=g=0,_=l.length;f<_;f++)h=l[f],v.set(h,g),g+=h.length;return v}},t={arraySet:function(l,f,_,y,g){for(var h=0;h<y;h++)l[g+h]=f[_+h]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,t))},i.setTyped(e)},{}],42:[function(r,s,i){var e=r("./common"),n=!0,t=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{t=!1}for(var l=new e.Buf8(256),f=0;f<256;f++)l[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function _(y,g){if(g<65537&&(y.subarray&&t||!y.subarray&&n))return String.fromCharCode.apply(null,e.shrinkBuf(y,g));for(var h="",v=0;v<g;v++)h+=String.fromCharCode(y[v]);return h}l[254]=l[254]=1,i.string2buf=function(y){var g,h,v,u,p,b=y.length,x=0;for(u=0;u<b;u++)(64512&(h=y.charCodeAt(u)))==55296&&u+1<b&&(64512&(v=y.charCodeAt(u+1)))==56320&&(h=65536+(h-55296<<10)+(v-56320),u++),x+=h<128?1:h<2048?2:h<65536?3:4;for(g=new e.Buf8(x),u=p=0;p<x;u++)(64512&(h=y.charCodeAt(u)))==55296&&u+1<b&&(64512&(v=y.charCodeAt(u+1)))==56320&&(h=65536+(h-55296<<10)+(v-56320),u++),h<128?g[p++]=h:(h<2048?g[p++]=192|h>>>6:(h<65536?g[p++]=224|h>>>12:(g[p++]=240|h>>>18,g[p++]=128|h>>>12&63),g[p++]=128|h>>>6&63),g[p++]=128|63&h);return g},i.buf2binstring=function(y){return _(y,y.length)},i.binstring2buf=function(y){for(var g=new e.Buf8(y.length),h=0,v=g.length;h<v;h++)g[h]=y.charCodeAt(h);return g},i.buf2string=function(y,g){var h,v,u,p,b=g||y.length,x=new Array(2*b);for(h=v=0;h<b;)if((u=y[h++])<128)x[v++]=u;else if(4<(p=l[u]))x[v++]=65533,h+=p-1;else{for(u&=p===2?31:p===3?15:7;1<p&&h<b;)u=u<<6|63&y[h++],p--;1<p?x[v++]=65533:u<65536?x[v++]=u:(u-=65536,x[v++]=55296|u>>10&1023,x[v++]=56320|1023&u)}return _(x,v)},i.utf8border=function(y,g){var h;for((g=g||y.length)>y.length&&(g=y.length),h=g-1;0<=h&&(192&y[h])==128;)h--;return h<0||h===0?g:h+l[y[h]]>g?h:g}},{"./common":41}],43:[function(r,s,i){s.exports=function(e,n,t,l){for(var f=65535&e|0,_=e>>>16&65535|0,y=0;t!==0;){for(t-=y=2e3<t?2e3:t;_=_+(f=f+n[l++]|0)|0,--y;);f%=65521,_%=65521}return f|_<<16|0}},{}],44:[function(r,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,s,i){var e=function(){for(var n,t=[],l=0;l<256;l++){n=l;for(var f=0;f<8;f++)n=1&n?3988292384^n>>>1:n>>>1;t[l]=n}return t}();s.exports=function(n,t,l,f){var _=e,y=f+l;n^=-1;for(var g=f;g<y;g++)n=n>>>8^_[255&(n^t[g])];return-1^n}},{}],46:[function(r,s,i){var e,n=r("../utils/common"),t=r("./trees"),l=r("./adler32"),f=r("./crc32"),_=r("./messages"),y=0,g=4,h=0,v=-2,u=-1,p=4,b=2,x=8,C=9,j=286,A=30,B=19,z=2*j+1,L=15,P=3,U=258,$=U+P+1,k=42,O=113,d=1,M=2,ne=3,Z=4;function se(o,D){return o.msg=_[D],D}function G(o){return(o<<1)-(4<o?9:0)}function re(o){for(var D=o.length;0<=--D;)o[D]=0}function N(o){var D=o.state,I=D.pending;I>o.avail_out&&(I=o.avail_out),I!==0&&(n.arraySet(o.output,D.pending_buf,D.pending_out,I,o.next_out),o.next_out+=I,D.pending_out+=I,o.total_out+=I,o.avail_out-=I,D.pending-=I,D.pending===0&&(D.pending_out=0))}function T(o,D){t._tr_flush_block(o,0<=o.block_start?o.block_start:-1,o.strstart-o.block_start,D),o.block_start=o.strstart,N(o.strm)}function te(o,D){o.pending_buf[o.pending++]=D}function q(o,D){o.pending_buf[o.pending++]=D>>>8&255,o.pending_buf[o.pending++]=255&D}function Y(o,D){var I,w,S=o.max_chain_length,E=o.strstart,F=o.prev_length,W=o.nice_match,R=o.strstart>o.w_size-$?o.strstart-(o.w_size-$):0,H=o.window,K=o.w_mask,V=o.prev,ee=o.strstart+U,he=H[E+F-1],ae=H[E+F];o.prev_length>=o.good_match&&(S>>=2),W>o.lookahead&&(W=o.lookahead);do if(H[(I=D)+F]===ae&&H[I+F-1]===he&&H[I]===H[E]&&H[++I]===H[E+1]){E+=2,I++;do;while(H[++E]===H[++I]&&H[++E]===H[++I]&&H[++E]===H[++I]&&H[++E]===H[++I]&&H[++E]===H[++I]&&H[++E]===H[++I]&&H[++E]===H[++I]&&H[++E]===H[++I]&&E<ee);if(w=U-(ee-E),E=ee-U,F<w){if(o.match_start=D,W<=(F=w))break;he=H[E+F-1],ae=H[E+F]}}while((D=V[D&K])>R&&--S!=0);return F<=o.lookahead?F:o.lookahead}function fe(o){var D,I,w,S,E,F,W,R,H,K,V=o.w_size;do{if(S=o.window_size-o.lookahead-o.strstart,o.strstart>=V+(V-$)){for(n.arraySet(o.window,o.window,V,V,0),o.match_start-=V,o.strstart-=V,o.block_start-=V,D=I=o.hash_size;w=o.head[--D],o.head[D]=V<=w?w-V:0,--I;);for(D=I=V;w=o.prev[--D],o.prev[D]=V<=w?w-V:0,--I;);S+=V}if(o.strm.avail_in===0)break;if(F=o.strm,W=o.window,R=o.strstart+o.lookahead,H=S,K=void 0,K=F.avail_in,H<K&&(K=H),I=K===0?0:(F.avail_in-=K,n.arraySet(W,F.input,F.next_in,K,R),F.state.wrap===1?F.adler=l(F.adler,W,K,R):F.state.wrap===2&&(F.adler=f(F.adler,W,K,R)),F.next_in+=K,F.total_in+=K,K),o.lookahead+=I,o.lookahead+o.insert>=P)for(E=o.strstart-o.insert,o.ins_h=o.window[E],o.ins_h=(o.ins_h<<o.hash_shift^o.window[E+1])&o.hash_mask;o.insert&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[E+P-1])&o.hash_mask,o.prev[E&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=E,E++,o.insert--,!(o.lookahead+o.insert<P)););}while(o.lookahead<$&&o.strm.avail_in!==0)}function ye(o,D){for(var I,w;;){if(o.lookahead<$){if(fe(o),o.lookahead<$&&D===y)return d;if(o.lookahead===0)break}if(I=0,o.lookahead>=P&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+P-1])&o.hash_mask,I=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),I!==0&&o.strstart-I<=o.w_size-$&&(o.match_length=Y(o,I)),o.match_length>=P)if(w=t._tr_tally(o,o.strstart-o.match_start,o.match_length-P),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=P){for(o.match_length--;o.strstart++,o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+P-1])&o.hash_mask,I=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart,--o.match_length!=0;);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+1])&o.hash_mask;else w=t._tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(w&&(T(o,!1),o.strm.avail_out===0))return d}return o.insert=o.strstart<P-1?o.strstart:P-1,D===g?(T(o,!0),o.strm.avail_out===0?ne:Z):o.last_lit&&(T(o,!1),o.strm.avail_out===0)?d:M}function ie(o,D){for(var I,w,S;;){if(o.lookahead<$){if(fe(o),o.lookahead<$&&D===y)return d;if(o.lookahead===0)break}if(I=0,o.lookahead>=P&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+P-1])&o.hash_mask,I=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=P-1,I!==0&&o.prev_length<o.max_lazy_match&&o.strstart-I<=o.w_size-$&&(o.match_length=Y(o,I),o.match_length<=5&&(o.strategy===1||o.match_length===P&&4096<o.strstart-o.match_start)&&(o.match_length=P-1)),o.prev_length>=P&&o.match_length<=o.prev_length){for(S=o.strstart+o.lookahead-P,w=t._tr_tally(o,o.strstart-1-o.prev_match,o.prev_length-P),o.lookahead-=o.prev_length-1,o.prev_length-=2;++o.strstart<=S&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+P-1])&o.hash_mask,I=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),--o.prev_length!=0;);if(o.match_available=0,o.match_length=P-1,o.strstart++,w&&(T(o,!1),o.strm.avail_out===0))return d}else if(o.match_available){if((w=t._tr_tally(o,0,o.window[o.strstart-1]))&&T(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return d}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(w=t._tr_tally(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<P-1?o.strstart:P-1,D===g?(T(o,!0),o.strm.avail_out===0?ne:Z):o.last_lit&&(T(o,!1),o.strm.avail_out===0)?d:M}function ce(o,D,I,w,S){this.good_length=o,this.max_lazy=D,this.nice_length=I,this.max_chain=w,this.func=S}function _e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*z),this.dyn_dtree=new n.Buf16(2*(2*A+1)),this.bl_tree=new n.Buf16(2*(2*B+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(L+1),this.heap=new n.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(o){var D;return o&&o.state?(o.total_in=o.total_out=0,o.data_type=b,(D=o.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?k:O,o.adler=D.wrap===2?0:1,D.last_flush=y,t._tr_init(D),h):se(o,v)}function Re(o){var D=pe(o);return D===h&&function(I){I.window_size=2*I.w_size,re(I.head),I.max_lazy_match=e[I.level].max_lazy,I.good_match=e[I.level].good_length,I.nice_match=e[I.level].nice_length,I.max_chain_length=e[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=P-1,I.match_available=0,I.ins_h=0}(o.state),D}function Ae(o,D,I,w,S,E){if(!o)return v;var F=1;if(D===u&&(D=6),w<0?(F=0,w=-w):15<w&&(F=2,w-=16),S<1||C<S||I!==x||w<8||15<w||D<0||9<D||E<0||p<E)return se(o,v);w===8&&(w=9);var W=new _e;return(o.state=W).strm=o,W.wrap=F,W.gzhead=null,W.w_bits=w,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+P-1)/P),W.window=new n.Buf8(2*W.w_size),W.head=new n.Buf16(W.hash_size),W.prev=new n.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new n.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=D,W.strategy=E,W.method=I,Re(o)}e=[new ce(0,0,0,0,function(o,D){var I=65535;for(I>o.pending_buf_size-5&&(I=o.pending_buf_size-5);;){if(o.lookahead<=1){if(fe(o),o.lookahead===0&&D===y)return d;if(o.lookahead===0)break}o.strstart+=o.lookahead,o.lookahead=0;var w=o.block_start+I;if((o.strstart===0||o.strstart>=w)&&(o.lookahead=o.strstart-w,o.strstart=w,T(o,!1),o.strm.avail_out===0)||o.strstart-o.block_start>=o.w_size-$&&(T(o,!1),o.strm.avail_out===0))return d}return o.insert=0,D===g?(T(o,!0),o.strm.avail_out===0?ne:Z):(o.strstart>o.block_start&&(T(o,!1),o.strm.avail_out),d)}),new ce(4,4,8,4,ye),new ce(4,5,16,8,ye),new ce(4,6,32,32,ye),new ce(4,4,16,16,ie),new ce(8,16,32,32,ie),new ce(8,16,128,128,ie),new ce(8,32,128,256,ie),new ce(32,128,258,1024,ie),new ce(32,258,258,4096,ie)],i.deflateInit=function(o,D){return Ae(o,D,x,15,8,0)},i.deflateInit2=Ae,i.deflateReset=Re,i.deflateResetKeep=pe,i.deflateSetHeader=function(o,D){return o&&o.state?o.state.wrap!==2?v:(o.state.gzhead=D,h):v},i.deflate=function(o,D){var I,w,S,E;if(!o||!o.state||5<D||D<0)return o?se(o,v):v;if(w=o.state,!o.output||!o.input&&o.avail_in!==0||w.status===666&&D!==g)return se(o,o.avail_out===0?-5:v);if(w.strm=o,I=w.last_flush,w.last_flush=D,w.status===k)if(w.wrap===2)o.adler=0,te(w,31),te(w,139),te(w,8),w.gzhead?(te(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),te(w,255&w.gzhead.time),te(w,w.gzhead.time>>8&255),te(w,w.gzhead.time>>16&255),te(w,w.gzhead.time>>24&255),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(te(w,255&w.gzhead.extra.length),te(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(o.adler=f(o.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(te(w,0),te(w,0),te(w,0),te(w,0),te(w,0),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,3),w.status=O);else{var F=x+(w.w_bits-8<<4)<<8;F|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(F|=32),F+=31-F%31,w.status=O,q(w,F),w.strstart!==0&&(q(w,o.adler>>>16),q(w,65535&o.adler)),o.adler=1}if(w.status===69)if(w.gzhead.extra){for(S=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>S&&(o.adler=f(o.adler,w.pending_buf,w.pending-S,S)),N(o),S=w.pending,w.pending!==w.pending_buf_size));)te(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>S&&(o.adler=f(o.adler,w.pending_buf,w.pending-S,S)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(o.adler=f(o.adler,w.pending_buf,w.pending-S,S)),N(o),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(o.adler=f(o.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(o.adler=f(o.adler,w.pending_buf,w.pending-S,S)),N(o),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(o.adler=f(o.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&N(o),w.pending+2<=w.pending_buf_size&&(te(w,255&o.adler),te(w,o.adler>>8&255),o.adler=0,w.status=O)):w.status=O),w.pending!==0){if(N(o),o.avail_out===0)return w.last_flush=-1,h}else if(o.avail_in===0&&G(D)<=G(I)&&D!==g)return se(o,-5);if(w.status===666&&o.avail_in!==0)return se(o,-5);if(o.avail_in!==0||w.lookahead!==0||D!==y&&w.status!==666){var W=w.strategy===2?function(R,H){for(var K;;){if(R.lookahead===0&&(fe(R),R.lookahead===0)){if(H===y)return d;break}if(R.match_length=0,K=t._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,K&&(T(R,!1),R.strm.avail_out===0))return d}return R.insert=0,H===g?(T(R,!0),R.strm.avail_out===0?ne:Z):R.last_lit&&(T(R,!1),R.strm.avail_out===0)?d:M}(w,D):w.strategy===3?function(R,H){for(var K,V,ee,he,ae=R.window;;){if(R.lookahead<=U){if(fe(R),R.lookahead<=U&&H===y)return d;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=P&&0<R.strstart&&(V=ae[ee=R.strstart-1])===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]){he=R.strstart+U;do;while(V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&ee<he);R.match_length=U-(he-ee),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=P?(K=t._tr_tally(R,1,R.match_length-P),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(K=t._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),K&&(T(R,!1),R.strm.avail_out===0))return d}return R.insert=0,H===g?(T(R,!0),R.strm.avail_out===0?ne:Z):R.last_lit&&(T(R,!1),R.strm.avail_out===0)?d:M}(w,D):e[w.level].func(w,D);if(W!==ne&&W!==Z||(w.status=666),W===d||W===ne)return o.avail_out===0&&(w.last_flush=-1),h;if(W===M&&(D===1?t._tr_align(w):D!==5&&(t._tr_stored_block(w,0,0,!1),D===3&&(re(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),N(o),o.avail_out===0))return w.last_flush=-1,h}return D!==g?h:w.wrap<=0?1:(w.wrap===2?(te(w,255&o.adler),te(w,o.adler>>8&255),te(w,o.adler>>16&255),te(w,o.adler>>24&255),te(w,255&o.total_in),te(w,o.total_in>>8&255),te(w,o.total_in>>16&255),te(w,o.total_in>>24&255)):(q(w,o.adler>>>16),q(w,65535&o.adler)),N(o),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?h:1)},i.deflateEnd=function(o){var D;return o&&o.state?(D=o.state.status)!==k&&D!==69&&D!==73&&D!==91&&D!==103&&D!==O&&D!==666?se(o,v):(o.state=null,D===O?se(o,-3):h):v},i.deflateSetDictionary=function(o,D){var I,w,S,E,F,W,R,H,K=D.length;if(!o||!o.state||(E=(I=o.state).wrap)===2||E===1&&I.status!==k||I.lookahead)return v;for(E===1&&(o.adler=l(o.adler,D,K,0)),I.wrap=0,K>=I.w_size&&(E===0&&(re(I.head),I.strstart=0,I.block_start=0,I.insert=0),H=new n.Buf8(I.w_size),n.arraySet(H,D,K-I.w_size,I.w_size,0),D=H,K=I.w_size),F=o.avail_in,W=o.next_in,R=o.input,o.avail_in=K,o.next_in=0,o.input=D,fe(I);I.lookahead>=P;){for(w=I.strstart,S=I.lookahead-(P-1);I.ins_h=(I.ins_h<<I.hash_shift^I.window[w+P-1])&I.hash_mask,I.prev[w&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=w,w++,--S;);I.strstart=w,I.lookahead=P-1,fe(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=P-1,I.match_available=0,o.next_in=W,o.input=R,o.avail_in=F,I.wrap=E,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,s,i){s.exports=function(e,n){var t,l,f,_,y,g,h,v,u,p,b,x,C,j,A,B,z,L,P,U,$,k,O,d,M;t=e.state,l=e.next_in,d=e.input,f=l+(e.avail_in-5),_=e.next_out,M=e.output,y=_-(n-e.avail_out),g=_+(e.avail_out-257),h=t.dmax,v=t.wsize,u=t.whave,p=t.wnext,b=t.window,x=t.hold,C=t.bits,j=t.lencode,A=t.distcode,B=(1<<t.lenbits)-1,z=(1<<t.distbits)-1;e:do{C<15&&(x+=d[l++]<<C,C+=8,x+=d[l++]<<C,C+=8),L=j[x&B];t:for(;;){if(x>>>=P=L>>>24,C-=P,(P=L>>>16&255)===0)M[_++]=65535&L;else{if(!(16&P)){if((64&P)==0){L=j[(65535&L)+(x&(1<<P)-1)];continue t}if(32&P){t.mode=12;break e}e.msg="invalid literal/length code",t.mode=30;break e}U=65535&L,(P&=15)&&(C<P&&(x+=d[l++]<<C,C+=8),U+=x&(1<<P)-1,x>>>=P,C-=P),C<15&&(x+=d[l++]<<C,C+=8,x+=d[l++]<<C,C+=8),L=A[x&z];n:for(;;){if(x>>>=P=L>>>24,C-=P,!(16&(P=L>>>16&255))){if((64&P)==0){L=A[(65535&L)+(x&(1<<P)-1)];continue n}e.msg="invalid distance code",t.mode=30;break e}if($=65535&L,C<(P&=15)&&(x+=d[l++]<<C,(C+=8)<P&&(x+=d[l++]<<C,C+=8)),h<($+=x&(1<<P)-1)){e.msg="invalid distance too far back",t.mode=30;break e}if(x>>>=P,C-=P,(P=_-y)<$){if(u<(P=$-P)&&t.sane){e.msg="invalid distance too far back",t.mode=30;break e}if(O=b,(k=0)===p){if(k+=v-P,P<U){for(U-=P;M[_++]=b[k++],--P;);k=_-$,O=M}}else if(p<P){if(k+=v+p-P,(P-=p)<U){for(U-=P;M[_++]=b[k++],--P;);if(k=0,p<U){for(U-=P=p;M[_++]=b[k++],--P;);k=_-$,O=M}}}else if(k+=p-P,P<U){for(U-=P;M[_++]=b[k++],--P;);k=_-$,O=M}for(;2<U;)M[_++]=O[k++],M[_++]=O[k++],M[_++]=O[k++],U-=3;U&&(M[_++]=O[k++],1<U&&(M[_++]=O[k++]))}else{for(k=_-$;M[_++]=M[k++],M[_++]=M[k++],M[_++]=M[k++],2<(U-=3););U&&(M[_++]=M[k++],1<U&&(M[_++]=M[k++]))}break}}break}}while(l<f&&_<g);l-=U=C>>3,x&=(1<<(C-=U<<3))-1,e.next_in=l,e.next_out=_,e.avail_in=l<f?f-l+5:5-(l-f),e.avail_out=_<g?g-_+257:257-(_-g),t.hold=x,t.bits=C}},{}],49:[function(r,s,i){var e=r("../utils/common"),n=r("./adler32"),t=r("./crc32"),l=r("./inffast"),f=r("./inftrees"),_=1,y=2,g=0,h=-2,v=1,u=852,p=592;function b(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(k){var O;return k&&k.state?(O=k.state,k.total_in=k.total_out=O.total=0,k.msg="",O.wrap&&(k.adler=1&O.wrap),O.mode=v,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new e.Buf32(u),O.distcode=O.distdyn=new e.Buf32(p),O.sane=1,O.back=-1,g):h}function j(k){var O;return k&&k.state?((O=k.state).wsize=0,O.whave=0,O.wnext=0,C(k)):h}function A(k,O){var d,M;return k&&k.state?(M=k.state,O<0?(d=0,O=-O):(d=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(M.window!==null&&M.wbits!==O&&(M.window=null),M.wrap=d,M.wbits=O,j(k))):h}function B(k,O){var d,M;return k?(M=new x,(k.state=M).window=null,(d=A(k,O))!==g&&(k.state=null),d):h}var z,L,P=!0;function U(k){if(P){var O;for(z=new e.Buf32(512),L=new e.Buf32(32),O=0;O<144;)k.lens[O++]=8;for(;O<256;)k.lens[O++]=9;for(;O<280;)k.lens[O++]=7;for(;O<288;)k.lens[O++]=8;for(f(_,k.lens,0,288,z,0,k.work,{bits:9}),O=0;O<32;)k.lens[O++]=5;f(y,k.lens,0,32,L,0,k.work,{bits:5}),P=!1}k.lencode=z,k.lenbits=9,k.distcode=L,k.distbits=5}function $(k,O,d,M){var ne,Z=k.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new e.Buf8(Z.wsize)),M>=Z.wsize?(e.arraySet(Z.window,O,d-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(M<(ne=Z.wsize-Z.wnext)&&(ne=M),e.arraySet(Z.window,O,d-M,ne,Z.wnext),(M-=ne)?(e.arraySet(Z.window,O,d-M,M,0),Z.wnext=M,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}i.inflateReset=j,i.inflateReset2=A,i.inflateResetKeep=C,i.inflateInit=function(k){return B(k,15)},i.inflateInit2=B,i.inflate=function(k,O){var d,M,ne,Z,se,G,re,N,T,te,q,Y,fe,ye,ie,ce,_e,pe,Re,Ae,o,D,I,w,S=0,E=new e.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return h;(d=k.state).mode===12&&(d.mode=13),se=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,M=k.input,G=k.avail_in,N=d.hold,T=d.bits,te=G,q=re,D=g;e:for(;;)switch(d.mode){case v:if(d.wrap===0){d.mode=13;break}for(;T<16;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(2&d.wrap&&N===35615){E[d.check=0]=255&N,E[1]=N>>>8&255,d.check=t(d.check,E,2,0),T=N=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&N)<<8)+(N>>8))%31){k.msg="incorrect header check",d.mode=30;break}if((15&N)!=8){k.msg="unknown compression method",d.mode=30;break}if(T-=4,o=8+(15&(N>>>=4)),d.wbits===0)d.wbits=o;else if(o>d.wbits){k.msg="invalid window size",d.mode=30;break}d.dmax=1<<o,k.adler=d.check=1,d.mode=512&N?10:12,T=N=0;break;case 2:for(;T<16;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(d.flags=N,(255&d.flags)!=8){k.msg="unknown compression method",d.mode=30;break}if(57344&d.flags){k.msg="unknown header flags set",d.mode=30;break}d.head&&(d.head.text=N>>8&1),512&d.flags&&(E[0]=255&N,E[1]=N>>>8&255,d.check=t(d.check,E,2,0)),T=N=0,d.mode=3;case 3:for(;T<32;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}d.head&&(d.head.time=N),512&d.flags&&(E[0]=255&N,E[1]=N>>>8&255,E[2]=N>>>16&255,E[3]=N>>>24&255,d.check=t(d.check,E,4,0)),T=N=0,d.mode=4;case 4:for(;T<16;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}d.head&&(d.head.xflags=255&N,d.head.os=N>>8),512&d.flags&&(E[0]=255&N,E[1]=N>>>8&255,d.check=t(d.check,E,2,0)),T=N=0,d.mode=5;case 5:if(1024&d.flags){for(;T<16;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}d.length=N,d.head&&(d.head.extra_len=N),512&d.flags&&(E[0]=255&N,E[1]=N>>>8&255,d.check=t(d.check,E,2,0)),T=N=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(G<(Y=d.length)&&(Y=G),Y&&(d.head&&(o=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Array(d.head.extra_len)),e.arraySet(d.head.extra,M,Z,Y,o)),512&d.flags&&(d.check=t(d.check,M,Y,Z)),G-=Y,Z+=Y,d.length-=Y),d.length))break e;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(G===0)break e;for(Y=0;o=M[Z+Y++],d.head&&o&&d.length<65536&&(d.head.name+=String.fromCharCode(o)),o&&Y<G;);if(512&d.flags&&(d.check=t(d.check,M,Y,Z)),G-=Y,Z+=Y,o)break e}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(G===0)break e;for(Y=0;o=M[Z+Y++],d.head&&o&&d.length<65536&&(d.head.comment+=String.fromCharCode(o)),o&&Y<G;);if(512&d.flags&&(d.check=t(d.check,M,Y,Z)),G-=Y,Z+=Y,o)break e}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;T<16;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(N!==(65535&d.check)){k.msg="header crc mismatch",d.mode=30;break}T=N=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),k.adler=d.check=0,d.mode=12;break;case 10:for(;T<32;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}k.adler=d.check=b(N),T=N=0,d.mode=11;case 11:if(d.havedict===0)return k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=G,d.hold=N,d.bits=T,2;k.adler=d.check=1,d.mode=12;case 12:if(O===5||O===6)break e;case 13:if(d.last){N>>>=7&T,T-=7&T,d.mode=27;break}for(;T<3;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}switch(d.last=1&N,T-=1,3&(N>>>=1)){case 0:d.mode=14;break;case 1:if(U(d),d.mode=20,O!==6)break;N>>>=2,T-=2;break e;case 2:d.mode=17;break;case 3:k.msg="invalid block type",d.mode=30}N>>>=2,T-=2;break;case 14:for(N>>>=7&T,T-=7&T;T<32;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if((65535&N)!=(N>>>16^65535)){k.msg="invalid stored block lengths",d.mode=30;break}if(d.length=65535&N,T=N=0,d.mode=15,O===6)break e;case 15:d.mode=16;case 16:if(Y=d.length){if(G<Y&&(Y=G),re<Y&&(Y=re),Y===0)break e;e.arraySet(ne,M,Z,Y,se),G-=Y,Z+=Y,re-=Y,se+=Y,d.length-=Y;break}d.mode=12;break;case 17:for(;T<14;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(d.nlen=257+(31&N),N>>>=5,T-=5,d.ndist=1+(31&N),N>>>=5,T-=5,d.ncode=4+(15&N),N>>>=4,T-=4,286<d.nlen||30<d.ndist){k.msg="too many length or distance symbols",d.mode=30;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;T<3;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}d.lens[F[d.have++]]=7&N,N>>>=3,T-=3}for(;d.have<19;)d.lens[F[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,I={bits:d.lenbits},D=f(0,d.lens,0,19,d.lencode,0,d.work,I),d.lenbits=I.bits,D){k.msg="invalid code lengths set",d.mode=30;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;ce=(S=d.lencode[N&(1<<d.lenbits)-1])>>>16&255,_e=65535&S,!((ie=S>>>24)<=T);){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(_e<16)N>>>=ie,T-=ie,d.lens[d.have++]=_e;else{if(_e===16){for(w=ie+2;T<w;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(N>>>=ie,T-=ie,d.have===0){k.msg="invalid bit length repeat",d.mode=30;break}o=d.lens[d.have-1],Y=3+(3&N),N>>>=2,T-=2}else if(_e===17){for(w=ie+3;T<w;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}T-=ie,o=0,Y=3+(7&(N>>>=ie)),N>>>=3,T-=3}else{for(w=ie+7;T<w;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}T-=ie,o=0,Y=11+(127&(N>>>=ie)),N>>>=7,T-=7}if(d.have+Y>d.nlen+d.ndist){k.msg="invalid bit length repeat",d.mode=30;break}for(;Y--;)d.lens[d.have++]=o}}if(d.mode===30)break;if(d.lens[256]===0){k.msg="invalid code -- missing end-of-block",d.mode=30;break}if(d.lenbits=9,I={bits:d.lenbits},D=f(_,d.lens,0,d.nlen,d.lencode,0,d.work,I),d.lenbits=I.bits,D){k.msg="invalid literal/lengths set",d.mode=30;break}if(d.distbits=6,d.distcode=d.distdyn,I={bits:d.distbits},D=f(y,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,I),d.distbits=I.bits,D){k.msg="invalid distances set",d.mode=30;break}if(d.mode=20,O===6)break e;case 20:d.mode=21;case 21:if(6<=G&&258<=re){k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=G,d.hold=N,d.bits=T,l(k,q),se=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,M=k.input,G=k.avail_in,N=d.hold,T=d.bits,d.mode===12&&(d.back=-1);break}for(d.back=0;ce=(S=d.lencode[N&(1<<d.lenbits)-1])>>>16&255,_e=65535&S,!((ie=S>>>24)<=T);){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(ce&&(240&ce)==0){for(pe=ie,Re=ce,Ae=_e;ce=(S=d.lencode[Ae+((N&(1<<pe+Re)-1)>>pe)])>>>16&255,_e=65535&S,!(pe+(ie=S>>>24)<=T);){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}N>>>=pe,T-=pe,d.back+=pe}if(N>>>=ie,T-=ie,d.back+=ie,d.length=_e,ce===0){d.mode=26;break}if(32&ce){d.back=-1,d.mode=12;break}if(64&ce){k.msg="invalid literal/length code",d.mode=30;break}d.extra=15&ce,d.mode=22;case 22:if(d.extra){for(w=d.extra;T<w;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}d.length+=N&(1<<d.extra)-1,N>>>=d.extra,T-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;ce=(S=d.distcode[N&(1<<d.distbits)-1])>>>16&255,_e=65535&S,!((ie=S>>>24)<=T);){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if((240&ce)==0){for(pe=ie,Re=ce,Ae=_e;ce=(S=d.distcode[Ae+((N&(1<<pe+Re)-1)>>pe)])>>>16&255,_e=65535&S,!(pe+(ie=S>>>24)<=T);){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}N>>>=pe,T-=pe,d.back+=pe}if(N>>>=ie,T-=ie,d.back+=ie,64&ce){k.msg="invalid distance code",d.mode=30;break}d.offset=_e,d.extra=15&ce,d.mode=24;case 24:if(d.extra){for(w=d.extra;T<w;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}d.offset+=N&(1<<d.extra)-1,N>>>=d.extra,T-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){k.msg="invalid distance too far back",d.mode=30;break}d.mode=25;case 25:if(re===0)break e;if(Y=q-re,d.offset>Y){if((Y=d.offset-Y)>d.whave&&d.sane){k.msg="invalid distance too far back",d.mode=30;break}fe=Y>d.wnext?(Y-=d.wnext,d.wsize-Y):d.wnext-Y,Y>d.length&&(Y=d.length),ye=d.window}else ye=ne,fe=se-d.offset,Y=d.length;for(re<Y&&(Y=re),re-=Y,d.length-=Y;ne[se++]=ye[fe++],--Y;);d.length===0&&(d.mode=21);break;case 26:if(re===0)break e;ne[se++]=d.length,re--,d.mode=21;break;case 27:if(d.wrap){for(;T<32;){if(G===0)break e;G--,N|=M[Z++]<<T,T+=8}if(q-=re,k.total_out+=q,d.total+=q,q&&(k.adler=d.check=d.flags?t(d.check,ne,q,se-q):n(d.check,ne,q,se-q)),q=re,(d.flags?N:b(N))!==d.check){k.msg="incorrect data check",d.mode=30;break}T=N=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;T<32;){if(G===0)break e;G--,N+=M[Z++]<<T,T+=8}if(N!==(4294967295&d.total)){k.msg="incorrect length check",d.mode=30;break}T=N=0}d.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return h}return k.next_out=se,k.avail_out=re,k.next_in=Z,k.avail_in=G,d.hold=N,d.bits=T,(d.wsize||q!==k.avail_out&&d.mode<30&&(d.mode<27||O!==4))&&$(k,k.output,k.next_out,q-k.avail_out)?(d.mode=31,-4):(te-=k.avail_in,q-=k.avail_out,k.total_in+=te,k.total_out+=q,d.total+=q,d.wrap&&q&&(k.adler=d.check=d.flags?t(d.check,ne,q,k.next_out-q):n(d.check,ne,q,k.next_out-q)),k.data_type=d.bits+(d.last?64:0)+(d.mode===12?128:0)+(d.mode===20||d.mode===15?256:0),(te==0&&q===0||O===4)&&D===g&&(D=-5),D)},i.inflateEnd=function(k){if(!k||!k.state)return h;var O=k.state;return O.window&&(O.window=null),k.state=null,g},i.inflateGetHeader=function(k,O){var d;return k&&k.state?(2&(d=k.state).wrap)==0?h:((d.head=O).done=!1,g):h},i.inflateSetDictionary=function(k,O){var d,M=O.length;return k&&k.state?(d=k.state).wrap!==0&&d.mode!==11?h:d.mode===11&&n(1,O,M,0)!==d.check?-3:$(k,O,M,M)?(d.mode=31,-4):(d.havedict=1,g):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,s,i){var e=r("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],t=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(_,y,g,h,v,u,p,b){var x,C,j,A,B,z,L,P,U,$=b.bits,k=0,O=0,d=0,M=0,ne=0,Z=0,se=0,G=0,re=0,N=0,T=null,te=0,q=new e.Buf16(16),Y=new e.Buf16(16),fe=null,ye=0;for(k=0;k<=15;k++)q[k]=0;for(O=0;O<h;O++)q[y[g+O]]++;for(ne=$,M=15;1<=M&&q[M]===0;M--);if(M<ne&&(ne=M),M===0)return v[u++]=20971520,v[u++]=20971520,b.bits=1,0;for(d=1;d<M&&q[d]===0;d++);for(ne<d&&(ne=d),k=G=1;k<=15;k++)if(G<<=1,(G-=q[k])<0)return-1;if(0<G&&(_===0||M!==1))return-1;for(Y[1]=0,k=1;k<15;k++)Y[k+1]=Y[k]+q[k];for(O=0;O<h;O++)y[g+O]!==0&&(p[Y[y[g+O]]++]=O);if(z=_===0?(T=fe=p,19):_===1?(T=n,te-=257,fe=t,ye-=257,256):(T=l,fe=f,-1),k=d,B=u,se=O=N=0,j=-1,A=(re=1<<(Z=ne))-1,_===1&&852<re||_===2&&592<re)return 1;for(;;){for(L=k-se,U=p[O]<z?(P=0,p[O]):p[O]>z?(P=fe[ye+p[O]],T[te+p[O]]):(P=96,0),x=1<<k-se,d=C=1<<Z;v[B+(N>>se)+(C-=x)]=L<<24|P<<16|U|0,C!==0;);for(x=1<<k-1;N&x;)x>>=1;if(x!==0?(N&=x-1,N+=x):N=0,O++,--q[k]==0){if(k===M)break;k=y[g+p[O]]}if(ne<k&&(N&A)!==j){for(se===0&&(se=ne),B+=d,G=1<<(Z=k-se);Z+se<M&&!((G-=q[Z+se])<=0);)Z++,G<<=1;if(re+=1<<Z,_===1&&852<re||_===2&&592<re)return 1;v[j=N&A]=ne<<24|Z<<16|B-u|0}}return N!==0&&(v[B+N]=k-se<<24|64<<16|0),b.bits=ne,0}},{"../utils/common":41}],51:[function(r,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,s,i){var e=r("../utils/common"),n=0,t=1;function l(S){for(var E=S.length;0<=--E;)S[E]=0}var f=0,_=29,y=256,g=y+1+_,h=30,v=19,u=2*g+1,p=15,b=16,x=7,C=256,j=16,A=17,B=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(g+2));l($);var k=new Array(2*h);l(k);var O=new Array(512);l(O);var d=new Array(256);l(d);var M=new Array(_);l(M);var ne,Z,se,G=new Array(h);function re(S,E,F,W,R){this.static_tree=S,this.extra_bits=E,this.extra_base=F,this.elems=W,this.max_length=R,this.has_stree=S&&S.length}function N(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function T(S){return S<256?O[S]:O[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,F){S.bi_valid>b-F?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>b-S.bi_valid,S.bi_valid+=F-b):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=F)}function Y(S,E,F){q(S,F[2*E],F[2*E+1])}function fe(S,E){for(var F=0;F|=1&S,S>>>=1,F<<=1,0<--E;);return F>>>1}function ye(S,E,F){var W,R,H=new Array(p+1),K=0;for(W=1;W<=p;W++)H[W]=K=K+F[W-1]<<1;for(R=0;R<=E;R++){var V=S[2*R+1];V!==0&&(S[2*R]=fe(H[V]++,V))}}function ie(S){var E;for(E=0;E<g;E++)S.dyn_ltree[2*E]=0;for(E=0;E<h;E++)S.dyn_dtree[2*E]=0;for(E=0;E<v;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function ce(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function _e(S,E,F,W){var R=2*E,H=2*F;return S[R]<S[H]||S[R]===S[H]&&W[E]<=W[F]}function pe(S,E,F){for(var W=S.heap[F],R=F<<1;R<=S.heap_len&&(R<S.heap_len&&_e(E,S.heap[R+1],S.heap[R],S.depth)&&R++,!_e(E,W,S.heap[R],S.depth));)S.heap[F]=S.heap[R],F=R,R<<=1;S.heap[F]=W}function Re(S,E,F){var W,R,H,K,V=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*V]<<8|S.pending_buf[S.d_buf+2*V+1],R=S.pending_buf[S.l_buf+V],V++,W===0?Y(S,R,E):(Y(S,(H=d[R])+y+1,E),(K=z[H])!==0&&q(S,R-=M[H],K),Y(S,H=T(--W),F),(K=L[H])!==0&&q(S,W-=G[H],K)),V<S.last_lit;);Y(S,C,E)}function Ae(S,E){var F,W,R,H=E.dyn_tree,K=E.stat_desc.static_tree,V=E.stat_desc.has_stree,ee=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=u,F=0;F<ee;F++)H[2*F]!==0?(S.heap[++S.heap_len]=he=F,S.depth[F]=0):H[2*F+1]=0;for(;S.heap_len<2;)H[2*(R=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[R]=0,S.opt_len--,V&&(S.static_len-=K[2*R+1]);for(E.max_code=he,F=S.heap_len>>1;1<=F;F--)pe(S,H,F);for(R=ee;F=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,H,1),W=S.heap[1],S.heap[--S.heap_max]=F,S.heap[--S.heap_max]=W,H[2*R]=H[2*F]+H[2*W],S.depth[R]=(S.depth[F]>=S.depth[W]?S.depth[F]:S.depth[W])+1,H[2*F+1]=H[2*W+1]=R,S.heap[1]=R++,pe(S,H,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,Ce){var Ze,ze,Ge,me,st,mt,Te=Ce.dyn_tree,It=Ce.max_code,kn=Ce.stat_desc.static_tree,Cn=Ce.stat_desc.has_stree,jn=Ce.stat_desc.extra_bits,Mt=Ce.stat_desc.extra_base,He=Ce.stat_desc.max_length,it=0;for(me=0;me<=p;me++)ae.bl_count[me]=0;for(Te[2*ae.heap[ae.heap_max]+1]=0,Ze=ae.heap_max+1;Ze<u;Ze++)He<(me=Te[2*Te[2*(ze=ae.heap[Ze])+1]+1]+1)&&(me=He,it++),Te[2*ze+1]=me,It<ze||(ae.bl_count[me]++,st=0,Mt<=ze&&(st=jn[ze-Mt]),mt=Te[2*ze],ae.opt_len+=mt*(me+st),Cn&&(ae.static_len+=mt*(kn[2*ze+1]+st)));if(it!==0){do{for(me=He-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[He]--,it-=2}while(0<it);for(me=He;me!==0;me--)for(ze=ae.bl_count[me];ze!==0;)It<(Ge=ae.heap[--Ze])||(Te[2*Ge+1]!==me&&(ae.opt_len+=(me-Te[2*Ge+1])*Te[2*Ge],Te[2*Ge+1]=me),ze--)}}(S,E),ye(H,he,S.bl_count)}function o(S,E,F){var W,R,H=-1,K=E[1],V=0,ee=7,he=4;for(K===0&&(ee=138,he=3),E[2*(F+1)+1]=65535,W=0;W<=F;W++)R=K,K=E[2*(W+1)+1],++V<ee&&R===K||(V<he?S.bl_tree[2*R]+=V:R!==0?(R!==H&&S.bl_tree[2*R]++,S.bl_tree[2*j]++):V<=10?S.bl_tree[2*A]++:S.bl_tree[2*B]++,H=R,he=(V=0)===K?(ee=138,3):R===K?(ee=6,3):(ee=7,4))}function D(S,E,F){var W,R,H=-1,K=E[1],V=0,ee=7,he=4;for(K===0&&(ee=138,he=3),W=0;W<=F;W++)if(R=K,K=E[2*(W+1)+1],!(++V<ee&&R===K)){if(V<he)for(;Y(S,R,S.bl_tree),--V!=0;);else R!==0?(R!==H&&(Y(S,R,S.bl_tree),V--),Y(S,j,S.bl_tree),q(S,V-3,2)):V<=10?(Y(S,A,S.bl_tree),q(S,V-3,3)):(Y(S,B,S.bl_tree),q(S,V-11,7));H=R,he=(V=0)===K?(ee=138,3):R===K?(ee=6,3):(ee=7,4)}}l(G);var I=!1;function w(S,E,F,W){q(S,(f<<1)+(W?1:0),3),function(R,H,K,V){ce(R),te(R,K),te(R,~K),e.arraySet(R.pending_buf,R.window,H,K,R.pending),R.pending+=K}(S,E,F)}i._tr_init=function(S){I||(function(){var E,F,W,R,H,K=new Array(p+1);for(R=W=0;R<_-1;R++)for(M[R]=W,E=0;E<1<<z[R];E++)d[W++]=R;for(d[W-1]=R,R=H=0;R<16;R++)for(G[R]=H,E=0;E<1<<L[R];E++)O[H++]=R;for(H>>=7;R<h;R++)for(G[R]=H<<7,E=0;E<1<<L[R]-7;E++)O[256+H++]=R;for(F=0;F<=p;F++)K[F]=0;for(E=0;E<=143;)$[2*E+1]=8,E++,K[8]++;for(;E<=255;)$[2*E+1]=9,E++,K[9]++;for(;E<=279;)$[2*E+1]=7,E++,K[7]++;for(;E<=287;)$[2*E+1]=8,E++,K[8]++;for(ye($,g+1,K),E=0;E<h;E++)k[2*E+1]=5,k[2*E]=fe(E,5);ne=new re($,z,y+1,g,p),Z=new re(k,L,0,h,p),se=new re(new Array(0),P,0,v,x)}(),I=!0),S.l_desc=new N(S.dyn_ltree,ne),S.d_desc=new N(S.dyn_dtree,Z),S.bl_desc=new N(S.bl_tree,se),S.bi_buf=0,S.bi_valid=0,ie(S)},i._tr_stored_block=w,i._tr_flush_block=function(S,E,F,W){var R,H,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(V){var ee,he=4093624447;for(ee=0;ee<=31;ee++,he>>>=1)if(1&he&&V.dyn_ltree[2*ee]!==0)return n;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return t;for(ee=32;ee<y;ee++)if(V.dyn_ltree[2*ee]!==0)return t;return n}(S)),Ae(S,S.l_desc),Ae(S,S.d_desc),K=function(V){var ee;for(o(V,V.dyn_ltree,V.l_desc.max_code),o(V,V.dyn_dtree,V.d_desc.max_code),Ae(V,V.bl_desc),ee=v-1;3<=ee&&V.bl_tree[2*U[ee]+1]===0;ee--);return V.opt_len+=3*(ee+1)+5+5+4,ee}(S),R=S.opt_len+3+7>>>3,(H=S.static_len+3+7>>>3)<=R&&(R=H)):R=H=F+5,F+4<=R&&E!==-1?w(S,E,F,W):S.strategy===4||H===R?(q(S,2+(W?1:0),3),Re(S,$,k)):(q(S,4+(W?1:0),3),function(V,ee,he,ae){var Ce;for(q(V,ee-257,5),q(V,he-1,5),q(V,ae-4,4),Ce=0;Ce<ae;Ce++)q(V,V.bl_tree[2*U[Ce]+1],3);D(V,V.dyn_ltree,ee-1),D(V,V.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Re(S,S.dyn_ltree,S.dyn_dtree)),ie(S),W&&ce(S)},i._tr_tally=function(S,E,F){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&F,S.last_lit++,E===0?S.dyn_ltree[2*F]++:(S.matches++,E--,S.dyn_ltree[2*(d[F]+y+1)]++,S.dyn_dtree[2*T(E)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){q(S,2,3),Y(S,C,$),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(r,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,s,i){(function(e){(function(n,t){if(!n.setImmediate){var l,f,_,y,g=1,h={},v=!1,u=n.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(n);p=p&&p.setTimeout?p:n,l={}.toString.call(n.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(n.postMessage&&!n.importScripts){var j=!0,A=n.onmessage;return n.onmessage=function(){j=!1},n.postMessage("","*"),n.onmessage=A,j}}()?(y="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",C,!1):n.attachEvent("onmessage",C),function(j){n.postMessage(y+j,"*")}):n.MessageChannel?((_=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){_.port2.postMessage(j)}):u&&"onreadystatechange"in u.createElement("script")?(f=u.documentElement,function(j){var A=u.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,f.removeChild(A),A=null},f.appendChild(A)}):function(j){setTimeout(x,0,j)},p.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),B=0;B<A.length;B++)A[B]=arguments[B+1];var z={callback:j,args:A};return h[g]=z,l(g),g++},p.clearImmediate=b}function b(j){delete h[j]}function x(j){if(v)setTimeout(x,0,j);else{var A=h[j];if(A){v=!0;try{(function(B){var z=B.callback,L=B.args;switch(L.length){case 0:z();break;case 1:z(L[0]);break;case 2:z(L[0],L[1]);break;case 3:z(L[0],L[1],L[2]);break;default:z.apply(t,L)}})(A)}finally{b(j),v=!1}}}}function C(j){j.source===n&&typeof j.data=="string"&&j.data.indexOf(y)===0&&x(+j.data.slice(y.length))}})(typeof self>"u"?e===void 0?this:e:self)}).call(this,typeof at<"u"?at:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(yt)),yt.exports}var pi=fi();const mi=Mn(pi),gi=async(a,c,r,s,i)=>{const e=document.querySelector(`svg#${a}`);if(!e)throw new Error("Requested canvas SVG element not found");const n=Number(e.style.getPropertyValue("--rmg-svg-height").match(/\d+/g)?.[0]),t=e.cloneNode(!0);t.setAttribute("height",(n*(i||100)/100).toString()),t.style.setProperty("all","initial"),["share"].map(l=>[...([...document.querySelectorAll("link")].filter(f=>f.id==="css_"+l)[0]?.sheet).cssRules].map(f=>f.cssText).join(" ")).forEach(l=>{const f=document.createElement("style");f.textContent=l,t.prepend(f)}),t.querySelector("rect#canvas-border")?.setAttribute("stroke",s?"black":"none"),t.querySelector("rect#canvas-bg")?.setAttribute("fill",r?"none":"white");try{const l=await _n[c].fonts?.()??[],_=(await Promise.allSettled(l.map(de.getFontCSS))).filter(g=>g.status==="fulfilled").map(g=>g.value),y=document.createElement("style");y.textContent=_.join(`
`),t.prepend(y)}catch(l){console.warn("Failed to fonts. Fonts in the exported PNG will be missing.",l)}return t},bi=async(a,c,r)=>{const s=a.viewBox.baseVal.width,i=a.viewBox.baseVal.height,e=document.querySelectorAll("canvas")[0];e.width=Number(s)*window.devicePixelRatio*c,e.height=Number(i)*window.devicePixelRatio*c,a.setAttribute("width",e.width.toString()),a.setAttribute("height",e.height.toString());const n=e.getContext("2d");return n.clearRect(0,0,e.width,e.height),a.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(t=>t.setAttribute("font-size","8.5px")),a.querySelectorAll("text, tspan").forEach(t=>{const l=window.getComputedStyle(t);t.setAttribute("font-family",l.fontFamily),t.setAttribute("fill",l.fill),t.setAttribute("dominant-baseline",l.dominantBaseline),t.setAttribute("text-anchor",l.textAnchor||"")}),new Promise((t,l)=>{const f=new Image;f.onload=()=>{setTimeout(()=>{n.drawImage(f,0,0,e.width,e.height),e.toBlob(_=>{_?t(_):l("Canvas blob is null")},"image/png")},r?2e3:0)},f.onerror=l,f.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a.outerHTML)))})};function _i(a){const{isOpen:c,onClose:r}=a,{t:s}=le(),i=ue(),[e,n]=J.useState(""),[t,l]=J.useState(!1),[f,_]=J.useState(!1),[y,g]=J.useState(100),[h,v]=J.useState("png"),u=Q(P=>P.app.canvasToShow),{style:p,stn_list:b,current_stn_idx:x,line_name:C}=Q(P=>P.param);J.useEffect(()=>{e!==""&&!u.includes(e)&&n("")},[u]);const j=Pt[p].reduce((P,U)=>u.includes(U)?{...P,[U]:s("CanvasType."+U)}:{...P},{"":s("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((P,U)=>({...P,[U]:`${U}%`}),{}),B={png:s("DownloadModal.png"),svg:s("DownloadModal.svg")},z=[{type:"select",label:s("DownloadModal.canvas"),value:e,options:j,disabledOptions:[""],onChange:P=>n(P),minW:"full"},{type:"switch",label:s("DownloadModal.transparent"),isChecked:t,onChange:l,oneLine:!0,minW:"full"},{type:"switch",label:s("DownloadModal.showBorder"),isChecked:f,onChange:_,oneLine:!0,minW:"full"},{type:"select",label:s("DownloadModal.scale"),value:y,options:A,onChange:P=>g(P)},{type:"select",label:s("DownloadModal.format"),value:h,options:B,onChange:P=>v(P)}],L=async P=>{i(Ht(0));const U=P==="current"?[x]:Object.keys(b).filter(k=>!["linestart","lineend"].includes(k)),$=new mi;for(const k in U){i(Ht((Number(k)+1)/U.length*100));const O=U[k];i(Ct(O)),await $r(500);const d=await gi(e,p,t,f,y);document.body.appendChild(d);const M=`rmg.${O}.${b[O].localisedName.en}`.replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(h==="png"){const ne=Yr()&&k==="0",Z=await bi(d,y/100,ne);U.length>1?$.file(`${M}.png`,Z):Vt(`${M}.png`,Z)}else if(h==="svg"){d.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(d.outerHTML)));U.length>1?$.file(`${M}.svg`,ne.split("base64,")[1],{base64:!0}):bn(M+".svg","image/svg+xml",d.outerHTML)}document.body.removeChild(d)}if(U.length>1){const k=await $.generateAsync({type:"blob"}),O=`rmg.${C[0]}.${C[1]}.zip`.replaceAll(" ","_");Vt(O,k)}de.event(we.DOWNLOAD_IMAGES,{canvasToDownload:e,style:p,option:P,format:h}),i(Ct(x)),i(Or()),r()};return m.jsxs(Ke,{isOpen:c,onClose:r,children:[m.jsx(Xe,{}),m.jsxs(Je,{children:[m.jsx(Qe,{children:s("DownloadModal.title")}),m.jsx(et,{}),m.jsx(tt,{children:m.jsx(ge,{fields:z})}),m.jsx(nt,{children:m.jsxs(Oe,{children:[m.jsx(oe,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>L("current"),isDisabled:!e,children:s("DownloadModal.downloadOne")}),p!==X.GZMTR&&m.jsx(oe,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>L("all"),isDisabled:!e,children:s("DownloadModal.downloadAll")})]})})]})]})}function vi(){const{t:a}=le(),[c,r]=J.useState(!1),{paramConfig:s}=Q(n=>n.app),i=Q(n=>n.param),e=()=>{const n=qr(i);bn(`RMG_${s?.id}.json`,"application/json",JSON.stringify(n)),de.event(we.DOWNLOAD_PARAM,{style:i.style})};return m.jsxs(En,{children:[m.jsx(On,{as:oe,variant:"ghost",size:"sm",rightIcon:m.jsx(Rr,{}),children:a("DownloadActions.downloads")}),m.jsxs(Rn,{children:[m.jsx(Dt,{onClick:e,children:a("DownloadActions.configFile")}),m.jsx(Dt,{onClick:()=>r(!0),children:a("DownloadActions.images")})]}),m.jsx(_i,{isOpen:c,onClose:()=>r(!1)})]})}function rt(){const[a,c]=Dn();return[a,s=>{c(s);const e=Object.keys(s).length===0?"/":"/?"+new URLSearchParams(s);de.updateAppMetadata({hash:e})}]}function yi(){const{t:a}=le(),c=on(),[,r]=rt(),s=()=>{c(Le(Me.CLOSE)),c(At(void 0)),r({})};return m.jsxs(Oe,{ml:"auto",w:"fit-content",children:[m.jsx(oe,{variant:"ghost",size:"sm",leftIcon:m.jsx(zr,{}),onClick:s,children:a("All projects")}),m.jsx(vi,{}),m.jsx(oe,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:m.jsx(Pr,{}),onClick:()=>c(Le(Me.STYLE)),children:a("HeaderActions.editStyle")})]})}function Si(){const{t:a}=le(),c=ue(),{canvasToShow:r,canvasScale:s}=Q(f=>f.app),i=Q(f=>f.param.style),e=Object.values(X).reduce((f,_)=>({...f,[_]:a("RmgStyle."+_)}),{}),n=Pt[i].map(f=>({label:a("CanvasType."+f),value:f})),t=f=>{c(Lr(f))},l=[{type:"select",label:a("Style"),value:i,options:e,onChange:f=>t(f)},{type:"custom",label:a("View"),component:m.jsx(Tr,{displayValue:a("Select canvas"),selections:n,defaultValue:r,onChange:f=>c(Br(f))})},{type:"slider",label:a("Canvas scale"),value:s,min:.1,max:2,step:.01,onChange:f=>c(Mr(f)),leftIcon:m.jsx(Ir,{}),rightIcon:m.jsx(Nr,{})}];return m.jsxs(Dr,{children:[m.jsx(ge,{fields:l,minW:160}),m.jsx(yi,{})]})}const Ye=(a,c,r,s)=>(i,e)=>{const n=e().param.stn_list;let t=qe(6);for(;t in n;)t=qe(6);const l=Fr(t);if(a!=="new"){const f={...n,[c]:{...n[c],children:n[c].children.map(_=>_===r?t:_),branch:{left:n[c].branch?.left,right:n[c].branch?.right?.[1]===r?n[c].branch?.right?.with(1,t):n[c].branch?.right}},[r]:{...n[r],parents:n[r].parents.map(_=>_===c?t:_),branch:{left:n[r].branch?.left?.[1]===c?n[r].branch?.left?.with(1,t):n[r].branch?.left,right:n[r].branch?.right}},[t]:{...l,parents:[c],children:[r]}};return i(xe(f)),t}else{if(!s)return!1;const f={...n,[c]:{...n[c],children:s==="upper"?[t,n[c].children[0]]:[n[c].children[0],t],branch:{left:n[c].branch?.left,right:[ht.through,t]}},[r]:{...n[r],parents:s==="upper"?[t,n[r].parents[0]]:[n[r].parents[0],t],branch:{left:[ht.through,t],right:n[r].branch?.right}},[t]:{...l,parents:[c],children:[r]}};return i(xe(f)),t}},xi=(a,c,r)=>(s,i)=>{const n=i().helper.branches[a];if(n?.length)if(c==="before"){const t=n[n.indexOf(r)-1];return s(Ye(a.toString(),t,r))}else{const t=n[n.indexOf(r)+1];return s(Ye(a.toString(),r,t))}else return!1},wi=()=>(a,c)=>{const r=c().param.stn_list;return c().helper.branches[0].filter(i=>{const e=r[i].parents.length+r[i].children.length===4,n=Bt(i,r)===0;return!e&&n})},rn=(a,c)=>(r,s)=>{const i=s().param.stn_list,e=s().helper.branches;return!e[0].includes(a)||!e[0].includes(c)?"Branch should end at main line":e[0].indexOf(a)>=e[0].indexOf(c)?"Not in correct ordering":a==="linestart"&&c==="lineend"?"Should not be parallel to main line":a==="linestart"&&e[0].indexOf(c)===1?"Branch should not be open jaw from the first station":c==="lineend"&&e[0].indexOf(a)===e[0].length-2?"Branch should not be open jaw from the last station":i[a].children.length>1||i[c].parents.length>1?"Branch already exist":e.slice(1).some(l=>l.slice(1,-1).includes(a)||l.slice(1,-1).includes(c))?"Cannot branch out from existing branch":e[0].slice(e[0].indexOf(a)+1,e[0].indexOf(c)).every(l=>i[l].parents.length===1&&i[l].children.length===1)?"":"One or more stations between both ends are branching out"};function ki(a){const{isOpen:c,onClose:r}=a,{t:s}=le(),i=ue(),e=Q(B=>B.app.selectedBranch),{style:n,stn_list:t}=Q(B=>B.param),l=Q(B=>B.helper.branches),[f,_]=J.useState(e),[y,g]=J.useState("before"),[h,v]=J.useState(""),[u,p]=J.useState(!1);J.useEffect(()=>{_(e)},[e]),J.useEffect(()=>{c||p(!1)},[c]);const b=l[Number(f)]?.slice(1,-1)??[],x=B=>B.reduce((z,L)=>({...z,[L]:t[L]?.localisedName.zh+"/"+t[L]?.localisedName.en}),{"":s("AddStationModal.pleaseSelect")}),C=[{type:"select",label:s("AddStationModal.where"),value:f,options:{...l.reduce((B,z,L)=>({...B,[L]:L===0?s("AddStationModal.main"):n!==X.SHMetro||!We(z,t)?s("AddStationModal.branch")+" "+L:s("AddStationModal.external")+" "+L}),{})},onChange:B=>j(B),minW:"full"},{type:"select",label:s("AddStationModal.preposition"),value:y,options:{before:s("AddStationModal.before"),after:s("AddStationModal.after")},onChange:B=>g(B)},{type:"select",label:s("AddStationModal.pivot"),value:h,options:x(b),disabledOptions:[""],onChange:B=>v(B)}],j=B=>{_(B),v("")},A=()=>{const B=i(xi(f,y,h));B?(r(),i(fn(B)),i(Le(Me.STATION))):(console.log("false here"),p(!0)),de.event(we.ADD_STATION,{style:n,branchIndex:f,success:B})};return m.jsxs(Ke,{isOpen:c,onClose:r,children:[m.jsx(Xe,{}),m.jsxs(Je,{children:[u&&m.jsxs(ut,{status:"error",variant:"solid",size:"xs",children:[m.jsx(ft,{}),s("AddStationModal.error")]}),m.jsxs(ke,{position:"relative",children:[m.jsx(Qe,{children:s("AddStationModal.title")}),m.jsx(et,{})]}),m.jsx(tt,{children:m.jsx(ge,{fields:C})}),m.jsx(nt,{children:m.jsx(oe,{colorScheme:"primary",onClick:A,isDisabled:!h,children:s("Confirm")})})]})]})}function Ci(a){const{isOpen:c,onClose:r}=a,{t:s}=le(),i=ue(),[e,n]=J.useState("new"),[t,l]=J.useState(""),[f,_]=J.useState(""),[y,g]=J.useState("upper"),[h,v]=J.useState(""),[u,p]=J.useState(""),{style:b,stn_list:x}=Q($=>$.param);J.useEffect(()=>{c||(n("new"),l(""),_(""))},[c]);const j=($=>$.reduce((k,O)=>({...k,[O]:O==="linestart"?`(${s("LEFT END")})`:O==="lineend"?`(${s("RIGHT END")})`:x[O]?.localisedName.zh+"/"+x[O]?.localisedName.en}),{"":s("Please select...")}))(i(wi())),A=[{type:"select",label:s("NewBranchModal.where"),value:e,options:{new:s("NewBranchModal.new"),ext:s("NewBranchModal.ext")},disabledOptions:b===X.SHMetro?[]:["ext"],onChange:$=>B($),minW:"full"},{type:"select",label:s("NewBranchModal.from"),value:t,options:j,disabledOptions:[""],onChange:$=>z($),isInvalid:!!h},{type:"select",label:s("NewBranchModal.to"),value:f,options:j,disabledOptions:[""],onChange:$=>L($),isInvalid:!!u},{type:"select",label:s("NewBranchModal.position"),value:y,options:{upper:s("NewBranchModal.upper"),lower:s("NewBranchModal.lower")},onChange:$=>g($),minW:"full",hidden:e!=="new"||b===X.SHMetro}],B=$=>{n($),l(""),_(""),v(""),p("")},z=$=>{l($),v(""),$&&f&&p(i(rn($,f)))},L=$=>{_($),p(""),t&&$&&v(i(rn(t,$)))},P=()=>{let $;e==="ext"?$=i(Ye("new",t,f,"lower")):b===X.SHMetro?$=i(Ye("new",t,f,"upper")):$=i(Ye("new",t,f,y)),$&&(r(),de.event(we.ADD_BRANCH,{style:b,where:e}))},U=!!(!t||!f||h||u);return m.jsxs(Ke,{isOpen:c,onClose:r,children:[m.jsx(Xe,{}),m.jsxs(Je,{children:[m.jsx(Qe,{children:s("NewBranchModal.title")}),m.jsx(et,{}),m.jsx(tt,{children:m.jsx(ge,{fields:A})}),m.jsx(nt,{children:m.jsx(oe,{colorScheme:"primary",title:U?h||u:s("Confirm"),onClick:P,isDisabled:U,children:s("Confirm")})})]})]})}const ji=J.lazy(()=>Fe(()=>import("./station-ag-grid-Bc0gTPwo.js"),__vite__mapDeps([12,1,2,3,4,13,14,9])));function Ai(){const{t:a}=le(),c=ue(),[r,s]=J.useState(!1),[i,e]=J.useState(!1),n=Q(g=>g.app.selectedBranch),{style:t,stn_list:l,loop:f}=Q(g=>g.param),_=Q(g=>g.helper.branches),y=()=>{c(Le(Me.BRANCH))};return m.jsxs(ke,{flex:1,overflow:"hidden",children:[m.jsxs(zn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:n,onChange:g=>c(un(g)),children:[m.jsxs(Pn,{children:[_.map((g,h)=>h===0?m.jsx(gt,{children:a(f?"Loop line":"GridTabs.main")},h):t!==X.SHMetro||!We(g,l)?m.jsxs(gt,{children:[a("GridTabs.branch")+" "+h,f&&m.jsx(Ur,{style:{marginLeft:5},title:a("Branches are not supported in the loop line.")})]},h):m.jsx(gt,{children:a("GridTabs.external")+" "+h},h)),m.jsx(Ne,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>e(!0),icon:m.jsx(Be,{}),isDisabled:f}),m.jsxs(Oe,{marginLeft:"auto",marginRight:1,children:[m.jsx(oe,{variant:"outline",size:"xs",leftIcon:m.jsx(Be,{}),onClick:()=>s(!0),children:a("GridTabs.addStation")}),m.jsx(oe,{size:"xs",colorScheme:"primary",onClick:y,children:a("GridTabs.editLine")})]})]}),m.jsx(Tn,{flex:1,overflowY:"auto",children:_.map((g,h)=>m.jsx(Bn,{padding:0,h:"100%",position:"relative",children:m.jsx(ln,{suspenseFallback:m.jsx(pt,{isIndeterminate:!0}),children:m.jsx(ji,{branchIndex:h})})},h))})]}),m.jsx(ki,{isOpen:r,onClose:()=>s(!1)}),m.jsx(Ci,{isOpen:i,onClose:()=>e(!1)})]})}function Ei(){const a=ue(),c=Q(s=>s.app.globalAlerts),r=s=>{de.isStandaloneWindow()?window.open(`/${s}`,"_blank"):de.openApp({appId:s})};return m.jsx(m.Fragment,{children:Object.entries(c).map(([s,{message:i,url:e,linkedApp:n}])=>m.jsxs(ut,{status:s,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[m.jsx(ft,{}),n?m.jsx(Ve,{onClick:()=>r(n),children:i}):e?m.jsx(Ve,{href:e,target:"_blank",children:i}):i,m.jsx(sn,{ml:"auto",onClick:()=>a(Wr(s))})]},s))})}const wn=a=>{document.title=a,setTimeout(()=>{de.updateAppMetadata({title:a})},200)};function Oi(){const{t:a}=le(),[c]=rt(),r=c.get("project"),s=Q(n=>n.app.isLoading),[i,e]=J.useState(!1);return J.useEffect(()=>{if(de.isStandaloneWindow()&&!de.storage.get($e.DO_NOT_SHOW_RMT_MSG)&&e(!0),r){const n=Kr(r);wn(n?.name??a("Project")+" "+r)}},[]),m.jsxs(gn,{children:[s&&m.jsx(pt,{isIndeterminate:s<0,value:s>=0?s:void 0}),m.jsx(Si,{}),i&&m.jsxs(ut,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[m.jsx(ft,{}),m.jsxs(lt,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[a("Try out")," ",m.jsx(Ve,{href:"/?app=rmg",isExternal:!0,children:a("Rail Map Toolkit")})," ",a("now and enjoy an even better rail map design experience!")," ",m.jsx(Ve,{as:"button",ml:"auto",onClick:()=>e(!1),children:a("Close")})," | ",m.jsx(Ve,{as:"button",onClick:()=>{e(!1),de.storage.set($e.DO_NOT_SHOW_RMT_MSG,"true")},children:a("Don't show me again")})]})]}),m.jsx(Ei,{}),m.jsxs(Pe,{flex:1,overflow:"hidden",position:"relative",children:[m.jsxs(Pe,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[m.jsx(ke,{children:m.jsx(as,{})}),m.jsx(Ai,{})]}),m.jsx(ui,{})]}),m.jsx("canvas",{style:{display:"none"}})]})}const Ri="rmg-templates-bridge--",zi={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Pi(a){const{isOpen:c,onClose:r,onImport:s}=a,[i]=J.useState(qe()),e="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:de.getAppName(),parentId:i});return J.useEffect(()=>{const n=new BroadcastChannel(Ri+i);return n.onmessage=t=>{const{event:l,meta:f,data:_}=t.data;console.log("[rmg] Received event from RMG Templates app clip:",l),l==="CLOSE"?r():l==="IMPORT"&&s(_,f.name)},()=>{n.close()}},[]),m.jsx(mn,{size:"xl",isOpen:c,onClose:r,sx:zi,children:m.jsx("iframe",{src:e,loading:"eager"})})}const Ti={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function Bi(a){const{selectedParam:c,disableNew:r,onError:s}=a,{t:i}=le(),[,e]=rt(),[n,t]=J.useState(!1),l=J.useRef(null),f=J.useRef(null);J.useEffect(()=>{c&&f.current?.focus()},[c]);const _=()=>{const v=Vr(X.MTR,de.getLanguage()),u=_t(JSON.stringify(v));e({project:u}),de.event(we.NEW_PARAM,{})},y=(v,u)=>{const p=_t(JSON.stringify(v),u);e({project:p})},g=async v=>{const u=v.target.files?.[0];Ee.info("handleImportProject(), received file",u);try{if(!u)s(i("OpenActions.unknownError"));else if(u.type!=="application/json")s(i("OpenActions.invalidType"));else{const p=await Xr(u),b=_t(p);e({project:b}),de.event(we.UPLOAD_PARAM,{})}}catch(p){s(i("OpenActions.unknownError")),Ee.error("handleImportProject(), Unknown error occurred while parsing the uploaded file",p)}v.target.value=""},h=()=>{c&&(e({project:c}),de.event(we.OPEN_PARAM,{}))};return m.jsxs(Pe,{sx:Ti,children:[m.jsx(oe,{leftIcon:m.jsx(Be,{}),onClick:_,isDisabled:r,children:i("Blank project")}),m.jsx(oe,{leftIcon:m.jsx(Zr,{}),onClick:()=>t(!0),isDisabled:r,children:i("Open template")}),m.jsx(oe,{leftIcon:m.jsx(Gr,{}),onClick:()=>l.current?.click(),isDisabled:r,children:i("Import project")}),m.jsx(oe,{ref:f,colorScheme:"primary",leftIcon:m.jsx(Hr,{}),onClick:h,isDisabled:c===void 0,children:i("Open selected")}),m.jsx("input",{ref:l,type:"file",accept:".json",hidden:!0,onChange:g,"data-testid":"file-upload"}),m.jsx(Pi,{isOpen:n,onClose:()=>t(!1),onImport:y})]})}const Ni={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Ii(a){const{downloading:c}=a,{t:r}=le(),[s]=rt(),i=s.get("project"),[e,n]=J.useState([]),[t,l]=J.useState(),f=J.useRef(null),_=an();J.useEffect(()=>{wn(r("Manage projects"))},[]),J.useEffect(()=>{n(vt())},[c]),Nn({ref:f,handler:()=>l(void 0)});const y=v=>{const{id:u,name:p,lastModified:b}=v;u&&(de.storage.set($e.PARAM_CONFIG_BY_ID+u,JSON.stringify({name:p,lastModified:b})),l(void 0),n(vt()),de.event(we.UPDATE_PARAM_CONFIG,{}))},g=v=>{de.storage.remove($e.PARAM_BY_ID+v),de.storage.remove($e.PARAM_CONFIG_BY_ID+v),l(void 0),n(vt()),de.event(we.REMOVE_PARAM,{})},h=v=>{_({description:v,status:"error",duration:1e4,isClosable:!0})};return m.jsxs(gn,{justifyContent:"center",children:[i&&m.jsx(pt,{isIndeterminate:!0}),m.jsx(In,{children:m.jsxs(De,{sx:Ni,children:[m.jsx(ve,{as:"h3",size:"lg",children:r("Saved projects")}),m.jsxs(Pe,{ref:f,children:[m.jsx(Jr,{paramRegistry:e,downloading:c,selectedParam:t,onParamSelect:l,onParamRemove:g,onParamUpdate:y}),m.jsx(Bi,{selectedParam:t,disableNew:e.length>=10,onError:h})]})]})})]})}const Mi=a=>async c=>{try{const{config:r,param:s}=Qr(a);if(!s)return!1;const i={id:a,...r??{}},e=es(s);try{const n=await ts(e);c(At(i)),c($t(n))}catch(n){console.warn("Unable to update themes",n),c(At(i)),c($t(e))}return!0}catch(r){return console.warn("Failed to parse param.",r),!1}};function Di(){const{t:a}=le(),c=ue(),{paramConfig:r}=Q(g=>g.app),[s,i]=rt(),e=s.get("project"),n=s.get("external"),[t,l]=J.useState(!1),[f,_]=J.useState(),y=an();return J.useEffect(()=>{if(Ee.info(`searchParam: project=${e}, external=${n}`),e&&n)Ee.warn("<AppRouter/>, Both param ID and external URL are provided. External URL will be ignored."),i({project:e});else if(e)y.closeAll(),e===r?.id?(Ee.info("<AppRouter/>, Store param ID matches URL param ID. Rendering app view..."),l(!0)):(Ee.info(`<AppRouter/>, Loading app view for param (ID=${e})...`),c(Mi(e)).then(g=>{g?l(!0):(Ee.info(`<AppRouter/>, Failed to read param (ID=${e}). Rendering param selector view...`),y({description:a("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),i({}))}));else if(n){Ee.info("<AppRouter/>, External project URl is provided. Downloading project...");const g=decodeURIComponent(n);_(g),ns(g).then(h=>{h?i({project:h}):(Ee.info(`<AppRouter/>, Failed to download param from ${g}. Rendering param selector view...`),y({description:a("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),i({})),_(void 0)})}else Ee.info("<AppRouter/>, No URL param ID or external URL provided. Rendering param selector view..."),l(!1)},[e,n]),t?m.jsx(Oi,{}):m.jsx(Ii,{downloading:f})}const Gi=Object.freeze(Object.defineProperty({__proto__:null,default:Di},Symbol.toStringTag,{value:"Module"}));export{rs as R,Gi as a,Zi as g,We as i};
