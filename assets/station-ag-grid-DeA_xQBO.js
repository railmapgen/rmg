import{av as E,u as F,j as a,B as H,g as L,aD as N}from"./chakra-Blar0cOi.js";import{d as P,u as f,e as g,aS as y,h as B,aa as G,a9 as W,ab as Z,aT as O}from"./index-ByHbMz0C.js";import{u as _,r as o}from"./react-BGwHOppr.js";import{g as $,R as q}from"./app-router-SemYy3qo.js";import{A as J}from"./ag-grid-react-d41jQvle.js";import"./param-selector-BbRrth1u.js";import"./ag-grid-community-BZGUBSmq.js";var K=function(d){var l=d.children,t=E().colorMode,c=F("RmgAgGrid");return a.jsx(H,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:c,children:l})};function Q(d){const{lineNumber:l,stationNumber:t,lineColour:c}=d,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:c,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return a.jsxs(L,{sx:i,children:[a.jsx("span",{children:l}),a.jsx("span",{children:t})]})}function ae(d){const{branchIndex:l}=d,{t,i18n:c}=_(),i=P(),S=f(e=>e.app.sidePanelMode),{style:u,theme:x,stn_list:R,line_num:j,coline:M}=f(e=>e.param),b=f(e=>e.helper.branches),[A,T]=o.useState([]);o.useEffect(()=>{const e=b[l].reduce((n,s)=>["linestart","lineend"].includes(s)?n:[...n,{...R[s],id:s,rowSpan:i($(s,l))}],[]);T(e)},[b,l,R]);const v=o.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:e})=>a.jsx(Q,{lineNumber:j,stationNumber:e,lineColour:x[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(u)},{headerName:t("Chinese name"),field:"localisedName",valueFormatter:({value:e,data:n})=>{var s;return e.zh+(u===g.GZMTR&&((s=n==null?void 0:n.localisedSecondaryName)!=null&&s.zh)?" (".concat(n.localisedSecondaryName.zh,")"):"")}},{headerName:t("English name"),field:"localisedName",cellRenderer:({value:e,data:n})=>{var s;return a.jsx(q,{text:e.en+(u===g.GZMTR&&((s=n.localisedSecondaryName)!=null&&s.en)?" (".concat(n.localisedSecondaryName.en,")"):"")})},minWidth:300},{headerName:t("StationAgGrid.interchange"),field:"transfer",cellRenderer:({value:e})=>a.jsx(N,{children:e.groups.map(n=>{var s;return(s=n.lines)!=null?s:[]}).flat().map((n,s)=>{var r,h,w,C;return a.jsx(y,{name:n.name,bg:(h=(r=n.theme)==null?void 0:r[2])!=null?h:"#aaaaaa",fg:(C=(w=n.theme)==null?void 0:w[3])!=null?C:B.white,showShortName:!0},s)})})},{headerName:t("StationAgGrid.coline"),field:"rowSpan",rowSpan:({data:e})=>{var n;return(n=e==null?void 0:e.rowSpan[0])!=null?n:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({value:e})=>e[0]>0},cellRenderer:({value:e})=>{var n,s;return a.jsx(N,{children:(s=(n=M[e[1]])==null?void 0:n.colors)==null?void 0:s.map((r,h)=>a.jsx(y,{name:[r[4],r[5]],bg:r[2],fg:r[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(u)}],[u,x.toString(),c.language]),m=o.useRef(null),p=o.useRef(!1);o.useEffect(()=>{p.current&&m.current&&m.current.api.getSelectedRows().length===1&&S!==G.STATION&&m.current.api.deselectAll()},[p.current,S]);const[k]=o.useState({resizable:!0}),D=o.useCallback(()=>{p.current=!0},[p.current]),I=o.useCallback(({api:e})=>{var s;const n=(s=e.getSelectedRows())==null?void 0:s.map(r=>r.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",n),n!=null&&n.length&&(i(W(G.STATION)),i(Z(n[0])),i(O(void 0)))},[]),z=o.useCallback(({data:e})=>e.id,[]);return a.jsx(K,{children:a.jsx(J,{ref:m,rowData:A,defaultColDef:k,columnDefs:v,getRowId:z,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:"single",onSelectionChanged:I,onGridReady:D,debug:!1})})}export{ae as default};
