!function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function t(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach(function(e){n(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function n(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["./index-legacy-XhBWJhG2.js","./chakra-legacy-az1WooHM.js","./react-legacy-CADlrHyp.js"],function(e,n){"use strict";var i,r,o,s,a,l,c,d,u,h,g,f,p,_,m,v,b,y,j,w,x,O,P,D,S,A,C,M,R,N,T,k,E,W,I;return{setters:[e=>{i=e.j,r=e.ai,o=e.aT,s=e.aU,a=e.ah,l=e.e,c=e.ab,d=e.l,u=e.aV,h=e.r,g=e.aW,f=e.i,p=e.aM,_=e.aX,m=e.aY,v=e.m},e=>{b=e.u,y=e.j,j=e.c,w=e.h,x=e.aC,O=e.aj,P=e.M,D=e.ak,S=e.J,A=e.K,C=e.L,M=e.O,R=e.t,N=e.B,T=e.s,k=e.a2,E=e.N},e=>{W=e.a,I=e.u}],execute:function(){e({P:function(e){const{paramRegistry:t,downloading:n,selectedParam:i,onParamSelect:r,onParamRemove:o,onParamUpdate:s}=e,{t:a}=I(),[l,c]=W.useState();return y.jsxs(N,{sx:K,children:[y.jsxs(w,{children:[n&&y.jsx(_,{variant:"ghost",primaryText:a("Downloading")+"...",secondaryText:n,isDisabled:!0}),t.slice().sort((e,t)=>{var n,i;return(null!==(n=t.lastModified)&&void 0!==n?n:0)-(null!==(i=e.lastModified)&&void 0!==i?i:0)}).map(e=>{var t;return y.jsxs(T,{size:"sm",isAttached:!0,colorScheme:i===e.id?"primary":void 0,variant:i===e.id?"solid":"ghost",children:[y.jsx(_,{primaryText:null!==(t=e.name)&&void 0!==t?t:a("Project")+" "+e.id,secondaryText:a("Last modified")+": "+F(e.lastModified).map(e=>a(e)).join(" "),"aria-pressed":i===e.id,onClick:()=>r(e.id)}),s&&y.jsx(k,{"aria-label":a("Edit project info"),title:a("Edit project info"),icon:y.jsx(m,{}),onClick:()=>c(e)}),o&&y.jsx(k,{"aria-label":a("Remove project"),title:a("Remove project"),icon:y.jsx(v,{}),onClick:()=>o(e.id)})]},e.id)})]}),t.length>=10&&y.jsx(E,{as:"em",fontSize:"xs",children:a("You have reached the maximum number of projects.")}),y.jsx(X,{config:l,onClose:()=>c(void 0),onUpdate:e=>{null==s||s(e),c(void 0)}})]})},R:z});var n=function(e){var t=e.children,n=e.noWrap,i=b("RmgOutput",{noWrap:n});return y.jsx(j.output,{sx:i,children:t})};function z(e){var t=e.fields,l=e.noLabel,c=e.minW;return y.jsx(w,{wrap:"wrap",children:t.map(function(e,t){if(e.hidden)return y.jsx(W.Fragment,{},t);var d=e.minW||c,u="full"===d;return y.jsx(i,{className:u?"mw-full":"",label:e.label,flex:u?void 0:1,minW:u?void 0:d,noLabel:l,oneLine:e.oneLine,helper:e.helper,errorMessage:e.errorMessage,children:function(e){switch(e.type){case"input":return y.jsx(a,{placeholder:e.placeholder,defaultValue:e.value,type:e.variant,validator:e.validator,onDebouncedChange:e.onChange,delay:e.debouncedDelay,optionList:e.optionList,isDisabled:e.isDisabled});case"output":return y.jsx(n,{noWrap:e.noWrap,children:e.value});case"textarea":return y.jsx(s,{placeholder:e.placeholder,defaultValue:e.value,onDebouncedChange:e.onChange,isDisabled:e.isDisabled});case"slider":return y.jsx(o,{defaultValue:e.value,min:e.min,max:e.max,step:e.step,onThrottledChange:e.onChange,leftIcon:e.leftIcon,rightIcon:e.rightIcon,isDisabled:e.isDisabled});case"select":return y.jsx(r,{defaultValue:e.value,onChange:function(t){var n,i=t.target.value;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,"number"==typeof e.value?Number(i):i.toString())},options:e.options,disabledOptions:e.disabledOptions,isInvalid:e.isInvalid,isDisabled:e.isDisabled});case"switch":return y.jsx(x,{isChecked:e.isChecked,isDisabled:e.isDisabled,onChange:function(t){var n,i=t.target.checked;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,i)}});case"custom":return e.component;default:return y.jsx("div",{})}}(e)},t)})})}e("a",(e,t,n)=>{const i=new Blob([n],{type:t});L(e,i)});const L=e("d",(e,t)=>{const n=window.URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)}),F=(e("r",e=>new Promise(t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsText(e)})),e("i",()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")),e=>{if(e){const t=(new Date).getTime()-e;return t<6e4?["Just now"]:t<12e4?["1","minute ago"]:t<36e5?[Math.floor(t/1e3/60).toString(),"minutes ago"]:t<72e5?["1","hour ago"]:t<864e5?[Math.floor(t/1e3/60/60).toString(),"hours ago"]:t<1728e5?["1","day ago"]:[Math.floor(t/1e3/60/60/24).toString(),"days ago"]}return["Unknown"]}),$=(e("w",e=>new Promise(t=>{setTimeout(t,e)})),e("u",e=>{var n,i,r,o;"line_name"in e||(e.line_name=["路線名","Name of Line"]),delete e.fontZH,delete e.fontEN,delete e.weightZH,delete e.weightEN;for(const[t,l]of Object.entries(e.stn_list))"branch"in l||(e.stn_list[t].branch={},2===l.children.length&&(e.stn_list[t].branch.right=["through",l.children[1]]),2===l.parents.length&&(e.stn_list[t].branch.left=["through",l.parents[1]]),0===Object.keys(e.stn_list[t].branch).length&&delete e.stn_list[t].branch);e.psd_num="psd_num"in e?e.psd_num.toString():"1","line_num"in e||(e.line_num="1"),3===e.theme.length&&e.theme.push("#fff");for(const[t,l]of Object.entries(e.stn_list))"num"in l||(e.stn_list[t].num="00"),"interchange"in l&&l.interchange.map(e=>e.forEach(e=>{5===e.length&&e.splice(3,0,"#fff")}));for(const[t,l]of Object.entries(e.stn_list))"osi22_end_p"===l.change_type&&(e.stn_list[t].change_type="osi22_pr"),"osi22_end_u"===l.change_type&&(e.stn_list[t].change_type="osi22_ur");for(const[t,l]of Object.entries(e.stn_list))"interchange"in l||(e.stn_list[t].interchange=[[]]);e.info_panel_type="info_panel_type"in e?(e=>{switch(e){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return e}})(e.info_panel_type):"gz28","direction_gz_x"in e||(e.direction_gz_x=50),"direction_gz_y"in e||(e.direction_gz_y=70);for(const[t,l]of Object.entries(e.stn_list)){var s,a,d,u;if(!("transfer"in l))e.stn_list[t].transfer={tick_direc:"none"===l.change_type||"int2"===l.change_type?"r":null===(s=l.change_type)||void 0===s?void 0:s.split("_")[1].split("").slice().reverse()[0],paid_area:-1===(null===(a=l.change_type)||void 0===a?void 0:a.indexOf("osi"))||"p"===(null===(d=l.change_type)||void 0===d?void 0:d.split("_")[1][0]),osi_names:-1!==(null===(u=l.change_type)||void 0===u?void 0:u.indexOf("osi"))?[l.interchange[1][0]]:[],info:2===l.interchange.length?[l.interchange[0],l.interchange[1].slice(1)]:l.interchange};delete e.stn_list[t].change_type,delete e.stn_list[t].interchange}for(const[t,l]of Object.entries(e.stn_list))"services"in l||(e.stn_list[t].services=["local"]),"facility"in l?""===l.facility&&(e.stn_list[t].facility=void 0):e.stn_list[t].facility=l.usage||void 0,delete e.stn_list[t].usage;"customiseMTRDest"in e||(e.customiseMTRDest={isLegacy:e.dest_legacy||!1,terminal:!1}),delete e.dest_legacy,"svgWidth"in e||(e.svgWidth={destination:e.svg_dest_width,runin:e.svg_dest_width,railmap:e.svg_width,indoor:e.svg_width}),"indoor"in e.svgWidth||(e.svgWidth.indoor=e.svgWidth.railmap),delete e.svg_width,delete e.svg_dest_width,e.notesGZMTR=null===(n=e.notesGZMTR)||void 0===n?void 0:n.map(e=>4===e.length?e.concat([!1]):e),delete e.char_form,delete e.show_outer,delete e.strip_pc,delete e.txt_bg_gap,"namePosMTR"in e||(e.namePosMTR={isStagger:!0,isFlip:e.txt_flip}),delete e.txt_flip,Object.keys(e.stn_list).forEach(t=>{"secondaryName"in e.stn_list[t]&&!1===e.stn_list[t].secondaryName&&delete e.stn_list[t].secondaryName,"type"in e.stn_list[t].transfer&&delete e.stn_list[t].transfer.type}),e.style=void 0!==e.style&&Object.values(l).includes(e.style)?e.style:l.MTR,e.coline=null!==(i=e.coline)&&void 0!==i?i:[],e.loop=null!==(r=e.loop)&&void 0!==r&&r,e.loop_info=null!==(o=e.loop_info)&&void 0!==o?o:{bank:!0,left_and_right_factor:0,bottom_factor:1},e.loop_info.left_and_right_factor+e.loop_info.bottom_factor===0&&(e.loop_info.left_and_right_factor=1);for(const[t,l]of Object.entries(e.stn_list))"loop_pivot"in l||(e.stn_list[t].loop_pivot=!1);return Array.isArray(e.coline)&&(e.coline=e.coline.reduce((e,n)=>t(t({},e),{},{[c(4)]:n}),{})),!1===e.platform_num&&(e.platform_num=""),Object.values(e.stn_list).forEach(t=>{var n,i;const r=t;r.one_line=null!==(n=r.one_line)&&void 0!==n&&n,r.int_padding=null!==(i=r.int_padding)&&void 0!==i?i:e.loop?250:355}),void 0===e.branchSpacingPct&&(e.style===l.SHMetro?e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*300):e.branchSpacingPct=Math.round(e.branch_spacing/e.svg_height*200),delete e.branch_spacing),$(e),U(e),Y(e),V(e),e}),e=>{for(const[t,n]of Object.entries(e.stn_list)){const i=n.transfer.info;i&&(e.stn_list[t].transfer.groups=i.map((e,t)=>e.length?{name:n.transfer.osi_names[t-1],lines:e.map(e=>{const t=e;return{theme:t.slice(0,4),name:t.slice(4,6)}})}:{lines:[]})),delete e.stn_list[t].transfer.info,delete e.stn_list[t].transfer.osi_names}}),U=e=>{for(const[t,n]of Object.entries(e.stn_list)){const{name:i,secondaryName:r,localisedName:o,localisedSecondaryName:s}=n;!o&&i&&(e.stn_list[t].localisedName={zh:i[0],en:i[1]},delete e.stn_list[t].name),!s&&r&&(e.stn_list[t].localisedSecondaryName={zh:r[0],en:r[1]},delete e.stn_list[t].secondaryName)}},Y=e=>{const{svgWidth:t}=e;g.Platform in t||(e.svgWidth.platform=1200);for(const[n,i]of Object.entries(e.stn_list)){const{character_spacing:t}=i;void 0===t&&(e.stn_list[n].character_spacing=75)}},B=e=>4===e.length&&e.every(e=>"string"==typeof e)&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(f).includes(e[3]),J=(e,t,n)=>{const i=t.split(".");let r=e;for(let o=0;o<i.length-1;o++)r=r[i[o]];r[i[i.length-1]]=n},G=(e("f",async e=>{const t=(new Date).getTime(),n=(e=>{const t=[],n=(e,i)=>{if(Array.isArray(e)&&B(e))t.push({path:i||"",value:e});else for(const r in e){const o=e[r],s=i?`${i}.${r}`:r;Array.isArray(o)?B(o)?t.push({path:s,value:o}):o.forEach((e,t)=>n(e,`${s}.${t}`)):o&&"object"==typeof o&&n(o,s)}};return n(e),t})(e);d.info("Found all themes pending for update",n);const i=JSON.parse(JSON.stringify(e));let r,o=!1;const s=new Promise((e,t)=>{r=setTimeout(()=>{o=!0,t("Executing time exceeds 5000ms")},5e3),(async()=>{for(const{path:e,value:t}of n){if(o)throw new Error("Update aborted");const n=await u(t);J(i,e,n)}})().then(e).catch(t)});try{return await s,d.info(`Themes update completed, elapsed time ${((new Date).getTime()-t)/1e3} sec`),i}catch(a){return d.warn(`Error occurs when updating themes, elapsed time ${((new Date).getTime()-t)/1e3} sec`,a),i}finally{clearTimeout(r)}}),{notesGZMTR:e=>!(null!=e&&e.length),"stn_list.*.branch.left":e=>!(null!=e&&e.length),"stn_list.*.branch.right":e=>!(null!=e&&e.length),"stn_list.*.branch":e=>!e||0===Object.keys(e).length,"stn_list.*.facility":e=>!e,"stn_list.*.transfer.groups.*.lines":e=>!(null!=e&&e.length)}),V=e("s",e=>{const t=structuredClone(e);return Object.entries(G).forEach(([e,n])=>{Object.entries(((e,t)=>{const n={},i=(e,t,r)=>{var o;let s=e;for(let n=0;n<r.length-1;n++){var a;if("*"===r[n])return void Object.keys(s).forEach(e=>i(s,[...t,...r.slice(0,n)],[e,...r.slice(n+1)]));if(s=null===(a=s)||void 0===a?void 0:a[r[n]],void 0===s)return}var l;void 0!==(null===(o=s)||void 0===o?void 0:o[r[r.length-1]])&&(n[[...t,...r].join(".")]=null===(l=s)||void 0===l?void 0:l[r[r.length-1]])};return i(e,[],t.split(".")),n})(t,e)).forEach(([e,i])=>{d.debug("Sanitising",e,i),n(i)&&J(t,e,void 0)})}),t.version=h.getAppVersion(),t}),Z=(e("c",()=>{const e=(()=>{const e=`${h.getAppName()}__${p.PARAM_CONFIG_BY_ID}`,n=Object.entries(h.storage.getAll()).filter(([t])=>t.startsWith(e)).map(([n,i])=>{const r=n.slice(e.length);if(!i)return{id:r};try{return t(t({},JSON.parse(i)),{},{id:r})}catch(o){return{id:r}}});return d.info("loadParamRegistry(), Found param config in localStorage",n.map(e=>e.id)),n})(),n=`${h.getAppName()}__${p.PARAM_BY_ID}`,i=Object.keys(h.storage.getAll()).filter(e=>e.startsWith(n)).map(t=>{var i;const r=t.slice(n.length);return null!==(i=e.find(e=>e.id===r))&&void 0!==i?i:{id:r}});return d.info("getParamRegistry(), Actual param found in localStorage",i.map(e=>e.id)),e.filter(e=>i.every(t=>t.id!==e.id)).forEach(e=>h.storage.remove(p.PARAM_CONFIG_BY_ID+e.id)),i}),e("g",e=>{const t=h.storage.get(p.PARAM_CONFIG_BY_ID+e);return t?JSON.parse(t):void 0})),H=(e("e",e=>{const t=h.storage.get(p.PARAM_BY_ID+e);return{param:t?JSON.parse(t):t,config:Z(e)}}),e("b",(e,t)=>{const n=c();return h.storage.set(p.PARAM_BY_ID+n,e),h.storage.set(p.PARAM_CONFIG_BY_ID+n,JSON.stringify({name:t,lastModified:Date.now()})),n}));e("h",async e=>{const t=e.split("/").at(-1);try{const n=await fetch(e);if(n.ok){const e=await n.text();return H(e,t)}return d.warn("Failed to download param"),null}catch(n){return d.warn("Failed to download param.",n),null}});function X(e){var n;const{config:i,onClose:r,onUpdate:o}=e,{t:s}=I(),[a,l]=W.useState(null!==(n=null==i?void 0:i.name)&&void 0!==n?n:"");W.useEffect(()=>{var e;i&&l(null!==(e=i.name)&&void 0!==e?e:"")},[i]);const c=[{type:"input",label:s("Project name"),value:a,onChange:l,debouncedDelay:0}];return y.jsxs(O,{isOpen:!!i,onClose:r,isCentered:!0,children:[y.jsx(P,{}),y.jsxs(D,{children:[y.jsx(S,{children:s("Edit project info")}),y.jsx(A,{}),y.jsx(C,{children:y.jsx(z,{fields:c})}),y.jsx(M,{children:y.jsx(R,{colorScheme:"primary",onClick:()=>{var e;i&&((null!==(e=i.name)&&void 0!==e?e:"")!==a&&o(t(t({},i),{},{name:a})))},children:s("Confirm")})})]})]})}const K={flex:"2 1 0%",overflow:"hidden",minW:{base:"unset",md:240},w:{base:"100%",md:"unset"},mr:{base:0,md:2},mb:{base:2,md:0},"& > div":{flexDirection:"column",h:200,overflowX:"hidden",overflowY:"auto",borderRadius:"md",borderWidth:2,"& >.chakra-button":{alignItems:"center"},"& .chakra-button__group":{"& button:not(:first-of-type)":{h:"100%"}}}}}}})}();
