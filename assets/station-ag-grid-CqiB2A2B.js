import{ag as D,u as E,j as s,B as F,h as H,ao as y}from"./chakra-CXrhlirJ.js";import{d as P,u as f,e as g,aZ as M,h as Z,a5 as G,a4 as B,ab as O,a_ as W}from"./index-Dur8mrwj.js";import{u as _,a as o}from"./react-Caefwd5V.js";import{g as $,R as q}from"./app-router-DU0zGKzt.js";import{A as J}from"./ag-grid-react-A6BSx5P9.js";import{M as K,v as Q,w as U}from"./ag-grid-community-TcQKCcyM.js";import"./param-selector-BKkmvHrP.js";var V=function(d){var l=d.children,t=D().colorMode,c=E("RmgAgGrid");return s.jsx(F,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:c,children:l})};function X(d){const{lineNumber:l,stationNumber:t,lineColour:c}=d,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:c,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return s.jsxs(H,{sx:i,children:[s.jsx("span",{children:l}),s.jsx("span",{children:t})]})}K.registerModules([Q]);U({theme:"legacy"});function ae(d){const{branchIndex:l}=d,{t,i18n:c}=_(),i=P(),x=f(e=>e.app.sidePanelMode),{style:u,theme:R,stn_list:S,line_num:b,coline:j}=f(e=>e.param),w=f(e=>e.helper.branches),[A,v]=o.useState([]);o.useEffect(()=>{const e=w[l].reduce((n,r)=>["linestart","lineend"].includes(r)?n:[...n,{...S[r],id:r,rowSpan:i($(r,l))}],[]);v(e)},[w,l,S]);const T=o.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:e})=>s.jsx(X,{lineNumber:b,stationNumber:e,lineColour:R[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(u)},{headerName:t("Chinese name"),field:"localisedName",valueFormatter:({value:e,data:n})=>{var r;return e.zh+(u===g.GZMTR&&((r=n==null?void 0:n.currentLocalisedSecondaryName)!=null&&r.zh)?" (".concat(n.currentLocalisedSecondaryName.zh,")"):"")}},{headerName:t("English name"),field:"localisedName",cellRenderer:({value:e,data:n})=>{var r;return s.jsx(q,{text:e.en+(u===g.GZMTR&&((r=n.currentLocalisedSecondaryName)!=null&&r.en)?" (".concat(n.currentLocalisedSecondaryName.en,")"):"")})},minWidth:300},{headerName:t("StationAgGrid.interchange"),field:"transfer",cellRenderer:({value:e})=>s.jsx(y,{children:e.groups.map(n=>{var r;return(r=n.lines)!=null?r:[]}).flat().map((n,r)=>{var a,h,C,N;return s.jsx(M,{name:n.name,bg:(h=(a=n.theme)==null?void 0:a[2])!=null?h:"#aaaaaa",fg:(N=(C=n.theme)==null?void 0:C[3])!=null?N:Z.white,showShortName:!0},r)})})},{headerName:t("StationAgGrid.coline"),field:"rowSpan",rowSpan:({data:e})=>{var n;return(n=e==null?void 0:e.rowSpan[0])!=null?n:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({value:e})=>e[0]>0},cellRenderer:({value:e})=>{var n,r;return s.jsx(y,{children:(r=(n=j[e[1]])==null?void 0:n.colors)==null?void 0:r.map((a,h)=>s.jsx(M,{name:[a[4],a[5]],bg:a[2],fg:a[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(u)}],[u,R.toString(),c.language,b]),m=o.useRef(null),p=o.useRef(!1);o.useEffect(()=>{p.current&&m.current&&m.current.api.getSelectedRows().length===1&&x!==G.STATION&&m.current.api.deselectAll()},[p.current,x]);const[L]=o.useState({resizable:!0}),k=o.useCallback(()=>{p.current=!0},[p.current]),I=o.useCallback(({api:e})=>{var r;const n=(r=e.getSelectedRows())==null?void 0:r.map(a=>a.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",n),n!=null&&n.length&&(i(B(G.STATION)),i(O(n[0])),i(W(void 0)))},[]),z=o.useCallback(({data:e})=>e.id,[]);return s.jsx(V,{children:s.jsx(J,{ref:m,rowData:A,defaultColDef:L,columnDefs:T,getRowId:z,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:"single",onSelectionChanged:I,onGridReady:k,debug:!1})})}export{ae as default};
