(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[4780],{74018:function(n,e,t){var r={"./1F1E6-1F1F9.svg":[89121,9121],"./1F1E6-1F1FF.svg":[89427,9427],"./1F1E7-1F1F7.svg":[97304,7304],"./1F1E8-1F1E6.svg":[80056,56],"./1F1E8-1F1F1.svg":[43450,3450],"./1F1E8-1F1F3.svg":[52537,2537],"./1F1E9-1F1EA.svg":[36311,6311],"./1F1E9-1F1F0.svg":[21890,1890],"./1F1EA-1F1EC.svg":[57365,7365],"./1F1EA-1F1F8.svg":[98721,8721],"./1F1EB-1F1F7.svg":[48514,8514],"./1F1EC-1F1F7.svg":[99515,9515],"./1F1ED-1F1F0.svg":[62248,2248],"./1F1ED-1F1FA.svg":[268,268],"./1F1EE-1F1E9.svg":[81370,1370],"./1F1EE-1F1F3.svg":[66236,6236],"./1F1EE-1F1F7.svg":[22617,2617],"./1F1EE-1F1F9.svg":[53541,3541],"./1F1EF-1F1F5.svg":[42741,2741],"./1F1F0-1F1F7.svg":[22255,2255],"./1F1F2-1F1F4.svg":[86435,6435],"./1F1F2-1F1FD.svg":[43086,3086],"./1F1F2-1F1FE.svg":[76082,6082],"./1F1F3-1F1F4.svg":[16095,6095],"./1F1F5-1F1EA.svg":[52955,2955],"./1F1F5-1F1F1.svg":[54700,4700],"./1F1F5-1F1F9.svg":[77791,7791],"./1F1F7-1F1F4.svg":[7224,7224],"./1F1F7-1F1FA.svg":[6031,6031],"./1F1F8-1F1E6.svg":[68600,8600],"./1F1F8-1F1EA.svg":[71550,1550],"./1F1F8-1F1EC.svg":[91229,1229],"./1F1F9-1F1ED.svg":[16203,6203],"./1F1F9-1F1F7.svg":[92237,2237],"./1F1F9-1F1FC.svg":[64252,4252],"./1F1FA-1F1E6.svg":[68521,8521],"./1F1FA-1F1F3.svg":[23353,3353],"./1F1FA-1F1F8.svg":[65439,5439],"./1F1FA-1F1FF.svg":[4504,4504],"./1F1FB-1F1F3.svg":[90419,3886],"./1F3F4-E0067-E0062-E0065-E006E-E0067-E007F.svg":[16129,6129],"./1F3F4-E0067-E0062-E0073-E0063-E0074-E007F.svg":[60138,138]};function i(n){if(!t.o(r,n))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[n],i=e[0];return t.e(e[1]).then((function(){return t.t(i,17)}))}i.keys=function(){return Object.keys(r)},i.id=74018,n.exports=i},37827:function(n,e,t){var r={"./athens.js":[46128,6869],"./baku.js":[92481,6810],"./bangkok.js":[36870,5792],"./barcelona.js":[36340,2358],"./beijing.js":[32145,436],"./berlin.js":[37976,5520],"./bonn.js":[67933,1321],"./boston.js":[68835,5189],"./bucharest.js":[35249,6739],"./budapest.js":[68895,7599],"./cairo.js":[36509,7081],"./changchun.js":[97459,4874],"./changsha.js":[40574,9186],"./chengdu.js":[16312,8719],"./chongqing.js":[40300,7206],"./cologne.js":[6727,134],"./copenhagen.js":[47070,9770],"./daegu.js":[96995,8189],"./dalian.js":[65169,9898],"./delhi.js":[53707,4447],"./dongguan.js":[63280,1847],"./dortmund.js":[86079,6951],"./edinburgh.js":[70285,1392],"./eskisehir.js":[51686,5449],"./foshan.js":[73204,17],"./frankfurt.js":[12040,8237],"./glasgow.js":[34476,886],"./gothenburg.js":[66801,4788],"./guadalajara.js":[39399,3106],"./guangzhou.js":[65841,4073],"./hangzhou.js":[33427,5303],"./hanoi.js":[30507,310],"./harbin.js":[4826,5081],"./hefei.js":[82317,1951],"./hiroshima.js":[80916,8183],"./hochiminh.js":[46770,8140],"./hongkong.js":[54243,3417],"./istanbul.js":[73107,3875],"./jakarta.js":[58457,425],"./jinan.js":[5719,7826],"./kansai.js":[70382,2028],"./kaohsiung.js":[33037,9890],"./kharkiv.js":[63804,5944],"./klangvalley.js":[20137,4737],"./kunming.js":[28852,3579],"./lima.js":[39118,8975],"./lisbon.js":[88814,1614],"./london.js":[38087,5066],"./macao.js":[18015,2168],"./madrid.js":[68020,743],"./manchester.js":[82907,8291],"./milan.js":[94410,8413],"./montreal.js":[53678,6195],"./munich.js":[87368,441],"./nanjing.js":[1664,6546],"./naples.js":[73738,5288],"./newtaipei.js":[99114,3658],"./ningbo.js":[28820,2194],"./osaka.js":[11064,1342],"./oslo.js":[8057,7153],"./other.js":[77642,5885],"./ottawa.js":[40254,6977],"./paris.js":[22720,7719],"./qingdao.js":[57994,9],"./rheinruhr.js":[86870,9450],"./rio.js":[94618,1608],"./riyadh.js":[81e3,2871],"./sanfrancisco.js":[64747,2832],"./sanktpeterburg.js":[21832,1902],"./santiago.js":[12568,530],"./saopaulo.js":[56956,7101],"./seoul.js":[23266,4111],"./shanghai.js":[89656,5418],"./shaoxing.js":[84891,2338],"./shenyang.js":[22266,4760],"./shenzhen.js":[44691,8759],"./singapore.js":[32459,1568],"./stockholm.js":[14606,5562],"./suzhou.js":[99819,5436],"./taichung.js":[65230,4688],"./taipei.js":[89489,5028],"./tashkent.js":[77247,9989],"./tehran.js":[52573,1134],"./tianjin.js":[47942,9327],"./tokyo.js":[23762,8951],"./toronto.js":[18148,5776],"./tyneandwear.js":[9314,8914],"./vienna.js":[55252,1425],"./warsaw.js":[9727,2187],"./wuhan.js":[93742,1624],"./wuxi.js":[4099,672],"./xiamen.js":[54610,3961],"./xian.js":[72591,2648],"./yevpatoria.js":[93342,4433],"./yokohama.js":[695,6349],"./zhengzhou.js":[27357,6719]};function i(n){if(!t.o(r,n))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[n],i=e[0];return t.e(e[1]).then((function(){return t(i)}))}i.keys=function(){return Object.keys(r)},i.id=37827,n.exports=i},91427:function(n,e,t){var r={"./basic/coline.json":[32401,8014],"./basic/default.json":[8453,8241],"./basic/loop.json":[8909,9410],"./bjsubway/bj1.json":[48741,6729],"./bjsubway/bj10.json":[48461,6230],"./bjsubway/bj11.json":[3279,7646],"./bjsubway/bj13.json":[67443,1188],"./bjsubway/bj14.json":[92906,9523],"./bjsubway/bj16.json":[47062,6698],"./bjsubway/bj17.json":[58241,8760],"./bjsubway/bj19.json":[87819,2773],"./bjsubway/bj2.json":[75176,6552],"./bjsubway/bj4.json":[56450,7680],"./bjsubway/bj5.json":[81834,5653],"./bjsubway/bj6.json":[12022,9259],"./bjsubway/bj7.json":[26061,5482],"./bjsubway/bj8.json":[69846,9797],"./bjsubway/bj9.json":[39422,4269],"./bjsubway/dae.json":[34852,3981],"./bjsubway/s1l.json":[42830,2381],"./bjsubway/t1l.json":[41057,7200],"./bjsubway/xjl.json":[14,1095],"./bjsubway/yzl.json":[56315,2244],"./company-config.json":[76605],"./crt/cjt.json":[25020,7149],"./crt/cq0.json":[40393,7160],"./crt/cq1.json":[32038,6452],"./crt/cq10.json":[66292,6354],"./crt/cq2.json":[369,2200],"./crt/cq3.json":[52711,3082],"./crt/cq4.json":[83353,9950],"./crt/cq5.json":[60347,7877],"./crt/cq6.json":[87512,6583],"./crt/cq9.json":[79645,7724],"./crt/cqe.json":[37151,4015],"./fmetro/fs2.json":[61139,9826],"./fmetro/tgm1.json":[81558,3084],"./fmetro/tnh1.json":[17249,3109],"./gzmtr/apm.json":[45098,2846],"./gzmtr/gf.json":[30571,9925],"./gzmtr/gz1.json":[28161,8924],"./gzmtr/gz13.json":[14745,7332],"./gzmtr/gz14.json":[9447,2100],"./gzmtr/gz18.json":[79361,9416],"./gzmtr/gz2.json":[87119,199],"./gzmtr/gz21.json":[24695,4557],"./gzmtr/gz22.json":[92671,8512],"./gzmtr/gz3.json":[20622,2658],"./gzmtr/gz4.json":[25440,9655],"./gzmtr/gz5.json":[93880,4250],"./gzmtr/gz6.json":[27426,6555],"./gzmtr/gz7.json":[73290,9675],"./gzmtr/gz8.json":[69045,2663],"./gzmtr/gz9.json":[78481,113],"./gzmtr/thp1.json":[65227,6080],"./gzmtr/thz1.json":[82887,8766],"./hrbmetro/hrb1.json":[13002,8724],"./hrbmetro/hrb2.json":[6635,6862],"./hrbmetro/hrb3.json":[20555,4694],"./kmrailtransit/km1.json":[43285,5945],"./kmrailtransit/km2.json":[84760,5074],"./kmrailtransit/km3.json":[327,5958],"./kmrailtransit/km4.json":[41302,4754],"./kmrailtransit/km5.json":[21672,6533],"./kmrailtransit/km6.json":[35903,2490],"./kvtransit/klMonorail.json":[57749,169],"./kvtransit/lrtAmpang.json":[81534,5910],"./kvtransit/lrtKelanaJaya.json":[94219,4991],"./kvtransit/lrtSriPataling.json":[38174,403],"./kvtransit/mrtKajang.json":[49512,564],"./lahoremetro/orange.json":[33164,1180],"./mlm/taipa.json":[4435,7792],"./mtr/ael.json":[16215,1899],"./mtr/drl.json":[86083,3497],"./mtr/eal.json":[19800,6899],"./mtr/isl.json":[7314,4092],"./mtr/ktl.json":[1400,1471],"./mtr/sile.json":[37438,4138],"./mtr/tcl.json":[74512,6293],"./mtr/tkl.json":[91257,4402],"./mtr/tml.json":[45339,5680],"./mtr/twl.json":[15030,5325],"./nbrailtransit/nb1.json":[49444,852],"./nbrailtransit/nb2.json":[80011,6288],"./nbrailtransit/nb3.json":[1295,758],"./nbrailtransit/nb4.json":[57155,9619],"./nbrailtransit/nb5.json":[71198,7855],"./njmetro/nj1.json":[72868,2750],"./njmetro/nj10.json":[28421,4387],"./njmetro/nj2.json":[74583,153],"./njmetro/nj3.json":[33347,4996],"./njmetro/nj4.json":[57811,911],"./qdmetro/qd11.json":[80186,6569],"./qdmetro/qd13.json":[99736,6890],"./qdmetro/qd2.json":[35582,3692],"./qdmetro/qd3.json":[23457,856],"./qdmetro/qd8.json":[67703,2791],"./saopaulometro/sp1.json":[2702,5941],"./saopaulometro/sp10.json":[81443,4254],"./saopaulometro/sp11.json":[48362,4605],"./saopaulometro/sp12.json":[57393,74],"./saopaulometro/sp13.json":[12794,2632],"./saopaulometro/sp15.json":[56267,3456],"./saopaulometro/sp2.json":[67182,5294],"./saopaulometro/sp3.json":[91102,7211],"./saopaulometro/sp4.json":[42489,6745],"./saopaulometro/sp5.json":[62103,7769],"./saopaulometro/sp7.json":[99021,3263],"./saopaulometro/sp8.json":[21280,1475],"./saopaulometro/sp9.json":[74337,8781],"./seoulmetro/everline.json":[57385,7321],"./seoulmetro/gimpogoldline.json":[99617,5993],"./seoulmetro/gyeonggang.json":[46370,7910],"./seoulmetro/l3.json":[98463,6632],"./seoulmetro/l7.json":[20651,6153],"./seoulmetro/l8.json":[31279,5925],"./seoulmetro/l9.json":[83454,6568],"./seoulmetro/sillim.json":[60466,9477],"./seoulmetro/suinbundang.json":[40050,8476],"./shmetro/sh1.json":[55562,2023],"./shmetro/sh10.json":[26438,8330],"./shmetro/sh11.json":[96485,7522],"./shmetro/sh12.json":[67048,8615],"./shmetro/sh13.json":[49155,5515],"./shmetro/sh14.json":[42243,5797],"./shmetro/sh15.json":[86484,1325],"./shmetro/sh16.json":[71465,388],"./shmetro/sh17.json":[7079,7985],"./shmetro/sh18.json":[94120,1074],"./shmetro/sh2.json":[4580,8418],"./shmetro/sh3&4.json":[57225,3437],"./shmetro/sh3.json":[17439,1281],"./shmetro/sh4.json":[21088,6010],"./shmetro/sh5.json":[47346,3574],"./shmetro/sh6.json":[48358,5458],"./shmetro/sh7.json":[13095,7924],"./shmetro/sh8.json":[64409,6432],"./shmetro/sh9.json":[57345,1407],"./szmetro/sz1.json":[47109,5391],"./szmetro/sz2.json":[96531,1884],"./szmetro/sz3.json":[51862,2259],"./szmetro/sz4.json":[47789,4324],"./szmetro/sz8.json":[95508,3969],"./template-configs.json":[72722],"./torontosubway/ttc1.json":[12966,1416],"./torontosubway/ttc2.json":[33298,7991],"./torontosubway/ttc3.json":[78973,2856],"./torontosubway/ttc4.json":[76730,8444],"./zzmetro/zz1.json":[44557,45],"./zzmetro/zz14.json":[52049,1255],"./zzmetro/zz2.json":[36226,7425],"./zzmetro/zz3.json":[45090,2525],"./zzmetro/zz4.json":[92332,4636],"./zzmetro/zz5.json":[53790,5648],"./zzmetro/zz6.json":[55444,9538],"./zzmetro/zz9.json":[81393,7883]};function i(n){if(!t.o(r,n))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[n],i=e[0];return Promise.all(e.slice(1).map(t.e)).then((function(){return t.t(i,19)}))}i.keys=function(){return Object.keys(r)},i.id=91427,n.exports=i},6632:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return ue}});var r=t(29439),i=t(72791),o=t(11087),a=t(22020),s=t(74190),l=t(8176),c=t(37732),u=t(85105),d=t(20713);var h=t(36538),f=t(80184),m={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function p(){var n=(0,c.Qy)((function(n){return n.app})),e=n.canvasToShow,o=n.canvasScale,a=(0,c.Qy)((function(n){return n.param})),u=a.svg_height,p=a.style,g=function(n){var e=(0,i.useState)({}),o=(0,r.Z)(e,2),a=o[0],s=o[1];return(0,i.useEffect)((function(){return t(33489)("./".concat(n,"/index")).then((function(n){s(n.default)})).catch((function(e){console.error("Failed to load canvas for style ".concat(n),e),s({})})),function(){s({})}}),[n]),a}(p);(0,i.useEffect)((function(){document.getElementById("css_share").href="/rmg"+"/styles/share_".concat(p,".css"),h.ZP.event(d.zW.STYLE_CHANGE,{style:p})}),[p]);var j=Object.keys(g).filter((function(n){return e.includes(n)})),v=u*o;return(0,f.jsx)(s.kC,{minH:v,sx:m,children:0===Object.keys(g).length?(0,f.jsx)(l.xG,{isIndeterminate:!0}):j.map((function(n){return(0,f.jsx)(l.sS,{sx:{minWidth:750,height:v},children:g[n]},n+p)}))})}var g=t(59434),j=t(50533);function v(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.app.selectedStation}));console.log("InfoSection:: Rendering for",t);var r=(0,c.Qy)((function(n){return n.param.style})),i=(0,c.Qy)((function(n){return n.param.stn_list[t]})),o=i.num,u=i.name,h=i.secondaryName,m=[{type:"input",label:n("StationSidePanel.info.num"),value:o,placeholder:"01",onChange:function(n){return e((0,j.Uf)(t,n))},hidden:![d.RM.GZMTR].includes(r)},{type:"input",label:n("Chinese name"),value:u[0],onChange:function(n){return e((0,j.PD)(t,[n,u[1]]))}},{type:"input",label:n("English name"),value:u[1],onChange:function(n){return e((0,j.PD)(t,[u[0],n]))}},{type:"input",label:n("StationSidePanel.info.zhSecondary"),value:h?h[0]:"",placeholder:"1\u53f7\u822a\u7ad9\u697c",onChange:function(n){return e((0,j.uJ)(t,[n,h?h[1]:""]))},hidden:![d.RM.GZMTR].includes(r)},{type:"input",label:n("StationSidePanel.info.enSecondary"),value:h?h[1]:"",placeholder:"Terminal 1",onChange:function(n){return e((0,j.uJ)(t,[h?h[0]:"",n]))},hidden:![d.RM.GZMTR].includes(r)}];return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:n("StationSidePanel.info.title")}),(0,f.jsx)(l.M5,{fields:m,minW:130})]})}var x=t(75777),b=t(93433),y=t(27322),S=t(4942),Z=t(40410),C=t(2656),_=t(28678),w=t(19894),M=t(41125),z=t(84828);function A(n){var e=n.countryCode,o=n.svgFilename,a=(0,i.useState)(void 0),s=(0,r.Z)(a,2),l=s[0],c=s[1];return(0,i.useEffect)((function(){o&&t(74018)("./"+o).then((function(n){return n.default})).then(c).catch((function(n){return console.error("Failed to find SVG file ".concat(o," as ").concat(null===n||void 0===n?void 0:n.message))}))}),[o]),l?(0,f.jsx)(z.Ee,{src:l,alt:"Flag of ".concat(e),h:17,mr:1}):(0,f.jsx)(f.Fragment,{})}var k=t(47770);function P(n){var e=n.defaultValueId,t=n.onChange,r=(0,a.$)().i18n,i=e?M.nB.find((function(n){return n.id===e})):void 0,o=function(n){return r.languages.map((function(e){return n.name[e]})).find((function(n){return void 0!==n}))},s=M.nB.slice().sort((function(n,e){return n.id===M.jk.Other?1:e.id===M.jk.Other?-1:o(n).localeCompare(o(e),r.languages[0])}));return(0,f.jsx)(l.xL,{data:s,displayValue:o,displayHandler:function(n){var e,t,i="TW"===n.country&&[k.s.ChineseSimp,k.s.ChineseCN].includes(r.languages[0]),o=["Win32","Win64"].includes(navigator.platform),a=r.languages.map((function(e){return n.name[e]})).find((function(n){return void 0!==n})),s=null===(e=M.Jm.find((function(e){return e.id===n.country})))||void 0===e?void 0:e.flagSvg,l=null===(t=M.Jm.find((function(e){return e.id===n.country})))||void 0===t?void 0:t.flagEmoji;return(0,f.jsxs)(f.Fragment,{children:[i?(0,f.jsx)("span",{children:"\ud83c\udff4\xa0"}):o?(0,f.jsx)(A,{countryCode:n.country,svgFilename:s}):(0,f.jsxs)("span",{children:[l,"\xa0"]}),a]})},predicate:function(n,e){return Object.values(n.name).some((function(n){return n.includes(e)}))},defaultValue:i,onChange:function(n){return null===t||void 0===t?void 0:t(n.id)}})}function R(n){var e=n.city,o=n.defaultValueId,s=n.onChange,c=(0,a.$)().i18n,u=function(n){var e=(0,i.useState)([]),o=(0,r.Z)(e,2),a=o[0],s=o[1];return(0,i.useEffect)((function(){t(37827)("./".concat(n,".js")).then((function(n){return s(n.default)})).catch((function(){return s([])}))}),[n]),a}(e),d=o?u.find((function(n){return n.id===o})):void 0,h=function(n){return c.languages.map((function(e){return n.name[e]})).find((function(n){return void 0!==n}))};return(0,f.jsx)(l.xL,{data:u,displayValue:h,displayHandler:function(n){var e=h(n);return(0,f.jsx)(l.l2,{name:e,fg:n.fg||M.AJ.white,bg:n.colour})},predicate:function(n,e){return Object.values(n.name).some((function(n){return n.includes(e)}))},defaultValue:d,onChange:function(n){return null===s||void 0===s?void 0:s(n.id,n.colour,n.fg||M.AJ.white)}})}function F(n){var e,t=n.isOpen,o=n.onClose,c=n.defaultTheme,u=n.onUpdate,m=(0,a.$)().t,p=(0,Z.ff)("primary.500","primary.300"),g=(0,i.useState)(null===c||void 0===c?void 0:c[0]),j=(0,r.Z)(g,2),v=j[0],b=j[1],z=(0,i.useState)(null===c||void 0===c?void 0:c[1]),A=(0,r.Z)(z,2),k=A[0],F=A[1],O=(0,i.useState)((null===c||void 0===c?void 0:c[2])||"#AAAAAA"),E=(0,r.Z)(O,2),N=E[0],T=E[1],I=(0,i.useState)((null===c||void 0===c?void 0:c[3])||M.AJ.white),D=(0,r.Z)(I,2),B=D[0],U=D[1];(0,i.useEffect)((function(){c&&(b(c[0]),F(c[1]),T(c[2]),U(c[3]))}),[t,null===c||void 0===c?void 0:c.toString()]);var W=[{type:"custom",label:m("ColourModal.city"),component:(0,f.jsx)(P,{defaultValueId:v,onChange:function(n){b(n),F(void 0),T("#AAAAAA"),U(M.AJ.white)}})},{type:"custom",label:m("ColourModal.line"),component:(0,f.jsx)(R,{city:v,defaultValueId:k,onChange:function(n,e,t){F(n),T(e),U(t)}})}],L=[{type:"input",label:m("ColourModal.bg"),variant:"color",value:N,placeholder:"#F3D03E",onChange:function(n){b(M.jk.Other),F("other"),T(n)}},{type:"select",label:m("ColourModal.fg"),value:B,options:(e={},(0,S.Z)(e,M.AJ.white,m("ColourModal.white")),(0,S.Z)(e,M.AJ.black,m("ColourModal.black")),e),onChange:function(n){b(M.jk.Other),F("other"),U(n)}}],Q=v&&k&&N&&B;return(0,f.jsxs)(C.u_,{isOpen:t,onClose:o,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[(0,f.jsx)(C.xB,{children:m("ColourModal.title")}),(0,f.jsx)(C.ol,{}),(0,f.jsx)(C.fe,{children:(0,f.jsxs)(s.gC,{children:[(0,f.jsx)(l.l2,{name:m("ColourModal.example"),fg:B,bg:N}),(0,f.jsxs)(_.mQ,{isFitted:!0,colorScheme:"primary",w:"100%",defaultIndex:v===M.jk.Other?1:0,children:[(0,f.jsxs)(_.td,{children:[(0,f.jsx)(_.OK,{children:m("ColourModal.palette")}),(0,f.jsx)(_.OK,{children:m("ColourModal.custom")})]}),(0,f.jsxs)(_.nP,{children:[(0,f.jsx)(_.x4,{children:(0,f.jsx)(l.M5,{fields:W})}),(0,f.jsx)(_.x4,{children:(0,f.jsx)(l.M5,{fields:L})})]})]})]})}),(0,f.jsxs)(C.mz,{children:[(0,f.jsxs)(s.xv,{fontSize:"sm",marginRight:2,children:[m("ColourModal.seeAll"),(0,f.jsxs)(s.rU,{color:p,onClick:function(){h.ZP.isStandaloneWindow()?window.open("/rmg-palette","_blank"):h.ZP.openApp("rmg-palette")},children:[m("Palette")," ",(0,f.jsx)(w.JO,{as:y.jhj})]})]}),(0,f.jsx)(x.zx,{colorScheme:"primary",onClick:function(){Q&&(null===u||void 0===u||u([v,k,N,B]),o(),h.ZP.event(d.zW.SELECT_COLOUR,{cityCode:v,lineCode:k}))},disabled:!Q,children:m("Confirm")})]})]})]})}var O=t(15671),E=t(43144),N=function(){function n(){(0,O.Z)(this,n)}return(0,E.Z)(n,null,[{key:"hexToRgb",value:function(n){return[parseInt(n.slice(1,3),16),parseInt(n.slice(3,5),16),parseInt(n.slice(5,7),16)]}},{key:"fade",value:function(n,e){return"rgba(".concat([].concat((0,b.Z)(this.hexToRgb(n)),[e]).join(","),")")}},{key:"euclideanDistance",value:function(n,e){var t=this;return this.hexToRgb(n).reduce((function(n,r,i){return n+Math.pow(r-t.hexToRgb(e)[i],2)}),0)}}]),n}();function T(n){var e=n.theme,t=n.onClick,r=(0,a.$)().t;return(0,f.jsx)(x.hU,{size:"xs","aria-label":r("Colour"),mt:"0.45px",color:e[3],bg:e[2],_hover:{bg:N.fade(e[2],.7)},icon:(0,f.jsx)(y.uAz,{}),onClick:t})}function I(n){var e,t=n.interchangeList,o=n.onAdd,u=n.onDelete,d=n.onUpdate,h=(0,a.$)().t,m=(0,i.useState)(!1),p=(0,r.Z)(m,2),g=p[0],j=p[1],v=(0,i.useState)(0),S=(0,r.Z)(v,2),Z=S[0],C=S[1],_=(0,c.Qy)((function(n){return n.param})),w=_.theme,z=_.stn_list,A=Object.values(z).reduce((function(n,e){var t=(0,r.Z)(n,2),i=t[0],o=t[1];return[(0,b.Z)(new Set(i.concat(e.transfer.info.flat().map((function(n){return n[4]}))))),(0,b.Z)(new Set(o.concat(e.transfer.info.flat().map((function(n){return n[5]})))))]}),[[],[]]),k=t.map((function(n,e){return[{type:"input",label:h("Chinese name"),value:n[4],minW:"80px",onChange:function(t){return null===d||void 0===d?void 0:d(e,[n[0],n[1],n[2],n[3],t,n[5]])},optionList:A[0]},{type:"input",label:h("English name"),value:n[5],minW:"80px",onChange:function(t){return null===d||void 0===d?void 0:d(e,[n[0],n[1],n[2],n[3],n[4],t])},optionList:A[1]}]}));return(0,f.jsxs)(l.bg,{direction:"column",children:[0===t.length&&(0,f.jsxs)(s.Ug,{spacing:.5,"data-testid":"interchange-card-stack",children:[(0,f.jsx)(s.xv,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:h("StationSidePanel.interchange.noInterchanges")}),(0,f.jsx)(x.hU,{size:"sm",variant:"ghost","aria-label":h("StationSidePanel.interchange.add"),onClick:function(){return null===o||void 0===o?void 0:o([w[0],"","#aaaaaa",M.AJ.white,"",""])},icon:(0,f.jsx)(y.x06,{})})]}),t.map((function(n,e){return(0,f.jsxs)(s.Ug,{spacing:.5,"data-testid":"interchange-card-stack-".concat(e),children:[(0,f.jsx)(l.Nv,{label:h("Colour"),minW:"40px",noLabel:0!==e,children:(0,f.jsx)(T,{theme:[n[0],n[1],n[2],n[3]],onClick:function(){j(!0),C(e)}})}),(0,f.jsx)(l.M5,{fields:k[e],noLabel:0!==e}),o&&e===k.length-1?(0,f.jsx)(x.hU,{size:"sm",variant:"ghost","aria-label":h("StationSidePanel.interchange.copy"),onClick:function(){return null===o||void 0===o?void 0:o(t.slice(-1)[0])},icon:(0,f.jsx)(y.Fqs,{})}):(0,f.jsx)(s.xu,{minW:8}),u&&(0,f.jsx)(x.hU,{size:"sm",variant:"ghost","aria-label":h("StationSidePanel.interchange.remove"),onClick:function(){return null===u||void 0===u?void 0:u(e)},icon:(0,f.jsx)(y.ZkW,{})})]},e)})),(0,f.jsx)(F,{isOpen:g,onClose:function(){return j(!1)},defaultTheme:null===(e=t[Z])||void 0===e?void 0:e.slice(0,4),onUpdate:function(n){return null===d||void 0===d?void 0:d(Z,[].concat((0,b.Z)(n),[t[Z][4],t[Z][5]]))}})]})}function D(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.app.selectedStation})),r=(0,c.Qy)((function(n){return n.param})),o=r.theme,u=r.style,h=(0,c.Qy)((function(n){return n.param.stn_list[t]})).transfer,m=function(r){var i,o;return[{type:"input",label:n("Station Chinese name"),value:null===(i=h.osi_names[r])||void 0===i?void 0:i[0],hidden:![d.RM.MTR].includes(u),onChange:function(n){var i;return e((0,j.fr)(t,r,[n,null===(i=h.osi_names[r])||void 0===i?void 0:i[1]]))}},{type:"input",label:n("Station English name"),value:null===(o=h.osi_names[r])||void 0===o?void 0:o[1],hidden:![d.RM.MTR].includes(u),onChange:function(n){var i;return e((0,j.fr)(t,r,[null===(i=h.osi_names[r])||void 0===i?void 0:i[0],n]))}},{type:"switch",label:n("Paid area"),isChecked:h.paid_area,onChange:function(n){return e((0,j.lL)(t,n))},hidden:![d.RM.MTR].includes(u)||0!==r,oneLine:!0}]},p=function(n){return function(r){e((0,j.Ui)(t,n,r))}},g=function(n){return function(r){e((0,j.SA)(t,n,r))}},v=function(n){return function(r,i){e((0,j.vM)(t,n,r,i))}};return(0,f.jsxs)(s.gC,{align:"flex-start",p:1,children:[(0,f.jsxs)(s.kC,{w:"100%",children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",mr:"auto",children:n("StationSidePanel.interchange.title")}),u===d.RM.MTR&&(0,f.jsx)(l.VC,{selections:[{label:n("Text on the left"),value:d.wA.left},{label:n("Text on the right"),value:d.wA.right}],defaultValue:h.tick_direc,onChange:function(n){return e((0,j.bC)(t,n))}})]}),h.info.map((function(e,t){return(0,f.jsxs)(i.Fragment,{children:[(0,f.jsx)(s.X6,{as:"h6",size:"xs",children:n(0===t?"StationSidePanel.interchange.within":1===t?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),0!==t&&(0,f.jsx)(l.M5,{fields:m(t-1)}),(0,f.jsx)(I,{interchangeList:e,onAdd:p(t),onDelete:g(t),onUpdate:v(t)})]},t)})),h.info.length<3&&(0,f.jsx)(x.zx,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:(0,f.jsx)(y.x06,{}),onClick:function(){e((0,j.Ui)(t,h.info.length,[o[0],"","#AAAAAA",M.AJ.white,"",""]))},children:n("StationSidePanel.interchange.addGroup")})]})}function B(){var n,e,t=(0,a.$)().t,r=(0,c.u5)(),i=(0,c.Qy)((function(n){return n.app.selectedStation})),o=(0,c.Qy)((function(n){return n.param})),u=o.style,h=o.loop,m=(0,c.Qy)((function(n){return n.param.stn_list[i]})),p=m.services,g=m.facility,v=m.loop_pivot,x=m.one_line,b=m.int_padding,y=Object.values(d.K9).map((function(n){return{label:t("StationSidePanel.more."+n),value:n,disabled:n===d.K9.local&&u!==d.RM.SHMetro}})),Z=(n={},(0,S.Z)(n,d.mV.none,t("StationSidePanel.more.none")),(0,S.Z)(n,d.mV.airport,t("StationSidePanel.more.airport")),(0,S.Z)(n,d.mV.hsr,t("StationSidePanel.more.hsr")),(0,S.Z)(n,d.mV.disney,t("StationSidePanel.more.disney")),n),C=(e={},(0,S.Z)(e,d.mV.none,t("StationSidePanel.more.none")),(0,S.Z)(e,d.mV.airport,t("StationSidePanel.more.airport")),(0,S.Z)(e,d.mV.railway,t("StationSidePanel.more.railway")),(0,S.Z)(e,d.mV.disney,t("StationSidePanel.more.disney")),e),_=[{type:"custom",label:t("StationSidePanel.more.service"),component:(0,f.jsx)(l.VC,{selections:y,defaultValue:p,onChange:function(n){return r((0,j.k6)(i,n))},multiSelect:!0}),hidden:![d.RM.GZMTR,d.RM.SHMetro].includes(u)},{type:"select",label:t("StationSidePanel.more.facility"),value:g,options:u===d.RM.MTR?Z:C,onChange:function(n){return r((0,j.cm)(i,n))},hidden:![d.RM.MTR,d.RM.SHMetro].includes(u)},{type:"switch",label:t("StationSidePanel.more.pivot"),isChecked:v,onChange:function(n){return r((0,j.Hz)(i,n))},hidden:![d.RM.SHMetro].includes(u)||!h,minW:"full",oneLine:!0},{type:"switch",label:t("StationSidePanel.more.oneLine"),isChecked:x,onChange:function(n){return r((0,j.br)(i,n))},hidden:![d.RM.SHMetro].includes(u),minW:"full",oneLine:!0},{type:"input",label:t("StationSidePanel.more.intPadding"),value:b.toString(),validator:function(n){return Number.isInteger(n)},onChange:function(n){return r((0,j.j7)(i,Number(n)))},hidden:![d.RM.SHMetro].includes(u)},{type:"custom",label:t("StationSidePanel.more.intPaddingApplyGlobal"),component:(0,f.jsx)(l.VC,{selections:[{label:t("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:function(n){return r((0,j.M4)(i))}}),oneLine:!0,hidden:![d.RM.SHMetro].includes(u)}];return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:t("StationSidePanel.more.title")}),(0,f.jsx)(l.M5,{fields:_})]})}var U=t(1413);function W(){var n,e=(0,a.$)().t,t=(0,c.u5)(),r=(0,c.Qy)((function(n){return n.app.selectedStation})),i=(0,c.Qy)((function(n){return n.param.stn_list})),o=i[r],u=o.parents,h=o.children,m=o.branch,p=(n={},(0,S.Z)(n,d.H_.through,e("StationSidePanel.branch.through")),(0,S.Z)(n,d.H_.nonThrough,e("StationSidePanel.branch.nonThrough")),n),g=function(n){return(n===d.Nm.left?u:h).reduce((function(n,e){return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e,i[e].name.join(" ")))}),{})},v={upper:e("StationSidePanel.branch.upper"),lower:e("StationSidePanel.branch.lower")},x=function(n){return m[n].length?[{type:"select",label:e("StationSidePanel.branch.type"),options:p,value:m[n][0],onChange:function(e){return t((0,j.kM)(r,n,e))}},{type:"select",label:e("StationSidePanel.branch.firstStation"),options:g(n),value:m[n][1],onChange:function(e){return t((0,j.B6)(r,n,e))}},{type:"select",label:e("StationSidePanel.branch.position"),options:v,value:0===(n===d.Nm.left?u:h).indexOf(m[n][1])?"upper":"lower",onChange:function(){return t((0,j.HT)(r,n))}}]:[]};return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:e("Branches")}),(0,f.jsx)(s.X6,{as:"h6",size:"xs",children:e("Branch on the left")}),(0,f.jsx)(l.bg,{direction:"column",children:2===u.length?(0,f.jsx)(l.M5,{fields:x(d.Nm.left)}):(0,f.jsx)(s.xv,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("No branches found")})}),(0,f.jsx)(s.X6,{as:"h6",size:"xs",children:e("Branch on the right")}),(0,f.jsx)(l.bg,{direction:"column",children:2===h.length?(0,f.jsx)(l.M5,{fields:x(d.Nm.right)}):(0,f.jsx)(s.xv,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("No branches found")})})]})}function L(){return(0,f.jsxs)(l.EI,{children:[(0,f.jsx)(v,{}),(0,f.jsx)(s.iz,{}),(0,f.jsx)(D,{}),(0,f.jsx)(s.iz,{}),(0,f.jsx)(W,{}),(0,f.jsx)(s.iz,{}),(0,f.jsx)(B,{})]})}function Q(){var n=(0,a.$)().t,e=(0,g.I0)(),t=(0,c.Qy)((function(n){return n.param})),r=t.style,i=t.svgWidth,o=t.svg_height,u=t.y_pc,h=t.branchSpacingPct,m=t.padding,p=t.direction_gz_x,v=t.direction_gz_y,x=t.loop,y=[].concat((0,b.Z)(d.tK[r].map((function(t){return{type:"input",label:n("StyleSidePanel.layout.".concat(t,"Width")),value:i[t].toString(),onChange:function(n){return e((0,j.gS)(Number(n),t))}}}))),[{type:"input",label:n("StyleSidePanel.layout.canvasHeight"),value:o.toString(),onChange:function(n){return e((0,j.K0)(Number(n)))}},{type:"slider",label:n("StyleSidePanel.layout.verticalPosition"),value:u,min:0,max:100,onChange:function(n){return e((0,j.Tt)(n))},hidden:![d.RM.MTR,d.RM.GZMTR].includes(r)},{type:"slider",label:n(x?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:h,min:0,max:x?50:100,onChange:function(n){return e((0,j.z2)(n))}},{type:"slider",label:n("StyleSidePanel.layout.padding"),value:m,min:0,max:50,onChange:function(n){return e((0,j.xd)(n))}},{type:"slider",label:n("StyleSidePanel.layout.directionGzX"),value:p,min:0,max:100,onChange:function(n){return e((0,j.$m)(n))},hidden:![d.RM.GZMTR].includes(r)},{type:"slider",label:n("StyleSidePanel.layout.directionGzY"),value:v,min:0,max:100,onChange:function(n){return e((0,j.rR)(n))},hidden:![d.RM.GZMTR].includes(r)}]);return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:n("StyleSidePanel.layout.title")}),(0,f.jsx)(l.M5,{fields:y,minW:130})]})}function G(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.param})),o=t.style,u=t.theme,h=t.line_name,m=t.line_num,p=t.direction,g=t.platform_num,v=t.psd_num,b=t.namePosMTR,Z=t.customiseMTRDest,C=t.info_panel_type,_=(0,i.useState)(!1),w=(0,r.Z)(_,2),M=w[0],z=w[1],A=[{label:n("StyleSidePanel.design.left"),value:d.wA.left},{label:n("StyleSidePanel.design.right"),value:d.wA.right}],k=Object.values(d.p).reduce((function(e,t){return(0,U.Z)((0,U.Z)({},e),{},(0,S.Z)({},t,n("StyleSidePanel.design."+t)))}),{}),P=Object.values(d.hi).reduce((function(e,t){return(0,U.Z)((0,U.Z)({},e),{},(0,S.Z)({},t,n("StyleSidePanel.design."+t)))}),{}),R=[{type:"custom",label:n("Colour"),component:(0,f.jsx)(T,{theme:u,onClick:function(){return z(!0)}}),minW:"40px"},{type:"input",label:n("StyleSidePanel.design.zhLineName"),value:h[0],onChange:function(n){return e((0,j.il)([n,h[1]]))},minW:130},{type:"input",label:n("StyleSidePanel.design.enLineName"),value:h[1],onChange:function(n){return e((0,j.il)([h[0],n]))},minW:130},{type:"input",label:n("StyleSidePanel.design.lineNum"),value:m,onChange:function(n){return e((0,j.bh)(n))},hidden:![d.RM.GZMTR].includes(o)},{type:"input",label:n("StyleSidePanel.design.platformNum"),value:g||"",onChange:function(n){return e((0,j.VY)(n))}},{type:"input",label:n("StyleSidePanel.design.psdNum"),value:v,onChange:function(n){return e((0,j.lT)(n))},hidden:![d.RM.GZMTR].includes(o)},{type:"select",label:n("StyleSidePanel.design.panelType"),value:C,options:o===d.RM.GZMTR?k:P,onChange:function(n){return e((0,j.NQ)(n))},hidden:![d.RM.GZMTR,d.RM.SHMetro].includes(o)},{type:"custom",label:n("StyleSidePanel.design.direction"),component:(0,f.jsx)(l.VC,{selections:A,defaultValue:p,onChange:function(n){return e((0,j.mU)(n))}}),minW:"full",oneLine:!0}],O=[{label:n("StyleSidePanel.design.alternatively"),value:!0},{label:n("StyleSidePanel.design.onOneSide"),value:!1}],E=[{type:"custom",label:n("StyleSidePanel.design.nameDisplay"),component:(0,f.jsxs)(s.Ug,{children:[(0,f.jsx)(l.VC,{selections:O,defaultValue:b.isStagger,onChange:function(n){return e((0,j.gn)(n))}}),(0,f.jsx)(x.zx,{size:"xs",variant:"ghost",leftIcon:(0,f.jsx)(y.Llt,{}),onClick:function(){return e((0,j.jv)())},children:n("StyleSidePanel.design.flip")})]}),minW:"full",oneLine:!0,hidden:![d.RM.MTR].includes(o)},{type:"switch",label:n("StyleSidePanel.design.legacyDestination"),isChecked:Z.isLegacy,onChange:function(n){return e((0,j.nR)(n))},hidden:![d.RM.MTR].includes(o),minW:"full",oneLine:!0},{type:"switch",label:n("StyleSidePanel.design.overrideTerminal"),isChecked:!1!==Z.terminal,onChange:function(n){return e((0,j.An)(!!n&&["",""]))},hidden:![d.RM.MTR].includes(o),minW:"full",oneLine:!0},{type:"input",label:n("StyleSidePanel.design.terminalZhName"),value:Z.terminal?Z.terminal[0]:"",placeholder:"\u6a5f\u5834\u53ca\u535a\u89bd\u9928",onChange:function(n){return e((0,j.An)([n,Z.terminal?Z.terminal[1]:""]))},hidden:![d.RM.MTR].includes(o)||!1===Z.terminal},{type:"input",label:n("StyleSidePanel.design.terminalEnName"),value:Z.terminal?Z.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:function(n){return e((0,j.An)([Z.terminal?Z.terminal[0]:"",n]))},hidden:![d.RM.MTR].includes(o)||!1===Z.terminal}];return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:n("StyleSidePanel.design.title")}),(0,f.jsx)(l.M5,{fields:[].concat(R,E),minW:130}),(0,f.jsx)(F,{isOpen:M,onClose:function(){return z(!1)},defaultTheme:u,onUpdate:function(n){return e((0,j.Dc)(n))}})]})}function H(){var n,e=(0,a.$)().t,t=(0,c.u5)(),r=(0,c.Qy)((function(n){return n.helper})).branches,i=(0,c.Qy)((function(n){return n.param})),o=i.loop,u=i.loop_info,d=u.bank,h=u.left_and_right_factor,m=u.bottom_factor,p=r.flat().filter((n={},function(e){return 2===(n[e]=(n[e]||0)+1)})).filter((function(n){return!["linestart","lineend"].includes(n)})),g=Math.abs(r[0].indexOf(p[0])-r[0].indexOf(p[1])),v=r.length>=2?(0,Math.min)(r[0].length-2-g,g):Math.floor((r[0].length-2-2*m)/2),x=[{type:"switch",label:e("StyleSidePanel.loop.isLoop"),isChecked:o,onChange:function(n){return t((0,j.rY)(n))},minW:"full",oneLine:!0},{type:"switch",label:e("StyleSidePanel.loop.isBank"),isChecked:d,onChange:function(n){return t((0,j.qi)(n))},minW:"full",oneLine:!0,hidden:!o},{type:"slider",label:e("StyleSidePanel.loop.leftRightFactor"),value:h,min:0,max:v,onChange:function(n){return t((0,j.lh)(Math.floor(n)))},hidden:!o},{type:"slider",label:e("StyleSidePanel.loop.bottomFactor"),value:m,min:0,max:Math.floor((r[0].length-2-2*h)/2),onChange:function(n){return t((0,j.Hv)(Math.floor(n)))},hidden:!o||o&&r.length>2}];return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:e("StyleSidePanel.loop.title")}),(0,f.jsx)(l.M5,{fields:x})]})}function V(n){var e=n.note,t=n.onUpdate,r=n.onDelete,i=(0,a.$)().t,o=[{type:"textarea",label:i("StyleSidePanel.note.zhNote"),value:e[0],onChange:function(n){return null===t||void 0===t?void 0:t([n,e[1],e[2],e[3],e[4]])}},{type:"textarea",label:i("StyleSidePanel.note.enNote"),value:e[1],onChange:function(n){return null===t||void 0===t?void 0:t([e[0],n,e[2],e[3],e[4]])}},{type:"switch",label:i("StyleSidePanel.note.border"),isChecked:e[4],onChange:function(n){return null===t||void 0===t?void 0:t([e[0],e[1],e[2],e[3],n])},oneLine:!0}],c=[{type:"slider",label:i("StyleSidePanel.note.positionX"),value:e[2],min:0,max:100,onChange:function(n){return null===t||void 0===t?void 0:t([e[0],e[1],n,e[3],e[4]])}},{type:"slider",label:i("StyleSidePanel.note.positionY"),value:e[3],min:0,max:100,onChange:function(n){return null===t||void 0===t?void 0:t([e[0],e[1],e[2],n,e[4]])}}];return(0,f.jsxs)(l.bg,{direction:"column",children:[(0,f.jsx)(l.M5,{fields:o,minW:"full"}),(0,f.jsxs)(s.Ug,{spacing:.5,sx:{"&>div":{flex:1}},children:[(0,f.jsx)(l.M5,{fields:c}),(0,f.jsx)(x.hU,{size:"sm",variant:"ghost","aria-label":i("StyleSidePanel.note.remove"),onClick:function(){return null===r||void 0===r?void 0:r()},icon:(0,f.jsx)(y.ZkW,{})})]})]})}function $(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.param.notesGZMTR}));return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:n("StyleSidePanel.note.title")}),(0,f.jsxs)(s.gC,{spacing:.5,children:[t.map((function(n,t){return(0,f.jsx)(V,{note:n,onUpdate:function(n){return e((0,j.Qk)(t,n))},onDelete:function(){return e((0,j.lj)(t))}},t)})),(0,f.jsx)(x.zx,{size:"xs",variant:"ghost",leftIcon:(0,f.jsx)(y.x06,{}),alignSelf:"flex-end",onClick:function(){return e((0,j.AL)())},children:n("StyleSidePanel.note.add")})]})]})}function q(){var n=(0,c.Qy)((function(n){return n.param})).style;return(0,f.jsxs)(l.EI,{children:[(0,f.jsx)(Q,{}),(0,f.jsx)(s.iz,{}),(0,f.jsx)(G,{}),n===d.RM.GZMTR&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s.iz,{}),(0,f.jsx)($,{})]}),n===d.RM.SHMetro&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s.iz,{}),(0,f.jsx)(H,{})]})]})}var J=t(98096),X=function n(e,t){if(["linestart","lineend"].includes(e)||t[e].parents.length>1||t[e].children.length>1)return 0;var r=t[e].parents[0];return r?1===t[r].children.length?n(r,t):0===t[r].children.indexOf(e)?1:-1:0},Y=t(36705);function K(n){var e=n.isOpen,t=n.onClose,o=(0,a.$)().t,l=(0,c.u5)(),m=(0,c.Qy)((function(n){return n.app.selectedStation})),p=(0,i.useState)(!1),g=(0,r.Z)(p,2),v=g[0],b=g[1];(0,i.useEffect)((function(){e||b(!1)}),[e]);return(0,f.jsxs)(C.u_,{isOpen:e,onClose:t,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[v&&(0,f.jsxs)(J.bZ,{status:"error",variant:"solid",size:"xs",children:[(0,f.jsx)(J.zM,{}),o("Unable to remove this station.")]}),(0,f.jsxs)(s.xu,{position:"relative",children:[(0,f.jsx)(C.xB,{children:o("Remove station")}),(0,f.jsx)(C.ol,{})]}),(0,f.jsx)(C.fe,{children:o("Are you sure to remove station? You cannot undo this action.")}),(0,f.jsxs)(C.mz,{children:[(0,f.jsx)(x.zx,{onClick:t,children:o("Cancel")}),(0,f.jsx)(x.zx,{colorScheme:"primary",onClick:function(){var n,e=l((n=m,function(e,t){var r=t().param,i=r.stn_list,o=r.current_stn_idx;if(n===o)return console.log("removeStation():: failed as current station cannot be deleted"),!1;var a=i[n],s=a.parents,l=a.children;return 4===Object.keys(i).length?(console.log("removeStation():: failed as only 2 stations remaining"),!1):2===s.length&&2===l.length?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):!!Object.keys(i).some((function(e){return![n,"linestart","lineend"].includes(e)&&0===X(e,i)}))||(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)}));e?(t(),l((0,u.B4)(d.Sg.CLOSE)),l((0,u.NQ)("linestart")),l((0,Y.NC)(m)),l(function(n){return function(e,t){var r=t().param.stn_list,i=r[n],o=i.parents,a=i.children,s=JSON.parse(JSON.stringify(r));if(2===o.length||2===a.length)o.forEach((function(n){s[n].children=a})),a.forEach((function(n){s[n].parents=o})),1===o.length&&(s[o[0]].branch.right=s[n].branch.right),1===a.length&&(s[a[0]].branch.left=s[n].branch.left);else if(2===r[o[0]].children.length&&2===r[a[0]].parents.length){var l;s=(0,U.Z)((0,U.Z)({},r),{},(l={},(0,S.Z)(l,o[0],(0,U.Z)((0,U.Z)({},r[o[0]]),{},{children:r[o[0]].children.filter((function(e){return e!==n})),branch:(0,U.Z)((0,U.Z)({},r[o[0]].branch),{},{right:[]})})),(0,S.Z)(l,a[0],(0,U.Z)((0,U.Z)({},r[a[0]]),{},{parents:r[a[0]].parents.filter((function(e){return e!==n})),branch:(0,U.Z)((0,U.Z)({},r[a[0]].branch),{},{left:[]})})),l))}else o.forEach((function(e){var t=s[e].children.indexOf(n);a.length?s[e].children[t]=a[0]:s[e].children.splice(t,1),s[e].branch.right[1]===n&&(s[e].branch.right[1]=a[0])})),a.forEach((function(e){var t=s[e].parents.indexOf(n);o.length?s[e].parents[t]=o[0]:s[e].parents.splice(t,1),s[e].branch.left[1]===n&&(s[e].branch.left[1]=o[0])}));delete s[n],e((0,j.BI)(s))}}(m))):b(!0),h.ZP.event(d.zW.REMOVE_STATION,{success:e})},ml:3,children:o("Confirm")})]})]})]})}function nn(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.app.selectedStation})),o=(0,i.useState)(!1),u=(0,r.Z)(o,2),d=u[0],h=u[1];return(0,f.jsxs)(l.B0,{children:[(0,f.jsxs)(s.Ug,{children:[(0,f.jsx)(x.zx,{size:"sm",variant:"outline",onClick:function(){return e((0,j.lS)(t))},children:n("StationSidePanel.footer.current")}),(0,f.jsx)(x.zx,{size:"sm",variant:"outline",onClick:function(){return h(!0)},children:n("StationSidePanel.footer.remove")})]}),(0,f.jsx)(K,{isOpen:d,onClose:function(){return h(!1)}})]})}function en(n){var e=n.colineInfo,t=n.routeOptions,o=n.onUpdateRoute,c=n.onUpdateColourInfo,u=n.onDelete,d=(0,a.$)().t,h=(0,i.useState)(!1),m=(0,r.Z)(h,2),p=m[0],g=m[1],j=[{type:"select",label:"Route",value:[e.from,e.to].join(","),options:t,onChange:function(n){return null===o||void 0===o?void 0:o(n)}}],v=[{type:"custom",label:d("Colour"),component:(0,f.jsx)(T,{theme:[e.colors[0][0],e.colors[0][1],e.colors[0][2],e.colors[0][3]],onClick:function(){return g(!0)}})},{type:"input",label:d("Chinese name"),value:e.colors[0][4],minW:120,onChange:function(n){return null===c||void 0===c?void 0:c([e.colors[0][0],e.colors[0][1],e.colors[0][2],e.colors[0][3],n,e.colors[0][5]])}},{type:"input",label:d("English name"),value:e.colors[0][5],minW:120,onChange:function(n){return null===c||void 0===c?void 0:c([e.colors[0][0],e.colors[0][1],e.colors[0][2],e.colors[0][3],e.colors[0][4],n])}}];return(0,f.jsxs)(l.bg,{direction:"column",children:[(0,f.jsx)(l.M5,{fields:j,minW:"full"}),(0,f.jsxs)(s.Ug,{spacing:.5,children:[(0,f.jsx)(l.M5,{fields:v}),(0,f.jsx)(x.hU,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:function(){return null===u||void 0===u?void 0:u(0)},icon:(0,f.jsx)(y.ZkW,{})})]}),(0,f.jsx)(F,{isOpen:p,onClose:function(){return g(!1)},defaultTheme:e.colors[0].slice(0,4),onUpdate:function(n){return null===c||void 0===c?void 0:c([].concat((0,b.Z)(n),[e.colors[0][4],e.colors[0][5]]))}})]})}function tn(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.app.selectedBranch})),i=(0,c.Qy)((function(n){return n.param})),o=i.theme,l=i.stn_list,d=e((0,Y._G)(t)),h=e((0,Y.ku)(t)),m=h.reduce((function(n,e){return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e.join(","),e.map((function(n){return l[n].name.join(" - ")})).join(" ~ ")))}),{});return(0,f.jsxs)(s.gC,{align:"flex-start",p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:n("BranchSidePanel.coline.title")}),Object.entries(d).map((function(n){var t,i=(0,r.Z)(n,2),o=i[0],a=i[1];return(0,f.jsx)(en,{colineInfo:a,routeOptions:m,onUpdateRoute:(t=o,function(n){var i=n.split(","),o=(0,r.Z)(i,2),a=o[0],s=o[1];console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(t,", from=").concat(a,", to=").concat(s));try{e((0,Y.l$)(t,a,s))}catch(l){e((0,u.bI)({status:"error",message:"Unable to draw this share track."}))}}),onUpdateColourInfo:function(n){return e((0,Y.Di)(o,0,n))},onDelete:function(n){return function(n,t){e((0,Y.wX)(n,t))}(o,n)}},o)})),(0===t||0===Object.keys(d).length)&&(0,f.jsx)(x.zx,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:(0,f.jsx)(y.x06,{}),onClick:function(){console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(t," with default combination"),h[0]),e((0,Y._g)(h[0][0],h[0][1],[[o[0],"","#AAAAAA",M.AJ.white,"",""]]))},children:n("BranchSidePanel.coline.add")})]})}function rn(n){var e=n.isOpen,t=n.onClose,o=(0,a.$)().t,s=(0,c.u5)(),u=(0,c.Qy)((function(n){return n.app.selectedBranch})),m=(0,c.Qy)((function(n){return n.param})),p=m.style,g=m.stn_list,v=(0,c.Qy)((function(n){return n.helper.branches})),b=(0,i.useState)(u),y=(0,r.Z)(b,2),Z=y[0],_=y[1],w=(0,i.useState)("1"),M=(0,r.Z)(w,2),z=M[0],A=M[1],k=(0,i.useState)("2"),P=(0,r.Z)(k,2),R=P[0],F=P[1],O=(0,i.useState)("asc"),E=(0,r.Z)(O,2),N=E[0],T=E[1];(0,i.useEffect)((function(){_(u)}),[u]);var I=[{type:"select",label:o("AutoNumModal.where"),value:Z,options:(0,U.Z)({},v.reduce((function(n,e,t){return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},t,0===t?o("AutoNumModal.main"):p===d.RM.SHMetro&&(0,Y.Qo)(e,g)?o("AutoNumModal.external")+" "+t:o("AutoNumModal.branch")+" "+t))}),{})),onChange:function(n){return _(n)}},{type:"input",label:o("AutoNumModal.from"),value:z,validator:function(n){return!isNaN(Number(n))},onChange:A,debouncedDelay:0},{type:"input",label:o("AutoNumModal.maxLength"),validator:function(n){return!isNaN(Number(n))},value:R,onChange:F,debouncedDelay:0},{type:"select",label:o("AutoNumModal.sort"),value:N,options:{asc:o("AutoNumModal.asc"),desc:o("AutoNumModal.desc")},onChange:function(n){return T(n)}}],D=!z||!R||isNaN(Number(z))||isNaN(Number(R));return(0,f.jsxs)(C.u_,{isOpen:e,onClose:t,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[(0,f.jsx)(C.xB,{children:o("AutoNumModal.title")}),(0,f.jsx)(C.ol,{}),(0,f.jsx)(C.fe,{children:(0,f.jsx)(l.M5,{fields:I})}),(0,f.jsx)(C.mz,{children:(0,f.jsx)(x.zx,{colorScheme:"primary",isDisabled:D,onClick:function(){s((0,j.av)(Z,Number(z),Number(R),N)),t(),h.ZP.event(d.zW.AUTO_NUMBERING,{})},children:o("Confirm")})})]})]})}var on=function(n){return function(e,t){var r=t().helper.branches[n];return r.includes("linestart")||r.includes("lineend")?1:2}},an=function(n){return function(e,t){var r=t().helper.branches,i=r[0],o=r[n];return i.slice(i.indexOf(o[0])+1,i.indexOf(o.slice(-1)[0]))}},sn=function(n,e){return function(t,r){var i=t(function(n,e){return function(t){return 2===t(on(e))?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):!!t(an(e)).includes(n)||(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1)}}(n,e));if(!i)return!1;var o=r().helper.branches,a=r().param.stn_list,s=o[e];if("linestart"===s[0]){var l,c=(0,U.Z)((0,U.Z)({},a),{},(l={},(0,S.Z)(l,s[1],(0,U.Z)((0,U.Z)({},a[s[1]]),{},{parents:[n]})),(0,S.Z)(l,n,(0,U.Z)((0,U.Z)({},a[n]),{},{children:a.linestart.children.map((function(e){return e===s[1]?e:a[n].children[0]})),branch:{left:[],right:a.linestart.branch.right}})),(0,S.Z)(l,"linestart",(0,U.Z)((0,U.Z)({},a.linestart),{},{children:a.linestart.children.filter((function(n){return n!==s[1]})),branch:{left:[],right:[]}})),l));return t((0,j.BI)(c)),!0}var u,d=s.slice(-2)[0],h=(0,U.Z)((0,U.Z)({},a),{},(u={},(0,S.Z)(u,d,(0,U.Z)((0,U.Z)({},a[d]),{},{children:[n]})),(0,S.Z)(u,n,(0,U.Z)((0,U.Z)({},a[n]),{},{parents:a.lineend.parents.map((function(e){return e===d?e:a[n].parents[0]})),branch:{right:[],left:a.lineend.branch.left}})),(0,S.Z)(u,"lineend",(0,U.Z)((0,U.Z)({},a.lineend),{},{parents:a.lineend.parents.filter((function(n){return n!==d})),branch:{left:[],right:[]}})),u));return t((0,j.BI)(h)),!0}},ln=function(n){return function(e,t){var r=t().helper.branches,i=t().param.stn_list,o=r[0],a=r[n];if(2!==e(on(n)))return console.log("getPossibleDirection():: failed as there is no possible direction"),[];var s=o.indexOf(a[0]),l=o.slice(0,s),c=o.indexOf(a.slice(-1)[0]),u=o.slice(c+1),h=l.every((function(n){return i[n].children.length<=1&&i[n].parents.length<=1})),f=u.every((function(n){return i[n].children.length<=1&&i[n].parents.length<=1}));return h?f?[d.Nm.left,d.Nm.right]:[d.Nm.left]:f?[d.Nm.right]:[]}};function cn(n){var e=n.direction,t=(0,a.$)().t,o=(0,c.u5)(),m=(0,c.Qy)((function(n){return n.helper})).branches,p=(0,c.Qy)((function(n){return n.app.selectedBranch})),g=(0,c.Qy)((function(n){return n.param})),v=g.style,b=g.stn_list,y=(0,i.useState)(!1),Z=(0,r.Z)(y,2),C=Z[0],_=Z[1],w=(0,i.useState)(""),M=(0,r.Z)(w,2),z=M[0],A=M[1],k=m[p].filter((function(n){return!["linestart","lineend"].includes(n)})),P=e===d.Nm.left?k[0]:k.slice(-1)[0],R=b[P],F=o(an(p)),O=o(on(p)),E=o(ln(p)),N=1===O&&!m[0].includes(P),T=E.includes(e),I=F.reduce((function(n,e){var t;return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e,null===(t=b[e])||void 0===t?void 0:t.name.join(" - ")))}),{"":t("Please select...")});return(0,f.jsxs)(l.bg,{direction:"column",children:[(0,f.jsxs)(s.kC,{alignItems:"center",children:[(0,f.jsx)(l.Nv,{label:t("Station name"),flex:1,children:(0,f.jsx)(l.bV,{defaultValue:R.name.join(" "),isDisabled:!0})}),C?(0,f.jsx)(x.zx,{mx:1,size:"sm",variant:"outline",onClick:function(){return _(!1)},children:t("Cancel")}):N?(0,f.jsx)(x.zx,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:function(){return _(!0)},children:t("Connect to main line")}):(0,f.jsx)(x.zx,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:function(){var n=o(function(n,e){return function(t,r){if(!t(ln(e)).includes(n))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;var i=r().helper.branches,o=r().param.stn_list,a=i[0],s=i[e];if(n===d.Nm.left){var l,c=s[0],u=(0,U.Z)((0,U.Z)({},o),{},(l={},(0,S.Z)(l,s[1],(0,U.Z)((0,U.Z)({},o[s[1]]),{},{parents:["linestart"]})),(0,S.Z)(l,c,(0,U.Z)((0,U.Z)({},o[c]),{},{children:o[c].children.filter((function(n){return n!==s[1]})),branch:{right:[],left:[]}})),(0,S.Z)(l,"linestart",(0,U.Z)((0,U.Z)({},o.linestart),{},{children:o[c].children.map((function(n){return n===s[1]?n:a[1]})),branch:{left:[],right:o[c].branch.right}})),l));return t((0,j.BI)(u)),!0}var h,f=s.slice(-1)[0],m=s.slice(-2)[0],p=(0,U.Z)((0,U.Z)({},o),{},(h={},(0,S.Z)(h,m,(0,U.Z)((0,U.Z)({},o[m]),{},{children:["lineend"]})),(0,S.Z)(h,f,(0,U.Z)((0,U.Z)({},o[f]),{},{parents:o[f].parents.filter((function(n){return n!==m})),branch:{right:[],left:[]}})),(0,S.Z)(h,"lineend",(0,U.Z)((0,U.Z)({},o.lineend),{},{parents:o[f].parents.map((function(n){return n===m?n:a.slice(-2)[0]})),branch:{right:[],left:o[f].branch.left}})),h));return t((0,j.BI)(p)),!0}}(e,p));n||o((0,u.bI)({status:"error",message:t("Unable to disconnect from main line.")})),h.ZP.event(d.zW.DISCONNECT_BRANCH,{style:v,success:n})},isDisabled:!T,children:t("Disconnect from main line")})]}),C&&(0,f.jsxs)(s.kC,{alignItems:"center",children:[(0,f.jsx)(l.Nv,{label:t("Target station"),flex:1,children:(0,f.jsx)(l.mg,{defaultValue:z,options:I,disabledOptions:[""],onChange:function(n){var e=n.target.value;return A(e)}})}),(0,f.jsx)(x.zx,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:function(){var n=o(sn(z,p));n?_(!1):o((0,u.bI)({status:"error",message:t("Unable to connect to main line.")})),h.ZP.event(d.zW.CONNECT_BRANCH,{style:v,success:n})},isDisabled:!z,children:t("Confirm")})]})]})}function un(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.param.style})),o=(0,c.Qy)((function(n){return n.app.selectedBranch})),l=(0,i.useState)(!1),u=(0,r.Z)(l,2),m=u[0],p=u[1];return(0,f.jsxs)(s.xu,{p:1,children:[(0,f.jsx)(s.X6,{as:"h5",size:"sm",children:n("BranchSidePanel.action.title")}),(0,f.jsxs)(s.kC,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-child)":{marginTop:2}}},children:[0!==o&&t!==d.RM.SHMetro&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s.X6,{as:"h6",size:"xs",children:n("Branch left end")}),(0,f.jsx)(cn,{direction:d.Nm.left}),(0,f.jsx)(s.X6,{as:"h6",size:"xs",children:n("Branch right end")}),(0,f.jsx)(cn,{direction:d.Nm.right})]}),t===d.RM.GZMTR&&(0,f.jsx)(x.zx,{size:"sm",variant:"outline",leftIcon:(0,f.jsx)(y.OIZ,{}),alignSelf:"flex-end",onClick:function(){return p(!0)},children:n("BranchSidePanel.action.autoNum")}),(0,f.jsx)(x.zx,{size:"sm",variant:"outline",leftIcon:(0,f.jsx)(y.bef,{}),alignSelf:"flex-end",onClick:function(){e((0,j.iI)(t===d.RM.SHMetro)),h.ZP.event(d.zW.REVERSE_STATIONS,{style:t})},children:t===d.RM.SHMetro?n("BranchSidePanel.action.flip"):n("BranchSidePanel.action.reverse")})]}),(0,f.jsx)(rn,{isOpen:m,onClose:function(){return p(!1)}})]})}function dn(){var n=(0,c.Qy)((function(n){return n.app.selectedBranch})),e=(0,c.Qy)((function(n){return n.param})),t=e.style,r=e.stn_list,i=(0,c.Qy)((function(n){return n.helper.branches}));return(0,f.jsxs)(l.EI,{children:[t===d.RM.SHMetro&&(0===n||(0,Y.Qo)(i[n],r))&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(tn,{}),(0,f.jsx)(s.iz,{})]}),(0,f.jsx)(un,{})]})}function hn(){var n,e,t=(0,a.$)().t,r=(0,g.I0)(),i=(0,c.Qy)((function(n){return n.app})),o=i.sidePanelMode,s=i.selectedStation,h=(0,c.Qy)((function(n){var e;return null===(e=n.param.stn_list[s])||void 0===e?void 0:e.name})),m={STATION:{header:(0,f.jsx)(l.iR,{text:(null===h||void 0===h?void 0:h.join(" - "))||""}),body:(0,f.jsx)(L,{}),footer:(0,f.jsx)(nn,{})},STYLE:{header:t("StyleSidePanel.header"),body:(0,f.jsx)(q,{})},BRANCH:{header:t("BranchSidePanel.header"),body:(0,f.jsx)(dn,{})},CLOSE:{header:"Close"}};return(0,f.jsxs)(l.L$,{isOpen:o!==d.Sg.CLOSE,width:375,header:"Dummy header",children:[(0,f.jsx)(l.mQ,{onClose:function(){r((0,u.B4)(d.Sg.CLOSE))},children:m[o].header}),null===(n=m[o])||void 0===n?void 0:n.body,null===(e=m[o])||void 0===e?void 0:e.footer]})}var fn=t(70150),mn=function(n,e,t){var r=new Blob([t],{type:e});pn(n,r)},pn=function(n,e){var t=window.URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)},gn=function(n){return new Promise((function(e){var t=new FileReader;t.onloadend=function(){return e(t.result)},t.readAsText(n)}))},jn=function(){return navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")},vn=function(n){if(n){var e=(new Date).getTime()-n;return e<6e4?["Just now"]:e<12e4?["1","minute ago"]:e<36e5?[Math.floor(e/1e3/60).toString(),"minutes ago"]:e<72e5?["1","hour ago"]:e<864e5?[Math.floor(e/1e3/60/60).toString(),"hours ago"]:e<1728e5?["1","day ago"]:[Math.floor(e/1e3/60/60/24).toString(),"days ago"]}return["Unknown"]},xn=t(15861),bn=t(64687),yn=t.n(bn),Sn=t(95587),Zn=t.n(Sn),Cn=function(){var n=(0,xn.Z)(yn().mark((function n(e,t,i,o,a){var s,l,c,u,h,f,m,p;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=["--rmg-svg-width","--rmg-svg-height"].map((function(n){return document.querySelector("svg#".concat(e)).style.getPropertyValue(n).match(/\d+/g)[0]})).map(Number),u=(0,r.Z)(c,2),h=u[1],(f=document.querySelector("svg#".concat(e)).cloneNode(!0)).setAttribute("height",(h*(a||100)/100).toString()),f.style.setProperty("all","initial"),["share"].map((function(n){var e;return(0,b.Z)((null===(e=(0,b.Z)(document.querySelectorAll("link")).filter((function(e){return e.id==="css_"+n}))[0])||void 0===e?void 0:e.sheet).cssRules).map((function(n){return n.cssText})).join(" ")})).forEach((function(n){var e=document.createElement("style");e.textContent=n,f.prepend(e)})),null===(s=f.querySelector("rect#canvas-border"))||void 0===s||s.setAttribute("stroke",o?"black":"none"),null===(l=f.querySelector("rect#canvas-bg"))||void 0===l||l.setAttribute("fill",i?"none":"white"),t!==d.RM.MTR){n.next=21;break}return n.prev=8,n.next=11,wn(f);case 11:m=n.sent,(p=document.createElement("style")).textContent=m.join("\n"),f.prepend(p),n.next=21;break;case 17:n.prev=17,n.t0=n.catch(8),alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(n.t0);case 21:return n.abrupt("return",f);case 22:case"end":return n.stop()}}),n,null,[[8,17]])})));return function(e,t,r,i,o){return n.apply(this,arguments)}}(),_n=function(n){return new Promise((function(e){var t=new FileReader;t.onloadend=function(){return e(t.result)},t.readAsDataURL(n)}))},wn=function(){var n=(0,xn.Z)(yn().mark((function n(e){var t,r,i,o;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=Array.from(new Set([].concat((0,b.Z)(e.querySelectorAll(".rmg-name__zh")),(0,b.Z)(e.querySelectorAll(".rmg-name__en"))).map((function(n){return n.innerHTML})).join("").replace(/[\s]/g,""))).join(""),n.next=3,document.fonts.load("80px GenYoMin TW, Vegur",t);case 3:return r=n.sent,i=Array.from(document.querySelector("link#css_share").sheet.cssRules[0].styleSheet.cssRules),o=r.reduce((function(n,e){var t,r=(t=e,i.find((function(n){var e=n.style;return e.fontFamily.replace(/^"(.+)"$/,"$1")===t.family&&e.unicodeRange===t.unicodeRange})));return r?n.find((function(n){var e=n.style,t=r.style;return e.fontFamily===t.fontFamily&&e.unicodeRange===t.unicodeRange}))?n:n.concat(r):n}),[]),n.next=8,Promise.all(o.map(function(){var n=(0,xn.Z)(yn().mark((function n(e){var t,r;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch(Mn(e));case 3:return t=n.sent,n.t0=_n,n.next=7,t.blob();case 7:return n.t1=n.sent,n.next=10,(0,n.t0)(n.t1);case 10:return r=n.sent,n.abrupt("return",e.cssText.replace(/src:[ \w('",\-:/.)]+;/g,"src: url('".concat(r,"'); ")));case 14:return n.prev=14,n.t2=n.catch(0),console.error(n.t2),n.abrupt("return","");case 18:case"end":return n.stop()}}),n,null,[[0,14]])})));return function(e){return n.apply(this,arguments)}}()));case 8:return n.abrupt("return",n.sent);case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Mn=function(n){var e,t=n.style.src;return jn()?t.replace(/^url\("([\S]+)"\).*$/,"$1"):"/rmg/styles/"+(null===(e=t.match(/^url\("([\S*]+)"\)/))||void 0===e?void 0:e[1])},zn=function(){var n=(0,xn.Z)(yn().mark((function n(e,t,r){var i,o,a,s;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.viewBox.baseVal.width,o=e.viewBox.baseVal.height,(a=document.querySelectorAll("canvas")[0]).width=Number(i)*window.devicePixelRatio*t,a.height=Number(o)*window.devicePixelRatio*t,e.setAttribute("width",a.width.toString()),e.setAttribute("height",a.height.toString()),(s=a.getContext("2d")).clearRect(0,0,a.width,a.height),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach((function(n){return n.setAttribute("font-size","11px")})),e.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach((function(n){return n.setAttribute("font-size","8.5px")})),e.querySelectorAll("text, tspan").forEach((function(n){var e=window.getComputedStyle(n);n.setAttribute("font-family",e.fontFamily),n.setAttribute("fill",e.fill),n.setAttribute("dominant-baseline",e.dominantBaseline),n.setAttribute("text-anchor",e.textAnchor||"")})),n.abrupt("return",new Promise((function(n,t){var i=new Image;i.onload=function(){setTimeout((function(){s.drawImage(i,0,0,a.width,a.height),a.toBlob((function(e){return n(e)}),"image/png")}),r?2e3:0)},i.onerror=t,i.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.outerHTML)))})));case 13:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}(),An=t(17253);function kn(n){var e=n.isOpen,t=n.onClose,o=(0,a.$)().t,m=(0,c.u5)(),p=(0,i.useState)(""),g=(0,r.Z)(p,2),v=g[0],b=g[1],y=(0,i.useState)(!1),Z=(0,r.Z)(y,2),_=Z[0],w=Z[1],M=(0,i.useState)(!1),z=(0,r.Z)(M,2),A=z[0],k=z[1],P=(0,i.useState)(100),R=(0,r.Z)(P,2),F=R[0],O=R[1],E=(0,i.useState)("png"),N=(0,r.Z)(E,2),T=N[0],I=N[1],D=(0,c.Qy)((function(n){return n.app.canvasToShow})),B=(0,c.Qy)((function(n){return n.param})),W=B.style,L=B.stn_list,Q=B.current_stn_idx,G=B.line_name;(0,i.useEffect)((function(){""===v||D.includes(v)||b("")}),[D]);var H=d.tK[W].reduce((function(n,e){return D.includes(e)?(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e,o("CanvasType."+e))):(0,U.Z)({},n)}),{"":o("DownloadModal.pleaseSelect")}),V=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((function(n,e){return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e,"".concat(e,"%")))}),{}),$={png:o("DownloadModal.png"),svg:o("DownloadModal.svg")},q=[{type:"select",label:o("DownloadModal.canvas"),value:v,options:H,disabledOptions:[""],onChange:function(n){return b(n)},minW:"full"},{type:"switch",label:o("DownloadModal.transparent"),isChecked:_,onChange:w,oneLine:!0,minW:"full"},{type:"switch",label:o("DownloadModal.showBorder"),isChecked:A,onChange:k,oneLine:!0,minW:"full"},{type:"select",label:o("DownloadModal.scale"),value:F,options:V,onChange:function(n){return O(n)}},{type:"select",label:o("DownloadModal.format"),value:T,options:$,onChange:function(n){return I(n)}}],J=function(){var n=(0,xn.Z)(yn().mark((function n(e){var r,i,o,a,s,l,c,f,p,g,x;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:m((0,u.ef)(0)),r="current"===e?[Q]:Object.keys(L).filter((function(n){return!["linestart","lineend"].includes(n)})),i=new(Zn()),n.t0=yn().keys(r);case 4:if((n.t1=n.t0()).done){n.next=28;break}return o=n.t1.value,m((0,u.ef)((Number(o)+1)/r.length*100)),a=r[o],m((0,j.lS)(a)),n.next=11,(0,An.aA)(500);case 11:return n.next=13,Cn(v,W,_,A,F);case 13:if(s=n.sent,document.body.appendChild(s),l="rmg.".concat(a,".").concat(L[a].name[0],".").concat(L[a].name[1]).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_"),"png"!==T){n.next=24;break}return c=jn()&&"0"===o,n.next=20,zn(s,F/100,c);case 20:f=n.sent,r.length>1?i.file("".concat(l,".png"),f):pn("".concat(l,".png"),f),n.next=25;break;case 24:"svg"===T&&(s.removeAttribute("height"),p="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s.outerHTML))),r.length>1?i.file("".concat(l,".svg"),p.split("base64,")[1],{base64:!0}):mn(l+".svg","image/svg+xml",s.outerHTML));case 25:document.body.removeChild(s),n.next=4;break;case 28:if(!(r.length>1)){n.next=34;break}return n.next=31,i.generateAsync({type:"blob"});case 31:g=n.sent,x="rmg.".concat(G[0],".").concat(G[1],".zip").replaceAll(" ","_"),pn(x,g);case 34:h.ZP.event(d.zW.DOWNLOAD_IMAGES,{canvasToDownload:v,style:W,option:e,format:T}),m((0,j.lS)(Q)),m((0,u.Vg)()),t();case 38:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,f.jsxs)(C.u_,{isOpen:e,onClose:t,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[(0,f.jsx)(C.xB,{children:o("DownloadModal.title")}),(0,f.jsx)(C.ol,{}),(0,f.jsx)(C.fe,{children:(0,f.jsx)(l.M5,{fields:q})}),(0,f.jsx)(C.mz,{children:(0,f.jsxs)(s.Ug,{children:[(0,f.jsx)(x.zx,{colorScheme:"primary",variant:"outline",size:"sm",onClick:function(){return J("current")},disabled:!v,children:o("DownloadModal.downloadOne")}),W!==d.RM.GZMTR&&(0,f.jsx)(x.zx,{colorScheme:"primary",variant:"outline",size:"sm",onClick:function(){return J("all")},disabled:!v,children:o("DownloadModal.downloadAll")})]})})]})]})}function Pn(){var n=(0,a.$)().t,e=(0,i.useState)(!1),t=(0,r.Z)(e,2),o=t[0],s=t[1],l=(0,c.Qy)((function(n){return n.param}));return(0,f.jsxs)(fn.v2,{children:[(0,f.jsx)(fn.j2,{as:x.zx,variant:"ghost",size:"sm",rightIcon:(0,f.jsx)(y.Yc6,{}),children:n("DownloadActions.downloads")}),(0,f.jsxs)(fn.qy,{children:[(0,f.jsx)(fn.sN,{onClick:function(){mn("RMG_".concat((new Date).valueOf(),".json"),"application/json",JSON.stringify(l)),h.ZP.event(d.zW.DOWNLOAD_PARAM,{style:l.style})},children:n("DownloadActions.configFile")}),(0,f.jsx)(fn.sN,{onClick:function(){return s(!0)},children:n("DownloadActions.images")})]}),(0,f.jsx)(kn,{isOpen:o,onClose:function(){return s(!1)}})]})}function Rn(n){var e,t,r,i=n.isOpen,o=n.onClose,s=n.cancelRef,c=n.uploadedParam,u=n.onOpenParam,m=(0,a.$)().t;return(0,f.jsx)(C.aR,{isOpen:i,leastDestructiveRef:s,onClose:o,children:(0,f.jsx)(C.dh,{children:(0,f.jsxs)(C._T,{children:[(0,f.jsx)(C.fY,{fontSize:"lg",fontWeight:"bold",children:m("UploadConfirmModal.title")}),(0,f.jsxs)(C.iP,{children:[m("UploadConfirmModal.message1"),(0,f.jsx)(l.l2,{name:(null===c||void 0===c||null===(e=c.line_name)||void 0===e?void 0:e.join(" "))||"",fg:(null===c||void 0===c||null===(t=c.theme)||void 0===t?void 0:t[3])||M.AJ.white,bg:(null===c||void 0===c||null===(r=c.theme)||void 0===r?void 0:r[2])||"#AAAAAA"}),m("UploadConfirmModal.message2")+(c?Object.keys(c.stn_list).length-2:0)+m("UploadConfirmModal.message3")]}),(0,f.jsxs)(C.xo,{children:[(0,f.jsx)(x.zx,{ref:s,onClick:o,children:m("Cancel")}),(0,f.jsx)(x.zx,{colorScheme:"primary",onClick:function(){c&&u(c),o(),h.ZP.event(d.zW.UPLOAD_PARAM,{style:null===c||void 0===c?void 0:c.style})},ml:3,children:m("Confirm")})]})]})})})}var Fn=t(2858),On=t(69076);function En(n){var e=n.isOpen,i=n.onClose,o=n.onOpenParam,m=(0,a.$)().t,p=(0,c.u5)(),g=function(){var n=(0,xn.Z)(yn().mark((function n(e,r,i){var a;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return p((0,u.Av)()),n.next=3,t(91427)("./".concat(e,"/").concat(r,".json"));case 3:a=n.sent,o(a.default,i),h.ZP.event(d.zW.OPEN_TEMPLATE,{company:e,filename:r}),p((0,u.Vg)());case 7:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}();return(0,f.jsxs)(C.u_,{isOpen:e,onClose:i,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[(0,f.jsx)(C.xB,{children:m("TemplateModal.title")}),(0,f.jsx)(C.ol,{}),(0,f.jsx)(C.fe,{children:(0,f.jsxs)(_.mQ,{isLazy:!0,size:"sm",orientation:"vertical",colorScheme:"primary",children:[(0,f.jsx)(_.td,{maxW:150,children:On.p.map((function(n){return(0,f.jsx)(_.OK,{children:(0,Fn.O9)(n.name)},n.id)}))}),(0,f.jsx)(_.nP,{maxW:250,children:Object.entries(On.Q).sort((function(n,e){return On.p.findIndex((function(e){return e.id===n[0]}))-On.p.findIndex((function(n){return n.id===e[0]}))})).map((function(n){var e=(0,r.Z)(n,2),t=e[0],i=e[1];return(0,f.jsx)(_.x4,{as:s.kC,flexDirection:"column",py:0,px:1,children:i.map((function(n){var e,r=(0,Fn.O9)(n.name);return(0,f.jsx)(l.sn,{variant:"ghost",size:"sm",primaryText:r,secondaryText:m("by")+": "+(null!==(e=n.uploadBy)&&void 0!==e?e:"Unknown"),onClick:function(){return g(t,n.filename,r)}},n.filename)}))},t)}))})]})})]})]})}var Nn=t(16475),Tn=t(25984),In=function(n){switch(n){case d.RM.MTR:return[M.jk.Hongkong,"twl","#E2231A",M.AJ.white];case d.RM.GZMTR:return[M.jk.Guangzhou,"gz1","#F3D03E",M.AJ.black];case d.RM.SHMetro:return[M.jk.Shanghai,"sh1","#E4002B",M.AJ.white];default:return[M.jk.Other,"other","#AAAAAA",M.AJ.white]}},Dn=function(n){switch(n){case k.s.ChineseSimp:return["1\u53f7\u7ebf","Line 1"];case k.s.ChineseTrad:return["\u8343\u7063\u7dab","Tsuen Wan Line"];default:return["\u5730\u9435\u7dda","Metro Line"]}},Bn=function(n){return{name:["\u672a\u547d\u540d "+n,"Unnamed "+n],secondaryName:!1,num:"00",services:[d.K9.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{info:[[]],tick_direc:d.wA.right,paid_area:!0,osi_names:[]},facility:d.mV.none,loop_pivot:!1,one_line:!0,int_padding:355}},Un=function(n,e){var t,r=Bn("linestart");r.name=["LEFT END","LEFT END"];var i=Bn("lineend");i.name=["RIGHT END","RIGHT END"];var o=(0,Tn.x0)(6),a=Bn(o);a.num="01";var s=(0,Tn.x0)(6),l=Bn(s);return l.num="02",r.children=[o],a.parents=["linestart"],a.children=[s],l.parents=[o],l.children=["lineend"],i.parents=[s],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:n,y_pc:50,padding:10,branchSpacingPct:33,direction:d.wA.left,platform_num:"1",theme:In(n),line_name:Dn(e),current_stn_idx:s,stn_list:(t={linestart:r},(0,S.Z)(t,o,a),(0,S.Z)(t,s,l),(0,S.Z)(t,"lineend",i),t),namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:n===d.RM.SHMetro?d.hi.sh:d.p.gz1,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}};function Wn(){var n=(0,a.$)(),e=n.t,t=n.i18n,o=(0,c.u5)(),s=(0,c.Qy)((function(n){return n.param.style})),l=(0,i.useState)(!1),h=(0,r.Z)(l,2),m=h[0],p=h[1],g=(0,i.useState)(!1),j=(0,r.Z)(g,2),v=j[0],b=j[1],S=(0,i.useState)(void 0),Z=(0,r.Z)(S,2),C=Z[0],_=Z[1],w=(0,i.useRef)(null),M=(0,i.useRef)(null),z=function(){var n=(0,xn.Z)(yn().mark((function n(t){var r,i,a,s;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=null===(r=t.target.files)||void 0===r?void 0:r[0],console.log("OpenActions.handleUpload():: received file",i),"application/json"===(null===i||void 0===i?void 0:i.type)){n.next=6;break}o((0,u.bI)({status:"error",message:e("OpenActions.invalidType")})),n.next=19;break;case 6:return n.prev=6,n.next=9,gn(i);case 9:a=n.sent,s=(0,An.db)(JSON.parse(a)),_(s),p(!0),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(6),o((0,u.bI)({status:"error",message:e("OpenActions.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",n.t0);case 19:t.target.value="";case 20:case"end":return n.stop()}}),n,null,[[6,15]])})));return function(e){return n.apply(this,arguments)}}(),A=function(n){o(function(n){return function(e,t){var r=(0,An.db)(n);e((0,u.B4)(d.Sg.CLOSE)),e((0,u.NQ)("linestart"));var i=t().app.canvasToShow;d.tK[r.style].every((function(n){return!i.includes(n)}))&&e((0,u.a9)(Object.values(d.Ht))),(0,Nn.P)(r),e((0,u.Vg)())}}(n))};return(0,f.jsxs)(fn.v2,{children:[(0,f.jsx)(fn.j2,{as:x.zx,variant:"ghost",size:"sm",rightIcon:(0,f.jsx)(y.Yc6,{}),children:e("OpenActions.openFrom")}),(0,f.jsxs)(fn.qy,{children:[(0,f.jsx)(fn.sN,{icon:(0,f.jsx)(y.KVB,{}),onClick:function(){return A(Un(s,t.language))},children:e("Empty template")}),(0,f.jsx)("input",{ref:M,type:"file",accept:".json",hidden:!0,onChange:z,"data-testid":"file-upload"}),(0,f.jsx)(fn.sN,{icon:(0,f.jsx)(y.Ap8,{}),onClick:function(){var n;return null===M||void 0===M||null===(n=M.current)||void 0===n?void 0:n.click()},children:e("OpenActions.upload")}),(0,f.jsx)(fn.sN,{icon:(0,f.jsx)(y.uEt,{}),onClick:function(){return b(!0)},children:e("OpenActions.templates")})]}),(0,f.jsx)(Rn,{isOpen:m,onClose:function(){return p(!1)},cancelRef:w,uploadedParam:C,onOpenParam:A}),(0,f.jsx)(En,{isOpen:v,onClose:function(){return b(!1)},onOpenParam:A})]})}function Ln(){var n=(0,a.$)().t,e=(0,g.I0)(),t=(0,o.lr)(),i=(0,r.Z)(t,2)[1];return(0,f.jsxs)(s.Ug,{ml:"auto",w:"fit-content",children:[h.ZP.getEnv()!==h.Sy.PRD&&(0,f.jsx)(x.zx,{variant:"ghost",size:"sm",leftIcon:(0,f.jsx)(y.leM,{}),onClick:function(){e((0,u.rf)(void 0)),i({})},children:n("All projects")}),(0,f.jsx)(Pn,{}),h.ZP.getEnv()===h.Sy.PRD&&(0,f.jsx)(Wn,{}),(0,f.jsx)(x.zx,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:(0,f.jsx)(y.Zox,{}),onClick:function(){return e((0,u.B4)(d.Sg.STYLE))},children:n("HeaderActions.editStyle")})]})}function Qn(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.app})),r=t.canvasToShow,i=t.canvasScale,o=(0,c.Qy)((function(n){return n.param.style})),s=Object.values(d.RM).reduce((function(e,t){return(0,U.Z)((0,U.Z)({},e),{},(0,S.Z)({},t,n("RmgStyle."+t)))}),{}),h=d.tK[o].map((function(e){return{label:n("CanvasType."+e),value:e}})),m=[{type:"select",label:n("Style"),value:o,options:s,onChange:function(n){return function(n){e((0,j.yL)(n))}(n)}},{type:"custom",label:n("View"),component:(0,f.jsx)(l.ap,{displayValue:n("Select canvas"),selections:h,defaultValue:r,onChange:function(n){return e((0,u.a9)(n))}})},{type:"slider",label:n("Canvas scale"),value:i,min:.1,max:2,step:.1,onChange:function(n){return e((0,u.b5)(n))},leftIcon:(0,f.jsx)(y._a6,{}),rightIcon:(0,f.jsx)(y.Ers,{})}];return(0,f.jsxs)(l.ig,{children:[(0,f.jsx)(l.M5,{fields:m,minW:160}),(0,f.jsx)(Ln,{})]})}var Gn=function(n,e,t,r){return function(i,o){for(var a=o().param.stn_list,s=(0,Tn.x0)(6);s in a;)s=(0,Tn.x0)(6);var l,c=Bn(s);if("new"!==n){var u,h=(0,U.Z)((0,U.Z)({},a),{},(u={},(0,S.Z)(u,e,(0,U.Z)((0,U.Z)({},a[e]),{},{children:a[e].children.map((function(n){return n===t?s:n})),branch:{left:a[e].branch.left,right:a[e].branch.right.length&&a[e].branch.right[1]===t?[a[e].branch.right[0],s]:a[e].branch.right}})),(0,S.Z)(u,t,(0,U.Z)((0,U.Z)({},a[t]),{},{parents:a[t].parents.map((function(n){return n===e?s:n})),branch:{left:a[t].branch.left.length&&a[t].branch.left[1]===e?[a[t].branch.left[0],s]:a[t].branch.left,right:a[t].branch.right}})),(0,S.Z)(u,s,(0,U.Z)((0,U.Z)({},c),{},{parents:[e],children:[t]})),u));return i((0,j.BI)(h)),s}if(!r)return!1;var f=(0,U.Z)((0,U.Z)({},a),{},(l={},(0,S.Z)(l,e,(0,U.Z)((0,U.Z)({},a[e]),{},{children:"upper"===r?[s,a[e].children[0]]:[a[e].children[0],s],branch:{left:a[e].branch.left,right:[d.H_.through,s]}})),(0,S.Z)(l,t,(0,U.Z)((0,U.Z)({},a[t]),{},{parents:"upper"===r?[s,a[t].parents[0]]:[a[t].parents[0],s],branch:{left:[d.H_.through,s],right:a[t].branch.right}})),(0,S.Z)(l,s,(0,U.Z)((0,U.Z)({},c),{},{parents:[e],children:[t]})),l));return i((0,j.BI)(f)),s}},Hn=function(n,e){return function(t,r){var i=r().param.stn_list,o=r().helper.branches;return o[0].includes(n)&&o[0].includes(e)?o[0].indexOf(n)>=o[0].indexOf(e)?"Not in correct ordering":"linestart"===n&&"lineend"===e?"Should not be parallel to main line":"linestart"===n&&1===o[0].indexOf(e)?"Branch should not be open jaw from the first station":"lineend"===e&&o[0].indexOf(n)===o[0].length-2?"Branch should not be open jaw from the last station":i[n].children.length>1||i[e].parents.length>1?"Branch already exist":o.slice(1).some((function(t){return t.slice(1,-1).includes(n)||t.slice(1,-1).includes(e)}))?"Cannot branch out from existing branch":o[0].slice(o[0].indexOf(n)+1,o[0].indexOf(e)).every((function(n){return 1===i[n].parents.length&&1===i[n].children.length}))?"":"One or more stations between both ends are branching out":"Branch should end at main line"}};function Vn(n){var e,t,o=n.isOpen,m=n.onClose,p=(0,a.$)().t,g=(0,c.u5)(),j=(0,c.Qy)((function(n){return n.app.selectedBranch})),v=(0,c.Qy)((function(n){return n.param})),b=v.style,y=v.stn_list,Z=(0,c.Qy)((function(n){return n.helper.branches})),_=(0,i.useState)(j),w=(0,r.Z)(_,2),M=w[0],z=w[1],A=(0,i.useState)("before"),k=(0,r.Z)(A,2),P=k[0],R=k[1],F=(0,i.useState)(""),O=(0,r.Z)(F,2),E=O[0],N=O[1],T=(0,i.useState)(!1),I=(0,r.Z)(T,2),D=I[0],B=I[1];(0,i.useEffect)((function(){z(j)}),[j]),(0,i.useEffect)((function(){o||B(!1)}),[o]);var W,L=null!==(e=null===(t=Z[Number(M)])||void 0===t?void 0:t.slice(1,-1))&&void 0!==e?e:[],Q=[{type:"select",label:p("AddStationModal.where"),value:M,options:(0,U.Z)({},Z.reduce((function(n,e,t){return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},t,0===t?p("AddStationModal.main"):b===d.RM.SHMetro&&(0,Y.Qo)(e,y)?p("AddStationModal.external")+" "+t:p("AddStationModal.branch")+" "+t))}),{})),onChange:function(n){return G(n)},minW:"full"},{type:"select",label:p("AddStationModal.preposition"),value:P,options:{before:p("AddStationModal.before"),after:p("AddStationModal.after")},onChange:function(n){return R(n)}},{type:"select",label:p("AddStationModal.pivot"),value:E,options:(W=L,W.reduce((function(n,e){var t;return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e,null===(t=y[e])||void 0===t?void 0:t.name.join(" - ")))}),{"":p("AddStationModal.pleaseSelect")})),disabledOptions:[""],onChange:function(n){return N(n)}}],G=function(n){z(n),N("")};return(0,f.jsxs)(C.u_,{isOpen:o,onClose:m,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[D&&(0,f.jsxs)(J.bZ,{status:"error",variant:"solid",size:"xs",children:[(0,f.jsx)(J.zM,{}),p("AddStationModal.error")]}),(0,f.jsxs)(s.xu,{position:"relative",children:[(0,f.jsx)(C.xB,{children:p("AddStationModal.title")}),(0,f.jsx)(C.ol,{})]}),(0,f.jsx)(C.fe,{children:(0,f.jsx)(l.M5,{fields:Q})}),(0,f.jsx)(C.mz,{children:(0,f.jsx)(x.zx,{colorScheme:"primary",onClick:function(){var n=g(function(n,e,t){return function(r,i){var o=i().helper.branches[n];if(null!==o&&void 0!==o&&o.length){if("before"===e){var a=o[o.indexOf(t)-1];return r(Gn(n.toString(),a,t))}var s=o[o.indexOf(t)+1];return r(Gn(n.toString(),t,s))}return!1}}(M,P,E));n?(m(),g((0,u.NQ)(n)),g((0,u.B4)(d.Sg.STATION))):(console.log("false here"),B(!0)),h.ZP.event(d.zW.ADD_STATION,{style:b,branchIndex:M,success:n})},disabled:!E,children:p("Confirm")})})]})]})}function $n(n){var e=n.isOpen,t=n.onClose,o=(0,a.$)().t,s=(0,c.u5)(),u=(0,i.useState)("new"),m=(0,r.Z)(u,2),p=m[0],g=m[1],j=(0,i.useState)(""),v=(0,r.Z)(j,2),b=v[0],y=v[1],Z=(0,i.useState)(""),_=(0,r.Z)(Z,2),w=_[0],M=_[1],z=(0,i.useState)("upper"),A=(0,r.Z)(z,2),k=A[0],P=A[1],R=(0,i.useState)(""),F=(0,r.Z)(R,2),O=F[0],E=F[1],N=(0,i.useState)(""),T=(0,r.Z)(N,2),I=T[0],D=T[1],B=(0,c.Qy)((function(n){return n.param})),W=B.style,L=B.stn_list;(0,i.useEffect)((function(){e||(g("new"),y(""),M(""))}),[e]);var Q,G=(Q=s((function(n,e){var t=e().param.stn_list;return e().helper.branches[0].filter((function(n){var e=t[n].parents.length+t[n].children.length===4,r=0===X(n,t);return!e&&r}))})),Q.reduce((function(n,e){var t;return(0,U.Z)((0,U.Z)({},n),{},(0,S.Z)({},e,null===(t=L[e])||void 0===t?void 0:t.name.join(" - ")))}),{"":o("NewBranchModal.pleaseSelect")})),H=[{type:"select",label:o("NewBranchModal.where"),value:p,options:{new:o("NewBranchModal.new"),ext:o("NewBranchModal.ext")},disabledOptions:W===d.RM.SHMetro?[]:["ext"],onChange:function(n){return V(n)},minW:"full"},{type:"select",label:o("NewBranchModal.from"),value:b,options:G,disabledOptions:[""],onChange:function(n){return $(n)},isInvalid:Boolean(O)},{type:"select",label:o("NewBranchModal.to"),value:w,options:G,disabledOptions:[""],onChange:function(n){return q(n)},isInvalid:Boolean(I)},{type:"select",label:o("NewBranchModal.position"),value:k,options:{upper:o("NewBranchModal.upper"),lower:o("NewBranchModal.lower")},onChange:function(n){return P(n)},minW:"full",hidden:"new"!==p||W===d.RM.SHMetro}],V=function(n){g(n),y(""),M(""),E(""),D("")},$=function(n){y(n),E(""),n&&w&&D(s(Hn(n,w)))},q=function(n){M(n),D(""),b&&n&&E(s(Hn(b,n)))},J=Boolean(!b||!w||O||I);return(0,f.jsxs)(C.u_,{isOpen:e,onClose:t,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[(0,f.jsx)(C.xB,{children:o("NewBranchModal.title")}),(0,f.jsx)(C.ol,{}),(0,f.jsx)(C.fe,{children:(0,f.jsx)(l.M5,{fields:H})}),(0,f.jsx)(C.mz,{children:(0,f.jsx)(x.zx,{colorScheme:"primary",title:J?O||I:o("Confirm"),onClick:function(){("ext"===p?s(Gn("new",b,w,"lower")):W===d.RM.SHMetro?s(Gn("new",b,w,"upper")):s(Gn("new",b,w,k)))&&(t(),h.ZP.event(d.zW.ADD_BRANCH,{style:W,where:p}))},disabled:J,children:o("Confirm")})})]})]})}var qn=(0,i.lazy)((function(){return Promise.all([t.e(2953),t.e(1985)]).then(t.bind(t,34523))}));function Jn(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,i.useState)(!1),o=(0,r.Z)(t,2),h=o[0],m=o[1],p=(0,i.useState)(!1),g=(0,r.Z)(p,2),j=g[0],v=g[1],b=(0,c.Qy)((function(n){return n.app.selectedBranch})),S=(0,c.Qy)((function(n){return n.param})),Z=S.style,C=S.stn_list,w=(0,c.Qy)((function(n){return n.helper.branches}));return(0,f.jsxs)(s.xu,{flex:1,overflow:"hidden",children:[(0,f.jsxs)(_.mQ,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:b,onChange:function(n){return e((0,u.Pg)(n))},children:[(0,f.jsxs)(_.td,{children:[w.map((function(e,t){return 0===t?(0,f.jsx)(_.OK,{children:n("GridTabs.main")},t):Z===d.RM.SHMetro&&(0,Y.Qo)(e,C)?(0,f.jsx)(_.OK,{children:n("GridTabs.external")+" "+t},t):(0,f.jsx)(_.OK,{children:n("GridTabs.branch")+" "+t},t)})),(0,f.jsx)(x.hU,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:function(){return v(!0)},icon:(0,f.jsx)(y.x06,{})}),(0,f.jsxs)(s.Ug,{marginLeft:"auto",marginRight:1,children:[(0,f.jsx)(x.zx,{variant:"outline",size:"xs",leftIcon:(0,f.jsx)(y.x06,{}),onClick:function(){return m(!0)},children:n("GridTabs.addStation")}),(0,f.jsx)(x.zx,{size:"xs",colorScheme:"primary",onClick:function(){e((0,u.B4)(d.Sg.BRANCH))},children:n("GridTabs.editLine")})]})]}),(0,f.jsx)(_.nP,{flex:1,overflowY:"auto",children:w.map((function(n,e){return(0,f.jsx)(_.x4,{padding:0,h:"100%",position:"relative",children:(0,f.jsx)(l.sS,{suspenseFallback:(0,f.jsx)(l.xG,{isIndeterminate:!0}),children:(0,f.jsx)(qn,{branchIndex:e})})},e)}))})]}),(0,f.jsx)(Vn,{isOpen:h,onClose:function(){return m(!1)}}),(0,f.jsx)($n,{isOpen:j,onClose:function(){return v(!1)}})]})}var Xn=t(73715);function Yn(){var n=(0,c.u5)(),e=(0,c.Qy)((function(n){return n.app.globalAlerts}));return(0,f.jsx)(f.Fragment,{children:Object.entries(e).map((function(e){var t=(0,r.Z)(e,2),i=t[0],o=t[1],a=o.message,l=o.url,c=o.linkedApp;return(0,f.jsxs)(J.bZ,{status:i,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[(0,f.jsx)(J.zM,{}),c?(0,f.jsx)(s.rU,{onClick:function(){return function(n){h.ZP.isStandaloneWindow()?window.open("/".concat(n),"_blank"):h.ZP.openApp(n)}(c)},children:a}):l?(0,f.jsx)(s.rU,{href:l,target:"_blank",children:a}):a,(0,f.jsx)(Xn.P,{ml:"auto",onClick:function(){return n((0,u.sy)(i))}})]},i)}))})}function Kn(){var n=(0,a.$)().t,e=(0,c.u5)(),t=(0,c.Qy)((function(n){return n.app.isLoading}));return(0,i.useEffect)((function(){var t=setTimeout((function(){e((0,u.bI)({status:"info",message:n("rmpPromotion"),linkedApp:"rmp"}))}),1e3);return function(){return clearTimeout(t)}}),[]),(0,f.jsxs)(l.uo,{children:[t&&(0,f.jsx)(l.xG,{isIndeterminate:t<0,value:t>=0?t:void 0}),(0,f.jsx)(Qn,{}),(0,f.jsx)(Yn,{}),(0,f.jsxs)(s.kC,{flex:1,overflow:"hidden",position:"relative",children:[(0,f.jsxs)(s.kC,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[(0,f.jsx)(s.xu,{children:(0,f.jsx)(p,{})}),(0,f.jsx)(Jn,{})]}),(0,f.jsx)(hn,{})]}),(0,f.jsx)("canvas",{style:{display:"none"}})]})}var ne=t(46852),ee=t(81197);function te(n){var e,t=n.config,o=n.onClose,s=n.onUpdate,c=(0,a.$)().t,u=(0,i.useState)(null!==(e=null===t||void 0===t?void 0:t.name)&&void 0!==e?e:""),d=(0,r.Z)(u,2),h=d[0],m=d[1];(0,i.useEffect)((function(){var n;t&&m(null!==(n=t.name)&&void 0!==n?n:"")}),[t]);var p=[{type:"input",label:c("Project name"),value:h,onChange:m,debouncedDelay:0}];return(0,f.jsxs)(C.u_,{isOpen:!!t,onClose:o,isCentered:!0,children:[(0,f.jsx)(C.ZA,{}),(0,f.jsxs)(C.hz,{children:[(0,f.jsx)(C.xB,{children:c("Edit project info")}),(0,f.jsx)(C.ol,{}),(0,f.jsx)(C.fe,{children:(0,f.jsx)(l.M5,{fields:p})}),(0,f.jsx)(C.mz,{children:(0,f.jsx)(x.zx,{colorScheme:"primary",onClick:function(){var n;t&&((null!==(n=t.name)&&void 0!==n?n:"")!==h&&s((0,U.Z)((0,U.Z)({},t),{},{name:h})))},children:c("Confirm")})})]})]})}var re={flex:"2 1 0%",overflow:"hidden",minW:{base:"unset",md:240},w:{base:"100%",md:"unset"},mr:{base:0,md:2},mb:{base:2,md:0},"& > div":{flexDirection:"column",h:200,overflowX:"hidden",overflowY:"auto",borderRadius:"md",borderWidth:2,"& .chakra-button__group":{"& button:not(:first-of-type)":{h:"100%"}}}};function ie(n){var e=n.paramRegistry,t=n.selectedParam,o=n.onParamSelect,c=n.onParamRemove,u=n.onParamUpdate,d=(0,a.$)().t,h=(0,i.useState)(),m=(0,r.Z)(h,2),p=m[0],g=m[1];return(0,f.jsxs)(s.xu,{sx:re,children:[(0,f.jsx)(s.kC,{children:e.slice().sort((function(n,e){var t,r;return(null!==(t=e.lastModified)&&void 0!==t?t:0)-(null!==(r=n.lastModified)&&void 0!==r?r:0)})).map((function(n){var e;return(0,f.jsxs)(x.hE,{size:"sm",isAttached:!0,colorScheme:t===n.id?"primary":void 0,variant:t===n.id?"solid":"ghost",children:[(0,f.jsx)(l.sn,{primaryText:null!==(e=n.name)&&void 0!==e?e:d("Project")+" "+n.id,secondaryText:d("Last modified")+": "+vn(n.lastModified).map(d).join(" "),onClick:function(){return o(n.id)}}),(0,f.jsx)(x.hU,{"aria-label":d("Edit project info"),title:d("Edit project info"),icon:(0,f.jsx)(y.zmo,{}),onClick:function(){return g(n)}}),(0,f.jsx)(x.hU,{"aria-label":d("Remove project"),title:d("Remove project"),icon:(0,f.jsx)(y.ZkW,{}),onClick:function(){return c(n.id)}})]},n.id)}))}),e.length>=10&&(0,f.jsx)(s.xv,{as:"em",fontSize:"xs",children:d("You have reached the maximum number of projects.")}),(0,f.jsx)(te,{config:p,onClose:function(){return g(void 0)},onUpdate:function(n){u(n),g(void 0)}})]})}var oe=t(7636),ae={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function se(n){var e=n.selectedParam,t=n.disableNew,l=n.onError,c=(0,a.$)().t,u=(0,o.lr)(),m=(0,r.Z)(u,2)[1],p=(0,i.useState)(!1),g=(0,r.Z)(p,2),j=g[0],v=g[1],b=(0,i.useRef)(null),S=(0,i.useRef)(null);(0,i.useEffect)((function(){var n;e&&(null===(n=S.current)||void 0===n||n.focus())}),[e]);var Z=function(){var n=(0,xn.Z)(yn().mark((function n(e){var t,r,i,o;return yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=null===(t=e.target.files)||void 0===t?void 0:t[0],console.log("handleImportProject():: received file",r),n.prev=2,"application/json"===(null===r||void 0===r?void 0:r.type)){n.next=7;break}l(c("OpenActions.invalidType")),n.next=13;break;case 7:return n.next=9,gn(r);case 9:i=n.sent,o=(0,oe.TR)(i),m({project:o}),h.ZP.event(d.zW.UPLOAD_PARAM,{});case 13:n.next=19;break;case 15:n.prev=15,n.t0=n.catch(2),l(c("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",n.t0);case 19:e.target.value="";case 20:case"end":return n.stop()}}),n,null,[[2,15]])})));return function(e){return n.apply(this,arguments)}}();return(0,f.jsxs)(s.kC,{sx:ae,children:[(0,f.jsx)(x.zx,{leftIcon:(0,f.jsx)(y.x06,{}),onClick:function(){m({project:(0,Tn.x0)()}),h.ZP.event(d.zW.NEW_PARAM,{})},isDisabled:t,children:c("Blank project")}),(0,f.jsx)(x.zx,{leftIcon:(0,f.jsx)(y.uEt,{}),onClick:function(){return v(!0)},isDisabled:t,children:c("Open template")}),(0,f.jsx)(x.zx,{leftIcon:(0,f.jsx)(y.Ap8,{}),onClick:function(){var n;return null===(n=b.current)||void 0===n?void 0:n.click()},isDisabled:t,children:c("Import project")}),(0,f.jsx)(x.zx,{ref:S,colorScheme:"primary",leftIcon:(0,f.jsx)(y.WKS,{}),onClick:function(){e&&(m({project:e}),h.ZP.event(d.zW.OPEN_PARAM,{}))},isDisabled:void 0===e,children:c("Open selected")}),(0,f.jsx)("input",{ref:b,type:"file",accept:".json",hidden:!0,onChange:Z,"data-testid":"file-upload"}),(0,f.jsx)(En,{isOpen:j,onClose:function(){return v(!1)},onOpenParam:function(n,e){var t=(0,oe.TR)(JSON.stringify(n),e);m({project:t})}})]})}var le={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function ce(){var n=(0,a.$)().t,e=(0,o.lr)(),t=(0,r.Z)(e,1)[0].get("project"),c=(0,i.useState)([]),u=(0,r.Z)(c,2),m=u[0],p=u[1],g=(0,i.useState)(),j=(0,r.Z)(g,2),v=j[0],x=j[1],b=(0,i.useRef)(null),y=(0,ne.pm)();(0,i.useEffect)((function(){p((0,oe.tb)())}),[]),(0,ee.O3)({ref:b,handler:function(){return x(void 0)}});return(0,f.jsxs)(l.uo,{justifyContent:"center",children:[t&&(0,f.jsx)(l.xG,{isIndeterminate:!0}),(0,f.jsx)(s.W2,{children:(0,f.jsxs)(l.bg,{sx:le,children:[(0,f.jsx)(s.X6,{as:"h3",size:"lg",children:n("Saved projects")}),(0,f.jsxs)(s.kC,{ref:b,children:[(0,f.jsx)(ie,{paramRegistry:m,selectedParam:v,onParamSelect:x,onParamRemove:function(n){window.localStorage.removeItem(d.Fe.PARAM_BY_ID+n),window.localStorage.removeItem(d.Fe.PARAM_CONFIG_BY_ID+n),x(void 0),p((0,oe.tb)()),h.ZP.event(d.zW.REMOVE_PARAM,{})},onParamUpdate:function(n){var e=n.id,t=n.name,r=n.lastModified;e&&(window.localStorage.setItem(d.Fe.PARAM_CONFIG_BY_ID+e,JSON.stringify({name:t,lastModified:r})),x(void 0),p((0,oe.tb)()),h.ZP.event(d.zW.UPDATE_PARAM_CONFIG,{}))}}),(0,f.jsx)(se,{selectedParam:v,disableNew:m.length>=10,onError:function(n){y({description:n,status:"error",duration:1e4,isClosable:!0})}})]})]})})]})}function ue(){var n=(0,c.u5)(),e=(0,c.Qy)((function(n){return n.app})).paramConfig,t=(0,o.lr)(),a=(0,r.Z)(t,2),s=a[0],l=a[1],m=s.get("project"),p=(0,i.useState)(!1),g=(0,r.Z)(p,2),v=g[0],x=g[1];return(0,i.useEffect)((function(){if(console.log("searchParam: project="+m),m)if(m===(null===e||void 0===e?void 0:e.id))console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),x(!0);else{if(h.ZP.getEnv()===h.Sy.PRD){var t=(0,oe.mo)(),r=Object.keys(t);if(r.length&&!r.includes(m)){console.warn("AppRouter:: URL param ID does not exist in localStorage. Reset to first param in localStorage in PRD env.");var i=(0,oe.mo)();return void l({project:Object.keys(i)[0]})}}console.log("AppRouter:: Reading param (ID=".concat(m,") from localStorage")),n(function(n,e){return function(t){try{var r=window.localStorage.getItem(d.Fe.PARAM_CONFIG_BY_ID+n);if(null===r)throw new Error("Config for paramID=".concat(n," does not exist in localStorage"));var i=(0,U.Z)((0,U.Z)({},JSON.parse(r)),{},{id:n});t((0,u.rf)(i))}catch(l){console.warn("Failed to parse param config.",l),console.log("Initiating new config for paramID="+n),t((0,u.rf)({id:n}))}try{var o=window.localStorage.getItem(d.Fe.PARAM_BY_ID+n);if(null===o)throw new Error("Param ID=".concat(n," does not exist in localStorage"));var a=(0,An.db)(JSON.parse(o));t((0,j.m)(a))}catch(l){console.warn("Failed to parse param.",l),console.log("Initiating new param for ID="+n);var s=Un(d.RM.MTR,e);t((0,j.m)(s))}}}(m,h.ZP.getLanguage())),x(!0)}else if(h.ZP.getEnv()===h.Sy.PRD){var o;console.log("AppRouter:: Redirect to first param in localStorage in PRD env");var a=(0,oe.mo)();l({project:null!==(o=Object.keys(a)[0])&&void 0!==o?o:(0,Tn.x0)()})}else console.log("AppRouter:: No URL param ID provided. Rendering param selector view..."),x(!1)}),[m]),v?(0,f.jsx)(Kn,{}):(0,f.jsx)(ce,{})}},36705:function(n,e,t){"use strict";t.d(e,{Qo:function(){return d},ku:function(){return f},z7:function(){return m},_G:function(){return g},NC:function(){return j},_g:function(){return v},l$:function(){return x},wX:function(){return b},Di:function(){return y}});var r=t(45987),i=t(49142),o=t(4942),a=t(1413),s=t(29439),l=t(93433),c=t(50533),u=t(25984);var d=function(n,e){return!!e[n[0]].children.indexOf(n[1])},h=function(n,e){return[n[0][1],n[0][n[0].length-2]].concat((0,l.Z)(n[0].filter((function(t){return n.slice(1).filter((function(n){return d(n,e)})).map((function(n){return n.filter((function(n){return!["linestart","lineend"].includes(n)}))})).map((function(n){return[n[0],n[n.length-1]]})).flat().includes(t)}))))},f=function(n){return function(e,t){var r=t().helper.branches;if(0===n){var i=t().param.stn_list,o=h(r,i);return function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.reduce((function(n,e){return n.map((function(n){return e.map((function(e){return n.concat([e])}))})).reduce((function(n,e){return n.concat(e)}),[])}),[[]])}(o,o).filter((function(n){return n[0]!==n[1]}))}var a=r[n];if(a){var s=a.filter((function(n){return!["linestart","lineend"].includes(n)}));return[[s[0],s.slice(-1)[0]]]}return[]}},m=function(n,e){return function(t,r){for(var i=r().param.coline,o=r().helper.branches[e],a=0,l=Object.entries(i);a<l.length;a++){var c=(0,s.Z)(l[a],2),u=c[0],d=c[1];if(d.from===n&&o.includes(d.to)){var h=o.indexOf(n),f=o.indexOf(d.to);if(f>h)return[f-h+1,u]}else if(d.to===n&&o.includes(d.to)){var m=o.indexOf(n),p=o.indexOf(d.from);if(p>m)return[p-m+1,u]}}return[0,void 0]}},p=function(n,e){return function(t,r){var i=r().param.stn_list,o=r().helper.branches;if(n===e)throw new Error("addColine():: failed for same stnId");var a=h(o,i).filter((function(t){return[n,e].includes(t)})),s=function(n,e){return n.slice(1).filter((function(n){return d(n,e)})).map((function(n){return n.filter((function(n){return!["linestart","lineend"].includes(n)}))})).map((function(n){return[n[0],n[n.length-1]]}))}(o,i).filter((function(t){return[n,e].every((function(n){return t.includes(n)}))}));if(2===a.length&&s.length>0)throw new Error("addColine():: main check failed for ".concat(n,", ").concat(e));if(2!==a.length&&1!==s.length)throw new Error("addColine():: branch check failed for ".concat(n,", ").concat(e))}},g=function(n){return function(e,t){var r=t().param.coline,i=t().helper.branches[n];return i?Object.entries(r).reduce((function(n,e){return i.includes(e[1].from)&&i.includes(e[1].to)?(0,a.Z)((0,a.Z)({},n),{},(0,o.Z)({},e[0],e[1])):(0,a.Z)({},n)}),{}):{}}},j=function(n){return function(e,t){var r=t().param.coline;if(0!==Object.keys(r).length){var i=Object.entries(r).reduce((function(e,t){return t[1].from!==n&&t[1].to!==n?(0,a.Z)((0,a.Z)({},e),{},(0,o.Z)({},t[0],t[1])):(0,a.Z)({},e)}),{});e((0,c.tA)(i))}}},v=function(n,e,t){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return function(i,s){var l=s().param.coline;i(p(n,e)),i((0,c.tA)((0,a.Z)((0,a.Z)({},l),{},(0,o.Z)({},(0,u.x0)(4),{from:n,to:e,colors:t,display:r}))))}},x=function(n,e,t){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return function(i,s){var l=s().param.coline;if(n in l){i(p(e,t));var u=(0,a.Z)((0,a.Z)({},l),{},(0,o.Z)({},n,(0,a.Z)((0,a.Z)({},l[n]),{},{from:e,to:t,display:r})));i((0,c.tA)(u))}}},b=function(n,e){return function(t,s){var l=s().param.coline;if(n in l&&l[n].colors.length>e){var u=l[n].colors.filter((function(n,t){return t!==e}));if(0===u.length){l[n];var d=(0,r.Z)(l,[n].map(i.Z));t((0,c.tA)(d))}else{var h=(0,a.Z)((0,a.Z)({},l),{},(0,o.Z)({},n,(0,a.Z)((0,a.Z)({},l[n]),{},{colors:u})));t((0,c.tA)(h))}}}},y=function(n,e,t){return function(r,i){var o=i().param.coline;n in o&&o[n].colors.length>e&&(o[n].colors=o[n].colors.map((function(n,r){return r===e?[0,1,2,3,4,5].map((function(e){return void 0===t[e]?n[e]:t[e]})):n})),r((0,c.tA)(o)))}}},17253:function(n,e,t){"use strict";t.d(e,{db:function(){return l},aA:function(){return c}});var r=t(4942),i=t(1413),o=t(29439),a=t(20713),s=t(25984),l=function(n){var e,t,l;"line_name"in n||(n.line_name=["\u8def\u7dda\u540d","Name of Line"]),"dest_legacy"in n||(n.dest_legacy=!1),delete n.fontZH,delete n.fontEN,delete n.weightZH,delete n.weightEN;for(var c=0,u=Object.entries(n.stn_list);c<u.length;c++){var d=(0,o.Z)(u[c],2),h=d[0],f=d[1];"branch"in f||(n.stn_list[h].branch={left:[],right:[]},2===f.children.length?n.stn_list[h].branch.right=["through",f.children[1]]:n.stn_list[h].branch.right=[],2===f.parents.length?n.stn_list[h].branch.left=["through",f.parents[1]]:n.stn_list[h].branch.left=[])}n.psd_num="psd_num"in n?n.psd_num.toString():"1","line_num"in n||(n.line_num="1"),3===n.theme.length&&n.theme.push("#fff");for(var m=0,p=Object.entries(n.stn_list);m<p.length;m++){var g=(0,o.Z)(p[m],2),j=g[0],v=g[1];"num"in v||(n.stn_list[j].num="00"),"interchange"in v&&v.interchange.map((function(n){return n.forEach((function(n){5===n.length&&n.splice(3,0,"#fff")}))}))}for(var x=0,b=Object.entries(n.stn_list);x<b.length;x++){var y=(0,o.Z)(b[x],2),S=y[0],Z=y[1];"osi22_end_p"===Z.change_type&&(n.stn_list[S].change_type="osi22_pr"),"osi22_end_u"===Z.change_type&&(n.stn_list[S].change_type="osi22_ur")}for(var C=0,_=Object.entries(n.stn_list);C<_.length;C++){var w=(0,o.Z)(_[C],2),M=w[0];"interchange"in w[1]||(n.stn_list[M].interchange=[[]])}n.info_panel_type="info_panel_type"in n?function(n){switch(n){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return n}}(n.info_panel_type):"gz28","direction_gz_x"in n||(n.direction_gz_x=50),"direction_gz_y"in n||(n.direction_gz_y=70);for(var z=0,A=Object.entries(n.stn_list);z<A.length;z++){var k,P,R,F,O=(0,o.Z)(A[z],2),E=O[0],N=O[1];if(!("transfer"in N))n.stn_list[E].transfer={tick_direc:"none"===N.change_type||"int2"===N.change_type?"r":null===(k=N.change_type)||void 0===k?void 0:k.split("_")[1].split("").slice().reverse()[0],paid_area:-1===(null===(P=N.change_type)||void 0===P?void 0:P.indexOf("osi"))||"p"===(null===(R=N.change_type)||void 0===R?void 0:R.split("_")[1][0]),osi_names:-1!==(null===(F=N.change_type)||void 0===F?void 0:F.indexOf("osi"))?[N.interchange[1][0]]:[],info:2===N.interchange.length?[N.interchange[0],N.interchange[1].slice(1)]:N.interchange};delete n.stn_list[E].change_type,delete n.stn_list[E].interchange}for(var T=0,I=Object.entries(n.stn_list);T<I.length;T++){var D=(0,o.Z)(I[T],2),B=D[0],U=D[1];"services"in U||(n.stn_list[B].services=["local"]),"facility"in U||(n.stn_list[B].facility="usage"in U?U.usage:""),delete n.stn_list[B].usage}"customiseMTRDest"in n||(n.customiseMTRDest={isLegacy:n.dest_legacy||!1,terminal:!1}),delete n.dest_legacy,"svgWidth"in n||(n.svgWidth={destination:n.svg_dest_width,runin:n.svg_dest_width,railmap:n.svg_width,indoor:n.svg_width}),"indoor"in n.svgWidth||(n.svgWidth.indoor=n.svgWidth.railmap),delete n.svg_width,delete n.svg_dest_width,"notesGZMTR"in n||(n.notesGZMTR=[]),n.notesGZMTR=null===(e=n.notesGZMTR)||void 0===e?void 0:e.map((function(n){return 4===n.length?n.concat([!1]):n})),delete n.char_form,delete n.show_outer,delete n.strip_pc,delete n.txt_bg_gap,"namePosMTR"in n||(n.namePosMTR={isStagger:!0,isFlip:n.txt_flip}),delete n.txt_flip,Object.keys(n.stn_list).forEach((function(e){"secondaryName"in n.stn_list[e]?!1!==n.stn_list[e].secondaryName&&","===n.stn_list[e].secondaryName.join()&&(n.stn_list[e].secondaryName=!1):n.stn_list[e].secondaryName=!1,"type"in n.stn_list[e].transfer&&delete n.stn_list[e].transfer.type})),n.style=void 0!==n.style&&Object.values(a.RM).includes(n.style)?n.style:a.RM.MTR,n.coline=null!==(t=n.coline)&&void 0!==t?t:[],n.loop=null!==(l=n.loop)&&void 0!==l&&l,n.loop_info=void 0===n.loop_info?{bank:!0,left_and_right_factor:0,bottom_factor:1}:(0,i.Z)((0,i.Z)({},n.loop_info),{},{bottom_factor:Math.max(n.loop_info.bottom_factor,1)});for(var W=0,L=Object.entries(n.stn_list);W<L.length;W++){var Q=(0,o.Z)(L[W],2),G=Q[0];"loop_pivot"in Q[1]||(n.stn_list[G].loop_pivot=!1)}return Array.isArray(n.coline)&&(n.coline=n.coline.reduce((function(n,e){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},(0,s.x0)(4),e))}),{})),!1===n.platform_num&&(n.platform_num=""),Object.values(n.stn_list).forEach((function(e){var t,r,i=e;i.one_line=null!==(t=i.one_line)&&void 0!==t&&t,i.int_padding=null!==(r=i.int_padding)&&void 0!==r?r:n.loop?250:355})),void 0===n.branchSpacingPct&&(n.style===a.RM.SHMetro?n.branchSpacingPct=Math.round(n.branch_spacing/n.svg_height*300):n.branchSpacingPct=Math.round(n.branch_spacing/n.svg_height*200),delete n.branch_spacing),n},c=function(n){return new Promise((function(e){setTimeout(e,n)}))}},33489:function(n,e,t){var r={"./gzmtr/index":[226,226],"./mtr/index":[31711,9014,1711],"./shmetro/index":[58049,9014,8049]};function i(n){if(!t.o(r,n))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=r[n],i=e[0];return Promise.all(e.slice(1).map(t.e)).then((function(){return t(i)}))}i.keys=function(){return Object.keys(r)},i.id=33489,n.exports=i}}]);
//# sourceMappingURL=AppRouter.29a5a8ac.chunk.js.map