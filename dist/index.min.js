!function(t){function e(e){for(var n,s,a=e[0],r=e[1],o=0,l=[];o<a.length;o++)s=a[o],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&l.push(i[s][0]),i[s]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);for(c&&c(e);l.length;)l.shift()()}var n={},i={2:0};function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var a=new Promise((function(e,s){n=i[t]=[e,s]}));e.push(n[2]=a);var r,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(t){return s.p+""+({0:"LineGZ",1:"LineSH"}[t]||t)+".min.js"}(t);var c=new Error;r=function(e){o.onerror=o.onload=null,clearTimeout(l);var n=i[t];if(0!==n){if(n){var s=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",c.name="ChunkLoadError",c.type=s,c.request=a,n[1](c)}i[t]=void 0}};var l=setTimeout((function(){r({type:"timeout",target:o})}),12e4);o.onerror=o.onload=r,document.head.appendChild(o)}return Promise.all(e)},s.m=t,s.c=n,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="./dist/",s.oe=function(t){throw console.error(t),t};var a=window.webpackJsonp=window.webpackJsonp||[],r=a.push.bind(a);a.push=e,a=a.slice();for(var o=0;o<a.length;o++)e(a[o]);var c=r;s(s.s=13)}([function(t,e,n){"use strict";var i,s,a;function r(t){localStorage.setItem("rmgParam",JSON.stringify(t))}function o(){return JSON.parse(localStorage.rmgParam)}function c(t,e){let n=o();n[t]=e,r(n)}function l(t){var[e,n]=t.attr("viewBox").split(" ").slice(2),i=$("canvas")[0];$("canvas").attr({width:2.5*e,height:2.5*n});var s=i.getContext("2d");s.clearRect(0,0,i.width,i.height),t.find(".rmg-name__en.rmg-name__gzmtr--station, .rmg-name__en.rmg-name__mtr--station, .rmg-name__zh.IntName").each((t,e)=>{$(e).attr("font-size","10px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int").each((t,e)=>{$(e).attr("font-size","8px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int-small, .rmg-name__en.IntName").each((t,e)=>{$(e).attr("font-size","7px")}),t.find("text:not([font-size]), tspan:not([font-size])").each((t,e)=>{$(e).attr("font-size",window.getComputedStyle(e).fontSize)}),t.find("text, tspan").each((t,e)=>{var n=window.getComputedStyle(e);$(e).attr({"font-family":n.getPropertyValue("font-family"),fill:n.getPropertyValue("fill"),"alignment-baseline":n.getPropertyValue("alignment-baseline"),"dominant-baseline":n.getPropertyValue("dominant-baseline"),"text-anchor":n.getPropertyValue("text-anchor")}).removeAttr("class")}),t.find("#strip, #dest_strip").each((t,e)=>{var n=window.getComputedStyle(e);$(e).attr({"stroke-width":n.getPropertyValue("stroke-width")})});var a=new Image;a.onload=function(){var t,i,r;s.drawImage(a,0,0,2.5*e,2.5*n),t=$("canvas")[0].toDataURL("image/png"),i="rmg_export","string"==typeof(r=document.createElement("a")).download?(r.href=t,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(t)},a.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t[0].outerHTML)))}function h(t,e){let n=$("#"+e)[0],i=t.getBoundingClientRect(),s=n.createSVGPoint(),a=n.getScreenCTM();s.x=i.left,s.y=i.top;let r=s.matrixTransform(a.inverse());return{x:r.x,y:r.y,width:i.width,height:i.height}}function d(t,e,n){var[i,s]=t.map(t=>t.split(/\\/g)),a=$("<text>").addClass("rmg-name__zh IntName").text(i[0]);for(let t=1;t<i.length;t++)a=a.append($("<tspan>",{x:0,dy:e,"dominant-baseline":"central"}).text(i[t]));var r=(i.length,9);a=a.append($("<tspan>",{x:0,dy:r,class:"rmg-name__en IntName"}).text(s[0]));for(let t=1;t<s.length;t++)a=a.append($("<tspan>",{x:0,dy:n,class:"rmg-name__en IntName"}).text(s[t]));return[a,i.length,s.length]}function _(t,e){let n=t[a.colour],i=t[a.fg],s=[t[a.nameZH],t[a.nameEN]],r=s[0].match(/[\d]+|[\D]+/g)||[""],o=!1;2==r.length&&!isNaN(Number(r[0]))&&isNaN(Number(r[1]))&&(o=!0);let c=$("<g>").append($("<use>",{"xlink:href":"#intbox_gz",fill:-1===e?"#aaa":n})).append($("<text>",{y:8.5,class:"rmg-name__zh rmg-name__gzmtr--int"}).append($("<tspan>",{"font-size":"16px","dominant-baseline":"central"}).text(o?r[0]:"")).append($("<tspan>",{dy:-1,"dominant-baseline":"central"}).text(o?r[1]:r.join("")))).append($("<text>",{y:19.5,class:"rmg-name__en"}).addClass(s[1].length>10?"rmg-name__gzmtr--int-small":"rmg-name__gzmtr--int").text(s[1]));return"#fff"!==i&&-1!==e||$(c).find("text").addClass("rmg-name__gzmtr--white-fg"),c}function u(){return Math.floor(Math.random()*Math.pow(36,4)).toString(36).padStart(4,"0")}function p(t){let e=["ç™¸","ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","æ—¥","æœˆ","é‡‘","æœ¨","æ°´","ç«","åœŸ","ç«¹","æˆˆ","å","å¤§","ä¸­","ä¸€","å¼“","äºº","å¿ƒ","æ‰‹","å£","å°¸","å»¿","å±±","å¥³","ç”°","é›£","åœ","é‡"],n=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Alfa","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliett","Kilo","Lima","Mike","November","Oscar","Papa","Quebec","Romeo","Sierra","Tango","Uniform","Victor","Whiskey","X-ray","Yankee","Zulu"];return[t.split("").map(t=>e[parseInt(t,36)]).join(""),t.split("").map(t=>n[parseInt(t,36)]).join(" ")]}function f(t){return`Number of stations: ${Object.keys(t.stn_list).length-2}\n            ${Object.entries(t.stn_list).map(t=>["linestart","lineend"].includes(t[0])?"":t[1].name.join(" - ")).join("<br>").trim().replace(/\\/," ")}`}function m(t){var e=t.toUpperCase().split("");return 2==t.length?e.map(t=>String.fromCodePoint(t.codePointAt(0)+127397)).join(""):"ðŸ´"+e.map(t=>String.fromCodePoint(t.codePointAt(0)+917536)).join("")+"ó ¿"}function g(t){let e=t.match(/[\d]+/g).map(t=>Number(t).toString(16).padStart(2,"0")).join("");switch(e){case"000000":return"#000";case"ffffff":return"#fff";default:return"#"+e}}function v(){var t=o();"line_name"in t||(t.line_name=["è·¯ç·šå","Name of Line"]),"dest_legacy"in t||(t.dest_legacy=!1),"char_form"in t||(t.char_form=(t=>{switch(t){case"KR":return"trad";case"TC":return"tw";case"SC":return"cn";case"JP":return"jp"}})(t.fontZH[0].split(" ").reverse()[0])),delete t.fontZH,delete t.fontEN,delete t.weightZH,delete t.weightEN;for(let[e,n]of Object.entries(t.stn_list))"branch"in n||(t.stn_list[e].branch={left:[],right:[]},2==n.children.length?t.stn_list[e].branch.right=["through",n.children[1]]:t.stn_list[e].branch.right=[],2==n.parents.length?t.stn_list[e].branch.left=["through",n.parents[1]]:t.stn_list[e].branch.left=[]);"psd_num"in t||(t.psd_num=1),"line_num"in t||(t.line_num=1),delete t.style,3==t.theme.length&&t.theme.push("#fff");for(let[e,n]of Object.entries(t.stn_list))["linestart","lineend"].includes(e)||"num"in n||(t.stn_list[e].num="00");for(let[e,n]of Object.entries(t.stn_list))"interchange"in n&&n.interchange.map(t=>{t.map(t=>{5==t.length&&t.splice(3,0,"#fff")})});"info_panel_type"in t||(t.info_panel_type="panasonic");for(let[e,n]of Object.entries(t.stn_list))"osi22_end_p"===n.change_type&&(t.stn_list[e].change_type="osi22_pr"),"osi22_end_u"===n.change_type&&(t.stn_list[e].change_type="osi22_ur");for(let[e,n]of Object.entries(t.stn_list))"interchange"in n||(t.stn_list[e].interchange=[[]]);"gz_1"===t.info_panel_type&&(t.info_panel_type="gz28"),"panasonic"===t.info_panel_type&&(t.info_panel_type="gz28"),"gz_2"===t.info_panel_type&&(t.info_panel_type="gzgf"),"gz_3"===t.info_panel_type&&(t.info_panel_type="gz3"),"direction_gz_x"in t||(t.direction_gz_x=50),"direction_gz_y"in t||(t.direction_gz_y=70);for(let[e,n]of Object.entries(t.stn_list))"transfer"in t||(t.stn_list[e].transfer={type:n.change_type.split("_")[0],tick_direc:"none"===n.change_type||"int2"===n.change_type?"r":n.change_type.split("_")[1].split("").slice().reverse()[0],paid_area:-1===n.change_type.indexOf("osi")||"p"===n.change_type.split("_")[1][0],osi_names:-1!==n.change_type.indexOf("osi")?[n.interchange[1][0]]:[],info:2===n.interchange.length?[n.interchange[0],n.interchange[1].slice(1)]:n.interchange});r(t)}n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return a})),n.d(e,"m",(function(){return r})),n.d(e,"h",(function(){return o})),n.d(e,"o",(function(){return c})),n.d(e,"p",(function(){return l})),n.d(e,"k",(function(){return h})),n.d(e,"l",(function(){return d})),n.d(e,"f",(function(){return _})),n.d(e,"i",(function(){return u})),n.d(e,"g",(function(){return p})),n.d(e,"e",(function(){return f})),n.d(e,"d",(function(){return m})),n.d(e,"n",(function(){return g})),n.d(e,"q",(function(){return v})),n.d(e,"j",(function(){return y})),function(t){t[t.left=0]="left",t[t.right=1]="right"}(i||(i={})),function(t){t[t.parents=0]="parents",t[t.children=1]="children"}(s||(s={})),function(t){t[t.city=0]="city",t[t.line=1]="line",t[t.colour=2]="colour",t[t.fg=3]="fg",t[t.nameZH=4]="nameZH",t[t.nameEN=5]="nameEN"}(a||(a={}));const y=(t,e)=>t[(t=>{switch(t){case"en":return["en"];case"zh-Hans":return["zh-Hans","zh","en"];case"zh-HK":return["zh-HK","zh-Hant","zh","en"];default:return[t,"en"]}})(e).find(e=>t[e])]},function(t,e,n){"use strict";n.d(e,"l",(function(){return s})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return h})),n.d(e,"e",(function(){return d})),n.d(e,"f",(function(){return u})),n.d(e,"g",(function(){return p})),n.d(e,"k",(function(){return f})),n.d(e,"i",(function(){return m})),n.d(e,"j",(function(){return g})),n.d(e,"h",(function(){return v}));var i=n(0);class s{constructor(t,e){this.STN_NAME_Y=-10.5,this.STN_NAME_BASE_HEIGHT=30.390625,this.STN_NAME_LINE_GAP=14,this.STN_NAME_BG_ADJUST=.5,this.id=t,this.parents=e.parents,this.children=e.children,this.name=e.name,this.branch=e.branch}get inDegree(){return this.parents.length}get outDegree(){return this.children.length}get nameClass(){switch(this.state){case-1:return"Pass";case 0:return"Current";default:return"Future"}}get _nameTxtAnchor(){return"middle"}get _nameDX(){return 0}get _nameDY(){return 0}get nameHTML(){var t=this.name[1].split("\\");if(this.namePos)var e=this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BG_ADJUST;else e=-this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BASE_HEIGHT-10*(t.length-1);0===this.state&&$("#current_bg").attr({y:this.y+e+this.STN_NAME_Y-1.5+this._nameDY,height:this.STN_NAME_BASE_HEIGHT+10*(t.length-1)+2+1.5});for(var n=t.shift(),i=$("<text>",{dy:15,class:"rmg-name__en rmg-name__mtr--station"}).text(n);n=t.shift();)i.append($("<tspan>",{x:0,dy:10,"alignment-baseline":"middle"}).text(n));return $("<g>",{transform:`translate(${this.x+this._nameDX},${this.y+e+this._nameDY})`,"text-anchor":this._nameTxtAnchor,class:`Name ${this.nameClass}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--station").text(this.name[0])).append(i)}get iconClass(){return-1==this.state?"rmg-stn__mtr--pass":"rmg-stn__mtr--future"}get iconHTML(){return $("<use>",{"xlink:href":"#stn_hk",x:this.x,y:this.y,class:this.iconClass})}get ungrpHTML(){return[this.iconHTML,this.nameHTML]}get html(){return $("<g>",{id:this.id}).append(...this.ungrpHTML)}}class a extends s{constructor(t,e){super(t,e),this._intInfo=e.transfer.info[0][0]}get _dy(){return 0}get intTickHTML(){var t=this.namePos?180:0,e=this._intInfo[i.b.colour],n=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y+this._dy})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&n.addClass("rmg-line__pass"),n}get _nameClass(){return-1==this.state?"Pass":"Future"}get intNameHTML(){var[t,e,n]=Object(i.l)([this._intInfo[i.b.nameZH],this._intInfo[i.b.nameEN]],10,7),s=this.namePos?-37.703125-13*(e-1)-7*(n-1):30.953125;return s+=this._dy,$("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+s})`,class:`Name ${this._nameClass}`}).html(t[0])}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML]}}class r extends s{constructor(t,e){super(t,e),this._intCity=[],this._intLine=[],this._intColour=[],this._intNameZH=[],this._intNameEN=[],this._intInfos=e.transfer.info[0]}get iconHTML(){let t=this.namePos?180:0;return $("<use>",{"xlink:href":"#int3_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:this.iconClass})}get _tickRotation(){return 0}get _dy(){return 0}get _dx(){return 0}get _tickFlip(){return 1}get intTickHTML(){let t=[];return this._intInfos.map(t=>t[i.b.colour]).forEach((e,n)=>{if(n>=2)return;let i=-1===this.state?"#aaa":e,s=this.namePos?-18*(2-n):18*(n+1);s+=this._dy,s*=this._tickFlip,t.push($("<use>",{"xlink:href":"#inttick_hk",stroke:i,transform:`translate(${this.x+this._dx},${this.y+s})rotate(${this._tickRotation})`,class:"rmg-line rmg-line__mtr rmg-line__change"}))}),t}get _txtAnchor(){return"middle"}get _intNameDX(){return 0}get _nameClass(){return-1==this.state?"Pass":"Future"}get intNameHTML(){let t=[],e=this._nameClass;return this._intInfos.map(t=>[t[i.b.nameZH],t[i.b.nameEN]]).forEach((n,s)=>{if(s>=2)return;let[a,r,o]=Object(i.l)(n,10,7);var c=this.namePos?-18*(2-s):18*(s+1);c+=this._dy,c*=this._tickFlip,c+=5.953125-(19.65625+13*(r-1)+7*(o-1))/2,t.push($("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x+this._intNameDX},${this.y+c})`,class:"Name "+e}).html(a[0]))}),t}get ungrpHTML(){return[...this.intTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML]}}class o extends r{get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}}class c extends r{get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}}class l extends a{constructor(t,e){e.transfer.info[0].push(e.transfer.info[1][0]),super(t,e),this._osiNames=e.transfer.osi_names[0],this._osiType=e.transfer.paid_area?"p":"u"}get osiClass(){return"u"==this._osiType?"rmg-stn__mtr--unpaid-osi":"rmg-stn__mtr--paid-osi"}get iconHTML(){var t=this.namePos?180:0;return $("<use>",{"xlink:href":"#osi11_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _dy(){return this.namePos?-26:26}get _txtAnchor(){return"middle"}get _osiNameDX(){return 0}get osiNameHTML(){var t=this._dy+8.34375-12.515625;return $("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x+this._osiNameDX},${this.y+t})`,class:"Name "+this._nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1]))}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML,this.osiNameHTML]}}class h extends l{get _txtAnchor(){return"end"}get _osiNameDX(){return-13}}class d extends l{get _txtAnchor(){return"start"}get _osiNameDX(){return 13}}class _ extends r{constructor(t,e){e.transfer.info[0].unshift(...e.transfer.info[1].slice(0,2)),super(t,e),this._osiNames=e.transfer.osi_names[0],this._osiType=e.transfer.paid_area?"p":"u"}get osiClass(){return"u"==this._osiType?"rmg-stn__mtr--unpaid-osi":"rmg-stn__mtr--paid-osi"}get iconHTML(){var t=this.namePos?180:0;return $("<use>",{"xlink:href":"#osi12_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _dy(){return this.namePos?-8:8}get _osiDY(){return this.namePos?-70.6875:62.34375}get _osiTxtAnchor(){return"middle"}get _osiDX(){return 0}get osiNameHTML(){var t=-1==this.state?"Pass":"Future";return $("<g>",{"text-anchor":this._osiTxtAnchor,transform:`translate(${this.x+this._dx+this._osiDX},${this.y+this._osiDY})`,class:`Name ${t}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1].split("\\")[0]).append($("<tspan>",{x:0,dy:10}).text(this._osiNames[1].split("\\")[1]||"")))}get ungrpHTML(){return[...this.intTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.osiNameHTML]}}class u extends _{get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}}class p extends _{get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}}class f extends _{constructor(t,e){super(t,e),this._origIntInfo=e.transfer.info[0][2]}get _nameTxtAnchor(){return this._osiTxtAnchor}get _nameDY(){return this.namePos?11.515625:-11.515625}get origIntTickHTML(){var t=this.namePos?0:180,e=this._origIntInfo[i.b.colour],n=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&n.addClass("rmg-line__pass"),n}get origIntNameHTML(){var[t,e,n]=Object(i.l)([this._origIntInfo[i.b.nameZH],this._origIntInfo[i.b.nameEN]],10,7),s=this.namePos?30.953125:-37.703125-13*(e-1)-7*(n-1);return $("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x-this._nameDX},${this.y+s})`,class:`Name ${this._nameClass}`}).html(t[0])}get _osiNameDX(){return 0}get osiNameHTML(){var t=this._dy-(this.namePos?27:-27)+8.34375-12.515625;return $("<g>",{"text-anchor":this._osiTxtAnchor,transform:`translate(${this.x+this._osiNameDX},${this.y+t})`,class:"Name "+this._nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1]))}get ungrpHTML(){return[...this.intTickHTML,this.origIntTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.origIntNameHTML,this.osiNameHTML]}}class m extends f{get _nameDX(){return 3}get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}get _osiNameDX(){return 13}get _osiTxtAnchor(){return"start"}}class g extends f{get _nameDX(){return-3}get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}get _osiNameDX(){return-13}get _osiTxtAnchor(){return"end"}}class v extends _{constructor(t,e){super(t,e),[this._origIntCity,this._origIntLine,this._origIntColour,this._origIntFg,this._origIntNameZH,this._origIntNameEN]=e.transfer.info[0][2]}get origIntTickHTML(){var t=this.namePos?180:0,e=this._origIntColour,n=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&n.addClass("rmg-line__pass"),n}get origIntNameHTML(){var[t,e,n]=Object(i.l)([this._origIntNameZH,this._origIntNameEN],10,7),s=this.namePos?-37.703125-13*(e-1)-7*(n-1):30.953125;return $("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+s})`,class:`Name ${this._nameClass}`}).html(t[0])}get iconHTML(){var t=this.namePos?1:-1,e="lineend"==this.children[0]?1:-1;this.children[0];return $("<use>",{"xlink:href":"#osi22end_hk",transform:`translate(${this.x},${this.y})scale(${e},${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _tickRotation(){return"lineend"==this.children[0]?-90:90}get _tickFlip(){return-1}get _dx(){return"lineend"==this.children[0]?41:-41}get _dy(){return this.namePos?18:-18}get _intNameDX(){return"lineend"==this.children[0]?65:-65}get _txtAnchor(){return"lineend"==this.children[0]?"start":"end"}get _osiDY(){return this.namePos?-26.6875:18.34375}get _osiTxtAnchor(){return"lineend"==this.children[0]?"start":"end"}get _osiDX(){return"lineend"==this.children[0]?-9:9}get ungrpHTML(){return[...this.intTickHTML,this.origIntTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.origIntNameHTML,this.osiNameHTML]}}},function(t,e){t.exports=mdc.textField},function(t,e){t.exports=mdc.dialog},function(t,e){t.exports=jQuery},function(t,e){t.exports=mdc.ripple},function(t,e){t.exports=mdc.select},function(t,e){t.exports=mdc.list},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),s=n(1);class a{constructor(t){this._longInterval=1,this.stations={},this._svgHeight=t.svg_height,this._svgWidth=t.svg_width,this._svgDestWidth=t.svg_dest_width,this._showOuter=t.show_outer,[this.themeCity,this.themeLine,this._themeColour,this._fgColour]=t.theme,this.yPc=t.y_pc,this._padding=t.padding,this._stripPc=t.strip_pc,this._branchSpacing=t.branch_spacing,this._txtFlip=t.txt_flip,this._lineNames=t.line_name;for(let[e,n]of Object.entries(t.stn_list))this.stations[e]=this._initStnInstance(e,n);this._currentStnId=t.current_stn_idx,this._direction=t.direction,this._platformNum=t.platform_num,this._destLegacy=t.dest_legacy,this._charForm=t.char_form;for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t))}_initStnInstance(t,e){switch(e.change_type){case"int2":case"osi21_ul":case"osi21_pl":case"osi21_ur":case"osi21_pr":return new s.a(t,e);case"int3_l":case"osi31_ul":case"osi31_pl":return new s.b(t,e);case"int3_r":case"osi31_ur":case"osi31_pr":return new s.c(t,e);case"osi11_ul":case"osi11_pl":return new s.d(t,e);case"osi11_ur":case"osi11_pr":return new s.e(t,e);case"osi12_ul":case"osi12_pl":case"osi13_ul":case"osi13_pl":return new s.f(t,e);case"osi12_ur":case"osi12_pr":case"osi13_ur":case"osi13_pr":return new s.g(t,e);case"osi22_pl":case"osi22_ul":return"linestart"==e.parents[0]||"lineend"==e.children[0]?new s.h(t,e):new s.i(t,e);case"osi22_pr":case"osi22_ur":return"linestart"==e.parents[0]||"lineend"==e.children[0]?new s.h(t,e):new s.j(t,e);default:return new s.l(t,e)}}set svgDestWidth(t){isNaN(t)||t<=0||(this._svgDestWidth=t,Object(i.o)("svg_dest_width",t),this.drawSVGFrame(),this.drawStrip(),this.drawDestInfo(),this.loadFonts())}set svgWidth(t){if(!(isNaN(t)||t<=0)){this._svgWidth=t,Object(i.o)("svg_width",t),this.drawSVGFrame();for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.loadFonts(),this.updateStnNameBg()}}set yPc(t){this._yPc=t,Object(i.o)("y_pc",t);let e=t*this._svgHeight/100;$("g#main").attr("transform",`translate(0,${e})`)}set padding(t){t=Number(t),this._padding=t,Object(i.o)("padding",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.loadFonts(),this.updateStnNameBg()}set branchSpacing(t){this._branchSpacing=t,Object(i.o)("branch_spacing",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.loadFonts(),this.updateStnNameBg()}set txtFlip(t){this._txtFlip=t,Object(i.o)("txt_flip",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t));$("#stn_icons").empty(),this.drawStns(),this.loadFonts(),this.updateStnNameBg()}set themeColour(t){this._themeColour=t[0],this._fgColour=t[1];var e=Object(i.h)();e.theme[2]=t[0],e.theme[3]=t[1],Object(i.m)(e),this.fillThemeColour()}set direction(t){this._direction=t,Object(i.o)("direction",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts()}set platformNum(t){this._platformNum=t,Object(i.o)("platform_num",t),$(".rmg-name__platformnum").text(t)}set charForm(t){this._charForm=t,Object(i.o)("char_form",t),$(".rmg-name__char-trad, .rmg-name__char-cn, .rmg-name__char-tw, .rmg-name__char-jp").removeClass("rmg-name__char-trad rmg-name__char-cn rmg-name__char-tw rmg-name__char-jp").addClass(`rmg-name__char-${t}`)}set lineNames(t){this._lineNames=t,Object(i.o)("line_name",t),this.drawDestInfo(),this.loadFonts()}set destLegacy(t){this._destLegacy=t,Object(i.o)("dest_legacy",t),this.drawDestInfo(),this.loadFonts()}set currentStnId(t){this._currentStnId=t,Object(i.o)("current_stn_idx",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts(),this.updateStnNameBg()}_rightWideFactor(t){var e=0;let n=this.stations[t];n instanceof s.c&&(e+=this._longInterval),n instanceof s.e&&(e+=this._longInterval),n instanceof s.g&&(e+=this._longInterval),n instanceof s.k&&(e+=this._longInterval);return["Int3RStation","OSI11RStation","OSI12RStation","OSI22LStation","OSI22RStation"].includes(this.stations[t].constructor.name)&&(e+=this._longInterval),2==this._stnOutdegree(t)&&(e+=this._longInterval/2),2==this._stnIndegree(this.stations[t].children[0])&&(e+=this._longInterval/2),e}_leftWideFactor(t){var e=0;let n=this.stations[t];return n instanceof s.b&&(e+=this._longInterval),n instanceof s.d&&(e+=this._longInterval),n instanceof s.f&&(e+=this._longInterval),n instanceof s.k&&(e+=this._longInterval),2==this._stnIndegree(t)&&(e+=this._longInterval/2),2==this._stnOutdegree(this.stations[t].parents[0])&&(e+=this._longInterval/2),e}_pathWeight(t,e){return this.stations[t].children.includes(e)?1+this._rightWideFactor(t)+this._leftWideFactor(e):-1/0}_cp(t,e){let n=this;if(t==e)return{len:0,nodes:[t]};let i=[],s=[];this.stations[t].children.forEach(a=>{let r=n._cp(a,e);r.len<0||(i.push(this._pathWeight(t,a)+r.len),r.nodes.unshift(t),s.push(r.nodes))});let a=Math.max(...i);return{len:a,nodes:s[i.indexOf(a)]}}get criticalPath(){let t=[],e=[];this.leftDests.forEach(n=>{this.rightDests.forEach(i=>{let s=this._cp(n,i);t.push(s.len),e.push(s.nodes)})});let n=Math.max(...t);return{len:n,nodes:e[t.indexOf(n)]}}_topoOrder(t,e=[]){var n=this;return e.push(t),this.stations[t].children.forEach(i=>{2==this._stnIndegree(i)&&0==this.stations[i].parents.indexOf(t)||e.concat(n._topoOrder(i,e))}),e}get tpo(){let t=this._topoOrder("linestart");return t.slice(1,t.length-1)}get stripY(){return this._stripPc*this._svgHeight/100}get turningRadius(){return this._branchSpacing/2*(Math.sqrt(2)/(Math.sqrt(2)-1))}get lineXs(){return[this._svgWidth*this._padding/100,this._svgWidth*(1-this._padding/100)]}get leftDests(){return this.stations.linestart.children}get rightDests(){return this.stations.lineend.parents}get lValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t)[0])))}get rValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t).reverse()[0])))}_stnIndegree(t){return this.stations[t].inDegree}_stnOutdegree(t){return this.stations[t].outDegree}_stnXShare(t){var e=this.criticalPath;if(e.nodes.includes(t))return this._cp(e.nodes[0],t).len;for(var n=t,i=t,s=!1,a=!1;;){var r=this.stations[n].parents[0];if("linestart"==r){s=!0;break}if(n=r,this._stnOutdegree(n)>1)break}for(;;){var o=this.stations[i].children;if("lineend"==o[0]){a=!0;break}if(i=o[0],this._stnIndegree(i)>1)break}var c=this._cp(n,t).len,l=this._cp(t,i).len;if(s){var h=this._cp(e.nodes[0],i).len;return this._stnXShare(i)-l/(c+l)*h}if(a)h=this._cp(n,e.nodes.slice(-1)[0]).len;else h=this._cp(n,i).len;return this._stnXShare(n)+c/(c+l)*h}_stnRealX(t){let[e,n]=this.lineXs;return e+this._stnXShare(t)/this.criticalPath.len*(n-e)}_stnYShare(t){return this._stnYShareMTR(t)}_stnYShareMTR(t){if(["linestart","lineend"].includes(t)||this._stnIndegree(t)>1||this._stnOutdegree(t)>1)return 0;var e=this.stations[t].parents[0];let n=this;return e?1==this._stnOutdegree(e)?n._stnYShareMTR(e):0==this.stations[e].children.indexOf(t)?1:-1:0}_stnRealY(t){return-this._stnYShare(t)*this._branchSpacing}_isSuccessor(t,e){for(let n of this.routes){let i=n.indexOf(t),s=n.indexOf(e);if(-1!==i&&-1!==s&&i<s)return!0}return!1}_isPredecessor(t,e){for(let n of this.routes){let i=n.indexOf(t),s=n.indexOf(e);if(-1!==i&&-1!==s&&s<i)return!0}return!1}_stnState(t){return t==this._currentStnId?0:"r"==this._direction?this._isSuccessor(this._currentStnId,t)?1:-1:this._isPredecessor(this._currentStnId,t)?1:-1}_stnNamePos(t){if("linestart"===t)return!0;let e=this,n=this.criticalPath.nodes.indexOf(t)%2;if(-1===n){let n=this.stations[t].parents[0];return 2===this._stnOutdegree(n)?e._stnNamePos(n):!e._stnNamePos(n)}return 1===n}drawSVGFrame(){$("#railmap, #outer").attr({width:this._svgWidth,height:this._svgHeight}),$("#destination, #dest_outer").attr({width:this._svgDestWidth,height:this._svgHeight})}showFrameOuter(){this._showOuter?$("#outer, #dest_outer").show():$("#outer, #dest_outer").hide()}drawStns(){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$("#stn_icons").append(e.html);$("#stn_icons").html($("#stn_icons").html())}updateStnNameBg(){var t=Object(i.k)($(`#stn_icons > #${this._currentStnId} > .Name`)[0],"railmap");$("#current_bg").attr({x:t.x-3,width:t.width+6})}get stnDX(){return this.turningRadius-this._branchSpacing/2}get stnDY(){return this._branchSpacing/2}get stnExtraH(){var[t,e]=this.lineXs;return(e-t)/this.criticalPath.len*this._longInterval}get stnSpareH(){var[t,e]=this.lineXs,n=((e-t)/this.criticalPath.len-2*this.stnDX)/2;return n<0&&console.warn(`SVG width too small! ${n}`),n}get pathTurnENE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${-this.stnDY}`}get pathTurnNEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${-this.stnDY}`}get pathTurnESE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${this.stnDY}`}get pathTurnSEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${this.stnDY}`}_linePath(t){var[e,n,i]=[],s=[],{stnExtraH:a,stnSpareH:r,pathTurnESE:o,pathTurnSEE:c,pathTurnENE:l,pathTurnNEE:h,stnDX:d}=this;return t.forEach(t=>{var[_,u]=["_stnRealX","_stnRealY"].map(e=>this[e](t));if(!n&&0!==n)return[e,i,n]=[t,_,u],void s.push(`M ${_},${u}`);u>n?(s.push(0===u?`h ${_-i-a*this._leftWideFactor(t)-r-2*d}`:`h ${a*this._rightWideFactor(e)+r}`),s.push(o,c)):u<n&&(s.push(0===u?`h ${_-i-a*this._leftWideFactor(t)-r-2*d}`:`h ${a*this._rightWideFactor(e)+r}`),s.push(l,h)),s.push(`H ${_}`),[e,i,n]=[t,_,u]}),s.join(" ").replace(/( H ([\d.]+))+/g," H $2")}drawLine(){this.branches.map(t=>{var e=t.filter(t=>this.stations[t].state>=0),n=t.filter(t=>this.stations[t].state<=0);1===e.length&&(n=t),0==e.filter(t=>-1!==n.indexOf(t)).length&&e.length&&(n[0]===t[0]?n.push(e[0]):e[0]===t[0]&&e[e.length-1]===t[t.length-1]&&n.length?(n=t,e=[]):n.unshift(e[e.length-1])),$("#line_main").append($("<path>",{d:this._linePath(e)})),$("#line_pass").append($("<path>",{d:this._linePath(n)}))}),$("#line_main").html($("#line_main").html()),$("#line_pass").html($("#line_pass").html())}drawStrip(){$("#strip").attr("d",`M 0,${this.stripY} H ${this._svgWidth}`),$("#dest_strip").attr("d",`M 0,${this.stripY} H ${this._svgDestWidth}`)}fillThemeColour(){$("#line_main, #strip, #dest_strip").attr("stroke",this._themeColour),$("#dest_name > #platform > circle").attr("fill",this._themeColour)}drawDestInfo(){$("#dest_name > #platform > text").text(this._platformNum);let t=this[this._direction+"ValidDests"],e="l"===this._direction?"start":"end";var[n,i]=[0,1].map(e=>t.map(t=>this.stations[t].name[e].replace(/\\/g," ")).join("/"));if(this._destLegacy){var[s,a]=this._lineNames;a+=" "}else var s=a="";$("#dest_name > g:last-child text").eq(0).text(`${s}å¾€${n}`),$("#dest_name > g:last-child text").eq(1).text(`${a}to ${i}`);var r=310+$("#dest_name > g:last-child")[0].getBoundingClientRect().width+45+50,o="l"==this._direction?1:-1,c=(this._svgDestWidth-o*r)/2,l=90*(1-o),h=c+285*o,d=h+120*o;$("#dest_name > use").attr("transform",`translate(${c},130)rotate(${l})`),$("#dest_name > #platform").attr("transform",`translate(${h},130)`),$("#dest_name > g:last-child").attr({transform:`translate(${d},105)`,"text-anchor":e})}loadFonts(){$(".rmg-name__zh").addClass(`rmg-name__char-${this._charForm}`)}updateStnName(t,e,n){let s=Object(i.h)();s.stn_list[t].name=e,s.stn_list[t].num=n,Object(i.m)(s),this.stations[t].name=e,this.stations[t].stnNum=n,$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html()),this.leftDests.includes(t)&&"l"==this._direction?this.drawDestInfo():this.rightDests.includes(t)&&"r"==this._direction&&this.drawDestInfo(),this.loadFonts(),t==this._currentStnId&&this.updateStnNameBg()}updateStnTransfer(t,e,n=null){var s=this.stations[t].constructor.name;let r=e.split("_")[0],o="none"===e||"int2"===e?"r":e.split("_")[1].split("").slice().reverse()[0],c=-1===e.indexOf("osi")||"p"===e.split("_")[1][0],l=-1!==e.indexOf("osi")?[n[1][0]]:[],h=2===n.length?[n[0],n[1].slice(1)]:n;var d=Object(i.h)();if(d.stn_list[t].change_type=e,"none"==e?(d.stn_list[t].interchange=[[]],d.stn_list[t].transfer={type:r,tick_direc:o,paid_area:c,osi_names:[],info:[[]]}):(d.stn_list[t].interchange=n,d.stn_list[t].transfer={type:r,tick_direc:o,paid_area:c,osi_names:l,info:h}),Object(i.m)(d),this.stations[t]=this._initStnInstance(t,d.stn_list[t]),s!=this.stations[t].constructor.name){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip()}else this.stations[t].x=this._stnRealX(t),this.stations[t].y=this._stnRealY(t),this.stations[t].namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),this.stations[t].state=this._stnState(t),$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html());this.loadFonts(),this.updateStnNameBg()}removeStn(t){var e=Object(i.h)(),n=this.stations[t].parents,s=this.stations[t].children,r=!0;for(let e in this.stations)if(![t,"linestart","lineend"].includes(e)&&0==this._stnYShareMTR(e)){r=!1;break}if(2==n.length&&2==s.length)return!1;if(r)return!1;if(4==Object.keys(e.stn_list).length)return!1;if(2==n.length||2==s.length)n.forEach(t=>{e.stn_list[t].children=s,this.stations[t].children=s}),s.forEach(t=>{e.stn_list[t].parents=n,this.stations[t].parents=n}),1==n.length&&(e.stn_list[n[0]].branch.right=this.stations[t].branch.right,this.stations[n[0]].branch.right=this.stations[t].branch.right),1==s.length&&(e.stn_list[s[0]].branch.left=this.stations[t].branch.left,this.stations[s[0]].branch.left=this.stations[t].branch.left);else if(2==this._stnOutdegree(n[0])&&2==this._stnIndegree(s[0])){var o=this.stations[n[0]].children.indexOf(t),c=this.stations[s[0]].parents.indexOf(t);e.stn_list[n[0]].children.splice(o,1),this.stations[n[0]].children.splice(o,1),e.stn_list[s[0]].parents.splice(c,1),this.stations[s[0]].parents.splice(c,1),e.stn_list[n[0]].branch.right=[],this.stations[n[0]].branch.right=[],e.stn_list[s[0]].branch.left=[],this.stations[s[0]].branch.left=[]}else n.forEach(n=>{var i=e.stn_list[n].children.indexOf(t);s.length?(e.stn_list[n].children[i]=s[0],this.stations[n].children[i]=s[0]):(e.stn_list[n].children.splice(i,1),this.stations[n].children.splice(i,1)),this.stations[n].branch.right[1]===t&&(this.stations[n].branch.right[1]=s[0],e.stn_list[n].branch.right[1]=s[0])}),s.forEach(i=>{var s=e.stn_list[i].parents.indexOf(t);n.length?(e.stn_list[i].parents[s]=n[0],this.stations[i].parents[s]=n[0]):(e.stn_list[i].parents.splice(s,1),this.stations[i].parents.splice(s,1)),this.stations[i].branch.left[1]===t&&(this.stations[i].branch.left[1]=n[0],e.stn_list[i].branch.left[1]=n[0])});delete e.stn_list[t],delete this.stations[t];if(this._currentStnId==t){var l=Object.keys(this.stations)[2];this._currentStnId=l,e.current_stn_idx=l,!0}Object(i.m)(e),n.concat(s).forEach(t=>{["linestart","lineend"].includes(t)||(this.stations[t]=this._initStnInstance(t,e.stn_list[t]))});for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),e.state=this._stnState(t));return a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),this.loadFonts(),this.updateStnNameBg(),!0}newStnPossibleLoc(t,e){switch("before"==t?this._stnIndegree(e):this._stnOutdegree(e)){case 2:return[1,1,1,[],[]];case 1:if(0==this._stnYShareMTR(e)){let n=this.newBranchPossibleEnd(t,e);return n=n.length?n:[],[1,0,0,n,n]}return this._stnYShareMTR(e)<0?"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,0,1,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,0,1,[],[]]:"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,1,0,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,1,0,[],[]]}return[0,0,0,[],[]]}newBranchPossibleEnd(t,e){let n=[];if("before"==t){for(;1==this._stnIndegree(e);)e=this.stations[e].parents[0],n.unshift(e);n.pop()}else{for(;1==this._stnOutdegree(e);)e=this.stations[e].children[0],n.push(e);n.shift()}return n}addStn(t,e,n,s){let r=Object(i.i)();for(;Object.keys(this.stations).includes(r);)r=Object(i.i)();let o=Object(i.h)(),c={};"before"==t?"centre"==n?(c.parents=this.stations[e].parents,0==this._stnIndegree(e)&&0!=this._stnYShareMTR(e)?c.children=this.leftDests:0!=this._stnYShareMTR(e)?(c.children=this.stations[this.stations[e].parents[0]].children,c.branch={left:[],right:this.stations[c.parents[0]].branch.right},this.stations[c.parents[0]].branch.right=[],o.stn_list[c.parents[0]].branch.right=[]):(c.children=[e],c.branch={left:this.stations[e].branch.left,right:[]},this.stations[e].branch.left=[],o.stn_list[e].branch.left=[]),c.parents.forEach(t=>{this.stations[t].children=[r],o.stn_list[t].children=[r]}),c.children.forEach(t=>{this.stations[t].parents=[r],o.stn_list[t].parents=[r]})):"upper"==n?(c.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[0]&&(this.stations[e].branch.left[1]=r,o.stn_list[e].branch.left[1]=r),c.parents=this.stations[e].parents.slice(0,1),c.children=[e],c.parents.forEach(t=>{this.stations[t].children=[r],o.stn_list[t].children=[r]}),this.stations[e].parents[0]=r,o.stn_list[e].parents[0]=r):(c.parents=this.stations[e].parents,c.children=[e],c.parents.forEach(t=>{this.stations[t].children[0]=r,o.stn_list[t].children[0]=r,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=r,o.stn_list[t].branch.right[1]=r)}),c.children.forEach(t=>{this.stations[t].parents=[r],o.stn_list[t].parents=[r]}))):"lower"==n?(c.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[1]&&(this.stations[e].branch.left[1]=r,o.stn_list[e].branch.left[1]=r),c.parents=this.stations[e].parents.slice(1),c.children=[e],c.parents.forEach(t=>{this.stations[t].children=[r],o.stn_list[t].children=[r]}),this.stations[e].parents[1]=r,o.stn_list[e].parents[1]=r):(c.parents=this.stations[e].parents,c.children=[e],c.parents.forEach(t=>{let n=this.stations[t].children.length;this.stations[t].children[n-1]=r,o.stn_list[t].children[n-1]=r,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=r,o.stn_list[t].branch.right[1]=r)}),c.children.forEach(t=>{this.stations[t].parents=[r],o.stn_list[t].parents=[r]}))):"newupper"==n?(c.branch={left:[],right:[]},this.stations[e].branch.left=["through",r],o.stn_list[e].branch.left=["through",r],this.stations[s].branch.right=["through",r],o.stn_list[s].branch.right=["through",r],c.parents=[s],c.children=[e],this.stations[s].children.unshift(r),o.stn_list[s].children.unshift(r),this.stations[e].parents.unshift(r),o.stn_list[e].parents.unshift(r)):"newlower"==n&&(c.branch={left:[],right:[]},this.stations[e].branch.left=["through",r],o.stn_list[e].branch.left=["through",r],this.stations[s].branch.right=["through",r],o.stn_list[s].branch.right=["through",r],c.parents=[s],c.children=[e],this.stations[s].children.push(r),o.stn_list[s].children.push(r),this.stations[e].parents.push(r),o.stn_list[e].parents.push(r)):"centre"==n?(c.children=this.stations[e].children,0==this._stnOutdegree(e)&&0!=this._stnYShareMTR(e)?c.parents=this.rightDests:0!=this._stnYShareMTR(e)?(c.parents=this.stations[this.stations[e].children[0]].parents,c.branch={left:this.stations[c.children[0]].branch.left,right:[]},this.stations[c.children[0]].branch.left=[],o.stn_list[c.children[0]].branch.left=[]):(c.parents=[e],c.branch={left:[],right:this.stations[e].branch.right},this.stations[e].branch.right=[],o.stn_list[e].branch.right=[]),c.children.forEach(t=>{this.stations[t].parents=[r],o.stn_list[t].parents=[r]}),c.parents.forEach(t=>{this.stations[t].children=[r],o.stn_list[t].children=[r]})):"upper"==n?(c.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[0]&&(this.stations[e].branch.right[1]=r,o.stn_list[e].branch.right[1]=r),c.children=this.stations[e].children.slice(0,1),c.parents=[e],c.children.forEach(t=>{this.stations[t].parents=[r],o.stn_list[t].parents=[r]}),this.stations[e].children[0]=r,o.stn_list[e].children[0]=r):(c.children=this.stations[e].children,c.parents=[e],c.children.forEach(t=>{this.stations[t].parents[0]=r,o.stn_list[t].parents[0]=r,this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=r,o.stn_list[t].branch.left[1]=r)}),c.parents.forEach(t=>{this.stations[t].children=[r],o.stn_list[t].children=[r]}))):"lower"==n?(c.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[1]&&(this.stations[e].branch.right[1]=r,o.stn_list[e].branch.right[1]=r),c.children=this.stations[e].children.slice(1),c.parents=[e],c.children.forEach(t=>{this.stations[t].parents=[r],o.stn_list[t].parents=[r]}),this.stations[e].children[1]=r,o.stn_list[e].children[1]=r):(c.children=this.stations[e].children,c.parents=[e],c.children.forEach(t=>{1===this._stnIndegree(t)?(this.stations[t].parents[0]=r,o.stn_list[t].parents[0]=r):(this.stations[t].parents[1]=r,o.stn_list[t].parents[1]=r),this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=r,o.stn_list[t].branch.left[1]=r)}),c.parents.forEach(t=>{this.stations[t].children=[r],o.stn_list[t].children=[r]}))):"newupper"==n?(c.branch={left:[],right:[]},this.stations[e].branch.right=["through",r],o.stn_list[e].branch.right=["through",r],this.stations[s].branch.left=["through",r],o.stn_list[s].branch.left=["through",r],c.children=[s],c.parents=[e],this.stations[s].parents.unshift(r),o.stn_list[s].parents.unshift(r),this.stations[e].children.unshift(r),o.stn_list[e].children.unshift(r)):"newlower"==n&&(c.branch={left:[],right:[]},this.stations[e].branch.right=["through",r],o.stn_list[e].branch.right=["through",r],this.stations[s].branch.left=["through",r],o.stn_list[s].branch.left=["through",r],c.children=[s],c.parents=[e],this.stations[s].parents.push(r),o.stn_list[s].parents.push(r),this.stations[e].children.push(r),o.stn_list[e].children.push(r)),c.name=Object(i.g)(r),c.change_type="none",c.num="00",c.interchange=[[]],c.transfer={info:[[]],type:"none",osi_names:[],paid_area:!0,tick_direc:"r"},o.stn_list[r]=c,Object(i.m)(o),this.stations[r]=this._initStnInstance(r,c),this.stations[e]=this._initStnInstance(e,Object(i.h)().stn_list[e]);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t));return a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),this.loadFonts(),this.updateStnNameBg(),[r,c]}reverseStns(){var t=Object(i.h)();for(let[n,i]of Object.entries(this.stations))if("linestart"===n)t.stn_list.lineend.parents=i.children.reverse(),t.stn_list.lineend.branch={left:i.branch.right,right:[]};else if("lineend"===n)t.stn_list.linestart.children=i.parents.reverse(),t.stn_list.linestart.branch={left:[],right:i.branch.left};else{var e=i.children.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}});t.stn_list[n].children=i.parents.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}}),t.stn_list[n].parents=e,t.stn_list[n].branch.left=i.branch.right,t.stn_list[n].branch.right=i.branch.left}Object(i.m)(t),location.reload(!0)}updateBranchType(t,e,n){let s=i.a[e];if(this.stations[t].branch[s][0]===n)return;this.stations[t].branch[s][0]=n;let r=Object(i.h)();r.stn_list[t].branch[s][0]=n,Object(i.m)(r);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts()}updateBranchFirst(t,e,n){let s=i.a[e];if(this.stations[t].branch[s][1]===n)return!1;let r=n,o=Object(i.h)();if("right"===s){for(;1===this.stations[r].inDegree;)r=this.stations[r].children[0];let e=this.stations[t].children.indexOf(n);this.stations[t].branch.right[1]=o.stn_list[t].branch.right[1]=n,this.stations[r].branch.left[1]=o.stn_list[r].branch.left[1]=this.stations[r].parents[e]}else{for(;1===this.stations[r].outDegree;)r=this.stations[r].parents[0];let e=this.stations[t].parents.indexOf(n);this.stations[t].branch.left[1]=o.stn_list[t].branch.left[1]=n,this.stations[r].branch.right[1]=o.stn_list[r].branch.right[1]=this.stations[r].children[e]}Object(i.m)(o);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t));return a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts(),!0}updateBranchPos(t,e,n){let s=i.a[e];if("right"===s){if(this.stations[t].children.indexOf(this.stations[t].branch.right[1])===n)return}else if(this.stations[t].parents.indexOf(this.stations[t].branch.left[1])===n)return;let r=this.stations[t].branch[s][1],o=Object(i.h)();if("right"===s){for(;1===this.stations[r].inDegree;)r=this.stations[r].children[0];this.stations[t].children.reverse(),o.stn_list[t].children.reverse(),this.stations[r].parents.reverse(),o.stn_list[r].parents.reverse()}else{for(;1===this.stations[r].outDegree;)r=this.stations[r].parents[0];this.stations[t].parents.reverse(),o.stn_list[t].parents.reverse(),this.stations[r].children.reverse(),o.stn_list[r].children.reverse()}Object(i.m)(o);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts()}static clearSVG(){$("#stn_icons, #line_main, #line_pass").empty()}static initSVG(t){t.drawSVGFrame(),t.showFrameOuter(),t.drawStns(),t.fillThemeColour(),t.drawLine(),t.drawStrip(),t.drawDestInfo(),t.loadFonts(),t.updateStnNameBg()}get branches(){for(var t=["linestart"],e=[[]],n=0;t.length;){var i=t.shift(),s=e[n][0]||null,a=[i];for(s&&a.unshift(s);"lineend"!=i&&("linestart"==i||s!=this.stations[i].branch.left[1]);){s=i;var r=this.stations[s].children;switch(r.length){case 1:i=r[0];break;case 2:if(e.push([s]),"linestart"==s)var o=this.stations[s].branch.right[1];else o=this.stations[s].branch.right[1];t.push(o),i=r.filter(t=>t!=o)[0]}a.push(i)}e[n]=a,n++}return e.map(t=>t.filter(t=>!["linestart","lineend"].includes(t)))}get routes(){for(var t=["linestart"],e=[["linestart"]],n=0;t.length;){var i=t.shift(),s=e[n].slice().reverse()[0]||null;for(s&&"linestart"!==i?e[n].push(i):e[n]=[i];"lineend"!==i;){s=i;var a=this.stations[s].children;switch(a.length){case 1:i=a[0];break;case 2:var r=this.stations[s].branch.right[1];"through"===this.stations[s].branch.right[0]?(e.push(e[n].slice()),t.push(r)):0===n&&(e.push([s]),t.push(r)),i=a.filter(t=>t!=r)[0]}if(e[n].push(i),s===this.stations[i].branch.left[1]&&"nonthrough"===this.stations[i].branch.left[0])break}n++}return e}}},function(t,e){t.exports=mdc.switchControl},function(t,e){t.exports=mdc.tabBar},function(t,e){t.exports=mdc.slider},,function(t,e,n){"use strict";n.r(e);var i=n(0),s=n(8),a=n(3),r=n(7),o=n(5);var c=n(4),l=function(t,e,n,i){return new(n||(n=Promise))((function(s,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function o(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,o)}c((i=i.apply(t,e||[])).next())}))};var h=n(2),d=n(11);var _=n(6),u=n(9);function p(){const t=r.MDCList.attachTo($("#design_list_mtr")[0]),e=a.MDCDialog.attachTo($("#design_char_diag")[0]),n=new u.MDCSwitch($("#legacy")[0]);Promise.resolve(Object(i.h)()).then(t=>{$("#design_char_diag")[0].dispatchEvent(new CustomEvent("MDCDialog:closed",{detail:{action:t.char_form}})),n.checked=t.dest_legacy}),t.listen("MDCList:action",t=>{switch(t.detail.index){case 0:window.myLine.txtFlip=!Object(i.h)().txt_flip;break;case 1:e.open()}}),e.listen("MDCDialog:closed",t=>{let e=t.detail.action;"close"!=e&&(window.myLine.charForm=e,$("#design_list_mtr").find("li#char .mdc-list-item__secondary-text").text((t=>$("#design_char_diag").find("li").filter((e,n)=>n.dataset.mdcDialogAction===t).find("span").text())(e)))}),$(n.root_).find("input").on("change",t=>window.myLine.destLegacy=t.target.checked)}var f=n(10),m=function(t,e){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function g(t,e){function n(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var v=function(){return(v=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function y(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,s,a=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(i=a.next()).done;)r.push(i.value)}catch(t){s={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(s)throw s.error}}return r}function b(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t}
/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var C,w=function(){function t(t){void 0===t&&(t={}),this.adapter_=t}return Object.defineProperty(t,"cssClasses",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"strings",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"numbers",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"defaultAdapter",{get:function(){return{}},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.destroy=function(){},t}(),I=function(){function t(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];this.root_=t,this.initialize.apply(this,b(n)),this.foundation_=void 0===e?this.getDefaultFoundation():e,this.foundation_.init(),this.initialSyncWithDOM()}return t.attachTo=function(e){return new t(e,new w({}))},t.prototype.initialize=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.getDefaultFoundation=function(){throw new Error("Subclasses must override getDefaultFoundation to return a properly configured foundation class")},t.prototype.initialSyncWithDOM=function(){},t.prototype.destroy=function(){this.foundation_.destroy()},t.prototype.listen=function(t,e,n){this.root_.addEventListener(t,e,n)},t.prototype.unlisten=function(t,e,n){this.root_.removeEventListener(t,e,n)},t.prototype.emit=function(t,e,n){var i;void 0===n&&(n=!1),"function"==typeof CustomEvent?i=new CustomEvent(t,{bubbles:n,detail:e}):(i=document.createEvent("CustomEvent")).initCustomEvent(t,n,!1,e),this.root_.dispatchEvent(i)},t}();function T(t,e){if(void 0===t&&(t=window),void 0===e&&(e=!1),void 0===C||e){var n=!1;try{t.document.addEventListener("test",(function(){}),{get passive(){return n=!0}})}catch(t){}C=n}return!!C&&{passive:!0}}
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function E(t,e){return(t.matches||t.webkitMatchesSelector||t.msMatchesSelector).call(t,e)}
/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var x,A={BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation",ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded"},S={VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top"},O={DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,INITIAL_ORIGIN_SCALE:.6,PADDING:10,TAP_DELAY_MS:300};
/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var N,D,R=["touchstart","pointerdown","mousedown","keydown"],L=["touchend","pointerup","mouseup","contextmenu"],M=[],P=function(t){function e(n){var i=t.call(this,v({},e.defaultAdapter,n))||this;return i.activationAnimationHasEnded_=!1,i.activationTimer_=0,i.fgDeactivationRemovalTimer_=0,i.fgScale_="0",i.frame_={width:0,height:0},i.initialSize_=0,i.layoutFrame_=0,i.maxRadius_=0,i.unboundedCoords_={left:0,top:0},i.activationState_=i.defaultActivationState_(),i.activationTimerCallback_=function(){i.activationAnimationHasEnded_=!0,i.runDeactivationUXLogicIfReady_()},i.activateHandler_=function(t){return i.activate_(t)},i.deactivateHandler_=function(){return i.deactivate_()},i.focusHandler_=function(){return i.handleFocus()},i.blurHandler_=function(){return i.handleBlur()},i.resizeHandler_=function(){return i.layout()},i}return g(e,t),Object.defineProperty(e,"cssClasses",{get:function(){return A},enumerable:!0,configurable:!0}),Object.defineProperty(e,"strings",{get:function(){return S},enumerable:!0,configurable:!0}),Object.defineProperty(e,"numbers",{get:function(){return O},enumerable:!0,configurable:!0}),Object.defineProperty(e,"defaultAdapter",{get:function(){return{addClass:function(){},browserSupportsCssVars:function(){return!0},computeBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},containsEventTarget:function(){return!0},deregisterDocumentInteractionHandler:function(){},deregisterInteractionHandler:function(){},deregisterResizeHandler:function(){},getWindowPageOffset:function(){return{x:0,y:0}},isSurfaceActive:function(){return!0},isSurfaceDisabled:function(){return!0},isUnbounded:function(){return!0},registerDocumentInteractionHandler:function(){},registerInteractionHandler:function(){},registerResizeHandler:function(){},removeClass:function(){},updateCssVariable:function(){}}},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this,n=this.supportsPressRipple_();if(this.registerRootHandlers_(n),n){var i=e.cssClasses,s=i.ROOT,a=i.UNBOUNDED;requestAnimationFrame((function(){t.adapter_.addClass(s),t.adapter_.isUnbounded()&&(t.adapter_.addClass(a),t.layoutInternal_())}))}},e.prototype.destroy=function(){var t=this;if(this.supportsPressRipple_()){this.activationTimer_&&(clearTimeout(this.activationTimer_),this.activationTimer_=0,this.adapter_.removeClass(e.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer_&&(clearTimeout(this.fgDeactivationRemovalTimer_),this.fgDeactivationRemovalTimer_=0,this.adapter_.removeClass(e.cssClasses.FG_DEACTIVATION));var n=e.cssClasses,i=n.ROOT,s=n.UNBOUNDED;requestAnimationFrame((function(){t.adapter_.removeClass(i),t.adapter_.removeClass(s),t.removeCssVars_()}))}this.deregisterRootHandlers_(),this.deregisterDeactivationHandlers_()},e.prototype.activate=function(t){this.activate_(t)},e.prototype.deactivate=function(){this.deactivate_()},e.prototype.layout=function(){var t=this;this.layoutFrame_&&cancelAnimationFrame(this.layoutFrame_),this.layoutFrame_=requestAnimationFrame((function(){t.layoutInternal_(),t.layoutFrame_=0}))},e.prototype.setUnbounded=function(t){var n=e.cssClasses.UNBOUNDED;t?this.adapter_.addClass(n):this.adapter_.removeClass(n)},e.prototype.handleFocus=function(){var t=this;requestAnimationFrame((function(){return t.adapter_.addClass(e.cssClasses.BG_FOCUSED)}))},e.prototype.handleBlur=function(){var t=this;requestAnimationFrame((function(){return t.adapter_.removeClass(e.cssClasses.BG_FOCUSED)}))},e.prototype.supportsPressRipple_=function(){return this.adapter_.browserSupportsCssVars()},e.prototype.defaultActivationState_=function(){return{activationEvent:void 0,hasDeactivationUXRun:!1,isActivated:!1,isProgrammatic:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1}},e.prototype.registerRootHandlers_=function(t){var e=this;t&&(R.forEach((function(t){e.adapter_.registerInteractionHandler(t,e.activateHandler_)})),this.adapter_.isUnbounded()&&this.adapter_.registerResizeHandler(this.resizeHandler_)),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_)},e.prototype.registerDeactivationHandlers_=function(t){var e=this;"keydown"===t.type?this.adapter_.registerInteractionHandler("keyup",this.deactivateHandler_):L.forEach((function(t){e.adapter_.registerDocumentInteractionHandler(t,e.deactivateHandler_)}))},e.prototype.deregisterRootHandlers_=function(){var t=this;R.forEach((function(e){t.adapter_.deregisterInteractionHandler(e,t.activateHandler_)})),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),this.adapter_.isUnbounded()&&this.adapter_.deregisterResizeHandler(this.resizeHandler_)},e.prototype.deregisterDeactivationHandlers_=function(){var t=this;this.adapter_.deregisterInteractionHandler("keyup",this.deactivateHandler_),L.forEach((function(e){t.adapter_.deregisterDocumentInteractionHandler(e,t.deactivateHandler_)}))},e.prototype.removeCssVars_=function(){var t=this,n=e.strings;Object.keys(n).forEach((function(e){0===e.indexOf("VAR_")&&t.adapter_.updateCssVariable(n[e],null)}))},e.prototype.activate_=function(t){var e=this;if(!this.adapter_.isSurfaceDisabled()){var n=this.activationState_;if(!n.isActivated){var i=this.previousActivationEvent_;if(!(i&&void 0!==t&&i.type!==t.type))n.isActivated=!0,n.isProgrammatic=void 0===t,n.activationEvent=t,n.wasActivatedByPointer=!n.isProgrammatic&&(void 0!==t&&("mousedown"===t.type||"touchstart"===t.type||"pointerdown"===t.type)),void 0!==t&&M.length>0&&M.some((function(t){return e.adapter_.containsEventTarget(t)}))?this.resetActivationState_():(void 0!==t&&(M.push(t.target),this.registerDeactivationHandlers_(t)),n.wasElementMadeActive=this.checkElementMadeActive_(t),n.wasElementMadeActive&&this.animateActivation_(),requestAnimationFrame((function(){M=[],n.wasElementMadeActive||void 0===t||" "!==t.key&&32!==t.keyCode||(n.wasElementMadeActive=e.checkElementMadeActive_(t),n.wasElementMadeActive&&e.animateActivation_()),n.wasElementMadeActive||(e.activationState_=e.defaultActivationState_())})))}}},e.prototype.checkElementMadeActive_=function(t){return void 0===t||"keydown"!==t.type||this.adapter_.isSurfaceActive()},e.prototype.animateActivation_=function(){var t=this,n=e.strings,i=n.VAR_FG_TRANSLATE_START,s=n.VAR_FG_TRANSLATE_END,a=e.cssClasses,r=a.FG_DEACTIVATION,o=a.FG_ACTIVATION,c=e.numbers.DEACTIVATION_TIMEOUT_MS;this.layoutInternal_();var l="",h="";if(!this.adapter_.isUnbounded()){var d=this.getFgTranslationCoordinates_(),_=d.startPoint,u=d.endPoint;l=_.x+"px, "+_.y+"px",h=u.x+"px, "+u.y+"px"}this.adapter_.updateCssVariable(i,l),this.adapter_.updateCssVariable(s,h),clearTimeout(this.activationTimer_),clearTimeout(this.fgDeactivationRemovalTimer_),this.rmBoundedActivationClasses_(),this.adapter_.removeClass(r),this.adapter_.computeBoundingRect(),this.adapter_.addClass(o),this.activationTimer_=setTimeout((function(){return t.activationTimerCallback_()}),c)},e.prototype.getFgTranslationCoordinates_=function(){var t,e=this.activationState_,n=e.activationEvent;return{startPoint:t={x:(t=e.wasActivatedByPointer?function(t,e,n){if(!t)return{x:0,y:0};var i,s,a=e.x,r=e.y,o=a+n.left,c=r+n.top;if("touchstart"===t.type){var l=t;i=l.changedTouches[0].pageX-o,s=l.changedTouches[0].pageY-c}else{var h=t;i=h.pageX-o,s=h.pageY-c}return{x:i,y:s}}(n,this.adapter_.getWindowPageOffset(),this.adapter_.computeBoundingRect()):{x:this.frame_.width/2,y:this.frame_.height/2}).x-this.initialSize_/2,y:t.y-this.initialSize_/2},endPoint:{x:this.frame_.width/2-this.initialSize_/2,y:this.frame_.height/2-this.initialSize_/2}}},e.prototype.runDeactivationUXLogicIfReady_=function(){var t=this,n=e.cssClasses.FG_DEACTIVATION,i=this.activationState_,s=i.hasDeactivationUXRun,a=i.isActivated;(s||!a)&&this.activationAnimationHasEnded_&&(this.rmBoundedActivationClasses_(),this.adapter_.addClass(n),this.fgDeactivationRemovalTimer_=setTimeout((function(){t.adapter_.removeClass(n)}),O.FG_DEACTIVATION_MS))},e.prototype.rmBoundedActivationClasses_=function(){var t=e.cssClasses.FG_ACTIVATION;this.adapter_.removeClass(t),this.activationAnimationHasEnded_=!1,this.adapter_.computeBoundingRect()},e.prototype.resetActivationState_=function(){var t=this;this.previousActivationEvent_=this.activationState_.activationEvent,this.activationState_=this.defaultActivationState_(),setTimeout((function(){return t.previousActivationEvent_=void 0}),e.numbers.TAP_DELAY_MS)},e.prototype.deactivate_=function(){var t=this,e=this.activationState_;if(e.isActivated){var n=v({},e);e.isProgrammatic?(requestAnimationFrame((function(){return t.animateDeactivation_(n)})),this.resetActivationState_()):(this.deregisterDeactivationHandlers_(),requestAnimationFrame((function(){t.activationState_.hasDeactivationUXRun=!0,t.animateDeactivation_(n),t.resetActivationState_()})))}},e.prototype.animateDeactivation_=function(t){var e=t.wasActivatedByPointer,n=t.wasElementMadeActive;(e||n)&&this.runDeactivationUXLogicIfReady_()},e.prototype.layoutInternal_=function(){var t=this;this.frame_=this.adapter_.computeBoundingRect();var n=Math.max(this.frame_.height,this.frame_.width);this.maxRadius_=this.adapter_.isUnbounded()?n:Math.sqrt(Math.pow(t.frame_.width,2)+Math.pow(t.frame_.height,2))+e.numbers.PADDING;var i=Math.floor(n*e.numbers.INITIAL_ORIGIN_SCALE);this.adapter_.isUnbounded()&&i%2!=0?this.initialSize_=i-1:this.initialSize_=i,this.fgScale_=""+this.maxRadius_/this.initialSize_,this.updateLayoutCssVars_()},e.prototype.updateLayoutCssVars_=function(){var t=e.strings,n=t.VAR_FG_SIZE,i=t.VAR_LEFT,s=t.VAR_TOP,a=t.VAR_FG_SCALE;this.adapter_.updateCssVariable(n,this.initialSize_+"px"),this.adapter_.updateCssVariable(a,this.fgScale_),this.adapter_.isUnbounded()&&(this.unboundedCoords_={left:Math.round(this.frame_.width/2-this.initialSize_/2),top:Math.round(this.frame_.height/2-this.initialSize_/2)},this.adapter_.updateCssVariable(i,this.unboundedCoords_.left+"px"),this.adapter_.updateCssVariable(s,this.unboundedCoords_.top+"px"))},e}(w),H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.disabled=!1,e}return g(e,t),e.attachTo=function(t,n){void 0===n&&(n={isUnbounded:void 0});var i=new e(t);return void 0!==n.isUnbounded&&(i.unbounded=n.isUnbounded),i},e.createAdapter=function(t){return{addClass:function(e){return t.root_.classList.add(e)},browserSupportsCssVars:function(){return function(t,e){void 0===e&&(e=!1);var n=t.CSS,i=x;if("boolean"==typeof x&&!e)return x;if(!(n&&"function"==typeof n.supports))return!1;var s=n.supports("--css-vars","yes"),a=n.supports("(--css-vars: yes)")&&n.supports("color","#00000000");return i=!(!s&&!a)&&!function(t){var e=t.document,n=e.createElement("div");n.className="mdc-ripple-surface--test-edge-var-bug",e.head.appendChild(n);var i=t.getComputedStyle(n),s=null!==i&&"solid"===i.borderTopStyle;return n.parentNode&&n.parentNode.removeChild(n),s}(t),e||(x=i),i}(window)},computeBoundingRect:function(){return t.root_.getBoundingClientRect()},containsEventTarget:function(e){return t.root_.contains(e)},deregisterDocumentInteractionHandler:function(t,e){return document.documentElement.removeEventListener(t,e,T())},deregisterInteractionHandler:function(e,n){return t.root_.removeEventListener(e,n,T())},deregisterResizeHandler:function(t){return window.removeEventListener("resize",t)},getWindowPageOffset:function(){return{x:window.pageXOffset,y:window.pageYOffset}},isSurfaceActive:function(){return E(t.root_,":active")},isSurfaceDisabled:function(){return Boolean(t.disabled)},isUnbounded:function(){return Boolean(t.unbounded)},registerDocumentInteractionHandler:function(t,e){return document.documentElement.addEventListener(t,e,T())},registerInteractionHandler:function(e,n){return t.root_.addEventListener(e,n,T())},registerResizeHandler:function(t){return window.addEventListener("resize",t)},removeClass:function(e){return t.root_.classList.remove(e)},updateCssVariable:function(e,n){return t.root_.style.setProperty(e,n)}}},Object.defineProperty(e.prototype,"unbounded",{get:function(){return Boolean(this.unbounded_)},set:function(t){this.unbounded_=Boolean(t),this.setUnbounded_()},enumerable:!0,configurable:!0}),e.prototype.activate=function(){this.foundation_.activate()},e.prototype.deactivate=function(){this.foundation_.deactivate()},e.prototype.layout=function(){this.foundation_.layout()},e.prototype.getDefaultFoundation=function(){return new P(e.createAdapter(this))},e.prototype.initialSyncWithDOM=function(){var t=this.root_;this.unbounded="mdcRippleIsUnbounded"in t.dataset},e.prototype.setUnbounded_=function(){this.foundation_.setUnbounded(Boolean(this.unbounded_))},e}(I);!function(t){t[t.RIGHT=0]="RIGHT",t[t.LEFT=1]="LEFT"}(N||(N={})),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.TRAILING=1]="TRAILING",t[t.NONE=2]="NONE"}(D||(D={}));var k={ARIA_CHECKED:"aria-checked",ARROW_DOWN_KEY:"ArrowDown",ARROW_LEFT_KEY:"ArrowLeft",ARROW_RIGHT_KEY:"ArrowRight",ARROW_UP_KEY:"ArrowUp",BACKSPACE_KEY:"Backspace",CHECKMARK_SELECTOR:".mdc-chip__checkmark",DELETE_KEY:"Delete",END_KEY:"End",ENTER_KEY:"Enter",ENTRY_ANIMATION_NAME:"mdc-chip-entry",HOME_KEY:"Home",INTERACTION_EVENT:"MDCChip:interaction",LEADING_ICON_SELECTOR:".mdc-chip__icon--leading",NAVIGATION_EVENT:"MDCChip:navigation",PRIMARY_ACTION_SELECTOR:".mdc-chip__primary-action",REMOVAL_EVENT:"MDCChip:removal",SELECTION_EVENT:"MDCChip:selection",SPACEBAR_KEY:" ",TAB_INDEX:"tabindex",TRAILING_ACTION_SELECTOR:".mdc-chip__trailing-action",TRAILING_ICON_INTERACTION_EVENT:"MDCChip:trailingIconInteraction",TRAILING_ICON_SELECTOR:".mdc-chip__icon--trailing"},j={CHECKMARK:"mdc-chip__checkmark",CHIP_EXIT:"mdc-chip--exit",DELETABLE:"mdc-chip--deletable",HIDDEN_LEADING_ICON:"mdc-chip__icon--leading-hidden",LEADING_ICON:"mdc-chip__icon--leading",PRIMARY_ACTION:"mdc-chip__primary-action",SELECTED:"mdc-chip--selected",TEXT:"mdc-chip__text",TRAILING_ACTION:"mdc-chip__trailing-action",TRAILING_ICON:"mdc-chip__icon--trailing"},F=new Set;F.add(k.ARROW_LEFT_KEY),F.add(k.ARROW_RIGHT_KEY),F.add(k.ARROW_DOWN_KEY),F.add(k.ARROW_UP_KEY),F.add(k.END_KEY),F.add(k.HOME_KEY);var G=new Set;G.add(k.ARROW_UP_KEY),G.add(k.ARROW_DOWN_KEY),G.add(k.HOME_KEY),G.add(k.END_KEY);
/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var V={bottom:0,height:0,left:0,right:0,top:0,width:0},z=function(t){function e(n){var i=t.call(this,v({},e.defaultAdapter,n))||this;return i.shouldRemoveOnTrailingIconClick_=!0,i}return g(e,t),Object.defineProperty(e,"strings",{get:function(){return k},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cssClasses",{get:function(){return j},enumerable:!0,configurable:!0}),Object.defineProperty(e,"defaultAdapter",{get:function(){return{addClass:function(){},addClassToLeadingIcon:function(){},eventTargetHasClass:function(){return!1},focusPrimaryAction:function(){},focusTrailingAction:function(){},getCheckmarkBoundingClientRect:function(){return V},getComputedStyleValue:function(){return""},getRootBoundingClientRect:function(){return V},hasClass:function(){return!1},hasLeadingIcon:function(){return!1},hasTrailingAction:function(){return!1},isRTL:function(){return!1},notifyInteraction:function(){},notifyNavigation:function(){},notifyRemoval:function(){},notifySelection:function(){},notifyTrailingIconInteraction:function(){},removeClass:function(){},removeClassFromLeadingIcon:function(){},setPrimaryActionAttr:function(){},setStyleProperty:function(){},setTrailingActionAttr:function(){}}},enumerable:!0,configurable:!0}),e.prototype.isSelected=function(){return this.adapter_.hasClass(j.SELECTED)},e.prototype.setSelected=function(t){this.setSelected_(t),this.notifySelection_(t)},e.prototype.setSelectedFromChipSet=function(t,e){this.setSelected_(t),e&&this.notifyIgnoredSelection_(t)},e.prototype.getShouldRemoveOnTrailingIconClick=function(){return this.shouldRemoveOnTrailingIconClick_},e.prototype.setShouldRemoveOnTrailingIconClick=function(t){this.shouldRemoveOnTrailingIconClick_=t},e.prototype.getDimensions=function(){var t=this,e=function(){return t.adapter_.getRootBoundingClientRect()};if(!this.adapter_.hasLeadingIcon()){var n=t.adapter_.getCheckmarkBoundingClientRect();if(n){var i=e();return{bottom:i.bottom,height:i.height,left:i.left,right:i.right,top:i.top,width:i.width+n.height}}}return e()},e.prototype.beginExit=function(){this.adapter_.addClass(j.CHIP_EXIT)},e.prototype.handleInteraction=function(t){this.shouldHandleInteraction_(t)&&(this.adapter_.notifyInteraction(),this.focusPrimaryAction_())},e.prototype.handleTransitionEnd=function(t){var e=this,n=this.adapter_.eventTargetHasClass(t.target,j.CHIP_EXIT),i="width"===t.propertyName,s="opacity"===t.propertyName;if(n&&s){var a=this.adapter_.getComputedStyleValue("width");requestAnimationFrame((function(){e.adapter_.setStyleProperty("width",a),e.adapter_.setStyleProperty("padding","0"),e.adapter_.setStyleProperty("margin","0"),requestAnimationFrame((function(){e.adapter_.setStyleProperty("width","0")}))}))}else if(n&&i&&(this.removeFocus_(),this.adapter_.notifyRemoval()),s){var r=this.adapter_.eventTargetHasClass(t.target,j.LEADING_ICON)&&this.adapter_.hasClass(j.SELECTED),o=this.adapter_.eventTargetHasClass(t.target,j.CHECKMARK)&&!this.adapter_.hasClass(j.SELECTED);return r?this.adapter_.addClassToLeadingIcon(j.HIDDEN_LEADING_ICON):o?this.adapter_.removeClassFromLeadingIcon(j.HIDDEN_LEADING_ICON):void 0}},e.prototype.handleTrailingIconInteraction=function(t){this.shouldHandleInteraction_(t)&&(this.adapter_.notifyTrailingIconInteraction(),this.removeChip_(t))},e.prototype.handleKeydown=function(t){if(this.shouldRemoveChip_(t))return this.removeChip_(t);var e=t.key;F.has(e)&&(t.preventDefault(),this.focusNextAction_(t))},e.prototype.removeFocus=function(){this.adapter_.setPrimaryActionAttr(k.TAB_INDEX,"-1"),this.adapter_.setTrailingActionAttr(k.TAB_INDEX,"-1")},e.prototype.focusPrimaryAction=function(){this.focusPrimaryAction_()},e.prototype.focusTrailingAction=function(){if(!this.adapter_.hasTrailingAction())return this.focusPrimaryAction_();this.focusTrailingAction_()},e.prototype.focusNextAction_=function(t){var e=t.key,n=this.adapter_.hasTrailingAction(),i=this.getDirection_(e),s=this.getEvtSource_(t);if(!G.has(e)&&n)return s===D.PRIMARY&&i===N.RIGHT?this.focusTrailingAction_():s===D.TRAILING&&i===N.LEFT?this.focusPrimaryAction_():void this.adapter_.notifyNavigation(e,D.NONE);this.adapter_.notifyNavigation(e,s)},e.prototype.getEvtSource_=function(t){return this.adapter_.eventTargetHasClass(t.target,j.PRIMARY_ACTION)?D.PRIMARY:this.adapter_.eventTargetHasClass(t.target,j.TRAILING_ACTION)?D.TRAILING:D.NONE},e.prototype.getDirection_=function(t){var e=this.adapter_.isRTL();return t===k.ARROW_LEFT_KEY&&!e||t===k.ARROW_RIGHT_KEY&&e?N.LEFT:N.RIGHT},e.prototype.focusPrimaryAction_=function(){this.adapter_.setPrimaryActionAttr(k.TAB_INDEX,"0"),this.adapter_.focusPrimaryAction(),this.adapter_.setTrailingActionAttr(k.TAB_INDEX,"-1")},e.prototype.focusTrailingAction_=function(){this.adapter_.setTrailingActionAttr(k.TAB_INDEX,"0"),this.adapter_.focusTrailingAction(),this.adapter_.setPrimaryActionAttr(k.TAB_INDEX,"-1")},e.prototype.removeFocus_=function(){this.adapter_.setTrailingActionAttr(k.TAB_INDEX,"-1"),this.adapter_.setPrimaryActionAttr(k.TAB_INDEX,"-1")},e.prototype.removeChip_=function(t){t.stopPropagation(),this.shouldRemoveOnTrailingIconClick_&&this.beginExit()},e.prototype.shouldHandleInteraction_=function(t){if("click"===t.type)return!0;var e=t;return e.key===k.ENTER_KEY||e.key===k.SPACEBAR_KEY},e.prototype.shouldRemoveChip_=function(t){return this.adapter_.hasClass(j.DELETABLE)&&(t.key===k.BACKSPACE_KEY||t.key===k.DELETE_KEY)},e.prototype.setSelected_=function(t){t?(this.adapter_.addClass(j.SELECTED),this.adapter_.setPrimaryActionAttr(k.ARIA_CHECKED,"true")):(this.adapter_.removeClass(j.SELECTED),this.adapter_.setPrimaryActionAttr(k.ARIA_CHECKED,"false"))},e.prototype.notifySelection_=function(t){this.adapter_.notifySelection(t,!1)},e.prototype.notifyIgnoredSelection_=function(t){this.adapter_.notifySelection(t,!0)},e}(w),B=["click","keydown"],Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return g(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this.foundation_.isSelected()},set:function(t){this.foundation_.setSelected(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldRemoveOnTrailingIconClick",{get:function(){return this.foundation_.getShouldRemoveOnTrailingIconClick()},set:function(t){this.foundation_.setShouldRemoveOnTrailingIconClick(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ripple",{get:function(){return this.ripple_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.root_.id},enumerable:!0,configurable:!0}),e.attachTo=function(t){return new e(t)},e.prototype.initialize=function(t){var e=this;void 0===t&&(t=function(t,e){return new H(t,e)}),this.leadingIcon_=this.root_.querySelector(k.LEADING_ICON_SELECTOR),this.trailingIcon_=this.root_.querySelector(k.TRAILING_ICON_SELECTOR),this.checkmark_=this.root_.querySelector(k.CHECKMARK_SELECTOR),this.primaryAction_=this.root_.querySelector(k.PRIMARY_ACTION_SELECTOR),this.trailingAction_=this.root_.querySelector(k.TRAILING_ACTION_SELECTOR);var n=v({},H.createAdapter(this),{computeBoundingRect:function(){return e.foundation_.getDimensions()}});this.ripple_=t(this.root_,new P(n))},e.prototype.initialSyncWithDOM=function(){var t=this;this.handleInteraction_=function(e){return t.foundation_.handleInteraction(e)},this.handleTransitionEnd_=function(e){return t.foundation_.handleTransitionEnd(e)},this.handleTrailingIconInteraction_=function(e){return t.foundation_.handleTrailingIconInteraction(e)},this.handleKeydown_=function(e){return t.foundation_.handleKeydown(e)},B.forEach((function(e){t.listen(e,t.handleInteraction_)})),this.listen("transitionend",this.handleTransitionEnd_),this.listen("keydown",this.handleKeydown_),this.trailingIcon_&&B.forEach((function(e){t.trailingIcon_.addEventListener(e,t.handleTrailingIconInteraction_)}))},e.prototype.destroy=function(){var e=this;this.ripple_.destroy(),B.forEach((function(t){e.unlisten(t,e.handleInteraction_)})),this.unlisten("transitionend",this.handleTransitionEnd_),this.unlisten("keydown",this.handleKeydown_),this.trailingIcon_&&B.forEach((function(t){e.trailingIcon_.removeEventListener(t,e.handleTrailingIconInteraction_)})),t.prototype.destroy.call(this)},e.prototype.beginExit=function(){this.foundation_.beginExit()},e.prototype.getDefaultFoundation=function(){var t=this;return new z({addClass:function(e){return t.root_.classList.add(e)},addClassToLeadingIcon:function(e){t.leadingIcon_&&t.leadingIcon_.classList.add(e)},eventTargetHasClass:function(t,e){return!!t&&t.classList.contains(e)},focusPrimaryAction:function(){t.primaryAction_&&t.primaryAction_.focus()},focusTrailingAction:function(){t.trailingAction_&&t.trailingAction_.focus()},getCheckmarkBoundingClientRect:function(){return t.checkmark_?t.checkmark_.getBoundingClientRect():null},getComputedStyleValue:function(e){return window.getComputedStyle(t.root_).getPropertyValue(e)},getRootBoundingClientRect:function(){return t.root_.getBoundingClientRect()},hasClass:function(e){return t.root_.classList.contains(e)},hasLeadingIcon:function(){return!!t.leadingIcon_},hasTrailingAction:function(){return!!t.trailingAction_},isRTL:function(){return"rtl"===window.getComputedStyle(t.root_).getPropertyValue("direction")},notifyInteraction:function(){return t.emit(k.INTERACTION_EVENT,{chipId:t.id},!0)},notifyNavigation:function(e,n){return t.emit(k.NAVIGATION_EVENT,{chipId:t.id,key:e,source:n},!0)},notifyRemoval:function(){t.emit(k.REMOVAL_EVENT,{chipId:t.id,root:t.root_},!0)},notifySelection:function(e,n){return t.emit(k.SELECTION_EVENT,{chipId:t.id,selected:e,shouldIgnore:n},!0)},notifyTrailingIconInteraction:function(){return t.emit(k.TRAILING_ICON_INTERACTION_EVENT,{chipId:t.id},!0)},removeClass:function(e){return t.root_.classList.remove(e)},removeClassFromLeadingIcon:function(e){t.leadingIcon_&&t.leadingIcon_.classList.remove(e)},setPrimaryActionAttr:function(e,n){t.primaryAction_&&t.primaryAction_.setAttribute(e,n)},setStyleProperty:function(e,n){return t.root_.style.setProperty(e,n)},setTrailingActionAttr:function(e,n){t.trailingAction_&&t.trailingAction_.setAttribute(e,n)}})},e.prototype.setSelectedFromChipSet=function(t,e){this.foundation_.setSelectedFromChipSet(t,e)},e.prototype.focusPrimaryAction=function(){this.foundation_.focusPrimaryAction()},e.prototype.focusTrailingAction=function(){this.foundation_.focusTrailingAction()},e.prototype.removeFocus=function(){this.foundation_.removeFocus()},e.prototype.remove=function(){var t=this.root_.parentNode;null!==t&&t.removeChild(this.root_)},e}(I),X={CHIP_SELECTOR:".mdc-chip"},K={CHOICE:"mdc-chip-set--choice",FILTER:"mdc-chip-set--filter"},W=function(t){function e(n){var i=t.call(this,v({},e.defaultAdapter,n))||this;return i.selectedChipIds_=[],i}return g(e,t),Object.defineProperty(e,"strings",{get:function(){return X},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cssClasses",{get:function(){return K},enumerable:!0,configurable:!0}),Object.defineProperty(e,"defaultAdapter",{get:function(){return{focusChipPrimaryActionAtIndex:function(){},focusChipTrailingActionAtIndex:function(){},getChipListCount:function(){return-1},getIndexOfChipById:function(){return-1},hasClass:function(){return!1},isRTL:function(){return!1},removeChipAtIndex:function(){},removeFocusFromChipAtIndex:function(){},selectChipAtIndex:function(){}}},enumerable:!0,configurable:!0}),e.prototype.getSelectedChipIds=function(){return this.selectedChipIds_.slice()},e.prototype.select=function(t){this.select_(t,!1)},e.prototype.handleChipInteraction=function(t){var e=this.adapter_.getIndexOfChipById(t);this.removeFocusFromChipsExcept_(e),(this.adapter_.hasClass(K.CHOICE)||this.adapter_.hasClass(K.FILTER))&&this.toggleSelect_(t)},e.prototype.handleChipSelection=function(t,e,n){if(!n){var i=this.selectedChipIds_.indexOf(t)>=0;e&&!i?this.select(t):!e&&i&&this.deselect_(t)}},e.prototype.handleChipRemoval=function(t){var e=this.adapter_.getIndexOfChipById(t);this.deselectAndNotifyClients_(t),this.adapter_.removeChipAtIndex(e);var n=this.adapter_.getChipListCount()-1,i=Math.min(e,n);this.removeFocusFromChipsExcept_(i),this.adapter_.focusChipTrailingActionAtIndex(i)},e.prototype.handleChipNavigation=function(t,e,n){var i=this.adapter_.getChipListCount()-1,s=this.adapter_.getIndexOfChipById(t);if(-1!==s&&F.has(e)){var a=this.adapter_.isRTL();e===k.ARROW_RIGHT_KEY&&!a||e===k.ARROW_LEFT_KEY&&a||e===k.ARROW_DOWN_KEY?s++:e===k.HOME_KEY?s=0:e===k.END_KEY?s=i:s--,s<0||s>i||(this.removeFocusFromChipsExcept_(s),this.focusChipAction_(s,e,n))}},e.prototype.focusChipAction_=function(t,e,n){var i=G.has(e);if(i&&n===D.PRIMARY)return this.adapter_.focusChipPrimaryActionAtIndex(t);if(i&&n===D.TRAILING)return this.adapter_.focusChipTrailingActionAtIndex(t);var s=this.getDirection_(e);return s===N.LEFT?this.adapter_.focusChipTrailingActionAtIndex(t):s===N.RIGHT?this.adapter_.focusChipPrimaryActionAtIndex(t):void 0},e.prototype.getDirection_=function(t){var e=this.adapter_.isRTL();return t===k.ARROW_LEFT_KEY&&!e||t===k.ARROW_RIGHT_KEY&&e?N.LEFT:N.RIGHT},e.prototype.deselect_=function(t,e){void 0===e&&(e=!1);var n=this.selectedChipIds_.indexOf(t);if(n>=0){this.selectedChipIds_.splice(n,1);var i=this.adapter_.getIndexOfChipById(t);this.adapter_.selectChipAtIndex(i,!1,e)}},e.prototype.deselectAndNotifyClients_=function(t){this.deselect_(t,!0)},e.prototype.toggleSelect_=function(t){this.selectedChipIds_.indexOf(t)>=0?this.deselectAndNotifyClients_(t):this.selectAndNotifyClients_(t)},e.prototype.removeFocusFromChipsExcept_=function(t){for(var e=this.adapter_.getChipListCount(),n=0;n<e;n++)n!==t&&this.adapter_.removeFocusFromChipAtIndex(n)},e.prototype.selectAndNotifyClients_=function(t){this.select_(t,!0)},e.prototype.select_=function(t,e){if(!(this.selectedChipIds_.indexOf(t)>=0)){if(this.adapter_.hasClass(K.CHOICE)&&this.selectedChipIds_.length>0){var n=this.selectedChipIds_[0],i=this.adapter_.getIndexOfChipById(n);this.selectedChipIds_=[],this.adapter_.selectChipAtIndex(i,!1,e)}this.selectedChipIds_.push(t);var s=this.adapter_.getIndexOfChipById(t);this.adapter_.selectChipAtIndex(s,!0,e)}},e}(w),U=z.strings,q=U.INTERACTION_EVENT,Z=U.SELECTION_EVENT,J=U.REMOVAL_EVENT,Q=U.NAVIGATION_EVENT,tt=W.strings.CHIP_SELECTOR,et=0,nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return g(e,t),e.attachTo=function(t){return new e(t)},Object.defineProperty(e.prototype,"chips",{get:function(){return this.chips_.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedChipIds",{get:function(){return this.foundation_.getSelectedChipIds()},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t){void 0===t&&(t=function(t){return new Y(t)}),this.chipFactory_=t,this.chips_=this.instantiateChips_(this.chipFactory_)},e.prototype.initialSyncWithDOM=function(){var t=this;this.chips_.forEach((function(e){e.id&&e.selected&&t.foundation_.select(e.id)})),this.handleChipInteraction_=function(e){return t.foundation_.handleChipInteraction(e.detail.chipId)},this.handleChipSelection_=function(e){t.foundation_.handleChipSelection(e.detail.chipId,e.detail.selected,e.detail.shouldIgnore)},this.handleChipRemoval_=function(e){return t.foundation_.handleChipRemoval(e.detail.chipId)},this.handleChipNavigation_=function(e){return t.foundation_.handleChipNavigation(e.detail.chipId,e.detail.key,e.detail.source)},this.listen(q,this.handleChipInteraction_),this.listen(Z,this.handleChipSelection_),this.listen(J,this.handleChipRemoval_),this.listen(Q,this.handleChipNavigation_)},e.prototype.destroy=function(){this.chips_.forEach((function(t){t.destroy()})),this.unlisten(q,this.handleChipInteraction_),this.unlisten(Z,this.handleChipSelection_),this.unlisten(J,this.handleChipRemoval_),this.unlisten(Q,this.handleChipNavigation_),t.prototype.destroy.call(this)},e.prototype.addChip=function(t){t.id=t.id||"mdc-chip-"+ ++et,this.chips_.push(this.chipFactory_(t))},e.prototype.getDefaultFoundation=function(){var t=this;return new W({focusChipPrimaryActionAtIndex:function(e){t.chips_[e].focusPrimaryAction()},focusChipTrailingActionAtIndex:function(e){t.chips_[e].focusTrailingAction()},getChipListCount:function(){return t.chips_.length},getIndexOfChipById:function(e){return t.findChipIndex_(e)},hasClass:function(e){return t.root_.classList.contains(e)},isRTL:function(){return"rtl"===window.getComputedStyle(t.root_).getPropertyValue("direction")},removeChipAtIndex:function(e){e>=0&&e<t.chips_.length&&(t.chips_[e].destroy(),t.chips_[e].remove(),t.chips_.splice(e,1))},removeFocusFromChipAtIndex:function(e){t.chips_[e].removeFocus()},selectChipAtIndex:function(e,n,i){e>=0&&e<t.chips_.length&&t.chips_[e].setSelectedFromChipSet(n,i)}})},e.prototype.instantiateChips_=function(t){return[].slice.call(this.root_.querySelectorAll(tt)).map((function(e){return e.id=e.id||"mdc-chip-"+ ++et,t(e)}))},e.prototype.findChipIndex_=function(t){for(var e=0;e<this.chips_.length;e++)if(this.chips_[e].id===t)return e;return-1},e}(I);const it=(t,e,n)=>$("<div>",{id:t,class:"mdc-card mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-2-phone station-card"}).append($("<div>",{class:"mdc-card__primary-action"}).append($("<div>",{class:"mdc-card__media mdc-card__media--16-9"})).append($("<div>",{class:"mdc-card__media-content station-card__content"}).html(e.join("<br>")).prepend($("<span>").css("display","gzmtr"===window.urlParams.get("style")?"inline":"none").text(n+"Â ")))).append($("<div>",{class:"mdc-card__actions"}).append($("<div>",{class:"mdc-card__action-icons"}).append($("<button>",{title:"Set As Current",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("my_location")).append($("<button>",{title:"Interchange",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("edit")).append($("<button>",{title:"Remove",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("delete_forever")))),st=t=>$("<div>",{class:"mdc-chip",role:"row"}).css({"background-color":t[i.b.colour],color:t[i.b.fg]}).data("theme",{city:t[i.b.city],line:t[i.b.line]}).append($("<div>",{class:"mdc-chip__ripple"})).append($("<span>",{role:"gridcell"}).append($("<span>",{role:"button",tabindex:0,class:"mdc-chip__text"}).html(t[i.b.nameZH]+"<br>"+t[i.b.nameEN]))).append($("<span>",{role:"gridcell"}).append($("<i>",{class:"material-icons mdc-chip__icon mdc-chip__icon--trailing",tabindex:-1,role:"button"}).text("cancel")))[0],at=t=>{let e,n=t.map(t=>$(t).find(".mdc-chip").get().map(t=>{return e=t,[$(e).data("theme").city,$(e).data("theme").line,Object(i.n)($(e).css("background-color")),Object(i.n)($(e).css("color")),$(e).find(".mdc-chip__text").html().split("<br>")[0],$(e).find(".mdc-chip__text").html().split("<br>")[1]];var e})),s=n.map(t=>t.length);return 0===s[1]&&(n=[n[0]]),e=3===s[0]&&0===s[1]?"int3":2===s[0]&&1===s[1]?"osi31":2===s[0]&&0===s[1]?"int3":1===s[0]&&2===s[1]?"osi22":1===s[0]&&1===s[1]?"osi21":1===s[0]&&0===s[1]?"int2":0===s[0]&&3===s[1]?"osi13":0===s[0]&&2===s[1]?"osi12":0===s[0]&&1===s[1]?"osi11":0===s[0]&&0===s[1]?"none":"int3",console.log(e),{info:n,changeType:e}},rt=(t,e,n)=>{let i,{changeType:s,info:a}=at(t),r=a,o=$("#stn_edit_diag").attr("for");if(-1!==s.indexOf("osi")){let t=$("button#osi_name .mdc-button__label").html().split("<br>");r[1].unshift(t)}i=e.selectedChipIds.length?e.selectedChipIds[0]:"r";let c=n.checked;-1!==s.indexOf("osi")?s+="_"+(c?"p":"u")+i:-1!==s.indexOf("int3")&&(s+="_"+i),window.myLine.updateStnTransfer(o,s,r)};function ot(){var t=$("#stn_edit_diag .mdc-layout-grid__inner #int_name_zh,#int_name_en").slice(0,2).clone();t.find(".mdc-text-field").removeAttr("data-mdc-auto-init-state"),$("div#int_line").slice(1,3).after(t);const[e,n,s,r,c,l,d]=["#stn_add_diag","#stn_modify_diag","#stn_edit_diag","#stn_intbox_diag","#stn_osiname_diag","#stn_delete_diag","#stn_delete_err"].map(t=>new a.MDCDialog($(t)[0])),[p,m,g,v]=["#prep","#pivot","#loc","#end"].map(t=>new _.MDCSelect($("#stn_add_diag").find(t)[0])),y=["#name_zh","#name_en"].map(t=>new h.MDCTextField($("#stn_modify_diag").find(t)[0])),b=new h.MDCTextField($("#stn_modify_diag #stn_num")[0]),C=$("#stn_edit_diag .mdc-icon-button").get(),w=$("#stn_edit_diag .mdc-chip-set.int-chip-set").get(),I=w.map(t=>new nt(t)),T=(new o.MDCRipple($("#stn_edit_diag #osi_name")[0]),new _.MDCSelect($("#int_city")[0])),E=new _.MDCSelect($("#int_line")[0]),x=["zh","en"].map(t=>new h.MDCTextField($("#stn_intbox_diag").find("#name_"+t)[0])),A=new nt($("#tick_direc")[0]),S=new u.MDCSwitch($("#paid_area")[0]),O=new f.MDCTabBar($("#stn_edit_diag .mdc-tab-bar")[0]),N=["zh","en"].map(t=>new h.MDCTextField($("#stn_osiname_diag").find(`#osi_name_${t}`)[0])),[D,R,L]=["through","first","pos"].map(t=>["left","right"].map(e=>new _.MDCSelect($(`#${e}_${t}`)[0])));var M=Object(i.h)().stn_list;window.myLine.tpo.forEach(t=>{$("#panel_stations .mdc-layout-grid__inner:first").append(it(t,M[t].name,M[t].num)),$("#pivot__selection").append($("<li>",{"data-value":t}).addClass("mdc-list-item").text(M[t].name.join()))}),$("#panel_stations .mdc-card__primary-action").on("click",t=>{var e=t.target.closest(".mdc-card").id;"add_stn"!=e&&($("#stn_modify_diag").attr("for",e),n.open())}),$('#panel_stations .mdc-card__action-icons > [title="Add"]').on("click",t=>{e.open()}),$('#panel_stations .mdc-card__action-icons > [title="Set As Current"]').on("click",t=>{var e=t.target.closest(".mdc-card").id;window.myLine.currentStnId=e}),$('#panel_stations .mdc-card__action-icons > [title="Interchange"]').on("click",t=>{$("#stn_edit_diag").attr("for",t.target.closest(".mdc-card").id),s.open()}),$('#panel_stations .mdc-card__action-icons > [title="Remove"]').on("click",t=>{var e=t.target.closest(".mdc-card").id;$("#stn_delete_diag").attr("for",e),l.open()}),e.listen("MDCDialog:opening",()=>{m.selectedIndex=0}),e.listen("MDCDialog:opened",()=>{[p,m,g].forEach(t=>t.layout())}),e.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=p.value,i=m.value,a=g.value,r=v.value,[o,c]=window.myLine.addStn(e,i,a,r);console.log(e,i,a,r);var h=window.myLine.tpo[window.myLine.tpo.indexOf(o)-1]||"add_stn";$(`#panel_stations .mdc-layout-grid__inner:first #${h}`).after(it(o,c.name,c.num)),$(`#panel_stations #${o} .mdc-card__primary-action`).on("click",t=>{var e=t.target.closest(".mdc-card").id;"add_stn"!=e&&($("#stn_modify_diag").attr("for",e),n.open())}),$(`#panel_stations #${o} .mdc-card__action-icons > [title="Set As Current"]`).on("click",t=>{var e=t.target.closest(".mdc-card").id;window.myLine.currentStnId=e}),$(`#panel_stations #${o} .mdc-card__action-icons > [title="Interchange"]`).on("click",t=>{var e=t.target.closest(".mdc-card").id;$("#stn_edit_diag").attr("for",e),s.open()}),$(`#panel_stations #${o} .mdc-card__action-icons > [title="Remove"]`).on("click",t=>{var e=t.target.closest(".mdc-card").id;$("#stn_delete_diag").attr("for",e),l.open()});var d=$("<li>",{"data-value":o,class:"mdc-list-item"}).text(c.name.join(" - "));"add_stn"==h?$("#pivot__selection").prepend(d):$(`#pivot__selection [data-value="${h}"`).after(d),$("#stn_modify_diag").attr("for",o),n.open()}}),p.listen("MDCSelect:change",t=>{$("#stn_add_diag #pivot")[0].dispatchEvent(new Event("MDCSelect:change"))}),m.listen("MDCSelect:change",t=>{var e=p.value,n=m.value,s=Object(i.h)().stn_list;for(let[t,i]of window.myLine.newStnPossibleLoc(e,n).entries())1===i||i.length?($("#loc__selection li").eq(t).show(),t>=3&&($("#end__selection").empty(),i.forEach(t=>{$("#end__selection").append($("<li>",{class:"mdc-list-item","data-value":t}).text(s[t].name.join(" - ")))}))):$("#loc__selection li").eq(t).hide();g.value=Array.from(document.querySelectorAll("#loc__selection li")).filter(t=>"none"!==t.style.display)[0].dataset.value}),g.listen("MDCSelect:change",t=>{["newupper","newlower"].includes(t.detail.value)?($("#stn_add_diag [new-branch]").show(),v.selectedIndex=0):$("#stn_add_diag [new-branch]").hide()}),n.listen("MDCDialog:opening",t=>{var e=$(t.target).attr("for");Promise.resolve(Object(i.h)().stn_list).then(t=>{y.forEach((n,i)=>n.value=t[e].name[i]),b.value=t[e].num})}),n.listen("MDCDialog:opened",()=>{y.map(t=>t.layout()),b.layout()}),$("#stn_modify_diag").find("#name_zh, #name_en, #stn_num").on("input",()=>{let t=y.map(t=>t.value);var e=b.value,n=$("#stn_modify_diag").attr("for");window.myLine.updateStnName(n,t,e),$(`#panel_stations .mdc-layout-grid__inner:first #${n} .mdc-card__media-content`).html(t.join("<br>")).prepend($("<span>",{style:"gzmtr"==window.urlParams.get("style")?"":"display:none;"}).text(e+" ")),$(`li[data-value="${n}`).text(t.join())});const P=()=>{N.forEach(t=>t.layout())},H=()=>{[...D,...R,...L].map(t=>t.layout())};O.listen("MDCTabBar:activated",t=>{switch(t.detail.index){case 0:$("#panel_interchange").show(),$("#panel_branch").hide(),P();break;case 1:$("#panel_interchange").hide(),$("#panel_branch").show(),H()}}),$.getJSON("data/city_list.json",t=>{var e=window.urlParams.get("lang");t.forEach(t=>{$("#int_city__selection.mdc-list").each((n,s)=>{$(s).append($("<li>",{class:"mdc-list-item","data-value":t.id}).text(Object(i.d)(t.country)+Object(i.j)(t.name,e)))})})}),s.listen("MDCDialog:opening",t=>{let e=$(t.target).attr("for"),n=Object(i.h)().stn_list[e];(t=>{$(w).empty(),t.transfer.info.forEach((t,e)=>{t.forEach((t,n)=>{let i=st(t);w[e].appendChild(i),I[e].addChip(i)})}),t.transfer.osi_names.length?$("button#osi_name .mdc-button__label").html(t.transfer.osi_names[0].join("<br>")):$("button#osi_name .mdc-button__label").html("è»Šç«™å<br>Stn Name"),S.checked=t.transfer.paid_area,A.chips.filter(e=>e.id===t.transfer.tick_direc)[0].selected=!0})(n),(t=>{["left","right"].forEach(e=>{let n=t.branch[e][0];n?(D[i.a[e]].value=n,$(`#${e}_through__selection [data-value="na"]`).hide(),$(`#${e}_through__selection [data-value="through"]`).show(),$(`#${e}_through__selection [data-value="nonthrough"]`).show(),$(`[${e}-first-group], [${e}-pos-group]`).show()):(D[i.a[e]].value="na",$(`#${e}_through__selection [data-value="na"]`).show(),$(`#${e}_through__selection [data-value="through"]`).hide(),$(`#${e}_through__selection [data-value="nonthrough"]`).hide(),$(`[${e}-first-group], [${e}-pos-group]`).hide())}),$("#left_first__selection, #right_first__selection").empty(),Promise.resolve(Object(i.h)().stn_list).then(e=>{[0,1].forEach(n=>{t[i.c[n]].forEach(t=>{$(`#${i.a[n]}_first__selection`).append($("<li>",{class:"mdc-list-item","data-value":t}).text(e[t].name.join()))})})}).then(()=>{D.forEach((e,n)=>{R[n].selectedIndex="na"!==e.value?t[i.c[n]].indexOf(t.branch[i.a[n]][1]):0})}),L.forEach((e,n)=>{e.selectedIndex=t[i.c[n]].indexOf(t.branch[i.a[n]][1])})})(n)}),s.listen("MDCDialog:opened",t=>{P(),H()}),C.forEach((t,e)=>{$(t).on("click",t=>{let n=[Object(i.h)().theme[0],null,null,"#000","ç·š","Line"],s=st(n);w[e].appendChild(s),I[e].addChip(s),rt(w,A,S)})}),I.forEach((t,e)=>{t.listen("MDCChip:interaction",t=>{$("#stn_intbox_diag").data("intId",{setIdx:e,chipId:t.detail.chipId}),r.open()})}),I.forEach((t,e)=>{t.listen("MDCChip:removal",()=>{rt(w,A,S)})}),$("button#osi_name").on("click",t=>{c.open()}),r.listen("MDCDialog:opening",t=>{let{setIdx:e,chipId:n}=$(t.target).data("intId"),{city:i,line:s}=$(w[e]).find("#"+n).data("theme");T.value=i;let a=$(w[e]).find("#"+n).find(".mdc-chip__text").html().split("<br>");x.forEach((t,e)=>t.value=a[e])}),r.listen("MDCDialog:opened",t=>{x.map(t=>t.layout())}),T.listen("MDCSelect:change",t=>{if(-1===t.detail.index)return;let{setIdx:e,chipId:n}=$("#stn_intbox_diag").data("intId");$.getJSON(`data/${t.detail.value}.json`,t=>{var s=window.urlParams.get("lang");$("#int_line__selection.mdc-list").empty(),t.forEach(t=>{$("#int_line__selection.mdc-list").append(`<li class="mdc-list-item" data-value="${t.id}">\n                    <span style="background:${t.colour};color:${t.fg||"#fff"};">&nbsp;${Object(i.j)(t.name,s)}&nbsp;</span>\n                    </li>`)});let{line:a}=$(w[e]).find("#"+n).data("theme"),r=$("#int_line__selection.mdc-list").find(`[data-value="${a}"]`).index();E.selectedIndex=-1===r?0:r}),$(w[e]).find("#"+n).data("theme").city=t.detail.value}),E.listen("MDCSelect:change",t=>{let{value:e,index:n}=t.detail,{setIdx:i,chipId:s}=$("#stn_intbox_diag").data("intId");$(w[i]).find("#"+s).data("theme").line=e,$(w[i]).find("#"+s).css({"background-color":$("#int_line__selection span").eq(n).css("background-color"),color:$("#int_line__selection span").eq(n).css("color")})}),x.forEach(t=>{$(t.root_).find("input").on("input",()=>{let{setIdx:t,chipId:e}=$("#stn_intbox_diag").data("intId");$(w[t]).find("#"+e).find(".mdc-chip__text").html(x[0].value+"<br>"+x[1].value)})}),r.listen("MDCDialog:closed",()=>{rt(w,A,S)}),c.listen("MDCDialog:opening",()=>{$("button#osi_name .mdc-button__label").html().split("<br>").forEach((t,e)=>N[e].value=t)}),c.listen("MDCDialog:opened",()=>{N.map(t=>t.layout())}),$("#osi_name_zh, #osi_name_en").find("input").each((t,e)=>{$(e).on("input",()=>{$("button#osi_name .mdc-button__label").html(N.map(t=>t.value).join("<br>"))})}),c.listen("MDCDialog:closed",()=>{rt(w,A,S)}),A.listen("MDCChip:selection",t=>{0!==A.selectedChipIds.length&&rt(w,A,S)}),$(S.root_).find("input").on("change",()=>{rt(w,A,S)}),D.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{if("na"===t.detail.value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchType(n,e,t.detail.value)})}),R.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{if(1===$(`#${i.a[e]}_first__selection`).children().length)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchFirst(n,e,t.detail.value)&&(L[e].selectedIndex=0===L[e].selectedIndex?1:0)})}),L.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{if("na"===D[e].value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchPos(n,e,t.detail.index)})}),l.listen("MDCDialog:opening",t=>{var e=$(t.target).attr("for");$("#stn_delete_diag #err_stn").text(Object(i.h)().stn_list[e].name.join(" - "))}),l.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=$(t.target).attr("for");window.myLine.removeStn(e)?($(`#panel_stations .mdc-layout-grid__inner #${e}`).remove(),$(`#pivot__selection [data-value="${e}"]`).remove()):d.open()}})}switch((window.urlParams.get("lang")||localStorage.rmgLang||navigator.language.split("-").slice(0,2).join("-")).toLowerCase()){case"zh-cn":case"zh-hans":window.urlParams.set("lang","zh-Hans");break;case"zh":case"zh-hk":case"zh-tw":window.urlParams.set("lang","zh-HK");break;default:window.urlParams.set("lang","en")}switch(window.urlParams.get("style")){case"mtr":case"gzmtr":case"shmetro":break;default:window.urlParams.set("style","mtr")}history.pushState({url:window.location.href},null,"?"+window.urlParams.toString()),c("head").append(...["share","destination","railmap"].map(t=>c("<link>",{rel:"stylesheet",href:`styles/${t}_${window.urlParams.get("style")}.css`,id:`css_${t}`}))),window.myLine=null,c(`[${window.urlParams.get("style")}-specific]`).show(),function(){const[t,e,n,c,l,h]=["#template_diag","#import_diag","#export_diag","#preview_diag","#style_diag","#lang_diag"].map(t=>a.MDCDialog.attachTo($(t)[0])),[d,_]=$("#panel_save .mdc-list").map((t,e)=>r.MDCList.attachTo(e)).get();$("#panel_save .mdc-list li").map((t,e)=>new o.MDCRipple(e)),d.listen("MDCList:action",e=>{switch(e.detail.index){case 0:t.open();break;case 1:$("#upload_file").click();break;case 2:$("<a>",{href:"data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),download:"rmg_param.json"})[0].click();break;case 3:n.open()}}),$("#panel_save .mdc-list:nth-child(2) li:first-child span:nth-child(2) span:last-child").attr("trans-tag",$(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).attr("trans-tag")).text($(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).text()),$("#panel_save .mdc-list:nth-child(2) li:nth-child(2) span:nth-child(2) span:last-child").text($(`#lang_diag [data-mdc-dialog-action="${window.urlParams.get("lang")}"] span`).text()),_.listen("MDCList:action",t=>{switch(t.detail.index){case 0:l.open();break;case 1:h.open()}}),$.getJSON("templates/template_list.json",t=>{var e=window.urlParams.get("lang");t.forEach(t=>{$("#template_diag ul").append($("<li>",{class:"mdc-list-item","data-mdc-dialog-action":t.filename}).append($("<span>",{class:"mdc-list-item__text"}).text(Object(i.j)(t.desc,e))))}),$("#template_diag li:first-child").attr("tabindex",0),$("#theme_line__selection li").map((t,e)=>new o.MDCRipple(e))}),t.listen("MDCDialog:closed",t=>{"close"!=t.detail.action&&$.getJSON(`templates/${t.detail.action}.json`,t=>{localStorage.rmgParam=JSON.stringify(t),location.reload(!0)})}),n.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":break;case"svg1":$("#preview_diag").attr("for","destination"),c.open();break;case"svg2":$("#preview_diag").attr("for","railmap"),c.open()}}),$(window).on("resize",t=>{u()});const u=()=>{var t=$("preview_diag").attr("for"),[e,n]=["destination"==t?Object(i.h)().svg_dest_width:Object(i.h)().svg_width,Object(i.h)().svg_height],s=$(window).width()-32-50,a=$(window).height()-60-53-60,r=Math.min(s/e,a/n);$("#preview_diag").find("svg").attr({width:e*r,height:n*r}),$("#preview_diag").find(".mdc-dialog__surface").attr("style",`max-width:${s+50}px;`)};let p;c.listen("MDCDialog:opened",t=>{var e=$(t.target).attr("for"),[n,s]=["destination"==e?Object(i.h)().svg_dest_width:Object(i.h)().svg_width,Object(i.h)().svg_height];$("#preview_diag .mdc-dialog__surface").attr("style",`max-width:${$(window).width()-32}px;`);var a=$(window).width()-32-50,r=$(window).height()-60-53-60,o=Math.min(a/n,r/s);$(t.target).find(".mdc-dialog__content").append($("#"+$(t.target).attr("for")).clone().attr({style:"all:initial;",viewBox:`0 0 ${n} ${s}`,width:n*o,height:s*o}));let c=["share",$(t.target).find("svg")[0].id].map(t=>Array.from($(`link#css_${t}`)[0].sheet.cssRules).map(t=>t.cssText).join(" "));$(t.target).find("svg").prepend(...c.map(t=>$("<style>").text(t))),$(t.target).find('svg [style="display: none;"]').remove()}),c.listen("MDCDialog:closed",t=>{if("close"!==t.detail.action){if("png"===t.detail.action)return Object(i.p)($(t.target).removeAttr("for").find("svg")),void $(t.target).find(".mdc-dialog__content").empty();if("svg"===t.detail.action){let n=$(t.target).find(".mdc-dialog__content svg");var e=document.createElement("a");e.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n[0].outerHTML))),e.download="rmg_export.svg",e.click(),$(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}}else $(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}),$("#upload_file").on("change",t=>{console.log(t.target.files[0]);let n=new FileReader;n.onload=function(t){console.log(t.target),p=JSON.parse(t.target.result),$("#import_diag").find(".mdc-dialog__content").html(Object(i.e)(p)),e.open()},n.readAsText(t.target.files[0])}),e.listen("MDCDialog:closed",t=>{"close"!=t.detail.action?(s.a.clearSVG(),localStorage.rmgParam=JSON.stringify(p),location.reload(!0)):$("#upload_file")[0].value=""}),l.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":case window.urlParams.get("style"):return;default:window.urlParams.set("style",t.detail.action),window.location.href="?"+window.urlParams.toString()}}),h.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=t.detail.action;localStorage.rmgLang=e,e!=window.urlParams.get("lang")&&(window.urlParams.set("lang",e),window.location.href="?"+window.urlParams.toString())}})}(),function(){const t=t=>l(this,void 0,void 0,(function*(){let e=yield(i=window.urlParams.get("style"),l(void 0,void 0,void 0,(function*(){switch(i){case"mtr":return Promise.resolve(s.a);case"gzmtr":return n.e(0).then(n.bind(null,15)).then(({RMGLineGZ:t})=>t);case"shmetro":return n.e(1).then(n.bind(null,16)).then(({RMGLineSH:t})=>t)}})));var i;window.myLine=yield new e(t),e.initSVG(window.myLine)}));if(null!=localStorage.rmgParam)try{Object(i.q)(),t(Object(i.h)())}catch(t){let e=a.MDCDialog.attachTo($("#init_err_diag")[0]);$("#init_err_diag").find("#err_stack").html(t+"<br>"+t.stack.replace(/\n/g,"<br>")),e.open(),console.error(t)}else $.getJSON("templates/blank.json",e=>{localStorage.rmgParam=JSON.stringify(e),Object(i.q)(),t(Object(i.h)())})}(),function(){let t=[!1,!0,!0,!0,!0];window.sliders=[],f.MDCTabBar.attachTo($("#panels .mdc-tab-bar")[0]).listen("MDCTabBar:activated",e=>{if($(".panel--active").removeClass("panel--active"),$(".panel").eq(e.detail.index).addClass("panel--active"),1==e.detail.index&&t[1]&&(!function(){const[t,e]=["#svg_dest_width","#svg_width"].map(t=>h.MDCTextField.attachTo($(t)[0])),[n,s,a]=["#branch_spacing","#y_pc","#padding"].map(t=>d.MDCSlider.attachTo($(t)[0]));window.sliders.push(n,s,a),Promise.resolve(Object(i.h)()).then(i=>{t.value=i.svg_dest_width.toString(),e.value=i.svg_width.toString(),s.value=i.y_pc,n.value=i.branch_spacing,a.value=i.padding}),$(t.root_).find("input").on("input",t=>window.myLine.svgDestWidth=Number(t.target.value)),$(e.root_).find("input").on("input",t=>window.myLine.svgWidth=Number(t.target.value)),n.listen("MDCSlider:input",()=>{window.myLine.branchSpacing=Number(n.value)}),s.listen("MDCSlider:input",()=>{window.myLine.yPc=Number(s.value)}),a.listen("MDCSlider:input",()=>{window.myLine.padding=Number(a.value)})}(),"gzmtr"===window.urlParams.get("style")&&function(){const[t,e]=["#direction_gz_x","#direction_gz_y"].map(t=>d.MDCSlider.attachTo($(t)[0]));window.sliders.push(t,e),Promise.resolve(Object(i.h)()).then(n=>{t.value=n.direction_gz_x,e.value=n.direction_gz_y}),t.listen("MDCSlider:input",()=>{window.myLine.directionGZX=Number(t.value)}),e.listen("MDCSlider:input",()=>{window.myLine.directionGZY=Number(e.value)})}(),t[1]=!1),1===e.detail.index&&window.sliders.forEach(t=>t.layout()),2==e.detail.index&&t[2]){switch(function(){const t=r.MDCList.attachTo($("#design_list")[0]),[e,n]=["#design_theme_diag","#line_name_diag"].map(t=>a.MDCDialog.attachTo($(t)[0])),[s,c]=["#theme_city","#theme_line"].map(t=>new _.MDCSelect($(t)[0])),[l,d]=["#name_zh","#name_en"].map(t=>h.MDCTextField.attachTo($("#line_name_diag").find(t)[0])),u=h.MDCTextField.attachTo($("#platform_num")[0]);$("#panel_design .mdc-list li").map((t,e)=>new o.MDCRipple(e));const p=t=>$("#design_list").find(`li#direc p#${t}`).text();Promise.resolve(Object(i.h)()).then(t=>{$("#design_list").find("li#name .mdc-list-item__secondary-text").text(t.line_name.join()),l.value=t.line_name[0],d.value=t.line_name[1],$("#design_list").find("li#direc .mdc-list-item__secondary-text").text(p(t.direction)),u.value=t.platform_num}),$.getJSON("data/city_list.json",t=>{let e=window.urlParams.get("lang");t.forEach(t=>{$("#theme_city__selection").append($("<li>",{class:"mdc-list-item","data-value":t.id}).text(Object(i.d)(t.country)+Object(i.j)(t.name,e)))}),$("#theme_city__selection li").map((t,e)=>new o.MDCRipple(e));var[n]=Object(i.h)().theme,a=$(`#theme_city__selection > [data-value="${n}"]`).index();s.selectedIndex=a}),t.listen("MDCList:action",t=>{switch(t.detail.index){case 0:e.open();break;case 1:n.open();break;case 2:"r"==Object(i.h)().direction?(console.log("right to left"),window.myLine.direction="l",$("#design_list").find("li#direc .mdc-list-item__secondary-text").text(p("l"))):(console.log("left to right"),window.myLine.direction="r",$("#design_list").find("li#direc .mdc-list-item__secondary-text").text(p("r")));break;case 4:window.myLine.reverseStns()}}),e.listen("MDCDialog:opened",()=>{[s,c].map(t=>t.layout())}),s.listen("MDCSelect:change",t=>{let e=t.detail.value;$("#theme_line__selection").empty(),$.getJSON(`data/${e}.json`,t=>{var n=window.urlParams.get("lang");t.forEach(t=>{$("#theme_line__selection").append($("<li>",{class:"mdc-list-item","data-value":t.id}).append($("<span>").css({background:t.colour,color:t.fg||"#fff"}).text("Â "+Object(i.j)(t.name,n)+"Â ")))}),$("#theme_line__selection li").map((t,e)=>new o.MDCRipple(e));var s=Object(i.h)();s.theme[0]=e,Object(i.m)(s);var a=$(`#theme_line__selection > [data-value="${s.theme[1]}"]`).index();c.selectedIndex=-1==a?0:a})}),c.listen("MDCSelect:change",t=>{let e=t.detail.index;var n=Object(i.h)();n.theme[1]=t.detail.value,Object(i.m)(n),window.myLine.themeLine=t.detail.value,window.myLine.themeColour=["background-color","color"].map(t=>$("#theme_line__selection span").eq(e).css(t)).map(i.n),$("#design_list").find("li#theme .mdc-list-item__secondary-text").html($("#theme_city__selection li").eq(s.selectedIndex).text()+" "+$("#theme_line__selection li").eq(e).html().trim())}),n.listen("MDCDialog:opened",t=>{[l,d].map(t=>t.layout())}),$("#line_name_diag").find(".mdc-text-field").on("input",()=>{let t=[l,d].map(t=>t.value);window.myLine.lineNames=t,$("#design_list").find("li#name .mdc-list-item__secondary-text").text(t.join())}),$(u.root_).find("input").on("input",t=>window.myLine.platformNum=t.target.value)}(),window.urlParams.get("style")){case"mtr":p();break;case"gzmtr":!function(){const t=r.MDCList.attachTo($("#design_list_gzmtr")[0]),e=a.MDCDialog.attachTo($("#panel_type_diag")[0]),[n,s]=["#psd_num","#line_num"].map(t=>h.MDCTextField.attachTo($(t)[0]));Promise.resolve(Object(i.h)()).then(t=>{n.value=t.psd_num,s.value=t.line_num}),t.listen("MDCList:action",t=>{switch(t.detail.index){case 1:e.open()}}),$(s.root_).find("input").on("input",t=>window.myLine.lineNum=t.target.value),$(n.root_).find("input").on("input",t=>window.myLine.psdNum=t.target.value),e.listen("MDCDialog:closed",t=>{"close"!==t.detail.action&&(window.myLine.infoPanelType=t.detail.action)})}()}t[2]=!1}3==e.detail.index&&t[3]&&(console.log("init again"),ot(),t[3]=!1),4==e.detail.index&&t[4]&&($("#panel_info .mdc-card__actions #report").on("click",()=>{window.open("https://github.com/wongchito/RailMapGenerator/issues","_blank")}),$('#panel_info .mdc-card__action-icons [title="Star"]').on("click",()=>{window.open("https://github.com/wongchito/RailMapGenerator","_blank")}),$('#panel_info .mdc-card__action-icons [title="Fork"]').on("click",()=>{window.open("https://github.com/wongchito/RailMapGenerator/fork","_blank")}),t[4]=!1)})}()}]);