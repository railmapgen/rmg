!function(t){function e(e){for(var s,i,r=e[0],a=e[1],h=0,o=[];h<r.length;h++)i=r[h],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&o.push(n[i][0]),n[i]=0;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s]);for(l&&l(e);o.length;)o.shift()()}var s={},n={3:0};function i(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(t){var e=[],s=n[t];if(0!==s)if(s)e.push(s[2]);else{var r=new Promise((function(e,i){s=n[t]=[e,i]}));e.push(s[2]=r);var a,h=document.createElement("script");h.charset="utf-8",h.timeout=120,i.nc&&h.setAttribute("nonce",i.nc),h.src=function(t){return i.p+""+({0:"LineGZ",1:"LineHK",2:"LineSH",4:"initDesign",5:"initInfo",6:"initLayout",7:"initStations",9:"vendors~initStations"}[t]||t)+".min.js"}(t);var l=new Error;a=function(e){h.onerror=h.onload=null,clearTimeout(o);var s=n[t];if(0!==s){if(s){var i=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",l.name="ChunkLoadError",l.type=i,l.request=r,s[1](l)}n[t]=void 0}};var o=setTimeout((function(){a({type:"timeout",target:h})}),12e4);h.onerror=h.onload=a,document.head.appendChild(h)}return Promise.all(e)},i.m=t,i.c=s,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./dist/",i.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],a=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var l=a;i(i.s=9)}([function(t,e,s){"use strict";var n,i,r;function a(t){localStorage.setItem("rmgParam",JSON.stringify(t))}function h(){return JSON.parse(localStorage.rmgParam)}function l(t,e){let s=h();s[t]=e,a(s)}function o(t){var[e,s]=t.attr("viewBox").split(" ").slice(2),n=$("canvas")[0];$("canvas").attr({width:2.5*e,height:2.5*s});var i=n.getContext("2d");i.clearRect(0,0,n.width,n.height),t.find(".rmg-name__en.rmg-name__gzmtr--station, .rmg-name__en.rmg-name__mtr--station, .rmg-name__zh.IntName").each((t,e)=>{$(e).attr("font-size","10px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int").each((t,e)=>{$(e).attr("font-size","8px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int-small, .rmg-name__en.IntName").each((t,e)=>{$(e).attr("font-size","7px")}),t.find(".rmg-name__en.rmg-name__gzmtr--express").each((t,e)=>{$(e).attr("font-size","6.5px")}),t.find("text:not([font-size]), tspan:not([font-size])").each((t,e)=>{$(e).attr("font-size",window.getComputedStyle(e).fontSize)}),t.find("text, tspan").each((t,e)=>{var s=window.getComputedStyle(e);$(e).attr({"font-family":s.getPropertyValue("font-family"),fill:s.getPropertyValue("fill"),"alignment-baseline":s.getPropertyValue("alignment-baseline"),"dominant-baseline":s.getPropertyValue("dominant-baseline"),"text-anchor":s.getPropertyValue("text-anchor")}).removeAttr("class")}),t.find("#strip, #dest_strip").each((t,e)=>{var s=window.getComputedStyle(e);$(e).attr({"stroke-width":s.getPropertyValue("stroke-width")})});var r=new Image;r.onload=function(){var t,n,a;i.drawImage(r,0,0,2.5*e,2.5*s),t=$("canvas")[0].toDataURL("image/png"),n="rmg_export","string"==typeof(a=document.createElement("a")).download?(a.href=t,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(t)},r.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t[0].outerHTML)))}function c(t,e){let s=$("#"+e)[0],n=t.getBoundingClientRect(),i=s.createSVGPoint(),r=s.getScreenCTM();i.x=n.left,i.y=n.top;let a=i.matrixTransform(r.inverse());return{x:a.x,y:a.y,width:n.width,height:n.height}}function d(t,e,s){var[n,i]=t.map(t=>t.split(/\\/g)),r=$("<text>").addClass("rmg-name__zh IntName").text(n[0]);for(let t=1;t<n.length;t++)r=r.append($("<tspan>",{x:0,dy:e,"dominant-baseline":"central"}).text(n[t]));var a=(n.length,9);r=r.append($("<tspan>",{x:0,dy:a,class:"rmg-name__en IntName"}).text(i[0]));for(let t=1;t<i.length;t++)r=r.append($("<tspan>",{x:0,dy:s,class:"rmg-name__en IntName"}).text(i[t]));return[r,n.length,i.length]}function _(){return Math.floor(Math.random()*Math.pow(36,4)).toString(36).padStart(4,"0")}function g(t){let e=["ç™¸","ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","æ—¥","æœˆ","é‡‘","æœ¨","æ°´","ç«","åœŸ","ç«¹","æˆˆ","å","å¤§","ä¸­","ä¸€","å¼“","äºº","å¿ƒ","æ‰‹","å£","å°¸","å»¿","å±±","å¥³","ç”°","é›£","åœ","é‡"],s=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Alfa","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliett","Kilo","Lima","Mike","November","Oscar","Papa","Quebec","Romeo","Sierra","Tango","Uniform","Victor","Whiskey","X-ray","Yankee","Zulu"];return[t.split("").map(t=>e[parseInt(t,36)]).join(""),t.split("").map(t=>s[parseInt(t,36)]).join(" ")]}function u(t){return`Number of stations: ${Object.keys(t.stn_list).length-2}\n            ${Object.entries(t.stn_list).map(t=>["linestart","lineend"].includes(t[0])?"":t[1].name.join(" - ")).join("<br>").trim().replace(/\\/," ")}`}function f(t){var e=t.toUpperCase().split("");return 2==t.length?e.map(t=>String.fromCodePoint(t.codePointAt(0)+127397)).join(""):"ðŸ´"+e.map(t=>String.fromCodePoint(t.codePointAt(0)+917536)).join("")+"ó ¿"}function p(t){let e=t.match(/[\d]+/g).map(t=>Number(t).toString(16).padStart(2,"0")).join("");switch(e){case"000000":return"#000";case"ffffff":return"#fff";default:return"#"+e}}function m(){var t=h();"line_name"in t||(t.line_name=["è·¯ç·šå","Name of Line"]),"dest_legacy"in t||(t.dest_legacy=!1),"char_form"in t||(t.char_form=(t=>{switch(t){case"KR":return"trad";case"TC":return"tw";case"SC":return"cn";case"JP":return"jp"}})(t.fontZH[0].split(" ").reverse()[0])),delete t.fontZH,delete t.fontEN,delete t.weightZH,delete t.weightEN;for(let[e,s]of Object.entries(t.stn_list))"branch"in s||(t.stn_list[e].branch={left:[],right:[]},2==s.children.length?t.stn_list[e].branch.right=["through",s.children[1]]:t.stn_list[e].branch.right=[],2==s.parents.length?t.stn_list[e].branch.left=["through",s.parents[1]]:t.stn_list[e].branch.left=[]);"psd_num"in t||(t.psd_num=1),"line_num"in t||(t.line_num=1),delete t.style,3==t.theme.length&&t.theme.push("#fff");for(let[e,s]of Object.entries(t.stn_list))["linestart","lineend"].includes(e)||"num"in s||(t.stn_list[e].num="00");for(let[e,s]of Object.entries(t.stn_list))"interchange"in s&&s.interchange.map(t=>{t.map(t=>{5==t.length&&t.splice(3,0,"#fff")})});"info_panel_type"in t||(t.info_panel_type="panasonic");for(let[e,s]of Object.entries(t.stn_list))"osi22_end_p"===s.change_type&&(t.stn_list[e].change_type="osi22_pr"),"osi22_end_u"===s.change_type&&(t.stn_list[e].change_type="osi22_ur");for(let[e,s]of Object.entries(t.stn_list))"interchange"in s||(t.stn_list[e].interchange=[[]]);"gz_1"===t.info_panel_type&&(t.info_panel_type="gz28"),"panasonic"===t.info_panel_type&&(t.info_panel_type="gz28"),"gz_2"===t.info_panel_type&&(t.info_panel_type="gzgf"),"gz_3"===t.info_panel_type&&(t.info_panel_type="gz3"),"direction_gz_x"in t||(t.direction_gz_x=50),"direction_gz_y"in t||(t.direction_gz_y=70);for(let[e,s]of Object.entries(t.stn_list))"transfer"in s||(t.stn_list[e].transfer={type:s.change_type.split("_")[0],tick_direc:"none"===s.change_type||"int2"===s.change_type?"r":s.change_type.split("_")[1].split("").slice().reverse()[0],paid_area:-1===s.change_type.indexOf("osi")||"p"===s.change_type.split("_")[1][0],osi_names:-1!==s.change_type.indexOf("osi")?[s.interchange[1][0]]:[],info:2===s.interchange.length?[s.interchange[0],s.interchange[1].slice(1)]:s.interchange});for(let[e,s]of Object.entries(t.stn_list))"services"in s||(t.stn_list[e].services=["local"]);a(t)}s.d(e,"a",(function(){return n})),s.d(e,"c",(function(){return i})),s.d(e,"b",(function(){return r})),s.d(e,"l",(function(){return a})),s.d(e,"g",(function(){return h})),s.d(e,"n",(function(){return l})),s.d(e,"o",(function(){return o})),s.d(e,"j",(function(){return c})),s.d(e,"k",(function(){return d})),s.d(e,"h",(function(){return _})),s.d(e,"f",(function(){return g})),s.d(e,"e",(function(){return u})),s.d(e,"d",(function(){return f})),s.d(e,"m",(function(){return p})),s.d(e,"p",(function(){return m})),s.d(e,"i",(function(){return b})),function(t){t[t.left=0]="left",t[t.right=1]="right"}(n||(n={})),function(t){t[t.parents=0]="parents",t[t.children=1]="children"}(i||(i={})),function(t){t[t.city=0]="city",t[t.line=1]="line",t[t.colour=2]="colour",t[t.fg=3]="fg",t[t.nameZH=4]="nameZH",t[t.nameEN=5]="nameEN"}(r||(r={}));const b=(t,e)=>t[(t=>{switch(t){case"en":return["en"];case"zh-Hans":return["zh-Hans","zh","en"];case"zh-HK":return["zh-HK","zh-Hant","zh","en"];default:return[t,"en"]}})(e).find(e=>t[e])]},function(t,e){t.exports=jQuery},function(t,e){t.exports=mdc.dialog},function(t,e){t.exports=mdc.ripple},function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var n=s(0),i=s(5);class r{constructor(t){this._longInterval=1,this.stations={},this._svgHeight=t.svg_height,this._svgWidth=t.svg_width,this._svgDestWidth=t.svg_dest_width,this._showOuter=t.show_outer,[this.themeCity,this.themeLine,this._themeColour,this._fgColour]=t.theme,this.yPc=t.y_pc,this._padding=t.padding,this._stripPc=t.strip_pc,this._branchSpacing=t.branch_spacing,this._txtFlip=t.txt_flip,this._lineNames=t.line_name;for(let[e,s]of Object.entries(t.stn_list))this.stations[e]=this._initStnInstance(e,s);this._currentStnId=t.current_stn_idx,this._direction=t.direction,this._platformNum=t.platform_num;for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t))}_initStnInstance(t,e){return new i.l(t,e)}set svgDestWidth(t){isNaN(t)||t<=0||(this._svgDestWidth=t,Object(n.n)("svg_dest_width",t),this.drawSVGFrame(),this.drawStrip(),this.drawDestInfo())}set svgWidth(t){if(!(isNaN(t)||t<=0)){this._svgWidth=t,Object(n.n)("svg_width",t),this.drawSVGFrame();for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip()}}set yPc(t){this._yPc=t,Object(n.n)("y_pc",t);let e=t*this._svgHeight/100;$("g#main").attr("transform",`translate(0,${e})`)}set padding(t){t=Number(t),this._padding=t,Object(n.n)("padding",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t));r.clearSVG(),this.drawStns(),this.drawLine()}set branchSpacing(t){this._branchSpacing=t,Object(n.n)("branch_spacing",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));r.clearSVG(),this.drawStns(),this.drawLine()}set txtFlip(t){this._txtFlip=t,Object(n.n)("txt_flip",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t));$("#stn_icons").empty(),this.drawStns()}set themeColour(t){this._themeColour=t[0],this._fgColour=t[1];var e=Object(n.g)();e.theme[2]=t[0],e.theme[3]=t[1],Object(n.l)(e),this.fillThemeColour()}set direction(t){this._direction=t,Object(n.n)("direction",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo()}set platformNum(t){this._platformNum=t,Object(n.n)("platform_num",t),$(".rmg-name__platformnum").text(t)}set lineNames(t){this._lineNames=t,Object(n.n)("line_name",t)}set currentStnId(t){this._currentStnId=t,Object(n.n)("current_stn_idx",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo()}_rightWideFactor(t){return 0}_leftWideFactor(t){return 0}_pathWeight(t,e){return this.stations[t].children.includes(e)?1+this._rightWideFactor(t)+this._leftWideFactor(e):-1/0}_cp(t,e){let s=this;if(t==e)return{len:0,nodes:[t]};let n=[],i=[];this.stations[t].children.forEach(r=>{let a=s._cp(r,e);a.len<0||(n.push(this._pathWeight(t,r)+a.len),a.nodes.unshift(t),i.push(a.nodes))});let r=Math.max(...n);return{len:r,nodes:i[n.indexOf(r)]}}get criticalPath(){let t=[],e=[];this.leftDests.forEach(s=>{this.rightDests.forEach(n=>{let i=this._cp(s,n);t.push(i.len),e.push(i.nodes)})});let s=Math.max(...t);return{len:s,nodes:e[t.indexOf(s)]}}_topoOrder(t,e=[]){var s=this;return e.push(t),this.stations[t].children.forEach(n=>{2==this._stnIndegree(n)&&0==this.stations[n].parents.indexOf(t)||e.concat(s._topoOrder(n,e))}),e}get tpo(){let t=this._topoOrder("linestart");return t.slice(1,t.length-1)}get stripY(){return this._stripPc*this._svgHeight/100}get turningRadius(){return this._branchSpacing/2*(Math.sqrt(2)/(Math.sqrt(2)-1))}get lineXs(){return[this._svgWidth*this._padding/100,this._svgWidth*(1-this._padding/100)]}get leftDests(){return this.stations.linestart.children}get rightDests(){return this.stations.lineend.parents}get lValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t)[0])))}get rValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t).reverse()[0])))}_stnIndegree(t){return this.stations[t].inDegree}_stnOutdegree(t){return this.stations[t].outDegree}_stnXShare(t){var e=this.criticalPath;if(e.nodes.includes(t))return this._cp(e.nodes[0],t).len;for(var s=t,n=t,i=!1,r=!1;;){var a=this.stations[s].parents[0];if("linestart"==a){i=!0;break}if(s=a,this._stnOutdegree(s)>1)break}for(;;){var h=this.stations[n].children;if("lineend"==h[0]){r=!0;break}if(n=h[0],this._stnIndegree(n)>1)break}var l=this._cp(s,t).len,o=this._cp(t,n).len;if(i){var c=this._cp(e.nodes[0],n).len;return this._stnXShare(n)-o/(l+o)*c}if(r)c=this._cp(s,e.nodes.slice(-1)[0]).len;else c=this._cp(s,n).len;return this._stnXShare(s)+l/(l+o)*c}_stnRealX(t){let[e,s]=this.lineXs;return e+this._stnXShare(t)/this.criticalPath.len*(s-e)}_stnYShare(t){return this._stnYShareMTR(t)}_stnYShareMTR(t){if(["linestart","lineend"].includes(t)||this._stnIndegree(t)>1||this._stnOutdegree(t)>1)return 0;var e=this.stations[t].parents[0];let s=this;return e?1==this._stnOutdegree(e)?s._stnYShareMTR(e):0==this.stations[e].children.indexOf(t)?1:-1:0}_stnRealY(t){return-this._stnYShare(t)*this._branchSpacing}_isSuccessor(t,e){for(let s of this.routes){let n=s.indexOf(t),i=s.indexOf(e);if(-1!==n&&-1!==i&&n<i)return!0}return!1}_isPredecessor(t,e){for(let s of this.routes){let n=s.indexOf(t),i=s.indexOf(e);if(-1!==n&&-1!==i&&i<n)return!0}return!1}_stnState(t){return t==this._currentStnId?0:"r"==this._direction?this._isSuccessor(this._currentStnId,t)?1:-1:this._isPredecessor(this._currentStnId,t)?1:-1}_stnNamePos(t){if("linestart"===t)return!0;let e=this,s=this.criticalPath.nodes.indexOf(t)%2;if(-1===s){let s=this.stations[t].parents[0];return 2===this._stnOutdegree(s)?e._stnNamePos(s):!e._stnNamePos(s)}return 1===s}drawSVGFrame(){$("#railmap, #outer").attr({width:this._svgWidth,height:this._svgHeight}),$("#destination, #dest_outer").attr({width:this._svgDestWidth,height:this._svgHeight})}showFrameOuter(){this._showOuter?$("#outer, #dest_outer").show():$("#outer, #dest_outer").hide()}drawStns(){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$("#stn_icons").append(e.html);$("#stn_icons").html($("#stn_icons").html())}get stnDX(){return this.turningRadius-this._branchSpacing/2}get stnDY(){return this._branchSpacing/2}get stnExtraH(){var[t,e]=this.lineXs;return(e-t)/this.criticalPath.len*this._longInterval}get stnSpareH(){var[t,e]=this.lineXs,s=((e-t)/this.criticalPath.len-2*this.stnDX)/2;return s<0&&console.warn(`SVG width too small! ${s}`),s}get pathTurnENE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${-this.stnDY}`}get pathTurnNEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${-this.stnDY}`}get pathTurnESE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${this.stnDY}`}get pathTurnSEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${this.stnDY}`}_linePath(t){var[e,s,n]=[],i=[],{stnExtraH:r,stnSpareH:a,pathTurnESE:h,pathTurnSEE:l,pathTurnENE:o,pathTurnNEE:c,stnDX:d}=this;return t.forEach(t=>{var[_,g]=["_stnRealX","_stnRealY"].map(e=>this[e](t));if(!s&&0!==s)return[e,n,s]=[t,_,g],void i.push(`M ${_},${g}`);g>s?(i.push(0===g?`h ${_-n-r*this._leftWideFactor(t)-a-2*d}`:`h ${r*this._rightWideFactor(e)+a}`),i.push(h,l)):g<s&&(i.push(0===g?`h ${_-n-r*this._leftWideFactor(t)-a-2*d}`:`h ${r*this._rightWideFactor(e)+a}`),i.push(o,c)),i.push(`H ${_}`),[e,n,s]=[t,_,g]}),i.join(" ").replace(/( H ([\d.]+))+/g," H $2")}drawLine(){this.branches.map(t=>{var e=t.filter(t=>this.stations[t].state>=0),s=t.filter(t=>this.stations[t].state<=0);1===e.length&&(s=t),0==e.filter(t=>-1!==s.indexOf(t)).length&&e.length&&(s[0]===t[0]?s.push(e[0]):e[0]===t[0]&&e[e.length-1]===t[t.length-1]&&s.length?(s=t,e=[]):s.unshift(e[e.length-1])),$("#line_main").append($("<path>",{d:this._linePath(e)})),$("#line_pass").append($("<path>",{d:this._linePath(s)}))}),$("#line_main").html($("#line_main").html()),$("#line_pass").html($("#line_pass").html())}drawStrip(){$("#strip").attr("d",`M 0,${this.stripY} H ${this._svgWidth}`),$("#dest_strip").attr("d",`M 0,${this.stripY} H ${this._svgDestWidth}`)}fillThemeColour(){$("#line_main, #strip, #dest_strip").attr("stroke",this._themeColour),$("#dest_name > #platform > circle").attr("fill",this._themeColour)}drawDestInfo(){}updateStnName(t,e,s){let i=Object(n.g)();i.stn_list[t].name=e,i.stn_list[t].num=s,Object(n.l)(i),this.stations[t].name=e,this.stations[t].stnNum=s,$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html()),this.leftDests.includes(t)&&"l"==this._direction?this.drawDestInfo():this.rightDests.includes(t)&&"r"==this._direction&&this.drawDestInfo()}updateStnServices(t,e){if(e.selected){if(this.stations[t].services.has(e.chipId))return;this.stations[t].services.add(e.chipId)}else if(!this.stations[t].services.delete(e.chipId))return;let s=Object(n.g)();s.stn_list[t].services=Array.from(this.stations[t].services),Object(n.l)(s)}updateStnTransfer(t,e,s=null){this.stations[t].constructor.name;let i=e.split("_")[0],a="none"===e||"int2"===e?"r":e.split("_")[1].split("").slice().reverse()[0],h=-1===e.indexOf("osi")||"p"===e.split("_")[1][0],l=-1!==e.indexOf("osi")?[s[1][0]]:[],o=2===s.length?[s[0],s[1].slice(1)]:s;var c=Object(n.g)();c.stn_list[t].change_type=e,"none"==e?(c.stn_list[t].interchange=[[]],c.stn_list[t].transfer={type:i,tick_direc:a,paid_area:h,osi_names:[],info:[[]]}):(c.stn_list[t].interchange=s,c.stn_list[t].transfer={type:i,tick_direc:a,paid_area:h,osi_names:l,info:o}),Object(n.l)(c),this.stations[t]=this._initStnInstance(t,c.stn_list[t]);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),e.state=this._stnState(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip()}removeStn(t){var e=Object(n.g)(),s=this.stations[t].parents,i=this.stations[t].children,a=!0;for(let e in this.stations)if(![t,"linestart","lineend"].includes(e)&&0==this._stnYShareMTR(e)){a=!1;break}if(2==s.length&&2==i.length)return!1;if(a)return!1;if(4==Object.keys(e.stn_list).length)return!1;if(2==s.length||2==i.length)s.forEach(t=>{e.stn_list[t].children=i,this.stations[t].children=i}),i.forEach(t=>{e.stn_list[t].parents=s,this.stations[t].parents=s}),1==s.length&&(e.stn_list[s[0]].branch.right=this.stations[t].branch.right,this.stations[s[0]].branch.right=this.stations[t].branch.right),1==i.length&&(e.stn_list[i[0]].branch.left=this.stations[t].branch.left,this.stations[i[0]].branch.left=this.stations[t].branch.left);else if(2==this._stnOutdegree(s[0])&&2==this._stnIndegree(i[0])){var h=this.stations[s[0]].children.indexOf(t),l=this.stations[i[0]].parents.indexOf(t);e.stn_list[s[0]].children.splice(h,1),this.stations[s[0]].children.splice(h,1),e.stn_list[i[0]].parents.splice(l,1),this.stations[i[0]].parents.splice(l,1),e.stn_list[s[0]].branch.right=[],this.stations[s[0]].branch.right=[],e.stn_list[i[0]].branch.left=[],this.stations[i[0]].branch.left=[]}else s.forEach(s=>{var n=e.stn_list[s].children.indexOf(t);i.length?(e.stn_list[s].children[n]=i[0],this.stations[s].children[n]=i[0]):(e.stn_list[s].children.splice(n,1),this.stations[s].children.splice(n,1)),this.stations[s].branch.right[1]===t&&(this.stations[s].branch.right[1]=i[0],e.stn_list[s].branch.right[1]=i[0])}),i.forEach(n=>{var i=e.stn_list[n].parents.indexOf(t);s.length?(e.stn_list[n].parents[i]=s[0],this.stations[n].parents[i]=s[0]):(e.stn_list[n].parents.splice(i,1),this.stations[n].parents.splice(i,1)),this.stations[n].branch.left[1]===t&&(this.stations[n].branch.left[1]=s[0],e.stn_list[n].branch.left[1]=s[0])});delete e.stn_list[t],delete this.stations[t];if(this._currentStnId==t){var o=Object.keys(this.stations)[2];this._currentStnId=o,e.current_stn_idx=o,!0}Object(n.l)(e),s.concat(i).forEach(t=>{["linestart","lineend"].includes(t)||(this.stations[t]=this._initStnInstance(t,e.stn_list[t]))});for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),e.state=this._stnState(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),!0}newStnPossibleLoc(t,e){switch("before"==t?this._stnIndegree(e):this._stnOutdegree(e)){case 2:return[1,1,1,[],[]];case 1:if(0==this._stnYShareMTR(e)){let s=this.newBranchPossibleEnd(t,e);return s=s.length?s:[],[1,0,0,s,s]}return this._stnYShareMTR(e)<0?"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,0,1,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,0,1,[],[]]:"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,1,0,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,1,0,[],[]]}return[0,0,0,[],[]]}newBranchPossibleEnd(t,e){let s=[];if("before"==t){for(;1==this._stnIndegree(e);)e=this.stations[e].parents[0],s.unshift(e);s.pop()}else{for(;1==this._stnOutdegree(e);)e=this.stations[e].children[0],s.push(e);s.shift()}return s}addStn(t,e,s,i){let a=Object(n.h)();for(;Object.keys(this.stations).includes(a);)a=Object(n.h)();let h=Object(n.g)(),l={};"before"==t?"centre"==s?(l.parents=this.stations[e].parents,0==this._stnIndegree(e)&&0!=this._stnYShareMTR(e)?l.children=this.leftDests:0!=this._stnYShareMTR(e)?(l.children=this.stations[this.stations[e].parents[0]].children,l.branch={left:[],right:this.stations[l.parents[0]].branch.right},this.stations[l.parents[0]].branch.right=[],h.stn_list[l.parents[0]].branch.right=[]):(l.children=[e],l.branch={left:this.stations[e].branch.left,right:[]},this.stations[e].branch.left=[],h.stn_list[e].branch.left=[]),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]})):"upper"==s?(l.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[0]&&(this.stations[e].branch.left[1]=a,h.stn_list[e].branch.left[1]=a),l.parents=this.stations[e].parents.slice(0,1),l.children=[e],l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}),this.stations[e].parents[0]=a,h.stn_list[e].parents[0]=a):(l.parents=this.stations[e].parents,l.children=[e],l.parents.forEach(t=>{this.stations[t].children[0]=a,h.stn_list[t].children[0]=a,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=a,h.stn_list[t].branch.right[1]=a)}),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}))):"lower"==s?(l.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[1]&&(this.stations[e].branch.left[1]=a,h.stn_list[e].branch.left[1]=a),l.parents=this.stations[e].parents.slice(1),l.children=[e],l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}),this.stations[e].parents[1]=a,h.stn_list[e].parents[1]=a):(l.parents=this.stations[e].parents,l.children=[e],l.parents.forEach(t=>{let s=this.stations[t].children.length;this.stations[t].children[s-1]=a,h.stn_list[t].children[s-1]=a,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=a,h.stn_list[t].branch.right[1]=a)}),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}))):"newupper"==s?(l.branch={left:[],right:[]},this.stations[e].branch.left=["through",a],h.stn_list[e].branch.left=["through",a],this.stations[i].branch.right=["through",a],h.stn_list[i].branch.right=["through",a],l.parents=[i],l.children=[e],this.stations[i].children.unshift(a),h.stn_list[i].children.unshift(a),this.stations[e].parents.unshift(a),h.stn_list[e].parents.unshift(a)):"newlower"==s&&(l.branch={left:[],right:[]},this.stations[e].branch.left=["through",a],h.stn_list[e].branch.left=["through",a],this.stations[i].branch.right=["through",a],h.stn_list[i].branch.right=["through",a],l.parents=[i],l.children=[e],this.stations[i].children.push(a),h.stn_list[i].children.push(a),this.stations[e].parents.push(a),h.stn_list[e].parents.push(a)):"centre"==s?(l.children=this.stations[e].children,0==this._stnOutdegree(e)&&0!=this._stnYShareMTR(e)?l.parents=this.rightDests:0!=this._stnYShareMTR(e)?(l.parents=this.stations[this.stations[e].children[0]].parents,l.branch={left:this.stations[l.children[0]].branch.left,right:[]},this.stations[l.children[0]].branch.left=[],h.stn_list[l.children[0]].branch.left=[]):(l.parents=[e],l.branch={left:[],right:this.stations[e].branch.right},this.stations[e].branch.right=[],h.stn_list[e].branch.right=[]),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]})):"upper"==s?(l.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[0]&&(this.stations[e].branch.right[1]=a,h.stn_list[e].branch.right[1]=a),l.children=this.stations[e].children.slice(0,1),l.parents=[e],l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}),this.stations[e].children[0]=a,h.stn_list[e].children[0]=a):(l.children=this.stations[e].children,l.parents=[e],l.children.forEach(t=>{this.stations[t].parents[0]=a,h.stn_list[t].parents[0]=a,this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=a,h.stn_list[t].branch.left[1]=a)}),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}))):"lower"==s?(l.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[1]&&(this.stations[e].branch.right[1]=a,h.stn_list[e].branch.right[1]=a),l.children=this.stations[e].children.slice(1),l.parents=[e],l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}),this.stations[e].children[1]=a,h.stn_list[e].children[1]=a):(l.children=this.stations[e].children,l.parents=[e],l.children.forEach(t=>{1===this._stnIndegree(t)?(this.stations[t].parents[0]=a,h.stn_list[t].parents[0]=a):(this.stations[t].parents[1]=a,h.stn_list[t].parents[1]=a),this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=a,h.stn_list[t].branch.left[1]=a)}),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}))):"newupper"==s?(l.branch={left:[],right:[]},this.stations[e].branch.right=["through",a],h.stn_list[e].branch.right=["through",a],this.stations[i].branch.left=["through",a],h.stn_list[i].branch.left=["through",a],l.children=[i],l.parents=[e],this.stations[i].parents.unshift(a),h.stn_list[i].parents.unshift(a),this.stations[e].children.unshift(a),h.stn_list[e].children.unshift(a)):"newlower"==s&&(l.branch={left:[],right:[]},this.stations[e].branch.right=["through",a],h.stn_list[e].branch.right=["through",a],this.stations[i].branch.left=["through",a],h.stn_list[i].branch.left=["through",a],l.children=[i],l.parents=[e],this.stations[i].parents.push(a),h.stn_list[i].parents.push(a),this.stations[e].children.push(a),h.stn_list[e].children.push(a)),l.name=Object(n.f)(a),l.change_type="none",l.num="00",l.interchange=[[]],l.services=["local"],l.transfer={info:[[]],type:"none",osi_names:[],paid_area:!0,tick_direc:"r"},h.stn_list[a]=l,Object(n.l)(h),this.stations[a]=this._initStnInstance(a,l),this.stations[e]=this._initStnInstance(e,Object(n.g)().stn_list[e]);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),[a,l]}reverseStns(){var t=Object(n.g)();for(let[s,n]of Object.entries(this.stations))if("linestart"===s)t.stn_list.lineend.parents=n.children.reverse(),t.stn_list.lineend.branch={left:n.branch.right,right:[]};else if("lineend"===s)t.stn_list.linestart.children=n.parents.reverse(),t.stn_list.linestart.branch={left:[],right:n.branch.left};else{var e=n.children.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}});t.stn_list[s].children=n.parents.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}}),t.stn_list[s].parents=e,t.stn_list[s].branch.left=n.branch.right,t.stn_list[s].branch.right=n.branch.left}Object(n.l)(t),location.reload(!0)}updateBranchType(t,e,s){let i=n.a[e];if(this.stations[t].branch[i][0]===s)return!1;this.stations[t].branch[i][0]=s;let a=Object(n.g)();a.stn_list[t].branch[i][0]=s,Object(n.l)(a);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),!0}updateBranchFirst(t,e,s){let i=n.a[e];if(this.stations[t].branch[i][1]===s)return!1;let a=s,h=Object(n.g)();if("right"===i){for(;1===this.stations[a].inDegree;)a=this.stations[a].children[0];let e=this.stations[t].children.indexOf(s);this.stations[t].branch.right[1]=h.stn_list[t].branch.right[1]=s,this.stations[a].branch.left[1]=h.stn_list[a].branch.left[1]=this.stations[a].parents[e]}else{for(;1===this.stations[a].outDegree;)a=this.stations[a].parents[0];let e=this.stations[t].parents.indexOf(s);this.stations[t].branch.left[1]=h.stn_list[t].branch.left[1]=s,this.stations[a].branch.right[1]=h.stn_list[a].branch.right[1]=this.stations[a].children[e]}Object(n.l)(h);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),!0}updateBranchPos(t,e,s){let i=n.a[e];if("right"===i){if(this.stations[t].children.indexOf(this.stations[t].branch.right[1])===s)return!1}else if(this.stations[t].parents.indexOf(this.stations[t].branch.left[1])===s)return!1;let a=this.stations[t].branch[i][1],h=Object(n.g)();if("right"===i){for(;1===this.stations[a].inDegree;)a=this.stations[a].children[0];this.stations[t].children.reverse(),h.stn_list[t].children.reverse(),this.stations[a].parents.reverse(),h.stn_list[a].parents.reverse()}else{for(;1===this.stations[a].outDegree;)a=this.stations[a].parents[0];this.stations[t].parents.reverse(),h.stn_list[t].parents.reverse(),this.stations[a].children.reverse(),h.stn_list[a].children.reverse()}Object(n.l)(h);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),!0}static clearSVG(){$("#stn_icons, #line_main, #line_pass").empty()}static initSVG(t){t.drawSVGFrame(),t.showFrameOuter(),t.drawStns(),t.fillThemeColour(),t.drawLine(),t.drawStrip(),t.drawDestInfo()}get branches(){for(var t=["linestart"],e=[[]],s=0;t.length;){var n=t.shift(),i=e[s][0]||null,r=[n];for(i&&r.unshift(i);"lineend"!=n&&("linestart"==n||i!=this.stations[n].branch.left[1]);){i=n;var a=this.stations[i].children;switch(a.length){case 1:n=a[0];break;case 2:if(e.push([i]),"linestart"==i)var h=this.stations[i].branch.right[1];else h=this.stations[i].branch.right[1];t.push(h),n=a.filter(t=>t!=h)[0]}r.push(n)}e[s]=r,s++}return e.map(t=>t.filter(t=>!["linestart","lineend"].includes(t)))}get routes(){for(var t=["linestart"],e=[["linestart"]],s=0;t.length;){var n=t.shift(),i=e[s].slice().reverse()[0]||null;for(i&&"linestart"!==n?e[s].push(n):e[s]=[n];"lineend"!==n;){i=n;var r=this.stations[i].children;switch(r.length){case 1:n=r[0];break;case 2:var a=this.stations[i].branch.right[1];"through"===this.stations[i].branch.right[0]?(e.push(e[s].slice()),t.push(a)):0===s&&(e.push([i]),t.push(a)),n=r.filter(t=>t!=a)[0]}if(e[s].push(n),i===this.stations[n].branch.left[1]&&"nonthrough"===this.stations[n].branch.left[0])break}s++}return e}}},function(t,e,s){"use strict";s.d(e,"l",(function(){return i})),s.d(e,"a",(function(){return r})),s.d(e,"b",(function(){return h})),s.d(e,"c",(function(){return l})),s.d(e,"d",(function(){return c})),s.d(e,"e",(function(){return d})),s.d(e,"f",(function(){return g})),s.d(e,"g",(function(){return u})),s.d(e,"k",(function(){return f})),s.d(e,"i",(function(){return p})),s.d(e,"j",(function(){return m})),s.d(e,"h",(function(){return b}));var n=s(0);class i{constructor(t,e){this.STN_NAME_Y=-10.5,this.STN_NAME_BASE_HEIGHT=30.390625,this.STN_NAME_LINE_GAP=14,this.STN_NAME_BG_ADJUST=.5,this.id=t,this.parents=e.parents,this.children=e.children,this.name=e.name,this.branch=e.branch,this.services=new Set(e.services)}get inDegree(){return this.parents.length}get outDegree(){return this.children.length}get nameClass(){switch(this.state){case-1:return"Pass";case 0:return"Current";default:return"Future"}}get _nameTxtAnchor(){return"middle"}get _nameDX(){return 0}get _nameDY(){return 0}get nameHTML(){var t=this.name[1].split("\\");if(this.namePos)var e=this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BG_ADJUST;else e=-this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BASE_HEIGHT-10*(t.length-1);0===this.state&&$("#current_bg").attr({y:this.y+e+this.STN_NAME_Y-1.5+this._nameDY,height:this.STN_NAME_BASE_HEIGHT+10*(t.length-1)+2+1.5});for(var s=t.shift(),n=$("<text>",{dy:15,class:"rmg-name__en rmg-name__mtr--station"}).text(s);s=t.shift();)n.append($("<tspan>",{x:0,dy:10,"alignment-baseline":"middle"}).text(s));return $("<g>",{transform:`translate(${this.x+this._nameDX},${this.y+e+this._nameDY})`,"text-anchor":this._nameTxtAnchor,class:`Name ${this.nameClass}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--station").text(this.name[0])).append(n)}get iconClass(){return-1==this.state?"rmg-stn__mtr--pass":"rmg-stn__mtr--future"}get iconHTML(){return $("<use>",{"xlink:href":"#stn_hk",x:this.x,y:this.y,class:this.iconClass})}get ungrpHTML(){return[this.iconHTML,this.nameHTML]}get html(){return $("<g>",{id:this.id}).append(...this.ungrpHTML)}}class r extends i{constructor(t,e){super(t,e),this._intInfo=e.transfer.info[0][0]}get _dy(){return 0}get intTickHTML(){var t=this.namePos?180:0,e=this._intInfo[n.b.colour],s=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y+this._dy})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&s.addClass("rmg-line__pass"),s}get _nameClass(){return-1==this.state?"Pass":"Future"}get intNameHTML(){var[t,e,s]=Object(n.k)([this._intInfo[n.b.nameZH],this._intInfo[n.b.nameEN]],10,7),i=this.namePos?-37.703125-13*(e-1)-7*(s-1):30.953125;return i+=this._dy,$("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+i})`,class:`Name ${this._nameClass}`}).html(t[0])}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML]}}class a extends i{constructor(t,e){super(t,e),this._intCity=[],this._intLine=[],this._intColour=[],this._intNameZH=[],this._intNameEN=[],this._intInfos=e.transfer.info[0]}get iconHTML(){let t=this.namePos?180:0;return $("<use>",{"xlink:href":"#int3_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:this.iconClass})}get _tickRotation(){return 0}get _dy(){return 0}get _dx(){return 0}get _tickFlip(){return 1}get intTickHTML(){let t=[];return this._intInfos.map(t=>t[n.b.colour]).forEach((e,s)=>{if(s>=2)return;let n=-1===this.state?"#aaa":e,i=this.namePos?-18*(2-s):18*(s+1);i+=this._dy,i*=this._tickFlip,t.push($("<use>",{"xlink:href":"#inttick_hk",stroke:n,transform:`translate(${this.x+this._dx},${this.y+i})rotate(${this._tickRotation})`,class:"rmg-line rmg-line__mtr rmg-line__change"}))}),t}get _txtAnchor(){return"middle"}get _intNameDX(){return 0}get _nameClass(){return-1==this.state?"Pass":"Future"}get intNameHTML(){let t=[],e=this._nameClass;return this._intInfos.map(t=>[t[n.b.nameZH],t[n.b.nameEN]]).forEach((s,i)=>{if(i>=2)return;let[r,a,h]=Object(n.k)(s,10,7);var l=this.namePos?-18*(2-i):18*(i+1);l+=this._dy,l*=this._tickFlip,l+=5.953125-(19.65625+13*(a-1)+7*(h-1))/2,t.push($("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x+this._intNameDX},${this.y+l})`,class:"Name "+e}).html(r[0]))}),t}get ungrpHTML(){return[...this.intTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML]}}class h extends a{get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}}class l extends a{get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}}class o extends r{constructor(t,e){e.transfer.info[0].push(e.transfer.info[1][0]),super(t,e),this._osiNames=e.transfer.osi_names[0],this._osiType=e.transfer.paid_area?"p":"u"}get osiClass(){return"u"==this._osiType?"rmg-stn__mtr--unpaid-osi":"rmg-stn__mtr--paid-osi"}get iconHTML(){var t=this.namePos?180:0;return $("<use>",{"xlink:href":"#osi11_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _dy(){return this.namePos?-26:26}get _txtAnchor(){return"middle"}get _osiNameDX(){return 0}get osiNameHTML(){var t=this._dy+8.34375-12.515625;return $("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x+this._osiNameDX},${this.y+t})`,class:"Name "+this._nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1]))}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML,this.osiNameHTML]}}class c extends o{get _txtAnchor(){return"end"}get _osiNameDX(){return-13}}class d extends o{get _txtAnchor(){return"start"}get _osiNameDX(){return 13}}class _ extends a{constructor(t,e){e.transfer.info[0].unshift(...e.transfer.info[1].slice(0,2)),super(t,e),this._osiNames=e.transfer.osi_names[0],this._osiType=e.transfer.paid_area?"p":"u"}get osiClass(){return"u"==this._osiType?"rmg-stn__mtr--unpaid-osi":"rmg-stn__mtr--paid-osi"}get iconHTML(){var t=this.namePos?180:0;return $("<use>",{"xlink:href":"#osi12_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _dy(){return this.namePos?-8:8}get _osiDY(){return this.namePos?-70.6875:62.34375}get _osiTxtAnchor(){return"middle"}get _osiDX(){return 0}get osiNameHTML(){var t=-1==this.state?"Pass":"Future";return $("<g>",{"text-anchor":this._osiTxtAnchor,transform:`translate(${this.x+this._dx+this._osiDX},${this.y+this._osiDY})`,class:`Name ${t}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1].split("\\")[0]).append($("<tspan>",{x:0,dy:10}).text(this._osiNames[1].split("\\")[1]||"")))}get ungrpHTML(){return[...this.intTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.osiNameHTML]}}class g extends _{get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}}class u extends _{get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}}class f extends _{constructor(t,e){super(t,e),this._origIntInfo=e.transfer.info[0][2]}get _nameTxtAnchor(){return this._osiTxtAnchor}get _nameDY(){return this.namePos?11.515625:-11.515625}get origIntTickHTML(){var t=this.namePos?0:180,e=this._origIntInfo[n.b.colour],s=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&s.addClass("rmg-line__pass"),s}get origIntNameHTML(){var[t,e,s]=Object(n.k)([this._origIntInfo[n.b.nameZH],this._origIntInfo[n.b.nameEN]],10,7),i=this.namePos?30.953125:-37.703125-13*(e-1)-7*(s-1);return $("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x-this._nameDX},${this.y+i})`,class:`Name ${this._nameClass}`}).html(t[0])}get _osiNameDX(){return 0}get osiNameHTML(){var t=this._dy-(this.namePos?27:-27)+8.34375-12.515625;return $("<g>",{"text-anchor":this._osiTxtAnchor,transform:`translate(${this.x+this._osiNameDX},${this.y+t})`,class:"Name "+this._nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1]))}get ungrpHTML(){return[...this.intTickHTML,this.origIntTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.origIntNameHTML,this.osiNameHTML]}}class p extends f{get _nameDX(){return 3}get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}get _osiNameDX(){return 13}get _osiTxtAnchor(){return"start"}}class m extends f{get _nameDX(){return-3}get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}get _osiNameDX(){return-13}get _osiTxtAnchor(){return"end"}}class b extends _{constructor(t,e){super(t,e),[this._origIntCity,this._origIntLine,this._origIntColour,this._origIntFg,this._origIntNameZH,this._origIntNameEN]=e.transfer.info[0][2]}get origIntTickHTML(){var t=this.namePos?180:0,e=this._origIntColour,s=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&s.addClass("rmg-line__pass"),s}get origIntNameHTML(){var[t,e,s]=Object(n.k)([this._origIntNameZH,this._origIntNameEN],10,7),i=this.namePos?-37.703125-13*(e-1)-7*(s-1):30.953125;return $("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+i})`,class:`Name ${this._nameClass}`}).html(t[0])}get iconHTML(){var t=this.namePos?1:-1,e="lineend"==this.children[0]?1:-1;this.children[0];return $("<use>",{"xlink:href":"#osi22end_hk",transform:`translate(${this.x},${this.y})scale(${e},${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _tickRotation(){return"lineend"==this.children[0]?-90:90}get _tickFlip(){return-1}get _dx(){return"lineend"==this.children[0]?41:-41}get _dy(){return this.namePos?18:-18}get _intNameDX(){return"lineend"==this.children[0]?65:-65}get _txtAnchor(){return"lineend"==this.children[0]?"start":"end"}get _osiDY(){return this.namePos?-26.6875:18.34375}get _osiTxtAnchor(){return"lineend"==this.children[0]?"start":"end"}get _osiDX(){return"lineend"==this.children[0]?-9:9}get ungrpHTML(){return[...this.intTickHTML,this.origIntTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.origIntNameHTML,this.osiNameHTML]}}},function(t,e){t.exports=mdc.list},function(t,e){t.exports=mdc.tabBar},,function(t,e,s){"use strict";s.r(e);var n=s(0),i=s(4),r=s(2),a=s(6),h=s(3);var l=s(1),o=function(t,e,s,n){return new(s||(s=Promise))((function(i,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function h(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,h)}l((n=n.apply(t,e||[])).next())}))};var c=s(7);switch((window.urlParams.get("lang")||localStorage.rmgLang||navigator.language.split("-").slice(0,2).join("-")).toLowerCase()){case"zh-cn":case"zh-hans":window.urlParams.set("lang","zh-Hans");break;case"zh":case"zh-hk":case"zh-tw":window.urlParams.set("lang","zh-HK");break;default:window.urlParams.set("lang","en")}switch(window.urlParams.get("style")){case"mtr":case"gzmtr":case"shmetro":break;default:window.urlParams.set("style","mtr")}history.pushState({url:window.location.href},null,"?"+window.urlParams.toString()),l("head").append(...["share","destination","railmap"].map(t=>l("<link>",{rel:"stylesheet",href:`styles/${t}_${window.urlParams.get("style")}.css`,id:`css_${t}`}))),window.myLine=null,l(`[${window.urlParams.get("style")}-specific]`).show(),function(){const[t,e,s,l,o,c]=["#template_diag","#import_diag","#export_diag","#preview_diag","#style_diag","#lang_diag"].map(t=>r.MDCDialog.attachTo($(t)[0])),[d,_]=$("#panel_save .mdc-list").map((t,e)=>a.MDCList.attachTo(e)).get();$("#panel_save .mdc-list li").map((t,e)=>new h.MDCRipple(e)),d.listen("MDCList:action",e=>{switch(e.detail.index){case 0:t.open();break;case 1:$("#upload_file").click();break;case 2:$("<a>",{href:"data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),download:"rmg_param.json"})[0].click();break;case 3:s.open()}}),$("#panel_save .mdc-list:nth-child(2) li:first-child span:nth-child(2) span:last-child").attr("trans-tag",$(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).attr("trans-tag")).text($(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).text()),$("#panel_save .mdc-list:nth-child(2) li:nth-child(2) span:nth-child(2) span:last-child").text($(`#lang_diag [data-mdc-dialog-action="${window.urlParams.get("lang")}"] span`).text()),_.listen("MDCList:action",t=>{switch(t.detail.index){case 0:o.open();break;case 1:c.open()}}),$.getJSON("templates/template_list.json",t=>{var e=window.urlParams.get("lang");t.forEach(t=>{$("#template_diag ul").append($("<li>",{class:"mdc-list-item","data-mdc-dialog-action":t.filename}).append($("<span>",{class:"mdc-list-item__text"}).text(Object(n.i)(t.desc,e))))}),$("#template_diag li:first-child").attr("tabindex",0),$("#theme_line__selection li").map((t,e)=>new h.MDCRipple(e))}),t.listen("MDCDialog:closed",t=>{"close"!=t.detail.action&&$.getJSON(`templates/${t.detail.action}.json`,t=>{localStorage.rmgParam=JSON.stringify(t),location.reload(!0)})}),s.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":break;case"svg1":$("#preview_diag").attr("for","destination"),l.open();break;case"svg2":$("#preview_diag").attr("for","railmap"),l.open()}}),$(window).on("resize",t=>{g()});const g=()=>{var t=$("preview_diag").attr("for"),[e,s]=["destination"==t?Object(n.g)().svg_dest_width:Object(n.g)().svg_width,Object(n.g)().svg_height],i=$(window).width()-32-50,r=$(window).height()-60-53-60,a=Math.min(i/e,r/s);$("#preview_diag").find("svg").attr({width:e*a,height:s*a}),$("#preview_diag").find(".mdc-dialog__surface").attr("style",`max-width:${i+50}px;`)};let u;l.listen("MDCDialog:opened",t=>{var e=$(t.target).attr("for"),[s,i]=["destination"==e?Object(n.g)().svg_dest_width:Object(n.g)().svg_width,Object(n.g)().svg_height];$("#preview_diag .mdc-dialog__surface").attr("style",`max-width:${$(window).width()-32}px;`);var r=$(window).width()-32-50,a=$(window).height()-60-53-60,h=Math.min(r/s,a/i);$(t.target).find(".mdc-dialog__content").append($("#"+$(t.target).attr("for")).clone().attr({style:"all:initial;",viewBox:`0 0 ${s} ${i}`,width:s*h,height:i*h}));let l=["share",$(t.target).find("svg")[0].id].map(t=>Array.from($(`link#css_${t}`)[0].sheet.cssRules).map(t=>t.cssText).join(" "));$(t.target).find("svg").prepend(...l.map(t=>$("<style>").text(t))),$(t.target).find('svg [style="display: none;"]').remove()}),l.listen("MDCDialog:closed",t=>{if("close"!==t.detail.action){if("png"===t.detail.action)return Object(n.o)($(t.target).removeAttr("for").find("svg")),void $(t.target).find(".mdc-dialog__content").empty();if("svg"===t.detail.action){let s=$(t.target).find(".mdc-dialog__content svg");var e=document.createElement("a");e.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s[0].outerHTML))),e.download="rmg_export.svg",e.click(),$(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}}else $(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}),$("#upload_file").on("change",t=>{console.log(t.target.files[0]);let s=new FileReader;s.onload=function(t){console.log(t.target),u=JSON.parse(t.target.result),$("#import_diag").find(".mdc-dialog__content").html(Object(n.e)(u)),e.open()},s.readAsText(t.target.files[0])}),e.listen("MDCDialog:closed",t=>{"close"!=t.detail.action?(i.a.clearSVG(),localStorage.rmgParam=JSON.stringify(u),location.reload(!0)):$("#upload_file")[0].value=""}),o.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":case window.urlParams.get("style"):return;default:window.urlParams.set("style",t.detail.action),window.location.href="?"+window.urlParams.toString()}}),c.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=t.detail.action;localStorage.rmgLang=e,e!=window.urlParams.get("lang")&&(window.urlParams.set("lang",e),window.location.href="?"+window.urlParams.toString())}})}(),function(){const t=t=>o(this,void 0,void 0,(function*(){let e=yield(n=window.urlParams.get("style"),o(void 0,void 0,void 0,(function*(){switch(n){case"mtr":return s.e(1).then(s.bind(null,15)).then(({RMGLineHK:t})=>t);case"gzmtr":return s.e(0).then(s.bind(null,21)).then(({RMGLineGZ:t})=>t);case"shmetro":return s.e(2).then(s.bind(null,22)).then(({RMGLineSH:t})=>t)}})));var n;window.myLine=yield new e(t),e.initSVG(window.myLine)}));if(null!=localStorage.rmgParam)try{Object(n.p)(),t(Object(n.g)())}catch(t){let e=r.MDCDialog.attachTo($("#init_err_diag")[0]);$("#init_err_diag").find("#err_stack").html(t+"<br>"+t.stack.replace(/\n/g,"<br>")),e.open(),console.error(t)}else $.getJSON("templates/blank.json",e=>{localStorage.rmgParam=JSON.stringify(e),Object(n.p)(),t(Object(n.g)())})}(),function(){let t=[!1,!0,!0,!0,!0];window.sliders=[],c.MDCTabBar.attachTo($("#panels .mdc-tab-bar")[0]).listen("MDCTabBar:activated",e=>{$(".panel--active").removeClass("panel--active"),$(".panel").eq(e.detail.index).addClass("panel--active"),1==e.detail.index&&t[1]&&s.e(6).then(s.bind(null,16)).then(e=>{e.common(),"gzmtr"===window.urlParams.get("style")&&e.gzmtr(),t[1]=!1}),1===e.detail.index&&window.sliders.forEach(t=>t.layout()),2==e.detail.index&&t[2]&&s.e(4).then(s.bind(null,17)).then(e=>{switch(e.common(),window.urlParams.get("style")){case"mtr":e.mtr();break;case"gzmtr":e.gzmtr()}t[2]=!1}),3==e.detail.index&&t[3]&&Promise.all([s.e(9),s.e(7)]).then(s.bind(null,18)).then(e=>{e.common(),t[3]=!1}),4==e.detail.index&&t[4]&&s.e(5).then(s.bind(null,19)).then(e=>{e.common(),t[4]=!1})})}()},function(t,e){t.exports=mdc.textField},function(t,e){t.exports=mdc.select},function(t,e){t.exports=mdc.switchControl},function(t,e){t.exports=mdc.slider}]);