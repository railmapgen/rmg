!function(t){function e(e){for(var n,s,a=e[0],r=e[1],l=0,h=[];l<a.length;l++)s=a[l],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&h.push(i[s][0]),i[s]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);for(o&&o(e);h.length;)h.shift()()}var n={},i={2:0};function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var a=new Promise((function(e,s){n=i[t]=[e,s]}));e.push(n[2]=a);var r,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=function(t){return s.p+""+({0:"LineGZ",1:"LineSH"}[t]||t)+".min.js"}(t);var o=new Error;r=function(e){l.onerror=l.onload=null,clearTimeout(h);var n=i[t];if(0!==n){if(n){var s=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,n[1](o)}i[t]=void 0}};var h=setTimeout((function(){r({type:"timeout",target:l})}),12e4);l.onerror=l.onload=r,document.head.appendChild(l)}return Promise.all(e)},s.m=t,s.c=n,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="./dist/",s.oe=function(t){throw console.error(t),t};var a=window.webpackJsonp=window.webpackJsonp||[],r=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var o=r;s(s.s=14)}([function(t,e,n){"use strict";var i,s,a;function r(t){localStorage.setItem("rmgParam",JSON.stringify(t))}function l(){return JSON.parse(localStorage.rmgParam)}function o(t,e){let n=l();n[t]=e,r(n)}function h(t){var[e,n]=t.attr("viewBox").split(" ").slice(2),i=$("canvas")[0];$("canvas").attr({width:2.5*e,height:2.5*n});var s=i.getContext("2d");s.clearRect(0,0,i.width,i.height),t.find(".rmg-name__en.rmg-name__gzmtr--station, .rmg-name__en.rmg-name__mtr--station, .rmg-name__zh.IntName").each((t,e)=>{$(e).attr("font-size","10px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int").each((t,e)=>{$(e).attr("font-size","8px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int-small, .rmg-name__en.IntName").each((t,e)=>{$(e).attr("font-size","7px")}),t.find("text:not([font-size]), tspan:not([font-size])").each((t,e)=>{$(e).attr("font-size",window.getComputedStyle(e).fontSize)}),t.find("text, tspan").each((t,e)=>{var n=window.getComputedStyle(e);$(e).attr({"font-family":n.getPropertyValue("font-family"),fill:n.getPropertyValue("fill"),"alignment-baseline":n.getPropertyValue("alignment-baseline"),"dominant-baseline":n.getPropertyValue("dominant-baseline"),"text-anchor":n.getPropertyValue("text-anchor")}).removeAttr("class")}),t.find("#strip, #dest_strip").each((t,e)=>{var n=window.getComputedStyle(e);$(e).attr({"stroke-width":n.getPropertyValue("stroke-width")})});var a=new Image;a.onload=function(){var t,i,r;s.drawImage(a,0,0,2.5*e,2.5*n),t=$("canvas")[0].toDataURL("image/png"),i="rmg_export","string"==typeof(r=document.createElement("a")).download?(r.href=t,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(t)},a.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t[0].outerHTML)))}function c(t,e){let n=$("#"+e)[0],i=t.getBoundingClientRect(),s=n.createSVGPoint(),a=n.getScreenCTM();s.x=i.left,s.y=i.top;let r=s.matrixTransform(a.inverse());return{x:r.x,y:r.y,width:i.width,height:i.height}}function d(t,e,n){var[i,s]=t.map(t=>t.split(/\\/g)),a=$("<text>").addClass("rmg-name__zh IntName").text(i[0]);for(let t=1;t<i.length;t++)a=a.append($("<tspan>",{x:0,dy:e,"dominant-baseline":"central"}).text(i[t]));var r=(i.length,9);a=a.append($("<tspan>",{x:0,dy:r,class:"rmg-name__en IntName"}).text(s[0]));for(let t=1;t<s.length;t++)a=a.append($("<tspan>",{x:0,dy:n,class:"rmg-name__en IntName"}).text(s[t]));return[a,i.length,s.length]}function _(t,e){let n=t[a.colour],i=t[a.fg],s=[t[a.nameZH],t[a.nameEN]],r=s[0].match(/[\d]+|[\D]+/g)||[""],l=!1;2==r.length&&!isNaN(Number(r[0]))&&isNaN(Number(r[1]))&&(l=!0);let o=$("<g>").append($("<use>",{"xlink:href":"#intbox_gz",fill:-1===e?"#aaa":n})).append($("<text>",{y:8.5,class:"rmg-name__zh rmg-name__gzmtr--int"}).append($("<tspan>",{"font-size":"16px","dominant-baseline":"central"}).text(l?r[0]:"")).append($("<tspan>",{dy:-1,"dominant-baseline":"central"}).text(l?r[1]:r.join("")))).append($("<text>",{y:19.5,class:"rmg-name__en"}).addClass(s[1].length>10?"rmg-name__gzmtr--int-small":"rmg-name__gzmtr--int").text(s[1]));return"#fff"!==i&&-1!==e||$(o).find("text").addClass("rmg-name__gzmtr--white-fg"),o}function g(){return Math.floor(Math.random()*Math.pow(36,4)).toString(36).padStart(4,"0")}function m(t){let e=["ç™¸","ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","æ—¥","æœˆ","é‡‘","æœ¨","æ°´","ç«","åœŸ","ç«¹","æˆˆ","å","å¤§","ä¸­","ä¸€","å¼“","äºº","å¿ƒ","æ‰‹","å£","å°¸","å»¿","å±±","å¥³","ç”°","é›£","åœ","é‡"],n=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Alfa","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliett","Kilo","Lima","Mike","November","Oscar","Papa","Quebec","Romeo","Sierra","Tango","Uniform","Victor","Whiskey","X-ray","Yankee","Zulu"];return[t.split("").map(t=>e[parseInt(t,36)]).join(""),t.split("").map(t=>n[parseInt(t,36)]).join(" ")]}function u(t){return`Number of stations: ${Object.keys(t.stn_list).length-2}\n            ${Object.entries(t.stn_list).map(t=>["linestart","lineend"].includes(t[0])?"":t[1].name.join(" - ")).join("<br>").trim().replace(/\\/," ")}`}function p(t){var e=t.toUpperCase().split("");return 2==t.length?e.map(t=>String.fromCodePoint(t.codePointAt(0)+127397)).join(""):"ðŸ´"+e.map(t=>String.fromCodePoint(t.codePointAt(0)+917536)).join("")+"ó ¿"}function f(t){let e=t.match(/[\d]+/g).map(t=>Number(t).toString(16).padStart(2,"0")).join("");switch(e){case"000000":return"#000";case"ffffff":return"#fff";default:return"#"+e}}function w(){var t=l();"line_name"in t||(t.line_name=["è·¯ç·šå","Name of Line"]),"dest_legacy"in t||(t.dest_legacy=!1),"char_form"in t||(t.char_form=(t=>{switch(t){case"KR":return"trad";case"TC":return"tw";case"SC":return"cn";case"JP":return"jp"}})(t.fontZH[0].split(" ").reverse()[0])),delete t.fontZH,delete t.fontEN,delete t.weightZH,delete t.weightEN;for(let[e,n]of Object.entries(t.stn_list))"branch"in n||(t.stn_list[e].branch={left:[],right:[]},2==n.children.length?t.stn_list[e].branch.right=["through",n.children[1]]:t.stn_list[e].branch.right=[],2==n.parents.length?t.stn_list[e].branch.left=["through",n.parents[1]]:t.stn_list[e].branch.left=[]);"psd_num"in t||(t.psd_num=1),"line_num"in t||(t.line_num=1),delete t.style,3==t.theme.length&&t.theme.push("#fff");for(let[e,n]of Object.entries(t.stn_list))["linestart","lineend"].includes(e)||"num"in n||(t.stn_list[e].num="00");for(let[e,n]of Object.entries(t.stn_list))"interchange"in n&&n.interchange.map(t=>{t.map(t=>{5==t.length&&t.splice(3,0,"#fff")})});"info_panel_type"in t||(t.info_panel_type="panasonic");for(let[e,n]of Object.entries(t.stn_list))"osi22_end_p"===n.change_type&&(t.stn_list[e].change_type="osi22_pr"),"osi22_end_u"===n.change_type&&(t.stn_list[e].change_type="osi22_ur");for(let[e,n]of Object.entries(t.stn_list))"interchange"in n||(t.stn_list[e].interchange=[[]]);"gz_1"===t.info_panel_type&&(t.info_panel_type="gz28"),"panasonic"===t.info_panel_type&&(t.info_panel_type="gz28"),"gz_2"===t.info_panel_type&&(t.info_panel_type="gzgf"),"gz_3"===t.info_panel_type&&(t.info_panel_type="gz3"),"direction_gz_x"in t||(t.direction_gz_x=50),"direction_gz_y"in t||(t.direction_gz_y=70);for(let[e,n]of Object.entries(t.stn_list))"transfer"in t||(t.stn_list[e].transfer={type:n.change_type.split("_")[0],tick_direc:"none"===n.change_type||"int2"===n.change_type?"r":n.change_type.split("_")[1].split("").slice().reverse()[0],paid_area:-1===n.change_type.indexOf("osi")||"p"===n.change_type.split("_")[1][0],osi_names:-1!==n.change_type.indexOf("osi")?[n.interchange[1][0]]:[],info:2===n.interchange.length?[n.interchange[0],n.interchange[1].slice(1)]:n.interchange});r(t)}n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return a})),n.d(e,"m",(function(){return r})),n.d(e,"h",(function(){return l})),n.d(e,"o",(function(){return o})),n.d(e,"p",(function(){return h})),n.d(e,"k",(function(){return c})),n.d(e,"l",(function(){return d})),n.d(e,"f",(function(){return _})),n.d(e,"i",(function(){return g})),n.d(e,"g",(function(){return m})),n.d(e,"e",(function(){return u})),n.d(e,"d",(function(){return p})),n.d(e,"n",(function(){return f})),n.d(e,"q",(function(){return w})),n.d(e,"j",(function(){return b})),function(t){t[t.left=0]="left",t[t.right=1]="right"}(i||(i={})),function(t){t[t.parents=0]="parents",t[t.children=1]="children"}(s||(s={})),function(t){t[t.city=0]="city",t[t.line=1]="line",t[t.colour=2]="colour",t[t.fg=3]="fg",t[t.nameZH=4]="nameZH",t[t.nameEN=5]="nameEN"}(a||(a={}));const b=(t,e)=>t[(t=>{switch(t){case"en":return["en"];case"zh-Hans":return["zh-Hans","zh","en"];case"zh-HK":return["zh-HK","zh-Hant","zh","en"];default:return[t,"en"]}})(e).find(e=>t[e])]},function(t,e,n){"use strict";n.d(e,"l",(function(){return s})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return l})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return c})),n.d(e,"e",(function(){return d})),n.d(e,"f",(function(){return g})),n.d(e,"g",(function(){return m})),n.d(e,"k",(function(){return u})),n.d(e,"i",(function(){return p})),n.d(e,"j",(function(){return f})),n.d(e,"h",(function(){return w}));var i=n(0);class s{constructor(t,e){this.STN_NAME_Y=-10.5,this.STN_NAME_BASE_HEIGHT=30.390625,this.STN_NAME_LINE_GAP=14,this.STN_NAME_BG_ADJUST=.5,this.id=t,this.parents=e.parents,this.children=e.children,this.name=e.name,this.branch=e.branch}get inDegree(){return this.parents.length}get outDegree(){return this.children.length}get nameClass(){switch(this.state){case-1:return"Pass";case 0:return"Current";default:return"Future"}}get _nameTxtAnchor(){return"middle"}get _nameDX(){return 0}get _nameDY(){return 0}get nameHTML(){var t=this.name[1].split("\\");if(this.namePos)var e=this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BG_ADJUST;else e=-this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BASE_HEIGHT-10*(t.length-1);0===this.state&&$("#current_bg").attr({y:this.y+e+this.STN_NAME_Y-1.5+this._nameDY,height:this.STN_NAME_BASE_HEIGHT+10*(t.length-1)+2+1.5});for(var n=t.shift(),i=$("<text>",{dy:15,class:"rmg-name__en rmg-name__mtr--station"}).text(n);n=t.shift();)i.append($("<tspan>",{x:0,dy:10,"alignment-baseline":"middle"}).text(n));return $("<g>",{transform:`translate(${this.x+this._nameDX},${this.y+e+this._nameDY})`,"text-anchor":this._nameTxtAnchor,class:`Name ${this.nameClass}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--station").text(this.name[0])).append(i)}get iconClass(){return-1==this.state?"rmg-stn__mtr--pass":"rmg-stn__mtr--future"}get iconHTML(){return $("<use>",{"xlink:href":"#stn_hk",x:this.x,y:this.y,class:this.iconClass})}get ungrpHTML(){return[this.iconHTML,this.nameHTML]}get html(){return $("<g>",{id:this.id}).append(...this.ungrpHTML)}}class a extends s{constructor(t,e){super(t,e),this._intInfo=e.interchange[0][0]}get _dy(){return 0}get intTickHTML(){var t=this.namePos?180:0,e=this._intInfo[i.b.colour],n=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y+this._dy})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&n.addClass("rmg-line__pass"),n}get _nameClass(){return-1==this.state?"Pass":"Future"}get intNameHTML(){var[t,e,n]=Object(i.l)([this._intInfo[i.b.nameZH],this._intInfo[i.b.nameEN]],10,7),s=this.namePos?-37.703125-13*(e-1)-7*(n-1):30.953125;return s+=this._dy,$("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+s})`,class:`Name ${this._nameClass}`}).html(t[0])}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML]}}class r extends s{constructor(t,e){super(t,e),this._intCity=[],this._intLine=[],this._intColour=[],this._intNameZH=[],this._intNameEN=[],this._intInfos=e.interchange[0],e.interchange[0].forEach(t=>{this._intCity.push(t[0]),this._intLine.push(t[1]),this._intColour.push(t[2]),this._intNameZH.push(t[4]),this._intNameEN.push(t[5])})}get iconHTML(){let t=this.namePos?180:0;return $("<use>",{"xlink:href":"#int3_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:this.iconClass})}get _tickRotation(){return 0}get _dy(){return 0}get _dx(){return 0}get _tickFlip(){return 1}get intTickHTML(){let t=[];return this._intInfos.map(t=>t[i.b.colour]).forEach((e,n)=>{if(n>=2)return;let i=-1===this.state?"#aaa":e,s=this.namePos?-18*(2-n):18*(n+1);s+=this._dy,s*=this._tickFlip,t.push($("<use>",{"xlink:href":"#inttick_hk",stroke:i,transform:`translate(${this.x+this._dx},${this.y+s})rotate(${this._tickRotation})`,class:"rmg-line rmg-line__mtr rmg-line__change"}))}),t}get _txtAnchor(){return"middle"}get _intNameDX(){return 0}get _nameClass(){return-1==this.state?"Pass":"Future"}get intNameHTML(){let t=[],e=this._nameClass;return this._intInfos.map(t=>[t[i.b.nameZH],t[i.b.nameEN]]).forEach((n,s)=>{if(s>=2)return;let[a,r,l]=Object(i.l)(n,10,7);var o=this.namePos?-18*(2-s):18*(s+1);o+=this._dy,o*=this._tickFlip,o+=5.953125-(19.65625+13*(r-1)+7*(l-1))/2,t.push($("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x+this._intNameDX},${this.y+o})`,class:"Name "+e}).html(a[0]))}),t}get ungrpHTML(){return[...this.intTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML]}}class l extends r{get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}}class o extends r{get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}}class h extends a{constructor(t,e){e.interchange[0].push(e.interchange[1][1]),super(t,e),this._osiNames=e.interchange[1][0],this._osiType=e.change_type.substring(6,7)}get osiClass(){return"u"==this._osiType?"rmg-stn__mtr--unpaid-osi":"rmg-stn__mtr--paid-osi"}get iconHTML(){var t=this.namePos?180:0;return $("<use>",{"xlink:href":"#osi11_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _dy(){return this.namePos?-26:26}get _txtAnchor(){return"middle"}get _osiNameDX(){return 0}get osiNameHTML(){var t=this._dy+8.34375-12.515625;return $("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x+this._osiNameDX},${this.y+t})`,class:"Name "+this._nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1]))}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML,this.osiNameHTML]}}class c extends h{get _txtAnchor(){return"end"}get _osiNameDX(){return-13}}class d extends h{get _txtAnchor(){return"start"}get _osiNameDX(){return 13}}class _ extends r{constructor(t,e){e.interchange[0].unshift(...e.interchange[1].slice(1,3)),super(t,e),this._osiNames=e.interchange[1][0],this._osiType=e.change_type.split("_").reverse()[0][0]}get osiClass(){return"u"==this._osiType?"rmg-stn__mtr--unpaid-osi":"rmg-stn__mtr--paid-osi"}get iconHTML(){var t=this.namePos?180:0;return $("<use>",{"xlink:href":"#osi12_hk",transform:`translate(${this.x},${this.y})rotate(${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _dy(){return this.namePos?-8:8}get _osiDY(){return this.namePos?-70.6875:62.34375}get _osiTxtAnchor(){return"middle"}get _osiDX(){return 0}get osiNameHTML(){var t=-1==this.state?"Pass":"Future";return $("<g>",{"text-anchor":this._osiTxtAnchor,transform:`translate(${this.x+this._dx+this._osiDX},${this.y+this._osiDY})`,class:`Name ${t}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1].split("\\")[0]).append($("<tspan>",{x:0,dy:10}).text(this._osiNames[1].split("\\")[1]||"")))}get ungrpHTML(){return[...this.intTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.osiNameHTML]}}class g extends _{get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}}class m extends _{get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}}class u extends _{constructor(t,e){super(t,e),this._origIntInfo=e.interchange[0][2]}get _nameTxtAnchor(){return this._osiTxtAnchor}get _nameDY(){return this.namePos?11.515625:-11.515625}get origIntTickHTML(){var t=this.namePos?0:180,e=this._origIntInfo[i.b.colour],n=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&n.addClass("rmg-line__pass"),n}get origIntNameHTML(){var[t,e,n]=Object(i.l)([this._origIntInfo[i.b.nameZH],this._origIntInfo[i.b.nameEN]],10,7),s=this.namePos?30.953125:-37.703125-13*(e-1)-7*(n-1);return $("<g>",{"text-anchor":this._txtAnchor,transform:`translate(${this.x-this._nameDX},${this.y+s})`,class:`Name ${this._nameClass}`}).html(t[0])}get _osiNameDX(){return 0}get osiNameHTML(){var t=this._dy-(this.namePos?27:-27)+8.34375-12.515625;return $("<g>",{"text-anchor":this._osiTxtAnchor,transform:`translate(${this.x+this._osiNameDX},${this.y+t})`,class:"Name "+this._nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--osi").text(this._osiNames[0])).append($("<text>",{x:0,dy:12,class:"rmg-name__en rmg-name__mtr--osi"}).text(this._osiNames[1]))}get ungrpHTML(){return[...this.intTickHTML,this.origIntTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.origIntNameHTML,this.osiNameHTML]}}class p extends u{get _nameDX(){return 3}get _tickRotation(){return 90}get _txtAnchor(){return"end"}get _intNameDX(){return-24}get _osiNameDX(){return 13}get _osiTxtAnchor(){return"start"}}class f extends u{get _nameDX(){return-3}get _tickRotation(){return-90}get _txtAnchor(){return"start"}get _intNameDX(){return 24}get _osiNameDX(){return-13}get _osiTxtAnchor(){return"end"}}class w extends _{constructor(t,e){super(t,e),[this._origIntCity,this._origIntLine,this._origIntColour,this._origIntFg,this._origIntNameZH,this._origIntNameEN]=e.interchange[0][2]}get origIntTickHTML(){var t=this.namePos?180:0,e=this._origIntColour,n=$("<use>",{"xlink:href":"#inttick_hk",stroke:e,transform:`translate(${this.x},${this.y})rotate(${t})`,class:"rmg-line rmg-line__mtr rmg-line__change"});return-1==this.state&&n.addClass("rmg-line__pass"),n}get origIntNameHTML(){var[t,e,n]=Object(i.l)([this._origIntNameZH,this._origIntNameEN],10,7),s=this.namePos?-37.703125-13*(e-1)-7*(n-1):30.953125;return $("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+s})`,class:`Name ${this._nameClass}`}).html(t[0])}get iconHTML(){var t=this.namePos?1:-1,e="lineend"==this.children[0]?1:-1;this.children[0];return $("<use>",{"xlink:href":"#osi22end_hk",transform:`translate(${this.x},${this.y})scale(${e},${t})`,class:[this.iconClass,this.osiClass].join(" ")})}get _tickRotation(){return"lineend"==this.children[0]?-90:90}get _tickFlip(){return-1}get _dx(){return"lineend"==this.children[0]?41:-41}get _dy(){return this.namePos?18:-18}get _intNameDX(){return"lineend"==this.children[0]?65:-65}get _txtAnchor(){return"lineend"==this.children[0]?"start":"end"}get _osiDY(){return this.namePos?-26.6875:18.34375}get _osiTxtAnchor(){return"lineend"==this.children[0]?"start":"end"}get _osiDX(){return"lineend"==this.children[0]?-9:9}get ungrpHTML(){return[...this.intTickHTML,this.origIntTickHTML,this.iconHTML,this.nameHTML,...this.intNameHTML,this.origIntNameHTML,this.osiNameHTML]}}},function(t,e){t.exports=mdc.textField},function(t,e){t.exports=mdc.dialog},function(t,e){t.exports=jQuery},function(t,e){t.exports=mdc.ripple},function(t,e){t.exports=mdc.select},function(t,e){t.exports=mdc.list},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),s=n(1);class a{constructor(t){this._longInterval=1,this.stations={},this._svgHeight=t.svg_height,this._svgWidth=t.svg_width,this._svgDestWidth=t.svg_dest_width,this._showOuter=t.show_outer,[this.themeCity,this.themeLine,this._themeColour,this._fgColour]=t.theme,this.yPc=t.y_pc,this._padding=t.padding,this._stripPc=t.strip_pc,this._branchSpacing=t.branch_spacing,this._txtFlip=t.txt_flip,this._lineNames=t.line_name;for(let[e,n]of Object.entries(t.stn_list))this.stations[e]=this._initStnInstance(e,n);this._currentStnId=t.current_stn_idx,this._direction=t.direction,this._platformNum=t.platform_num,this._destLegacy=t.dest_legacy,this._charForm=t.char_form;for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t))}_initStnInstance(t,e){switch(e.change_type){case"int2":return new s.a(t,e);case"int3_l":return new s.b(t,e);case"int3_r":return new s.c(t,e);case"osi11_ul":case"osi11_pl":return new s.d(t,e);case"osi11_ur":case"osi11_pr":return new s.e(t,e);case"osi12_ul":case"osi12_pl":return new s.f(t,e);case"osi12_ur":case"osi12_pr":return new s.g(t,e);case"osi22_pl":case"osi22_ul":return"linestart"==e.parents[0]||"lineend"==e.children[0]?new s.h(t,e):new s.i(t,e);case"osi22_pr":case"osi22_ur":return"linestart"==e.parents[0]||"lineend"==e.children[0]?new s.h(t,e):new s.j(t,e);default:return new s.l(t,e)}}set svgDestWidth(t){isNaN(t)||t<=0||(this._svgDestWidth=t,Object(i.o)("svg_dest_width",t),this.drawSVGFrame(),this.drawStrip(),this.drawDestInfo(),this.loadFonts())}set svgWidth(t){if(!(isNaN(t)||t<=0)){this._svgWidth=t,Object(i.o)("svg_width",t),this.drawSVGFrame();for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.loadFonts(),this.updateStnNameBg()}}set yPc(t){this._yPc=t,Object(i.o)("y_pc",t);let e=t*this._svgHeight/100;$("g#main").attr("transform",`translate(0,${e})`)}set padding(t){t=Number(t),this._padding=t,Object(i.o)("padding",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.loadFonts(),this.updateStnNameBg()}set branchSpacing(t){this._branchSpacing=t,Object(i.o)("branch_spacing",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.loadFonts(),this.updateStnNameBg()}set txtFlip(t){this._txtFlip=t,Object(i.o)("txt_flip",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t));$("#stn_icons").empty(),this.drawStns(),this.loadFonts(),this.updateStnNameBg()}set themeColour(t){this._themeColour=t[0],this._fgColour=t[1];var e=Object(i.h)();e.theme[2]=t[0],e.theme[3]=t[1],Object(i.m)(e),this.fillThemeColour()}set direction(t){this._direction=t,Object(i.o)("direction",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts()}set platformNum(t){this._platformNum=t,Object(i.o)("platform_num",t),$(".rmg-name__platformnum").text(t)}set charForm(t){this._charForm=t,Object(i.o)("char_form",t),$(".rmg-name__char-trad, .rmg-name__char-cn, .rmg-name__char-tw, .rmg-name__char-jp").removeClass("rmg-name__char-trad rmg-name__char-cn rmg-name__char-tw rmg-name__char-jp").addClass(`rmg-name__char-${t}`)}set lineNames(t){this._lineNames=t,Object(i.o)("line_name",t),this.drawDestInfo(),this.loadFonts()}set destLegacy(t){this._destLegacy=t,Object(i.o)("dest_legacy",t),this.drawDestInfo(),this.loadFonts()}set currentStnId(t){this._currentStnId=t,Object(i.o)("current_stn_idx",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts(),this.updateStnNameBg()}_rightWideFactor(t){var e=0;let n=this.stations[t];n instanceof s.c&&(e+=this._longInterval),n instanceof s.e&&(e+=this._longInterval),n instanceof s.g&&(e+=this._longInterval),n instanceof s.k&&(e+=this._longInterval);return["Int3RStation","OSI11RStation","OSI12RStation","OSI22LStation","OSI22RStation"].includes(this.stations[t].constructor.name)&&(e+=this._longInterval),2==this._stnOutdegree(t)&&(e+=this._longInterval/2),2==this._stnIndegree(this.stations[t].children[0])&&(e+=this._longInterval/2),e}_leftWideFactor(t){var e=0;let n=this.stations[t];return n instanceof s.b&&(e+=this._longInterval),n instanceof s.d&&(e+=this._longInterval),n instanceof s.f&&(e+=this._longInterval),n instanceof s.k&&(e+=this._longInterval),2==this._stnIndegree(t)&&(e+=this._longInterval/2),2==this._stnOutdegree(this.stations[t].parents[0])&&(e+=this._longInterval/2),e}_pathWeight(t,e){return this.stations[t].children.includes(e)?1+this._rightWideFactor(t)+this._leftWideFactor(e):-1/0}_cp(t,e){let n=this;if(t==e)return{len:0,nodes:[t]};let i=[],s=[];this.stations[t].children.forEach(a=>{let r=n._cp(a,e);r.len<0||(i.push(this._pathWeight(t,a)+r.len),r.nodes.unshift(t),s.push(r.nodes))});let a=Math.max(...i);return{len:a,nodes:s[i.indexOf(a)]}}get criticalPath(){let t=[],e=[];this.leftDests.forEach(n=>{this.rightDests.forEach(i=>{let s=this._cp(n,i);t.push(s.len),e.push(s.nodes)})});let n=Math.max(...t);return{len:n,nodes:e[t.indexOf(n)]}}_topoOrder(t,e=[]){var n=this;return e.push(t),this.stations[t].children.forEach(i=>{2==this._stnIndegree(i)&&0==this.stations[i].parents.indexOf(t)||e.concat(n._topoOrder(i,e))}),e}get tpo(){let t=this._topoOrder("linestart");return t.slice(1,t.length-1)}get stripY(){return this._stripPc*this._svgHeight/100}get turningRadius(){return this._branchSpacing/2*(Math.sqrt(2)/(Math.sqrt(2)-1))}get lineXs(){return[this._svgWidth*this._padding/100,this._svgWidth*(1-this._padding/100)]}get leftDests(){return this.stations.linestart.children}get rightDests(){return this.stations.lineend.parents}get lValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t)[0])))}get rValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t).reverse()[0])))}_stnIndegree(t){return this.stations[t].inDegree}_stnOutdegree(t){return this.stations[t].outDegree}_stnXShare(t){var e=this.criticalPath;if(e.nodes.includes(t))return this._cp(e.nodes[0],t).len;for(var n=t,i=t,s=!1,a=!1;;){var r=this.stations[n].parents[0];if("linestart"==r){s=!0;break}if(n=r,this._stnOutdegree(n)>1)break}for(;;){var l=this.stations[i].children;if("lineend"==l[0]){a=!0;break}if(i=l[0],this._stnIndegree(i)>1)break}var o=this._cp(n,t).len,h=this._cp(t,i).len;if(s){var c=this._cp(e.nodes[0],i).len;return this._stnXShare(i)-h/(o+h)*c}if(a)c=this._cp(n,e.nodes.slice(-1)[0]).len;else c=this._cp(n,i).len;return this._stnXShare(n)+o/(o+h)*c}_stnRealX(t){let[e,n]=this.lineXs;return e+this._stnXShare(t)/this.criticalPath.len*(n-e)}_stnYShare(t){return this._stnYShareMTR(t)}_stnYShareMTR(t){if(["linestart","lineend"].includes(t)||this._stnIndegree(t)>1||this._stnOutdegree(t)>1)return 0;var e=this.stations[t].parents[0];let n=this;return e?1==this._stnOutdegree(e)?n._stnYShareMTR(e):0==this.stations[e].children.indexOf(t)?1:-1:0}_stnRealY(t){return-this._stnYShare(t)*this._branchSpacing}_isSuccessor(t,e){for(let n of this.routes){let i=n.indexOf(t),s=n.indexOf(e);if(-1!==i&&-1!==s&&i<s)return!0}return!1}_isPredecessor(t,e){for(let n of this.routes){let i=n.indexOf(t),s=n.indexOf(e);if(-1!==i&&-1!==s&&s<i)return!0}return!1}_stnState(t){return t==this._currentStnId?0:"r"==this._direction?this._isSuccessor(this._currentStnId,t)?1:-1:this._isPredecessor(this._currentStnId,t)?1:-1}_stnNamePos(t){if("linestart"===t)return!0;let e=this,n=this.criticalPath.nodes.indexOf(t)%2;if(-1===n){let n=this.stations[t].parents[0];return 2===this._stnOutdegree(n)?e._stnNamePos(n):!e._stnNamePos(n)}return 1===n}drawSVGFrame(){$("#railmap, #outer").attr({width:this._svgWidth,height:this._svgHeight}),$("#destination, #dest_outer").attr({width:this._svgDestWidth,height:this._svgHeight})}showFrameOuter(){this._showOuter?$("#outer, #dest_outer").show():$("#outer, #dest_outer").hide()}drawStns(){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$("#stn_icons").append(e.html);$("#stn_icons").html($("#stn_icons").html())}updateStnNameBg(){var t=Object(i.k)($(`#stn_icons > #${this._currentStnId} > .Name`)[0],"railmap");$("#current_bg").attr({x:t.x-3,width:t.width+6})}get stnDX(){return this.turningRadius-this._branchSpacing/2}get stnDY(){return this._branchSpacing/2}get stnExtraH(){var[t,e]=this.lineXs;return(e-t)/this.criticalPath.len*this._longInterval}get stnSpareH(){var[t,e]=this.lineXs,n=((e-t)/this.criticalPath.len-2*this.stnDX)/2;return n<0&&console.warn(`SVG width too small! ${n}`),n}get pathTurnENE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${-this.stnDY}`}get pathTurnNEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${-this.stnDY}`}get pathTurnESE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${this.stnDY}`}get pathTurnSEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${this.stnDY}`}_linePath(t){var[e,n,i]=[],s=[],{stnExtraH:a,stnSpareH:r,pathTurnESE:l,pathTurnSEE:o,pathTurnENE:h,pathTurnNEE:c,stnDX:d}=this;return t.forEach(t=>{var[_,g]=["_stnRealX","_stnRealY"].map(e=>this[e](t));if(!n&&0!==n)return[e,i,n]=[t,_,g],void s.push(`M ${_},${g}`);g>n?(s.push(0===g?`h ${_-i-a*this._leftWideFactor(t)-r-2*d}`:`h ${a*this._rightWideFactor(e)+r}`),s.push(l,o)):g<n&&(s.push(0===g?`h ${_-i-a*this._leftWideFactor(t)-r-2*d}`:`h ${a*this._rightWideFactor(e)+r}`),s.push(h,c)),s.push(`H ${_}`),[e,i,n]=[t,_,g]}),s.join(" ").replace(/( H ([\d.]+))+/g," H $2")}drawLine(){this.branches.map(t=>{var e=t.filter(t=>this.stations[t].state>=0),n=t.filter(t=>this.stations[t].state<=0);1===e.length&&(n=t),0==e.filter(t=>-1!==n.indexOf(t)).length&&e.length&&(n[0]===t[0]?n.push(e[0]):e[0]===t[0]&&e[e.length-1]===t[t.length-1]&&n.length?(n=t,e=[]):n.unshift(e[e.length-1])),$("#line_main").append($("<path>",{d:this._linePath(e)})),$("#line_pass").append($("<path>",{d:this._linePath(n)}))}),$("#line_main").html($("#line_main").html()),$("#line_pass").html($("#line_pass").html())}drawStrip(){$("#strip").attr("d",`M 0,${this.stripY} H ${this._svgWidth}`),$("#dest_strip").attr("d",`M 0,${this.stripY} H ${this._svgDestWidth}`)}fillThemeColour(){$("#line_main, #strip, #dest_strip").attr("stroke",this._themeColour),$("#dest_name > #platform > circle").attr("fill",this._themeColour)}drawDestInfo(){$("#dest_name > #platform > text").text(this._platformNum);let t=this[this._direction+"ValidDests"],e="l"===this._direction?"start":"end";var[n,i]=[0,1].map(e=>t.map(t=>this.stations[t].name[e].replace(/\\/g," ")).join("/"));if(this._destLegacy){var[s,a]=this._lineNames;a+=" "}else var s=a="";$("#dest_name > g:last-child text").eq(0).text(`${s}å¾€${n}`),$("#dest_name > g:last-child text").eq(1).text(`${a}to ${i}`);var r=310+$("#dest_name > g:last-child")[0].getBoundingClientRect().width+45+50,l="l"==this._direction?1:-1,o=(this._svgDestWidth-l*r)/2,h=90*(1-l),c=o+285*l,d=c+120*l;$("#dest_name > use").attr("transform",`translate(${o},130)rotate(${h})`),$("#dest_name > #platform").attr("transform",`translate(${c},130)`),$("#dest_name > g:last-child").attr({transform:`translate(${d},105)`,"text-anchor":e})}loadFonts(){$(".rmg-name__zh").addClass(`rmg-name__char-${this._charForm}`)}updateStnName(t,e,n){let s=Object(i.h)();s.stn_list[t].name=e,s.stn_list[t].num=n,Object(i.m)(s),this.stations[t].name=e,this.stations[t].stnNum=n,$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html()),this.leftDests.includes(t)&&"l"==this._direction?this.drawDestInfo():this.rightDests.includes(t)&&"r"==this._direction&&this.drawDestInfo(),this.loadFonts(),t==this._currentStnId&&this.updateStnNameBg()}updateStnTransfer(t,e,n=null){var s=this.stations[t].constructor.name,r=Object(i.h)();if(r.stn_list[t].change_type=e,"none"==e?(delete r.stn_list[t].transfer,r.stn_list[t].interchange=[[]]):r.stn_list[t].interchange=n,Object(i.m)(r),this.stations[t]=this._initStnInstance(t,r.stn_list[t]),s!=this.stations[t].constructor.name){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip()}else this.stations[t].x=this._stnRealX(t),this.stations[t].y=this._stnRealY(t),this.stations[t].namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),this.stations[t].state=this._stnState(t),$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html());this.loadFonts(),this.updateStnNameBg()}removeStn(t){var e=Object(i.h)(),n=this.stations[t].parents,s=this.stations[t].children,r=!0;for(let e in this.stations)if(![t,"linestart","lineend"].includes(e)&&0==this._stnYShareMTR(e)){r=!1;break}if(2==n.length&&2==s.length)return!1;if(r)return!1;if(4==Object.keys(e.stn_list).length)return!1;if(2==n.length||2==s.length)n.forEach(t=>{e.stn_list[t].children=s,this.stations[t].children=s}),s.forEach(t=>{e.stn_list[t].parents=n,this.stations[t].parents=n}),1==n.length&&(e.stn_list[n[0]].branch.right=this.stations[t].branch.right,this.stations[n[0]].branch.right=this.stations[t].branch.right),1==s.length&&(e.stn_list[s[0]].branch.left=this.stations[t].branch.left,this.stations[s[0]].branch.left=this.stations[t].branch.left);else if(2==this._stnOutdegree(n[0])&&2==this._stnIndegree(s[0])){var l=this.stations[n[0]].children.indexOf(t),o=this.stations[s[0]].parents.indexOf(t);e.stn_list[n[0]].children.splice(l,1),this.stations[n[0]].children.splice(l,1),e.stn_list[s[0]].parents.splice(o,1),this.stations[s[0]].parents.splice(o,1),e.stn_list[n[0]].branch.right=[],this.stations[n[0]].branch.right=[],e.stn_list[s[0]].branch.left=[],this.stations[s[0]].branch.left=[]}else n.forEach(n=>{var i=e.stn_list[n].children.indexOf(t);s.length?(e.stn_list[n].children[i]=s[0],this.stations[n].children[i]=s[0]):(e.stn_list[n].children.splice(i,1),this.stations[n].children.splice(i,1)),this.stations[n].branch.right[1]===t&&(this.stations[n].branch.right[1]=s[0],e.stn_list[n].branch.right[1]=s[0])}),s.forEach(i=>{var s=e.stn_list[i].parents.indexOf(t);n.length?(e.stn_list[i].parents[s]=n[0],this.stations[i].parents[s]=n[0]):(e.stn_list[i].parents.splice(s,1),this.stations[i].parents.splice(s,1)),this.stations[i].branch.left[1]===t&&(this.stations[i].branch.left[1]=n[0],e.stn_list[i].branch.left[1]=n[0])});delete e.stn_list[t],delete this.stations[t];if(this._currentStnId==t){var h=Object.keys(this.stations)[2];this._currentStnId=h,e.current_stn_idx=h,!0}Object(i.m)(e),n.concat(s).forEach(t=>{["linestart","lineend"].includes(t)||(this.stations[t]=this._initStnInstance(t,e.stn_list[t]))});for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t),e.state=this._stnState(t));return a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),this.loadFonts(),this.updateStnNameBg(),!0}newStnPossibleLoc(t,e){switch("before"==t?this._stnIndegree(e):this._stnOutdegree(e)){case 2:return[1,1,1,[],[]];case 1:if(0==this._stnYShareMTR(e)){let n=this.newBranchPossibleEnd(t,e);return n=n.length?n:[],[1,0,0,n,n]}return this._stnYShareMTR(e)<0?"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,0,1,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,0,1,[],[]]:"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,1,0,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,1,0,[],[]]}return[0,0,0,[],[]]}newBranchPossibleEnd(t,e){let n=[];if("before"==t){for(;1==this._stnIndegree(e);)e=this.stations[e].parents[0],n.unshift(e);n.pop()}else{for(;1==this._stnOutdegree(e);)e=this.stations[e].children[0],n.push(e);n.shift()}return n}addStn(t,e,n,s){let r=Object(i.i)();for(;Object.keys(this.stations).includes(r);)r=Object(i.i)();let l=Object(i.h)(),o={};"before"==t?"centre"==n?(o.parents=this.stations[e].parents,0==this._stnIndegree(e)&&0!=this._stnYShareMTR(e)?o.children=this.leftDests:0!=this._stnYShareMTR(e)?(o.children=this.stations[this.stations[e].parents[0]].children,o.branch={left:[],right:this.stations[o.parents[0]].branch.right},this.stations[o.parents[0]].branch.right=[],l.stn_list[o.parents[0]].branch.right=[]):(o.children=[e],o.branch={left:this.stations[e].branch.left,right:[]},this.stations[e].branch.left=[],l.stn_list[e].branch.left=[]),o.parents.forEach(t=>{this.stations[t].children=[r],l.stn_list[t].children=[r]}),o.children.forEach(t=>{this.stations[t].parents=[r],l.stn_list[t].parents=[r]})):"upper"==n?(o.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[0]&&(this.stations[e].branch.left[1]=r,l.stn_list[e].branch.left[1]=r),o.parents=this.stations[e].parents.slice(0,1),o.children=[e],o.parents.forEach(t=>{this.stations[t].children=[r],l.stn_list[t].children=[r]}),this.stations[e].parents[0]=r,l.stn_list[e].parents[0]=r):(o.parents=this.stations[e].parents,o.children=[e],o.parents.forEach(t=>{this.stations[t].children[0]=r,l.stn_list[t].children[0]=r,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=r,l.stn_list[t].branch.right[1]=r)}),o.children.forEach(t=>{this.stations[t].parents=[r],l.stn_list[t].parents=[r]}))):"lower"==n?(o.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[1]&&(this.stations[e].branch.left[1]=r,l.stn_list[e].branch.left[1]=r),o.parents=this.stations[e].parents.slice(1),o.children=[e],o.parents.forEach(t=>{this.stations[t].children=[r],l.stn_list[t].children=[r]}),this.stations[e].parents[1]=r,l.stn_list[e].parents[1]=r):(o.parents=this.stations[e].parents,o.children=[e],o.parents.forEach(t=>{let n=this.stations[t].children.length;this.stations[t].children[n-1]=r,l.stn_list[t].children[n-1]=r,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=r,l.stn_list[t].branch.right[1]=r)}),o.children.forEach(t=>{this.stations[t].parents=[r],l.stn_list[t].parents=[r]}))):"newupper"==n?(o.branch={left:[],right:[]},this.stations[e].branch.left=["through",r],l.stn_list[e].branch.left=["through",r],this.stations[s].branch.right=["through",r],l.stn_list[s].branch.right=["through",r],o.parents=[s],o.children=[e],this.stations[s].children.unshift(r),l.stn_list[s].children.unshift(r),this.stations[e].parents.unshift(r),l.stn_list[e].parents.unshift(r)):"newlower"==n&&(o.branch={left:[],right:[]},this.stations[e].branch.left=["through",r],l.stn_list[e].branch.left=["through",r],this.stations[s].branch.right=["through",r],l.stn_list[s].branch.right=["through",r],o.parents=[s],o.children=[e],this.stations[s].children.push(r),l.stn_list[s].children.push(r),this.stations[e].parents.push(r),l.stn_list[e].parents.push(r)):"centre"==n?(o.children=this.stations[e].children,0==this._stnOutdegree(e)&&0!=this._stnYShareMTR(e)?o.parents=this.rightDests:0!=this._stnYShareMTR(e)?(o.parents=this.stations[this.stations[e].children[0]].parents,o.branch={left:this.stations[o.children[0]].branch.left,right:[]},this.stations[o.children[0]].branch.left=[],l.stn_list[o.children[0]].branch.left=[]):(o.parents=[e],o.branch={left:[],right:this.stations[e].branch.right},this.stations[e].branch.right=[],l.stn_list[e].branch.right=[]),o.children.forEach(t=>{this.stations[t].parents=[r],l.stn_list[t].parents=[r]}),o.parents.forEach(t=>{this.stations[t].children=[r],l.stn_list[t].children=[r]})):"upper"==n?(o.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[0]&&(this.stations[e].branch.right[1]=r,l.stn_list[e].branch.right[1]=r),o.children=this.stations[e].children.slice(0,1),o.parents=[e],o.children.forEach(t=>{this.stations[t].parents=[r],l.stn_list[t].parents=[r]}),this.stations[e].children[0]=r,l.stn_list[e].children[0]=r):(o.children=this.stations[e].children,o.parents=[e],o.children.forEach(t=>{this.stations[t].parents[0]=r,l.stn_list[t].parents[0]=r,this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=r,l.stn_list[t].branch.left[1]=r)}),o.parents.forEach(t=>{this.stations[t].children=[r],l.stn_list[t].children=[r]}))):"lower"==n?(o.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[1]&&(this.stations[e].branch.right[1]=r,l.stn_list[e].branch.right[1]=r),o.children=this.stations[e].children.slice(1),o.parents=[e],o.children.forEach(t=>{this.stations[t].parents=[r],l.stn_list[t].parents=[r]}),this.stations[e].children[1]=r,l.stn_list[e].children[1]=r):(o.children=this.stations[e].children,o.parents=[e],o.children.forEach(t=>{1===this._stnIndegree(t)?(this.stations[t].parents[0]=r,l.stn_list[t].parents[0]=r):(this.stations[t].parents[1]=r,l.stn_list[t].parents[1]=r),this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=r,l.stn_list[t].branch.left[1]=r)}),o.parents.forEach(t=>{this.stations[t].children=[r],l.stn_list[t].children=[r]}))):"newupper"==n?(o.branch={left:[],right:[]},this.stations[e].branch.right=["through",r],l.stn_list[e].branch.right=["through",r],this.stations[s].branch.left=["through",r],l.stn_list[s].branch.left=["through",r],o.children=[s],o.parents=[e],this.stations[s].parents.unshift(r),l.stn_list[s].parents.unshift(r),this.stations[e].children.unshift(r),l.stn_list[e].children.unshift(r)):"newlower"==n&&(o.branch={left:[],right:[]},this.stations[e].branch.right=["through",r],l.stn_list[e].branch.right=["through",r],this.stations[s].branch.left=["through",r],l.stn_list[s].branch.left=["through",r],o.children=[s],o.parents=[e],this.stations[s].parents.push(r),l.stn_list[s].parents.push(r),this.stations[e].children.push(r),l.stn_list[e].children.push(r)),o.name=Object(i.g)(r),o.change_type="none",o.num="00",o.interchange=[[]],l.stn_list[r]=o,Object(i.m)(l),this.stations[r]=this._initStnInstance(r,o),this.stations[e]=this._initStnInstance(e,Object(i.h)().stn_list[e]);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t),e.namePos=this._txtFlip?!this._stnNamePos(t):this._stnNamePos(t));return a.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),this.loadFonts(),this.updateStnNameBg(),[r,o]}reverseStns(){var t=Object(i.h)();for(let[n,i]of Object.entries(this.stations))if("linestart"===n)t.stn_list.lineend.parents=i.children.reverse(),t.stn_list.lineend.branch={left:i.branch.right,right:[]};else if("lineend"===n)t.stn_list.linestart.children=i.parents.reverse(),t.stn_list.linestart.branch={left:[],right:i.branch.left};else{var e=i.children.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}});t.stn_list[n].children=i.parents.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}}),t.stn_list[n].parents=e,t.stn_list[n].branch.left=i.branch.right,t.stn_list[n].branch.right=i.branch.left}Object(i.m)(t),location.reload(!0)}updateBranchType(t,e,n){let s=i.a[e];if(this.stations[t].branch[s][0]===n)return;this.stations[t].branch[s][0]=n;let r=Object(i.h)();r.stn_list[t].branch[s][0]=n,Object(i.m)(r);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts()}updateBranchFirst(t,e,n){let s=i.a[e];if(this.stations[t].branch[s][1]===n)return!1;let r=n,l=Object(i.h)();if("right"===s){for(;1===this.stations[r].inDegree;)r=this.stations[r].children[0];let e=this.stations[t].children.indexOf(n);this.stations[t].branch.right[1]=l.stn_list[t].branch.right[1]=n,this.stations[r].branch.left[1]=l.stn_list[r].branch.left[1]=this.stations[r].parents[e]}else{for(;1===this.stations[r].outDegree;)r=this.stations[r].parents[0];let e=this.stations[t].parents.indexOf(n);this.stations[t].branch.left[1]=l.stn_list[t].branch.left[1]=n,this.stations[r].branch.right[1]=l.stn_list[r].branch.right[1]=this.stations[r].children[e]}Object(i.m)(l);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t));return a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts(),!0}updateBranchPos(t,e,n){let s=i.a[e];if("right"===s){if(this.stations[t].children.indexOf(this.stations[t].branch.right[1])===n)return}else if(this.stations[t].parents.indexOf(this.stations[t].branch.left[1])===n)return;let r=this.stations[t].branch[s][1],l=Object(i.h)();if("right"===s){for(;1===this.stations[r].inDegree;)r=this.stations[r].children[0];this.stations[t].children.reverse(),l.stn_list[t].children.reverse(),this.stations[r].parents.reverse(),l.stn_list[r].parents.reverse()}else{for(;1===this.stations[r].outDegree;)r=this.stations[r].parents[0];this.stations[t].parents.reverse(),l.stn_list[t].parents.reverse(),this.stations[r].children.reverse(),l.stn_list[r].children.reverse()}Object(i.m)(l);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));a.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadFonts()}static clearSVG(){$("#stn_icons, #line_main, #line_pass").empty()}static initSVG(t){t.drawSVGFrame(),t.showFrameOuter(),t.drawStns(),t.fillThemeColour(),t.drawLine(),t.drawStrip(),t.drawDestInfo(),t.loadFonts(),t.updateStnNameBg()}get branches(){for(var t=["linestart"],e=[[]],n=0;t.length;){var i=t.shift(),s=e[n][0]||null,a=[i];for(s&&a.unshift(s);"lineend"!=i&&("linestart"==i||s!=this.stations[i].branch.left[1]);){s=i;var r=this.stations[s].children;switch(r.length){case 1:i=r[0];break;case 2:if(e.push([s]),"linestart"==s)var l=this.stations[s].branch.right[1];else l=this.stations[s].branch.right[1];t.push(l),i=r.filter(t=>t!=l)[0]}a.push(i)}e[n]=a,n++}return e.map(t=>t.filter(t=>!["linestart","lineend"].includes(t)))}get routes(){for(var t=["linestart"],e=[["linestart"]],n=0;t.length;){var i=t.shift(),s=e[n].slice().reverse()[0]||null;for(s&&"linestart"!==i?e[n].push(i):e[n]=[i];"lineend"!==i;){s=i;var a=this.stations[s].children;switch(a.length){case 1:i=a[0];break;case 2:var r=this.stations[s].branch.right[1];"through"===this.stations[s].branch.right[0]?(e.push(e[n].slice()),t.push(r)):0===n&&(e.push([s]),t.push(r)),i=a.filter(t=>t!=r)[0]}if(e[n].push(i),s===this.stations[i].branch.left[1]&&"nonthrough"===this.stations[i].branch.left[0])break}n++}return e}}},function(t,e){t.exports=mdc.tabBar},function(t,e){t.exports=mdc.slider},function(t,e){t.exports=mdc.switchControl},function(t,e){t.exports=mdc.iconButton},,function(t,e,n){"use strict";n.r(e);var i=n(0),s=n(8),a=n(3),r=n(7),l=n(5);var o=n(4),h=function(t,e,n,i){return new(n||(n=Promise))((function(s,a){function r(t){try{o(i.next(t))}catch(t){a(t)}}function l(t){try{o(i.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,l)}o((i=i.apply(t,e||[])).next())}))};var c=n(2),d=n(10);var _=n(6),g=n(11);function m(){const t=r.MDCList.attachTo($("#design_list_mtr")[0]),e=a.MDCDialog.attachTo($("#design_char_diag")[0]),n=new g.MDCSwitch($("#legacy")[0]);Promise.resolve(Object(i.h)()).then(t=>{$("#design_char_diag")[0].dispatchEvent(new CustomEvent("MDCDialog:closed",{detail:{action:t.char_form}})),n.checked=t.dest_legacy}),t.listen("MDCList:action",t=>{switch(t.detail.index){case 0:window.myLine.txtFlip=!Object(i.h)().txt_flip;break;case 1:e.open()}}),e.listen("MDCDialog:closed",t=>{let e=t.detail.action;"close"!=e&&(window.myLine.charForm=e,$("#design_list_mtr").find("li#char .mdc-list-item__secondary-text").text((t=>$("#design_char_diag").find("li").filter((e,n)=>n.dataset.mdcDialogAction===t).find("span").text())(e)))}),$(n.root_).find("input").on("change",t=>window.myLine.destLegacy=t.target.checked)}var u=n(9),p=n(12);const f=(t,e,n)=>$("<div>",{id:t,class:"mdc-card mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-2-phone station-card"}).append($("<div>",{class:"mdc-card__primary-action"}).append($("<div>",{class:"mdc-card__media mdc-card__media--16-9"})).append($("<div>",{class:"mdc-card__media-content station-card__content"}).html(e.join("<br>")).prepend($("<span>").css("display","gzmtr"===window.urlParams.get("style")?"inline":"none").text(n+"Â ")))).append($("<div>",{class:"mdc-card__actions"}).append($("<div>",{class:"mdc-card__action-icons"}).append($("<button>",{title:"Set As Current",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("my_location")).append($("<button>",{title:"Interchange",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("edit")).append($("<button>",{title:"Remove",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("delete_forever"))));function w(){var t=$("#stn_transfer_diag .mdc-layout-grid__inner #int_name_zh,#int_name_en").slice(0,2).clone();t.find(".mdc-text-field").removeAttr("data-mdc-auto-init-state"),$("div#int_line").slice(1,3).after(t);const[e,n,s,r,l]=["#stn_add_diag","#stn_modify_diag","#stn_transfer_diag","#stn_delete_diag","#stn_delete_err"].map(t=>new a.MDCDialog($(t)[0])),[o,h,d,g]=["#prep","#pivot","#loc","#end"].map(t=>new _.MDCSelect($("#stn_add_diag").find(t)[0])),m=["#name_zh","#name_en"].map(t=>new c.MDCTextField($("#stn_modify_diag").find(t)[0])),w=new c.MDCTextField($("#stn_modify_diag #stn_num")[0]),b=new u.MDCTabBar($("#stn_transfer_diag .mdc-tab-bar")[0]),v=new _.MDCSelect($("#change_type")[0]),y=$("#int_city .mdc-select").map((t,e)=>new _.MDCSelect(e)).get(),x=$("#int_line .mdc-select").map((t,e)=>new _.MDCSelect(e)).get(),S=["zh","en"].map(t=>$(`div#int_name_${t}`).find(".mdc-text-field").map((t,e)=>new c.MDCTextField(e)).get()),D=["zh","en"].map(t=>new c.MDCTextField($("#stn_transfer_diag").find(`#osi_name_${t}`)[0])),[M,N]=["#tick_direc","#paid_area"].map(t=>new p.MDCIconButtonToggle($("#stn_transfer_diag").find(t)[0])),[O,T,C]=["through","first","pos"].map(t=>["left","right"].map(e=>new _.MDCSelect($(`#${e}_${t}`)[0])));var j=Object(i.h)().stn_list;window.myLine.tpo.forEach(t=>{$("#panel_stations .mdc-layout-grid__inner:first").append(f(t,j[t].name,j[t].num)),$("#pivot__selection").append($("<li>",{"data-value":t}).addClass("mdc-list-item").text(j[t].name.join()))}),$("#panel_stations .mdc-card__primary-action").on("click",t=>{var e=t.target.closest(".mdc-card").id;"add_stn"!=e&&($("#stn_modify_diag").attr("for",e),n.open())}),$('#panel_stations .mdc-card__action-icons > [title="Add"]').on("click",t=>{e.open()}),$('#panel_stations .mdc-card__action-icons > [title="Set As Current"]').on("click",t=>{var e=t.target.closest(".mdc-card").id;window.myLine.currentStnId=e}),$('#panel_stations .mdc-card__action-icons > [title="Interchange"]').on("click",t=>{$("#stn_transfer_diag").attr("for",t.target.closest(".mdc-card").id),s.open()}),$('#panel_stations .mdc-card__action-icons > [title="Remove"]').on("click",t=>{var e=t.target.closest(".mdc-card").id;$("#stn_delete_diag").attr("for",e),r.open()}),e.listen("MDCDialog:opening",()=>{h.selectedIndex=0}),e.listen("MDCDialog:opened",()=>{[o,h,d].forEach(t=>t.layout())}),e.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=o.value,i=h.value,a=d.value,l=g.value,[c,_]=window.myLine.addStn(e,i,a,l);console.log(e,i,a,l);var m=window.myLine.tpo[window.myLine.tpo.indexOf(c)-1]||"add_stn";$(`#panel_stations .mdc-layout-grid__inner:first #${m}`).after(f(c,_.name,_.num)),$(`#panel_stations #${c} .mdc-card__primary-action`).on("click",t=>{var e=t.target.closest(".mdc-card").id;"add_stn"!=e&&($("#stn_modify_diag").attr("for",e),n.open())}),$(`#panel_stations #${c} .mdc-card__action-icons > [title="Set As Current"]`).on("click",t=>{var e=t.target.closest(".mdc-card").id;window.myLine.currentStnId=e}),$(`#panel_stations #${c} .mdc-card__action-icons > [title="Interchange"]`).on("click",t=>{var e=t.target.closest(".mdc-card").id;$("#stn_transfer_diag").attr("for",e),s.open()}),$(`#panel_stations #${c} .mdc-card__action-icons > [title="Remove"]`).on("click",t=>{var e=t.target.closest(".mdc-card").id;$("#stn_delete_diag").attr("for",e),r.open()});var u=$("<li>",{"data-value":c,class:"mdc-list-item"}).text(_.name.join(" - "));"add_stn"==m?$("#pivot__selection").prepend(u):$(`#pivot__selection [data-value="${m}"`).after(u),$("#stn_modify_diag").attr("for",c),n.open()}}),o.listen("MDCSelect:change",t=>{$("#stn_add_diag #pivot")[0].dispatchEvent(new Event("MDCSelect:change"))}),h.listen("MDCSelect:change",t=>{var e=o.value,n=h.value,s=Object(i.h)().stn_list;for(let[t,i]of window.myLine.newStnPossibleLoc(e,n).entries())1===i||i.length?($("#loc__selection li").eq(t).show(),t>=3&&($("#end__selection").empty(),i.forEach(t=>{$("#end__selection").append($("<li>",{class:"mdc-list-item","data-value":t}).text(s[t].name.join(" - ")))}))):$("#loc__selection li").eq(t).hide();d.value=Array.from(document.querySelectorAll("#loc__selection li")).filter(t=>"none"!==t.style.display)[0].dataset.value}),d.listen("MDCSelect:change",t=>{["newupper","newlower"].includes(t.detail.value)?($("#stn_add_diag [new-branch]").show(),g.selectedIndex=0):$("#stn_add_diag [new-branch]").hide()}),n.listen("MDCDialog:opening",t=>{var e=$(t.target).attr("for");Promise.resolve(Object(i.h)().stn_list).then(t=>{m.forEach((n,i)=>n.value=t[e].name[i]),w.value=t[e].num})}),n.listen("MDCDialog:opened",()=>{m.map(t=>t.layout()),w.layout()}),$("#stn_modify_diag").find("#name_zh, #name_en, #stn_num").on("input",()=>{let t=m.map(t=>t.value);var e=w.value,n=$("#stn_modify_diag").attr("for");window.myLine.updateStnName(n,t,e),$(`#panel_stations .mdc-layout-grid__inner:first #${n} .mdc-card__media-content`).html(t.join("<br>")).prepend($("<span>",{style:"gzmtr"==window.urlParams.get("style")?"":"display:none;"}).text(e+" ")),$(`li[data-value="${n}`).text(t.join())});const L=()=>{v.layout(),y.forEach(t=>t.layout()),x.forEach(t=>t.layout()),[].concat(...S).forEach(t=>t.layout()),D.forEach(t=>t.layout())},k=()=>{[...O,...T,...C].map(t=>t.layout())};function I(t,e){e?($("#int_city, #int_line, #int_name_zh, #int_name_en").slice(4*t,4*(t+1)).show(),y[t].layout(),x[t].layout(),S.map(e=>e[t].layout())):$("#int_city, #int_line, #int_name_zh, #int_name_en").slice(4*t,4*(t+1)).hide()}b.listen("MDCTabBar:activated",t=>{switch(t.detail.index){case 0:$("#panel_interchange").show(),$("#panel_branch").hide(),L();break;case 1:$("#panel_interchange").hide(),$("#panel_branch").show(),k()}}),$.getJSON("data/city_list.json",t=>{var e=window.urlParams.get("lang");t.forEach(t=>{$("#int_city__selection.mdc-list").each((n,s)=>{$(s).append($("<li>",{class:"mdc-list-item","data-value":t.id}).text(Object(i.d)(t.country)+Object(i.j)(t.name,e)))})})}),s.listen("MDCDialog:opening",t=>{var e=$(t.target).attr("for"),n=Object(i.h)().stn_list[e];let s=Object(i.h)().theme[0];if(v.value=n.change_type.split("_")[0],"none"!==n.change_type){var a=n.interchange[0].concat(n.interchange[1]?n.interchange[1].slice(1,n.interchange[1].length):[]);a.length<3&&a.unshift([,,,,,,]),a.length<3&&a.push([,,,,,,]),console.log(a),a.forEach((t,e)=>{let n=$("#int_city__selection.mdc-list").eq(0).find(`[data-value="${t[0]||s}"]`).index();y[e].selectedIndex=n,S.forEach((n,i)=>n[e].value=t[4+i]||"")})}else{let t=$("#int_city__selection.mdc-list").eq(0).find(`[data-value="${s}"]`).index();y.forEach(e=>e.selectedIndex=t),[].concat(...S).forEach(t=>t.value="")}["none","int2"].includes(n.change_type.split("_")[0])?M.on=!0:M.on="r"==n.change_type.slice(-1),"osi"==n.change_type.substring(0,3)?(D.forEach((t,e)=>t.value=n.interchange[1][0][e]),N.on="p"==n.change_type.split("_").reverse()[0][0]):(D.forEach(t=>t.value=""),N.on=!0),(t=>{["left","right"].forEach(e=>{let n=t.branch[e][0];n?(O[i.a[e]].value=n,$(`#${e}_through__selection [data-value="na"]`).hide(),$(`#${e}_through__selection [data-value="through"]`).show(),$(`#${e}_through__selection [data-value="nonthrough"]`).show(),$(`[${e}-first-group], [${e}-pos-group]`).show()):(O[i.a[e]].value="na",$(`#${e}_through__selection [data-value="na"]`).show(),$(`#${e}_through__selection [data-value="through"]`).hide(),$(`#${e}_through__selection [data-value="nonthrough"]`).hide(),$(`[${e}-first-group], [${e}-pos-group]`).hide())}),$("#left_first__selection, #right_first__selection").empty(),Promise.resolve(Object(i.h)().stn_list).then(e=>{[0,1].forEach(n=>{t[i.c[n]].forEach(t=>{$(`#${i.a[n]}_first__selection`).append($("<li>",{class:"mdc-list-item","data-value":t}).text(e[t].name.join()))})})}).then(()=>{O.forEach((e,n)=>{T[n].selectedIndex="na"!==e.value?t[i.c[n]].indexOf(t.branch[i.a[n]][1]):0})}),C.forEach((e,n)=>{e.selectedIndex=t[i.c[n]].indexOf(t.branch[i.a[n]][1])})})(n)}),s.listen("MDCDialog:opened",t=>{L(),k()}),s.listen("MDCDialog:closed",t=>{if("close"==t.detail.action)return;var e=t.target.getAttribute("for"),n=v.value,i=M.on?"r":"l";let s=D.map(t=>t.value);var a=N.on?"p":"u",[r,l,o]=[0,1,2].map(t=>[y[t].value,x[t].value].concat($("ul#int_line__selection").eq(t).find("li span").eq(x[t].selectedIndex).attr("style").match(/#[\w\d]+/g),...S.map(e=>e[t].value)));if("none"==n)window.myLine.updateStnTransfer(e,n);else if("osi22"==n)window.myLine.updateStnTransfer(e,`${n}_${a}${i}`,[[r],[s,l,o]]);else switch(n){case"int2":window.myLine.updateStnTransfer(e,n,[[l]]);break;case"osi11":window.myLine.updateStnTransfer(e,`${n}_${a}${i}`,[[],[s,l]]);break;default:switch(n){case"int3":window.myLine.updateStnTransfer(e,`${n}_${i}`,[[l,o]]);break;case"osi12":window.myLine.updateStnTransfer(e,`${n}_${a}${i}`,[[],[s,l,o]])}}}),v.listen("MDCSelect:change",t=>{if("int2"==t.detail.value)I(0,!1),I(1,!0),I(2,!1),$("#stn_transfer_diag #tick_direc").hide(),$("#osi_name_zh, #osi_name_en, #paid_area").hide();else if("int3"==t.detail.value)I(0,!1),I(1,!0),I(2,!0),$("#stn_transfer_diag #tick_direc").show(),$("#osi_name_zh, #osi_name_en, #paid_area").hide();else if("osi11"==t.detail.value)I(0,!1),I(1,!0),I(2,!1),$("#stn_transfer_diag #tick_direc").show(),$("#osi_name_zh, #osi_name_en, #paid_area").show();else if("osi12"==t.detail.value)I(0,!1),I(1,!0),I(2,!0),$("#stn_transfer_diag #tick_direc").show(),$("#osi_name_zh, #osi_name_en, #paid_area").show();else if("osi22"==t.detail.value){I(0,!0),I(1,!0),I(2,!0),$("#osi_name_zh, #osi_name_en, #paid_area").show();let t=Object(i.h)().stn_list[$("#stn_transfer_diag").attr("for")];"linestart"==t.parents[0]||"lineend"==t.children[0]?$("#tick_direc").hide():$("#tick_direc").show()}else $("#stn_transfer_diag #panel_interchange [id]div").slice(1).hide(),$("#tick_direc, #paid_area").hide()}),y.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{-1!==t.detail.index&&$.getJSON(`data/${t.detail.value}.json`,t=>{var n=window.urlParams.get("lang");$("#int_line__selection.mdc-list").eq(e).empty(),t.forEach(t=>{$("#int_line__selection.mdc-list").eq(e).append(`<li class="mdc-list-item" data-value="${t.id}">\n                        <span style="background:${t.colour};color:${t.fg||"#fff"};">&nbsp;${Object(i.j)(t.name,n)}&nbsp;</span>\n                        </li>`)});var s=$("#stn_transfer_diag").attr("for"),a=Object(i.h)().stn_list[s];if("none"!==a.change_type){var r=a.interchange[0].concat(a.interchange[1]?a.interchange[1].slice(1,a.interchange[1].length):[]);r.length<3&&r.unshift([,,,,,,]),r.length<3&&r.push([,,,,,,]);var l=$("#int_line__selection.mdc-list").eq(e).find(`[data-value="${r[e][1]}"]`).index();x[e].selectedIndex=-1==l?0:l}else x[e].selectedIndex=0})})}),O.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{if("na"===t.detail.value)return;let n=$("#stn_transfer_diag").attr("for");window.myLine.updateBranchType(n,e,t.detail.value)})}),T.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{if(1===$(`#${i.a[e]}_first__selection`).children().length)return;let n=$("#stn_transfer_diag").attr("for");window.myLine.updateBranchFirst(n,e,t.detail.value)&&(C[e].selectedIndex=0===C[e].selectedIndex?1:0)})}),C.forEach((t,e)=>{t.listen("MDCSelect:change",t=>{if("na"===O[e].value)return;let n=$("#stn_transfer_diag").attr("for");window.myLine.updateBranchPos(n,e,t.detail.index)})}),r.listen("MDCDialog:opening",t=>{var e=$(t.target).attr("for");$("#stn_delete_diag #err_stn").text(Object(i.h)().stn_list[e].name.join(" - "))}),r.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=$(t.target).attr("for");window.myLine.removeStn(e)?($(`#panel_stations .mdc-layout-grid__inner #${e}`).remove(),$(`#pivot__selection [data-value="${e}"]`).remove()):l.open()}})}switch((window.urlParams.get("lang")||localStorage.rmgLang||navigator.language.split("-").slice(0,2).join("-")).toLowerCase()){case"zh-cn":case"zh-hans":window.urlParams.set("lang","zh-Hans");break;case"zh":case"zh-hk":case"zh-tw":window.urlParams.set("lang","zh-HK");break;default:window.urlParams.set("lang","en")}switch(window.urlParams.get("style")){case"mtr":case"gzmtr":case"shmetro":break;default:window.urlParams.set("style","mtr")}history.pushState({url:window.location.href},null,"?"+window.urlParams.toString()),o("head").append(...["share","destination","railmap"].map(t=>o("<link>",{rel:"stylesheet",href:`styles/${t}_${window.urlParams.get("style")}.css`,id:`css_${t}`}))),window.myLine=null,o(`[${window.urlParams.get("style")}-specific]`).show(),function(){const[t,e,n,o,h,c]=["#template_diag","#import_diag","#export_diag","#preview_diag","#style_diag","#lang_diag"].map(t=>a.MDCDialog.attachTo($(t)[0])),[d,_]=$("#panel_save .mdc-list").map((t,e)=>r.MDCList.attachTo(e)).get();$("#panel_save .mdc-list li").map((t,e)=>new l.MDCRipple(e)),d.listen("MDCList:action",e=>{switch(e.detail.index){case 0:t.open();break;case 1:$("#upload_file").click();break;case 2:$("<a>",{href:"data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),download:"rmg_param.json"})[0].click();break;case 3:n.open()}}),$("#panel_save .mdc-list:nth-child(2) li:first-child span:nth-child(2) span:last-child").attr("trans-tag",$(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).attr("trans-tag")).text($(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).text()),$("#panel_save .mdc-list:nth-child(2) li:nth-child(2) span:nth-child(2) span:last-child").text($(`#lang_diag [data-mdc-dialog-action="${window.urlParams.get("lang")}"] span`).text()),_.listen("MDCList:action",t=>{switch(t.detail.index){case 0:h.open();break;case 1:c.open()}}),$.getJSON("templates/template_list.json",t=>{var e=window.urlParams.get("lang");t.forEach(t=>{$("#template_diag ul").append($("<li>",{class:"mdc-list-item","data-mdc-dialog-action":t.filename}).append($("<span>",{class:"mdc-list-item__text"}).text(Object(i.j)(t.desc,e))))}),$("#template_diag li:first-child").attr("tabindex",0),$("#theme_line__selection li").map((t,e)=>new l.MDCRipple(e))}),t.listen("MDCDialog:closed",t=>{"close"!=t.detail.action&&$.getJSON(`templates/${t.detail.action}.json`,t=>{localStorage.rmgParam=JSON.stringify(t),location.reload(!0)})}),n.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":break;case"svg1":$("#preview_diag").attr("for","destination"),o.open();break;case"svg2":$("#preview_diag").attr("for","railmap"),o.open()}}),$(window).on("resize",t=>{g()});const g=()=>{var t=$("preview_diag").attr("for"),[e,n]=["destination"==t?Object(i.h)().svg_dest_width:Object(i.h)().svg_width,Object(i.h)().svg_height],s=$(window).width()-32-50,a=$(window).height()-60-53-60,r=Math.min(s/e,a/n);$("#preview_diag").find("svg").attr({width:e*r,height:n*r}),$("#preview_diag").find(".mdc-dialog__surface").attr("style",`max-width:${s+50}px;`)};let m;o.listen("MDCDialog:opened",t=>{var e=$(t.target).attr("for"),[n,s]=["destination"==e?Object(i.h)().svg_dest_width:Object(i.h)().svg_width,Object(i.h)().svg_height];$("#preview_diag .mdc-dialog__surface").attr("style",`max-width:${$(window).width()-32}px;`);var a=$(window).width()-32-50,r=$(window).height()-60-53-60,l=Math.min(a/n,r/s);$(t.target).find(".mdc-dialog__content").append($("#"+$(t.target).attr("for")).clone().attr({style:"all:initial;",viewBox:`0 0 ${n} ${s}`,width:n*l,height:s*l}));let o=["share",$(t.target).find("svg")[0].id].map(t=>Array.from($(`link#css_${t}`)[0].sheet.cssRules).map(t=>t.cssText).join(" "));$(t.target).find("svg").prepend(...o.map(t=>$("<style>").text(t))),$(t.target).find('svg [style="display: none;"]').remove()}),o.listen("MDCDialog:closed",t=>{if("close"!==t.detail.action){if("png"===t.detail.action)return Object(i.p)($(t.target).removeAttr("for").find("svg")),void $(t.target).find(".mdc-dialog__content").empty();if("svg"===t.detail.action){let n=$(t.target).find(".mdc-dialog__content svg");var e=document.createElement("a");e.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n[0].outerHTML))),e.download="rmg_export.svg",e.click(),$(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}}else $(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}),$("#upload_file").on("change",t=>{console.log(t.target.files[0]);let n=new FileReader;n.onload=function(t){console.log(t.target),m=JSON.parse(t.target.result),$("#import_diag").find(".mdc-dialog__content").html(Object(i.e)(m)),e.open()},n.readAsText(t.target.files[0])}),e.listen("MDCDialog:closed",t=>{"close"!=t.detail.action?(s.a.clearSVG(),localStorage.rmgParam=JSON.stringify(m),location.reload(!0)):$("#upload_file")[0].value=""}),h.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":case window.urlParams.get("style"):return;default:window.urlParams.set("style",t.detail.action),window.location.href="?"+window.urlParams.toString()}}),c.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=t.detail.action;localStorage.rmgLang=e,e!=window.urlParams.get("lang")&&(window.urlParams.set("lang",e),window.location.href="?"+window.urlParams.toString())}})}(),function(){const t=t=>h(this,void 0,void 0,(function*(){let e=yield(i=window.urlParams.get("style"),h(void 0,void 0,void 0,(function*(){switch(i){case"mtr":return Promise.resolve(s.a);case"gzmtr":return n.e(0).then(n.bind(null,15)).then(({RMGLineGZ:t})=>t);case"shmetro":return n.e(1).then(n.bind(null,16)).then(({RMGLineSH:t})=>t)}})));var i;window.myLine=yield new e(t),e.initSVG(window.myLine)}));if(null!=localStorage.rmgParam)try{Object(i.q)(),t(Object(i.h)())}catch(t){let e=a.MDCDialog.attachTo($("#init_err_diag")[0]);$("#init_err_diag").find("#err_stack").html(t+"<br>"+t.stack.replace(/\n/g,"<br>")),e.open(),console.error(t)}else $.getJSON("templates/blank.json",e=>{localStorage.rmgParam=JSON.stringify(e),Object(i.q)(),t(Object(i.h)())})}(),function(){let t=[!1,!0,!0,!0,!0];window.sliders=[],u.MDCTabBar.attachTo($("#panels .mdc-tab-bar")[0]).listen("MDCTabBar:activated",e=>{if($(".panel--active").removeClass("panel--active"),$(".panel").eq(e.detail.index).addClass("panel--active"),1==e.detail.index&&t[1]&&(!function(){const[t,e]=["#svg_dest_width","#svg_width"].map(t=>c.MDCTextField.attachTo($(t)[0])),[n,s,a]=["#branch_spacing","#y_pc","#padding"].map(t=>d.MDCSlider.attachTo($(t)[0]));window.sliders.push(n,s,a),$("#panel_layout .mdc-list li").map((t,e)=>new l.MDCRipple(e)),Promise.resolve(Object(i.h)()).then(i=>{t.value=i.svg_dest_width.toString(),e.value=i.svg_width.toString(),s.value=i.y_pc,n.value=i.branch_spacing,a.value=i.padding}),$(t.root_).find("input").on("input",t=>window.myLine.svgDestWidth=Number(t.target.value)),$(e.root_).find("input").on("input",t=>window.myLine.svgWidth=Number(t.target.value)),n.listen("MDCSlider:input",()=>{window.myLine.branchSpacing=Number(n.value)}),s.listen("MDCSlider:input",()=>{window.myLine.yPc=Number(s.value)}),a.listen("MDCSlider:input",()=>{window.myLine.padding=Number(a.value)})}(),"gzmtr"===window.urlParams.get("style")&&function(){const[t,e]=["#direction_gz_x","#direction_gz_y"].map(t=>d.MDCSlider.attachTo($(t)[0]));window.sliders.push(t,e),Promise.resolve(Object(i.h)()).then(n=>{t.value=n.direction_gz_x,e.value=n.direction_gz_y}),t.listen("MDCSlider:input",()=>{window.myLine.directionGZX=Number(t.value)}),e.listen("MDCSlider:input",()=>{window.myLine.directionGZY=Number(e.value)})}(),t[1]=!1),1===e.detail.index&&window.sliders.forEach(t=>t.layout()),2==e.detail.index&&t[2]){switch(function(){const t=r.MDCList.attachTo($("#design_list")[0]),[e,n]=["#design_theme_diag","#line_name_diag"].map(t=>a.MDCDialog.attachTo($(t)[0])),[s,o]=["#theme_city","#theme_line"].map(t=>new _.MDCSelect($(t)[0])),[h,d]=["#name_zh","#name_en"].map(t=>c.MDCTextField.attachTo($("#line_name_diag").find(t)[0])),g=c.MDCTextField.attachTo($("#platform_num")[0]);$("#panel_design .mdc-list li").map((t,e)=>new l.MDCRipple(e));const m=t=>$("#design_list").find(`li#direc p#${t}`).text();Promise.resolve(Object(i.h)()).then(t=>{$("#design_list").find("li#name .mdc-list-item__secondary-text").text(t.line_name.join()),h.value=t.line_name[0],d.value=t.line_name[1],$("#design_list").find("li#direc .mdc-list-item__secondary-text").text(m(t.direction)),g.value=t.platform_num}),$.getJSON("data/city_list.json",t=>{let e=window.urlParams.get("lang");t.forEach(t=>{$("#theme_city__selection").append($("<li>",{class:"mdc-list-item","data-value":t.id}).text(Object(i.d)(t.country)+Object(i.j)(t.name,e)))}),$("#theme_city__selection li").map((t,e)=>new l.MDCRipple(e));var[n]=Object(i.h)().theme,a=$(`#theme_city__selection > [data-value="${n}"]`).index();s.selectedIndex=a}),t.listen("MDCList:action",t=>{switch(t.detail.index){case 0:e.open();break;case 1:n.open();break;case 2:"r"==Object(i.h)().direction?(console.log("right to left"),window.myLine.direction="l",$("#design_list").find("li#direc .mdc-list-item__secondary-text").text(m("l"))):(console.log("left to right"),window.myLine.direction="r",$("#design_list").find("li#direc .mdc-list-item__secondary-text").text(m("r")));break;case 4:window.myLine.reverseStns()}}),e.listen("MDCDialog:opened",()=>{[s,o].map(t=>t.layout())}),s.listen("MDCSelect:change",t=>{let e=t.detail.value;$("#theme_line__selection").empty(),$.getJSON(`data/${e}.json`,t=>{var n=window.urlParams.get("lang");t.forEach(t=>{$("#theme_line__selection").append($("<li>",{class:"mdc-list-item","data-value":t.id}).append($("<span>").css({background:t.colour,color:t.fg||"#fff"}).text("Â "+Object(i.j)(t.name,n)+"Â ")))}),$("#theme_line__selection li").map((t,e)=>new l.MDCRipple(e));var s=Object(i.h)();s.theme[0]=e,Object(i.m)(s);var a=$(`#theme_line__selection > [data-value="${s.theme[1]}"]`).index();o.selectedIndex=-1==a?0:a})}),o.listen("MDCSelect:change",t=>{let e=t.detail.index;var n=Object(i.h)();n.theme[1]=t.detail.value,Object(i.m)(n),window.myLine.themeLine=t.detail.value,window.myLine.themeColour=["background-color","color"].map(t=>$("#theme_line__selection span").eq(e).css(t)).map(i.n),$("#design_list").find("li#theme .mdc-list-item__secondary-text").html($("#theme_city__selection li").eq(s.selectedIndex).text()+" "+$("#theme_line__selection li").eq(e).html().trim())}),n.listen("MDCDialog:opened",t=>{[h,d].map(t=>t.layout())}),$("#line_name_diag").find(".mdc-text-field").on("input",()=>{let t=[h,d].map(t=>t.value);window.myLine.lineNames=t,$("#design_list").find("li#name .mdc-list-item__secondary-text").text(t.join())}),$(g.root_).find("input").on("input",t=>window.myLine.platformNum=t.target.value)}(),window.urlParams.get("style")){case"mtr":m();break;case"gzmtr":!function(){const t=r.MDCList.attachTo($("#design_list_gzmtr")[0]),e=a.MDCDialog.attachTo($("#panel_type_diag")[0]),[n,s]=["#psd_num","#line_num"].map(t=>c.MDCTextField.attachTo($(t)[0]));Promise.resolve(Object(i.h)()).then(t=>{n.value=t.psd_num,s.value=t.line_num}),t.listen("MDCList:action",t=>{switch(t.detail.index){case 1:e.open()}}),$(s.root_).find("input").on("input",t=>window.myLine.lineNum=t.target.value),$(n.root_).find("input").on("input",t=>window.myLine.psdNum=t.target.value),e.listen("MDCDialog:closed",t=>{"close"!==t.detail.action&&(window.myLine.infoPanelType=t.detail.action)})}()}t[2]=!1}3==e.detail.index&&t[3]&&(console.log("init again"),w(),t[3]=!1),4==e.detail.index&&t[4]&&($("#panel_info .mdc-card__actions #report").on("click",()=>{window.open("https://github.com/wongchito/RailMapGenerator/issues","_blank")}),$('#panel_info .mdc-card__action-icons [title="Star"]').on("click",()=>{window.open("https://github.com/wongchito/RailMapGenerator","_blank")}),$('#panel_info .mdc-card__action-icons [title="Fork"]').on("click",()=>{window.open("https://github.com/wongchito/RailMapGenerator/fork","_blank")}),t[4]=!1)})}()}]);